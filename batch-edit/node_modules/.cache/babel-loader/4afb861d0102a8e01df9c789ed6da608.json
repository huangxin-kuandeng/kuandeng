{"ast":null,"code":"import * as sysApi from \"../services/sys\";\nimport * as userApi from \"../services/jquery.oauth2-client\";\nexport default {\n  name: \"search\",\n\n  data() {\n    return {\n      searchTasks: [],\n      tasks: [],\n      value: \"\"\n    };\n  },\n\n  mounted() {\n    this.findTasks();\n  },\n\n  methods: {\n    changeTask(val) {\n      this.$emit(\"refresh\", val);\n    },\n\n    dataFilter(val) {\n      if (val) {\n        //val存在\n        this.searchTasks = this.tasks.filter(item => {\n          var label = this.renderLabel(item);\n          var value = this.renderLabel(item);\n\n          if (!!~value.indexOf(val) || !!~value.toUpperCase().indexOf(val.toUpperCase()) || !!~label.indexOf(val) || !!~label.toUpperCase().indexOf(val.toUpperCase())) {\n            return true;\n          }\n        });\n      } else {\n        //val为空时，还原数组\n        this.searchTasks = this.tasks;\n      }\n    },\n\n    findTasks() {\n      var $this = this;\n      var $url = $this.$config.kts + \"runtime/tasks?includeProcessVariables=true&size=100&sort=createTime&order=desc&assignee=\" + $this.$user.name;\n      sysApi.getAsyncDatas({\n        url: $url,\n        data: {}\n      }).then(res => {\n        this.searchTasks = res.data;\n        this.tasks = res.data;\n      });\n    },\n\n    renderLabel(row) {\n      var variables = row.variables || [];\n      var taskName = variables.find(d => {\n        return d.name == \"taskName\";\n      });\n      return taskName ? taskName.value : \" - \";\n    },\n\n    renderValue(row) {\n      var variables = row.variables || [];\n      var taskId = variables.find(d => {\n        return d.name == \"taskId\";\n      });\n      return taskId ? taskId.value : \" - \";\n    },\n\n    cliam() {\n      var $this = this;\n      var $url = $this.$config.kts + \"task/claim?user=\" + $this.$user.name;\n      sysApi.getAsyncDatas({\n        url: $url,\n        data: {}\n      }).then(res => {\n        if (res.code == \"0\" && res.result.length) {\n          $this.$notify({\n            title: \"成功\",\n            message: res.message,\n            type: \"success\"\n          });\n          $this.findTasks();\n        } else {\n          $this.$notify({\n            title: \"警告\",\n            message: res.message,\n            type: \"warning\"\n          });\n        }\n      });\n    },\n\n    save() {\n      console.log(\"保存\");\n    },\n\n    logout() {\n      userApi.oauth2Client(null, this.$config.kd_auth_server + \"oauth\").oAuthLoginPage();\n    }\n\n  }\n};","map":{"version":3,"sources":["D:\\web_editor_hd\\src\\main\\webapp\\batch-edit\\src\\components\\search.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"search\">\r\n    <el-select\r\n      v-model=\"value\"\r\n      placeholder=\"请选择\"\r\n      filterable\r\n      :filter-method=\"dataFilter\"\r\n      @change=\"changeTask\"\r\n      no-data-text=\"无任务\"\r\n      no-match-text=\"无匹配任务\"\r\n    >\r\n      <el-option\r\n        v-for=\"item in searchTasks\"\r\n        :key=\"renderValue(item)\"\r\n        :label=\"renderLabel(item)\"\r\n        :value=\"renderValue(item)\"\r\n        :title=\"renderLabel(item)\"\r\n      >\r\n        <span v-html=\"renderLabel(item)\"></span>\r\n        <span\r\n          style=\"float: right; color: #8492a6; font-size: 13px\"\r\n          v-html=\"renderValue(item)\"\r\n        ></span>\r\n      </el-option>\r\n    </el-select>\r\n    <el-button\r\n      class=\"btn-cliam\"\r\n      type=\"primary\"\r\n      icon=\"el-icon-search\"\r\n      @click=\"cliam()\"\r\n      >领取</el-button\r\n    >\r\n    <el-button\r\n      class=\"btn-logout\"\r\n      type=\"primary\"\r\n      icon=\"el-icon-search\"\r\n      @click=\"logout()\"\r\n      >退出</el-button\r\n    >\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as sysApi from \"../services/sys\";\r\nimport * as userApi from \"../services/jquery.oauth2-client\";\r\nexport default {\r\n  name: \"search\",\r\n  data() {\r\n    return {\r\n      searchTasks: [],\r\n      tasks: [],\r\n      value: \"\",\r\n    };\r\n  },\r\n  mounted() {\r\n    this.findTasks();\r\n  },\r\n  methods: {\r\n    changeTask(val) {\r\n      this.$emit(\"refresh\", val);\r\n    },\r\n    dataFilter(val) {\r\n      if (val) {\r\n        //val存在\r\n        this.searchTasks = this.tasks.filter((item) => {\r\n          var label = this.renderLabel(item);\r\n          var value = this.renderLabel(item);\r\n          if (\r\n            !!~value.indexOf(val) ||\r\n            !!~value.toUpperCase().indexOf(val.toUpperCase()) ||\r\n            !!~label.indexOf(val) ||\r\n            !!~label.toUpperCase().indexOf(val.toUpperCase())\r\n          ) {\r\n            return true;\r\n          }\r\n        });\r\n      } else {\r\n        //val为空时，还原数组\r\n        this.searchTasks = this.tasks;\r\n      }\r\n    },\r\n    findTasks() {\r\n      var $this = this;\r\n      var $url =\r\n        $this.$config.kts +\r\n        \"runtime/tasks?includeProcessVariables=true&size=100&sort=createTime&order=desc&assignee=\" +\r\n        $this.$user.name;\r\n      sysApi\r\n        .getAsyncDatas({\r\n          url: $url,\r\n          data: {},\r\n        })\r\n        .then((res) => {\r\n          this.searchTasks = res.data;\r\n          this.tasks = res.data;\r\n        });\r\n    },\r\n    renderLabel(row) {\r\n      var variables = row.variables || [];\r\n      var taskName = variables.find((d) => {\r\n        return d.name == \"taskName\";\r\n      });\r\n      return taskName ? taskName.value : \" - \";\r\n    },\r\n    renderValue(row) {\r\n      var variables = row.variables || [];\r\n      var taskId = variables.find((d) => {\r\n        return d.name == \"taskId\";\r\n      });\r\n      return taskId ? taskId.value : \" - \";\r\n    },\r\n    cliam() {\r\n      var $this = this;\r\n      var $url = $this.$config.kts + \"task/claim?user=\" + $this.$user.name;\r\n      sysApi\r\n        .getAsyncDatas({\r\n          url: $url,\r\n          data: {},\r\n        })\r\n        .then((res) => {\r\n          if (res.code == \"0\" && res.result.length) {\r\n            $this.$notify({\r\n              title: \"成功\",\r\n              message: res.message,\r\n              type: \"success\",\r\n            });\r\n            $this.findTasks();\r\n          } else {\r\n            $this.$notify({\r\n              title: \"警告\",\r\n              message: res.message,\r\n              type: \"warning\",\r\n            });\r\n          }\r\n        });\r\n    },\r\n    save() {\r\n      console.log(\"保存\");\r\n    },\r\n    logout() {\r\n      userApi\r\n        .oauth2Client(null, this.$config.kd_auth_server + \"oauth\")\r\n        .oAuthLoginPage();\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\r\n<style scoped lang=\"scss\">\r\n.search {\r\n  width: calc(100% - 20px);\r\n  height: 40px;\r\n  float: left;\r\n  padding: 5px 10px;\r\n  background-color: #ffffff;\r\n  padding-bottom: 15px;\r\n  position: relative;\r\n  z-index: 4444;\r\n}\r\n.el-select__popper {\r\n  z-index: 4445 !important;\r\n}\r\n.search .el-select {\r\n  float: left;\r\n}\r\n.search button {\r\n  float: left;\r\n  padding: 0px 15px;\r\n}\r\n.search button.btn-cliam {\r\n  margin-left: 30px;\r\n}\r\n.search button.btn-logout {\r\n  float: right;\r\n}\r\n</style>\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}