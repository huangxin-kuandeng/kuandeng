{"ast":null,"code":"import footHeader from \"@/components/contentComponents/footFormHeader.vue\";\nimport * as sysApi from \"../services/sys\";\nimport * as util from \"../services/util\";\nexport default {\n  name: \"indexFooter\",\n  props: [],\n\n  data() {\n    return {\n      size: \"500px\",\n      table: false,\n      taskId: null,\n      exportData: [],\n      tableData: [],\n      editDatas: {},\n      tableDataChild: {}\n    };\n  },\n\n  mounted() {\n    this.queryQualityTag();\n  },\n\n  computed: {// tableRowType(row, rowIndex) {\n    //   return \"success\";\n    // },\n  },\n  methods: {\n    // 导出功能，暂时不可用\n    exports() {\n      let taskId = this.taskId;\n      let tag_state = {\n        2: \"误报\",\n        3: \"搁置\",\n        4: \"已修改\"\n      };\n      let tag_sources = [\"\", \"质检员\", \"验收员\", \"质量评估员\", \"基于资料的打标服务\", \"基于车道模型的打标服务\", \"逻辑检查项服务\", \"后自动化服务\", \"融合前单轨迹核线检查\", \"融合后单轨迹核线检查\", \"多轨迹核线检查\", \"静态激光点云真值评估\"];\n      let str1 = '<tr style=\"background-color:#f2f2f2;\"><td>任务ID</td><td>状态</td><td>错误类别</td><td>检查项编码</td><td>数据类型</td><td>问题描述</td><td>内容</td><td>标记类型</td><td>核标进度</td><td>标记来源</td><td>是否误报</td><td>坐标</td></tr>';\n\n      for (let s = 0; s < this.exportData.length; s++) {\n        let tag = this.exportData[s].tags || {},\n            tag_source = tag.TAG_SOURCE ? tag.TAG_SOURCE : \"0\",\n            tag_source_cn = tag_sources[tag_source] || \"\",\n            locs = this.exportData[s].locs || [],\n            locsStr = locs.join(\",\"),\n            state = tag.STATE && tag_state[tag.STATE] ? tag_state[tag.STATE] : \"\";\n\n        if (this.exportData[s].pid < 0) {\n          str1 += '<tr style=\"background-color:rgb(255, 255, 199);\">';\n        } else {\n          str1 += \"<tr>\";\n        }\n\n        str1 += `<td>${taskId + \"\\t\"}</td>`;\n        str1 += `<td>${state + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].errortype + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].checknum + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].datatype + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].question + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].checknum + this.exportData[s].question + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].tagsource + \"\\t\"}</td>`;\n        str1 += `<td STYLE='MSO-NUMBER-FORMAT:\\\\@'>${this.exportData[s].progress + \"\\t\"}</td>`;\n        str1 += `<td>${tag_source_cn + \"\\t\"}</td>`;\n        str1 += `<td>\\t</td>`;\n        str1 += `<td>${locsStr + \"\\t\"}</td>`;\n        str1 += \"</tr>\";\n      } //Worksheet名\n\n\n      let worksheet = \"Sheet1\";\n      let _uri = \"data:application/vnd.ms-excel;base64,\"; //下载的表格模板数据\n\n      let template = `<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" \n      \txmlns:x=\"urn:schemas-microsoft-com:office:excel\" \n      \txmlns=\"http://www.w3.org/TR/REC-html40\">\n      \t<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>\n        \t<x:Name>${worksheet}</x:Name>\n        \t<x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet>\n        \t</x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->\n        \t</head><body><table>${str1}</table></body></html>`; //下载模板\n\n      let base64 = window.btoa(unescape(encodeURIComponent(template)));\n      var a = document.createElement(\"a\");\n      a.download = taskId + \" -- 质量标记报表.xls\";\n      a.href = _uri + base64;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n    },\n\n    tableToggle(type) {\n      this.table = type;\n    },\n\n    tableRowClassName({\n      row\n    }) {\n      if (row.pid === -1) {\n        return \"warning-row\";\n      }\n\n      return \"\";\n    },\n\n    // 更新质检标记的属性\n    updateTagDatas(id, form, editId, modelName) {\n      if (!this.editDatas[id] || id.indexOf(\"_tag_\") > -1) {\n        this.editDatas[id] = {\n          id: id,\n          properties: {\n            TAG_SOURCE: \"1\",\n            FEATURE: modelName,\n            FEATURE_ID: editId,\n            TASK_ID: this.taskId\n          }\n        };\n      }\n\n      for (var name in form) {\n        this.editDatas[id].properties[name] = form[name];\n      }\n\n      for (var f_id in this.tableDataChild) {\n        var childs = this.tableDataChild[f_id];\n        var thisChild = childs.find(d => {\n          return d.entityId == id;\n        });\n\n        if (thisChild && form.STATE) {\n          thisChild.tags.STATE = form.STATE;\n        }\n      }\n    },\n\n    // 报表修改状态\n    changeStatus(row, state) {\n      row.status = state;\n\n      if (row.pid === -1) {\n        var child = this.tableDataChild[row.id] || [];\n        child.forEach(d => {\n          d.status = state;\n          this.updateTagDatas(d.entityId, {\n            STATE: state\n          });\n          this.$emit(\"tagDataUpdateState\", d.entityId, this.editDatas[d.entityId].properties);\n        });\n      } else {\n        this.updateTagDatas(row.entityId, {\n          STATE: state\n        });\n        this.$emit(\"tagDataUpdateState\", row.entityId, this.editDatas[row.entityId].properties);\n      }\n    },\n\n    // 保存报表所修改的数据\n    finishDatas() {\n      var $this = this;\n      var $url = $this.$config.kd_tag + \"tag/QUALITY_TAG/update\";\n      var edits = [];\n      var created = [];\n\n      for (var id in $this.editDatas) {\n        if (id.indexOf(\"_tag_\") > -1) {\n          created.push({\n            properties: $this.editDatas[id].properties\n          });\n        } else {\n          edits.push($this.editDatas[id]);\n        }\n      }\n\n      if (created.length) {\n        this.createQualitDatas(created, edits);\n      }\n\n      if (!edits.length && !created.length) {\n        $this.tableData = [];\n        $this.editDatas = {};\n        $this.tableDataChild = {};\n        return;\n      }\n\n      if (!edits.length) {\n        return;\n      }\n\n      sysApi.postAsyncDatas({\n        url: $url,\n        data: edits\n      }).then(res => {\n        if (res.code == \"0\" && res.result) {\n          $this.$notify({\n            title: \"质量标记修改\",\n            message: res.message,\n            type: \"success\"\n          });\n          $this.queryQualityTag($this.taskId);\n        } else {\n          $this.$notify({\n            title: \"质量标记修改\",\n            message: res.message,\n            type: \"warning\"\n          });\n        }\n      });\n    },\n\n    // 保存报表所修改的数据\n    createQualitDatas(create, edit) {\n      var $this = this;\n      var $url = $this.$config.kd_tag + \"tag/QUALITY_TAG/create\";\n      sysApi.postAsyncDatas({\n        url: $url,\n        data: create\n      }).then(res => {\n        if (res.code == \"0\") {\n          $this.$notify({\n            title: \"质量标记新增\",\n            message: res.message,\n            type: \"success\"\n          });\n\n          if (!edit.length) {\n            $this.queryQualityTag($this.taskId);\n          }\n        } else {\n          $this.$notify({\n            title: \"质量标记新增\",\n            message: res.message,\n            type: \"warning\"\n          });\n        }\n      });\n    },\n\n    // 报表加载子集\n    loadChildren(tree, treeNode, resolve) {\n      setTimeout(() => {\n        resolve(this.tableDataChild[tree.id]);\n      }, 500);\n    },\n\n    // 加载任务的质检标记\n    queryQualityTag(id) {\n      var $this = this;\n      $this.tableData = [];\n      $this.exportData = [];\n      $this.editDatas = {};\n      $this.tableDataChild = {};\n\n      if (!id) {\n        return;\n      }\n\n      $this.taskId = id;\n      var temp1 = [{\n        k: \"TASK_ID\",\n        op: \"eq\",\n        v: id\n      }];\n      var $url = $this.$config.kd_tag + \"tag/osm/QUALITY_TAG/query?tagsJson=\" + encodeURIComponent(JSON.stringify(temp1));\n      sysApi.getAsyncDatas({\n        url: $url\n      }).then(res => {\n        var model = $this.$tags[\"QUALITY_TAG\"] || {};\n        var modelEntity = model.fields || [];\n        var errorType = $this.$_.filter(modelEntity, {\n          fieldName: \"ERROR_TYPE\"\n        })[0];\n        var types = errorType.fieldType.fieldTypeValues;\n        var tagSource = $this.$_.filter(modelEntity, {\n          fieldName: \"TAG_SOURCE\"\n        })[0];\n        var source = tagSource.fieldType.fieldTypeValues;\n        var nodes = res.result && res.result.node || [];\n        var newDatas = {};\n        nodes.forEach(function (entity) {\n          let tags = util.formatTags(entity.tag);\n          entity.cloneTag = tags;\n          let ERROR_TYPE = tags.ERROR_TYPE;\n          let FEATURE = tags.FEATURE;\n          let CHECK_ITEM_ID = tags.CHECK_ITEM_ID;\n          let type = $this.$_.filter(types, {\n            value: ERROR_TYPE\n          })[0];\n          let type_name = type && type.name ? type.name : \"\";\n          var obj = {\n            id: \"\",\n            state: \"xx\",\n            children: [],\n            errortype: type_name,\n            checknum: \"\",\n            datatype: \"\",\n            question: \"\",\n            tagsource: \"\",\n            progress: \"\",\n            pid: -1,\n            hasChildren: false,\n            status: 0\n          }; //数据分类\n\n          if (ERROR_TYPE == \"0\") {\n            if (!newDatas[CHECK_ITEM_ID + \"-\" + FEATURE]) {\n              newDatas[CHECK_ITEM_ID + \"-\" + FEATURE] = obj;\n              newDatas[CHECK_ITEM_ID + \"-\" + FEATURE].datatype = FEATURE;\n              newDatas[CHECK_ITEM_ID + \"-\" + FEATURE].datas = [];\n            }\n\n            newDatas[CHECK_ITEM_ID + \"-\" + FEATURE].datas.push(entity);\n          } else {\n            // if (ERROR_TYPE && FEATURE) {\n            if (!newDatas[ERROR_TYPE + \"-\" + FEATURE]) {\n              newDatas[ERROR_TYPE + \"-\" + FEATURE] = obj;\n              newDatas[ERROR_TYPE + \"-\" + FEATURE].datatype = FEATURE;\n              newDatas[ERROR_TYPE + \"-\" + FEATURE].datas = [];\n            }\n\n            newDatas[ERROR_TYPE + \"-\" + FEATURE].datas.push(entity);\n          }\n        });\n        $this.$emit(\"tagDataChange\", nodes);\n        var num = 1;\n        var results = [];\n\n        for (let i in newDatas) {\n          let item = newDatas[i];\n          item.id = num;\n          let data = $this.$_.clone(item.datas);\n          delete item.datas;\n          var subResult = [],\n              progress = 0;\n          data.forEach(function (d) {\n            let tags = util.formatTags(d.tag);\n            num++;\n            let tagSource = $this.$_.filter(source, {\n              value: tags.TAG_SOURCE\n            })[0] || {};\n            let tagSourceName = tagSource.name;\n\n            if (tagSource.value == \"4\" || tagSource.value == \"5\" || tagSource.value == \"6\" || tagSource.value == \"7\") {\n              tagSourceName = \"作业标\";\n            }\n\n            let locs = [d.lon, d.lat, d.z];\n            let subObj = {\n              id: num,\n              state: d.id,\n              errortype: \"\",\n              children: [],\n              tags: tags,\n              checknum: tags.CHECK_ITEM_ID || \"\",\n              datatype: item.datatype,\n              question: tags.DESC,\n              tagsource: tagSourceName || \"\",\n              progress: \"\",\n              pid: item.id,\n              entityId: d.id,\n              changed: false,\n              misstate: false,\n              shelve: false,\n              locs: locs,\n              status: tags.STATE || 0\n            };\n\n            if (tags.STATE == \"0\" || tags.STATE == \"1\") {\n              subResult.unshift(subObj);\n            } else {\n              progress += 1;\n              subResult.push(subObj);\n            }\n          });\n          item.progress = progress + \"/\" + data.length;\n\n          if (data.length) {\n            item.hasChildren = true;\n            $this.tableDataChild[item.id] = subResult;\n            $this.exportData.push(item);\n            $this.exportData.push(...subResult);\n            results.push(item);\n          }\n\n          num++;\n        }\n\n        $this.tableData = results;\n      });\n    },\n\n    drawerOpened() {\n      this.$emit(\"drawerOpened\");\n    },\n\n    drawerClose() {\n      this.$emit(\"drawerClose\");\n    }\n\n  },\n  components: {\n    footHeader\n  }\n};","map":{"version":3,"sources":["D:\\web_editor_hd\\src\\main\\webapp\\batch-edit\\src\\components\\footerForm.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"indexFooter\">\n    <footHeader @tableToggle=\"tableToggle\" :hideHeader=\"true\" />\n    <el-drawer\n      ref=\"drawer\"\n      title=\"\"\n      v-model=\"table\"\n      direction=\"btt\"\n      size=\"size\"\n      :modal=\"false\"\n      :close-on-press-escape=\"false\"\n      :with-header=\"false\"\n      @opened=\"drawerOpened()\"\n      @close=\"drawerClose()\"\n    >\n      <footHeader @tableToggle=\"tableToggle\" :hideHeader=\"false\" />\n      <el-button\n        class=\"export\"\n        type=\"default\"\n        icon=\"el-icon-upload2\"\n        title=\"导出\"\n        @click=\"exports()\"\n        >导出</el-button\n      >\n      <el-table\n        :data=\"tableData\"\n        id=\"out-table\"\n        style=\"width: 100%; margin-bottom: 20px\"\n        row-key=\"id\"\n        border\n        lazy\n        highlight-current-row\n        :load=\"loadChildren\"\n        :row-class-name=\"tableRowClassName\"\n        empty-text=\" - \"\n        max-height=\"400\"\n        :tree-props=\"{ children: 'children', hasChildren: 'hasChildren' }\"\n      >\n        <el-table-column fixed=\"left\" label=\"状态\" width=\"120\" type=\"\">\n          <template #default=\"scope\">\n            <el-button\n              icon=\"el-icon-check\"\n              :type=\"scope.row.status == '4' ? 'success' : 'info'\"\n              @click=\"changeStatus(scope.row, '4')\"\n              size=\"mini\"\n              title=\"已修改\"\n              circle\n            ></el-button>\n            <el-button\n              icon=\"el-icon-close\"\n              :type=\"scope.row.status == '2' ? 'success' : 'info'\"\n              @click=\"changeStatus(scope.row, '2')\"\n              size=\"mini\"\n              title=\"误报\"\n              circle\n            ></el-button>\n            <el-button\n              icon=\"el-icon-right\"\n              :type=\"scope.row.status == '3' ? 'success' : 'info'\"\n              @click=\"changeStatus(scope.row, '3')\"\n              size=\"mini\"\n              title=\"搁置\"\n              circle\n            ></el-button>\n          </template>\n        </el-table-column>\n        <el-table-column\n          prop=\"errortype\"\n          label=\"错误类别\"\n          width=\"180\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"checknum\"\n          label=\"检查项编码\"\n          width=\"180\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"datatype\"\n          label=\"数据类型\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"question\"\n          label=\"问题描述\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"tagsource\"\n          label=\"标记类型\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"progress\"\n          label=\"核标进度\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column label=\"操作\" width=\"100\"></el-table-column>\n      </el-table>\n    </el-drawer>\n  </div>\n</template>\n\n<script>\nimport footHeader from \"@/components/contentComponents/footFormHeader.vue\";\nimport * as sysApi from \"../services/sys\";\nimport * as util from \"../services/util\";\nexport default {\n  name: \"indexFooter\",\n  props: [],\n  data() {\n    return {\n      size: \"500px\",\n      table: false,\n      taskId: null,\n      exportData: [],\n      tableData: [],\n      editDatas: {},\n      tableDataChild: {},\n    };\n  },\n  mounted() {\n    this.queryQualityTag();\n  },\n  computed: {\n    // tableRowType(row, rowIndex) {\n    //   return \"success\";\n    // },\n  },\n  methods: {\n    // 导出功能，暂时不可用\n    exports() {\n      let taskId = this.taskId;\n      let tag_state = { 2: \"误报\", 3: \"搁置\", 4: \"已修改\" };\n      let tag_sources = [\n        \"\",\n        \"质检员\",\n        \"验收员\",\n        \"质量评估员\",\n        \"基于资料的打标服务\",\n        \"基于车道模型的打标服务\",\n        \"逻辑检查项服务\",\n        \"后自动化服务\",\n        \"融合前单轨迹核线检查\",\n        \"融合后单轨迹核线检查\",\n        \"多轨迹核线检查\",\n        \"静态激光点云真值评估\",\n      ];\n      let str1 =\n        '<tr style=\"background-color:#f2f2f2;\"><td>任务ID</td><td>状态</td><td>错误类别</td><td>检查项编码</td><td>数据类型</td><td>问题描述</td><td>内容</td><td>标记类型</td><td>核标进度</td><td>标记来源</td><td>是否误报</td><td>坐标</td></tr>';\n      for (let s = 0; s < this.exportData.length; s++) {\n        let tag = this.exportData[s].tags || {},\n          tag_source = tag.TAG_SOURCE ? tag.TAG_SOURCE : \"0\",\n          tag_source_cn = tag_sources[tag_source] || \"\",\n          locs = this.exportData[s].locs || [],\n          locsStr = locs.join(\",\"),\n          state = tag.STATE && tag_state[tag.STATE] ? tag_state[tag.STATE] : \"\";\n\n        if (this.exportData[s].pid < 0) {\n          str1 += '<tr style=\"background-color:rgb(255, 255, 199);\">';\n        } else {\n          str1 += \"<tr>\";\n        }\n\n        str1 += `<td>${taskId + \"\\t\"}</td>`;\n        str1 += `<td>${state + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].errortype + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].checknum + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].datatype + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].question + \"\\t\"}</td>`;\n        str1 += `<td>${\n          this.exportData[s].checknum + this.exportData[s].question + \"\\t\"\n        }</td>`;\n        str1 += `<td>${this.exportData[s].tagsource + \"\\t\"}</td>`;\n        str1 += `<td STYLE='MSO-NUMBER-FORMAT:\\\\@'>${\n          this.exportData[s].progress + \"\\t\"\n        }</td>`;\n        str1 += `<td>${tag_source_cn + \"\\t\"}</td>`;\n        str1 += `<td>\\t</td>`;\n        str1 += `<td>${locsStr + \"\\t\"}</td>`;\n\n        str1 += \"</tr>\";\n      }\n      //Worksheet名\n      let worksheet = \"Sheet1\";\n      let _uri = \"data:application/vnd.ms-excel;base64,\";\n\n      //下载的表格模板数据\n      let template = `<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" \n      \txmlns:x=\"urn:schemas-microsoft-com:office:excel\" \n      \txmlns=\"http://www.w3.org/TR/REC-html40\">\n      \t<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>\n        \t<x:Name>${worksheet}</x:Name>\n        \t<x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet>\n        \t</x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->\n        \t</head><body><table>${str1}</table></body></html>`;\n\n      //下载模板\n      let base64 = window.btoa(unescape(encodeURIComponent(template)));\n\n      var a = document.createElement(\"a\");\n      a.download = taskId + \" -- 质量标记报表.xls\";\n      a.href = _uri + base64;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n    },\n    tableToggle(type) {\n      this.table = type;\n    },\n    tableRowClassName({ row }) {\n      if (row.pid === -1) {\n        return \"warning-row\";\n      }\n      return \"\";\n    },\n    // 更新质检标记的属性\n    updateTagDatas(id, form, editId, modelName) {\n      if (!this.editDatas[id] || id.indexOf(\"_tag_\") > -1) {\n        this.editDatas[id] = {\n          id: id,\n          properties: {\n            TAG_SOURCE: \"1\",\n            FEATURE: modelName,\n            FEATURE_ID: editId,\n            TASK_ID: this.taskId,\n          },\n        };\n      }\n      for (var name in form) {\n        this.editDatas[id].properties[name] = form[name];\n      }\n      for (var f_id in this.tableDataChild) {\n        var childs = this.tableDataChild[f_id];\n        var thisChild = childs.find((d) => {\n          return d.entityId == id;\n        });\n        if (thisChild && form.STATE) {\n          thisChild.tags.STATE = form.STATE;\n        }\n      }\n    },\n    // 报表修改状态\n    changeStatus(row, state) {\n      row.status = state;\n      if (row.pid === -1) {\n        var child = this.tableDataChild[row.id] || [];\n        child.forEach((d) => {\n          d.status = state;\n          this.updateTagDatas(d.entityId, { STATE: state });\n          this.$emit(\n            \"tagDataUpdateState\",\n            d.entityId,\n            this.editDatas[d.entityId].properties\n          );\n        });\n      } else {\n        this.updateTagDatas(row.entityId, { STATE: state });\n        this.$emit(\n          \"tagDataUpdateState\",\n          row.entityId,\n          this.editDatas[row.entityId].properties\n        );\n      }\n    },\n    // 保存报表所修改的数据\n    finishDatas() {\n      var $this = this;\n      var $url = $this.$config.kd_tag + \"tag/QUALITY_TAG/update\";\n      var edits = [];\n      var created = [];\n      for (var id in $this.editDatas) {\n        if (id.indexOf(\"_tag_\") > -1) {\n          created.push({\n            properties: $this.editDatas[id].properties,\n          });\n        } else {\n          edits.push($this.editDatas[id]);\n        }\n      }\n      if (created.length) {\n        this.createQualitDatas(created, edits);\n      }\n      if (!edits.length && !created.length) {\n        $this.tableData = [];\n        $this.editDatas = {};\n        $this.tableDataChild = {};\n        return;\n      }\n      if (!edits.length) {\n        return;\n      }\n      sysApi\n        .postAsyncDatas({\n          url: $url,\n          data: edits,\n        })\n        .then((res) => {\n          if (res.code == \"0\" && res.result) {\n            $this.$notify({\n              title: \"质量标记修改\",\n              message: res.message,\n              type: \"success\",\n            });\n            $this.queryQualityTag($this.taskId);\n          } else {\n            $this.$notify({\n              title: \"质量标记修改\",\n              message: res.message,\n              type: \"warning\",\n            });\n          }\n        });\n    },\n    // 保存报表所修改的数据\n    createQualitDatas(create, edit) {\n      var $this = this;\n      var $url = $this.$config.kd_tag + \"tag/QUALITY_TAG/create\";\n      sysApi\n        .postAsyncDatas({\n          url: $url,\n          data: create,\n        })\n        .then((res) => {\n          if (res.code == \"0\") {\n            $this.$notify({\n              title: \"质量标记新增\",\n              message: res.message,\n              type: \"success\",\n            });\n            if (!edit.length) {\n              $this.queryQualityTag($this.taskId);\n            }\n          } else {\n            $this.$notify({\n              title: \"质量标记新增\",\n              message: res.message,\n              type: \"warning\",\n            });\n          }\n        });\n    },\n    // 报表加载子集\n    loadChildren(tree, treeNode, resolve) {\n      setTimeout(() => {\n        resolve(this.tableDataChild[tree.id]);\n      }, 500);\n    },\n    // 加载任务的质检标记\n    queryQualityTag(id) {\n      var $this = this;\n      $this.tableData = [];\n      $this.exportData = [];\n      $this.editDatas = {};\n      $this.tableDataChild = {};\n      if (!id) {\n        return;\n      }\n      $this.taskId = id;\n      var temp1 = [{ k: \"TASK_ID\", op: \"eq\", v: id }];\n      var $url =\n        $this.$config.kd_tag +\n        \"tag/osm/QUALITY_TAG/query?tagsJson=\" +\n        encodeURIComponent(JSON.stringify(temp1));\n      sysApi\n        .getAsyncDatas({\n          url: $url,\n        })\n        .then((res) => {\n          var model = $this.$tags[\"QUALITY_TAG\"] || {};\n          var modelEntity = model.fields || [];\n          var errorType = $this.$_.filter(modelEntity, {\n            fieldName: \"ERROR_TYPE\",\n          })[0];\n          var types = errorType.fieldType.fieldTypeValues;\n          var tagSource = $this.$_.filter(modelEntity, {\n            fieldName: \"TAG_SOURCE\",\n          })[0];\n          var source = tagSource.fieldType.fieldTypeValues;\n          var nodes = (res.result && res.result.node) || [];\n          var newDatas = {};\n          nodes.forEach(function (entity) {\n            let tags = util.formatTags(entity.tag);\n            entity.cloneTag = tags;\n            let ERROR_TYPE = tags.ERROR_TYPE;\n            let FEATURE = tags.FEATURE;\n            let CHECK_ITEM_ID = tags.CHECK_ITEM_ID;\n            let type = $this.$_.filter(types, { value: ERROR_TYPE })[0];\n            let type_name = type && type.name ? type.name : \"\";\n            var obj = {\n              id: \"\",\n              state: \"xx\",\n              children: [],\n              errortype: type_name,\n              checknum: \"\",\n              datatype: \"\",\n              question: \"\",\n              tagsource: \"\",\n              progress: \"\",\n              pid: -1,\n              hasChildren: false,\n              status: 0,\n            };\n            //数据分类\n            if (ERROR_TYPE == \"0\") {\n              if (!newDatas[CHECK_ITEM_ID + \"-\" + FEATURE]) {\n                newDatas[CHECK_ITEM_ID + \"-\" + FEATURE] = obj;\n                newDatas[CHECK_ITEM_ID + \"-\" + FEATURE].datatype = FEATURE;\n                newDatas[CHECK_ITEM_ID + \"-\" + FEATURE].datas = [];\n              }\n              newDatas[CHECK_ITEM_ID + \"-\" + FEATURE].datas.push(entity);\n            } else {\n              // if (ERROR_TYPE && FEATURE) {\n              if (!newDatas[ERROR_TYPE + \"-\" + FEATURE]) {\n                newDatas[ERROR_TYPE + \"-\" + FEATURE] = obj;\n                newDatas[ERROR_TYPE + \"-\" + FEATURE].datatype = FEATURE;\n                newDatas[ERROR_TYPE + \"-\" + FEATURE].datas = [];\n              }\n              newDatas[ERROR_TYPE + \"-\" + FEATURE].datas.push(entity);\n            }\n          });\n          $this.$emit(\"tagDataChange\", nodes);\n\n          var num = 1;\n          var results = [];\n          for (let i in newDatas) {\n            let item = newDatas[i];\n            item.id = num;\n            let data = $this.$_.clone(item.datas);\n            delete item.datas;\n            var subResult = [],\n              progress = 0;\n            data.forEach(function (d) {\n              let tags = util.formatTags(d.tag);\n              num++;\n              let tagSource =\n                $this.$_.filter(source, { value: tags.TAG_SOURCE })[0] || {};\n              let tagSourceName = tagSource.name;\n              if (\n                tagSource.value == \"4\" ||\n                tagSource.value == \"5\" ||\n                tagSource.value == \"6\" ||\n                tagSource.value == \"7\"\n              ) {\n                tagSourceName = \"作业标\";\n              }\n              let locs = [d.lon, d.lat, d.z];\n              let subObj = {\n                id: num,\n                state: d.id,\n                errortype: \"\",\n                children: [],\n                tags: tags,\n                checknum: tags.CHECK_ITEM_ID || \"\",\n                datatype: item.datatype,\n                question: tags.DESC,\n                tagsource: tagSourceName || \"\",\n                progress: \"\",\n                pid: item.id,\n                entityId: d.id,\n                changed: false,\n                misstate: false,\n                shelve: false,\n                locs: locs,\n                status: tags.STATE || 0,\n              };\n              if (tags.STATE == \"0\" || tags.STATE == \"1\") {\n                subResult.unshift(subObj);\n              } else {\n                progress += 1;\n                subResult.push(subObj);\n              }\n            });\n            item.progress = progress + \"/\" + data.length;\n            if (data.length) {\n              item.hasChildren = true;\n              $this.tableDataChild[item.id] = subResult;\n              $this.exportData.push(item);\n              $this.exportData.push(...subResult);\n              results.push(item);\n            }\n            num++;\n          }\n          $this.tableData = results;\n        });\n    },\n    drawerOpened() {\n      this.$emit(\"drawerOpened\");\n    },\n    drawerClose() {\n      this.$emit(\"drawerClose\");\n    },\n  },\n  components: {\n    footHeader,\n  },\n};\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style lang=\"scss\">\n.indexFooter {\n  float: left;\n  position: absolute;\n  bottom: 0px;\n  z-index: 100;\n  height: 20px;\n  width: calc(100% - 10px);\n  padding: 0px 5px;\n}\n.indexFooter .el-table .warning-row {\n  background: rgb(255, 255, 199);\n}\n.indexFooter .el-table td,\n.indexFooter .el-table th {\n  padding: 6px 0;\n}\n.indexFooter .el-table .el-button {\n  padding: 0px;\n  min-height: 10px;\n}\n.indexFooter button.export {\n  position: absolute;\n  right: 15px;\n  top: 10px;\n}\n.indexFooter .el-drawer {\n  overflow: initial;\n  height: 500px;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}