{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"indexFooter\"\n};\n\nconst _hoisted_2 = /*#__PURE__*/_createTextVNode(\"导出\");\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_footHeader = _resolveComponent(\"footHeader\");\n\n  const _component_el_button = _resolveComponent(\"el-button\");\n\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n\n  const _component_el_table = _resolveComponent(\"el-table\");\n\n  const _component_el_drawer = _resolveComponent(\"el-drawer\");\n\n  return _openBlock(), _createBlock(\"div\", _hoisted_1, [_createVNode(_component_footHeader, {\n    onTableToggle: $options.tableToggle,\n    hideHeader: true\n  }, null, 8\n  /* PROPS */\n  , [\"onTableToggle\"]), _createVNode(_component_el_drawer, {\n    ref: \"drawer\",\n    title: \"\",\n    modelValue: $data.table,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.table = $event),\n    direction: \"btt\",\n    size: \"size\",\n    modal: false,\n    \"close-on-press-escape\": false,\n    \"with-header\": false,\n    onOpened: _cache[3] || (_cache[3] = $event => $options.drawerOpened()),\n    onClose: _cache[4] || (_cache[4] = $event => $options.drawerClose())\n  }, {\n    default: _withCtx(() => [_createVNode(_component_footHeader, {\n      onTableToggle: $options.tableToggle,\n      hideHeader: false\n    }, null, 8\n    /* PROPS */\n    , [\"onTableToggle\"]), _createVNode(_component_el_button, {\n      class: \"export\",\n      type: \"default\",\n      icon: \"el-icon-upload2\",\n      title: \"导出\",\n      onClick: _cache[1] || (_cache[1] = $event => $options.exports())\n    }, {\n      default: _withCtx(() => [_hoisted_2]),\n      _: 1\n      /* STABLE */\n\n    }), _createVNode(_component_el_table, {\n      data: $data.tableData,\n      id: \"out-table\",\n      style: {\n        \"width\": \"100%\",\n        \"margin-bottom\": \"20px\"\n      },\n      \"row-key\": \"id\",\n      border: \"\",\n      lazy: \"\",\n      \"highlight-current-row\": \"\",\n      onCurrentChange: $options.handleCurrentChange,\n      load: $options.loadChildren,\n      \"row-class-name\": $options.tableRowClassName,\n      \"empty-text\": \" - \",\n      \"max-height\": \"400\",\n      \"tree-props\": {\n        children: 'children',\n        hasChildren: 'hasChildren'\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_table_column, {\n        fixed: \"left\",\n        label: \"状态\",\n        width: \"120\",\n        type: \"\"\n      }, {\n        default: _withCtx(scope => [_createVNode(_component_el_button, {\n          icon: \"el-icon-check\",\n          type: scope.row.status == '4' ? 'success' : 'info',\n          onClick: $event => $options.changeStatus(scope.row, '4'),\n          size: \"mini\",\n          title: \"已修改\",\n          circle: \"\"\n        }, null, 8\n        /* PROPS */\n        , [\"type\", \"onClick\"]), _createVNode(_component_el_button, {\n          icon: \"el-icon-close\",\n          type: scope.row.status == '2' ? 'success' : 'info',\n          onClick: $event => $options.changeStatus(scope.row, '2'),\n          size: \"mini\",\n          title: \"误报\",\n          circle: \"\"\n        }, null, 8\n        /* PROPS */\n        , [\"type\", \"onClick\"]), _createVNode(_component_el_button, {\n          icon: \"el-icon-right\",\n          type: scope.row.status == '3' ? 'success' : 'info',\n          onClick: $event => $options.changeStatus(scope.row, '3'),\n          size: \"mini\",\n          title: \"搁置\",\n          circle: \"\"\n        }, null, 8\n        /* PROPS */\n        , [\"type\", \"onClick\"])]),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_table_column, {\n        prop: \"errortype\",\n        label: \"错误类别\",\n        width: \"180\",\n        type: \"\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"checknum\",\n        label: \"检查项编码\",\n        width: \"180\",\n        type: \"\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"datatype\",\n        label: \"数据类型\",\n        type: \"\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"question\",\n        label: \"问题描述\",\n        type: \"\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"tagsource\",\n        label: \"标记类型\",\n        type: \"\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"progress\",\n        label: \"核标进度\",\n        type: \"\"\n      }), _createVNode(_component_el_table_column, {\n        label: \"操作\",\n        width: \"100\"\n      })]),\n      _: 1\n      /* STABLE */\n\n    }, 8\n    /* PROPS */\n    , [\"data\", \"onCurrentChange\", \"load\", \"row-class-name\"])]),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"modelValue\"])]);\n}","map":{"version":3,"sources":["D:\\web_editor_hd\\src\\main\\webapp\\batch-edit\\src\\components\\footerForm.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"indexFooter\">\n    <footHeader @tableToggle=\"tableToggle\" :hideHeader=\"true\" />\n    <el-drawer\n      ref=\"drawer\"\n      title=\"\"\n      v-model=\"table\"\n      direction=\"btt\"\n      size=\"size\"\n      :modal=\"false\"\n      :close-on-press-escape=\"false\"\n      :with-header=\"false\"\n      @opened=\"drawerOpened()\"\n      @close=\"drawerClose()\"\n    >\n      <footHeader @tableToggle=\"tableToggle\" :hideHeader=\"false\" />\n      <el-button\n        class=\"export\"\n        type=\"default\"\n        icon=\"el-icon-upload2\"\n        title=\"导出\"\n        @click=\"exports()\"\n        >导出</el-button\n      >\n      <el-table\n        :data=\"tableData\"\n        id=\"out-table\"\n        style=\"width: 100%; margin-bottom: 20px\"\n        row-key=\"id\"\n        border\n        lazy\n        highlight-current-row\n        @current-change=\"handleCurrentChange\"\n        :load=\"loadChildren\"\n        :row-class-name=\"tableRowClassName\"\n        empty-text=\" - \"\n        max-height=\"400\"\n        :tree-props=\"{ children: 'children', hasChildren: 'hasChildren' }\"\n      >\n        <el-table-column fixed=\"left\" label=\"状态\" width=\"120\" type=\"\">\n          <template #default=\"scope\">\n            <el-button\n              icon=\"el-icon-check\"\n              :type=\"scope.row.status == '4' ? 'success' : 'info'\"\n              @click=\"changeStatus(scope.row, '4')\"\n              size=\"mini\"\n              title=\"已修改\"\n              circle\n            ></el-button>\n            <el-button\n              icon=\"el-icon-close\"\n              :type=\"scope.row.status == '2' ? 'success' : 'info'\"\n              @click=\"changeStatus(scope.row, '2')\"\n              size=\"mini\"\n              title=\"误报\"\n              circle\n            ></el-button>\n            <el-button\n              icon=\"el-icon-right\"\n              :type=\"scope.row.status == '3' ? 'success' : 'info'\"\n              @click=\"changeStatus(scope.row, '3')\"\n              size=\"mini\"\n              title=\"搁置\"\n              circle\n            ></el-button>\n          </template>\n        </el-table-column>\n        <el-table-column\n          prop=\"errortype\"\n          label=\"错误类别\"\n          width=\"180\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"checknum\"\n          label=\"检查项编码\"\n          width=\"180\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"datatype\"\n          label=\"数据类型\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"question\"\n          label=\"问题描述\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"tagsource\"\n          label=\"标记类型\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column\n          prop=\"progress\"\n          label=\"核标进度\"\n          type=\"\"\n        ></el-table-column>\n        <el-table-column label=\"操作\" width=\"100\"></el-table-column>\n      </el-table>\n    </el-drawer>\n  </div>\n</template>\n\n<script>\nimport footHeader from \"@/components/contentComponents/footFormHeader.vue\";\nimport * as sysApi from \"../services/sys\";\nimport * as util from \"../services/util\";\nexport default {\n  name: \"indexFooter\",\n  props: [],\n  data() {\n    return {\n      size: \"500px\",\n      table: false,\n      taskId: null,\n      exportData: [],\n      tableData: [],\n      editDatas: {},\n      tableDataChild: {},\n    };\n  },\n  mounted() {\n    this.queryQualityTag();\n  },\n  computed: {\n    // tableRowType(row, rowIndex) {\n    //   return \"success\";\n    // },\n  },\n  methods: {\n    // 导出功能，暂时不可用\n    exports() {\n      let taskId = this.taskId;\n      let tag_state = { 2: \"误报\", 3: \"搁置\", 4: \"已修改\" };\n      let tag_sources = [\n        \"\",\n        \"质检员\",\n        \"验收员\",\n        \"质量评估员\",\n        \"基于资料的打标服务\",\n        \"基于车道模型的打标服务\",\n        \"逻辑检查项服务\",\n        \"后自动化服务\",\n        \"融合前单轨迹核线检查\",\n        \"融合后单轨迹核线检查\",\n        \"多轨迹核线检查\",\n        \"静态激光点云真值评估\",\n      ];\n      let str1 =\n        '<tr style=\"background-color:#f2f2f2;\"><td>任务ID</td><td>状态</td><td>错误类别</td><td>检查项编码</td><td>数据类型</td><td>问题描述</td><td>内容</td><td>标记类型</td><td>核标进度</td><td>标记来源</td><td>是否误报</td><td>坐标</td></tr>';\n      for (let s = 0; s < this.exportData.length; s++) {\n        let tag = this.exportData[s].tags || {},\n          tag_source = tag.TAG_SOURCE ? tag.TAG_SOURCE : \"0\",\n          tag_source_cn = tag_sources[tag_source] || \"\",\n          locs = this.exportData[s].locs || [],\n          locsStr = locs.join(\",\"),\n          state = tag.STATE && tag_state[tag.STATE] ? tag_state[tag.STATE] : \"\";\n\n        if (this.exportData[s].pid < 0) {\n          str1 += '<tr style=\"background-color:rgb(255, 255, 199);\">';\n        } else {\n          str1 += \"<tr>\";\n        }\n\n        str1 += `<td>${taskId + \"\\t\"}</td>`;\n        str1 += `<td>${state + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].errortype + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].checknum + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].datatype + \"\\t\"}</td>`;\n        str1 += `<td>${this.exportData[s].question + \"\\t\"}</td>`;\n        str1 += `<td>${\n          this.exportData[s].checknum + this.exportData[s].question + \"\\t\"\n        }</td>`;\n        str1 += `<td>${this.exportData[s].tagsource + \"\\t\"}</td>`;\n        str1 += `<td STYLE='MSO-NUMBER-FORMAT:\\\\@'>${\n          this.exportData[s].progress + \"\\t\"\n        }</td>`;\n        str1 += `<td>${tag_source_cn + \"\\t\"}</td>`;\n        str1 += `<td>\\t</td>`;\n        str1 += `<td>${locsStr + \"\\t\"}</td>`;\n\n        str1 += \"</tr>\";\n      }\n      //Worksheet名\n      let worksheet = \"Sheet1\";\n      let _uri = \"data:application/vnd.ms-excel;base64,\";\n\n      //下载的表格模板数据\n      let template = `<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" \n      \txmlns:x=\"urn:schemas-microsoft-com:office:excel\" \n      \txmlns=\"http://www.w3.org/TR/REC-html40\">\n      \t<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>\n        \t<x:Name>${worksheet}</x:Name>\n        \t<x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet>\n        \t</x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->\n        \t</head><body><table>${str1}</table></body></html>`;\n\n      //下载模板\n      let base64 = window.btoa(unescape(encodeURIComponent(template)));\n\n      var a = document.createElement(\"a\");\n      a.download = taskId + \" -- 质量标记报表.xls\";\n      a.href = _uri + base64;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n    },\n    tableToggle(type) {\n      this.table = type;\n    },\n    tableRowClassName({ row }) {\n      if (row.pid === -1) {\n        return \"warning-row\";\n      }\n      return \"\";\n    },\n    // 表格列点击\n    handleCurrentChange(row) {\n      this.$emit(\"contentPageChange\", row);\n    },\n    // 更新质检标记的属性\n    updateTagDatas(id, form, editId, modelName) {\n      if (!this.editDatas[id] || id.indexOf(\"_tag_\") > -1) {\n        this.editDatas[id] = {\n          id: id,\n          properties: {\n            TAG_SOURCE: \"1\",\n            TASK_DEFINITION_KEY: window.currentTask.taskDefinitionKey,\n            FEATURE: modelName,\n            FEATURE_ID: editId,\n            TASK_ID: this.taskId,\n          },\n        };\n      }\n      for (var name in form) {\n        this.editDatas[id].properties[name] = form[name];\n      }\n      for (var f_id in this.tableDataChild) {\n        var childs = this.tableDataChild[f_id];\n        var thisChild = childs.find((d) => {\n          return d.entityId == id;\n        });\n        if (thisChild && form.STATE) {\n          thisChild.tags.STATE = form.STATE;\n        }\n      }\n    },\n    // 报表修改状态\n    changeStatus(row, state) {\n      row.status = state;\n      if (row.pid === -1) {\n        var child = this.tableDataChild[row.id] || [];\n        child.forEach((d) => {\n          d.status = state;\n          this.updateTagDatas(d.entityId, { STATE: state });\n          this.$emit(\n            \"tagDataUpdateState\",\n            d.entityId,\n            this.editDatas[d.entityId].properties\n          );\n        });\n      } else {\n        this.updateTagDatas(row.entityId, { STATE: state });\n        this.$emit(\n          \"tagDataUpdateState\",\n          row.entityId,\n          this.editDatas[row.entityId].properties\n        );\n      }\n    },\n    // 保存报表所修改的数据\n    finishDatas() {\n      var $this = this;\n      var $url = $this.$config.kd_tag + \"tag/QUALITY_TAG/update\";\n      var edits = [];\n      var created = [];\n      for (var id in $this.editDatas) {\n        if (id.indexOf(\"_tag_\") > -1) {\n          created.push({\n            properties: $this.editDatas[id].properties,\n          });\n        } else {\n          edits.push($this.editDatas[id]);\n        }\n      }\n      if (created.length) {\n        this.createQualitDatas(created, edits);\n      }\n      if (!edits.length && !created.length) {\n        $this.tableData = [];\n        $this.editDatas = {};\n        $this.tableDataChild = {};\n        return;\n      }\n      if (!edits.length) {\n        return;\n      }\n      sysApi\n        .postAsyncDatas({\n          url: $url,\n          data: edits,\n        })\n        .then((res) => {\n          if (res.code == \"0\" && res.result) {\n            $this.$notify({\n              title: \"质量标记修改\",\n              message: res.message,\n              type: \"success\",\n            });\n            $this.queryQualityTag($this.taskId);\n          } else {\n            $this.$notify({\n              title: \"质量标记修改\",\n              message: res.message,\n              type: \"warning\",\n            });\n          }\n        });\n    },\n    // 保存报表所修改的数据\n    createQualitDatas(create, edit) {\n      var $this = this;\n      var $url = $this.$config.kd_tag + \"tag/QUALITY_TAG/create\";\n      sysApi\n        .postAsyncDatas({\n          url: $url,\n          data: create,\n        })\n        .then((res) => {\n          if (res.code == \"0\") {\n            $this.$notify({\n              title: \"质量标记新增\",\n              message: res.message,\n              type: \"success\",\n            });\n            if (!edit.length) {\n              $this.queryQualityTag($this.taskId);\n            }\n          } else {\n            $this.$notify({\n              title: \"质量标记新增\",\n              message: res.message,\n              type: \"warning\",\n            });\n          }\n        });\n    },\n    // 报表加载子集\n    loadChildren(tree, treeNode, resolve) {\n      setTimeout(() => {\n        resolve(this.tableDataChild[tree.id]);\n      }, 500);\n    },\n    // 加载任务的质检标记\n    queryQualityTag(id) {\n      var $this = this;\n      $this.tableData = [];\n      $this.exportData = [];\n      $this.editDatas = {};\n      $this.tableDataChild = {};\n      if (!id) {\n        return;\n      }\n      $this.taskId = id;\n      var temp1 = [\n        { k: \"TASK_ID\", op: \"eq\", v: id },\n        {\n          k: \"TASK_DEFINITION_KEY\",\n          op: \"eq\",\n          v: window.currentTask.taskDefinitionKey,\n        },\n      ];\n      var $url =\n        $this.$config.kd_tag +\n        \"tag/osm/QUALITY_TAG/query?tagsJson=\" +\n        encodeURIComponent(JSON.stringify(temp1));\n      sysApi\n        .getAsyncDatas({\n          url: $url,\n        })\n        .then((res) => {\n          var model = $this.$tags[\"QUALITY_TAG\"] || {};\n          var modelEntity = model.fields || [];\n          var errorType = $this.$_.filter(modelEntity, {\n            fieldName: \"ERROR_TYPE\",\n          })[0];\n          var types = errorType.fieldType.fieldTypeValues;\n          var tagSource = $this.$_.filter(modelEntity, {\n            fieldName: \"TAG_SOURCE\",\n          })[0];\n          var source = tagSource.fieldType.fieldTypeValues;\n          var nodes = (res.result && res.result.node) || [];\n          var newDatas = {};\n          nodes.forEach(function (entity) {\n            let tags = util.formatTags(entity.tag);\n            entity.cloneTag = tags;\n            let ERROR_TYPE = tags.ERROR_TYPE;\n            let FEATURE = tags.FEATURE;\n            let CHECK_ITEM_ID = tags.CHECK_ITEM_ID;\n            let type = $this.$_.filter(types, { value: ERROR_TYPE })[0];\n            let type_name = type && type.name ? type.name : \"\";\n            var obj = {\n              id: \"\",\n              state: \"xx\",\n              children: [],\n              errortype: type_name,\n              checknum: \"\",\n              datatype: \"\",\n              question: \"\",\n              tagsource: \"\",\n              progress: \"\",\n              pid: -1,\n              hasChildren: false,\n              status: 0,\n            };\n            //数据分类\n            if (ERROR_TYPE == \"0\") {\n              if (!newDatas[CHECK_ITEM_ID + \"-\" + FEATURE]) {\n                newDatas[CHECK_ITEM_ID + \"-\" + FEATURE] = obj;\n                newDatas[CHECK_ITEM_ID + \"-\" + FEATURE].datatype = FEATURE;\n                newDatas[CHECK_ITEM_ID + \"-\" + FEATURE].datas = [];\n              }\n              newDatas[CHECK_ITEM_ID + \"-\" + FEATURE].datas.push(entity);\n            } else {\n              // if (ERROR_TYPE && FEATURE) {\n              if (!newDatas[ERROR_TYPE + \"-\" + FEATURE]) {\n                newDatas[ERROR_TYPE + \"-\" + FEATURE] = obj;\n                newDatas[ERROR_TYPE + \"-\" + FEATURE].datatype = FEATURE;\n                newDatas[ERROR_TYPE + \"-\" + FEATURE].datas = [];\n              }\n              newDatas[ERROR_TYPE + \"-\" + FEATURE].datas.push(entity);\n            }\n          });\n          $this.$emit(\"tagDataChange\", nodes);\n\n          var num = 1;\n          var results = [];\n          for (let i in newDatas) {\n            let item = newDatas[i];\n            item.id = num;\n            let data = $this.$_.clone(item.datas);\n            delete item.datas;\n            var subResult = [],\n              progress = 0;\n            data.forEach(function (d) {\n              let tags = util.formatTags(d.tag);\n              num++;\n              let tagSource =\n                $this.$_.filter(source, { value: tags.TAG_SOURCE })[0] || {};\n              let tagSourceName = tagSource.name;\n              if (\n                tagSource.value == \"4\" ||\n                tagSource.value == \"5\" ||\n                tagSource.value == \"6\" ||\n                tagSource.value == \"7\"\n              ) {\n                tagSourceName = \"作业标\";\n              }\n              let locs = [d.lon, d.lat, d.z];\n              let subObj = {\n                id: num,\n                state: d.id,\n                errortype: \"\",\n                children: [],\n                tags: tags,\n                checknum: tags.CHECK_ITEM_ID || \"\",\n                datatype: item.datatype,\n                question: tags.DESC,\n                tagsource: tagSourceName || \"\",\n                progress: \"\",\n                pid: item.id,\n                entityId: d.id,\n                changed: false,\n                misstate: false,\n                shelve: false,\n                locs: locs,\n                status: tags.STATE || 0,\n              };\n              if (tags.STATE == \"0\" || tags.STATE == \"1\") {\n                subResult.unshift(subObj);\n              } else {\n                progress += 1;\n                subResult.push(subObj);\n              }\n            });\n            item.progress = progress + \"/\" + data.length;\n            if (data.length) {\n              item.hasChildren = true;\n              $this.tableDataChild[item.id] = subResult;\n              $this.exportData.push(item);\n              $this.exportData.push(...subResult);\n              results.push(item);\n            }\n            num++;\n          }\n          $this.tableData = results;\n        });\n    },\n    drawerOpened() {\n      this.$emit(\"drawerOpened\");\n    },\n    drawerClose() {\n      this.$emit(\"drawerClose\");\n    },\n  },\n  components: {\n    footHeader,\n  },\n};\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style lang=\"scss\">\n.indexFooter {\n  float: left;\n  position: absolute;\n  bottom: 0px;\n  z-index: 100;\n  height: 20px;\n  width: calc(100% - 10px);\n  padding: 0px 5px;\n}\n.indexFooter .el-table .warning-row {\n  background: rgb(255, 255, 199);\n}\n.indexFooter .el-table td,\n.indexFooter .el-table th {\n  padding: 6px 0;\n}\n.indexFooter .el-table .el-button {\n  padding: 0px;\n  min-height: 10px;\n}\n.indexFooter button.export {\n  position: absolute;\n  right: 15px;\n  top: 10px;\n}\n.indexFooter .el-drawer {\n  overflow: initial;\n  height: 500px;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}