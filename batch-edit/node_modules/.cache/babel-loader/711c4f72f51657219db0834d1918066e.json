{"ast":null,"code":"export default {\n  name: \"contentEdit\",\n\n  data() {\n    return {\n      tagDataEdit: false,\n      //根据质检标记的数量显示质检标记的编辑按钮\n      editTagId: null,\n      createTagId: 1,\n      page: {\n        currentPage: 1,\n        pageSize: 1,\n        totalPage: 1\n      },\n      enterable: false,\n      //根据用户权限校验：作业员可修改；质检员只读。\n      toggleClass: this.hideHeader ? \"el-icon-caret-top\" : \"el-icon-caret-bottom\",\n      visible: false,\n      deleteDisabled: false,\n      //问题标记是否可删除\n      childInstanseTag: this.instanseTag,\n      formType: 1,\n      popWidth: 400,\n      placement: \"right\",\n      formDatas: [],\n      editForm: {},\n      imageForm: {},\n      checkForm: {\n        ERROR_TYPE: \"\",\n        ATTRIBUTE: \"\",\n        STATE: \"\",\n        DESC: \"\"\n      },\n      ATTRIBUTE_filter: [\"AREA_FLAG\", \"OPERATOR\", \"SOURCE\", \"SDATE\", \"FLAG\", \"TASK_ID\", \"BATCH\", \"SEQ\"],\n      editRules: {},\n      imageRules: {},\n      checkRules: {\n        ERROR_TYPE: [{\n          required: false,\n          message: \"请选择错误类型\",\n          trigger: \"change\"\n        }],\n        ATTRIBUTE: [{\n          required: false,\n          message: \"请选择错误属性\",\n          trigger: \"change\"\n        }],\n        STATE: [{\n          required: false,\n          message: \"请选择标记状态\",\n          trigger: \"change\"\n        }],\n        DESC: [{\n          required: false,\n          message: \"请输入内容描述\",\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n\n  props: [\"editId\", \"entity\", \"entityId\", \"editTags\", \"modelName\", \"editDisabled\", \"checkDisabled\", \"stateDisabled\", \"tagDatas\", \"editQuestionTag\" //问题标记\n  ],\n\n  mounted() {\n    this.tagDataEdit = true;\n\n    if (this.tagDatas.length) {\n      this.tagDataEdit = true;\n    }\n  },\n\n  methods: {\n    showAddBtn() {\n      return !this.checkDisabled;\n    },\n\n    showEditBtn() {\n      var filterEntity = this.tagDatas.filter(d => {\n        return d.cloneTag.FEATURE_ID == this.entityId;\n      });\n      return filterEntity.length;\n    },\n\n    getInstanse(model) {\n      var modelFile = this.$tags[model] || {};\n      var fields = modelFile.fields || [];\n      return fields;\n    },\n\n    // 每次进行属性编辑时，初始化当前编辑界面\n    attributeInstanseInit() {\n      this.editRules = {};\n      this.editForm = {};\n      this.formDatas = [];\n      var modelAttr = this.$fruit[this.modelName] || {},\n          fields = modelAttr.fields || [],\n          cloneFields = this.$_.cloneDeep(fields);\n      cloneFields.forEach(d => {\n        if (d.display) {\n          var trigger = d.fieldInput == \"select\" ? \"change\" : \"blur\";\n          var text = d.fieldInput == \"select\" ? \"选择\" : \"输入\";\n          var message = \"请\" + text + d.fieldTitle;\n          var defaultValue = this.editTags[d.fieldName] || \"\";\n          this.editForm[d.fieldName] = defaultValue || d.defaultValue || \"\";\n          this.editRules[d.fieldName] = [{\n            required: false,\n            message: message,\n            trigger: trigger\n          }];\n          d.message = message;\n        }\n      });\n      this.formDatas = cloneFields;\n    },\n\n    // 每次进行属性编辑时，初始化当前编辑界面\n    questionInstanseInit(modelName) {\n      this.imageRules = {};\n      this.imageForm = {};\n      this.formDatas = [];\n      var editTagForm = this.editQuestionTag[this.editId] || {};\n      var modelAttr = this.$tags[modelName] || {},\n          fields = modelAttr.fields || [],\n          cloneFields = this.$_.cloneDeep(fields);\n      var formValues = {\n        \"TRACKPOINTID\": this.entity.trackPointId || \"\",\n        \"TRACKID\": this.entity.trackId || \"\",\n        \"CREATEBY\": this.$user.name,\n        \"TASKID\": window.currentTask.taskId || \"\",\n        \"PROJECTID\": this.entity.autoProjectId || \"\"\n      };\n      cloneFields.forEach(d => {\n        // if (d.display) {\n        var trigger = d.fieldInput == \"select\" ? \"change\" : \"blur\";\n        var text = d.fieldInput == \"select\" ? \"选择\" : \"输入\";\n        var message = \"请\" + text + d.fieldTitle;\n        var defaultValue = editTagForm[d.fieldName] || \"\";\n        this.imageForm[d.fieldName] = defaultValue || d.defaultValue || \"\";\n        this.imageRules[d.fieldName] = [{\n          required: false,\n          message: message,\n          trigger: trigger\n        }];\n        d.message = message; // }\n      });\n      this.formDatas = cloneFields;\n    },\n\n    // 质检标记初始化\n    tagInstanseInit() {\n      this.formDatas = [];\n      var instanseTags = this.getInstanse(\"QUALITY_TAG\");\n      instanseTags.forEach(d => {\n        if (d.fieldName == \"STATE\") {\n          this.formDatas[3] = d;\n          this.checkForm[d.fieldName] = d.defaultValue || \"\";\n        } else if (d.fieldName == \"ERROR_TYPE\") {\n          this.formDatas[0] = d;\n          this.checkForm[d.fieldName] = d.defaultValue || \"\";\n        } else if (d.fieldName == \"DESC\") {\n          this.formDatas[2] = d;\n          this.checkForm[d.fieldName] = d.defaultValue || \"\";\n        } else if (d.fieldName == \"ATTRIBUTE\") {\n          d.fieldInput = \"select\";\n          d.fieldType = {\n            fieldTypeValues: []\n          };\n          this.formDatas[1] = d;\n          this.checkForm[d.fieldName] = d.defaultValue || \"\";\n        }\n      });\n    },\n\n    /*\n     **级联关系的联动处理**\n     *1、传fieldName：\n     *****   则查看当前fieldName下是否存在子集关系，并进行更新选项\n     *2、不传fieldName：\n     *****   则查看当前模型下所有的级联关系，并进行更新所有选项\n     */\n    groupLinkage(fieldName, type) {\n      var $this = this;\n      var modelFields = $this.$fruit[$this.modelName] || null;\n      var fields = modelFields ? modelFields.fields : [];\n\n      if (fieldName == \"ERROR_TYPE\") {\n        var attrs = this.formDatas.find(d => {\n          return d.fieldName == \"ATTRIBUTE\";\n        });\n\n        if (![\"3\", \"4\", \"8\"].includes($this.checkForm[fieldName] + \"\")) {\n          attrs.cloneValues = [];\n        } else {\n          attrs.cloneValues = fields.filter(function (d) {\n            return !$this.ATTRIBUTE_filter.includes(d.fieldName);\n          }).map(function (d) {\n            return {\n              name: d.fieldTitle || d.fieldName,\n              value: d.fieldName\n            };\n          }) || [];\n        }\n\n        if (!type) {\n          $this.checkForm[\"ATTRIBUTE\"] = \"\";\n        }\n\n        console.log(this.ATTRIBUTE_filter);\n      } else {\n        fields.forEach(d => {\n          if (fieldName && d.fieldName != fieldName) {\n            return;\n          }\n\n          var selectGroup = d.selectGroup || [];\n\n          if (selectGroup.length) {\n            var fieldTypeValues = d.fieldType.fieldTypeValues || [];\n            var value = $this.editForm[d.fieldName] || d.defaultValue;\n            var selectValue = fieldTypeValues.find(s => {\n              return s.value == value;\n            });\n\n            for (var i = 0; i < selectGroup.length; i++) {\n              $this.groupSelectChange(selectGroup[i], selectValue, fieldName);\n            }\n          }\n        });\n      }\n    },\n\n    // 级联菜单--子集可选项变化\n    groupSelectChange(fieldName, selectValue, f_Name) {\n      var fieldSelect = [];\n      var field = this.formDatas.find(d => {\n        return d.fieldName == fieldName;\n      });\n\n      if (selectValue && selectValue.id) {\n        fieldSelect = field.fieldType.fieldTypeValues.filter(d => {\n          return d.parentId == selectValue.id;\n        });\n      }\n\n      field.cloneValues = fieldSelect;\n\n      if (f_Name) {\n        this.editForm[fieldName] = field.defaultValue;\n      }\n    },\n\n    /*\n     **编辑属性面板的处理**\n     *1、editImage：\n     *****   属性编辑\n     *2、checkImage：\n     *****   质检标状态编辑\n     */\n    editImage(e) {\n      this.attributeInstanseInit();\n      this.groupLinkage();\n\n      if (window.innerWidth - e.clientX < 600) {\n        this.placement = \"left\";\n      } else {\n        this.placement = \"right\";\n      }\n\n      this.popWidth = 400;\n      this.formType = 1;\n      this.visible = true;\n    },\n\n    // 点击质检标记\n    checkImage(e, type) {\n      this.page.currentPage = 1;\n      this.tagInstanseInit();\n\n      if (type == \"add\") {\n        this.groupLinkage(\"ERROR_TYPE\", true);\n\n        if (window.innerWidth - e.clientX < 500) {\n          this.placement = \"left\";\n        } else {\n          this.placement = \"right\";\n        }\n\n        this.formType = 4;\n        this.visible = true;\n      } else {\n        this.changeTagEditor();\n\n        if (this.page.totalPage) {\n          if (window.innerWidth - e.clientX < 500) {\n            this.placement = \"left\";\n          } else {\n            this.placement = \"right\";\n          }\n\n          this.popWidth = 400;\n          this.formType = 2;\n          this.visible = true;\n        } else if (!this.page.totalPage && this.tagDatas.length) {\n          this.visible = false;\n          this.$notify({\n            title: \"提示\",\n            message: \"未匹配到质检标记\",\n            type: \"warning\"\n          });\n        }\n      }\n    },\n\n    // 属性栏编辑分页监听\n    handleSizeChange(val) {\n      this.page.currentPage = val;\n      this.submitCheck(\"checkForm\", true);\n      this.changeTagEditor();\n    },\n\n    handleCurrentChange(val) {\n      this.page.currentPage = val;\n      this.submitCheck(\"checkForm\", true);\n      this.changeTagEditor();\n    },\n\n    // 质检标记不同分页,其中的属性改变时\n    changeTagEditor() {\n      var f_id = this.entityId; // var f_id = \"28\";\n\n      var thisData = this.tagDatas.filter(d => {\n        return d.cloneTag.FEATURE_ID == f_id;\n      });\n      var pageData = thisData[this.page.currentPage - 1];\n      this.page.totalPage = thisData.length;\n\n      if (pageData) {\n        this.editTagId = pageData.id;\n      }\n\n      for (var item in this.checkForm) {\n        if (pageData) {\n          // this.checkForm[item] =\n          //   pageData.cloneTag[item] || this.checkForm[item];\n          this.checkForm[item] = pageData.cloneTag[item] || \"\";\n        }\n      }\n\n      this.groupLinkage(\"ERROR_TYPE\", true);\n    },\n\n    changeTagEditorForm(u_id, properties) {\n      if (u_id && u_id == this.editTagId) {\n        for (var item in properties) {\n          this.checkForm[item] = properties[item];\n        }\n      }\n    },\n\n    // 问题标记--点击按钮\n    tagImage() {\n      // if (this.checkDisabled) {\n      //   this.$notify({\n      //     title: \"提示\",\n      //     message: \"当前用户不是质检员！\",\n      //     type: \"warning\",\n      //   });\n      //   return;\n      // }\n      this.questionInstanseInit(\"QUESTION_TAG\");\n\n      if (this.editQuestionTag[this.editId]) {\n        this.deleteDisabled = true;\n      }\n\n      this.formType = 3;\n      this.visible = true;\n    },\n\n    // 模型属性面板--点击确定\n    submitEdit(formName) {\n      var $this = this;\n      $this.$refs[formName].validate(valid => {\n        if (valid) {\n          $this.visible = false;\n          $this.$emit(\"editList\", $this.editId, $this.editForm);\n        } else {\n          return false;\n        }\n      });\n    },\n\n    // 质检标记属性面板--点击确定\n    submitCheck(formName, type) {\n      var $this = this;\n      $this.$refs[formName].validate(valid => {\n        if (valid) {\n          if ($this.formType == 4) {\n            var createId = $this.editId + \"_tag_\" + $this.createTagId;\n            $this.$emit(\"checkListCreate\", createId, $this.checkForm, $this.entityId);\n            $this.visible = false;\n            $this.createTagId++;\n          } else {\n            $this.$emit(\"checkList\", $this.editTagId, $this.checkForm, $this.entityId);\n\n            if (this.page.currentPage == this.page.totalPage && !type) {\n              $this.visible = false;\n            } else if (!type) {\n              this.page.currentPage++;\n              this.changeTagEditor();\n            }\n          }\n        } else {\n          return false;\n        }\n      });\n    },\n\n    // 问题标记属性面板--点击确定\n    submitImage(formName) {\n      var $this = this;\n      $this.$refs[formName].validate(valid => {\n        if (valid) {\n          $this.visible = false;\n          $this.$emit(\"tagImage\", $this.editId, $this.imageForm);\n        } else {\n          return false;\n        }\n      });\n    },\n\n    deleteQuestionTag() {\n      this.$emit(\"tagImageDelete\", this.editId);\n      this.visible = false;\n    }\n\n  }\n};","map":{"version":3,"sources":["D:\\web_editor_hd\\src\\main\\webapp\\batch-edit\\src\\components\\contentComponents\\contentEdit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"contentEdit\">\n    <el-popover\n      :placement=\"placement\"\n      :width=\"popWidth\"\n      trigger=\"manual\"\n      :popper-options=\"{\n        boundariesElement: 'body',\n        gpuAcceleration: false,\n      }\"\n      v-model:visible=\"visible\"\n    >\n      <p>属性栏</p>\n      <el-scrollbar max-height=\"450px\" style=\"padding-bottom: 30px\">\n        <el-form\n          v-if=\"formType == 1\"\n          ref=\"editForm\"\n          :model=\"editForm\"\n          label-width=\"150px\"\n          size=\"medium\"\n          :rules=\"editRules\"\n          :label-position=\"'left'\"\n        >\n          <div v-for=\"formChild in formDatas\" :key=\"formChild.fieldName\">\n            <el-form-item\n              v-if=\"formChild.display\"\n              :label=\"formChild.fieldTitle\"\n              :prop=\"formChild.fieldName\"\n            >\n              <el-select\n                v-if=\"formChild.fieldInput == 'select'\"\n                v-model=\"editForm[formChild.fieldName]\"\n                placeholder=\"formChild.message\"\n                :disabled=\"editDisabled\"\n                @change=\"groupLinkage(formChild.fieldName)\"\n              >\n                <el-option\n                  v-for=\"options in formChild.cloneValues\"\n                  :key=\"options.value\"\n                  :label=\"options.name\"\n                  :value=\"options.value\"\n                ></el-option>\n              </el-select>\n              <el-input\n                v-else\n                type=\"text\"\n                :disabled=\"editDisabled\"\n                v-model=\"editForm[formChild.fieldName]\"\n              ></el-input>\n            </el-form-item>\n          </div>\n          <el-form-item size=\"large\">\n            <el-button\n              type=\"primary\"\n              size=\"medium\"\n              :disabled=\"editDisabled\"\n              @click=\"submitEdit('editForm')\"\n              >确定</el-button\n            >\n            <el-button size=\"medium\" @click=\"visible = false\">取消</el-button>\n          </el-form-item>\n        </el-form>\n        <el-form\n          v-if=\"formType == 2 || formType == 4\"\n          ref=\"checkForm\"\n          :model=\"checkForm\"\n          label-width=\"120px\"\n          size=\"medium\"\n          :label-position=\"'left'\"\n          :rules=\"checkRules\"\n          :disabled=\"stateDisabled && checkDisabled ? true : false\"\n        >\n          <div v-for=\"formChild in formDatas\" :key=\"formChild.fieldName\">\n            <el-form-item\n              :label=\"formChild.fieldTitle\"\n              :prop=\"formChild.fieldName\"\n            >\n              <el-radio-group\n                v-if=\"formChild.fieldName == 'STATE'\"\n                v-model=\"checkForm[formChild.fieldName]\"\n                size=\"medium\"\n                :disabled=\"stateDisabled\"\n              >\n                <el-radio\n                  v-for=\"formdata in formChild.fieldType.fieldTypeValues\"\n                  :key=\"formdata.value\"\n                  :value=\"formdata.value\"\n                  :label=\"formdata.value\"\n                  border\n                  >{{ formdata.name }}</el-radio\n                >\n              </el-radio-group>\n              <el-input\n                v-else-if=\"formChild.fieldName == 'DESC'\"\n                type=\"textarea\"\n                v-model=\"checkForm[formChild.fieldName]\"\n                :disabled=\"checkDisabled\"\n              ></el-input>\n              <el-select\n                v-else-if=\"formChild.fieldInput == 'select'\"\n                v-model=\"checkForm[formChild.fieldName]\"\n                :placeholder=\"formChild.fieldTitle\"\n                @change=\"groupLinkage(formChild.fieldName)\"\n                :disabled=\"checkDisabled\"\n              >\n                <el-option\n                  v-for=\"options in formChild.cloneValues || []\"\n                  :key=\"options.value\"\n                  :label=\"options.name\"\n                  :value=\"options.value\"\n                ></el-option>\n              </el-select>\n            </el-form-item>\n          </div>\n          <el-form-item size=\"large\">\n            <el-button\n              type=\"primary\"\n              size=\"medium\"\n              @click=\"submitCheck('checkForm')\"\n              >确定</el-button\n            >\n            <el-button size=\"medium\" @click=\"visible = false\">取消</el-button>\n          </el-form-item>\n          <el-pagination\n            @size-change=\"handleSizeChange\"\n            @current-change=\"handleCurrentChange\"\n            small\n            layout=\"prev, pager, next, jumper\"\n            :current-page=\"page.currentPage\"\n            :page-count=\"page.totalPage\"\n            v-show=\"formType == 2\"\n            style=\"position: absolute; bottom: 0px\"\n          >\n          </el-pagination>\n        </el-form>\n        <el-form\n          v-if=\"formType == 3\"\n          ref=\"imageForm\"\n          :model=\"imageForm\"\n          label-width=\"150px\"\n          size=\"medium\"\n          :rules=\"imageRules\"\n          :label-position=\"'left'\"\n        >\n          <div v-for=\"formChild in formDatas\" :key=\"formChild.fieldName\">\n            <el-form-item\n              :label=\"formChild.fieldTitle\"\n              :prop=\"formChild.fieldName\"\n            >\n              <el-select\n                v-if=\"formChild.fieldInput == 'select'\"\n                v-model=\"imageForm[formChild.fieldName]\"\n                placeholder=\"formChild.message\"\n              >\n                <el-option\n                  v-for=\"options in formChild.cloneValues\"\n                  :key=\"options.value\"\n                  :label=\"options.name\"\n                  :value=\"options.value\"\n                ></el-option>\n              </el-select>\n              <el-input\n                v-else\n                type=\"text\"\n                v-model=\"imageForm[formChild.fieldName]\"\n              ></el-input>\n            </el-form-item>\n          </div>\n          <el-form-item size=\"large\">\n            <el-button\n              type=\"primary\"\n              size=\"medium\"\n              @click=\"submitImage('imageForm')\"\n              >确定</el-button\n            >\n            <el-button size=\"medium\" @click=\"visible = false\">取消</el-button>\n            <el-button\n              v-show=\"deleteDisabled\"\n              type=\"danger\"\n              size=\"medium\"\n              @click=\"deleteQuestionTag\"\n              >删除</el-button\n            >\n          </el-form-item>\n        </el-form>\n      </el-scrollbar>\n      <template #reference>\n        <div class=\"footHeaderToggle\">\n          <el-tooltip\n            class=\"item\"\n            effect=\"dark\"\n            content=\"修改\"\n            placement=\"top\"\n            :enterable=\"enterable\"\n          >\n            <el-button\n              @click.stop=\"editImage($event)\"\n              icon=\"el-icon-edit-outline\"\n              title=\"修改\"\n            ></el-button>\n          </el-tooltip>\n          <el-tooltip\n            class=\"item\"\n            effect=\"dark\"\n            content=\"新增质检标记\"\n            placement=\"top\"\n            :enterable=\"enterable\"\n          >\n            <el-button\n              @click.stop=\"checkImage($event, 'add')\"\n              icon=\"el-icon-location\"\n              v-show=\"showAddBtn()\"\n              title=\"新增质检标记\"\n            ></el-button>\n          </el-tooltip>\n          <el-tooltip\n            class=\"item\"\n            effect=\"dark\"\n            content=\"修改质检标记\"\n            placement=\"top\"\n            :enterable=\"enterable\"\n          >\n            <el-button\n              @click.stop=\"checkImage($event, 'edit')\"\n              icon=\"el-icon-map-location\"\n              v-show=\"showEditBtn()\"\n              title=\"修改质检标记\"\n            ></el-button>\n          </el-tooltip>\n          <el-tooltip\n            class=\"item\"\n            effect=\"dark\"\n            content=\"问题标记\"\n            placement=\"top\"\n            :enterable=\"enterable\"\n          >\n            <el-button\n              @click.stop=\"tagImage()\"\n              icon=\"el-icon-add-location\"\n              title=\"问题标记\"\n            ></el-button>\n          </el-tooltip>\n        </div>\n      </template>\n    </el-popover>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"contentEdit\",\n  data() {\n    return {\n      tagDataEdit: false, //根据质检标记的数量显示质检标记的编辑按钮\n      editTagId: null,\n      createTagId: 1,\n      page: {\n        currentPage: 1,\n        pageSize: 1,\n        totalPage: 1,\n      },\n      enterable: false,\n      //根据用户权限校验：作业员可修改；质检员只读。\n      toggleClass: this.hideHeader\n        ? \"el-icon-caret-top\"\n        : \"el-icon-caret-bottom\",\n      visible: false,\n      deleteDisabled: false, //问题标记是否可删除\n      childInstanseTag: this.instanseTag,\n      formType: 1,\n      popWidth: 400,\n      placement: \"right\",\n      formDatas: [],\n      editForm: {},\n      imageForm: {},\n      checkForm: {\n        ERROR_TYPE: \"\",\n        ATTRIBUTE: \"\",\n        STATE: \"\",\n        DESC: \"\",\n      },\n      ATTRIBUTE_filter: [\n        \"AREA_FLAG\",\n        \"OPERATOR\",\n        \"SOURCE\",\n        \"SDATE\",\n        \"FLAG\",\n        \"TASK_ID\",\n        \"BATCH\",\n        \"SEQ\",\n      ],\n      editRules: {},\n      imageRules: {},\n      checkRules: {\n        ERROR_TYPE: [\n          { required: false, message: \"请选择错误类型\", trigger: \"change\" },\n        ],\n        ATTRIBUTE: [\n          { required: false, message: \"请选择错误属性\", trigger: \"change\" },\n        ],\n        STATE: [\n          { required: false, message: \"请选择标记状态\", trigger: \"change\" },\n        ],\n        DESC: [{ required: false, message: \"请输入内容描述\", trigger: \"blur\" }],\n      },\n    };\n  },\n  props: [\n    \"editId\",\n    \"entity\",\n    \"entityId\",\n    \"editTags\",\n    \"modelName\",\n    \"editDisabled\",\n    \"checkDisabled\",\n    \"stateDisabled\",\n    \"tagDatas\",\n    \"editQuestionTag\", //问题标记\n  ],\n  mounted() {\n    this.tagDataEdit = true;\n    if (this.tagDatas.length) {\n      this.tagDataEdit = true;\n    }\n  },\n  methods: {\n    showAddBtn() {\n      return !this.checkDisabled;\n    },\n    showEditBtn() {\n      var filterEntity = this.tagDatas.filter((d) => {\n        return d.cloneTag.FEATURE_ID == this.entityId;\n      });\n      return filterEntity.length;\n    },\n    getInstanse(model) {\n      var modelFile = this.$tags[model] || {};\n      var fields = modelFile.fields || [];\n      return fields;\n    },\n    // 每次进行属性编辑时，初始化当前编辑界面\n    attributeInstanseInit() {\n      this.editRules = {};\n      this.editForm = {};\n      this.formDatas = [];\n      var modelAttr = this.$fruit[this.modelName] || {},\n        fields = modelAttr.fields || [],\n        cloneFields = this.$_.cloneDeep(fields);\n      cloneFields.forEach((d) => {\n        if (d.display) {\n          var trigger = d.fieldInput == \"select\" ? \"change\" : \"blur\";\n          var text = d.fieldInput == \"select\" ? \"选择\" : \"输入\";\n          var message = \"请\" + text + d.fieldTitle;\n\n          var defaultValue = this.editTags[d.fieldName] || \"\";\n          this.editForm[d.fieldName] = defaultValue || d.defaultValue || \"\";\n          this.editRules[d.fieldName] = [\n            { required: false, message: message, trigger: trigger },\n          ];\n          d.message = message;\n        }\n      });\n      this.formDatas = cloneFields;\n    },\n    // 每次进行属性编辑时，初始化当前编辑界面\n    questionInstanseInit(modelName) {\n      this.imageRules = {};\n      this.imageForm = {};\n      this.formDatas = [];\n      var editTagForm = this.editQuestionTag[this.editId] || {};\n      var modelAttr = this.$tags[modelName] || {},\n        fields = modelAttr.fields || [],\n        cloneFields = this.$_.cloneDeep(fields);\n      \n      var formValues = {\n        \"TRACKPOINTID\": this.entity.trackPointId || \"\",\n        \"TRACKID\": this.entity.trackId || \"\",\n        \"CREATEBY\": this.$user.name,\n        \"TASKID\": window.currentTask.taskId || \"\",\n        \"PROJECTID\": this.entity.autoProjectId || \"\",\n      }\n\n      cloneFields.forEach((d) => {\n        // if (d.display) {\n        var trigger = d.fieldInput == \"select\" ? \"change\" : \"blur\";\n        var text = d.fieldInput == \"select\" ? \"选择\" : \"输入\";\n        var message = \"请\" + text + d.fieldTitle;\n\n        var defaultValue = editTagForm[d.fieldName] || \"\";\n        this.imageForm[d.fieldName] = defaultValue || d.defaultValue || \"\";\n        this.imageRules[d.fieldName] = [\n          { required: false, message: message, trigger: trigger },\n        ];\n        d.message = message;\n        // }\n      });\n      this.formDatas = cloneFields;\n    },\n    // 质检标记初始化\n    tagInstanseInit() {\n      this.formDatas = [];\n      var instanseTags = this.getInstanse(\"QUALITY_TAG\");\n      instanseTags.forEach((d) => {\n        if (d.fieldName == \"STATE\") {\n          this.formDatas[3] = d;\n          this.checkForm[d.fieldName] = d.defaultValue || \"\";\n        } else if (d.fieldName == \"ERROR_TYPE\") {\n          this.formDatas[0] = d;\n          this.checkForm[d.fieldName] = d.defaultValue || \"\";\n        } else if (d.fieldName == \"DESC\") {\n          this.formDatas[2] = d;\n          this.checkForm[d.fieldName] = d.defaultValue || \"\";\n        } else if (d.fieldName == \"ATTRIBUTE\") {\n          d.fieldInput = \"select\";\n          d.fieldType = { fieldTypeValues: [] };\n          this.formDatas[1] = d;\n          this.checkForm[d.fieldName] = d.defaultValue || \"\";\n        }\n      });\n    },\n    /*\n     **级联关系的联动处理**\n     *1、传fieldName：\n     *****   则查看当前fieldName下是否存在子集关系，并进行更新选项\n     *2、不传fieldName：\n     *****   则查看当前模型下所有的级联关系，并进行更新所有选项\n     */\n    groupLinkage(fieldName, type) {\n      var $this = this;\n      var modelFields = $this.$fruit[$this.modelName] || null;\n      var fields = modelFields ? modelFields.fields : [];\n\n      if (fieldName == \"ERROR_TYPE\") {\n        var attrs = this.formDatas.find((d) => {\n          return d.fieldName == \"ATTRIBUTE\";\n        });\n        if (![\"3\", \"4\", \"8\"].includes($this.checkForm[fieldName] + \"\")) {\n          attrs.cloneValues = [];\n        } else {\n          attrs.cloneValues =\n            fields\n              .filter(function (d) {\n                return !$this.ATTRIBUTE_filter.includes(d.fieldName);\n              })\n              .map(function (d) {\n                return {\n                  name: d.fieldTitle || d.fieldName,\n                  value: d.fieldName,\n                };\n              }) || [];\n        }\n        if (!type) {\n          $this.checkForm[\"ATTRIBUTE\"] = \"\";\n        }\n        console.log(this.ATTRIBUTE_filter);\n      } else {\n        fields.forEach((d) => {\n          if (fieldName && d.fieldName != fieldName) {\n            return;\n          }\n          var selectGroup = d.selectGroup || [];\n          if (selectGroup.length) {\n            var fieldTypeValues = d.fieldType.fieldTypeValues || [];\n            var value = $this.editForm[d.fieldName] || d.defaultValue;\n            var selectValue = fieldTypeValues.find((s) => {\n              return s.value == value;\n            });\n            for (var i = 0; i < selectGroup.length; i++) {\n              $this.groupSelectChange(selectGroup[i], selectValue, fieldName);\n            }\n          }\n        });\n      }\n    },\n    // 级联菜单--子集可选项变化\n    groupSelectChange(fieldName, selectValue, f_Name) {\n      var fieldSelect = [];\n      var field = this.formDatas.find((d) => {\n        return d.fieldName == fieldName;\n      });\n      if (selectValue && selectValue.id) {\n        fieldSelect = field.fieldType.fieldTypeValues.filter((d) => {\n          return d.parentId == selectValue.id;\n        });\n      }\n      field.cloneValues = fieldSelect;\n      if (f_Name) {\n        this.editForm[fieldName] = field.defaultValue;\n      }\n    },\n    /*\n     **编辑属性面板的处理**\n     *1、editImage：\n     *****   属性编辑\n     *2、checkImage：\n     *****   质检标状态编辑\n     */\n    editImage(e) {\n      this.attributeInstanseInit();\n      this.groupLinkage();\n      if (window.innerWidth - e.clientX < 600) {\n        this.placement = \"left\";\n      } else {\n        this.placement = \"right\";\n      }\n      this.popWidth = 400;\n      this.formType = 1;\n      this.visible = true;\n    },\n    // 点击质检标记\n    checkImage(e, type) {\n      this.page.currentPage = 1;\n      this.tagInstanseInit();\n      if (type == \"add\") {\n        this.groupLinkage(\"ERROR_TYPE\", true);\n        if (window.innerWidth - e.clientX < 500) {\n          this.placement = \"left\";\n        } else {\n          this.placement = \"right\";\n        }\n        this.formType = 4;\n        this.visible = true;\n      } else {\n        this.changeTagEditor();\n        if (this.page.totalPage) {\n          if (window.innerWidth - e.clientX < 500) {\n            this.placement = \"left\";\n          } else {\n            this.placement = \"right\";\n          }\n          this.popWidth = 400;\n          this.formType = 2;\n          this.visible = true;\n        } else if (!this.page.totalPage && this.tagDatas.length) {\n          this.visible = false;\n          this.$notify({\n            title: \"提示\",\n            message: \"未匹配到质检标记\",\n            type: \"warning\",\n          });\n        }\n      }\n    },\n    // 属性栏编辑分页监听\n    handleSizeChange(val) {\n      this.page.currentPage = val;\n      this.submitCheck(\"checkForm\", true);\n      this.changeTagEditor();\n    },\n    handleCurrentChange(val) {\n      this.page.currentPage = val;\n      this.submitCheck(\"checkForm\", true);\n      this.changeTagEditor();\n    },\n    // 质检标记不同分页,其中的属性改变时\n    changeTagEditor() {\n      var f_id = this.entityId;\n      // var f_id = \"28\";\n      var thisData = this.tagDatas.filter((d) => {\n        return d.cloneTag.FEATURE_ID == f_id;\n      });\n      var pageData = thisData[this.page.currentPage - 1];\n      this.page.totalPage = thisData.length;\n      if (pageData) {\n        this.editTagId = pageData.id;\n      }\n      for (var item in this.checkForm) {\n        if (pageData) {\n          // this.checkForm[item] =\n          //   pageData.cloneTag[item] || this.checkForm[item];\n          this.checkForm[item] = pageData.cloneTag[item] || \"\";\n        }\n      }\n      this.groupLinkage(\"ERROR_TYPE\", true);\n    },\n    changeTagEditorForm(u_id, properties) {\n      if (u_id && u_id == this.editTagId) {\n        for (var item in properties) {\n          this.checkForm[item] = properties[item];\n        }\n      }\n    },\n    // 问题标记--点击按钮\n    tagImage() {\n      // if (this.checkDisabled) {\n      //   this.$notify({\n      //     title: \"提示\",\n      //     message: \"当前用户不是质检员！\",\n      //     type: \"warning\",\n      //   });\n      //   return;\n      // }\n      this.questionInstanseInit(\"QUESTION_TAG\");\n      if (this.editQuestionTag[this.editId]) {\n        this.deleteDisabled = true;\n      }\n      this.formType = 3;\n      this.visible = true;\n    },\n    // 模型属性面板--点击确定\n    submitEdit(formName) {\n      var $this = this;\n      $this.$refs[formName].validate((valid) => {\n        if (valid) {\n          $this.visible = false;\n          $this.$emit(\"editList\", $this.editId, $this.editForm);\n        } else {\n          return false;\n        }\n      });\n    },\n    // 质检标记属性面板--点击确定\n    submitCheck(formName, type) {\n      var $this = this;\n      $this.$refs[formName].validate((valid) => {\n        if (valid) {\n          if ($this.formType == 4) {\n            var createId = $this.editId + \"_tag_\" + $this.createTagId;\n            $this.$emit(\n              \"checkListCreate\",\n              createId,\n              $this.checkForm,\n              $this.entityId\n            );\n            $this.visible = false;\n            $this.createTagId++;\n          } else {\n            $this.$emit(\n              \"checkList\",\n              $this.editTagId,\n              $this.checkForm,\n              $this.entityId\n            );\n            if (this.page.currentPage == this.page.totalPage && !type) {\n              $this.visible = false;\n            } else if (!type) {\n              this.page.currentPage++;\n              this.changeTagEditor();\n            }\n          }\n        } else {\n          return false;\n        }\n      });\n    },\n    // 问题标记属性面板--点击确定\n    submitImage(formName) {\n      var $this = this;\n      $this.$refs[formName].validate((valid) => {\n        if (valid) {\n          $this.visible = false;\n          $this.$emit(\"tagImage\", $this.editId, $this.imageForm);\n        } else {\n          return false;\n        }\n      });\n    },\n    deleteQuestionTag() {\n      this.$emit(\"tagImageDelete\", this.editId);\n      this.visible = false;\n    },\n  },\n};\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style lang=\"scss\">\n.contentEdit {\n  float: left;\n  margin: 0 auto;\n  padding: 0px;\n  position: absolute;\n  right: 5px;\n  bottom: 35px;\n  width: auto;\n  z-index: 10;\n}\n.contentEdit .footHeaderToggle button {\n  background-color: rgba(0, 0, 0, 0.4);\n  border: 1px solid rgba(58, 142, 230, 0);\n  min-height: 20px;\n  padding: 5px;\n  font-size: 18px;\n  color: rgba(255, 255, 255, 0.6);\n}\n.contentEdit .footHeaderToggle button:focus,\n.contentEdit .footHeaderToggle button:hover {\n  border: 1px solid rgba(58, 142, 230, 1);\n  color: rgba(255, 255, 255, 1);\n}\n.el-form .el-radio-group .el-radio {\n  margin-right: 5px;\n  padding: 5px 10px 0px 5px;\n  height: 26px;\n  margin-bottom: 5px;\n  float: left;\n  margin-left: 0px !important;\n}\n.el-popover {\n  padding-right: 0px;\n}\n.el-popover .el-form {\n  padding-right: 15px;\n  overflow-x: hidden;\n}\n.el-popover p {\n  font-weight: bold;\n  margin: 5px 0px;\n}\n.el-popover .el-form .el-select {\n  width: 100%;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}