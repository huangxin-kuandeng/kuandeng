!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";var c=[],d=a.document,e=Object.getPrototypeOf,f=c.slice,g=c.concat,h=c.push,i=c.indexOf,j={},k=j.toString,l=j.hasOwnProperty,m=l.toString,n=m.call(Object),o={};function p(a,b){b=b||d;var c=b.createElement("script");c.text=a,b.head.appendChild(c).parentNode.removeChild(c)}var q="3.2.1",r=function(a,b){return new r.fn.init(a,b)},s=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t=/^-ms-/,u=/-([a-z])/g,v=function(a,b){return b.toUpperCase()};r.fn=r.prototype={jquery:q,constructor:r,length:0,toArray:function(){return f.call(this)},get:function(a){return null==a?f.call(this):0>a?this[a+this.length]:this[a]},pushStack:function(a){var b=r.merge(this.constructor(),a);return b.prevObject=this,b},each:function(a){return r.each(this,a)},map:function(a){return this.pushStack(r.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(0<=c&&c<b?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:c.sort,splice:c.splice},r.extend=r.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||r.isFunction(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(r.isPlainObject(d)||(e=Array.isArray(d)))?(e?(e=!1,f=c&&Array.isArray(c)?c:[]):f=c&&r.isPlainObject(c)?c:{},g[b]=r.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},r.extend({expando:"jQuery"+(q+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===r.type(a)},isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=r.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==k.call(a))&&(!(b=e(a))||(c=l.call(b,"constructor")&&b.constructor,"function"==typeof c&&m.call(c)===n))},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?j[k.call(a)]||"object":typeof a},globalEval:function(a){p(a)},camelCase:function(a){return a.replace(t,"ms-").replace(u,v)},each:function(a,b){var c,d=0;if(w(a)){for(c=a.length;d<c;d++)if(!1===b.call(a[d],d,a[d]))break}else for(d in a)if(!1===b.call(a[d],d,a[d]))break;return a},trim:function(a){return null==a?"":(a+"").replace(s,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(w(Object(a))?r.merge(c,"string"==typeof a?[a]:a):h.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:i.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;d<c;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;f<g;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,f=0,h=[];if(w(a))for(d=a.length;f<d;f++)e=b(a[f],f,c),null!=e&&h.push(e);else for(f in a)e=b(a[f],f,c),null!=e&&h.push(e);return g.apply([],h)},guid:1,proxy:function(a,b){var c,d,e;if("string"==typeof b&&(c=a[b],b=a,a=c),r.isFunction(a))return d=f.call(arguments,2),e=function(){return a.apply(b||this,d.concat(f.call(arguments)))},e.guid=a.guid=a.guid||r.guid++,e},now:Date.now,support:o}),"function"==typeof Symbol&&(r.fn[Symbol.iterator]=c[Symbol.iterator]),r.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){j["[object "+b+"]"]=b.toLowerCase()});function w(a){var b=!!a&&"length"in a&&a.length,c=r.type(a);return"function"!==c&&!r.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&0<b&&b-1 in a)}var x=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",M="\\["+K+"*("+L+")(?:"+K+"*([*^$|!~]?=)"+K+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+L+"))|)"+K+"*\\]",N=":("+L+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+M+")*)|.*)\\)|)",O=new RegExp(K+"+","g"),P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(N),U=new RegExp("^"+L+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L+"|[*])"),ATTR:new RegExp("^"+M),PSEUDO:new RegExp("^"+N),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),aa=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(55296|d>>10,56320|1023&d)},ba=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ca=function(a,b){return b?"\0"===a?"\uFFFD":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a},da=function(){m()},ea=ta(function(a){return!0===a.disabled&&("form"in a||"label"in a)},{dir:"parentNode",next:"legend"});try{G.apply(D=H.call(v.childNodes),v.childNodes),D[v.childNodes.length].nodeType}catch(fa){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s=b&&b.ownerDocument,w=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==w&&9!==w&&11!==w)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==w&&(l=Z.exec(a)))if(f=l[1]){if(9===w){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(s&&(j=s.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(l[2])return G.apply(d,b.getElementsByTagName(a)),d;if((f=l[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==w)s=b,r=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(ba,ca):b.setAttribute("id",k=u),o=g(a),h=o.length;while(h--)o[h]="#"+k+" "+sa(o[h]);r=o.join(","),s=$.test(a)&&qa(b.parentNode)||b}if(r)try{return G.apply(d,s.querySelectorAll(r)),d}catch(x){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(P,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("fieldset");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return function(b){return"form"in b?b.parentNode&&!1===b.disabled?"label"in b?"label"in b.parentNode?b.parentNode.disabled===a:b.disabled===a:b.isDisabled===a||b.isDisabled!==!a&&ea(b)===a:b.disabled===a:"label"in b&&b.disabled===a}}function pa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function qa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),v!==n&&(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(n.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){return a.getAttribute("id")===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}}):(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c,d,e,f=b.getElementById(a);if(f){if(c=f.getAttributeNode("id"),c&&c.value===a)return[f];e=b.getElementsByName(a),d=0;while(f=e[d++])if(c=f.getAttributeNode("id"),c&&c.value===a)return[f]}return[]}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){if("undefined"!=typeof b.getElementsByClassName&&p)return b.getElementsByClassName(a)},r=[],q=[],(c.qsa=Y.test(n.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){a.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+K+"*[*^$|!~]?="),2!==a.querySelectorAll(":enabled").length&&q.push(":enabled",":disabled"),o.appendChild(a).disabled=!0,2!==a.querySelectorAll(":disabled").length&&q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Y.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"*"),s.call(a,"[s!='']:x"),r.push("!=",N)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Y.test(o.compareDocumentPosition),t=b||Y.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?I(k,a)-I(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?I(k,a)-I(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?la(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(S,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return 0<ga(b,n,null,[a]).length},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.escape=function(a){return(a+"").replace(ba,ca)},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(_,aa),a[3]=(a[3]||a[4]||a[5]||"").replace(_,aa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return V.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&T.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(_,aa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:!b||(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&-1<e.indexOf(c):"$="===b?c&&e.slice(-c.length)===c:"~="===b?-1<(" "+e.replace(O," ")+" ").indexOf(c):"|="===b&&(e===c||e.slice(0,c.length+1)===c+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),!1===t)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||0===t%d&&0<=t/d}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):1<e.length?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(P,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return 0<ga(a,b).length}}),contains:ia(function(a){return a=a.replace(_,aa),function(b){return-1<(b.textContent||b.innerText||e(b)).indexOf(a)}}),lang:ia(function(a){return U.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(_,aa).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:oa(!1),disabled:oa(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(6>a.nodeType)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:pa(function(){return[0]}),last:pa(function(a,b){return[b-1]}),eq:pa(function(a,b,c){return[0>c?c+b:c]}),even:pa(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:pa(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:pa(function(a,b,c){for(var d=0>c?c+b:c;0<=--d;)a.push(d);return a}),gt:pa(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function ra(){}ra.prototype=d.filters=d.pseudos,d.setFilters=new ra,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=Q.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function sa(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function ta(a,b,c){var d=b.dir,e=b.next,f=e||d,g=c&&"parentNode"===f,h=x++;return b.first?function(b,c,e){while(b=b[d])if(1===b.nodeType||g)return a(b,c,e);return!1}:function(b,c,i){var j,k,l,m=[w,h];if(i){while(b=b[d])if((1===b.nodeType||g)&&a(b,c,i))return!0}else while(b=b[d])if(1===b.nodeType||g)if(l=b[u]||(b[u]={}),k=l[b.uniqueID]||(l[b.uniqueID]={}),e&&e===b.nodeName.toLowerCase())b=b[d]||b;else{if((j=k[f])&&j[0]===w&&j[1]===h)return m[2]=j[2];if(k[f]=m,m[2]=a(b,c,i))return!0}return!1}}function ua(a){return 1<a.length?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function va(a,b,c){for(var d=0,e=b.length;d<e;d++)ga(a,b[d],c);return c}function wa(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function xa(a,b,c,d,e,f){return d&&!d[u]&&(d=xa(d)),e&&!e[u]&&(e=xa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||va(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:wa(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=wa(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&-1<(j=e?I(f,l):m[k])&&(f[j]=!(g[j]=l))}}else r=wa(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ya(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ta(function(a){return a===b},h,!0),l=ta(function(a){return-1<I(b,a)},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];i<f;i++)if(c=d.relative[a[i].type])m=[ta(ua(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;e<f;e++)if(d.relative[a[e].type])break;return xa(1<i&&ua(m),1<i&&sa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(P,"$1"),c,i<e&&ya(a.slice(i,e)),e<f&&ya(a=a.slice(e)),e<f&&sa(a))}m.push(c)}return ua(m)}function za(a,b){var c=0<b.length,e=0<a.length,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(0<r)while(s--)t[s]||u[s]||(u[s]=E.call(i));u=wa(u)}G.apply(i,u),k&&!f&&0<u.length&&1<r+b.length&&ga.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=ya(b[c]),f[u]?d.push(f):e.push(f);f=A(a,za(e,d)),f.selector=a}return f},i=ga.select=function(a,b,c,e){var f,i,j,k,l,m="function"==typeof a&&a,n=!e&&g(a=m.selector||a);if(c=c||[],1===n.length){if(i=n[0]=n[0].slice(0),2<i.length&&"ID"===(j=i[0]).type&&9===b.nodeType&&p&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(_,aa),b)||[])[0],!b)return c;m&&(b=b.parentNode),a=a.slice(i.shift().value.length)}f=V.needsContext.test(a)?0:i.length;while(f--){if(j=i[f],d.relative[k=j.type])break;if((l=d.find[k])&&(e=l(j.matches[0].replace(_,aa),$.test(i[0].type)&&qa(b.parentNode)||b))){if(i.splice(f,1),a=e.length&&sa(i),!a)return G.apply(c,e),c;break}}}return(m||h(a,n))(e,b,!p,c,!b||$.test(a)&&qa(b.parentNode)||b),c},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("fieldset"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(J,function(a,b,c){var d;if(!c)return!0===a[b]?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);r.find=x,r.expr=x.selectors,r.expr[":"]=r.expr.pseudos,r.uniqueSort=r.unique=x.uniqueSort,r.text=x.getText,r.isXMLDoc=x.isXML,r.contains=x.contains,r.escapeSelector=x.escape;var y=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&r(a).is(c))break;d.push(a)}return d},z=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},A=r.expr.match.needsContext;function B(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()}var C=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,D=/^.[^:#\[\.,]*$/;function E(a,b,c){return r.isFunction(b)?r.grep(a,function(a,d){return!!b.call(a,d,a)!==c}):b.nodeType?r.grep(a,function(a){return a===b!==c}):"string"!=typeof b?r.grep(a,function(a){return-1<i.call(b,a)!==c}):D.test(b)?r.filter(b,a,c):(b=r.filter(b,a),r.grep(a,function(a){return-1<i.call(b,a)!==c&&1===a.nodeType}))}r.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?r.find.matchesSelector(d,a)?[d]:[]:r.find.matches(a,r.grep(b,function(a){return 1===a.nodeType}))},r.fn.extend({find:function(a){var b,c,d=this.length,e=this;if("string"!=typeof a)return this.pushStack(r(a).filter(function(){for(b=0;b<d;b++)if(r.contains(e[b],this))return!0}));for(c=this.pushStack([]),b=0;b<d;b++)r.find(a,e[b],c);return 1<d?r.uniqueSort(c):c},filter:function(a){return this.pushStack(E(this,a||[],!1))},not:function(a){return this.pushStack(E(this,a||[],!0))},is:function(a){return!!E(this,"string"==typeof a&&A.test(a)?r(a):a||[],!1).length}});var F,G=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,H=r.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||F,"string"==typeof a){if(e="<"===a[0]&&">"===a[a.length-1]&&3<=a.length?[null,a,null]:G.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof r?b[0]:b,r.merge(this,r.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),C.test(e[1])&&r.isPlainObject(b))for(e in b)r.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return f=d.getElementById(e[2]),f&&(this[0]=f,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):r.isFunction(a)?void 0!==c.ready?c.ready(a):a(r):r.makeArray(a,this)};H.prototype=r.fn,F=r(d);var I=/^(?:parents|prev(?:Until|All))/,J={children:!0,contents:!0,next:!0,prev:!0};r.fn.extend({has:function(a){var b=r(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(r.contains(this,b[a]))return!0})},closest:function(a,b){var c,d=0,e=this.length,f=[],g="string"!=typeof a&&r(a);if(!A.test(a))for(;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(11>c.nodeType&&(g?-1<g.index(c):1===c.nodeType&&r.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(1<f.length?r.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?i.call(r(a),this[0]):i.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(r.uniqueSort(r.merge(this.get(),r(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function K(a,b){while((a=a[b])&&1!==a.nodeType);return a}r.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return y(a,"parentNode")},parentsUntil:function(a,b,c){return y(a,"parentNode",c)},next:function(a){return K(a,"nextSibling")},prev:function(a){return K(a,"previousSibling")},nextAll:function(a){return y(a,"nextSibling")},prevAll:function(a){return y(a,"previousSibling")},nextUntil:function(a,b,c){return y(a,"nextSibling",c)},prevUntil:function(a,b,c){return y(a,"previousSibling",c)},siblings:function(a){return z((a.parentNode||{}).firstChild,a)},children:function(a){return z(a.firstChild)},contents:function(a){return B(a,"iframe")?a.contentDocument:(B(a,"template")&&(a=a.content||a),r.merge([],a.childNodes))}},function(a,b){r.fn[a]=function(c,d){var e=r.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=r.filter(d,e)),1<this.length&&(J[a]||r.uniqueSort(e),I.test(a)&&e.reverse()),this.pushStack(e)}});var L=/[^\x20\t\r\n\f]+/g;function M(a){var b={};return r.each(a.match(L)||[],function(a,c){b[c]=!0}),b}r.Callbacks=function(a){a="string"==typeof a?M(a):r.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=e||a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)!1===f[h].apply(c[0],c[1])&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){r.each(b,function(b,c){r.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==r.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return r.each(arguments,function(a,b){var c;while(-1<(c=r.inArray(b,f,c)))f.splice(c,1),c<=h&&h--}),this},has:function(a){return a?-1<r.inArray(a,f):0<f.length},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=g=[],c||b||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j};function N(a){return a}function O(a){throw a}function P(a,b,c,d){var e;try{a&&r.isFunction(e=a.promise)?e.call(a).done(b).fail(c):a&&r.isFunction(e=a.then)?e.call(a,b,c):b.apply(void 0,[a].slice(d))}catch(a){c.apply(void 0,[a])}}r.extend({Deferred:function(b){var c=[["notify","progress",r.Callbacks("memory"),r.Callbacks("memory"),2],["resolve","done",r.Callbacks("once memory"),r.Callbacks("once memory"),0,"resolved"],["reject","fail",r.Callbacks("once memory"),r.Callbacks("once memory"),1,"rejected"]],d="pending",e={state:function(){return d},always:function(){return f.done(arguments).fail(arguments),this},catch:function(a){return e.then(null,a)},pipe:function(){var a=arguments;return r.Deferred(function(b){r.each(c,function(c,d){var e=r.isFunction(a[d[4]])&&a[d[4]];f[d[1]](function(){var a=e&&e.apply(this,arguments);a&&r.isFunction(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[d[0]+"With"](this,e?[a]:arguments)})}),a=null}).promise()},then:function(b,d,e){var f=0;function g(b,c,d,e){return function(){var h=this,i=arguments,j=function(){var a,j;if(!(b<f)){if(a=d.apply(h,i),a===c.promise())throw new TypeError("Thenable self-resolution");j=a&&("object"==typeof a||"function"==typeof a)&&a.then,r.isFunction(j)?e?j.call(a,g(f,c,N,e),g(f,c,O,e)):(f++,j.call(a,g(f,c,N,e),g(f,c,O,e),g(f,c,N,c.notifyWith))):(d!==N&&(h=void 0,i=[a]),(e||c.resolveWith)(h,i))}},k=e?j:function(){try{j()}catch(a){r.Deferred.exceptionHook&&r.Deferred.exceptionHook(a,k.stackTrace),b+1>=f&&(d!==O&&(h=void 0,i=[a]),c.rejectWith(h,i))}};b?k():(r.Deferred.getStackHook&&(k.stackTrace=r.Deferred.getStackHook()),a.setTimeout(k))}}return r.Deferred(function(a){c[0][3].add(g(0,a,r.isFunction(e)?e:N,a.notifyWith)),c[1][3].add(g(0,a,r.isFunction(b)?b:N)),c[2][3].add(g(0,a,r.isFunction(d)?d:O))}).promise()},promise:function(a){return null!=a?r.extend(a,e):e}},f={};return r.each(c,function(a,b){var g=b[2],h=b[5];e[b[1]]=g.add,h&&g.add(function(){d=h},c[3-a][2].disable,c[0][2].lock),g.add(b[3].fire),f[b[0]]=function(){return f[b[0]+"With"](this===f?void 0:this,arguments),this},f[b[0]+"With"]=g.fireWith}),e.promise(f),b&&b.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),e=f.call(arguments),g=r.Deferred(),h=function(a){return function(c){d[a]=this,e[a]=1<arguments.length?f.call(arguments):c,--b||g.resolveWith(d,e)}};if(1>=b&&(P(a,g.done(h(c)).resolve,g.reject,!b),"pending"===g.state()||r.isFunction(e[c]&&e[c].then)))return g.then();while(c--)P(e[c],h(c),g.reject);return g.promise()}});var Q=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;r.Deferred.exceptionHook=function(b,c){a.console&&a.console.warn&&b&&Q.test(b.name)&&a.console.warn("jQuery.Deferred exception: "+b.message,b.stack,c)},r.readyException=function(b){a.setTimeout(function(){throw b})};var R=r.Deferred();r.fn.ready=function(a){return R.then(a)["catch"](function(a){r.readyException(a)}),this},r.extend({isReady:!1,readyWait:1,ready:function(a){(!0===a?--r.readyWait:r.isReady)||(r.isReady=!0,!0!==a&&0<--r.readyWait||R.resolveWith(d,[r]))}}),r.ready.then=R.then;function S(){d.removeEventListener("DOMContentLoaded",S),a.removeEventListener("load",S),r.ready()}"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(r.ready):(d.addEventListener("DOMContentLoaded",S),a.addEventListener("load",S));var T=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===r.type(c)){e=!0;for(h in c)T(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,r.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(r(a),c)})),b))for(;h<i;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},U=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function V(){this.expando=r.expando+V.uid++}V.uid=1,V.prototype={cache:function(a){var b=a[this.expando];return b||(b={},U(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[r.camelCase(b)]=c;else for(d in b)e[r.camelCase(d)]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][r.camelCase(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d=a[this.expando];if(void 0!==d){if(void 0!==b){Array.isArray(b)?b=b.map(r.camelCase):(b=r.camelCase(b),b=b in d?[b]:b.match(L)||[]),c=b.length;while(c--)delete d[b[c]]}(void 0===b||r.isEmptyObject(d))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!r.isEmptyObject(b)}};var W=new V,X=new V,Y=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;function $(a){return"true"===a||"false"!==a&&("null"===a?null:a===+a+""?+a:Y.test(a)?JSON.parse(a):a)}function _(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Z,"-$&").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c=$(c)}catch(e){}X.set(a,b,c)}else c=void 0;return c}r.extend({hasData:function(a){return X.hasData(a)||W.hasData(a)},data:function(a,b,c){return X.access(a,b,c)},removeData:function(a,b){X.remove(a,b)},_data:function(a,b,c){return W.access(a,b,c)},_removeData:function(a,b){W.remove(a,b)}}),r.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=X.get(f),1===f.nodeType&&!W.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=r.camelCase(d.slice(5)),_(f,d,e[d])));W.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){X.set(this,a)}):T(this,function(b){var c;if(f&&void 0===b){if(c=X.get(f,a),void 0!==c)return c;if(c=_(f,a),void 0!==c)return c}else this.each(function(){X.set(this,a,b)})},null,b,1<arguments.length,null,!0)},removeData:function(a){return this.each(function(){X.remove(this,a)})}}),r.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=W.get(a,b),c&&(!d||Array.isArray(c)?d=W.access(a,b,r.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=r.queue(a,b),d=c.length,e=c.shift(),f=r._queueHooks(a,b),g=function(){r.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return W.get(a,c)||W.access(a,c,{empty:r.Callbacks("once memory").add(function(){W.remove(a,[b+"queue",c])})})}}),r.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?r.queue(this[0],a):void 0===b?this:this.each(function(){var c=r.queue(this,a,b);r._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&r.dequeue(this,a)})},dequeue:function(a){return this.each(function(){r.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=r.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=W.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var aa=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ba=new RegExp("^(?:([+-])=|)("+aa+")([a-z%]*)$","i"),ca=["Top","Right","Bottom","Left"],da=function(a,b){return a=b||a,"none"===a.style.display||""===a.style.display&&r.contains(a.ownerDocument,a)&&"none"===r.css(a,"display")},ea=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};function fa(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return r.css(a,b,"")},i=h(),j=c&&c[3]||(r.cssNumber[b]?"":"px"),k=(r.cssNumber[b]||"px"!==j&&+i)&&ba.exec(r.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,r.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var ga={};function ha(a){var b,c=a.ownerDocument,d=a.nodeName,e=ga[d];return e?e:(b=c.body.appendChild(c.createElement(d)),e=r.css(b,"display"),b.parentNode.removeChild(b),"none"===e&&(e="block"),ga[d]=e,e)}function ia(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)d=a[f],d.style&&(c=d.style.display,b?("none"===c&&(e[f]=W.get(d,"display")||null,e[f]||(d.style.display="")),""===d.style.display&&da(d)&&(e[f]=ha(d))):"none"!==c&&(e[f]="none",W.set(d,"display",c)));for(f=0;f<g;f++)null!=e[f]&&(a[f].style.display=e[f]);return a}r.fn.extend({show:function(){return ia(this,!0)},hide:function(){return ia(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){da(this)?r(this).show():r(this).hide()})}});var ja=/^(?:checkbox|radio)$/i,ka=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,la=/^$|\/(?:java|ecma)script/i,ma={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ma.optgroup=ma.option,ma.tbody=ma.tfoot=ma.colgroup=ma.caption=ma.thead,ma.th=ma.td;function na(a,b){var c;return c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[],void 0===b||b&&B(a,b)?r.merge([a],c):c}function oa(a,b){for(var c=0,d=a.length;c<d;c++)W.set(a[c],"globalEval",!b||W.get(b[c],"globalEval"))}var pa=/<|&#?\w+;/;function qa(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],n=0,o=a.length;n<o;n++)if(f=a[n],f||0===f)if("object"===r.type(f))r.merge(m,f.nodeType?[f]:f);else if(pa.test(f)){g=g||l.appendChild(b.createElement("div")),h=(ka.exec(f)||["",""])[1].toLowerCase(),i=ma[h]||ma._default,g.innerHTML=i[1]+r.htmlPrefilter(f)+i[2],k=i[0];while(k--)g=g.lastChild;r.merge(m,g.childNodes),g=l.firstChild,g.textContent=""}else m.push(b.createTextNode(f));l.textContent="",n=0;while(f=m[n++])if(d&&-1<r.inArray(f,d))e&&e.push(f);else if(j=r.contains(f.ownerDocument,f),g=na(l.appendChild(f),"script"),j&&oa(g),c){k=0;while(f=g[k++])la.test(f.type||"")&&c.push(f)}return l}!function(){var a=d.createDocumentFragment(),b=a.appendChild(d.createElement("div")),c=d.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),o.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",o.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var ra=d.documentElement,sa=/^key/,ta=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ua=/^([^.]*)(?:\.(.+)|)/;function va(){return!0}function wa(){return!1}function xa(){try{return d.activeElement}catch(a){}}function ya(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)ya(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),!1===e)e=wa;else if(!e)return a;return 1===f&&(g=e,e=function(a){return r().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=r.guid++)),a.each(function(){r.event.add(this,b,e,d,c)})}r.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=W.get(a);if(q){c.handler&&(f=c,c=f.handler,e=f.selector),e&&r.find.matchesSelector(ra,e),c.guid||(c.guid=r.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return"undefined"!=typeof r&&r.event.triggered!==b.type?r.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(L)||[""],j=b.length;while(j--)h=ua.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=r.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=r.event.special[n]||{},k=r.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&r.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&!1!==l.setup.call(a,d,o,g)||a.addEventListener&&a.addEventListener(n,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),r.event.global[n]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=W.hasData(a)&&W.get(a);if(q&&(i=q.events)){b=(b||"").match(L)||[""],j=b.length;while(j--)if(h=ua.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){l=r.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&!1!==l.teardown.call(a,o,q.handle)||r.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)r.event.remove(a,n+b[j],c,d,!0);r.isEmptyObject(i)&&W.remove(a,"handle events")}},dispatch:function(a){var b=r.event.fix(a),c,d,e,f,g,h,i=new Array(arguments.length),j=(W.get(this,"events")||{})[b.type]||[],k=r.event.special[b.type]||{};for(i[0]=b,c=1;c<arguments.length;c++)i[c]=arguments[c];if(b.delegateTarget=this,!k.preDispatch||!1!==k.preDispatch.call(this,b)){h=r.event.handlers.call(this,b,j),c=0;while((f=h[c++])&&!b.isPropagationStopped()){b.currentTarget=f.elem,d=0;while((g=f.handlers[d++])&&!b.isImmediatePropagationStopped())b.rnamespace&&!b.rnamespace.test(g.namespace)||(b.handleObj=g,b.data=g.data,e=((r.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&!1===(b.result=e)&&(b.preventDefault(),b.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,b),b.result}},handlers:function(a,b){var c,d,e,f,g,h=[],i=b.delegateCount,j=a.target;if(i&&j.nodeType&&!("click"===a.type&&1<=a.button))for(;j!==this;j=j.parentNode||this)if(1===j.nodeType&&("click"!==a.type||!0!==j.disabled)){for(f=[],g={},c=0;c<i;c++)d=b[c],e=d.selector+" ",void 0===g[e]&&(g[e]=d.needsContext?-1<r(e,this).index(j):r.find(e,this,null,[j]).length),g[e]&&f.push(d);f.length&&h.push({elem:j,handlers:f})}return j=this,i<b.length&&h.push({elem:j,handlers:b.slice(i)}),h},addProp:function(a,b){Object.defineProperty(r.Event.prototype,a,{enumerable:!0,configurable:!0,get:r.isFunction(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[r.expando]?a:new r.Event(a)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==xa()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===xa()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&B(this,"input"))return this.click(),!1},_default:function(a){return B(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},r.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},r.Event=function(a,b){return this instanceof r.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?va:wa,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,b&&r.extend(this,b),this.timeStamp=a&&a.timeStamp||r.now(),void(this[r.expando]=!0)):new r.Event(a,b)},r.Event.prototype={constructor:r.Event,isDefaultPrevented:wa,isPropagationStopped:wa,isImmediatePropagationStopped:wa,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=va,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=va,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=va,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},r.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&sa.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&ta.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},r.event.addProp),r.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){r.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||r.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),r.fn.extend({on:function(a,b,c,d){return ya(this,a,b,c,d)},one:function(a,b,c,d){return ya(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,r(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return!1!==b&&"function"!=typeof b||(c=b,b=void 0),!1===c&&(c=wa),this.each(function(){r.event.remove(this,a,c,b)})}});var za=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Aa=/<script|<style|<link/i,Ba=/checked\s*(?:[^=]|=\s*.checked.)/i,Ca=/^true\/(.*)/,Da=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ea(a,b){return B(a,"table")&&B(11!==b.nodeType?b:b.firstChild,"tr")?r(">tbody",a)[0]||a:a}function Fa(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function Ga(a){var b=Ca.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ha(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(W.hasData(a)&&(f=W.access(a),g=W.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;c<d;c++)r.event.add(b,e,j[e][c])}X.hasData(a)&&(h=X.access(a),i=r.extend({},h),X.set(b,i))}}function Ia(a,b){var c=b.nodeName.toLowerCase();"input"===c&&ja.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function Ja(a,b,c,d){b=g.apply([],b);var e,f,h,i,j,k,l=0,m=a.length,n=m-1,q=b[0],s=r.isFunction(q);if(s||1<m&&"string"==typeof q&&!o.checkClone&&Ba.test(q))return a.each(function(e){var f=a.eq(e);s&&(b[0]=q.call(this,e,f.html())),Ja(f,b,c,d)});if(m&&(e=qa(b,a[0].ownerDocument,!1,a,d),f=e.firstChild,1===e.childNodes.length&&(e=f),f||d)){for(h=r.map(na(e,"script"),Fa),i=h.length;l<m;l++)j=e,l!==n&&(j=r.clone(j,!0,!0),i&&r.merge(h,na(j,"script"))),c.call(a[l],j,l);if(i)for(k=h[h.length-1].ownerDocument,r.map(h,Ga),l=0;l<i;l++)j=h[l],la.test(j.type||"")&&!W.access(j,"globalEval")&&r.contains(k,j)&&(j.src?r._evalUrl&&r._evalUrl(j.src):p(j.textContent.replace(Da,""),k))}return a}function Ka(a,b,c){for(var d,e=b?r.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||r.cleanData(na(d)),d.parentNode&&(c&&r.contains(d.ownerDocument,d)&&oa(na(d,"script")),d.parentNode.removeChild(d));return a}r.extend({htmlPrefilter:function(a){return a.replace(za,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=r.contains(a.ownerDocument,a);if(!(o.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||r.isXMLDoc(a)))for(g=na(h),f=na(a),d=0,e=f.length;d<e;d++)Ia(f[d],g[d]);if(b)if(c)for(f=f||na(a),g=g||na(h),d=0,e=f.length;d<e;d++)Ha(f[d],g[d]);else Ha(a,h);return g=na(h,"script"),0<g.length&&oa(g,!i&&na(a,"script")),h},cleanData:function(a){for(var b,c,d,e=r.event.special,f=0;void 0!==(c=a[f]);f++)if(U(c)){if(b=c[W.expando]){if(b.events)for(d in b.events)e[d]?r.event.remove(c,d):r.removeEvent(c,d,b.handle);c[W.expando]=void 0}c[X.expando]&&(c[X.expando]=void 0)}}}),r.fn.extend({detach:function(a){return Ka(this,a,!0)},remove:function(a){return Ka(this,a)},text:function(a){return T(this,function(a){return void 0===a?r.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return Ja(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ea(this,a);b.appendChild(a)}})},prepend:function(){return Ja(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ea(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ja(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ja(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(r.cleanData(na(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return r.clone(this,a,b)})},html:function(a){return T(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Aa.test(a)&&!ma[(ka.exec(a)||["",""])[1].toLowerCase()]){a=r.htmlPrefilter(a);try{for(;c<d;c++)b=this[c]||{},1===b.nodeType&&(r.cleanData(na(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ja(this,arguments,function(b){var c=this.parentNode;0>r.inArray(this,a)&&(r.cleanData(na(this)),c&&c.replaceChild(b,this))},a)}}),r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){r.fn[a]=function(a){for(var c,d=[],e=r(a),f=e.length-1,g=0;g<=f;g++)c=g===f?this:this.clone(!0),r(e[g])[b](c),h.apply(d,c.get());return this.pushStack(d)}});var La=/^margin/,Ma=new RegExp("^("+aa+")(?!px)[a-z%]+$","i"),Na=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)};!function(){function b(){if(i){i.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",i.innerHTML="",ra.appendChild(h);var b=a.getComputedStyle(i);c="1%"!==b.top,g="2px"===b.marginLeft,e="4px"===b.width,i.style.marginRight="50%",f="4px"===b.marginRight,ra.removeChild(h),i=null}}var c,e,f,g,h=d.createElement("div"),i=d.createElement("div");i.style&&(i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",o.clearCloneStyle="content-box"===i.style.backgroundClip,h.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",h.appendChild(i),r.extend(o,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return b(),e},pixelMarginRight:function(){return b(),f},reliableMarginLeft:function(){return b(),g}}))}();function Oa(a,b,c){var d,e,f,g,h=a.style;return c=c||Na(a),c&&(g=c.getPropertyValue(b)||c[b],""!==g||r.contains(a.ownerDocument,a)||(g=r.style(a,b)),!o.pixelMarginRight()&&Ma.test(g)&&La.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function Pa(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Qa=/^(none|table(?!-c[ea]).+)/,Ra=/^--/,Sa={position:"absolute",visibility:"hidden",display:"block"},Ta={letterSpacing:"0",fontWeight:"400"},Ua=["Webkit","Moz","ms"],Va=d.createElement("div").style;function Wa(a){if(a in Va)return a;var b=a[0].toUpperCase()+a.slice(1),c=Ua.length;while(c--)if(a=Ua[c]+b,a in Va)return a}function Xa(a){var b=r.cssProps[a];return b||(b=r.cssProps[a]=Wa(a)||a),b}function Ya(a,b,c){var d=ba.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function Za(a,b,c,d,e){var f,g=0;for(f=c===(d?"border":"content")?4:"width"===b?1:0;4>f;f+=2)"margin"===c&&(g+=r.css(a,c+ca[f],!0,e)),d?("content"===c&&(g-=r.css(a,"padding"+ca[f],!0,e)),"margin"!==c&&(g-=r.css(a,"border"+ca[f]+"Width",!0,e))):(g+=r.css(a,"padding"+ca[f],!0,e),"padding"!==c&&(g+=r.css(a,"border"+ca[f]+"Width",!0,e)));return g}function $a(a,b,c){var d,e=Na(a),f=Oa(a,b,e),g="border-box"===r.css(a,"boxSizing",!1,e);return Ma.test(f)?f:(d=g&&(o.boxSizingReliable()||f===a.style[b]),"auto"===f&&(f=a["offset"+b[0].toUpperCase()+b.slice(1)]),f=parseFloat(f)||0,f+Za(a,b,c||(g?"border":"content"),d,e)+"px")}r.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Oa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=r.camelCase(b),i=Ra.test(b),j=a.style;return i||(b=Xa(h)),g=r.cssHooks[b]||r.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:j[b]:(f=typeof c,"string"===f&&(e=ba.exec(c))&&e[1]&&(c=fa(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(r.cssNumber[h]?"":"px")),o.clearCloneStyle||""!==c||0!==b.indexOf("background")||(j[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i?j.setProperty(b,c):j[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=r.camelCase(b),i=Ra.test(b);return i||(b=Xa(h)),g=r.cssHooks[b]||r.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Oa(a,b,d)),"normal"===e&&b in Ta&&(e=Ta[b]),""===c||c?(f=parseFloat(e),!0===c||isFinite(f)?f||0:e):e}}),r.each(["height","width"],function(a,b){r.cssHooks[b]={get:function(a,c,d){if(c)return!Qa.test(r.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?$a(a,b,d):ea(a,Sa,function(){return $a(a,b,d)})},set:function(a,c,d){var e,f=d&&Na(a),g=d&&Za(a,b,d,"border-box"===r.css(a,"boxSizing",!1,f),f);return g&&(e=ba.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=r.css(a,b)),Ya(a,c,g)}}}),r.cssHooks.marginLeft=Pa(o.reliableMarginLeft,function(a,b){if(b)return(parseFloat(Oa(a,"marginLeft"))||a.getBoundingClientRect().left-ea(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),r.each({margin:"",padding:"",border:"Width"},function(a,b){r.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+ca[d]+b]=f[d]||f[d-2]||f[0];return e}},La.test(a)||(r.cssHooks[a+b].set=Ya)}),r.fn.extend({css:function(a,b){return T(this,function(a,b,c){var d,e,f={},g=0;if(Array.isArray(b)){for(d=Na(a),e=b.length;g<e;g++)f[b[g]]=r.css(a,b[g],!1,d);return f}return void 0!==c?r.style(a,b,c):r.css(a,b)},a,b,1<arguments.length)}});function _a(a,b,c,d,e){return new _a.prototype.init(a,b,c,d,e)}r.Tween=_a,_a.prototype={constructor:_a,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||r.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(r.cssNumber[c]?"":"px")},cur:function(){var a=_a.propHooks[this.prop];return a&&a.get?a.get(this):_a.propHooks._default.get(this)},run:function(a){var b,c=_a.propHooks[this.prop];return this.options.duration?this.pos=b=r.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):_a.propHooks._default.set(this),this}},_a.prototype.init.prototype=_a.prototype,_a.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=r.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){r.fx.step[a.prop]?r.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[r.cssProps[a.prop]]&&!r.cssHooks[a.prop]?a.elem[a.prop]=a.now:r.style(a.elem,a.prop,a.now+a.unit)}}},_a.propHooks.scrollTop=_a.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},r.easing={linear:function(a){return a},swing:function(a){return .5-Math.cos(a*Math.PI)/2},_default:"swing"},r.fx=_a.prototype.init,r.fx.step={};var ab,bb,cb=/^(?:toggle|show|hide)$/,db=/queueHooks$/;function eb(){bb&&(!1===d.hidden&&a.requestAnimationFrame?a.requestAnimationFrame(eb):a.setTimeout(eb,r.fx.interval),r.fx.tick())}function fb(){return a.setTimeout(function(){ab=void 0}),ab=r.now()}function gb(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=ca[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function hb(a,b,c){for(var d,e=(kb.tweeners[b]||[]).concat(kb.tweeners["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function ib(a,b,c){var d,e,f,g,h,i,j,k,l="width"in b||"height"in b,m=this,n={},o=a.style,p=a.nodeType&&da(a),q=W.get(a,"fxshow");c.queue||(g=r._queueHooks(a,"fx"),null==g.unqueued&&(g.unqueued=0,h=g.empty.fire,g.empty.fire=function(){g.unqueued||h()}),g.unqueued++,m.always(function(){m.always(function(){g.unqueued--,r.queue(a,"fx").length||g.empty.fire()})}));for(d in b)if(e=b[d],cb.test(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}n[d]=q&&q[d]||r.style(a,d)}if(i=!r.isEmptyObject(b),i||!r.isEmptyObject(n)){l&&1===a.nodeType&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=q&&q.display,null==j&&(j=W.get(a,"display")),k=r.css(a,"display"),"none"===k&&(j?k=j:(ia([a],!0),j=a.style.display||j,k=r.css(a,"display"),ia([a]))),("inline"===k||"inline-block"===k&&null!=j)&&"none"===r.css(a,"float")&&(i||(m.done(function(){o.display=j}),null==j&&(k=o.display,j="none"===k?"":k)),o.display="inline-block")),c.overflow&&(o.overflow="hidden",m.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),i=!1;for(d in n)i||(q?"hidden"in q&&(p=q.hidden):q=W.access(a,"fxshow",{display:j}),f&&(q.hidden=!p),p&&ia([a],!0),m.done(function(){p||ia([a]),W.remove(a,"fxshow");for(d in n)r.style(a,d,n[d])})),i=hb(p?q[d]:0,d,m),d in q||(q[d]=i.start,p&&(i.end=i.start,i.start=0))}}function jb(a,b){var c,d,e,f,g;for(c in a)if(d=r.camelCase(c),e=b[d],f=a[c],Array.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=r.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function kb(a,b,c){var d,e,f=0,g=kb.prefilters.length,h=r.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=ab||fb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;g<i;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(i||h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:r.extend({},b),opts:r.extend(!0,{specialEasing:{},easing:r.easing._default},c),originalProperties:b,originalOptions:c,startTime:ab||fb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=r.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;c<d;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(jb(k,j.opts.specialEasing);f<g;f++)if(d=kb.prefilters[f].call(j,a,k,j.opts))return r.isFunction(d.stop)&&(r._queueHooks(j.elem,j.opts.queue).stop=r.proxy(d.stop,d)),d;return r.map(k,hb,j),r.isFunction(j.opts.start)&&j.opts.start.call(a,j),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always),r.fx.timer(r.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j}r.Animation=r.extend(kb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return fa(c.elem,a,ba.exec(b),c),c}]},tweener:function(a,b){r.isFunction(a)?(b=a,a=["*"]):a=a.match(L);for(var c,d=0,e=a.length;d<e;d++)c=a[d],kb.tweeners[c]=kb.tweeners[c]||[],kb.tweeners[c].unshift(b)},prefilters:[ib],prefilter:function(a,b){b?kb.prefilters.unshift(a):kb.prefilters.push(a)}}),r.speed=function(a,b,c){var d=a&&"object"==typeof a?r.extend({},a):{complete:c||!c&&b||r.isFunction(a)&&a,duration:a,easing:c&&b||b&&!r.isFunction(b)&&b};return r.fx.off?d.duration=0:"number"!=typeof d.duration&&(d.duration in r.fx.speeds?d.duration=r.fx.speeds[d.duration]:d.duration=r.fx.speeds._default),null!=d.queue&&!0!==d.queue||(d.queue="fx"),d.old=d.complete,d.complete=function(){r.isFunction(d.old)&&d.old.call(this),d.queue&&r.dequeue(this,d.queue)},d},r.fn.extend({fadeTo:function(a,b,c,d){return this.filter(da).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=r.isEmptyObject(a),f=r.speed(b,c,d),g=function(){var b=kb(this,r.extend({},a),f);(e||W.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||!1===f.queue?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&!1!==a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=r.timers,g=W.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&db.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||r.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var b,c=W.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=r.timers,g=d?d.length:0;for(c.finish=!0,r.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),r.each(["toggle","show","hide"],function(a,b){var c=r.fn[b];r.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gb(b,!0),a,d,e)}}),r.each({slideDown:gb("show"),slideUp:gb("hide"),slideToggle:gb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){r.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),r.timers=[],r.fx.tick=function(){var a,b=0,c=r.timers;for(ab=r.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||r.fx.stop(),ab=void 0},r.fx.timer=function(a){r.timers.push(a),r.fx.start()},r.fx.interval=13,r.fx.start=function(){bb||(bb=!0,eb())},r.fx.stop=function(){bb=null},r.fx.speeds={slow:600,fast:200,_default:400},r.fn.delay=function(b,c){return b=r.fx?r.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement("input"),b=d.createElement("select"),c=b.appendChild(d.createElement("option"));a.type="checkbox",o.checkOn=""!==a.value,o.optSelected=c.selected,a=d.createElement("input"),a.value="t",a.type="radio",o.radioValue="t"===a.value}();var lb,mb=r.expr.attrHandle;r.fn.extend({attr:function(a,b){return T(this,r.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){r.removeAttr(this,a)})}}),r.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?r.prop(a,b,c):(1===f&&r.isXMLDoc(a)||(e=r.attrHooks[b.toLowerCase()]||(r.expr.match.bool.test(b)?lb:void 0)),void 0!==c?null===c?void r.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=r.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!o.radioValue&&"radio"===b&&B(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d=0,e=b&&b.match(L);if(e&&1===a.nodeType)while(c=e[d++])a.removeAttribute(c)}}),lb={set:function(a,b,c){return!1===b?r.removeAttr(a,c):a.setAttribute(c,c),c}},r.each(r.expr.match.bool.source.match(/\w+/g),function(a,b){var c=mb[b]||r.find.attr;mb[b]=function(a,b,d){var e,f,g=b.toLowerCase();return d||(f=mb[g],mb[g]=e,e=null!=c(a,b,d)?g:null,mb[g]=f),e}});var nb=/^(?:input|select|textarea|button)$/i,ob=/^(?:a|area)$/i;r.fn.extend({prop:function(a,b){return T(this,r.prop,a,b,1<arguments.length)},removeProp:function(a){return this.each(function(){delete this[r.propFix[a]||a]})}}),r.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&r.isXMLDoc(a)||(b=r.propFix[b]||b,e=r.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=r.find.attr(a,"tabindex");return b?parseInt(b,10):nb.test(a.nodeName)||ob.test(a.nodeName)&&a.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),o.optSelected||(r.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),r.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){r.propFix[this.toLowerCase()]=this});function pb(a){var b=a.match(L)||[];return b.join(" ")}function qb(a){return a.getAttribute&&a.getAttribute("class")||""}r.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).addClass(a.call(this,b,qb(this)))});if("string"==typeof a&&a){b=a.match(L)||[];while(c=this[i++])if(e=qb(c),d=1===c.nodeType&&" "+pb(e)+" "){g=0;while(f=b[g++])0>d.indexOf(" "+f+" ")&&(d+=f+" ");h=pb(d),e!==h&&c.setAttribute("class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).removeClass(a.call(this,b,qb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(L)||[];while(c=this[i++])if(e=qb(c),d=1===c.nodeType&&" "+pb(e)+" "){g=0;while(f=b[g++])while(-1<d.indexOf(" "+f+" "))d=d.replace(" "+f+" "," ");h=pb(d),e!==h&&c.setAttribute("class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):r.isFunction(a)?this.each(function(c){r(this).toggleClass(a.call(this,c,qb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=r(this),f=a.match(L)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=qb(this),b&&W.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||!1===a?"":W.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&-1<(" "+pb(qb(c))+" ").indexOf(b))return!0;return!1}});var rb=/\r/g;r.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=r.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,r(this).val()):a,null==e?e="":"number"==typeof e?e+="":Array.isArray(e)&&(e=r.map(e,function(a){return null==a?"":a+""})),b=r.valHooks[this.type]||r.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=r.valHooks[e.type]||r.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(rb,""):null==c?"":c)}}}),r.extend({valHooks:{option:{get:function(a){var b=r.find.attr(a,"value");return null!=b?b:pb(r.text(a))}},select:{get:function(a){var b,c,d,e=a.options,f=a.selectedIndex,g="select-one"===a.type,h=g?null:[],i=g?f+1:e.length;for(d=0>f?i:g?f:0;d<i;d++)if(c=e[d],(c.selected||d===f)&&!c.disabled&&(!c.parentNode.disabled||!B(c.parentNode,"optgroup"))){if(b=r(c).val(),g)return b;h.push(b)}return h},set:function(a,b){var c,d,e=a.options,f=r.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=-1<r.inArray(r.valHooks.option.get(d),f))&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),r.each(["radio","checkbox"],function(){r.valHooks[this]={set:function(a,b){if(Array.isArray(b))return a.checked=-1<r.inArray(r(a).val(),b)}},o.checkOn||(r.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var sb=/^(?:focusinfocus|focusoutblur)$/;r.extend(r.event,{trigger:function(b,c,e,f){var g,h,i,j,k,m,n,o=[e||d],p=l.call(b,"type")?b.type:b,q=l.call(b,"namespace")?b.namespace.split("."):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!sb.test(p+r.event.triggered)&&(-1<p.indexOf(".")&&(q=p.split("."),p=q.shift(),q.sort()),k=0>p.indexOf(":")&&"on"+p,b=b[r.expando]?b:new r.Event(p,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=q.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:r.makeArray(c,[b]),n=r.event.special[p]||{},f||!n.trigger||!1!==n.trigger.apply(e,c))){if(!f&&!n.noBubble&&!r.isWindow(e)){for(j=n.delegateType||p,sb.test(j+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),i=h;i===(e.ownerDocument||d)&&o.push(i.defaultView||i.parentWindow||a)}g=0;while((h=o[g++])&&!b.isPropagationStopped())b.type=1<g?j:n.bindType||p,m=(W.get(h,"events")||{})[b.type]&&W.get(h,"handle"),m&&m.apply(h,c),m=k&&h[k],m&&m.apply&&U(h)&&(b.result=m.apply(h,c),!1===b.result&&b.preventDefault());return b.type=p,f||b.isDefaultPrevented()||n._default&&!1!==n._default.apply(o.pop(),c)||!U(e)||k&&r.isFunction(e[p])&&!r.isWindow(e)&&(i=e[k],i&&(e[k]=null),r.event.triggered=p,e[p](),r.event.triggered=void 0,i&&(e[k]=i)),b.result}},simulate:function(a,b,c){var d=r.extend(new r.Event,c,{type:a,isSimulated:!0});r.event.trigger(d,null,b)}}),r.fn.extend({trigger:function(a,b){return this.each(function(){r.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return r.event.trigger(a,b,c,!0)}}),r.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,b){r.fn[b]=function(a,c){return 0<arguments.length?this.on(b,null,a,c):this.trigger(b)}}),r.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),o.focusin="onfocusin"in a,o.focusin||r.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){r.event.simulate(b,a.target,r.event.fix(a))};r.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=W.access(d,b);e||d.addEventListener(a,c,!0),W.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=W.access(d,b)-1;e?W.access(d,b,e):(d.removeEventListener(a,c,!0),W.remove(d,b))}}});var tb=a.location,ub=r.now(),vb=/\?/;r.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=new a.DOMParser().parseFromString(b,"text/xml")}catch(d){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||r.error("Invalid XML: "+b),c};var wb=/\[\]$/,xb=/\r?\n/g,yb=/^(?:submit|button|image|reset|file)$/i,zb=/^(?:input|select|textarea|keygen)/i;function Ab(a,b,c,d){var e;if(Array.isArray(b))r.each(b,function(b,e){c||wb.test(a)?d(a,e):Ab(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==r.type(b))d(a,b);else for(e in b)Ab(a+"["+e+"]",b[e],c,d)}r.param=function(a,b){var c,d=[],e=function(a,b){var c=r.isFunction(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(Array.isArray(a)||a.jquery&&!r.isPlainObject(a))r.each(a,function(){e(this.name,this.value)});else for(c in a)Ab(c,a[c],b,e);return d.join("&")},r.fn.extend({serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=r.prop(this,"elements");return a?r.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!r(this).is(":disabled")&&zb.test(this.nodeName)&&!yb.test(a)&&(this.checked||!ja.test(a))}).map(function(a,b){var c=r(this).val();return null==c?null:Array.isArray(c)?r.map(c,function(a){return{name:b.name,value:a.replace(xb,"\r\n")}}):{name:b.name,value:c.replace(xb,"\r\n")}}).get()}});var Bb=/%20/g,Cb=/#.*$/,Db=/([?&])_=[^&]*/,Eb=/^(.*?):[ \t]*([^\r\n]*)$/gm,Fb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Gb=/^(?:GET|HEAD)$/,Hb=/^\/\//,Ib={},Jb={},Kb="*/".concat("*"),Lb=d.createElement("a");Lb.href=tb.href;function Mb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(L)||[];if(r.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Nb(a,b,c,d){var e={},f=a===Jb;function g(h){var i;return e[h]=!0,r.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Ob(a,b){var c,d,e=r.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&r.extend(!0,a,d),a}function Pb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}if(f)return f!==i[0]&&i.unshift(f),c[f]}function Qb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){!0===g?g=j[e]:!0!==j[e]&&(f=h[0],k.unshift(h[1]));break}if(!0!==g)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}r.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:tb.href,type:"GET",isLocal:Fb.test(tb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Kb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":r.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Ob(Ob(a,r.ajaxSettings),b):Ob(r.ajaxSettings,a)},ajaxPrefilter:Mb(Ib),ajaxTransport:Mb(Jb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m,n,o=r.ajaxSetup({},c),p=o.context||o,q=o.context&&(p.nodeType||p.jquery)?r(p):r.event,s=r.Deferred(),t=r.Callbacks("once memory"),u=o.statusCode||{},v={},w={},x="canceled",y={readyState:0,getResponseHeader:function(a){var b;if(k){if(!h){h={};while(b=Eb.exec(g))h[b[1].toLowerCase()]=b[2]}b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return k?g:null},setRequestHeader:function(a,b){return null==k&&(a=w[a.toLowerCase()]=w[a.toLowerCase()]||a,v[a]=b),this},overrideMimeType:function(a){return null==k&&(o.mimeType=a),this},statusCode:function(a){var b;if(a)if(k)y.always(a[y.status]);else for(b in a)u[b]=[u[b],a[b]];return this},abort:function(a){var b=a||x;return e&&e.abort(b),A(0,b),this}};if(s.promise(y),o.url=((b||o.url||tb.href)+"").replace(Hb,tb.protocol+"//"),o.type=c.method||c.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(L)||[""],null==o.crossDomain){j=d.createElement("a");try{j.href=o.url,j.href=j.href,o.crossDomain=Lb.protocol+"//"+Lb.host!=j.protocol+"//"+j.host}catch(z){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=r.param(o.data,o.traditional)),Nb(Ib,o,c,y),k)return y;l=r.event&&o.global,l&&0===r.active++&&r.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!Gb.test(o.type),f=o.url.replace(Cb,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(Bb,"+")):(n=o.url.slice(f.length),o.data&&(f+=(vb.test(f)?"&":"?")+o.data,delete o.data),!1===o.cache&&(f=f.replace(Db,"$1"),n=(vb.test(f)?"&":"?")+"_="+ub++ +n),o.url=f+n),o.ifModified&&(r.lastModified[f]&&y.setRequestHeader("If-Modified-Since",r.lastModified[f]),r.etag[f]&&y.setRequestHeader("If-None-Match",r.etag[f])),(o.data&&o.hasContent&&!1!==o.contentType||c.contentType)&&y.setRequestHeader("Content-Type",o.contentType),y.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+Kb+"; q=0.01":""):o.accepts["*"]);for(m in o.headers)y.setRequestHeader(m,o.headers[m]);if(o.beforeSend&&(!1===o.beforeSend.call(p,y,o)||k))return y.abort();if(x="abort",t.add(o.complete),y.done(o.success),y.fail(o.error),e=Nb(Jb,o,c,y)){if(y.readyState=1,l&&q.trigger("ajaxSend",[y,o]),k)return y;o.async&&0<o.timeout&&(i=a.setTimeout(function(){y.abort("timeout")},o.timeout));try{k=!1,e.send(v,A)}catch(z){if(k)throw z;A(-1,z)}}else A(-1,"No Transport");function A(b,c,d,h){var j,m,n,v,w,x=c;k||(k=!0,i&&a.clearTimeout(i),e=void 0,g=h||"",y.readyState=0<b?4:0,j=200<=b&&300>b||304===b,d&&(v=Pb(o,y,d)),v=Qb(o,v,y,j),j?(o.ifModified&&(w=y.getResponseHeader("Last-Modified"),w&&(r.lastModified[f]=w),w=y.getResponseHeader("etag"),w&&(r.etag[f]=w)),204===b||"HEAD"===o.type?x="nocontent":304===b?x="notmodified":(x=v.state,m=v.data,n=v.error,j=!n)):(n=x,!b&&x||(x="error",0>b&&(b=0))),y.status=b,y.statusText=(c||x)+"",j?s.resolveWith(p,[m,x,y]):s.rejectWith(p,[y,x,n]),y.statusCode(u),u=void 0,l&&q.trigger(j?"ajaxSuccess":"ajaxError",[y,o,j?m:n]),t.fireWith(p,[y,x]),l&&(q.trigger("ajaxComplete",[y,o]),--r.active||r.event.trigger("ajaxStop")))}return y},getJSON:function(a,b,c){return r.get(a,b,c,"json")},getScript:function(a,b){return r.get(a,void 0,b,"script")}}),r.each(["get","post"],function(a,b){r[b]=function(a,c,d,e){return r.isFunction(c)&&(e=e||d,d=c,c=void 0),r.ajax(r.extend({url:a,type:b,dataType:e,data:c,success:d},r.isPlainObject(a)&&a))}}),r._evalUrl=function(a){return r.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},r.fn.extend({wrapAll:function(a){var b;return this[0]&&(r.isFunction(a)&&(a=a.call(this[0])),b=r(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return r.isFunction(a)?this.each(function(b){r(this).wrapInner(a.call(this,b))}):this.each(function(){var b=r(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=r.isFunction(a);return this.each(function(c){r(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){r(this).replaceWith(this.childNodes)}),this}}),r.expr.pseudos.hidden=function(a){return!r.expr.pseudos.visible(a)},r.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},r.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Rb={0:200,1223:204},Sb=r.ajaxSettings.xhr();o.cors=!!Sb&&"withCredentials"in Sb,o.ajax=Sb=!!Sb,r.ajaxTransport(function(b){var c,d;if(o.cors||Sb&&!b.crossDomain)return{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Rb[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}}),r.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),r.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return r.globalEval(a),a}}}),r.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),r.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=r("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&f("error"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Tb=[],Ub=/(=)\?(?=&|$)|\?\?/;r.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Tb.pop()||r.expando+"_"+ub++;return this[a]=!0,a}}),r.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=!1!==b.jsonp&&(Ub.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ub.test(b.data)&&"data");if(h||"jsonp"===b.dataTypes[0])return e=b.jsonpCallback=r.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Ub,"$1"+e):!1!==b.jsonp&&(b.url+=(vb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||r.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?r(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Tb.push(e)),g&&r.isFunction(f)&&f(g[0]),g=f=void 0}),"script"}),o.createHTMLDocument=function(){var a=d.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",2===a.childNodes.length}(),r.parseHTML=function(a,b,c){if("string"!=typeof a)return[];"boolean"==typeof b&&(c=b,b=!1);var e,f,g;return b||(o.createHTMLDocument?(b=d.implementation.createHTMLDocument(""),e=b.createElement("base"),e.href=d.location.href,b.head.appendChild(e)):b=d),f=C.exec(a),g=!c&&[],f?[b.createElement(f[1])]:(f=qa([a],b,g),g&&g.length&&r(g).remove(),r.merge([],f.childNodes))},r.fn.load=function(a,b,c){var d,e,f,g=this,h=a.indexOf(" ");return-1<h&&(d=pb(a.slice(h)),a=a.slice(0,h)),r.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),0<g.length&&r.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?r("<div>").append(r.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},r.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){r.fn[b]=function(a){return this.on(b,a)}}),r.expr.pseudos.animated=function(a){return r.grep(r.timers,function(b){return a===b.elem}).length},r.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=r.css(a,"position"),l=r(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=r.css(a,"top"),i=r.css(a,"left"),j=("absolute"===k||"fixed"===k)&&-1<(f+i).indexOf("auto"),j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),r.isFunction(b)&&(b=b.call(a,c,r.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},r.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){r.offset.setOffset(this,a,b)});var b,c,d,e,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),b=f.ownerDocument,c=b.documentElement,e=b.defaultView,{top:d.top+e.pageYOffset-c.clientTop,left:d.left+e.pageXOffset-c.clientLeft}):{top:0,left:0}},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===r.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),B(a[0],"html")||(d=a.offset()),d={top:d.top+r.css(a[0],"borderTopWidth",!0),left:d.left+r.css(a[0],"borderLeftWidth",!0)}),{top:b.top-d.top-r.css(c,"marginTop",!0),left:b.left-d.left-r.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&"static"===r.css(a,"position"))a=a.offsetParent;return a||ra})}}),r.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;r.fn[a]=function(d){return T(this,function(a,d,e){var f;return r.isWindow(a)?f=a:9===a.nodeType&&(f=a.defaultView),void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),r.each(["top","left"],function(a,b){r.cssHooks[b]=Pa(o.pixelPosition,function(a,c){if(c)return c=Oa(a,b),Ma.test(c)?r(a).position()[b]+"px":c})}),r.each({Height:"height",Width:"width"},function(a,b){r.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){r.fn[d]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(!0===e||!0===f?"margin":"border");return T(this,function(b,c,e){var f;return r.isWindow(b)?0===d.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):void 0===e?r.css(b,c,h):r.style(b,c,e,h)},b,g?e:void 0,g)}})}),r.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),r.holdReady=function(a){a?r.readyWait++:r.ready(!0)},r.isArray=Array.isArray,r.parseJSON=JSON.parse,r.nodeName=B,"function"==typeof define&&define.amd&&define("jquery",[],function(){return r});var Vb=a.jQuery,Wb=a.$;return r.noConflict=function(b){return a.$===r&&(a.$=Wb),b&&a.jQuery===r&&(a.jQuery=Vb),r},b||(a.jQuery=a.$=r),r});;;;;(function(factory){if("function"===typeof define&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}})(function($){var pluses=/\+/g;function raw(s){return s}function decoded(s){try{return decodeURIComponent(s.replace(pluses," "))}catch(e){return s}}function converted(s){if(0===s.indexOf("\"")){s=s.slice(1,-1).replace(/\\"/g,"\"").replace(/\\\\/g,"\\")}try{return config.json?JSON.parse(s):s}catch(er){}}var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if("number"===typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}value=config.json?JSON.stringify(value):String(value);return document.cookie=[config.raw?key:encodeURIComponent(key),"=",config.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var decode=config.raw?raw:decoded;var cookies=document.cookie.split("; ");var result=key?undefined:{};for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split("=");var name=decode(parts.shift());var cookie=decode(parts.join("="));if(key&&key===name){result=converted(cookie);break}if(!key){result[name]=converted(cookie)}}return result};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==undefined){$.cookie(key,"",$.extend({},options,{expires:-1}));return true}return false}});;;;;;;;(function($){$.extend({oauth2Client:{begin:function(opts){opts=$.extend({clientId:false,authorizeUrl:false,redirectUri:window.location.href,responseType:"code"},opts);window.location.href=opts.authorizeUrl+"?client_id="+opts.clientId+"&response_type="+opts.responseType+"&redirect_uri="+opts.redirectUri},end:function(opts,fn,errFn){opts=$.extend({code:false,clientId:false,clientSecret:false,accessTokenUrl:false,redirectUri:window.location.href,userInfoUrl:false},opts);if(!opts.code)return;$.ajax({async:false,url:opts.accessTokenUrl,type:"post",data:{grant_type:"authorization_code",client_id:opts.clientId,client_secret:opts.clientSecret,code:opts.code,redirect_uri:opts.redirectUri},success:function(data){if(data){if("string"===typeof data){data=$.parseJSON(data)}var accessToken=data.access_token;var expiresIn=data.expires_in}fn(accessToken,expiresIn)},error:function(XMLHttpRequest,textStatus,errorThrown){errFn(XMLHttpRequest,textStatus,errorThrown)},complete:function(XMLHttpRequest,textStatus){}})}}})})(jQuery);;;;(function(){function n(n,t,e){e=(e||0)-1;for(var r=n?n.length:0;++e<r;)if(n[e]===t)return e;return-1}function t(t,e){var r=typeof e;if(t=t.l,"boolean"==r||null==e)return t[e]?0:-1;"number"!=r&&"string"!=r&&(r="object");var u="number"==r?e:m+e;return t=(t=t[r])&&t[u],"object"==r?t&&-1<n(t,e)?0:-1:t?0:-1}function e(n){var t=this.l,e=typeof n;if("boolean"==e||null==n)t[n]=true;else{"number"!=e&&"string"!=e&&(e="object");var r="number"==e?n:m+n,t=t[e]||(t[e]={});"object"==e?(t[r]||(t[r]=[])).push(n):t[r]=true}}function r(n){return n.charCodeAt(0)}function u(n,t){for(var e=n.m,r=t.m,u=-1,o=e.length;++u<o;){var i=e[u],a=r[u];if(i!==a){if(i>a||"undefined"==typeof i)return 1;if(i<a||"undefined"==typeof a)return-1}}return n.n-t.n}function o(n){var t=-1,r=n.length,u=n[0],o=n[0|r/2],i=n[r-1];if(u&&"object"==typeof u&&o&&"object"==typeof o&&i&&"object"==typeof i)return false;for(u=f(),u["false"]=u["null"]=u["true"]=u.undefined=false,o=f(),o.k=n,o.l=u,o.push=e;++t<r;)o.push(n[t]);return o}function i(n){return"\\"+U[n]}function a(){return h.pop()||[]}function f(){return g.pop()||{k:null,l:null,m:null,false:false,n:0,null:false,number:null,object:null,push:null,string:null,true:false,undefined:false,o:null}}function l(n){n.length=0,h.length<_&&h.push(n)}function c(n){var t=n.l;t&&c(t),n.k=n.l=n.m=n.object=n.number=n.string=n.o=null,g.length<_&&g.push(n)}function p(n,t,e){t||(t=0),"undefined"==typeof e&&(e=n?n.length:0);var r=-1;e=e-t||0;for(var u=Array(0>e?0:e);++r<e;)u[r]=n[t+r];return u}function s(e){function h(n){if(!n||ce.call(n)!=q)return false;var t=n.valueOf,e="function"==typeof t&&(e=ye(t))&&ye(e);return e?n==e||ye(n)==e:ht(n)}function g(n,t,e){if(!n||!V[typeof n])return n;t=t&&"undefined"==typeof e?t:et(t,e,3);for(var r=-1,u=V[typeof n]&&Te(n),o=u?u.length:0;++r<o&&(e=u[r],false!==t(n[e],e,n)););return n}function _(n,t,e){var r;if(!n||!V[typeof n])return n;t=t&&"undefined"==typeof e?t:et(t,e,3);for(r in n)if(false===t(n[r],r,n))break;return n}function U(n,t,e){var r,u=n,o=u;if(!u)return o;for(var i=arguments,a=0,f="number"==typeof e?2:i.length;++a<f;)if((u=i[a])&&V[typeof u])for(var l=-1,c=V[typeof u]&&Te(u),p=c?c.length:0;++l<p;)r=c[l],"undefined"==typeof o[r]&&(o[r]=u[r]);return o}function H(n,t,e){var r,u=n,o=u;if(!u)return o;var i=arguments,a=0,f="number"==typeof e?2:i.length;if(3<f&&"function"==typeof i[f-2])var l=et(i[--f-1],i[f--],2);else 2<f&&"function"==typeof i[f-1]&&(l=i[--f]);for(;++a<f;)if((u=i[a])&&V[typeof u])for(var c=-1,p=V[typeof u]&&Te(u),s=p?p.length:0;++c<s;)r=p[c],o[r]=l?l(o[r],u[r]):u[r];return o}function J(n){var t,e=[];if(!n||!V[typeof n])return e;for(t in n)me.call(n,t)&&e.push(t);return e}function Q(n){return n&&"object"==typeof n&&!$e(n)&&me.call(n,"__wrapped__")?n:new X(n)}function X(n,t){this.__chain__=!!t,this.__wrapped__=n}function Z(n){function t(){if(r){var n=r.slice();be.apply(n,arguments)}if(this instanceof t){var o=tt(e.prototype),n=e.apply(o,n||arguments);return wt(n)?n:o}return e.apply(u,n||arguments)}var e=n[0],r=n[2],u=n[4];return De(t,n),t}function nt(n,t,e,r,u){if(e){var o=e(n);if("undefined"!=typeof o)return o}if(!wt(n))return n;var i=ce.call(n);if(!K[i])return n;var f=Re[i];switch(i){case T:case F:return new f(+n);case W:case P:return new f(n);case z:return o=f(n.source,C.exec(n)),o.lastIndex=n.lastIndex,o;}if(i=$e(n),t){var c=!r;r||(r=a()),u||(u=a());for(var s=r.length;s--;)if(r[s]==n)return u[s];o=i?f(n.length):{}}else o=i?p(n):H({},n);return i&&(me.call(n,"index")&&(o.index=n.index),me.call(n,"input")&&(o.input=n.input)),t?(r.push(n),u.push(o),(i?St:g)(n,function(n,i){o[i]=nt(n,t,e,r,u)}),c&&(l(r),l(u)),o):o}function tt(n){return wt(n)?je(n):{}}function et(n,t,e){if("function"!=typeof n)return Ut;if("undefined"==typeof t||!("prototype"in n))return n;var r=n.__bindData__;if("undefined"==typeof r&&(Ae.funcNames&&(r=!n.name),r=r||!Ae.funcDecomp,!r)){var u=ge.call(n);Ae.funcNames||(r=!O.test(u)),r||(r=E.test(u),De(n,r))}if(false===r||true!==r&&1&r[1])return n;switch(e){case 1:return function(e){return n.call(t,e)};case 2:return function(e,r){return n.call(t,e,r)};case 3:return function(e,r,u){return n.call(t,e,r,u)};case 4:return function(e,r,u,o){return n.call(t,e,r,u,o)};}return Mt(n,t)}function rt(n){function t(){var n=f?i:this;if(u){var h=u.slice();be.apply(h,arguments)}return(o||c)&&(h||(h=p(arguments)),o&&be.apply(h,o),c&&h.length<a)?(r|=16,rt([e,s?r:-4&r,h,null,i,a])):(h||(h=arguments),l&&(e=n[v]),this instanceof t?(n=tt(e.prototype),h=e.apply(n,h),wt(h)?h:n):e.apply(n,h))}var e=n[0],r=n[1],u=n[2],o=n[3],i=n[4],a=n[5],f=1&r,l=2&r,c=4&r,s=8&r,v=e;return De(t,n),t}function ut(e,r){var u=-1,i=vt(),a=e?e.length:0,f=a>=b&&i===n,l=[];if(f){var p=o(r);p?(i=t,r=p):f=false}for(;++u<a;)p=e[u],0>i(r,p)&&l.push(p);return f&&c(r),l}function ot(n,t,e,r){r=(r||0)-1;for(var u=n?n.length:0,o=[];++r<u;){var i=n[r];if(i&&"object"==typeof i&&"number"==typeof i.length&&($e(i)||yt(i))){t||(i=ot(i,t,e));var a=-1,f=i.length,l=o.length;for(o.length+=f;++a<f;)o[l++]=i[a]}else e||o.push(i)}return o}function it(n,t,e,r,u,o){if(e){var i=e(n,t);if("undefined"!=typeof i)return!!i}if(n===t)return 0!==n||1/n==1/t;if(n===n&&!(n&&V[typeof n]||t&&V[typeof t]))return false;if(null==n||null==t)return n===t;var f=ce.call(n),c=ce.call(t);if(f==D&&(f=q),c==D&&(c=q),f!=c)return false;switch(f){case T:case F:return+n==+t;case W:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case z:case P:return n==oe(t);}if(c=f==$,!c){var p=me.call(n,"__wrapped__"),s=me.call(t,"__wrapped__");if(p||s)return it(p?n.__wrapped__:n,s?t.__wrapped__:t,e,r,u,o);if(f!=q)return false;if(f=n.constructor,p=t.constructor,f!=p&&!(dt(f)&&f instanceof f&&dt(p)&&p instanceof p)&&"constructor"in n&&"constructor"in t)return false}for(p=!u,u||(u=a()),o||(o=a()),f=u.length;f--;)if(u[f]==n)return o[f]==t;var v=0,i=true;if(u.push(n),o.push(t),c){if(f=n.length,v=t.length,i=v==n.length,!i&&!r)return i;for(;v--;)if(c=f,p=t[v],r)for(;c--&&!(i=it(n[c],p,e,r,u,o)););else if(!(i=it(n[v],p,e,r,u,o)))break;return i}return _(t,function(t,a,f){return me.call(f,a)?(v++,i=me.call(n,a)&&it(n[a],t,e,r,u,o)):void 0}),i&&!r&&_(n,function(n,t,e){return me.call(e,t)?i=-1<--v:void 0}),p&&(l(u),l(o)),i}function at(n,t,e,r,u){($e(t)?St:g)(t,function(t,o){var i,a,f=t,l=n[o];if(t&&((a=$e(t))||h(t))){for(f=r.length;f--;)if(i=r[f]==t){l=u[f];break}if(!i){var c;e&&(f=e(l,t),c="undefined"!=typeof f)&&(l=f),c||(l=a?$e(l)?l:[]:h(l)?l:{}),r.push(t),u.push(l),c||at(l,t,e,r,u)}}else e&&(f=e(l,t),"undefined"==typeof f&&(f=t)),"undefined"!=typeof f&&(l=f);n[o]=l})}function ft(n,t){return n+he(Ee()*(t-n+1))}function lt(e,r,u){var i=-1,f=vt(),p=e?e.length:0,s=[],v=!r&&p>=b&&f===n,h=u||v?a():s;if(v){var g=o(h);g?(f=t,h=g):(v=false,h=u?h:(l(h),s))}for(;++i<p;){var g=e[i],y=u?u(g,i,e):g;(r?!i||h[h.length-1]!==y:0>f(h,y))&&((u||v)&&h.push(y),s.push(g))}return v?(l(h.k),c(h)):u&&l(h),s}function ct(n){return function(t,e,r){var u={};e=Q.createCallback(e,r,3),r=-1;var o=t?t.length:0;if("number"==typeof o)for(;++r<o;){var i=t[r];n(u,i,e(i,r,t),t)}else g(t,function(t,r,o){n(u,t,e(t,r,o),o)});return u}}function pt(n,t,e,r,u,o){var i=1&t,a=4&t,f=16&t,l=32&t;if(!(2&t||dt(n)))throw new ie;f&&!e.length&&(t&=-17,f=e=false),l&&!r.length&&(t&=-33,l=r=false);var c=n&&n.__bindData__;return c&&true!==c?(c=c.slice(),!i||1&c[1]||(c[4]=u),!i&&1&c[1]&&(t|=8),!a||4&c[1]||(c[5]=o),f&&be.apply(c[2]||(c[2]=[]),e),l&&be.apply(c[3]||(c[3]=[]),r),c[1]|=t,pt.apply(null,c)):(1==t||17===t?Z:rt)([n,t,e,r,u,o])}function st(n){return Fe[n]}function vt(){var t=(t=Q.indexOf)===Wt?n:t;return t}function ht(n){var t,e;return n&&ce.call(n)==q&&(t=n.constructor,!dt(t)||t instanceof t)?(_(n,function(n,t){e=t}),"undefined"==typeof e||me.call(n,e)):false}function gt(n){return Be[n]}function yt(n){return n&&"object"==typeof n&&"number"==typeof n.length&&ce.call(n)==D||false}function mt(n,t,e){var r=Te(n),u=r.length;for(t=et(t,e,3);u--&&(e=r[u],false!==t(n[e],e,n)););return n}function bt(n){var t=[];return _(n,function(n,e){dt(n)&&t.push(e)}),t.sort()}function _t(n){for(var t=-1,e=Te(n),r=e.length,u={};++t<r;){var o=e[t];u[n[o]]=o}return u}function dt(n){return"function"==typeof n}function wt(n){return!(!n||!V[typeof n])}function jt(n){return"number"==typeof n||n&&"object"==typeof n&&ce.call(n)==W||false}function kt(n){return"string"==typeof n||n&&"object"==typeof n&&ce.call(n)==P||false}function xt(n){for(var t=-1,e=Te(n),r=e.length,u=Xt(r);++t<r;)u[t]=n[e[t]];return u}function Ct(n,t,e){var r=-1,u=vt(),o=n?n.length:0,i=false;return e=(0>e?Ne(0,o+e):e)||0,$e(n)?i=-1<u(n,t,e):"number"==typeof o?i=-1<(kt(n)?n.indexOf(t,e):u(n,t,e)):g(n,function(n){return++r<e?void 0:!(i=n===t)}),i}function Ot(n,t,e){var r=true;t=Q.createCallback(t,e,3),e=-1;var u=n?n.length:0;if("number"==typeof u)for(;++e<u&&(r=!!t(n[e],e,n)););else g(n,function(n,e,u){return r=!!t(n,e,u)});return r}function Nt(n,t,e){var r=[];t=Q.createCallback(t,e,3),e=-1;var u=n?n.length:0;if("number"==typeof u)for(;++e<u;){var o=n[e];t(o,e,n)&&r.push(o)}else g(n,function(n,e,u){t(n,e,u)&&r.push(n)});return r}function It(n,t,e){t=Q.createCallback(t,e,3),e=-1;var r=n?n.length:0;if("number"!=typeof r){var u;return g(n,function(n,e,r){return t(n,e,r)?(u=n,false):void 0}),u}for(;++e<r;){var o=n[e];if(t(o,e,n))return o}}function St(n,t,e){var r=-1,u=n?n.length:0;if(t=t&&"undefined"==typeof e?t:et(t,e,3),"number"==typeof u)for(;++r<u&&false!==t(n[r],r,n););else g(n,t);return n}function Et(n,t,e){var r=n?n.length:0;if(t=t&&"undefined"==typeof e?t:et(t,e,3),"number"==typeof r)for(;r--&&false!==t(n[r],r,n););else{var u=Te(n),r=u.length;g(n,function(n,e,o){return e=u?u[--r]:--r,t(o[e],e,o)})}return n}function Rt(n,t,e){var r=-1,u=n?n.length:0;if(t=Q.createCallback(t,e,3),"number"==typeof u)for(var o=Xt(u);++r<u;)o[r]=t(n[r],r,n);else o=[],g(n,function(n,e,u){o[++r]=t(n,e,u)});return o}function At(n,t,e){var u=-1/0,o=u;if("function"!=typeof t&&e&&e[t]===n&&(t=null),null==t&&$e(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];a>o&&(o=a)}}else t=null==t&&kt(n)?r:Q.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),e>u&&(u=e,o=n)});return o}function Dt(n,t,e,r){if(!n)return e;var u=3>arguments.length;t=Q.createCallback(t,r,4);var o=-1,i=n.length;if("number"==typeof i)for(u&&(e=n[++o]);++o<i;)e=t(e,n[o],o,n);else g(n,function(n,r,o){e=u?(u=false,n):t(e,n,r,o)});return e}function $t(n,t,e,r){var u=3>arguments.length;return t=Q.createCallback(t,r,4),Et(n,function(n,r,o){e=u?(u=false,n):t(e,n,r,o)}),e}function Tt(n){var t=-1,e=n?n.length:0,r=Xt("number"==typeof e?e:0);return St(n,function(n){var e=ft(0,++t);r[t]=r[e],r[e]=n}),r}function Ft(n,t,e){var r;t=Q.createCallback(t,e,3),e=-1;var u=n?n.length:0;if("number"==typeof u)for(;++e<u&&!(r=t(n[e],e,n)););else g(n,function(n,e,u){return!(r=t(n,e,u))});return!!r}function Bt(n,t,e){var r=0,u=n?n.length:0;if("number"!=typeof t&&null!=t){var o=-1;for(t=Q.createCallback(t,e,3);++o<u&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[0]:v;return p(n,0,Ie(Ne(0,r),u))}function Wt(t,e,r){if("number"==typeof r){var u=t?t.length:0;r=0>r?Ne(0,u+r):r||0}else if(r)return r=zt(t,e),t[r]===e?r:-1;return n(t,e,r)}function qt(n,t,e){if("number"!=typeof t&&null!=t){var r=0,u=-1,o=n?n.length:0;for(t=Q.createCallback(t,e,3);++u<o&&t(n[u],u,n);)r++}else r=null==t||e?1:Ne(0,t);return p(n,r)}function zt(n,t,e,r){var u=0,o=n?n.length:u;for(e=e?Q.createCallback(e,r,1):Ut,t=e(t);u<o;)r=u+o>>>1,e(n[r])<t?u=r+1:o=r;return u}function Pt(n,t,e,r){return"boolean"!=typeof t&&null!=t&&(r=e,e="function"!=typeof t&&r&&r[t]===n?null:t,t=false),null!=e&&(e=Q.createCallback(e,r,3)),lt(n,t,e)}function Kt(){for(var n=1<arguments.length?arguments:arguments[0],t=-1,e=n?At(Le(n,"length")):0,r=Xt(0>e?0:e);++t<e;)r[t]=Le(n,t);return r}function Lt(n,t){var e=-1,r=n?n.length:0,u={};for(t||!r||$e(n[0])||(t=[]);++e<r;){var o=n[e];t?u[o]=t[e]:o&&(u[o[0]]=o[1])}return u}function Mt(n,t){return 2<arguments.length?pt(n,17,p(arguments,2),null,t):pt(n,1,null,null,t)}function Vt(n,t,e){function r(){c&&ve(c),i=c=p=v,(g||h!==t)&&(s=Me(),a=n.apply(l,o),c||i||(o=l=null))}function u(){var e=t-(Me()-f);0<e?c=_e(u,e):(i&&ve(i),e=p,i=c=p=v,e&&(s=Me(),a=n.apply(l,o),c||i||(o=l=null)))}var o,i,a,f,l,c,p,s=0,h=false,g=true;if(!dt(n))throw new ie;if(t=Ne(0,t)||0,true===e)var y=true,g=false;else wt(e)&&(y=e.leading,h="maxWait"in e&&(Ne(t,e.maxWait)||0),g="trailing"in e?e.trailing:g);return function(){if(o=arguments,f=Me(),l=this,p=g&&(c||!y),false===h)var e=y&&!c;else{i||y||(s=f);var v=h-(f-s),m=0>=v;m?(i&&(i=ve(i)),s=f,a=n.apply(l,o)):i||(i=_e(r,v))}return m&&c?c=ve(c):c||t===h||(c=_e(u,t)),e&&(m=true,a=n.apply(l,o)),!m||c||i||(o=l=null),a}}function Ut(n){return n}function Gt(n,t,e){var r=true,u=t&&bt(t);t&&(e||u.length)||(null==e&&(e=t),o=X,t=n,n=Q,u=bt(t)),false===e?r=false:wt(e)&&"chain"in e&&(r=e.chain);var o=n,i=dt(o);St(u,function(e){var u=n[e]=t[e];i&&(o.prototype[e]=function(){var t=this.__chain__,e=this.__wrapped__,i=[e];if(be.apply(i,arguments),i=u.apply(n,i),r||t){if(e===i&&wt(i))return this;i=new o(i),i.__chain__=t}return i})})}function Ht(){}function Jt(n){return function(t){return t[n]}}function Qt(){return this.__wrapped__}e=e?Y.defaults(G.Object(),e,Y.pick(G,A)):G;var Xt=e.Array,Yt=e.Boolean,Zt=e.Date,ne=e.Function,te=e.Math,ee=e.Number,re=e.Object,ue=e.RegExp,oe=e.String,ie=e.TypeError,ae=[],fe=re.prototype,le=e._,ce=fe.toString,pe=ue("^"+oe(ce).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),se=te.ceil,ve=e.clearTimeout,he=te.floor,ge=ne.prototype.toString,ye=pe.test(ye=re.getPrototypeOf)&&ye,me=fe.hasOwnProperty,be=ae.push,_e=e.setTimeout,de=ae.splice,we=function(){try{var n={},t=pe.test(t=re.defineProperty)&&t,e=t(n,n,n)&&t}catch(r){}return e}(),je=pe.test(je=re.create)&&je,ke=pe.test(ke=Xt.isArray)&&ke,xe=e.isFinite,Ce=e.isNaN,Oe=pe.test(Oe=re.keys)&&Oe,Ne=te.max,Ie=te.min,Se=e.parseInt,Ee=te.random,Re={};Re[$]=Xt,Re[T]=Yt,Re[F]=Zt,Re[B]=ne,Re[q]=re,Re[W]=ee,Re[z]=ue,Re[P]=oe,X.prototype=Q.prototype;var Ae=Q.support={};Ae.funcDecomp=!pe.test(e.a)&&E.test(s),Ae.funcNames="string"==typeof ne.name,Q.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:N,variable:"",imports:{_:Q}},je||(tt=function(){function n(){}return function(t){if(wt(t)){n.prototype=t;var r=new n;n.prototype=null}return r||e.Object()}}());var De=we?function(n,t){M.value=t,we(n,"__bindData__",M)}:Ht,$e=ke||function(n){return n&&"object"==typeof n&&"number"==typeof n.length&&ce.call(n)==$||false},Te=Oe?function(n){return wt(n)?Oe(n):[]}:J,Fe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Be=_t(Fe),We=ue("("+Te(Be).join("|")+")","g"),qe=ue("["+Te(Fe).join("")+"]","g"),ze=ct(function(n,t,e){me.call(n,e)?n[e]++:n[e]=1}),Pe=ct(function(n,t,e){(me.call(n,e)?n[e]:n[e]=[]).push(t)}),Ke=ct(function(n,t,e){n[e]=t}),Le=Rt,Me=pe.test(Me=Zt.now)&&Me||function(){return new Zt().getTime()},Ve=8==Se(d+"08")?Se:function(n,t){return Se(kt(n)?n.replace(I,""):n,t||0)};return Q.after=function(n,t){if(!dt(t))throw new ie;return function(){return 1>--n?t.apply(this,arguments):void 0}},Q.assign=H,Q.at=function(n){for(var t=arguments,e=-1,r=ot(t,true,false,1),t=t[2]&&t[2][t[1]]===n?1:r.length,u=Xt(t);++e<t;)u[e]=n[r[e]];return u},Q.bind=Mt,Q.bindAll=function(n){for(var t=1<arguments.length?ot(arguments,true,false,1):bt(n),e=-1,r=t.length;++e<r;){var u=t[e];n[u]=pt(n[u],1,null,null,n)}return n},Q.bindKey=function(n,t){return 2<arguments.length?pt(t,19,p(arguments,2),null,n):pt(t,3,null,null,n)},Q.chain=function(n){return n=new X(n),n.__chain__=true,n},Q.compact=function(n){for(var t=-1,e=n?n.length:0,r=[];++t<e;){var u=n[t];u&&r.push(u)}return r},Q.compose=function(){for(var n=arguments,t=n.length;t--;)if(!dt(n[t]))throw new ie;return function(){for(var t=arguments,e=n.length;e--;)t=[n[e].apply(this,t)];return t[0]}},Q.constant=function(n){return function(){return n}},Q.countBy=ze,Q.create=function(n,t){var e=tt(n);return t?H(e,t):e},Q.createCallback=function(n,t,e){var r=typeof n;if(null==n||"function"==r)return et(n,t,e);if("object"!=r)return Jt(n);var u=Te(n),o=u[0],i=n[o];return 1!=u.length||i!==i||wt(i)?function(t){for(var e=u.length,r=false;e--&&(r=it(t[u[e]],n[u[e]],null,true)););return r}:function(n){return n=n[o],i===n&&(0!==i||1/i==1/n)}},Q.curry=function(n,t){return t="number"==typeof t?t:+t||n.length,pt(n,4,null,null,null,t)},Q.debounce=Vt,Q.defaults=U,Q.defer=function(n){if(!dt(n))throw new ie;var t=p(arguments,1);return _e(function(){n.apply(v,t)},1)},Q.delay=function(n,t){if(!dt(n))throw new ie;var e=p(arguments,2);return _e(function(){n.apply(v,e)},t)},Q.difference=function(n){return ut(n,ot(arguments,true,true,1))},Q.filter=Nt,Q.flatten=function(n,t,e,r){return"boolean"!=typeof t&&null!=t&&(r=e,e="function"!=typeof t&&r&&r[t]===n?null:t,t=false),null!=e&&(n=Rt(n,e,r)),ot(n,t)},Q.forEach=St,Q.forEachRight=Et,Q.forIn=_,Q.forInRight=function(n,t,e){var r=[];_(n,function(n,t){r.push(t,n)});var u=r.length;for(t=et(t,e,3);u--&&false!==t(r[u--],r[u],n););return n},Q.forOwn=g,Q.forOwnRight=mt,Q.functions=bt,Q.groupBy=Pe,Q.indexBy=Ke,Q.initial=function(n,t,e){var r=0,u=n?n.length:0;if("number"!=typeof t&&null!=t){var o=u;for(t=Q.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else r=null==t||e?1:t||r;return p(n,0,Ie(Ne(0,u-r),u))},Q.intersection=function(){for(var e=[],r=-1,u=arguments.length,i=a(),f=vt(),p=f===n,s=a();++r<u;){var v=arguments[r];($e(v)||yt(v))&&(e.push(v),i.push(p&&v.length>=b&&o(r?e[r]:s)))}var p=e[0],h=-1,g=p?p.length:0,y=[];n:for(;++h<g;){var m=i[0],v=p[h];if(0>(m?t(m,v):f(s,v))){for(r=u,(m||s).push(v);--r;)if(m=i[r],0>(m?t(m,v):f(e[r],v)))continue n;y.push(v)}}for(;u--;)(m=i[u])&&c(m);return l(i),l(s),y},Q.invert=_t,Q.invoke=function(n,t){var e=p(arguments,2),r=-1,u="function"==typeof t,o=n?n.length:0,i=Xt("number"==typeof o?o:0);return St(n,function(n){i[++r]=(u?t:n[t]).apply(n,e)}),i},Q.keys=Te,Q.map=Rt,Q.mapValues=function(n,t,e){var r={};return t=Q.createCallback(t,e,3),g(n,function(n,e,u){r[e]=t(n,e,u)}),r},Q.max=At,Q.memoize=function(n,t){function e(){var r=e.cache,u=t?t.apply(this,arguments):m+arguments[0];return me.call(r,u)?r[u]:r[u]=n.apply(this,arguments)}if(!dt(n))throw new ie;return e.cache={},e},Q.merge=function(n){var t=arguments,e=2;if(!wt(n))return n;if("number"!=typeof t[2]&&(e=t.length),3<e&&"function"==typeof t[e-2])var r=et(t[--e-1],t[e--],2);else 2<e&&"function"==typeof t[e-1]&&(r=t[--e]);for(var t=p(arguments,1,e),u=-1,o=a(),i=a();++u<e;)at(n,t[u],r,o,i);return l(o),l(i),n},Q.min=function(n,t,e){var u=1/0,o=u;if("function"!=typeof t&&e&&e[t]===n&&(t=null),null==t&&$e(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];a<o&&(o=a)}}else t=null==t&&kt(n)?r:Q.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),e<u&&(u=e,o=n)});return o},Q.omit=function(n,t,e){var r={};if("function"!=typeof t){var u=[];_(n,function(n,t){u.push(t)});for(var u=ut(u,ot(arguments,true,false,1)),o=-1,i=u.length;++o<i;){var a=u[o];r[a]=n[a]}}else t=Q.createCallback(t,e,3),_(n,function(n,e,u){t(n,e,u)||(r[e]=n)});return r},Q.once=function(n){var t,e;if(!dt(n))throw new ie;return function(){return t?e:(t=true,e=n.apply(this,arguments),n=null,e)}},Q.pairs=function(n){for(var t=-1,e=Te(n),r=e.length,u=Xt(r);++t<r;){var o=e[t];u[t]=[o,n[o]]}return u},Q.partial=function(n){return pt(n,16,p(arguments,1))},Q.partialRight=function(n){return pt(n,32,null,p(arguments,1))},Q.pick=function(n,t,e){var r={};if("function"!=typeof t)for(var u=-1,o=ot(arguments,true,false,1),i=wt(n)?o.length:0;++u<i;){var a=o[u];a in n&&(r[a]=n[a])}else t=Q.createCallback(t,e,3),_(n,function(n,e,u){t(n,e,u)&&(r[e]=n)});return r},Q.pluck=Le,Q.property=Jt,Q.pull=function(n){for(var t=arguments,e=0,r=t.length,u=n?n.length:0;++e<r;)for(var o=-1,i=t[e];++o<u;)n[o]===i&&(de.call(n,o--,1),u--);return n},Q.range=function(n,t,e){n=+n||0,e="number"==typeof e?e:+e||1,null==t&&(t=n,n=0);var r=-1;t=Ne(0,se((t-n)/(e||1)));for(var u=Xt(t);++r<t;)u[r]=n,n+=e;return u},Q.reject=function(n,t,e){return t=Q.createCallback(t,e,3),Nt(n,function(n,e,r){return!t(n,e,r)})},Q.remove=function(n,t,e){var r=-1,u=n?n.length:0,o=[];for(t=Q.createCallback(t,e,3);++r<u;)e=n[r],t(e,r,n)&&(o.push(e),de.call(n,r--,1),u--);return o},Q.rest=qt,Q.shuffle=Tt,Q.sortBy=function(n,t,e){var r=-1,o=$e(t),i=n?n.length:0,p=Xt("number"==typeof i?i:0);for(o||(t=Q.createCallback(t,e,3)),St(n,function(n,e,u){var i=p[++r]=f();o?i.m=Rt(t,function(t){return n[t]}):(i.m=a())[0]=t(n,e,u),i.n=r,i.o=n}),i=p.length,p.sort(u);i--;)n=p[i],p[i]=n.o,o||l(n.m),c(n);return p},Q.tap=function(n,t){return t(n),n},Q.throttle=function(n,t,e){var r=true,u=true;if(!dt(n))throw new ie;return false===e?r=false:wt(e)&&(r="leading"in e?e.leading:r,u="trailing"in e?e.trailing:u),L.leading=r,L.maxWait=t,L.trailing=u,Vt(n,t,L)},Q.times=function(n,t,e){n=-1<(n=+n)?n:0;var r=-1,u=Xt(n);for(t=et(t,e,1);++r<n;)u[r]=t(r);return u},Q.toArray=function(n){return n&&"number"==typeof n.length?p(n):xt(n)},Q.transform=function(n,t,e,r){var u=$e(n);if(null==e)if(u)e=[];else{var o=n&&n.constructor;e=tt(o&&o.prototype)}return t&&(t=Q.createCallback(t,r,4),(u?St:g)(n,function(n,r,u){return t(e,n,r,u)})),e},Q.union=function(){return lt(ot(arguments,true,true))},Q.uniq=Pt,Q.values=xt,Q.where=Nt,Q.without=function(n){return ut(n,p(arguments,1))},Q.wrap=function(n,t){return pt(t,16,[n])},Q.xor=function(){for(var n=-1,t=arguments.length;++n<t;){var e=arguments[n];if($e(e)||yt(e))var r=r?lt(ut(r,e).concat(ut(e,r))):e}return r||[]},Q.zip=Kt,Q.zipObject=Lt,Q.collect=Rt,Q.drop=qt,Q.each=St,Q.eachRight=Et,Q.extend=H,Q.methods=bt,Q.object=Lt,Q.select=Nt,Q.tail=qt,Q.unique=Pt,Q.unzip=Kt,Gt(Q),Q.clone=function(n,t,e,r){return"boolean"!=typeof t&&null!=t&&(r=e,e=t,t=false),nt(n,t,"function"==typeof e&&et(e,r,1))},Q.cloneDeep=function(n,t,e){return nt(n,true,"function"==typeof t&&et(t,e,1))},Q.contains=Ct,Q.escape=function(n){return null==n?"":oe(n).replace(qe,st)},Q.every=Ot,Q.find=It,Q.findIndex=function(n,t,e){var r=-1,u=n?n.length:0;for(t=Q.createCallback(t,e,3);++r<u;)if(t(n[r],r,n))return r;return-1},Q.findKey=function(n,t,e){var r;return t=Q.createCallback(t,e,3),g(n,function(n,e,u){return t(n,e,u)?(r=e,false):void 0}),r},Q.findLast=function(n,t,e){var r;return t=Q.createCallback(t,e,3),Et(n,function(n,e,u){return t(n,e,u)?(r=n,false):void 0}),r},Q.findLastIndex=function(n,t,e){var r=n?n.length:0;for(t=Q.createCallback(t,e,3);r--;)if(t(n[r],r,n))return r;return-1},Q.findLastKey=function(n,t,e){var r;return t=Q.createCallback(t,e,3),mt(n,function(n,e,u){return t(n,e,u)?(r=e,false):void 0}),r},Q.has=function(n,t){return n?me.call(n,t):false},Q.identity=Ut,Q.indexOf=Wt,Q.isArguments=yt,Q.isArray=$e,Q.isBoolean=function(n){return true===n||false===n||n&&"object"==typeof n&&ce.call(n)==T||false},Q.isDate=function(n){return n&&"object"==typeof n&&ce.call(n)==F||false},Q.isElement=function(n){return n&&1===n.nodeType||false},Q.isEmpty=function(n){var t=true;if(!n)return t;var e=ce.call(n),r=n.length;return e==$||e==P||e==D||e==q&&"number"==typeof r&&dt(n.splice)?!r:(g(n,function(){return t=false}),t)},Q.isEqual=function(n,t,e,r){return it(n,t,"function"==typeof e&&et(e,r,2))},Q.isFinite=function(n){return xe(n)&&!Ce(parseFloat(n))},Q.isFunction=dt,Q.isNaN=function(n){return jt(n)&&n!=+n},Q.isNull=function(n){return null===n},Q.isNumber=jt,Q.isObject=wt,Q.isPlainObject=h,Q.isRegExp=function(n){return n&&"object"==typeof n&&ce.call(n)==z||false},Q.isString=kt,Q.isUndefined=function(n){return"undefined"==typeof n},Q.lastIndexOf=function(n,t,e){var r=n?n.length:0;for("number"==typeof e&&(r=(0>e?Ne(0,r+e):Ie(e,r-1))+1);r--;)if(n[r]===t)return r;return-1},Q.mixin=Gt,Q.noConflict=function(){return e._=le,this},Q.noop=Ht,Q.now=Me,Q.parseInt=Ve,Q.random=function(n,t,e){var r=null==n,u=null==t;return null==e&&("boolean"==typeof n&&u?(e=n,n=1):u||"boolean"!=typeof t||(e=t,u=true)),r&&u&&(t=1),n=+n||0,u?(t=n,n=0):t=+t||0,e||n%1||t%1?(e=Ee(),Ie(n+e*(t-n+parseFloat("1e-"+((e+"").length-1))),t)):ft(n,t)},Q.reduce=Dt,Q.reduceRight=$t,Q.result=function(n,t){if(n){var e=n[t];return dt(e)?n[t]():e}},Q.runInContext=s,Q.size=function(n){var t=n?n.length:0;return"number"==typeof t?t:Te(n).length},Q.some=Ft,Q.sortedIndex=zt,Q.template=function(n,t,e){var r=Q.templateSettings;n=oe(n||""),e=U({},e,r);var u,o=U({},e.imports,r.imports),r=Te(o),o=xt(o),a=0,f=e.interpolate||S,l="__p+='",f=ue((e.escape||S).source+"|"+f.source+"|"+(f===N?x:S).source+"|"+(e.evaluate||S).source+"|$","g");n.replace(f,function(t,e,r,o,f,c){return r||(r=o),l+=n.slice(a,c).replace(R,i),e&&(l+="'+__e("+e+")+'"),f&&(u=true,l+="';"+f+";\n__p+='"),r&&(l+="'+((__t=("+r+"))==null?'':__t)+'"),a=c+t.length,t}),l+="';",f=e=e.variable,f||(e="obj",l="with("+e+"){"+l+"}"),l=(u?l.replace(w,""):l).replace(j,"$1").replace(k,"$1;"),l="function("+e+"){"+(f?"":e+"||("+e+"={});")+"var __t,__p='',__e=_.escape"+(u?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}";try{var c=ne(r,"return "+l).apply(v,o)}catch(p){throw p.source=l,p}return t?c(t):(c.source=l,c)},Q.unescape=function(n){return null==n?"":oe(n).replace(We,gt)},Q.uniqueId=function(n){var t=++y;return oe(null==n?"":n)+t},Q.all=Ot,Q.any=Ft,Q.detect=It,Q.findWhere=It,Q.foldl=Dt,Q.foldr=$t,Q.include=Ct,Q.inject=Dt,Gt(function(){var n={};return g(Q,function(t,e){Q.prototype[e]||(n[e]=t)}),n}(),false),Q.first=Bt,Q.last=function(n,t,e){var r=0,u=n?n.length:0;if("number"!=typeof t&&null!=t){var o=u;for(t=Q.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[u-1]:v;return p(n,Ne(0,u-r))},Q.sample=function(n,t,e){return n&&"number"!=typeof n.length&&(n=xt(n)),null==t||e?n?n[ft(0,n.length-1)]:v:(n=Tt(n),n.length=Ie(Ne(0,t),n.length),n)},Q.take=Bt,Q.head=Bt,g(Q,function(n,t){var e="sample"!==t;Q.prototype[t]||(Q.prototype[t]=function(t,r){var u=this.__chain__,o=n(this.__wrapped__,t,r);return u||null!=t&&(!r||e&&"function"==typeof t)?new X(o,u):o})}),Q.VERSION="2.4.0",Q.prototype.chain=function(){return this.__chain__=true,this},Q.prototype.toString=function(){return oe(this.__wrapped__)},Q.prototype.value=Qt,Q.prototype.valueOf=Qt,St(["join","pop","shift"],function(n){var t=ae[n];Q.prototype[n]=function(){var n=this.__chain__,e=t.apply(this.__wrapped__,arguments);return n?new X(e,n):e}}),St(["push","reverse","sort","unshift"],function(n){var t=ae[n];Q.prototype[n]=function(){return t.apply(this.__wrapped__,arguments),this}}),St(["concat","slice","splice"],function(n){var t=ae[n];Q.prototype[n]=function(){return new X(t.apply(this.__wrapped__,arguments),this.__chain__)}}),Q}var v,h=[],g=[],y=0,m=+new Date+"",b=75,_=40,d=" \t\x0B\f\xA0\uFEFF\n\r\u2028\u2029\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000",w=/\b__p\+='';/g,j=/\b(__p\+=)''\+/g,k=/(__e\(.*?\)|\b__t\))\+'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,O=/^\s*function[ \n\r\t]+\w/,N=/<%=([\s\S]+?)%>/g,I=RegExp("^["+d+"]*0+(?=.$)"),S=/($^)/,E=/\bthis\b/,R=/['\n\r\t\u2028\u2029\\]/g,A="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),D="[object Arguments]",$="[object Array]",T="[object Boolean]",F="[object Date]",B="[object Function]",W="[object Number]",q="[object Object]",z="[object RegExp]",P="[object String]",K={};K[B]=false,K[D]=K[$]=K[T]=K[F]=K[W]=K[q]=K[z]=K[P]=true;var L={leading:false,maxWait:0,trailing:false},M={configurable:false,enumerable:false,value:null,writable:false},V={boolean:false,function:true,object:true,number:false,string:false,undefined:false},U={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},G=V[typeof window]&&window||this,H=V[typeof exports]&&exports&&!exports.nodeType&&exports,J=V[typeof module]&&module&&!module.nodeType&&module,Q=J&&J.exports===H&&H,X=V[typeof global]&&global;!X||X.global!==X&&X.window!==X||(G=X);var Y=s();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(G._=Y,define(function(){return Y})):H&&J?Q?(J.exports=Y)._=Y:H._=Y:G._=Y}).call(this);;;!function(){var d3={version:"3.4.6"};d3.ascending=d3_ascending;function d3_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(1===arguments.length){while(++i<n&&!(null!=(a=array[i])&&a<=a))a=undefined;while(++i<n)if(null!=(b=array[i])&&a>b)a=b}else{while(++i<n&&!(null!=(a=f.call(array,array[i],i))&&a<=a))a=undefined;while(++i<n)if(null!=(b=f.call(array,array[i],i))&&a>b)a=b}return a};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(1===arguments.length){while(++i<n&&!(null!=(a=array[i])&&a<=a))a=undefined;while(++i<n)if(null!=(b=array[i])&&b>a)a=b}else{while(++i<n&&!(null!=(a=f.call(array,array[i],i))&&a<=a))a=undefined;while(++i<n)if(null!=(b=f.call(array,array[i],i))&&b>a)a=b}return a};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(1===arguments.length){while(++i<n&&!(null!=(a=c=array[i])&&a<=a))a=c=undefined;while(++i<n)if(null!=(b=array[i])){if(a>b)a=b;if(c<b)c=b}}else{while(++i<n&&!(null!=(a=c=f.call(array,array[i],i))&&a<=a))a=undefined;while(++i<n)if(null!=(b=f.call(array,array[i],i))){if(a>b)a=b;if(c<b)c=b}}return[a,c]};d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(1===arguments.length){while(++i<n)if(!isNaN(a=+array[i]))s+=a}else{while(++i<n)if(!isNaN(a=+f.call(array,array[i],i)))s+=a}return s};function d3_number(x){return null!=x&&!isNaN(x)}d3.mean=function(array,f){var s=0,n=array.length,a,i=-1,j=n;if(1===arguments.length){while(++i<n)if(d3_number(a=array[i]))s+=a;else--j}else{while(++i<n)if(d3_number(a=f.call(array,array[i],i)))s+=a;else--j}return j?s/j:undefined};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v};d3.median=function(array,f){if(1<arguments.length)array=array.map(f);array=array.filter(d3_number);return array.length?d3.quantile(array.sort(d3_ascending),.5):undefined};function d3_bisector(compare){return{left:function(a,x,lo,hi){if(3>arguments.length)lo=0;if(4>arguments.length)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(0>compare(a[mid],x))lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(3>arguments.length)lo=0;if(4>arguments.length)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(0<compare(a[mid],x))hi=mid;else lo=mid+1}return lo}}}var d3_bisect=d3_bisector(d3_ascending);d3.bisectLeft=d3_bisect.left;d3.bisect=d3.bisectRight=d3_bisect.right;d3.bisector=function(f){return d3_bisector(1===f.length?function(d,x){return d3_ascending(f(d),x)}:f)};d3.shuffle=function(array){var m=array.length,t,i;while(m){i=0|Math.random()*m--;t=array[m],array[m]=array[i],array[i]=t}return array};d3.permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes};d3.pairs=function(array){var i=0,n=array.length-1,p0,p1=array[0],pairs=new Array(0>n?0:n);while(i<n)pairs[i]=[p0=p1,p1=array[++i]];return pairs};d3.zip=function(){if(!(n=arguments.length))return[];for(var i=-1,m=d3.min(arguments,d3_zipLength),zips=new Array(m);++i<m;){for(var j=-1,n,zip=zips[i]=new Array(n);++j<n;){zip[j]=arguments[j][i]}}return zips};function d3_zipLength(d){return d.length}d3.transpose=function(matrix){return d3.zip.apply(d3,matrix)};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries};d3.merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(0<=--n){array=arrays[n];m=array.length;while(0<=--m){merged[--j]=array[m]}}return merged};var abs=Math.abs;d3.range=function(start,stop,step){if(3>arguments.length){step=1;if(2>arguments.length){stop=start;start=0}}if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(0>step)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k}function d3_class(ctor,properties){try{for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false})}}catch(e){ctor.prototype=properties}}d3.map=function(object){var map=new d3_Map;if(object instanceof d3_Map)object.forEach(function(key,value){map.set(key,value)});else for(var key in object)map.set(key,object[key]);return map};function d3_Map(){}d3_class(d3_Map,{has:d3_map_has,get:function(key){return this[d3_map_prefix+key]},set:function(key,value){return this[d3_map_prefix+key]=value},remove:d3_map_remove,keys:d3_map_keys,values:function(){var values=[];this.forEach(function(key,value){values.push(value)});return values},entries:function(){var entries=[];this.forEach(function(key,value){entries.push({key:key,value:value})});return entries},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this)if(key.charCodeAt(0)===d3_map_prefixCode)f.call(this,key.substring(1),this[key])}});var d3_map_prefix="\0",d3_map_prefixCode=d3_map_prefix.charCodeAt(0);function d3_map_has(key){return d3_map_prefix+key in this}function d3_map_remove(key){key=d3_map_prefix+key;return key in this&&delete this[key]}function d3_map_keys(){var keys=[];this.forEach(function(key){keys.push(key)});return keys}function d3_map_size(){var size=0;for(var key in this)if(key.charCodeAt(0)===d3_map_prefixCode)++size;return size}function d3_map_empty(){for(var key in this)if(key.charCodeAt(0)===d3_map_prefixCode)return false;return true}d3.nest=function(){var nest={},keys=[],sortKeys=[],sortValues,rollup;function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,setter,valuesByKey=new d3_Map,values;while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object)}else{valuesByKey.set(keyValue,[object])}}if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth))}}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth)}}valuesByKey.forEach(setter);return object}function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)})});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}nest.map=function(array,mapType){return map(mapType,array,0)};nest.entries=function(array){return entries(map(d3.map,array,0),0)};nest.key=function(d){keys.push(d);return nest};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest};nest.sortValues=function(order){sortValues=order;return nest};nest.rollup=function(f){rollup=f;return nest};return nest};d3.set=function(array){var set=new d3_Set;if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set};function d3_Set(){}d3_class(d3_Set,{has:d3_map_has,add:function(value){this[d3_map_prefix+value]=true;return value},remove:function(value){value=d3_map_prefix+value;return value in this&&delete this[value]},values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var value in this)if(value.charCodeAt(0)===d3_map_prefixCode)f.call(this,value.substring(1))}});d3.behavior={};var d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list)};var d3_document=document,d3_documentElement=d3_document.documentElement,d3_window=window;try{d3_array(d3_documentElement.childNodes)[0].nodeType}catch(e){d3_array=function(list){var i=list.length,array=new Array(i);while(i--)array[i]=list[i];return array}}d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target};function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value}}function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.substring(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName}}var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}d3.dispatch=function(){var dispatch=new d3_dispatch,i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch};d3.addEventDispatch=function(dispatch,_){dispatch[_]=d3_dispatch_event(new d3_dispatch)};function d3_dispatch(){}d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(0<=i){name=type.substring(i+1);type=type.substring(0,i)}if(type)return 2>arguments.length?this[type].on(name):this[type].on(name,listener);if(2===arguments.length){if(null==listener)for(type in this){if(this.hasOwnProperty(type))this[type].on(name,null)}return this}};function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map;function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch}event.on=function(name,listener){var l=listenerByName.get(name),i;if(2>arguments.length)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name)}if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch};return event}d3.event=null;function d3_eventPreventDefault(){d3.event.preventDefault()}function d3_eventCancel(){d3.event.preventDefault();d3.event.stopPropagation()}function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e}function d3_eventDispatch(target){var dispatch=new d3_dispatch,i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}};return dispatch}d3.requote=function(s){return s.replace(d3_requote_re,"\\$&")};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;var d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype}:function(object,prototype){for(var property in prototype)object[property]=prototype[property]};function d3_selection(groups){d3_subclass(groups,d3_selectionPrototype);return groups}var d3_select=function(s,n){return n.querySelector(s)},d3_selectAll=function(s,n){return n.querySelectorAll(s)},d3_selectMatcher=d3_documentElement[d3_vendorSymbol(d3_documentElement,"matchesSelector")],d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s)};if("function"===typeof Sizzle){d3_select=function(s,n){return Sizzle(s,n)[0]||null};d3_selectAll=Sizzle;d3_selectMatches=Sizzle.matchesSelector}d3.selection=function(){return d3_selectionRoot};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j));if(subnode&&"__data__"in node)subnode.__data__=node.__data__}else{subgroup.push(null)}}}return d3_selection(subgroups)};function d3_selection_selector(selector){return"function"===typeof selector?selector:function(){return d3_select(selector,this)}}d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j)));subgroup.parentNode=node}}}return d3_selection(subgroups)};function d3_selection_selectorAll(selector){return"function"===typeof selector?selector:function(){return d3_selectAll(selector,this)}}var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(0<=i){prefix=name.substring(0,i);name=name.substring(i+1)}return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name}};d3_selectionPrototype.attr=function(name,value){if(2>arguments.length){if("string"===typeof name){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name)}for(value in name)this.each(d3_selection_attr(value,name[value]));return this}return this.each(d3_selection_attr(name,value))};function d3_selection_attr(name,value){name=d3.ns.qualify(name);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrConstant(){this.setAttribute(name,value)}function attrConstantNS(){this.setAttributeNS(name.space,name.local,value)}function attrFunction(){var x=value.apply(this,arguments);if(null==x)this.removeAttribute(name);else this.setAttribute(name,x)}function attrFunctionNS(){var x=value.apply(this,arguments);if(null==x)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x)}return null==value?name.local?attrNullNS:attrNull:"function"===typeof value?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant}function d3_collapse(s){return s.trim().replace(/\s+/g," ")}d3_selectionPrototype.classed=function(name,value){if(2>arguments.length){if("string"===typeof name){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false}else{value=node.getAttribute("class");while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false}return true}for(value in name)this.each(d3_selection_classed(value,name[value]));return this}return this.each(d3_selection_classed(name,value))};function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g")}function d3_selection_classes(name){return name.trim().split(/^|\s+/)}function d3_selection_classed(name,value){name=d3_selection_classes(name).map(d3_selection_classedName);var n=name.length;function classedConstant(){var i=-1;while(++i<n)name[i](this,value)}function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x)}return"function"===typeof value?classedFunction:classedConstant}function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;if(!re.test(c))node.setAttribute("class",d3_collapse(c+" "+name))}else{node.setAttribute("class",d3_collapse(c.replace(re," ")))}}}d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(3>n){if("string"!==typeof name){if(2>n)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this}if(2>n)return d3_window.getComputedStyle(this.node(),null).getPropertyValue(name);priority=""}return this.each(d3_selection_style(name,value,priority))};function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name)}function styleConstant(){this.style.setProperty(name,value,priority)}function styleFunction(){var x=value.apply(this,arguments);if(null==x)this.style.removeProperty(name);else this.style.setProperty(name,x,priority)}return null==value?styleNull:"function"===typeof value?styleFunction:styleConstant}d3_selectionPrototype.property=function(name,value){if(2>arguments.length){if("string"===typeof name)return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this}return this.each(d3_selection_property(name,value))};function d3_selection_property(name,value){function propertyNull(){delete this[name]}function propertyConstant(){this[name]=value}function propertyFunction(){var x=value.apply(this,arguments);if(null==x)delete this[name];else this[name]=x}return null==value?propertyNull:"function"===typeof value?propertyFunction:propertyConstant}d3_selectionPrototype.text=function(value){return arguments.length?this.each("function"===typeof value?function(){var v=value.apply(this,arguments);this.textContent=null==v?"":v}:null==value?function(){if(""!==this.textContent)this.textContent=""}:function(){if(this.textContent!==value)this.textContent=value}):this.node().textContent};d3_selectionPrototype.html=function(value){return arguments.length?this.each("function"===typeof value?function(){var v=value.apply(this,arguments);this.innerHTML=null==v?"":v}:null==value?function(){this.innerHTML=""}:function(){this.innerHTML=value}):this.node().innerHTML};d3_selectionPrototype.append=function(name){name=d3_selection_creator(name);return this.select(function(){return this.appendChild(name.apply(this,arguments))})};function d3_selection_creator(name){return"function"===typeof name?name:(name=d3.ns.qualify(name)).local?function(){return this.ownerDocument.createElementNS(name.space,name.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,name)}}d3_selectionPrototype.insert=function(name,before){name=d3_selection_creator(name);before=d3_selection_selector(before);return this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null)})};d3_selectionPrototype.remove=function(){return this.each(function(){var parent=this.parentNode;if(parent)parent.removeChild(this)})};d3_selectionPrototype.data=function(value,key){var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__}}return value}function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n),node,nodeData;if(key){var nodeByKeyValue=new d3_Map,dataByKeyValue=new d3_Map,keyValues=[],keyValue;for(i=-1;++i<n;){keyValue=key.call(node=group[i],node.__data__,i);if(nodeByKeyValue.has(keyValue)){exitNodes[i]=node}else{nodeByKeyValue.set(keyValue,node)}keyValues.push(keyValue)}for(i=-1;++i<m;){keyValue=key.call(groupData,nodeData=groupData[i],i);if(node=nodeByKeyValue.get(keyValue)){updateNodes[i]=node;node.__data__=nodeData}else if(!dataByKeyValue.has(keyValue)){enterNodes[i]=d3_selection_dataNode(nodeData)}dataByKeyValue.set(keyValue,nodeData);nodeByKeyValue.remove(keyValue)}for(i=-1;++i<n;){if(nodeByKeyValue.has(keyValues[i])){exitNodes[i]=group[i]}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node}else{enterNodes[i]=d3_selection_dataNode(nodeData)}}for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i])}for(;i<n;++i){exitNodes[i]=group[i]}}enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes)}var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if("function"===typeof value){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i))}}else{while(++i<n){bind(group=this[i],value)}}update.enter=function(){return enter};update.exit=function(){return exit};return update};function d3_selection_dataNode(data){return{__data__:data}}d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__")};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if("function"!==typeof filter)filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node)}}}return d3_selection(subgroups)};function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector)}}d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;0<=--i;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node}}}return this};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order()};function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3_ascending;return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b}}d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j)})};function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j)}}return groups}d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this};d3_selectionPrototype.empty=function(){return!this.node()};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node}}return null};d3_selectionPrototype.size=function(){var n=0;this.each(function(){++n});return n};function d3_selection_enter(selection){d3_subclass(selection,d3_selection_enterPrototype);return selection}var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.call=d3_selectionPrototype.call;d3_selection_enterPrototype.size=d3_selectionPrototype.size;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j));subnode.__data__=node.__data__}else{subgroup.push(null)}}}return d3_selection(subgroups)};d3_selection_enterPrototype.insert=function(name,before){if(2>arguments.length)before=d3_selection_enterInsertBefore(this);return d3_selectionPrototype.insert.call(this,name,before)};function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var group=enter[j].update,n=group.length,node;if(j!=j0)j0=j,i0=0;if(i>=i0)i0=i+1;while(!(node=group[i0])&&++i0<n);return node}}d3_selectionPrototype.transition=function(){var id=d3_transitionInheritId||++d3_transitionId,subgroups=[],subgroup,node,transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250};for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i])d3_transitionNode(node,i,id,transition);subgroup.push(node)}}return d3_transition(subgroups,id)};d3_selectionPrototype.interrupt=function(){return this.each(d3_selection_interrupt)};function d3_selection_interrupt(){var lock=this.__transition__;if(lock)++lock.active}d3.select=function(node){var group=["string"===typeof node?d3_select(node,d3_document):node];group.parentNode=d3_documentElement;return d3_selection([group])};d3.selectAll=function(nodes){var group=d3_array("string"===typeof nodes?d3_selectAll(nodes,d3_document):nodes);group.parentNode=d3_documentElement;return d3_selection([group])};var d3_selectionRoot=d3.select(d3_documentElement);d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(3>n){if("string"!==typeof type){if(2>n)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this}if(2>n)return(n=this.node()["__on"+type])&&n._;capture=false}return this.each(d3_selection_on(type,listener,capture))};function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;if(0<i)type=type.substring(0,i);var filter=d3_selection_onFilters.get(type);if(filter)type=filter,wrap=d3_selection_onFilter;function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name]}}function onAdd(){var l=wrap(listener,d3_array(arguments));if("undefined"!==typeof Raven)l=Raven.wrap(l);onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener}function removeAll(){var re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$"),match;for(var name in this){if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name]}}}return i?listener?onAdd:onRemove:listener?d3_noop:removeAll}var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});d3_selection_onFilters.forEach(function(k){if("on"+k in d3_document)d3_selection_onFilters.remove(k)});function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz)}finally{d3.event=o}}}function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;if(!related||related!==target&&!(8&related.compareDocumentPosition(target))){l.call(target,e)}}}var d3_event_dragSelect="onselectstart"in d3_document?null:d3_vendorSymbol(d3_documentElement.style,"userSelect"),d3_event_dragId=0;function d3_event_dragSuppress(){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(d3_event_dragSelect){var style=d3_documentElement.style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none"}return function(suppressClick){w.on(name,null);if(d3_event_dragSelect)style[d3_event_dragSelect]=select;if(suppressClick){function off(){w.on(click,null)}w.on(click,function(){d3_eventCancel();off()},true);setTimeout(off,0)}}}d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource())};function d3_mousePoint(container,e){if(e.changedTouches)e=e.changedTouches[0];var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();point.x=e.clientX,point.y=e.clientY;point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y]}var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop]};d3.touches=function(container,touches){if(2>arguments.length)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point}):[]};var π=Math.PI,τ=2*π,halfπ=π/2,ε=1e-6,ε2=ε*ε,d3_radians=π/180,d3_degrees=180/π;function d3_sgn(x){return 0<x?1:0>x?-1:0}function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}function d3_acos(x){return 1<x?0:-1>x?π:Math.acos(x)}function d3_asin(x){return 1<x?halfπ:-1>x?-halfπ:Math.asin(x)}function d3_sinh(x){return((x=Math.exp(x))-1/x)/2}function d3_cosh(x){return((x=Math.exp(x))+1/x)/2}function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}function d3_haversin(x){return(x=Math.sin(x/2))*x}var ρ=Math.SQRT2,ρ2=2,ρ4=4;d3.interpolateZoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2];var dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+ρ4*d2)/(2*w0*ρ2*d1),b1=(w1*w1-w0*w0-ρ4*d2)/(2*w1*ρ2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1),dr=r1-r0,S=(dr||Math.log(w1/w0))/ρ;function interpolate(t){var s=t*S;if(dr){var coshr0=d3_cosh(r0),u=w0/(ρ2*d1)*(coshr0*d3_tanh(ρ*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(ρ*s+r0)]}return[ux0+t*dx,uy0+t*dy,w0*Math.exp(ρ*s)]}interpolate.duration=1000*S;return interpolate};d3.behavior.zoom=function(){var view={x:0,y:0,k:1},translate0,center,size=[960,500],scaleExtent=d3_behavior_zoomInfinity,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",mousewheelTimer,touchstart="touchstart.zoom",touchtime,event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend"),x0,x1,y0,y1;function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on(mousemove,mousewheelreset).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted)}zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;if(d3_transitionInheritId){d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1};zoomstarted(dispatch)}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=dx/2,cy=dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k};zoomed(dispatch)}}).each("end.zoom",function(){zoomended(dispatch)})}else{this.__chart__=view;zoomstarted(dispatch);zoomed(dispatch);zoomended(dispatch)}})};zoom.translate=function(_){if(!arguments.length)return[view.x,view.y];view={x:+_[0],y:+_[1],k:view.k};rescale();return zoom};zoom.scale=function(_){if(!arguments.length)return view.k;view={x:view.x,y:view.y,k:+_};rescale();return zoom};zoom.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=null==_?d3_behavior_zoomInfinity:[+_[0],+_[1]];return zoom};zoom.center=function(_){if(!arguments.length)return center;center=_&&[+_[0],+_[1]];return zoom};zoom.size=function(_){if(!arguments.length)return size;size=_&&[+_[0],+_[1]];return zoom};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();view={x:0,y:0,k:1};return zoom};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();view={x:0,y:0,k:1};return zoom};function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k]}function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y]}function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s))}function translateTo(p,l){l=point(l);view.x+=p[0]-l[0];view.y+=p[1]-l[1]}function rescale(){if(x1)x1.domain(x0.range().map(function(x){return(x-view.x)/view.k}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-view.y)/view.k}).map(y0.invert))}function zoomstarted(dispatch){dispatch({type:"zoomstart"})}function zoomed(dispatch){rescale();dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]})}function zoomended(dispatch){dispatch({type:"zoomend"})}function mousedowned(){var that=this,target=d3.event.target,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window).on(mousemove,moved).on(mouseup,ended),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress();d3_selection_interrupt.call(that);zoomstarted(dispatch);function moved(){dragged=1;translateTo(d3.mouse(that),location0);zoomed(dispatch)}function ended(){subject.on(mousemove,d3_window===that?mousewheelreset:null).on(mouseup,null);dragRestore(dragged&&d3.event.target===target);zoomended(dispatch)}}function touchstarted(){var that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,scale0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,target=d3.select(d3.event.target).on(touchmove,moved).on(touchend,ended),subject=d3.select(that).on(mousedown,null).on(touchstart,started),dragRestore=d3_event_dragSuppress();d3_selection_interrupt.call(that);started();zoomstarted(dispatch);function relocate(){var touches=d3.touches(that);scale0=view.k;touches.forEach(function(t){if(t.identifier in locations0)locations0[t.identifier]=location(t)});return touches}function started(){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){locations0[changed[i].identifier]=null}var touches=relocate(),now=Date.now();if(1===touches.length){if(500>now-touchtime){var p=touches[0],l=locations0[p.identifier];scaleTo(2*view.k);translateTo(p,l);d3_eventPreventDefault();zoomed(dispatch)}touchtime=now}else if(1<touches.length){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy}}function moved(){var touches=d3.touches(that),p0,l0,p1,l1;for(var i=0,n=touches.length;i<n;++i,l1=null){p1=touches[i];if(l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1}}if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(scale1*scale0)}touchtime=null;translateTo(p0,l0);zoomed(dispatch)}function ended(){if(d3.event.touches.length){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){delete locations0[changed[i].identifier]}for(var identifier in locations0){return void relocate()}}target.on(zoomName,null);subject.on(mousedown,mousedowned).on(touchstart,touchstarted);dragRestore();zoomended(dispatch)}}function mousewheeled(){var dispatch=event.of(this,arguments);if(mousewheelTimer)clearTimeout(mousewheelTimer);else d3_selection_interrupt.call(this),zoomstarted(dispatch);mousewheelTimer=setTimeout(function(){mousewheelTimer=null;zoomended(dispatch)},50);d3_eventPreventDefault();var point=center||d3.mouse(this);if(!translate0)translate0=location(point);var xvv=0.01;scaleTo(Math.pow(2,d3_behavior_zoomDelta()*xvv)*view.k);translateTo(point,translate0);zoomed(dispatch)}function mousewheelreset(){translate0=null}function dblclicked(){var dispatch=event.of(this,arguments),p=d3.mouse(this),l=location(p),k=Math.log(view.k)/Math.LN2;zoomstarted(dispatch);scaleTo(Math.pow(2,d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1));translateTo(p,l);zoomed(dispatch);zoomended(dispatch)}return d3.rebind(zoom,event,"on")};var d3_behavior_zoomInfinity=[0,Infinity];var d3_ua=navigator.userAgent,d3_isSafari=0<d3_ua.indexOf("Safari")&&0<d3_ua.indexOf("Mac");var d3_behavior_zoomDelta,d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){if(d3_isSafari){if(0<d3.event.deltaY)return 100*(d3.event.deltaMode?120:1);else return-100*(d3.event.deltaMode?120:1)}if(0<d3.event.deltaY){return-100}else{return 100}return-d3.event.deltaY*(d3.event.deltaMode?120:1)},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){if(d3_isSafari){if(0<d3.event.wheelDelta)return 100;else return-100}return d3.event.wheelDelta},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail},"MozMousePixelScroll");function d3_functor(v){return"function"===typeof v?v:function(){return v}}d3.functor=d3_functor;d3.touch=function(container,touches,identifier){if(3>arguments.length)identifier=touches,touches=d3_eventSource().changedTouches;if(touches)for(var i=0,n=touches.length,touch;i<n;++i){if((touch=touches[i]).identifier===identifier){return d3_mousePoint(container,touch)}}};var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_active,d3_timer_frame=d3_window[d3_vendorSymbol(d3_window,"requestAnimationFrame")]||function(callback){setTimeout(callback,17)};d3.timer=function(callback,delay,then){var n=arguments.length;if(2>n)delay=0;if(3>n)then=Date.now();var time=then+delay,timer={c:callback,t:time,f:false,n:null};if(d3_timer_queueTail)d3_timer_queueTail.n=timer;else d3_timer_queueHead=timer;d3_timer_queueTail=timer;if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step)}};function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;if(24<delay){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay)}d3_timer_interval=0}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step)}}d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep()};function d3_timer_mark(){var now=Date.now();d3_timer_active=d3_timer_queueHead;while(d3_timer_active){if(now>=d3_timer_active.t)d3_timer_active.f=d3_timer_active.c(now-d3_timer_active.t);d3_timer_active=d3_timer_active.n}return now}function d3_timer_sweep(){var t0,t1=d3_timer_queueHead,time=Infinity;while(t1){if(t1.f){t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n}else{if(t1.t<time)time=t1.t;t1=(t0=t1).n}}d3_timer_queueTail=t0;return time}d3.geo={};function d3_identity(d){return d}function d3_true(){return true}function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])]}function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<ε&&abs(a[1]-b[1])<ε}function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if(0>=(n=segment.length-1))return;var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd();return}var a=new d3_geo_clipPolygonIntersection(p0,segment,null,true),b=new d3_geo_clipPolygonIntersection(p0,null,a,false);a.o=b;subject.push(a);clip.push(b);a=new d3_geo_clipPolygonIntersection(p1,segment,null,false);b=new d3_geo_clipPolygonIntersection(p1,null,a,true);a.o=b;subject.push(a);clip.push(b)});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(!subject.length)return;for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i){clip[i].e=entry=!entry}var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;listener.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(var i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.n.x,1,listener)}current=current.n}else{if(isSubject){points=current.p.z;for(var i=points.length-1;0<=i;--i)listener.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.p.x,-1,listener)}current=current.p}current=current.o;points=current.z;isSubject=!isSubject}while(!current.v);listener.lineEnd()}}function d3_geo_clipPolygonLinkCircular(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b}a.n=b=array[0];b.p=a}function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null}function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]);var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[]},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);var clipStartInside=d3_geo_pointInPolygon(rotatedClipStart,polygon);if(segments.length){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener)}else if(clipStartInside){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd()}if(polygonStarted)listener.polygonEnd(),polygonStarted=false;segments=polygon=null},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd()}};function point(λ,φ){var point=rotate(λ,φ);if(pointVisible(λ=point[0],φ=point[1]))listener.point(λ,φ)}function pointLine(λ,φ){var point=rotate(λ,φ);line.point(point[0],point[1])}function lineStart(){clip.point=pointLine;line.lineStart()}function lineEnd(){clip.point=point;line.lineEnd()}var segments;var buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=false,polygon,ring;function pointRing(λ,φ){ring.push([λ,φ]);var point=rotate(λ,φ);ringListener.point(point[0],point[1])}function ringStart(){ringListener.lineStart();ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),segment,n=ringSegments.length;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(1&clean){segment=ringSegments[0];var n=segment.length-1,i=-1,point;if(0<n){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();while(++i<n)listener.point((point=segment[i])[0],point[1]);listener.lineEnd()}return}if(1<n&&2&clean)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1))}return clip}}function d3_geo_clipSegmentLength1(segment){return 1<segment.length}function d3_geo_clipBufferListener(){var lines=[],line;return{lineStart:function(){lines.push(line=[])},point:function(λ,φ){line.push([λ,φ])},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer},rejoin:function(){if(1<lines.length)lines.push(lines.pop().concat(lines.shift()))}}}function d3_geo_clipSort(a,b){return(0>(a=a.x)[0]?a[1]-halfπ-ε:halfπ-a[1])-(0>(b=b.x)[0]?b[1]-halfπ-ε:halfπ-b[1])}function d3_adder(){}d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp);d3_adderSum(d3_adderTemp.s,this.s,this);if(this.s)this.t+=d3_adderTemp.t;else this.s=d3_adderTemp.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var d3_adderTemp=new d3_adder;function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv)}d3.geo.stream=function(object,listener){if(object&&d3_geo_streamObjectType.hasOwnProperty(object.type)){d3_geo_streamObjectType[object.type](object,listener)}else{d3_geo_streamGeometry(object,listener)}};function d3_geo_streamGeometry(geometry,listener){if(geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)){d3_geo_streamGeometryType[geometry.type](geometry,listener)}}var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener)},FeatureCollection:function(object,listener){var features=object.features,i=-1,n=features.length;while(++i<n)d3_geo_streamGeometry(features[i].geometry,listener)}};var d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere()},Point:function(object,listener){object=object.coordinates;listener.point(object[0],object[1],object[2])},MultiPoint:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],listener.point(object[0],object[1],object[2])},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0)},MultiLineString:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamLine(coordinates[i],listener,0)},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener)},MultiPolygon:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamPolygon(coordinates[i],listener)},GeometryCollection:function(object,listener){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)d3_geo_streamGeometry(geometries[i],listener)}};function d3_geo_streamLine(coordinates,listener,closed){var i=-1,n=coordinates.length-closed,coordinate;listener.lineStart();while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd()}function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();while(++i<n)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd()}d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder;var d3_geo_area={sphere:function(){d3_geo_areaSum+=4*π},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset();d3_geo_area.lineStart=d3_geo_areaRingStart},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=0>area?4*π+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop}};function d3_geo_areaRingStart(){var λ00,φ00,λ0,cosφ0,sinφ0;d3_geo_area.point=function(λ,φ){d3_geo_area.point=nextPoint;λ0=(λ00=λ)*d3_radians,cosφ0=Math.cos(φ=(φ00=φ)*d3_radians/2+π/4),sinφ0=Math.sin(φ)};function nextPoint(λ,φ){λ*=d3_radians;φ=φ*d3_radians/2+π/4;var dλ=λ-λ0,sdλ=0<=dλ?1:-1,adλ=sdλ*dλ,cosφ=Math.cos(φ),sinφ=Math.sin(φ),k=sinφ0*sinφ,u=cosφ0*cosφ+k*Math.cos(adλ),v=k*sdλ*Math.sin(adλ);d3_geo_areaRingSum.add(Math.atan2(v,u));λ0=λ,cosφ0=cosφ,sinφ0=sinφ}d3_geo_area.lineEnd=function(){nextPoint(λ00,φ00)}}function d3_geo_cartesian(spherical){var λ=spherical[0],φ=spherical[1],cosφ=Math.cos(φ);return[cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ)]}function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2]}function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l}function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(!m)continue;var point0=ring[0],λ0=point0[0],φ0=point0[1]/2+π/4,sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),j=1;while(true){if(j===m)j=0;point=ring[j];var λ=point[0],φ=point[1]/2+π/4,sinφ=Math.sin(φ),cosφ=Math.cos(φ),dλ=λ-λ0,sdλ=0<=dλ?1:-1,adλ=sdλ*dλ,antimeridian=adλ>π,k=sinφ0*sinφ;d3_geo_areaRingSum.add(Math.atan2(k*sdλ*Math.sin(adλ),cosφ0*cosφ+k*Math.cos(adλ)));polarAngle+=antimeridian?dλ+sdλ*τ:dλ;if(antimeridian^λ0>=meridian^λ>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var φarc=(antimeridian^0<=dλ?-1:1)*d3_asin(intersection[2]);if(parallel>φarc||parallel===φarc&&(arc[0]||arc[1])){winding+=antimeridian^0<=dλ?1:-1}}if(!j++)break;λ0=λ,sinφ0=sinφ,cosφ0=cosφ,point0=point}}return(polarAngle<-ε||polarAngle<ε&&0>d3_geo_areaRingSum)^1&winding}var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,[-π,-π/2]);function d3_geo_clipAntimeridianLine(listener){var λ0=NaN,φ0=NaN,sλ0=NaN,clean;return{lineStart:function(){listener.lineStart();clean=1},point:function(λ1,φ1){var sλ1=0<λ1?π:-π,dλ=abs(λ1-λ0);if(abs(dλ-π)<ε){listener.point(λ0,φ0=0<(φ0+φ1)/2?halfπ:-halfπ);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);listener.point(λ1,φ0);clean=0}else if(sλ0!==sλ1&&dλ>=π){if(abs(λ0-sλ0)<ε)λ0-=sλ0*ε;if(abs(λ1-sλ1)<ε)λ1-=sλ1*ε;φ0=d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);clean=0}listener.point(λ0=λ1,φ0=φ1);sλ0=sλ1},lineEnd:function(){listener.lineEnd();λ0=φ0=NaN},clean:function(){return 2-clean}}}function d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1){var cosφ0,cosφ1,sinλ0_λ1=Math.sin(λ0-λ1);return abs(sinλ0_λ1)>ε?Math.atan((Math.sin(φ0)*(cosφ1=Math.cos(φ1))*Math.sin(λ1)-Math.sin(φ1)*(cosφ0=Math.cos(φ0))*Math.sin(λ0))/(cosφ0*cosφ1*sinλ0_λ1)):(φ0+φ1)/2}function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var φ;if(null==from){φ=direction*halfπ;listener.point(-π,φ);listener.point(0,φ);listener.point(π,φ);listener.point(π,0);listener.point(π,-φ);listener.point(0,-φ);listener.point(-π,-φ);listener.point(-π,0);listener.point(-π,φ)}else if(abs(from[0]-to[0])>ε){var s=from[0]<to[0]?π:-π;φ=direction*s/2;listener.point(-s,φ);listener.point(0,φ);listener.point(s,φ)}else{listener.point(to[0],to[1])}}function d3_geo_equirectangular(λ,φ){return[λ,φ]}(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular)}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,2<rotate.length?rotate[2]*d3_radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates}forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates};return forward};function d3_geo_identityRotation(λ,φ){return[λ>π?λ-τ:λ<-π?λ+τ:λ,φ]}d3_geo_identityRotation.invert=d3_geo_equirectangular;function d3_geo_rotation(δλ,δφ,δγ){return δλ?δφ||δγ?d3_geo_compose(d3_geo_rotationλ(δλ),d3_geo_rotationφγ(δφ,δγ)):d3_geo_rotationλ(δλ):δφ||δγ?d3_geo_rotationφγ(δφ,δγ):d3_geo_identityRotation}function d3_geo_forwardRotationλ(δλ){return function(λ,φ){return λ+=δλ,[λ>π?λ-τ:λ<-π?λ+τ:λ,φ]}}function d3_geo_rotationλ(δλ){var rotation=d3_geo_forwardRotationλ(δλ);rotation.invert=d3_geo_forwardRotationλ(-δλ);return rotation}function d3_geo_rotationφγ(δφ,δγ){var cosδφ=Math.cos(δφ),sinδφ=Math.sin(δφ),cosδγ=Math.cos(δγ),sinδγ=Math.sin(δγ);function rotation(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδφ+x*sinδφ;return[Math.atan2(y*cosδγ-k*sinδγ,x*cosδφ-z*sinδφ),d3_asin(k*cosδγ+y*sinδγ)]}rotation.invert=function(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδγ-y*sinδγ;return[Math.atan2(y*cosδγ+z*sinδγ,x*cosδφ+k*sinδφ),d3_asin(k*cosδφ-x*sinδφ)]};return rotation}d3.geo.circle=function(){var origin=[0,0],angle,precision=6,interpolate;function circle(){var center="function"===typeof origin?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees}});return{type:"Polygon",coordinates:[ring]}}circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle};return circle.angle(90)};function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;if(null!=from){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);if(0<direction?from<to:from>to)from+=direction*τ}else{from=radius+direction*τ;to=radius-.5*step}for(var point,t=from;0<direction?t>to:t<to;t-=step){listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1])}}}function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((0>-a[2]?-angle:angle)+2*Math.PI-ε)%(2*Math.PI)}function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=0<cr,notHemisphere=abs(cr)>ε,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-π,radius-π]);function visible(λ,φ){return Math.cos(λ)*Math.cos(φ)>cr}function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1},point:function(λ,φ){var point1=[λ,φ],point2,v=visible(λ,φ),c=smallRadius?v?0:code(λ,φ):v?code(λ+(0>λ?π:-π),φ):0;if(!point0&&(v00=v0=v))listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=ε;point1[1]+=ε;v=visible(point1[0],point1[1])}}if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1])}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd()}point0=point2}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd()}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1])}}}if(v&&(!point0||!d3_geo_sphericalEqual(point0,point1))){listener.point(point1[0],point1[1])}point0=point1,v0=v,c0=c},lineEnd:function(){if(v0)listener.lineEnd();point0=null},clean:function(){return clean|(v00&&v0)<<1}}}function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b);var n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(0>t2)return;var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var λ0=a[0],λ1=b[0],φ0=a[1],φ1=b[1],z;if(λ1<λ0)z=λ0,λ0=λ1,λ1=z;var δλ=λ1-λ0,polar=abs(δλ-π)<ε,meridian=polar||δλ<ε;if(!polar&&φ1<φ0)z=φ0,φ0=φ1,φ1=z;if(meridian?polar?0<φ0+φ1^q[1]<(abs(q[0]-λ0)<ε?φ0:φ1):φ0<=q[1]&&q[1]<=φ1:δλ>π^(λ0<=q[0]&&q[0]<=λ1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)]}}function code(λ,φ){var r=smallRadius?radius:π-radius,code=0;if(λ<-r)code|=1;else if(λ>r)code|=2;if(φ<-r)code|=4;else if(φ>r)code|=8;return code}}function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var a=line.a,b=line.b,ax=a.x,ay=a.y,bx=b.x,by=b.y,t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&0<r)return;r/=dx;if(0>dx){if(r<t0)return;if(r<t1)t1=r}else if(0<dx){if(r>t1)return;if(r>t0)t0=r}r=x1-ax;if(!dx&&0>r)return;r/=dx;if(0>dx){if(r>t1)return;if(r>t0)t0=r}else if(0<dx){if(r<t0)return;if(r<t1)t1=r}r=y0-ay;if(!dy&&0<r)return;r/=dy;if(0>dy){if(r<t0)return;if(r<t1)t1=r}else if(0<dy){if(r>t1)return;if(r>t0)t0=r}r=y1-ay;if(!dy&&0>r)return;r/=dy;if(0>dy){if(r>t1)return;if(r>t0)t0=r}else if(0<dy){if(r<t0)return;if(r<t1)t1=r}if(0<t0)line.a={x:ax+t0*dx,y:ay+t0*dy};if(1>t1)line.b={x:ax+t1*dx,y:ay+t1*dy};return line}}var d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){if(stream)stream.valid=false;stream=clip(output);stream.valid=true;return stream},extent:function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]);if(stream)stream.valid=false,stream=null;return clipExtent}};return clipExtent.extent([[0,0],[960,500]])};function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),segments,polygon,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[];clean=true},polygonEnd:function(){listener=listener_;segments=d3.merge(segments);var clipStartInside=insidePolygon([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;if(inside||visible){listener.polygonStart();if(inside){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd()}if(visible){d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener)}listener.polygonEnd()}segments=polygon=ring=null}};function insidePolygon(p){var wn=0,n=polygon.length,y=p[1];for(var i=0;i<n;++i){for(var j=1,v=polygon[i],m=v.length,a=v[0],b;j<m;++j){b=v[j];if(a[1]<=y){if(b[1]>y&&0<d3_cross2d(a,b,p))++wn}else{if(b[1]<=y&&0>d3_cross2d(a,b,p))--wn}a=b}}return 0!==wn}function interpolate(from,to,direction,listener){var a=0,a1=0;if(null==from||(a=corner(from,direction))!==(a1=corner(to,direction))||0>comparePoints(from,to)^0<direction){do{listener.point(0===a||3===a?x0:x1,1<a?y1:y0)}while((a=(a+direction+4)%4)!==a1)}else{listener.point(to[0],to[1])}}function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function point(x,y){if(pointVisible(x,y))listener.point(x,y)}var x__,y__,v__,x_,y_,v_,first,clean;function lineStart(){clip.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN}function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferListener.rejoin();segments.push(bufferListener.buffer())}clip.point=point;if(v_)listener.lineEnd()}function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x));y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=pointVisible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){listener.lineStart();listener.point(x,y)}}else{if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};if(clipLine(l)){if(!v_){listener.lineStart();listener.point(l.a.x,l.a.y)}listener.point(l.b.x,l.b.y);if(!v)listener.lineEnd();clean=false}else if(v){listener.lineStart();listener.point(x,y);clean=false}}}x_=x,y_=y,v_=v}return clip};function corner(p,direction){return abs(p[0]-x0)<ε?0<direction?0:3:abs(p[0]-x1)<ε?0<direction?2:1:abs(p[1]-y0)<ε?0<direction?1:0:0<direction?3:2}function compare(a,b){return comparePoints(a.x,b.x)}function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:0===ca?b[1]-a[1]:1===ca?a[0]-b[0]:2===ca?a[1]-b[1]:b[0]-a[0]}}function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1])};return compose}function d3_geo_conic(projectAt){var φ0=0,φ1=π/3,m=d3_geo_projectionMutator(projectAt),p=m(φ0,φ1);p.parallels=function(_){if(!arguments.length)return[180*(φ0/π),180*(φ1/π)];return m(φ0=_[0]*π/180,φ1=_[1]*π/180)};return p}function d3_geo_conicEqualArea(φ0,φ1){var sinφ0=Math.sin(φ0),n=(sinφ0+Math.sin(φ1))/2,C=1+sinφ0*(2*n-sinφ0),ρ0=Math.sqrt(C)/n;function forward(λ,φ){var ρ=Math.sqrt(C-2*n*Math.sin(φ))/n;return[ρ*Math.sin(λ*=n),ρ0-ρ*Math.cos(λ)]}forward.invert=function(x,y){var ρ0_y=ρ0-y;return[Math.atan2(x,ρ0_y)/n,d3_asin((C-(x*x+ρ0_y*ρ0_y)*n*n)/(2*n))]};return forward}(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea)}).raw=d3_geo_conicEqualArea;d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)};d3.geo.albersUsa=function(){var lower48=d3.geo.albers();var alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]);var hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]);var point,pointStream={point:function(x,y){point=[x,y]}},lower48Point,alaskaPoint,hawaiiPoint;function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];point=null;(lower48Point(x,y),point)||(alaskaPoint(x,y),point)||hawaiiPoint(x,y);return point}albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(0.12<=y&&.234>y&&-.425<=x&&-.214>x?alaska:.166<=y&&.234>y&&-.214<=x&&-.115>x?hawaii:lower48).invert(coordinates)};albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y);alaskaStream.point(x,y);hawaiiStream.point(x,y)},sphere:function(){lower48Stream.sphere();alaskaStream.sphere();hawaiiStream.sphere()},lineStart:function(){lower48Stream.lineStart();alaskaStream.lineStart();hawaiiStream.lineStart()},lineEnd:function(){lower48Stream.lineEnd();alaskaStream.lineEnd();hawaiiStream.lineEnd()},polygonStart:function(){lower48Stream.polygonStart();alaskaStream.polygonStart();hawaiiStream.polygonStart()},polygonEnd:function(){lower48Stream.polygonEnd();alaskaStream.polygonEnd();hawaiiStream.polygonEnd()}}};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_);alaska.precision(_);hawaii.precision(_);return albersUsa};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_);alaska.scale(.35*_);hawaii.scale(_);return albersUsa.translate(lower48.translate())};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point;alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+ε,y+0.12*k+ε],[x-.214*k-ε,y+.234*k-ε]]).stream(pointStream).point;hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+ε,y+.166*k+ε],[x-.115*k-ε,y+.234*k-ε]]).stream(pointStream).point;return albersUsa};return albersUsa.scale(1070)};d3.geo.bounds=function(){var λ0,φ0,λ1,φ1,λ_,λ__,φ__,p0,dλSum,ranges,range;var bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint;bound.lineStart=ringStart;bound.lineEnd=ringEnd;dλSum=0;d3_geo_area.polygonStart()},polygonEnd:function(){d3_geo_area.polygonEnd();bound.point=point;bound.lineStart=lineStart;bound.lineEnd=lineEnd;if(0>d3_geo_areaRingSum)λ0=-(λ1=180),φ0=-(φ1=90);else if(dλSum>ε)φ1=90;else if(dλSum<-ε)φ0=-90;range[0]=λ0,range[1]=λ1}};function point(λ,φ){ranges.push(range=[λ0=λ,λ1=λ]);if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ}function linePoint(λ,φ){var p=d3_geo_cartesian([λ*d3_radians,φ*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection);inflection=d3_geo_spherical(inflection);var dλ=λ-λ_,s=0<dλ?1:-1,λi=inflection[0]*d3_degrees*s,antimeridian=180<abs(dλ);if(antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=inflection[1]*d3_degrees;if(φi>φ1)φ1=φi}else if(λi=(λi+360)%360-180,antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=-inflection[1]*d3_degrees;if(φi<φ0)φ0=φi}else{if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ}if(antimeridian){if(λ<λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ}}else{if(λ1>=λ0){if(λ<λ0)λ0=λ;if(λ>λ1)λ1=λ}else{if(λ>λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ}}}}else{point(λ,φ)}p0=p,λ_=λ}function lineStart(){bound.point=linePoint}function lineEnd(){range[0]=λ0,range[1]=λ1;bound.point=point;p0=null}function ringPoint(λ,φ){if(p0){var dλ=λ-λ_;dλSum+=180<abs(dλ)?dλ+(0<dλ?360:-360):dλ}else λ__=λ,φ__=φ;d3_geo_area.point(λ,φ);linePoint(λ,φ)}function ringStart(){d3_geo_area.lineStart()}function ringEnd(){ringPoint(λ__,φ__);d3_geo_area.lineEnd();if(abs(dλSum)>ε)λ0=-(λ1=180);range[0]=λ0,range[1]=λ1;p0=null}function angle(λ0,λ1){return 0>(λ1-=λ0)?λ1+360:λ1}function compareRanges(a,b){return a[0]-b[0]}function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}return function(feature){φ1=λ1=-(λ0=φ0=Infinity);ranges=[];d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var i=1,a=ranges[0],b,merged=[a];i<n;++i){b=ranges[i];if(withinRange(b[0],a)||withinRange(b[1],a)){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0]}else{merged.push(a=b)}}var best=-Infinity,dλ;for(var n=merged.length-1,i=0,a=merged[n],b;i<=n;a=b,++i){b=merged[i];if((dλ=angle(a[1],b[0]))>best)best=dλ,λ0=b[0],λ1=a[1]}}ranges=range=null;return λ0===Infinity||φ0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[λ0,φ0],[λ1,φ1]]}}();d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;if(m<ε2){x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1;if(d3_geo_centroidW1<ε)x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0;m=x*x+y*y+z*z;if(m<ε2)return[NaN,NaN]}return[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees]};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2;var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart}};function d3_geo_centroidPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);d3_geo_centroidPointXYZ(cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ))}function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0;d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0;d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0;d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0}function d3_geo_centroidLineStart(){var x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroid.point=nextPoint;d3_geo_centroidPointXYZ(x0,y0,z0)};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint}function d3_geo_centroidRingStart(){var λ00,φ00,x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ00=λ,φ00=φ;d3_geo_centroid.point=nextPoint;λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroidPointXYZ(x0,y0,z0)};d3_geo_centroid.lineEnd=function(){nextPoint(λ00,φ00);d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;d3_geo_centroid.point=d3_geo_centroidPoint};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx;d3_geo_centroidY2+=v*cy;d3_geo_centroidZ2+=v*cz;d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}}var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2)}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y};function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y}d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00)}}var d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1;var d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBoundsPoint(x,y){if(x<d3_geo_pathBoundsX0)d3_geo_pathBoundsX0=x;if(x>d3_geo_pathBoundsX1)d3_geo_pathBoundsX1=x;if(y<d3_geo_pathBoundsY0)d3_geo_pathBoundsY0=y;if(y>d3_geo_pathBoundsY1)d3_geo_pathBoundsY1=y}function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[];var stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointCircle=d3_geo_pathBufferCircle(_);return stream},result:function(){if(buffer.length){var result=buffer.join("");buffer=[];return result}}};function point(x,y){buffer.push("M",x,",",y,pointCircle)}function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine}function pointLine(x,y){buffer.push("L",x,",",y)}function lineEnd(){stream.point=point}function lineEndPolygon(){buffer.push("Z")}return stream}function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}var d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x;d3_geo_centroidY0+=y;++d3_geo_centroidZ0}function d3_geo_pathCentroidLineStart(){var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x0=x,y0=y)};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;d3_geo_pathCentroidPoint(x0=x,y0=y)}}function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint}function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y)};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;z=y0*x-x0*y;d3_geo_centroidX2+=z*(x0+x);d3_geo_centroidY2+=z*(y0+y);d3_geo_centroidZ2+=3*z;d3_geo_pathCentroidPoint(x0=x,y0=y)}d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_pathContext(context){var pointRadius=4.5;var stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointRadius=_;return stream},result:d3_noop};function point(x,y){context.moveTo(x,y);context.arc(x,y,pointRadius,0,τ)}function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine}function pointLine(x,y){context.lineTo(x,y)}function lineEnd(){stream.point=point}function lineEndPolygon(){context.closePath()}return stream}function d3_geo_resample(project){var δ2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream)}function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y);stream.point(x[0],x[1])})}function resampleRecursive(stream){var λ00,φ00,x00,y00,a00,b00,c00,λ0,x0,y0,a0,b0,c0;var resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart}};function point(x,y){x=project(x,y);stream.point(x[0],x[1])}function lineStart(){x0=NaN;resample.point=linePoint;stream.lineStart()}function linePoint(λ,φ){var c=d3_geo_cartesian([λ,φ]),p=project(λ,φ);resampleLineTo(x0,y0,λ0,a0,b0,c0,x0=p[0],y0=p[1],λ0=λ,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0)}function lineEnd(){resample.point=point;stream.lineEnd()}function ringStart(){lineStart();resample.point=ringPoint;resample.lineEnd=ringEnd}function ringPoint(λ,φ){linePoint(λ00=λ,φ00=φ),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,λ0,a0,b0,c0,x00,y00,λ00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd()}return resample}function resampleLineTo(x0,y0,λ0,a0,b0,c0,x1,y1,λ1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*δ2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),φ2=Math.asin(c/=m),λ2=abs(abs(c)-1)<ε||abs(λ0-λ1)<ε?(λ0+λ1)/2:Math.atan2(b,a),p=project(λ2,φ2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>δ2||.3<abs((dx*dx2+dy*dy2)/d2-.5)||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,λ0,a0,b0,c0,x2,y2,λ2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,λ2,a,b,c,x1,y1,λ1,a1,b1,c1,depth,stream)}}}resample.precision=function(_){if(!arguments.length)return Math.sqrt(δ2);maxDepth=0<(δ2=_*_)&&16;return resample};return resample}d3.geo.path=function(){var pointRadius=4.5,projection,context,projectStream,contextStream,cacheStream;function path(object){if(object){if("function"===typeof pointRadius)contextStream.pointRadius(+pointRadius.apply(this,arguments));if(!cacheStream||!cacheStream.valid)cacheStream=projectStream(contextStream);d3.geo.stream(object,cacheStream)}return contextStream.result()}path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum};path.centroid=function(object){d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN]};path.bounds=function(object){d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=Infinity);d3.geo.stream(object,projectStream(d3_geo_pathBounds));return[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]]};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return reset()};path.context=function(_){if(!arguments.length)return context;contextStream=null==(context=_)?new d3_geo_pathBuffer:new d3_geo_pathContext(_);if("function"!==typeof pointRadius)contextStream.pointRadius(pointRadius);return reset()};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius="function"===typeof _?_:(contextStream.pointRadius(+_),+_);return path};function reset(){cacheStream=null;return path}return path.projection(d3.geo.albersUsa()).context(null)};function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees])});return function(stream){return d3_geo_projectionRadians(resample(stream))}}d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform}}};function d3_geo_transform(stream){this.stream=stream}d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere()},lineStart:function(){stream.lineStart()},lineEnd:function(){stream.lineEnd()},polygonStart:function(){stream.polygonStart()},polygonEnd:function(){stream.polygonEnd()}}}d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project})()}function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+δx,δy-x[1]*k]}),k=150,x=480,y=250,λ=0,φ=0,δλ=0,δφ=0,δγ=0,δx,δy,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null,stream;function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+δx,δy-point[1]*k]}function invert(point){point=projectRotate.invert((point[0]-δx)/k,(δy-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees]}projection.stream=function(output){if(stream)stream.valid=false;stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))));stream.valid=true;return stream};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=null==_?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return invalidate()};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity;return invalidate()};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset()};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset()};projection.center=function(_){if(!arguments.length)return[λ*d3_degrees,φ*d3_degrees];λ=_[0]%360*d3_radians;φ=_[1]%360*d3_radians;return reset()};projection.rotate=function(_){if(!arguments.length)return[δλ*d3_degrees,δφ*d3_degrees,δγ*d3_degrees];δλ=_[0]%360*d3_radians;δφ=_[1]%360*d3_radians;δγ=2<_.length?_[2]%360*d3_radians:0;return reset()};d3.rebind(projection,projectResample,"precision");function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(δλ,δφ,δγ),project);var center=project(λ,φ);δx=x-center[0]*k;δy=y+center[1]*k;return invalidate()}function invalidate(){if(stream)stream.valid=false,stream=null;return projection}return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset()}}function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians)})}function d3_geo_mercator(λ,φ){return[λ,Math.log(Math.tan(π/4+φ/2))]}d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-halfπ]};function d3_geo_mercatorProjection(project){var m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=null==_){var k=π*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]])}}else if(clipAuto){v=null}return v};return m.clipExtent(null)}(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator)}).raw=d3_geo_mercator;d3.geom={};d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){var i=-1,n=this.length,a,b=this[n-1],area=0;while(++i<n){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1]}return .5*area};d3_geom_polygonPrototype.centroid=function(k){var i=-1,n=this.length,x=0,y=0,a,b=this[n-1],c;if(!arguments.length)k=-1/(6*this.area());while(++i<n){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c}return[x*k,y*k]};d3_geom_polygonPrototype.clip=function(subject){var input,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),j,m,a=this[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=this[i];c=input[(m=input.length-closed)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b))}subject.push(d)}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b))}c=d}if(closed)subject.push(subject[0]);a=b}return subject};function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0])}function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21]}function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1])}function d3_geom_pointX(d){return d[0]}function d3_geom_pointY(d){return d[1]}d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;if(arguments.length)return hull(vertices);function hull(data){if(3>data.length)return[];var fx=d3_functor(x),fy=d3_functor(y),n=data.length,vertices,plen=n-1,points=[],stack=[],d,i,j,h=0,x1,y1,x2,y2,u,v,a,sp;if(fx===d3_geom_pointX&&y===d3_geom_pointY)vertices=data;else for(i=0,vertices=[];i<n;++i){vertices.push([+fx.call(this,d=data[i],i),+fy.call(this,d,i)])}for(i=1;i<n;++i){if(vertices[i][1]<vertices[h][1]||vertices[i][1]==vertices[h][1]&&vertices[i][0]<vertices[h][0])h=i}for(i=0;i<n;++i){if(i===h)continue;y1=vertices[i][1]-vertices[h][1];x1=vertices[i][0]-vertices[h][0];points.push({angle:Math.atan2(y1,x1),index:i})}points.sort(function(a,b){return a.angle-b.angle});a=points[0].angle;v=points[0].index;u=0;for(i=1;i<plen;++i){j=points[i].index;if(a==points[i].angle){x1=vertices[v][0]-vertices[h][0];y1=vertices[v][1]-vertices[h][1];x2=vertices[j][0]-vertices[h][0];y2=vertices[j][1]-vertices[h][1];if(x1*x1+y1*y1>=x2*x2+y2*y2){points[i].index=-1;continue}else{points[u].index=-1}}a=points[i].angle;u=i;v=j}stack.push(h);for(i=0,j=0;2>i;++j){if(-1<points[j].index){stack.push(points[j].index);i++}}sp=stack.length;for(;j<plen;++j){if(0>points[j].index)continue;while(!d3_geom_hullCCW(stack[sp-2],stack[sp-1],points[j].index,vertices)){--sp}stack[sp++]=points[j].index}var poly=[];for(i=sp-1;0<=i;--i)poly.push(data[stack[i]]);return poly}hull.x=function(_){return arguments.length?(x=_,hull):x};hull.y=function(_){return arguments.length?(y=_,hull):y};return hull};function d3_geom_hullCCW(i1,i2,i3,v){var t,a,b,c,d,e,f;t=v[i1];a=t[0];b=t[1];t=v[i2];c=t[0];d=t[1];t=v[i3];e=t[0];f=t[1];return 0<(f-b)*(c-a)-(d-b)*(e-a)}var d3_ease_default=function(){return d3_identity};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad},cubic:function(){return d3_ease_cubic},sin:function(){return d3_ease_sin},exp:function(){return d3_ease_exp},circle:function(){return d3_ease_circle},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce}});var d3_ease_mode=d3.map({in:d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f))}});d3.ease=function(name){var i=name.indexOf("-"),t=0<=i?name.substring(0,i):name,m=0<=i?name.substring(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,d3_arraySlice.call(arguments,1))))};function d3_ease_clamp(f){return function(t){return 0>=t?0:1<=t?1:f(t)}}function d3_ease_reverse(f){return function(t){return 1-f(1-t)}}function d3_ease_reflect(f){return function(t){return .5*(.5>t?f(2*t):2-f(2-2*t))}}function d3_ease_quad(t){return t*t}function d3_ease_cubic(t){return t*t*t}function d3_ease_cubicInOut(t){if(0>=t)return 0;if(1<=t)return 1;var t2=t*t,t3=t2*t;return 4*(.5>t?t3:3*(t-t2)+t3-.75)}function d3_ease_poly(e){return function(t){return Math.pow(t,e)}}function d3_ease_sin(t){return 1-Math.cos(t*halfπ)}function d3_ease_exp(t){return Math.pow(2,10*(t-1))}function d3_ease_circle(t){return 1-Math.sqrt(1-t*t)}function d3_ease_elastic(a,p){var s;if(2>arguments.length)p=0.45;if(arguments.length)s=p/τ*Math.asin(1/a);else a=1,s=p/4;return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*τ/p)}}function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s)}}function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function d3_transition(groups,id){d3_subclass(groups,d3_transitionPrototype);groups.id=id;return groups}var d3_transitionPrototype=[],d3_transitionId=0,d3_transitionInheritId,d3_transitionInherit;d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3_transitionPrototype.size=d3_selectionPrototype.size;d3.transition=function(selection){return arguments.length?d3_transitionInheritId?selection.transition():selection:d3_selectionRoot.transition()};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var id=this.id,subgroups=[],subgroup,subnode,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))){if("__data__"in node)subnode.__data__=node.__data__;d3_transitionNode(subnode,i,id,node.__transition__[id]);subgroup.push(subnode)}else{subgroup.push(null)}}}return d3_transition(subgroups,id)};d3_transitionPrototype.selectAll=function(selector){var id=this.id,subgroups=[],subgroup,subnodes,node,subnode,transition;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){transition=node.__transition__[id];subnodes=selector.call(node,node.__data__,i,j);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){if(subnode=subnodes[k])d3_transitionNode(subnode,k,id,transition);subgroup.push(subnode)}}}}return d3_transition(subgroups,id)};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if("function"!==typeof filter)filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node)}}}return d3_transition(subgroups,this.id)};function d3_Color(){}d3_Color.prototype.toString=function(){return this.rgb()+""};d3.hsl=function(h,s,l){return 1===arguments.length?h instanceof d3_Hsl?d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):d3_hsl(+h,+s,+l)};function d3_hsl(h,s,l){return new d3_Hsl(h,s,l)}function d3_Hsl(h,s,l){this.h=h;this.s=s;this.l=l}var d3_hslPrototype=d3_Hsl.prototype=new d3_Color;d3_hslPrototype.brighter=function(k){k=Math.pow(0.7,arguments.length?k:1);return d3_hsl(this.h,this.s,this.l/k)};d3_hslPrototype.darker=function(k){k=Math.pow(0.7,arguments.length?k:1);return d3_hsl(this.h,this.s,k*this.l)};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l)};function d3_hsl_rgb(h,s,l){var m1,m2;h=isNaN(h)?0:0>(h%=360)?h+360:h;s=isNaN(s)?0:0>s?0:1<s?1:s;l=0>l?0:1<l?1:l;m2=.5>=l?l*(1+s):l+s-l*s;m1=2*l-m2;function v(h){if(360<h)h-=360;else if(0>h)h+=360;if(60>h)return m1+(m2-m1)*h/60;if(180>h)return m2;if(240>h)return m1+(m2-m1)*(240-h)/60;return m1}function vv(h){return Math.round(255*v(h))}return d3_rgb(vv(h+120),vv(h),vv(h-120))}d3.hcl=function(h,c,l){return 1===arguments.length?h instanceof d3_Hcl?d3_hcl(h.h,h.c,h.l):h instanceof d3_Lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):d3_hcl(+h,+c,+l)};function d3_hcl(h,c,l){return new d3_Hcl(h,c,l)}function d3_Hcl(h,c,l){this.h=h;this.c=c;this.l=l}var d3_hclPrototype=d3_Hcl.prototype=new d3_Color;d3_hclPrototype.brighter=function(k){return d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.darker=function(k){return d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb()};function d3_hcl_lab(h,c,l){if(isNaN(h))h=0;if(isNaN(c))c=0;return d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c)}d3.lab=function(l,a,b){return 1===arguments.length?l instanceof d3_Lab?d3_lab(l.l,l.a,l.b):l instanceof d3_Hcl?d3_hcl_lab(l.l,l.c,l.h):d3_rgb_lab((l=d3.rgb(l)).r,l.g,l.b):d3_lab(+l,+a,+b)};function d3_lab(l,a,b){return new d3_Lab(l,a,b)}function d3_Lab(l,a,b){this.l=l;this.a=a;this.b=b}var d3_lab_K=18;var d3_lab_X=0.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_Lab.prototype=new d3_Color;d3_labPrototype.brighter=function(k){return d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.darker=function(k){return d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b)};function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-0.4985314*z),d3_xyz_rgb(-0.969266*x+1.8760108*y+0.041556*z),d3_xyz_rgb(0.0556434*x-0.2040259*y+1.0572252*z))}function d3_lab_hcl(l,a,b){return 0<l?d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):d3_hcl(NaN,NaN,l)}function d3_lab_xyz(x){return 0.206893034<x?x*x*x:(x-4/29)/7.787037}function d3_xyz_lab(x){return 0.008856<x?Math.pow(x,1/3):7.787037*x+4/29}function d3_xyz_rgb(r){return Math.round(255*(0.00304>=r?12.92*r:1.055*Math.pow(r,1/2.4)-0.055))}d3.rgb=function(r,g,b){return 1===arguments.length?r instanceof d3_Rgb?d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):d3_rgb(~~r,~~g,~~b)};function d3_rgbNumber(value){return d3_rgb(value>>16,255&value>>8,255&value)}function d3_rgbString(value){return d3_rgbNumber(value)+""}function d3_rgb(r,g,b){return new d3_Rgb(r,g,b)}function d3_Rgb(r,g,b){this.r=r;this.g=g;this.b=b}var d3_rgbPrototype=d3_Rgb.prototype=new d3_Color;d3_rgbPrototype.brighter=function(k){k=Math.pow(0.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return d3_rgb(Math.min(255,~~(r/k)),Math.min(255,~~(g/k)),Math.min(255,~~(b/k)))};d3_rgbPrototype.darker=function(k){k=Math.pow(0.7,arguments.length?k:1);return d3_rgb(~~(k*this.r),~~(k*this.g),~~(k*this.b))};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b)};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b)};function d3_rgb_hex(v){return 16>v?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16)}function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,color;m1=/([a-z]+)\((.*)\)/i.exec(format);if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100)}case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]))}}}if(color=d3_rgb_names.get(format))return rgb(color.r,color.g,color.b);if(null!=format&&"#"===format.charAt(0)&&!isNaN(color=parseInt(format.substring(1),16))){if(4===format.length){r=(3840&color)>>4;r=r>>4|r;g=240&color;g=g>>4|g;b=15&color;b=b<<4|b}else if(7===format.length){r=(16711680&color)>>16;g=(65280&color)>>8;b=255&color}}return rgb(r,g,b)}function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=.5>l?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60}else{h=NaN;s=0<l&&1>l?0:h}return d3_hsl(h,s,l)}function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((0.4124564*r+0.3575761*g+0.1804375*b)/d3_lab_X),y=d3_xyz_lab((0.2126729*r+0.7151522*g+0.072175*b)/d3_lab_Y),z=d3_xyz_lab((0.0193339*r+0.119192*g+0.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z))}function d3_rgb_xyz(r){return 0.04045>=(r/=255)?r/12.92:Math.pow((r+0.055)/1.055,2.4)}function d3_rgb_parseNumber(c){var f=parseFloat(c);return"%"===c.charAt(c.length-1)?Math.round(2.55*f):f}var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value))});d3.interpolateRgb=d3_interpolateRgb;function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t))}}d3.interpolateObject=d3_interpolateObject;function d3_interpolateObject(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolate(a[k],b[k])}else{c[k]=a[k]}}for(k in b){if(!(k in a)){c[k]=b[k]}}return function(t){for(k in i)c[k]=i[k](t);return c}}d3.interpolateArray=d3_interpolateArray;function d3_interpolateArray(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c}}d3.interpolateNumber=d3_interpolateNumber;function d3_interpolateNumber(a,b){b-=a=+a;return function(t){return a+b*t}}d3.interpolateString=d3_interpolateString;function d3_interpolateString(a,b){var bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b))){if((bs=bm.index)>bi){bs=b.substring(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs}if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm}else{s[++i]=null;q.push({i:i,x:d3_interpolateNumber(am,bm)})}bi=d3_interpolate_numberB.lastIndex}if(bi<b.length){bs=b.substring(bi);if(s[i])s[i]+=bs;else s[++i]=bs}return 2>s.length?q[0]?(b=q[0].x,function(t){return b(t)+""}):function(){return b}:(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");d3.interpolate=d3_interpolate;function d3_interpolate(a,b){var i=d3.interpolators.length,f;while(0<=--i&&!(f=d3.interpolators[i](a,b)));return f}d3.interpolators=[function(a,b){var t=typeof b;return("string"===t?d3_rgb_names.has(b)||/^(#|rgb\(|hsl\()/.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_Color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:"object"===t&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b)}];d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(null!=string){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate()}return new d3_transform(t?t.matrix:d3_transformIdentity)})(string)};function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1}this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0};d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1]}function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k}return k}function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a}var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform;function d3_interpolateTransform(a,b){var s=[],q=[],n,A=d3.transform(a),B=d3.transform(b),ta=A.translate,tb=B.translate,ra=A.rotate,rb=B.rotate,wa=A.skew,wb=B.skew,ka=A.scale,kb=B.scale;if(ta[0]!=tb[0]||ta[1]!=tb[1]){s.push("translate(",null,",",null,")");q.push({i:1,x:d3_interpolateNumber(ta[0],tb[0])},{i:3,x:d3_interpolateNumber(ta[1],tb[1])})}else if(tb[0]||tb[1]){s.push("translate("+tb+")")}else{s.push("")}if(ra!=rb){if(180<ra-rb)rb+=360;else if(180<rb-ra)ra+=360;q.push({i:s.push(s.pop()+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)})}else if(rb){s.push(s.pop()+"rotate("+rb+")")}if(wa!=wb){q.push({i:s.push(s.pop()+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)})}else if(wb){s.push(s.pop()+"skewX("+wb+")")}if(ka[0]!=kb[0]||ka[1]!=kb[1]){n=s.push(s.pop()+"scale(",null,",",null,")");q.push({i:n-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:n-2,x:d3_interpolateNumber(ka[1],kb[1])})}else if(1!=kb[0]||1!=kb[1]){s.push(s.pop()+"scale("+kb+")")}n=q.length;return function(t){var i=-1,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("")}}d3_transitionPrototype.tween=function(name,tween){var id=this.id;if(2>arguments.length)return this.node().__transition__[id].tween.get(name);return d3_selection_each(this,null==tween?function(node){node.__transition__[id].tween.remove(name)}:function(node){node.__transition__[id].tween.set(name,tween)})};function d3_transition_tween(groups,name,value,tween){var id=groups.id;return d3_selection_each(groups,"function"===typeof value?function(node,i,j){node.__transition__[id].tween.set(name,tween(value.call(node,node.__data__,i,j)))}:(value=tween(value),function(node){node.__transition__[id].tween.set(name,value)}))}d3_transitionPrototype.attr=function(nameNS,value){if(2>arguments.length){for(value in nameNS)this.attr(value,nameNS[value]);return this}var interpolate="transform"==nameNS?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrTween(b){return null==b?attrNull:(b+="",function(){var a=this.getAttribute(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t))})})}function attrTweenNS(b){return null==b?attrNullNS:(b+="",function(){var a=this.getAttributeNS(name.space,name.local),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t))})})}return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t))}}function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t))}}return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(3>n){if("string"!==typeof name){if(2>n)value="";for(priority in name)this.style(priority,name[priority],value);return this}priority=""}function styleNull(){this.style.removeProperty(name)}function styleString(b){return null==b?styleNull:(b+="",function(){var a=d3_window.getComputedStyle(this,null).getPropertyValue(name),i;return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority)})})}return d3_transition_tween(this,"style."+name,value,styleString)};d3_transitionPrototype.styleTween=function(name,tween,priority){if(3>arguments.length)priority="";function styleTween(d,i){var f=tween.call(this,d,i,d3_window.getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority)}}return this.tween("style."+name,styleTween)};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text)};function d3_transition_text(b){if(null==b)b="";return function(){this.textContent=b}}d3_transitionPrototype.remove=function(){return this.each("end.transition",function(){var p;if(2>this.__transition__.count&&(p=this.parentNode))p.removeChild(this)})};d3_transitionPrototype.ease=function(value){var id=this.id;if(1>arguments.length)return this.node().__transition__[id].ease;if("function"!==typeof value)value=d3.ease.apply(d3,arguments);return d3_selection_each(this,function(node){node.__transition__[id].ease=value})};d3_transitionPrototype.delay=function(value){var id=this.id;if(1>arguments.length)return this.node().__transition__[id].delay;return d3_selection_each(this,"function"===typeof value?function(node,i,j){node.__transition__[id].delay=+value.call(node,node.__data__,i,j)}:(value=+value,function(node){node.__transition__[id].delay=value}))};d3_transitionPrototype.duration=function(value){var id=this.id;if(1>arguments.length)return this.node().__transition__[id].duration;return d3_selection_each(this,"function"===typeof value?function(node,i,j){node.__transition__[id].duration=Math.max(1,value.call(node,node.__data__,i,j))}:(value=Math.max(1,value),function(node){node.__transition__[id].duration=value}))};d3_transitionPrototype.each=function(type,listener){var id=this.id;if(2>arguments.length){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node.__transition__[id];type.call(node,node.__data__,i,j)});d3_transitionInherit=inherit;d3_transitionInheritId=inheritId}else{d3_selection_each(this,function(node){var transition=node.__transition__[id];(transition.event||(transition.event=d3.dispatch("start","end"))).on(type,listener)})}return this};d3_transitionPrototype.transition=function(){var id0=this.id,id1=++d3_transitionId,subgroups=[],subgroup,group,node,transition;for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if(node=group[i]){transition=Object.create(node.__transition__[id0]);transition.delay+=transition.duration;d3_transitionNode(node,i,id1,transition)}subgroup.push(node)}}return d3_transition(subgroups,id1)};function d3_transitionNode(node,i,id,inherit){var lock=node.__transition__||(node.__transition__={active:0,count:0}),transition=lock[id];if(!transition){var time=inherit.time;transition=lock[id]={tween:new d3_Map,time:time,ease:inherit.ease,delay:inherit.delay,duration:inherit.duration};++lock.count;d3.timer(function(elapsed){var d=node.__data__,ease=transition.ease,delay=transition.delay,duration=transition.duration,timer=d3_timer_active,tweened=[];timer.t=delay+time;if(delay<=elapsed)return start(elapsed-delay);timer.c=start;function start(elapsed){if(lock.active>id)return stop();lock.active=id;transition.event&&transition.event.start.call(node,d,i);transition.tween.forEach(function(key,value){if(value=value.call(node,d,i)){tweened.push(value)}});d3.timer(function(){timer.c=tick(elapsed||1)?d3_true:tick;return 1},0,time)}function tick(elapsed){if(lock.active!==id)return stop();var t=elapsed/duration,e=ease(t),n=tweened.length;while(0<n){tweened[--n].call(node,e)}if(1<=t){transition.event&&transition.event.end.call(node,d,i);return stop()}}function stop(){if(--lock.count)delete lock[id];else delete node.__transition__;return 1}},0,time)}}d3.xhr=d3_xhrType(d3_identity);d3.xhrSetting={timeout:0};function d3_xhrType(response){return function(url,mimeType,callback){if(2===arguments.length&&"function"===typeof mimeType)callback=mimeType,mimeType=null;return d3_xhr(url,mimeType,response,callback)}}function d3_xhr(url,mimeType,response,callback){var xhr={_options:d3.xhrSetting},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest,responseType=null;if(d3_window.XDomainRequest&&!("withCredentials"in request)&&/^(http(s)?:)?\/\//.test(url))request=new XDomainRequest;"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){3<request.readyState&&respond()};function respond(){var status=request.status,result;if(!status&&request.responseText||200<=status&&300>status||304===status){try{result=response.call(xhr,request)}catch(e){dispatch.error.call(xhr,e);return}dispatch.load.call(xhr,result)}else{dispatch.error.call(xhr,request)}}request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request)}finally{d3.event=o}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(2>arguments.length)return headers[name];if(null==value)delete headers[name];else headers[name]=value+"";return xhr};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=null==value?null:value+"";return xhr};xhr.option=function(options){options=options||{};xhr._options=_.extend(xhr._options,options);return xhr};xhr.responseType=function(value){if(!arguments.length)return responseType;responseType=value;return xhr};xhr.response=function(value){response=value;return xhr};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)))}});xhr.send=function(method,data,callback){var abortTimeout;if(2===arguments.length&&"function"===typeof data)callback=data,data=null;request.open(method,url,true);if(null!=mimeType&&!("accept"in headers))headers["accept"]=mimeType+",*/*";if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);if(null!=mimeType&&request.overrideMimeType)request.overrideMimeType(mimeType);if(null!=responseType)request.responseType=responseType;if(null!=callback)xhr.on("error",function(request,errorType){clearTimeout(abortTimeout);callback(request,errorType)}).on("load",function(request){clearTimeout(abortTimeout);callback(null,request)});dispatch.beforesend.call(xhr,request);if(0<xhr._options.timeout){abortTimeout=setTimeout(function(){xhr.abort();request.errorType="timeout";dispatch.error.call(xhr,request)},xhr._options.timeout)}request.send(null==data?null:data);return xhr};xhr.abort=function(){request.abort();return xhr};d3.rebind(xhr,dispatch,"on");return null==callback?xhr:xhr.get(d3_xhr_fixCallback(callback))};function d3_xhr_fixCallback(callback){return 1===callback.length?function(error,request){callback(null==error?request:null)}:callback}d3.xhrSetup=function(options){d3.xhrSetting=options||{}};d3.text=d3_xhrType(function(request){return request.responseText});d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback)};function d3_json(request){return JSON.parse(request.responseText)}d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback)};function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText)}d3.xml=d3_xhrType(function(request){return request.responseXML});if("function"===typeof define&&define.amd){define(d3)}else if("object"===typeof module&&module.exports){module.exports=d3}else{window.d3=d3}}();;;var matrix={};var ERROR_MATRIX_NOT_SQUARE="Matrix must be square.",ERROR_VECTOR_NOT_2D="Only two dimensional operations are supported at this time.";matrix._check2DVector=function(point){if(2!==point.length){throw new Error(ERROR_VECTOR_NOT_2D)}};matrix.deepCopy=function(arr){if(!Array.isArray(arr)){throw new Error("Input must be a matrix.")}else if(arr[0][0]===undefined){throw new Error("Input cannot be a vector.")}var result=new Array(arr.length);for(var i=0;i<arr.length;i++){result[i]=arr[i].slice()}return result};matrix.isSquare=function(arr){if(!Array.isArray(arr)){throw new Error("Input must be a matrix.")}else if(arr[0][0]===undefined){throw new Error("Input cannot be a vector.")}var rows=arr.length;for(var i=0;i<rows;i++){if(arr[i].length!==rows)return false}return true};matrix.addition=function(arrA,arrB){if(arrA.length!==arrB.length||arrA[0].length!==arrB[0].length){throw new Error("Matrix mismatch")}var result=new Array(arrA.length),i;if(!arrA[0].length){for(i=0;i<arrA.length;i++){result[i]=arrA[i]+arrB[i]}}else{for(i=0;i<arrA.length;i++){result[i]=new Array(arrA[i].length);for(var j=0;j<arrA[i].length;j++){result[i][j]=arrA[i][j]+arrB[i][j]}}}return result};matrix.subtraction=function(arrA,arrB){if(arrA.length!==arrB.length||arrA[0].length!==arrB[0].length){throw new Error("Matrix mismatch")}var result=new Array(arrA.length),i;if(!arrA[0].length){for(i=0;i<arrA.length;i++){result[i]=arrA[i]-arrB[i]}}else{for(i=0;i<arrA.length;i++){result[i]=new Array(arrA[i].length);for(var j=0;j<arrA[i].length;j++){result[i][j]=arrA[i][j]-arrB[i][j]}}}return result};matrix.scalar=function(arr,val){for(var i=0;i<arr.length;i++){for(var j=0;j<arr[i].length;j++){arr[i][j]=val*arr[i][j]}}return arr};matrix.add=function(arr,val){for(var i=0;i<arr.length;i++){for(var j=0;j<arr[i].length;j++){arr[i][j]=val+arr[i][j]}}return arr};matrix.transpose=function(arr){var result=new Array(arr[0].length);for(var i=0;i<arr[0].length;i++){result[i]=new Array(arr.length);for(var j=0;j<arr.length;j++){result[i][j]=arr[j][i]}}return result};matrix.identity=function(n){var result=new Array(n);for(var i=0;i<n;i++){result[i]=new Array(n);for(var j=0;j<n;j++){result[i][j]=i===j?1:0}}return result};matrix.dotproduct=function(vectorA,vectorB){if(vectorA.length!==vectorB.length){throw new Error("Vector mismatch")}var result=0;for(var i=0;i<vectorA.length;i++){result+=vectorA[i]*vectorB[i]}return result};matrix.homogeneous=function(arrA){arrA.push([1])};matrix.multiply=function(arrA,arrB){if(arrA[0].length!==arrB.length){throw new Error("Matrix mismatch")}var result=new Array(arrA.length);for(var x=0;x<arrA.length;x++){result[x]=new Array(arrB[0].length)}var arrB_T=matrix.transpose(arrB);for(var i=0;i<result.length;i++){for(var j=0;j<result[i].length;j++){result[i][j]=matrix.dotproduct(arrA[i],arrB_T[j])}}return result};matrix.determinant=function(m){var numRow=m.length;var numCol=m[0].length;var det=0;var row,col;var diagLeft,diagRight;if(!matrix.isSquare(m)){throw new Error(ERROR_MATRIX_NOT_SQUARE)}if(1===numRow){return m[0][0]}else if(2===numRow){return m[0][0]*m[1][1]-m[0][1]*m[1][0]}for(col=0;col<numCol;col++){diagLeft=m[0][col];diagRight=m[0][col];for(row=1;row<numRow;row++){diagRight*=m[row][((col+row)%numCol+numCol)%numCol];diagLeft*=m[row][((col-row)%numCol+numCol)%numCol]}det+=diagRight-diagLeft}return det};matrix.lupDecomposition=function(arr){if(!matrix.isSquare(arr)){throw new Error(ERROR_MATRIX_NOT_SQUARE)}var size=arr.length;var LU=matrix.deepCopy(arr);var P=matrix.transpose(matrix.identity(size));var currentRow;var currentColumn=new Array(size);this.getL=function(a){var m=a[0].length;var L=matrix.identity(m);for(var i=0;i<m;i++){for(var j=0;j<m;j++){if(i>j){L[i][j]=a[i][j]}}}return L};this.getU=function(a){var m=a[0].length;var U=matrix.identity(m);for(var i=0;i<m;i++){for(var j=0;j<m;j++){if(i<=j){U[i][j]=a[i][j]}}}return U};for(var j=0;j<size;j++){var i;for(i=0;i<size;i++){currentColumn[i]=LU[i][j]}for(i=0;i<size;i++){currentRow=LU[i];var minIndex=Math.min(i,j);var s=0;for(var k=0;k<minIndex;k++){s+=currentRow[k]*currentColumn[k]}currentRow[j]=currentColumn[i]-=s}var pivot=j;for(i=j+1;i<size;i++){if(Math.abs(currentColumn[i])>Math.abs(currentColumn[pivot])){pivot=i}}if(pivot!==j){LU=matrix.rowSwitch(LU,pivot,j);P=matrix.rowSwitch(P,pivot,j)}if(j<size&&0!==LU[j][j]){for(i=j+1;i<size;i++){LU[i][j]/=LU[j][j]}}}return[this.getL(LU),this.getU(LU),P]};matrix.rotate=function(point,degree,direction){matrix._check2DVector(point);var negate="clockwise"===direction?-1:1;var radians=degree*(Math.PI/180);var transformation=[[Math.cos(radians),-1*negate*Math.sin(radians)],[negate*Math.sin(radians),Math.cos(radians)]];return matrix.multiply(transformation,point)};matrix.scale=function(point,sx,sy){matrix._check2DVector(point);var transformation=[[sx,0],[0,sy]];return matrix.multiply(transformation,point)};matrix.shear=function(point,k,direction){matrix._check2DVector(point);var xplaceholder="xaxis"===direction?k:0;var yplaceholder="yaxis"===direction?k:0;var transformation=[[1,xplaceholder],[yplaceholder,1]];return matrix.multiply(transformation,point)};matrix.affine=function(point,tx,ty){matrix._check2DVector(point);var transformation=[[1,0,tx],[0,1,ty],[0,0,1]];var newpoint=[[point[0][0]],[point[1][0]],[1]];var transformed=matrix.multiply(transformation,newpoint);return[[transformed[0][0]],[transformed[1][0]]]};matrix.rowScale=function(m,row,scale){var result=new Array(m.length);for(var i=0;i<m.length;i++){result[i]=new Array(m[i].length);for(var j=0;j<m[i].length;j++){if(i===row){result[i][j]=scale*m[i][j]}else{result[i][j]=m[i][j]}}}return result};matrix.rowSwitch=function(m,row1,row2){var result=new Array(m.length);for(var i=0;i<m.length;i++){result[i]=new Array(m[i].length);for(var j=0;j<m[i].length;j++){if(i===row1){result[i][j]=m[row2][j]}else if(i===row2){result[i][j]=m[row1][j]}else{result[i][j]=m[i][j]}}}return result};matrix.rowAddMultiple=function(m,from,to,scale){var result=new Array(m.length);for(var i=0;i<m.length;i++){result[i]=new Array(m[i].length);for(var j=0;j<m[i].length;j++){if(i===to){result[to][j]=m[to][j]+scale*m[from][j]}else{result[i][j]=m[i][j]}}}return result};matrix.GaussJordanEliminate=function(m,epsilon){var eps="undefined"===typeof epsilon?1e-10:epsilon;var h=m.length;var w=m[0].length;var y=-1;var y2,x,c;while(++y<h){var maxrow=y;y2=y;while(++y2<h){if(Math.abs(m[y2][y])>Math.abs(m[maxrow][y]))maxrow=y2}var tmp=m[y];m[y]=m[maxrow];m[maxrow]=tmp;if(Math.abs(m[y][y])<=eps){return m}y2=y;while(++y2<h){c=m[y2][y]/m[y][y];x=y-1;while(++x<w){m[y2][x]-=m[y][x]*c}}}y=h;while(0<=--y){c=m[y][y];y2=-1;while(++y2<y){x=w;while(--x>=y){m[y2][x]-=m[y][x]*m[y2][y]/c}}m[y][y]/=c;x=h-1;while(++x<w){m[y][x]/=c}}return m};matrix.rowReduce=function(m,epsilon){return matrix.GaussJordanEliminate(m,epsilon)};matrix.inverse=function(m){if(!matrix.isSquare(m)){throw new Error(ERROR_MATRIX_NOT_SQUARE)}var n=m.length,identity=matrix.identity(n),i;for(i=0;i<n;i++){m[i]=m[i].concat(identity[i])}m=matrix.GaussJordanEliminate(m);for(i=0;i<n;i++){m[i]=m[i].slice(n)}return m};matrix.getCol=function(M,n){var result=new Array(M.length);if(0>n){throw new Error("The specified column must be a positive integer.")}else if(n>=M[0].length){throw new Error("The specified column must be between 0 and the number of columns - 1.")}for(var i=0;i<M.length;i++){result[i]=M[i][n]}return result};matrix.getRow=function(M,n){if(0>n){throw new Error("The specified column must be a positive integer.")}else if(n>=M.length){throw new Error("The specified column must be between 0 and the number of row - 1.")}return M[n].slice()};matrix.reorderRows=function(M,L){var result=[];if(L===undefined){throw new Error("A reordering array must be entered.")}else if(L.length!==M.length){throw new Error("The reordered matrix must have the same number of rows as the original matrix.")}for(var i=0;i<L.length;i++){if(0>L[i]){throw new Error("The desired order of the rows must be positive integers.")}else if(L[i]>=L.length){throw new Error("The desired order of the rows must start at 0 and end at the number of rows - 1.")}else{result.push(M[L[i]])}}return result};matrix.reorderCols=function(M,L){var result=[];if(L===undefined){throw new Error("Please enter a desired reordering array.")}else if(L.length!==M[0].length){throw new Error("The reordered matrix must have the same number of columns as the original matrix.")}for(var i=0;i<L.length;i++){if(0>L[i]){throw new Error("The desired order of the columns must be positive integers.")}else if(L[i]>=L.length){throw new Error("The desired order of the columns must start at 0 and end at the number of columns - 1.")}else{result.push(matrix.getCol(M,L[i]))}}return matrix.transpose(result)};matrix.reverseRows=function(M){var L=[];for(var i=M.length-1;-1<i;i--){L.push(i)}return matrix.reorderRows(M,L)};matrix.reverseCols=function(M){var L=[];for(var i=M.length-1;-1<i;i--){L.push(i)}return matrix.reorderCols(M,L)};matrix.zeros=function(n,m){var M=new Array(n);if(1>n||1>m){throw new Error("The matrix dimensions must be positive integers.")}n=Math.ceil(n);m=Math.ceil(m);for(var i=0;i<n;i++){var empty=new Array(m);for(var j=0;j<m;j++){empty[j]=0}M[i]=empty}return M};matrix.zigzag=function(n,point,dir){if(1>=n){throw new Error("Matrix size must be at least 2x2.")}n=Math.ceil(n);var mat=matrix.zeros(n,n);var BRH=function(M){var jump=false,tl=n*n,br=1,inc=1,row,col,val,i,j;M[0][0]=tl;M[n-1][n-1]=br;for(i=1;i<n;i++){if(jump){tl-=4*inc;br+=4*inc;inc++}else{tl--;br++}M[0][i]=tl;M[n-1][n-1-i]=br;jump=!jump}var dec=true;for(i=1;i<n;i++){row=0;col=i;val=M[row][col];for(j=1;j<i+1;j++){if(dec){val-=1}else{val+=1}row++;col--;M[row][col]=val}dec=!dec}if(0===n%2){dec=true}else{dec=false}for(i=1;i<n-1;i++){row=n-1;col=i;val=M[row][col];for(j=1;j<n-i;j++){if(dec){val--}else{val++}row--;col++;M[row][col]=val}dec=!dec}return M};var BRV=function(M){return matrix.transpose(BRH(M))};var BLH=function(M){return matrix.reverseCols(BRH(M))};var BLV=function(M){return matrix.reverseRows(TLV(BLH(M)))};var TRH=function(M){return matrix.reverseRows(BRH(M))};var TRV=function(M){return matrix.reverseRows(BRV(M))};var TLH=function(M){return matrix.reverseCols(matrix.reverseRows(BRH(M)))};var TLV=function(M){return matrix.transpose(TLH(M))};if("BR"===point&&"H"===dir){return BRH(mat)}else if("BR"===point&&"V"===dir){return BRV(mat)}else if("BL"===point&&"H"===dir){return BLH(mat)}else if("BL"===point&&"V"===dir){return BLV(mat)}else if("TR"===point&&"H"===dir){return TRH(mat)}else if("TR"===point&&"V"===dir){return TRV(mat)}else if("TL"===point&&"H"===dir){return TLH(mat)}else if("TL"===point&&"V"===dir){return TLV(mat)}else{throw new Error("Enter the direction (V,H) and corner (BR,BL,TR,TL) correctly.")}};matrix.vectorNorm=function(v,p){if(!Array.isArray(v)||0===v.length){throw new Error("Vector must be an array of at least length 1.")}else if("undefined"!==typeof p&&"number"!==typeof p){throw new Error("Norm order must be a number.")}p="undefined"===typeof p?2:p;var n=v.length,ans=0,term,i;switch(p){case Infinity:for(i=0;i<n;i++){term=Math.abs(v[i]);if(term>ans){ans=term}}break;case-Infinity:ans=Infinity;for(i=0;i<n;i++){term=Math.abs(v[i]);if(term<ans){ans=term}}break;default:for(i=0;i<n;i++){ans+=Math.pow(Math.abs(v[i]),p)}ans=Math.pow(ans,1/p);break;}return ans};matrix.matrixNorm=function(M,p){if(!Array.isArray(M)||0===M.length||!Array.isArray(M[0])){throw new Error("Matrix must be an array of at least length 1.")}else if("undefined"!==typeof p&&"number"!==typeof p&&null!==p){throw new Error("Norm order must be a number or null.")}p="undefined"===typeof p?null:p;var m=M.length,n=M[0].length,ans=0,term,i,j;switch(p){case Infinity:for(i=0;i<m;i++){term=0;for(j=0;j<n;j++){term+=Math.abs(M[i][j])}if(term>ans){ans=term}}break;case-Infinity:ans=Infinity;for(i=0;i<m;i++){term=0;for(j=0;j<n;j++){term+=Math.abs(M[i][j])}if(term<ans){ans=term}}break;case 1:for(i=0;i<n;i++){term=0;for(j=0;j<m;j++){term+=Math.abs(M[j][i])}if(term>ans){ans=term}}break;case-1:ans=Infinity;for(i=0;i<n;i++){term=0;for(j=0;j<m;j++){term+=Math.abs(M[j][i])}if(term<ans){ans=term}}break;case null:for(i=0;i<m;i++){for(j=0;j<n;j++){ans+=Math.pow(M[i][j],2)}}ans=Math.pow(ans,0.5);break;case 2:throw new Error("Singular values are not yet supported in numbers.js.");case-2:throw new Error("Singular values are not yet supported in numbers.js.");default:for(i=0;i<m;i++){for(j=0;j<n;j++){ans+=Math.pow(Math.abs(M[i][j]),p)}}ans=Math.pow(ans,1/p);}return ans};matrix.isUpperBand=function(M,q){if(!Array.isArray(M)||!Array.isArray(M[0])||2>M.length){throw new Error("Matrix must be an array of at least dimension 2.")}else if("number"!==typeof q||0>q||0!==q%1){throw new Error("Upper bandwidth must be a nonzero integer.")}var result=true,n=M[0].length,cnt=0;for(var i=q+1;i<n;i++){if(0!==M[cnt][i]){result=false;break}cnt++}return result};matrix.isLowerBand=function(M,p){if(!Array.isArray(M)||!Array.isArray(M[0])||2>M.length){throw new Error("Matrix must be an array of at least dimension 2.")}else if("number"!==typeof p||0>p||0!==p%1){throw new Error("Lower bandwidth must be a nonzero integer.")}var result=true,m=M.length,cnt=0;for(var i=p+1;i<m;i++){if(0!==M[i][cnt]){result=false;break}cnt++}return result};var sumNondiagonalElements=function(arr,i){var sum=0,j;for(j=0;j<i;j++){sum+=Math.abs(arr[j])}for(j=i+1;j<arr.length;j++){sum+=Math.abs(arr[j])}return sum};matrix.isRowDD=function(M){var n=M.length;if(!matrix.isSquare(M)){throw new Error(ERROR_MATRIX_NOT_SQUARE)}for(var i=0;i<n;i++){var row=M[i],diag=row[i],sum=sumNondiagonalElements(row,i);if(Math.abs(diag)<sum){return false}}return true};matrix.isStrictlyRowDD=function(M){if(!matrix.isSquare(M)){throw new Error(ERROR_MATRIX_NOT_SQUARE)}var n=M.length;for(var i=0;i<n;i++){var row=M[i],diag=row[i],sum=sumNondiagonalElements(row,i);if(Math.abs(diag)<=sum){return false}}return true};matrix.isColumnDD=function(M){if(!matrix.isSquare){throw new Error(ERROR_MATRIX_NOT_SQUARE)}var n=M.length;for(var i=0;i<n;i++){var col=matrix.getCol(M,i),diag=col[i],sum=sumNondiagonalElements(col,i);if(Math.abs(diag)<sum){return false}}return true};matrix.isStrictlyColumnDD=function(M){if(!matrix.isSquare(M)){throw new Error(ERROR_MATRIX_NOT_SQUARE)}var n=M.length;for(var i=0;i<n;i++){var col=matrix.getCol(M,i),diag=col[i],sum=sumNondiagonalElements(col,i);if(Math.abs(diag)<=sum){return false}}return true};matrix.addCols=function(M,c){let res=matrix.deepCopy(M);let n=res.length;if(c.length!=n)return false;for(let i=0;i<n;i++){col=res[i];col.push(...c[i]);res[i]=col}return res};matrix.block=function(M,a,b,c,d){var elements=[],ni=c,i,nj,j;var rows=M.length,cols=M[0].length;do{i=c-ni;elements[i]=[];nj=d;do{j=d-nj;elements[i][j]=M[(a+i-1)%rows][(b+j-1)%cols]}while(--nj)}while(--ni);return elements.slice()};matrix.cross=function(vector,elements){var A=vector;if(3!=elements.length||3!=A.length){return null}var B=elements;return[A[1]*B[2]-A[2]*B[1],A[2]*B[0]-A[0]*B[2],A[0]*B[1]-A[1]*B[0]]};;var pi=3.14159265358979;var sm_a=6378137;var sm_b=6356752.314;var sm_EccSquared=0.00669437999013;var UTMScaleFactor=0.9996;function DegToRad(deg){return deg/180*pi}function RadToDeg(rad){return 180*(rad/pi)}function ArcLengthOfMeridian(phi){var alpha,beta,gamma,delta,epsilon,n;var result;n=(sm_a-sm_b)/(sm_a+sm_b);alpha=(sm_a+sm_b)/2*(1+Math.pow(n,2)/4+Math.pow(n,4)/64);beta=-3*n/2+9*Math.pow(n,3)/16+-3*Math.pow(n,5)/32;gamma=15*Math.pow(n,2)/16+-15*Math.pow(n,4)/32;delta=-35*Math.pow(n,3)/48+105*Math.pow(n,5)/256;epsilon=315*Math.pow(n,4)/512;result=alpha*(phi+beta*Math.sin(2*phi)+gamma*Math.sin(4*phi)+delta*Math.sin(6*phi)+epsilon*Math.sin(8*phi));return result}function UTMCentralMeridian(zone){var cmeridian;cmeridian=DegToRad(-183+6*zone);return cmeridian}function FootpointLatitude(y){var y_,alpha_,beta_,gamma_,delta_,epsilon_,n;var result;n=(sm_a-sm_b)/(sm_a+sm_b);alpha_=(sm_a+sm_b)/2*(1+Math.pow(n,2)/4+Math.pow(n,4)/64);y_=y/alpha_;beta_=3*n/2+-27*Math.pow(n,3)/32+269*Math.pow(n,5)/512;gamma_=21*Math.pow(n,2)/16+-55*Math.pow(n,4)/32;delta_=151*Math.pow(n,3)/96+-417*Math.pow(n,5)/128;epsilon_=1097*Math.pow(n,4)/512;result=y_+beta_*Math.sin(2*y_)+gamma_*Math.sin(4*y_)+delta_*Math.sin(6*y_)+epsilon_*Math.sin(8*y_);return result}function MapLatLonToXY(phi,lambda,lambda0,xy){var N,nu2,ep2,t,t2,l;var l3coef,l4coef,l5coef,l6coef,l7coef,l8coef;var tmp;ep2=(Math.pow(sm_a,2)-Math.pow(sm_b,2))/Math.pow(sm_b,2);nu2=ep2*Math.pow(Math.cos(phi),2);N=Math.pow(sm_a,2)/(sm_b*Math.sqrt(1+nu2));t=Math.tan(phi);t2=t*t;tmp=t2*t2*t2-Math.pow(t,6);l=lambda-lambda0;l3coef=1-t2+nu2;l4coef=5-t2+9*nu2+4*(nu2*nu2);l5coef=5-18*t2+t2*t2+14*nu2-58*t2*nu2;l6coef=61-58*t2+t2*t2+270*nu2-330*t2*nu2;l7coef=61-479*t2+179*(t2*t2)-t2*t2*t2;l8coef=1385-3111*t2+543*(t2*t2)-t2*t2*t2;xy[0]=N*Math.cos(phi)*l+N/6*Math.pow(Math.cos(phi),3)*l3coef*Math.pow(l,3)+N/120*Math.pow(Math.cos(phi),5)*l5coef*Math.pow(l,5)+N/5040*Math.pow(Math.cos(phi),7)*l7coef*Math.pow(l,7);xy[1]=ArcLengthOfMeridian(phi)+t/2*N*Math.pow(Math.cos(phi),2)*Math.pow(l,2)+t/24*N*Math.pow(Math.cos(phi),4)*l4coef*Math.pow(l,4)+t/720*N*Math.pow(Math.cos(phi),6)*l6coef*Math.pow(l,6)+t/40320*N*Math.pow(Math.cos(phi),8)*l8coef*Math.pow(l,8);return}function MapXYToLatLon(x,y,lambda0,philambda){var phif,Nf,Nfpow,nuf2,ep2,tf,tf2,tf4,cf;var x1frac,x2frac,x3frac,x4frac,x5frac,x6frac,x7frac,x8frac;var x2poly,x3poly,x4poly,x5poly,x6poly,x7poly,x8poly;phif=FootpointLatitude(y);ep2=(Math.pow(sm_a,2)-Math.pow(sm_b,2))/Math.pow(sm_b,2);cf=Math.cos(phif);nuf2=ep2*Math.pow(cf,2);Nf=Math.pow(sm_a,2)/(sm_b*Math.sqrt(1+nuf2));Nfpow=Nf;tf=Math.tan(phif);tf2=tf*tf;tf4=tf2*tf2;x1frac=1/(Nfpow*cf);Nfpow*=Nf;x2frac=tf/(2*Nfpow);Nfpow*=Nf;x3frac=1/(6*Nfpow*cf);Nfpow*=Nf;x4frac=tf/(24*Nfpow);Nfpow*=Nf;x5frac=1/(120*Nfpow*cf);Nfpow*=Nf;x6frac=tf/(720*Nfpow);Nfpow*=Nf;x7frac=1/(5040*Nfpow*cf);Nfpow*=Nf;x8frac=tf/(40320*Nfpow);x2poly=-1-nuf2;x3poly=-1-2*tf2-nuf2;x4poly=5+3*tf2+6*nuf2-6*tf2*nuf2-3*(nuf2*nuf2)-9*tf2*(nuf2*nuf2);x5poly=5+28*tf2+24*tf4+6*nuf2+8*tf2*nuf2;x6poly=-61-90*tf2-45*tf4-107*nuf2+162*tf2*nuf2;x7poly=-61-662*tf2-1320*tf4-720*(tf4*tf2);x8poly=1385+3633*tf2+4095*tf4+1575*(tf4*tf2);philambda[0]=phif+x2frac*x2poly*(x*x)+x4frac*x4poly*Math.pow(x,4)+x6frac*x6poly*Math.pow(x,6)+x8frac*x8poly*Math.pow(x,8);philambda[1]=lambda0+x1frac*x+x3frac*x3poly*Math.pow(x,3)+x5frac*x5poly*Math.pow(x,5)+x7frac*x7poly*Math.pow(x,7);return}function LatLonToUTMXY(lat,lon,zone,xy){MapLatLonToXY(lat,lon,UTMCentralMeridian(zone),xy);xy[0]=xy[0]*UTMScaleFactor+500000;xy[1]=xy[1]*UTMScaleFactor;if(0>xy[1])xy[1]=xy[1]+10000000;return zone}function UTMXYToLatLon(x,y,zone,southhemi,latlon){var cmeridian;x-=500000;x/=UTMScaleFactor;if(southhemi)y-=10000000;y/=UTMScaleFactor;cmeridian=UTMCentralMeridian(zone);MapXYToLatLon(x,y,cmeridian,latlon);return}function iD.util.LLtoUTM_(lon,lat){var xy=new Array(2);zone=Math.floor((lon+180)/6)+1;zone=LatLonToUTMXY(DegToRad(lat),DegToRad(lon),zone,xy);return{x:xy[0],y:xy[1],zone}}function UTMtoLL(x,y,UTMZone){var latlon=new Array(2);if(1>UTMZone||60<UTMZone){alert("The UTM zone you entered is out of range.  "+"Please enter a number in the range [1, 60].");return false}let southhemi=false;UTMXYToLatLon(x,y,zone,southhemi,latlon);return[RadToDeg(latlon[1]),RadToDeg(latlon[0])]};;;;(function(e){if("function"==typeof bootstrap)bootstrap("osmauth",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeOsmAuth=e}else"undefined"!=typeof window?window.osmAuth=e():global.osmAuth=e()})(function(){var define,ses,bootstrap,module,exports;return function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o="function"==typeof require&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r="function"==typeof require&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}({1:[function(require,module,exports){"use strict";var ohauth=require("ohauth"),xtend=require("xtend"),store=require("store");module.exports=function(o){var oauth={};oauth.authenticated=function(){return!!(token("oauth_token")&&token("oauth_token_secret"))};oauth.logout=function(){token("oauth_token","");token("oauth_token_secret","");token("oauth_request_token_secret","");return oauth};oauth.authenticate=function(callback){if(oauth.authenticated())return callback();oauth.logout();var params=timenonce(getAuth(o)),url=o.url+"/oauth/request_token";params.oauth_signature=ohauth.signature(o.oauth_secret,"",ohauth.baseString("POST",url,params));if(!o.singlepage){var w=600,h=550,settings=[["width",w],["height",h],["left",screen.width/2-w/2],["top",screen.height/2-h/2]].map(function(x){return x.join("=")}).join(","),popup=window.open("about:blank","oauth_window",settings)}ohauth.xhr("POST",url,params,null,{},reqTokenDone);o.loading();function reqTokenDone(err,xhr){o.done();if(err)return callback(err);var resp=ohauth.stringQs(xhr.response);token("oauth_request_token_secret",resp.oauth_token_secret);var authorize_url=o.url+"/oauth/authorize?"+ohauth.qsString({oauth_token:resp.oauth_token,oauth_callback:location.href.replace("index.html","").replace(/#.*/,"")+o.landing});if(o.singlepage){location.href=authorize_url}else{popup.location=authorize_url}}window.authComplete=function(token){var oauth_token=ohauth.stringQs(token.split("?")[1]);get_access_token(oauth_token.oauth_token);delete window.authComplete};function get_access_token(oauth_token){var url=o.url+"/oauth/access_token",params=timenonce(getAuth(o)),request_token_secret=token("oauth_request_token_secret");params.oauth_token=oauth_token;params.oauth_signature=ohauth.signature(o.oauth_secret,request_token_secret,ohauth.baseString("POST",url,params));ohauth.xhr("POST",url,params,null,{},accessTokenDone);o.loading()}function accessTokenDone(err,xhr){o.done();if(err)return callback(err);var access_token=ohauth.stringQs(xhr.response);token("oauth_token",access_token.oauth_token);token("oauth_token_secret",access_token.oauth_token_secret);callback(null,oauth)}};oauth.bootstrapToken=function(oauth_token,callback){function get_access_token(oauth_token){var url=o.url+"/oauth/access_token",params=timenonce(getAuth(o)),request_token_secret=token("oauth_request_token_secret");params.oauth_token=oauth_token;params.oauth_signature=ohauth.signature(o.oauth_secret,request_token_secret,ohauth.baseString("POST",url,params));ohauth.xhr("POST",url,params,null,{},accessTokenDone);o.loading()}function accessTokenDone(err,xhr){o.done();if(err)return callback(err);var access_token=ohauth.stringQs(xhr.response);token("oauth_token",access_token.oauth_token);token("oauth_token_secret",access_token.oauth_token_secret);callback(null,oauth)}get_access_token(oauth_token)};oauth.ohauth=ohauth;oauth.xhr=function(options,callback){if(!oauth.authenticated()){if(o.auto)return oauth.authenticate(run);else return callback("not authenticated",null)}else return run();function run(){var params=timenonce(getAuth(o)),url=o.url+options.path,oauth_token_secret=token("oauth_token_secret");if((!options.options||!options.options.header||"application/x-www-form-urlencoded"===options.options.header["Content-Type"])&&options.content){params=xtend(params,ohauth.stringQs(options.content))}params.oauth_token=token("oauth_token");params.oauth_signature=ohauth.signature(o.oauth_secret,oauth_token_secret,ohauth.baseString(options.method,url,params));ohauth.xhr(options.method,url,params,options.content,options.options,done)}function done(err,xhr){if(err)return callback(err);else if(xhr.responseXML)return callback(err,xhr.responseXML);else return callback(err,xhr.response)}};oauth.preauth=function(c){if(!c)return;if(c.oauth_token)token("oauth_token",c.oauth_token);if(c.oauth_token_secret)token("oauth_token_secret",c.oauth_token_secret);return oauth};oauth.options=function(_){if(!arguments.length)return o;o=_;o.url=o.url||"http://www.openstreetmap.org";o.landing=o.landing||"land.html";o.singlepage=o.singlepage||false;o.loading=o.loading||function(){};o.done=o.done||function(){};return oauth.preauth(o)};function timenonce(o){o.oauth_timestamp=ohauth.timestamp();o.oauth_nonce=ohauth.nonce();return o}var token;if(store.enabled){token=function(x,y){if(1===arguments.length)return store.get(o.url+x);else if(2===arguments.length)return store.set(o.url+x,y)}}else{var storage={};token=function(x,y){if(1===arguments.length)return storage[o.url+x];else if(2===arguments.length)return storage[o.url+x]=y}}function getAuth(o){return{oauth_consumer_key:o.oauth_consumer_key,oauth_signature_method:"HMAC-SHA1"}}oauth.options(o);return oauth}},{ohauth:2,store:3,xtend:4}],3:[function(require,module,exports){;;(function(global){;(function(win){var store={},doc=win.document,localStorageName="localStorage",storage;store.disabled=false;store.set=function(key,value){};store.get=function(key){};store.remove=function(key){};store.clear=function(){};store.transact=function(key,defaultVal,transactionFn){var val=store.get(key);if(null==transactionFn){transactionFn=defaultVal;defaultVal=null}if("undefined"==typeof val){val=defaultVal||{}}transactionFn(val);store.set(key,val)};store.getAll=function(){};store.forEach=function(){};store.serialize=function(value){return JSON.stringify(value)};store.deserialize=function(value){if("string"!=typeof value){return undefined}try{return JSON.parse(value)}catch(e){return value||undefined}};function isLocalStorageNameSupported(){try{return localStorageName in win&&win[localStorageName]}catch(err){return false}}if(isLocalStorageNameSupported()){storage=win[localStorageName];store.set=function(key,val){if(val===undefined){return store.remove(key)}storage.setItem(key,store.serialize(val));return val};store.get=function(key){return store.deserialize(storage.getItem(key))};store.remove=function(key){storage.removeItem(key)};store.clear=function(){storage.clear()};store.getAll=function(){var ret={};store.forEach(function(key,val){ret[key]=val});return ret};store.forEach=function(callback){for(var i=0;i<storage.length;i++){var key=storage.key(i);callback(key,store.get(key))}}}else if(doc.documentElement.addBehavior){var storageOwner,storageContainer;try{storageContainer=new ActiveXObject("htmlfile");storageContainer.open();storageContainer.write("<s"+"cript>document.w=window</s"+"cript><iframe src=\"\"></iframe>");storageContainer.close();storageOwner=storageContainer.w.frames[0].document;storage=storageOwner.createElement("div")}catch(e){storage=doc.createElement("div");storageOwner=doc.body}function withIEStorage(storeFunction){return function(){var args=Array.prototype.slice.call(arguments,0);args.unshift(storage);storageOwner.appendChild(storage);storage.addBehavior("#default#userData");storage.load(localStorageName);var result=storeFunction.apply(store,args);storageOwner.removeChild(storage);return result}}var forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function ieKeyFix(key){return key.replace(forbiddenCharsRegex,"___")}store.set=withIEStorage(function(storage,key,val){key=ieKeyFix(key);if(val===undefined){return store.remove(key)}storage.setAttribute(key,store.serialize(val));storage.save(localStorageName);return val});store.get=withIEStorage(function(storage,key){key=ieKeyFix(key);return store.deserialize(storage.getAttribute(key))});store.remove=withIEStorage(function(storage,key){key=ieKeyFix(key);storage.removeAttribute(key);storage.save(localStorageName)});store.clear=withIEStorage(function(storage){var attributes=storage.XMLDocument.documentElement.attributes;storage.load(localStorageName);for(var i=0,attr;attr=attributes[i];i++){storage.removeAttribute(attr.name)}storage.save(localStorageName)});store.getAll=function(storage){var ret={};store.forEach(function(key,val){ret[key]=val});return ret};store.forEach=withIEStorage(function(storage,callback){var attributes=storage.XMLDocument.documentElement.attributes;for(var i=0,attr;attr=attributes[i];++i){callback(attr.name,store.deserialize(storage.getAttribute(attr.name)))}})}try{var testKey="__storejs__";store.set(testKey,testKey);if(store.get(testKey)!=testKey){store.disabled=true}store.remove(testKey)}catch(e){store.disabled=true}store.enabled=!store.disabled;if("undefined"!=typeof module&&module.exports){module.exports=store}else if("function"===typeof define&&define.amd){define(store)}else{win.store=store}})(window||global)})(window)},{}],5:[function(require,module,exports){module.exports=hasKeys;function hasKeys(source){return null!==source&&("object"===typeof source||"function"===typeof source)}},{}],4:[function(require,module,exports){var Keys=require("object-keys");var hasKeys=require("./has-keys");module.exports=extend;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];if(!hasKeys(source)){continue}var keys=Keys(source);for(var j=0;j<keys.length;j++){var name=keys[j];target[name]=source[name]}}return target}},{"./has-keys":5,"object-keys":6}],7:[function(require,module,exports){;;(function(global){;;(function(){var Hashes;function utf8Encode(str){var x,y,output="",i=-1,l;if(str&&str.length){l=str.length;while((i+=1)<l){x=str.charCodeAt(i);y=i+1<l?str.charCodeAt(i+1):0;if(55296<=x&&56319>=x&&56320<=y&&57343>=y){x=65536+((1023&x)<<10)+(1023&y);i+=1}if(127>=x){output+=String.fromCharCode(x)}else if(2047>=x){output+=String.fromCharCode(192|31&x>>>6,128|63&x)}else if(65535>=x){output+=String.fromCharCode(224|15&x>>>12,128|63&x>>>6,128|63&x)}else if(2097151>=x){output+=String.fromCharCode(240|7&x>>>18,128|63&x>>>12,128|63&x>>>6,128|63&x)}}}return output}function utf8Decode(str){var i,ac,c1,c2,c3,arr=[],l;i=ac=c1=c2=c3=0;if(str&&str.length){l=str.length;str+="";while(i<l){c1=str.charCodeAt(i);ac+=1;if(128>c1){arr[ac]=String.fromCharCode(c1);i+=1}else if(191<c1&&224>c1){c2=str.charCodeAt(i+1);arr[ac]=String.fromCharCode((31&c1)<<6|63&c2);i+=2}else{c2=str.charCodeAt(i+1);c3=str.charCodeAt(i+2);arr[ac]=String.fromCharCode((15&c1)<<12|(63&c2)<<6|63&c3);i+=3}}}return arr.join("")}function safe_add(x,y){var lsw=(65535&x)+(65535&y),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|65535&lsw}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}function rstr2hex(input,hexcase){var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef",output="",x,i=0,l=input.length;for(;i<l;i+=1){x=input.charCodeAt(i);output+=hex_tab.charAt(15&x>>>4)+hex_tab.charAt(15&x)}return output}function str2rstr_utf16le(input){var i,l=input.length,output="";for(i=0;i<l;i+=1){output+=String.fromCharCode(255&input.charCodeAt(i),255&input.charCodeAt(i)>>>8)}return output}function str2rstr_utf16be(input){var i,l=input.length,output="";for(i=0;i<l;i+=1){output+=String.fromCharCode(255&input.charCodeAt(i)>>>8,255&input.charCodeAt(i))}return output}function binb2rstr(input){var i,l=32*input.length,output="";for(i=0;i<l;i+=8){output+=String.fromCharCode(255&input[i>>5]>>>24-i%32)}return output}function binl2rstr(input){var i,l=32*input.length,output="";for(i=0;i<l;i+=8){output+=String.fromCharCode(255&input[i>>5]>>>i%32)}return output}function rstr2binl(input){var i,l=8*input.length,output=Array(input.length>>2),lo=output.length;for(i=0;i<lo;i+=1){output[i]=0}for(i=0;i<l;i+=8){output[i>>5]|=(255&input.charCodeAt(i/8))<<i%32}return output}function rstr2binb(input){var i,l=8*input.length,output=Array(input.length>>2),lo=output.length;for(i=0;i<lo;i+=1){output[i]=0}for(i=0;i<l;i+=8){output[i>>5]|=(255&input.charCodeAt(i/8))<<24-i%32}return output}function rstr2any(input,encoding){var divisor=encoding.length,remainders=Array(),i,q,x,ld,quotient,dividend,output,full_length;dividend=Array(Math.ceil(input.length/2));ld=dividend.length;for(i=0;i<ld;i+=1){dividend[i]=input.charCodeAt(2*i)<<8|input.charCodeAt(2*i+1)}while(0<dividend.length){quotient=Array();x=0;for(i=0;i<dividend.length;i+=1){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(0<quotient.length||0<q){quotient[quotient.length]=q}}remainders[remainders.length]=x;dividend=quotient}output="";for(i=remainders.length-1;0<=i;i--){output+=encoding.charAt(remainders[i])}full_length=Math.ceil(8*input.length/(Math.log(encoding.length)/Math.log(2)));for(i=output.length;i<full_length;i+=1){output=encoding[0]+output}return output}function rstr2b64(input,b64pad){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",output="",len=input.length,i,j,triplet;b64pad=b64pad||"=";for(i=0;i<len;i+=3){triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(j=0;4>j;j+=1){if(8*i+6*j>8*input.length){output+=b64pad}else{output+=tab.charAt(63&triplet>>>6*(3-j))}}}return output}Hashes={VERSION:"1.0.3",Base64:function(){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pad="=",url=false,utf8=true;this.encode=function(input){var i,j,triplet,output="",len=input.length;pad=pad||"=";input=utf8?utf8Encode(input):input;for(i=0;i<len;i+=3){triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(j=0;4>j;j+=1){if(8*i+6*j>8*len){output+=pad}else{output+=tab.charAt(63&triplet>>>6*(3-j))}}}return output};this.decode=function(input){var i,o1,o2,o3,h1,h2,h3,h4,bits,ac,dec="",arr=[];if(!input){return input}i=ac=0;input=input.replace(new RegExp("\\"+pad,"gi"),"");do{h1=tab.indexOf(input.charAt(i+=1));h2=tab.indexOf(input.charAt(i+=1));h3=tab.indexOf(input.charAt(i+=1));h4=tab.indexOf(input.charAt(i+=1));bits=h1<<18|h2<<12|h3<<6|h4;o1=255&bits>>16;o2=255&bits>>8;o3=255&bits;ac+=1;if(64===h3){arr[ac]=String.fromCharCode(o1)}else if(64===h4){arr[ac]=String.fromCharCode(o1,o2)}else{arr[ac]=String.fromCharCode(o1,o2,o3)}}while(i<input.length);dec=arr.join("");dec=utf8?utf8Decode(dec):dec;return dec};this.setPad=function(str){pad=str||pad;return this};this.setTab=function(str){tab=str||tab;return this};this.setUTF8=function(bool){if("boolean"===typeof bool){utf8=bool}return this}},CRC32:function(str){var crc=0,x=0,y=0,table,i,iTop;str=utf8Encode(str);table=["00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 ","79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 ","84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F ","63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD ","A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC ","51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 ","B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 ","06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 ","E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 ","12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 ","D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 ","33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 ","CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 ","9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E ","7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D ","806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 ","60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA ","AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 ","5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 ","B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 ","05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 ","F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA ","11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 ","D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F ","30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E ","C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D"].join("");crc=-1^crc;for(i=0,iTop=str.length;i<iTop;i+=1){y=255&(crc^str.charCodeAt(i));x="0x"+table.substr(9*y,8);crc=crc>>>8^x}return(-1^crc)>>>0},MD5:function(options){var hexcase=options&&"boolean"===typeof options.uppercase?options.uppercase:false,b64pad=options&&"string"===typeof options.pad?options.pda:"=",utf8=options&&"boolean"===typeof options.utf8?options.utf8:true;this.hex=function(s){return rstr2hex(rstr(s,utf8),hexcase)};this.b64=function(s){return rstr2b64(rstr(s),b64pad)};this.any=function(s,e){return rstr2any(rstr(s,utf8),e)};this.hex_hmac=function(k,d){return rstr2hex(rstr_hmac(k,d),hexcase)};this.b64_hmac=function(k,d){return rstr2b64(rstr_hmac(k,d),b64pad)};this.any_hmac=function(k,d,e){return rstr2any(rstr_hmac(k,d),e)};this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()};this.setUpperCase=function(a){if("boolean"===typeof a){hexcase=a}return this};this.setPad=function(a){b64pad=a||b64pad;return this};this.setUTF8=function(a){if("boolean"===typeof a){utf8=a}return this};function rstr(s){s=utf8?utf8Encode(s):s;return binl2rstr(binl(rstr2binl(s),8*s.length))}function rstr_hmac(key,data){var bkey,ipad,opad,hash,i;key=utf8?utf8Encode(key):key;data=utf8?utf8Encode(data):data;bkey=rstr2binl(key);if(16<bkey.length){bkey=binl(bkey,8*key.length)}ipad=Array(16),opad=Array(16);for(i=0;16>i;i+=1){ipad[i]=909522486^bkey[i];opad[i]=1549556828^bkey[i]}hash=binl(ipad.concat(rstr2binl(data)),512+8*data.length);return binl2rstr(binl(opad.concat(hash),512+128))}function binl(x,len){var i,olda,oldb,oldc,oldd,a=1732584193,b=-271733879,c=-1732584194,d=271733878;x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;for(i=0;i<x.length;i+=16){olda=a;oldb=b;oldc=c;oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}},SHA1:function(options){var hexcase=options&&"boolean"===typeof options.uppercase?options.uppercase:false,b64pad=options&&"string"===typeof options.pad?options.pda:"=",utf8=options&&"boolean"===typeof options.utf8?options.utf8:true;this.hex=function(s){return rstr2hex(rstr(s,utf8),hexcase)};this.b64=function(s){return rstr2b64(rstr(s,utf8),b64pad)};this.any=function(s,e){return rstr2any(rstr(s,utf8),e)};this.hex_hmac=function(k,d){return rstr2hex(rstr_hmac(k,d))};this.b64_hmac=function(k,d){return rstr2b64(rstr_hmac(k,d),b64pad)};this.any_hmac=function(k,d,e){return rstr2any(rstr_hmac(k,d),e)};this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()};this.setUpperCase=function(a){if("boolean"===typeof a){hexcase=a}return this};this.setPad=function(a){b64pad=a||b64pad;return this};this.setUTF8=function(a){if("boolean"===typeof a){utf8=a}return this};function rstr(s){s=utf8?utf8Encode(s):s;return binb2rstr(binb(rstr2binb(s),8*s.length))}function rstr_hmac(key,data){var bkey,ipad,opad,i,hash;key=utf8?utf8Encode(key):key;data=utf8?utf8Encode(data):data;bkey=rstr2binb(key);if(16<bkey.length){bkey=binb(bkey,8*key.length)}ipad=Array(16),opad=Array(16);for(i=0;16>i;i+=1){ipad[i]=909522486^bkey[i];opad[i]=1549556828^bkey[i]}hash=binb(ipad.concat(rstr2binb(data)),512+8*data.length);return binb2rstr(binb(opad.concat(hash),512+160))}function binb(x,len){var i,j,t,olda,oldb,oldc,oldd,olde,w=Array(80),a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;x[len>>5]|=128<<24-len%32;x[(len+64>>9<<4)+15]=len;for(i=0;i<x.length;i+=16){olda=a,oldb=b;oldc=c;oldd=d;olde=e;for(j=0;80>j;j+=1){if(16>j){w[j]=x[i+j]}else{w[j]=bit_rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1)}t=safe_add(safe_add(bit_rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=bit_rol(b,30);b=a;a=t}a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde)}return Array(a,b,c,d,e)}function sha1_ft(t,b,c,d){if(20>t){return b&c|~b&d}if(40>t){return b^c^d}if(60>t){return b&c|b&d|c&d}return b^c^d}function sha1_kt(t){return 20>t?1518500249:40>t?1859775393:60>t?-1894007588:-899497514}},SHA256:function(options){var hexcase=options&&"boolean"===typeof options.uppercase?options.uppercase:false,b64pad=options&&"string"===typeof options.pad?options.pda:"=",utf8=options&&"boolean"===typeof options.utf8?options.utf8:true,sha256_K;this.hex=function(s){return rstr2hex(rstr(s,utf8))};this.b64=function(s){return rstr2b64(rstr(s,utf8),b64pad)};this.any=function(s,e){return rstr2any(rstr(s,utf8),e)};this.hex_hmac=function(k,d){return rstr2hex(rstr_hmac(k,d))};this.b64_hmac=function(k,d){return rstr2b64(rstr_hmac(k,d),b64pad)};this.any_hmac=function(k,d,e){return rstr2any(rstr_hmac(k,d),e)};this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()};this.setUpperCase=function(a){if("boolean"===typeof a){hexcase=a}return this};this.setPad=function(a){b64pad=a||b64pad;return this};this.setUTF8=function(a){if("boolean"===typeof a){utf8=a}return this};function rstr(s,utf8){s=utf8?utf8Encode(s):s;return binb2rstr(binb(rstr2binb(s),8*s.length))}function rstr_hmac(key,data){key=utf8?utf8Encode(key):key;data=utf8?utf8Encode(data):data;var hash,i=0,bkey=rstr2binb(key),ipad=Array(16),opad=Array(16);if(16<bkey.length){bkey=binb(bkey,8*key.length)}for(;16>i;i+=1){ipad[i]=909522486^bkey[i];opad[i]=1549556828^bkey[i]}hash=binb(ipad.concat(rstr2binb(data)),512+8*data.length);return binb2rstr(binb(opad.concat(hash),512+256))}function sha256_S(X,n){return X>>>n|X<<32-n}function sha256_R(X,n){return X>>>n}function sha256_Ch(x,y,z){return x&y^~x&z}function sha256_Maj(x,y,z){return x&y^x&z^y&z}function sha256_Sigma0256(x){return sha256_S(x,2)^sha256_S(x,13)^sha256_S(x,22)}function sha256_Sigma1256(x){return sha256_S(x,6)^sha256_S(x,11)^sha256_S(x,25)}function sha256_Gamma0256(x){return sha256_S(x,7)^sha256_S(x,18)^sha256_R(x,3)}function sha256_Gamma1256(x){return sha256_S(x,17)^sha256_S(x,19)^sha256_R(x,10)}function sha256_Sigma0512(x){return sha256_S(x,28)^sha256_S(x,34)^sha256_S(x,39)}function sha256_Sigma1512(x){return sha256_S(x,14)^sha256_S(x,18)^sha256_S(x,41)}function sha256_Gamma0512(x){return sha256_S(x,1)^sha256_S(x,8)^sha256_R(x,7)}function sha256_Gamma1512(x){return sha256_S(x,19)^sha256_S(x,61)^sha256_R(x,6)}sha256_K=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];function binb(m,l){var HASH=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225];var W=new Array(64);var a,b,c,d,e,f,g,h;var i,j,T1,T2;m[l>>5]|=128<<24-l%32;m[(l+64>>9<<4)+15]=l;for(i=0;i<m.length;i+=16){a=HASH[0];b=HASH[1];c=HASH[2];d=HASH[3];e=HASH[4];f=HASH[5];g=HASH[6];h=HASH[7];for(j=0;64>j;j+=1){if(16>j){W[j]=m[j+i]}else{W[j]=safe_add(safe_add(safe_add(sha256_Gamma1256(W[j-2]),W[j-7]),sha256_Gamma0256(W[j-15])),W[j-16])}T1=safe_add(safe_add(safe_add(safe_add(h,sha256_Sigma1256(e)),sha256_Ch(e,f,g)),sha256_K[j]),W[j]);T2=safe_add(sha256_Sigma0256(a),sha256_Maj(a,b,c));h=g;g=f;f=e;e=safe_add(d,T1);d=c;c=b;b=a;a=safe_add(T1,T2)}HASH[0]=safe_add(a,HASH[0]);HASH[1]=safe_add(b,HASH[1]);HASH[2]=safe_add(c,HASH[2]);HASH[3]=safe_add(d,HASH[3]);HASH[4]=safe_add(e,HASH[4]);HASH[5]=safe_add(f,HASH[5]);HASH[6]=safe_add(g,HASH[6]);HASH[7]=safe_add(h,HASH[7])}return HASH}},SHA512:function(options){var hexcase=options&&"boolean"===typeof options.uppercase?options.uppercase:false,b64pad=options&&"string"===typeof options.pad?options.pda:"=",utf8=options&&"boolean"===typeof options.utf8?options.utf8:true,sha512_k;this.hex=function(s){return rstr2hex(rstr(s))};this.b64=function(s){return rstr2b64(rstr(s),b64pad)};this.any=function(s,e){return rstr2any(rstr(s),e)};this.hex_hmac=function(k,d){return rstr2hex(rstr_hmac(k,d))};this.b64_hmac=function(k,d){return rstr2b64(rstr_hmac(k,d),b64pad)};this.any_hmac=function(k,d,e){return rstr2any(rstr_hmac(k,d),e)};this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()};this.setUpperCase=function(a){if("boolean"===typeof a){hexcase=a}return this};this.setPad=function(a){b64pad=a||b64pad;return this};this.setUTF8=function(a){if("boolean"===typeof a){utf8=a}return this};function rstr(s){s=utf8?utf8Encode(s):s;return binb2rstr(binb(rstr2binb(s),8*s.length))}function rstr_hmac(key,data){key=utf8?utf8Encode(key):key;data=utf8?utf8Encode(data):data;var hash,i=0,bkey=rstr2binb(key),ipad=Array(32),opad=Array(32);if(32<bkey.length){bkey=binb(bkey,8*key.length)}for(;32>i;i+=1){ipad[i]=909522486^bkey[i];opad[i]=1549556828^bkey[i]}hash=binb(ipad.concat(rstr2binb(data)),1024+8*data.length);return binb2rstr(binb(opad.concat(hash),1024+512))}function binb(x,len){var j,i,l,W=new Array(80),hash=new Array(16),H=[new int64(1779033703,-205731576),new int64(-1150833019,-2067093701),new int64(1013904242,-23791573),new int64(-1521486534,1595750129),new int64(1359893119,-1377402159),new int64(-1694144372,725511199),new int64(528734635,-79577749),new int64(1541459225,327033209)],T1=new int64(0,0),T2=new int64(0,0),a=new int64(0,0),b=new int64(0,0),c=new int64(0,0),d=new int64(0,0),e=new int64(0,0),f=new int64(0,0),g=new int64(0,0),h=new int64(0,0),s0=new int64(0,0),s1=new int64(0,0),Ch=new int64(0,0),Maj=new int64(0,0),r1=new int64(0,0),r2=new int64(0,0),r3=new int64(0,0);if(sha512_k===undefined){sha512_k=[new int64(1116352408,-685199838),new int64(1899447441,602891725),new int64(-1245643825,-330482897),new int64(-373957723,-2121671748),new int64(961987163,-213338824),new int64(1508970993,-1241133031),new int64(-1841331548,-1357295717),new int64(-1424204075,-630357736),new int64(-670586216,-1560083902),new int64(310598401,1164996542),new int64(607225278,1323610764),new int64(1426881987,-704662302),new int64(1925078388,-226784913),new int64(-2132889090,991336113),new int64(-1680079193,633803317),new int64(-1046744716,-815192428),new int64(-459576895,-1628353838),new int64(-272742522,944711139),new int64(264347078,-1953704523),new int64(604807628,2007800933),new int64(770255983,1495990901),new int64(1249150122,1856431235),new int64(1555081692,-1119749164),new int64(1996064986,-2096016459),new int64(-1740746414,-295247957),new int64(-1473132947,766784016),new int64(-1341970488,-1728372417),new int64(-1084653625,-1091629340),new int64(-958395405,1034457026),new int64(-710438585,-1828018395),new int64(113926993,-536640913),new int64(338241895,168717936),new int64(666307205,1188179964),new int64(773529912,1546045734),new int64(1294757372,1522805485),new int64(1396182291,-1651133473),new int64(1695183700,-1951439906),new int64(1986661051,1014477480),new int64(-2117940946,1206759142),new int64(-1838011259,344077627),new int64(-1564481375,1290863460),new int64(-1474664885,-1136513023),new int64(-1035236496,-789014639),new int64(-949202525,106217008),new int64(-778901479,-688958952),new int64(-694614492,1432725776),new int64(-200395387,1467031594),new int64(275423344,851169720),new int64(430227734,-1194143544),new int64(506948616,1363258195),new int64(659060556,-544281703),new int64(883997877,-509917016),new int64(958139571,-976659869),new int64(1322822218,-482243893),new int64(1537002063,2003034995),new int64(1747873779,-692930397),new int64(1955562222,1575990012),new int64(2024104815,1125592928),new int64(-2067236844,-1578062990),new int64(-1933114872,442776044),new int64(-1866530822,593698344),new int64(-1538233109,-561857047),new int64(-1090935817,-1295615723),new int64(-965641998,-479046869),new int64(-903397682,-366583396),new int64(-779700025,566280711),new int64(-354779690,-840897762),new int64(-176337025,-294727304),new int64(116418474,1914138554),new int64(174292421,-1563912026),new int64(289380356,-1090974290),new int64(460393269,320620315),new int64(685471733,587496836),new int64(852142971,1086792851),new int64(1017036298,365543100),new int64(1126000580,-1676669620),new int64(1288033470,-885112138),new int64(1501505948,-60457430),new int64(1607167915,987167468),new int64(1816402316,1246189591)]}for(i=0;80>i;i+=1){W[i]=new int64(0,0)}x[len>>5]|=128<<24-(31&len);x[(len+128>>10<<5)+31]=len;l=x.length;for(i=0;i<l;i+=32){int64copy(a,H[0]);int64copy(b,H[1]);int64copy(c,H[2]);int64copy(d,H[3]);int64copy(e,H[4]);int64copy(f,H[5]);int64copy(g,H[6]);int64copy(h,H[7]);for(j=0;16>j;j+=1){W[j].h=x[i+2*j];W[j].l=x[i+2*j+1]}for(j=16;80>j;j+=1){int64rrot(r1,W[j-2],19);int64revrrot(r2,W[j-2],29);int64shr(r3,W[j-2],6);s1.l=r1.l^r2.l^r3.l;s1.h=r1.h^r2.h^r3.h;int64rrot(r1,W[j-15],1);int64rrot(r2,W[j-15],8);int64shr(r3,W[j-15],7);s0.l=r1.l^r2.l^r3.l;s0.h=r1.h^r2.h^r3.h;int64add4(W[j],s1,W[j-7],s0,W[j-16])}for(j=0;80>j;j+=1){Ch.l=e.l&f.l^~e.l&g.l;Ch.h=e.h&f.h^~e.h&g.h;int64rrot(r1,e,14);int64rrot(r2,e,18);int64revrrot(r3,e,9);s1.l=r1.l^r2.l^r3.l;s1.h=r1.h^r2.h^r3.h;int64rrot(r1,a,28);int64revrrot(r2,a,2);int64revrrot(r3,a,7);s0.l=r1.l^r2.l^r3.l;s0.h=r1.h^r2.h^r3.h;Maj.l=a.l&b.l^a.l&c.l^b.l&c.l;Maj.h=a.h&b.h^a.h&c.h^b.h&c.h;int64add5(T1,h,s1,Ch,sha512_k[j],W[j]);int64add(T2,s0,Maj);int64copy(h,g);int64copy(g,f);int64copy(f,e);int64add(e,d,T1);int64copy(d,c);int64copy(c,b);int64copy(b,a);int64add(a,T1,T2)}int64add(H[0],H[0],a);int64add(H[1],H[1],b);int64add(H[2],H[2],c);int64add(H[3],H[3],d);int64add(H[4],H[4],e);int64add(H[5],H[5],f);int64add(H[6],H[6],g);int64add(H[7],H[7],h)}for(i=0;8>i;i+=1){hash[2*i]=H[i].h;hash[2*i+1]=H[i].l}return hash}function int64(h,l){this.h=h;this.l=l}function int64copy(dst,src){dst.h=src.h;dst.l=src.l}function int64rrot(dst,x,shift){dst.l=x.l>>>shift|x.h<<32-shift;dst.h=x.h>>>shift|x.l<<32-shift}function int64revrrot(dst,x,shift){dst.l=x.h>>>shift|x.l<<32-shift;dst.h=x.l>>>shift|x.h<<32-shift}function int64shr(dst,x,shift){dst.l=x.l>>>shift|x.h<<32-shift;dst.h=x.h>>>shift}function int64add(dst,x,y){var w0=(65535&x.l)+(65535&y.l);var w1=(x.l>>>16)+(y.l>>>16)+(w0>>>16);var w2=(65535&x.h)+(65535&y.h)+(w1>>>16);var w3=(x.h>>>16)+(y.h>>>16)+(w2>>>16);dst.l=65535&w0|w1<<16;dst.h=65535&w2|w3<<16}function int64add4(dst,a,b,c,d){var w0=(65535&a.l)+(65535&b.l)+(65535&c.l)+(65535&d.l);var w1=(a.l>>>16)+(b.l>>>16)+(c.l>>>16)+(d.l>>>16)+(w0>>>16);var w2=(65535&a.h)+(65535&b.h)+(65535&c.h)+(65535&d.h)+(w1>>>16);var w3=(a.h>>>16)+(b.h>>>16)+(c.h>>>16)+(d.h>>>16)+(w2>>>16);dst.l=65535&w0|w1<<16;dst.h=65535&w2|w3<<16}function int64add5(dst,a,b,c,d,e){var w0=(65535&a.l)+(65535&b.l)+(65535&c.l)+(65535&d.l)+(65535&e.l),w1=(a.l>>>16)+(b.l>>>16)+(c.l>>>16)+(d.l>>>16)+(e.l>>>16)+(w0>>>16),w2=(65535&a.h)+(65535&b.h)+(65535&c.h)+(65535&d.h)+(65535&e.h)+(w1>>>16),w3=(a.h>>>16)+(b.h>>>16)+(c.h>>>16)+(d.h>>>16)+(e.h>>>16)+(w2>>>16);dst.l=65535&w0|w1<<16;dst.h=65535&w2|w3<<16}},RMD160:function(options){var hexcase=options&&"boolean"===typeof options.uppercase?options.uppercase:false,b64pad=options&&"string"===typeof options.pad?options.pda:"=",utf8=options&&"boolean"===typeof options.utf8?options.utf8:true,rmd160_r1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],rmd160_r2=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],rmd160_s1=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],rmd160_s2=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];this.hex=function(s){return rstr2hex(rstr(s,utf8))};this.b64=function(s){return rstr2b64(rstr(s,utf8),b64pad)};this.any=function(s,e){return rstr2any(rstr(s,utf8),e)};this.hex_hmac=function(k,d){return rstr2hex(rstr_hmac(k,d))};this.b64_hmac=function(k,d){return rstr2b64(rstr_hmac(k,d),b64pad)};this.any_hmac=function(k,d,e){return rstr2any(rstr_hmac(k,d),e)};this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()};this.setUpperCase=function(a){if("boolean"===typeof a){hexcase=a}return this};this.setPad=function(a){if("undefined"!==typeof a){b64pad=a}return this};this.setUTF8=function(a){if("boolean"===typeof a){utf8=a}return this};function rstr(s){s=utf8?utf8Encode(s):s;return binl2rstr(binl(rstr2binl(s),8*s.length))}function rstr_hmac(key,data){key=utf8?utf8Encode(key):key;data=utf8?utf8Encode(data):data;var i,hash,bkey=rstr2binl(key),ipad=Array(16),opad=Array(16);if(16<bkey.length){bkey=binl(bkey,8*key.length)}for(i=0;16>i;i+=1){ipad[i]=909522486^bkey[i];opad[i]=1549556828^bkey[i]}hash=binl(ipad.concat(rstr2binl(data)),512+8*data.length);return binl2rstr(binl(opad.concat(hash),512+160))}function binl2rstr(input){var i,output="",l=32*input.length;for(i=0;i<l;i+=8){output+=String.fromCharCode(255&input[i>>5]>>>i%32)}return output}function binl(x,len){var T,j,i,l,h0=1732584193,h1=4023233417,h2=2562383102,h3=271733878,h4=3285377520,A1,B1,C1,D1,E1,A2,B2,C2,D2,E2;x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;l=x.length;for(i=0;i<l;i+=16){A1=A2=h0;B1=B2=h1;C1=C2=h2;D1=D2=h3;E1=E2=h4;for(j=0;79>=j;j+=1){T=safe_add(A1,rmd160_f(j,B1,C1,D1));T=safe_add(T,x[i+rmd160_r1[j]]);T=safe_add(T,rmd160_K1(j));T=safe_add(bit_rol(T,rmd160_s1[j]),E1);A1=E1;E1=D1;D1=bit_rol(C1,10);C1=B1;B1=T;T=safe_add(A2,rmd160_f(79-j,B2,C2,D2));T=safe_add(T,x[i+rmd160_r2[j]]);T=safe_add(T,rmd160_K2(j));T=safe_add(bit_rol(T,rmd160_s2[j]),E2);A2=E2;E2=D2;D2=bit_rol(C2,10);C2=B2;B2=T}T=safe_add(h1,safe_add(C1,D2));h1=safe_add(h2,safe_add(D1,E2));h2=safe_add(h3,safe_add(E1,A2));h3=safe_add(h4,safe_add(A1,B2));h4=safe_add(h0,safe_add(B1,C2));h0=T}return[h0,h1,h2,h3,h4]}function rmd160_f(j,x,y,z){return 0<=j&&15>=j?x^y^z:16<=j&&31>=j?x&y|~x&z:32<=j&&47>=j?(x|~y)^z:48<=j&&63>=j?x&z|y&~z:64<=j&&79>=j?x^(y|~z):"rmd160_f: j out of range"}function rmd160_K1(j){return 0<=j&&15>=j?0:16<=j&&31>=j?1518500249:32<=j&&47>=j?1859775393:48<=j&&63>=j?2400959708:64<=j&&79>=j?2840853838:"rmd160_K1: j out of range"}function rmd160_K2(j){return 0<=j&&15>=j?1352829926:16<=j&&31>=j?1548603684:32<=j&&47>=j?1836072691:48<=j&&63>=j?2053994217:64<=j&&79>=j?0:"rmd160_K2: j out of range"}}};(function(window,undefined){var freeExports=false;if("object"===typeof exports){freeExports=exports;if(exports&&"object"===typeof global&&global&&global===global.global){window=global}}if("function"===typeof define&&"object"===typeof define.amd&&define.amd){define(function(){return Hashes})}else if(freeExports){if("object"===typeof module&&module&&module.exports===freeExports){module.exports=Hashes}else{freeExports.Hashes=Hashes}}else{window.Hashes=Hashes}})(this)})()})(window)},{}],2:[function(require,module,exports){"use strict";var hashes=require("jshashes"),xtend=require("xtend"),sha1=new hashes.SHA1;var ohauth={};ohauth.qsString=function(obj){return Object.keys(obj).sort().map(function(key){return ohauth.percentEncode(key)+"="+ohauth.percentEncode(obj[key])}).join("&")};ohauth.stringQs=function(str){return str.split("&").reduce(function(obj,pair){var parts=pair.split("=");obj[decodeURIComponent(parts[0])]=null===parts[1]?"":decodeURIComponent(parts[1]);return obj},{})};ohauth.rawxhr=function(method,url,data,headers,callback){var xhr=new XMLHttpRequest,twoHundred=/^20\d$/,abortTimeout;xhr.onreadystatechange=function(){if(4==xhr.readyState){clearTimeout(abortTimeout)}if(4==xhr.readyState&&0!==xhr.status){if(twoHundred.test(xhr.status))callback(null,xhr);else return callback(xhr,null)}};xhr.onerror=function(e){return callback(e,null)};xhr.open(method,url,true);for(var h in headers){xhr.setRequestHeader(h,headers[h])}abortTimeout=setTimeout(function(){xhr.abort();xhr.errorType="timeout";callback(xhr,null)},d3.xhrSetting&&d3.xhrSetting.timeout||100000);xhr.send(data)};ohauth.xhr=function(method,url,auth,data,options,callback){var headers=options&&options.header||{"Content-Type":"application/x-www-form-urlencoded"};headers.Authorization="OAuth "+ohauth.authHeader(auth);ohauth.rawxhr(method,url,data,headers,callback)};ohauth.nonce=function(){for(var o="";6>o.length;){o+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"[Math.floor(61*Math.random())]}return o};ohauth.authHeader=function(obj){return Object.keys(obj).sort().map(function(key){return encodeURIComponent(key)+"=\""+encodeURIComponent(obj[key])+"\""}).join(", ")};ohauth.timestamp=function(){return~~(+new Date/1000)};ohauth.percentEncode=function(s){return encodeURIComponent(s).replace(/\!/g,"%21").replace(/\'/g,"%27").replace(/\*/g,"%2A").replace(/\(/g,"%28").replace(/\)/g,"%29")};ohauth.baseString=function(method,url,params){if(params.oauth_signature)delete params.oauth_signature;return[method,ohauth.percentEncode(url),ohauth.percentEncode(ohauth.qsString(params))].join("&")};ohauth.signature=function(oauth_secret,token_secret,baseString){return sha1.b64_hmac(ohauth.percentEncode(oauth_secret)+"&"+ohauth.percentEncode(token_secret),baseString)};ohauth.headerGenerator=function(options){options=options||{};var consumer_key=options.consumer_key||"",consumer_secret=options.consumer_secret||"",signature_method=options.signature_method||"HMAC-SHA1",version=options.version||"1.0",token=options.token||"";return function(method,uri,extra_params){method=method.toUpperCase();if("string"===typeof extra_params&&0<extra_params.length){extra_params=ohauth.stringQs(extra_params)}var uri_parts=uri.split("?",2),base_uri=uri_parts[0];var query_params=2===uri_parts.length?ohauth.stringQs(uri_parts[1]):{};var oauth_params={oauth_consumer_key:consumer_key,oauth_signature_method:signature_method,oauth_version:version,oauth_timestamp:ohauth.timestamp(),oauth_nonce:ohauth.nonce()};if(token)oauth_params.oauth_token=token;var all_params=xtend({},oauth_params,query_params,extra_params),base_str=ohauth.baseString(method,base_uri,all_params);oauth_params.oauth_signature=ohauth.signature(consumer_secret,token,base_str);return"OAuth "+ohauth.authHeader(oauth_params)}};module.exports=ohauth},{jshashes:7,xtend:4}],6:[function(require,module,exports){module.exports=Object.keys||require("./shim")},{"./shim":8}],8:[function(require,module,exports){;;(function(){"use strict";var has=Object.prototype.hasOwnProperty,is=require("is"),forEach=require("foreach"),hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],keysShim;keysShim=function keys(object){if(!is.object(object)&&!is.array(object)){throw new TypeError("Object.keys called on a non-object")}var name,theKeys=[];for(name in object){if(has.call(object,name)){theKeys.push(name)}}if(hasDontEnumBug){forEach(dontEnums,function(dontEnum){if(has.call(object,dontEnum)){theKeys.push(dontEnum)}})}return theKeys};module.exports=keysShim})()},{is:9,foreach:10}],9:[function(require,module,exports){var objProto=Object.prototype;var owns=objProto.hasOwnProperty;var toString=objProto.toString;var isActualNaN=function(value){return value!==value};var NON_HOST_TYPES={boolean:1,number:1,string:1,undefined:1};var is=module.exports={};is.a=is.type=function(value,type){return typeof value===type};is.defined=function(value){return value!==undefined};is.empty=function(value){var type=toString.call(value);var key;if("[object Array]"===type||"[object Arguments]"===type){return 0===value.length}if("[object Object]"===type){for(key in value)if(owns.call(value,key))return false;return true}if("[object String]"===type){return""===value}return false};is.equal=function(value,other){var type=toString.call(value);var key;if(type!==toString.call(other)){return false}if("[object Object]"===type){for(key in value){if(!is.equal(value[key],other[key])){return false}}return true}if("[object Array]"===type){key=value.length;if(key!==other.length){return false}while(--key){if(!is.equal(value[key],other[key])){return false}}return true}if("[object Function]"===type){return value.prototype===other.prototype}if("[object Date]"===type){return value.getTime()===other.getTime()}return value===other};is.hosted=function(value,host){var type=typeof host[value];return"object"===type?!!host[value]:!NON_HOST_TYPES[type]};is.instance=is["instanceof"]=function(value,constructor){return value instanceof constructor};is["null"]=function(value){return null===value};is.undefined=function(value){return value===undefined};is.arguments=function(value){var isStandardArguments="[object Arguments]"===toString.call(value);var isOldArguments=!is.array(value)&&is.arraylike(value)&&is.object(value)&&is.fn(value.callee);return isStandardArguments||isOldArguments};is.array=function(value){return"[object Array]"===toString.call(value)};is.arguments.empty=function(value){return is.arguments(value)&&0===value.length};is.array.empty=function(value){return is.array(value)&&0===value.length};is.arraylike=function(value){return!!value&&!is.boolean(value)&&owns.call(value,"length")&&isFinite(value.length)&&is.number(value.length)&&0<=value.length};is.boolean=function(value){return"[object Boolean]"===toString.call(value)};is["false"]=function(value){return is.boolean(value)&&(false===value||false===value.valueOf())};is["true"]=function(value){return is.boolean(value)&&(true===value||true===value.valueOf())};is.date=function(value){return"[object Date]"===toString.call(value)};is.element=function(value){return value!==undefined&&"undefined"!==typeof HTMLElement&&value instanceof HTMLElement&&1===value.nodeType};is.error=function(value){return"[object Error]"===toString.call(value)};is.fn=is["function"]=function(value){var isAlert="undefined"!==typeof window&&value===window.alert;return isAlert||"[object Function]"===toString.call(value)};is.number=function(value){return"[object Number]"===toString.call(value)};is.infinite=function(value){return value===Infinity||value===-Infinity};is.decimal=function(value){return is.number(value)&&!isActualNaN(value)&&0!==value%1};is.divisibleBy=function(value,n){var isDividendInfinite=is.infinite(value);var isDivisorInfinite=is.infinite(n);var isNonZeroNumber=is.number(value)&&!isActualNaN(value)&&is.number(n)&&!isActualNaN(n)&&0!==n;return isDividendInfinite||isDivisorInfinite||isNonZeroNumber&&0===value%n};is.int=function(value){return is.number(value)&&!isActualNaN(value)&&0===value%1};is.maximum=function(value,others){if(isActualNaN(value)){throw new TypeError("NaN is not a valid value")}else if(!is.arraylike(others)){throw new TypeError("second argument must be array-like")}var len=others.length;while(0<=--len){if(value<others[len]){return false}}return true};is.minimum=function(value,others){if(isActualNaN(value)){throw new TypeError("NaN is not a valid value")}else if(!is.arraylike(others)){throw new TypeError("second argument must be array-like")}var len=others.length;while(0<=--len){if(value>others[len]){return false}}return true};is.nan=function(value){return!is.number(value)||value!==value};is.even=function(value){return is.infinite(value)||is.number(value)&&value===value&&0===value%2};is.odd=function(value){return is.infinite(value)||is.number(value)&&value===value&&0!==value%2};is.ge=function(value,other){if(isActualNaN(value)||isActualNaN(other)){throw new TypeError("NaN is not a valid value")}return!is.infinite(value)&&!is.infinite(other)&&value>=other};is.gt=function(value,other){if(isActualNaN(value)||isActualNaN(other)){throw new TypeError("NaN is not a valid value")}return!is.infinite(value)&&!is.infinite(other)&&value>other};is.le=function(value,other){if(isActualNaN(value)||isActualNaN(other)){throw new TypeError("NaN is not a valid value")}return!is.infinite(value)&&!is.infinite(other)&&value<=other};is.lt=function(value,other){if(isActualNaN(value)||isActualNaN(other)){throw new TypeError("NaN is not a valid value")}return!is.infinite(value)&&!is.infinite(other)&&value<other};is.within=function(value,start,finish){if(isActualNaN(value)||isActualNaN(start)||isActualNaN(finish)){throw new TypeError("NaN is not a valid value")}else if(!is.number(value)||!is.number(start)||!is.number(finish)){throw new TypeError("all arguments must be numbers")}var isAnyInfinite=is.infinite(value)||is.infinite(start)||is.infinite(finish);return isAnyInfinite||value>=start&&value<=finish};is.object=function(value){return value&&"[object Object]"===toString.call(value)};is.hash=function(value){return is.object(value)&&value.constructor===Object&&!value.nodeType&&!value.setInterval};is.regexp=function(value){return"[object RegExp]"===toString.call(value)};is.string=function(value){return"[object String]"===toString.call(value)}},{}],10:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty;var toString=Object.prototype.toString;module.exports=function forEach(obj,fn,ctx){if("[object Function]"!==toString.call(fn)){throw new TypeError("iterator must be a function")}var l=obj.length;if(l===+l){for(var i=0;i<l;i++){fn.call(ctx,obj[i],i,obj)}}else{for(var k in obj){if(hasOwn.call(obj,k)){fn.call(ctx,obj[k],k,obj)}}}}},{}]},{},[1])(1)});;;;var JXON=new function(){var sValueProp="keyValue",sAttributesProp="keyAttributes",sAttrPref="@",aCache=[],rIsNull=/^\s*$/,rIsBool=/^(?:true|false)$/i;function parseText(sValue){if(rIsNull.test(sValue)){return null}if(rIsBool.test(sValue)){return"true"===sValue.toLowerCase()}if(isFinite(sValue)){return parseFloat(sValue)}if(isFinite(Date.parse(sValue))){return new Date(sValue)}return sValue}function EmptyTree(){}EmptyTree.prototype.toString=function(){return"null"};EmptyTree.prototype.valueOf=function(){return null};function objectify(vValue){return null===vValue?new EmptyTree:vValue instanceof Object?vValue:new vValue.constructor(vValue)}function createObjTree(oParentNode,nVerb,bFreeze,bNesteAttr){var nLevelStart=aCache.length,bChildren=oParentNode.hasChildNodes(),bAttributes=oParentNode.hasAttributes(),bHighVerb=Boolean(2&nVerb);var sProp,vContent,nLength=0,sCollectedTxt="",vResult=bHighVerb?{}:true;if(bChildren){for(var oNode,nItem=0;nItem<oParentNode.childNodes.length;nItem++){oNode=oParentNode.childNodes.item(nItem);if(4===oNode.nodeType){sCollectedTxt+=oNode.nodeValue}else if(3===oNode.nodeType){sCollectedTxt+=oNode.nodeValue.trim()}else if(1===oNode.nodeType&&!oNode.prefix){aCache.push(oNode)}}}var nLevelEnd=aCache.length,vBuiltVal=parseText(sCollectedTxt);if(!bHighVerb&&(bChildren||bAttributes)){vResult=0===nVerb?objectify(vBuiltVal):{}}for(var nElId=nLevelStart;nElId<nLevelEnd;nElId++){sProp=aCache[nElId].nodeName.toLowerCase();vContent=createObjTree(aCache[nElId],nVerb,bFreeze,bNesteAttr);if(vResult.hasOwnProperty(sProp)){if(vResult[sProp].constructor!==Array){vResult[sProp]=[vResult[sProp]]}vResult[sProp].push(vContent)}else{vResult[sProp]=vContent;nLength++}}if(bAttributes){var nAttrLen=oParentNode.attributes.length,sAPrefix=bNesteAttr?"":sAttrPref,oAttrParent=bNesteAttr?{}:vResult;for(var oAttrib,nAttrib=0;nAttrib<nAttrLen;nLength++,nAttrib++){oAttrib=oParentNode.attributes.item(nAttrib);oAttrParent[sAPrefix+oAttrib.name.toLowerCase()]=parseText(oAttrib.value.trim())}if(bNesteAttr){if(bFreeze){Object.freeze(oAttrParent)}vResult[sAttributesProp]=oAttrParent;nLength-=nAttrLen-1}}if(3===nVerb||(2===nVerb||1===nVerb&&0<nLength)&&sCollectedTxt){vResult[sValueProp]=vBuiltVal}else if(!bHighVerb&&0===nLength&&sCollectedTxt){vResult=vBuiltVal}if(bFreeze&&(bHighVerb||0<nLength)){Object.freeze(vResult)}aCache.length=nLevelStart;return vResult}function loadObjTree(oXMLDoc,oParentEl,oParentObj){var vValue,oChild;if(oParentObj instanceof String||oParentObj instanceof Number||oParentObj instanceof Boolean){oParentEl.appendChild(oXMLDoc.createTextNode(oParentObj.toString()))}else if(oParentObj.constructor===Date){oParentEl.appendChild(oXMLDoc.createTextNode(oParentObj.toGMTString()))}for(var sName in oParentObj){vValue=oParentObj[sName];if(isFinite(sName)||vValue instanceof Function){continue}if(sName===sValueProp){if(null!==vValue&&true!==vValue){oParentEl.appendChild(oXMLDoc.createTextNode(vValue.constructor===Date?vValue.toGMTString():String(vValue)))}}else if(sName===sAttributesProp){for(var sAttrib in vValue){oParentEl.setAttribute(sAttrib,vValue[sAttrib])}}else if(sName.charAt(0)===sAttrPref){oParentEl.setAttribute(sName.slice(1),vValue)}else if(vValue.constructor===Array){for(var nItem=0;nItem<vValue.length;nItem++){oChild=oXMLDoc.createElement(sName);loadObjTree(oXMLDoc,oChild,vValue[nItem]);oParentEl.appendChild(oChild)}}else{oChild=oXMLDoc.createElement(sName);if(vValue instanceof Object){loadObjTree(oXMLDoc,oChild,vValue)}else if(null!==vValue&&true!==vValue){oChild.appendChild(oXMLDoc.createTextNode(vValue.toString()))}oParentEl.appendChild(oChild)}}}this.build=function(oXMLParent,nVerbosity,bFreeze,bNesteAttributes){var _nVerb=1<arguments.length&&"number"===typeof nVerbosity?3&nVerbosity:1;return createObjTree(oXMLParent,_nVerb,bFreeze||false,3<arguments.length?bNesteAttributes:3===_nVerb)};this.unbuild=function(oObjTree){var oNewDoc=document.implementation.createDocument("","",null);loadObjTree(oNewDoc,oNewDoc,oObjTree);return oNewDoc};this.stringify=function(oObjTree){return new XMLSerializer().serializeToString(JXON.unbuild(oObjTree))}};;;_require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof _require&&_require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i="function"==typeof _require&&_require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_require,module,exports){;;(function(Buffer){module.exports=BinaryReader;function BinaryReader(buffer,isBigEndian){this.buffer=buffer;this.position=0;this.isBigEndian=isBigEndian||false}function _read(readLE,readBE,size){return function(){var value;if(this.isBigEndian)value=readBE.call(this.buffer,this.position);else value=readLE.call(this.buffer,this.position);this.position+=size;return value}}BinaryReader.prototype.readUInt8=_read(Buffer.prototype.readUInt8,Buffer.prototype.readUInt8,1);BinaryReader.prototype.readUInt16=_read(Buffer.prototype.readUInt16LE,Buffer.prototype.readUInt16BE,2);BinaryReader.prototype.readUInt32=_read(Buffer.prototype.readUInt32LE,Buffer.prototype.readUInt32BE,4);BinaryReader.prototype.readInt8=_read(Buffer.prototype.readInt8,Buffer.prototype.readInt8,1);BinaryReader.prototype.readInt16=_read(Buffer.prototype.readInt16LE,Buffer.prototype.readInt16BE,2);BinaryReader.prototype.readInt32=_read(Buffer.prototype.readInt32LE,Buffer.prototype.readInt32BE,4);BinaryReader.prototype.readFloat=_read(Buffer.prototype.readFloatLE,Buffer.prototype.readFloatBE,4);BinaryReader.prototype.readDouble=_read(Buffer.prototype.readDoubleLE,Buffer.prototype.readDoubleBE,8);BinaryReader.prototype.readVarInt=function(){var nextByte,result=0,bytesRead=0;do{nextByte=this.buffer[this.position+bytesRead];result+=(127&nextByte)<<7*bytesRead;bytesRead++}while(128<=nextByte);this.position+=bytesRead;return result}}).call(this,_require("buffer").Buffer)},{buffer:"buffer"}],2:[function(_require,module,exports){;;(function(Buffer){module.exports=BinaryWriter;function BinaryWriter(size,allowResize){this.buffer=new Buffer(size);this.position=0;this.allowResize=allowResize}function _write(write,size){return function(value,noAssert){this.ensureSize(size);write.call(this.buffer,value,this.position,noAssert);this.position+=size}}BinaryWriter.prototype.writeUInt8=_write(Buffer.prototype.writeUInt8,1);BinaryWriter.prototype.writeUInt16LE=_write(Buffer.prototype.writeUInt16LE,2);BinaryWriter.prototype.writeUInt16BE=_write(Buffer.prototype.writeUInt16BE,2);BinaryWriter.prototype.writeUInt32LE=_write(Buffer.prototype.writeUInt32LE,4);BinaryWriter.prototype.writeUInt32BE=_write(Buffer.prototype.writeUInt32BE,4);BinaryWriter.prototype.writeInt8=_write(Buffer.prototype.writeInt8,1);BinaryWriter.prototype.writeInt16LE=_write(Buffer.prototype.writeInt16LE,2);BinaryWriter.prototype.writeInt16BE=_write(Buffer.prototype.writeInt16BE,2);BinaryWriter.prototype.writeInt32LE=_write(Buffer.prototype.writeInt32LE,4);BinaryWriter.prototype.writeInt32BE=_write(Buffer.prototype.writeInt32BE,4);BinaryWriter.prototype.writeFloatLE=_write(Buffer.prototype.writeFloatLE,4);BinaryWriter.prototype.writeFloatBE=_write(Buffer.prototype.writeFloatBE,4);BinaryWriter.prototype.writeDoubleLE=_write(Buffer.prototype.writeDoubleLE,8);BinaryWriter.prototype.writeDoubleBE=_write(Buffer.prototype.writeDoubleBE,8);BinaryWriter.prototype.writeBuffer=function(buffer){this.ensureSize(buffer.length);buffer.copy(this.buffer,this.position,0,buffer.length);this.position+=buffer.length};BinaryWriter.prototype.writeVarInt=function(value){var length=1;while(0!==(4294967168&value)){this.writeUInt8(128|127&value);value>>>=7;length++}this.writeUInt8(127&value);return length};BinaryWriter.prototype.ensureSize=function(size){if(this.buffer.length<this.position+size){if(this.allowResize){var tempBuffer=new Buffer(this.position+size);this.buffer.copy(tempBuffer,0,0,this.buffer.length);this.buffer=tempBuffer}else{throw new RangeError("index out of range")}}}}).call(this,_require("buffer").Buffer)},{buffer:"buffer"}],3:[function(_require,module,exports){;;(function(Buffer){module.exports=Geometry;var Types=_require("./types");var Point=_require("./point");var LineString=_require("./linestring");var Polygon=_require("./polygon");var MultiPoint=_require("./multipoint");var MultiLineString=_require("./multilinestring");var MultiPolygon=_require("./multipolygon");var GeometryCollection=_require("./geometrycollection");var BinaryReader=_require("./binaryreader");var BinaryWriter=_require("./binarywriter");var WktParser=_require("./wktparser");var ZigZag=_require("./zigzag.js");function Geometry(){this.srid=undefined;this.hasZ=false;this.hasM=false}Geometry.parse=function(value,options){var valueType=typeof value;if("string"===valueType||value instanceof WktParser)return Geometry._parseWkt(value);else if(Buffer.isBuffer(value)||value instanceof BinaryReader)return Geometry._parseWkb(value,options);else throw new Error("first argument must be a string or Buffer")};Geometry._parseWkt=function(value){var wktParser,srid;if(value instanceof WktParser)wktParser=value;else wktParser=new WktParser(value);var match=wktParser.matchRegex([/^SRID=(\d+);/]);if(match)srid=parseInt(match[1],10);var geometryType=wktParser.matchType();var dimension=wktParser.matchDimension();var options={srid:srid,hasZ:dimension.hasZ,hasM:dimension.hasM};switch(geometryType){case Types.wkt.Point:return Point._parseWkt(wktParser,options);case Types.wkt.LineString:return LineString._parseWkt(wktParser,options);case Types.wkt.Polygon:return Polygon._parseWkt(wktParser,options);case Types.wkt.MultiPoint:return MultiPoint._parseWkt(wktParser,options);case Types.wkt.MultiLineString:return MultiLineString._parseWkt(wktParser,options);case Types.wkt.MultiPolygon:return MultiPolygon._parseWkt(wktParser,options);case Types.wkt.GeometryCollection:return GeometryCollection._parseWkt(wktParser,options);}};Geometry._parseWkb=function(value,parentOptions){var binaryReader,wkbType,geometryType,options={};if(value instanceof BinaryReader)binaryReader=value;else binaryReader=new BinaryReader(value);binaryReader.isBigEndian=!binaryReader.readInt8();wkbType=binaryReader.readUInt32();options.hasSrid=536870912===(536870912&wkbType);options.isEwkb=536870912&wkbType||1073741824&wkbType||2147483648&wkbType;if(options.hasSrid)options.srid=binaryReader.readUInt32();options.hasZ=false;options.hasM=false;if(!options.isEwkb&&(!parentOptions||!parentOptions.isEwkb)){if(1000<=wkbType&&2000>wkbType){options.hasZ=true;geometryType=wkbType-1000}else if(2000<=wkbType&&3000>wkbType){options.hasM=true;geometryType=wkbType-2000}else if(3000<=wkbType&&4000>wkbType){options.hasZ=true;options.hasM=true;geometryType=wkbType-3000}else{geometryType=wkbType}}else{if(2147483648&wkbType)options.hasZ=true;if(1073741824&wkbType)options.hasM=true;geometryType=15&wkbType}switch(geometryType){case Types.wkb.Point:return Point._parseWkb(binaryReader,options);case Types.wkb.LineString:return LineString._parseWkb(binaryReader,options);case Types.wkb.Polygon:return Polygon._parseWkb(binaryReader,options);case Types.wkb.MultiPoint:return MultiPoint._parseWkb(binaryReader,options);case Types.wkb.MultiLineString:return MultiLineString._parseWkb(binaryReader,options);case Types.wkb.MultiPolygon:return MultiPolygon._parseWkb(binaryReader,options);case Types.wkb.GeometryCollection:return GeometryCollection._parseWkb(binaryReader,options);default:throw new Error("GeometryType "+geometryType+" not supported");}};Geometry.parseTwkb=function(value){var binaryReader,options={};if(value instanceof BinaryReader)binaryReader=value;else binaryReader=new BinaryReader(value);var type=binaryReader.readUInt8();var metadataHeader=binaryReader.readUInt8();var geometryType=15&type;options.precision=ZigZag.decode(type>>4);options.precisionFactor=Math.pow(10,options.precision);options.hasBoundingBox=1&metadataHeader>>0;options.hasSizeAttribute=1&metadataHeader>>1;options.hasIdList=1&metadataHeader>>2;options.hasExtendedPrecision=1&metadataHeader>>3;options.isEmpty=1&metadataHeader>>4;if(options.hasExtendedPrecision){var extendedPrecision=binaryReader.readUInt8();options.hasZ=1===(1&extendedPrecision);options.hasM=2===(2&extendedPrecision);options.zPrecision=ZigZag.decode((28&extendedPrecision)>>2);options.zPrecisionFactor=Math.pow(10,options.zPrecision);options.mPrecision=ZigZag.decode((224&extendedPrecision)>>5);options.mPrecisionFactor=Math.pow(10,options.mPrecision)}else{options.hasZ=false;options.hasM=false}if(options.hasSizeAttribute)binaryReader.readVarInt();if(options.hasBoundingBox){var dimensions=2;if(options.hasZ)dimensions++;if(options.hasM)dimensions++;for(var i=0;i<dimensions;i++){binaryReader.readVarInt();binaryReader.readVarInt()}}switch(geometryType){case Types.wkb.Point:return Point._parseTwkb(binaryReader,options);case Types.wkb.LineString:return LineString._parseTwkb(binaryReader,options);case Types.wkb.Polygon:return Polygon._parseTwkb(binaryReader,options);case Types.wkb.MultiPoint:return MultiPoint._parseTwkb(binaryReader,options);case Types.wkb.MultiLineString:return MultiLineString._parseTwkb(binaryReader,options);case Types.wkb.MultiPolygon:return MultiPolygon._parseTwkb(binaryReader,options);case Types.wkb.GeometryCollection:return GeometryCollection._parseTwkb(binaryReader,options);default:throw new Error("GeometryType "+geometryType+" not supported");}};Geometry.parseGeoJSON=function(value){var geometry;switch(value.type){case Types.geoJSON.Point:geometry=Point._parseGeoJSON(value);break;case Types.geoJSON.LineString:geometry=LineString._parseGeoJSON(value);break;case Types.geoJSON.Polygon:geometry=Polygon._parseGeoJSON(value);break;case Types.geoJSON.MultiPoint:geometry=MultiPoint._parseGeoJSON(value);break;case Types.geoJSON.MultiLineString:geometry=MultiLineString._parseGeoJSON(value);break;case Types.geoJSON.MultiPolygon:geometry=MultiPolygon._parseGeoJSON(value);break;case Types.geoJSON.GeometryCollection:geometry=GeometryCollection._parseGeoJSON(value);break;default:throw new Error("GeometryType "+value.type+" not supported");}if(value.crs&&value.crs.type&&"name"===value.crs.type&&value.crs.properties&&value.crs.properties.name){var crs=value.crs.properties.name;if(0===crs.indexOf("EPSG:"))geometry.srid=parseInt(crs.substring(5));else if(0===crs.indexOf("urn:ogc:def:crs:EPSG::"))geometry.srid=parseInt(crs.substring(22));else throw new Error("Unsupported crs: "+crs)}return geometry};Geometry.prototype.toEwkt=function(){return"SRID="+this.srid+";"+this.toWkt()};Geometry.prototype.toEwkb=function(){var ewkb=new BinaryWriter(this._getWkbSize()+4);var wkb=this.toWkb();ewkb.writeInt8(1);ewkb.writeUInt32LE(536870912|wkb.slice(1,5).readUInt32LE(0),true);ewkb.writeUInt32LE(this.srid);ewkb.writeBuffer(wkb.slice(5));return ewkb.buffer};Geometry.prototype._getWktType=function(wktType,isEmpty){var wkt=wktType;if(this.hasZ&&this.hasM)wkt+=" ZM ";else if(this.hasZ)wkt+=" Z ";else if(this.hasM)wkt+=" M ";if(isEmpty&&!this.hasZ&&!this.hasM)wkt+=" ";if(isEmpty)wkt+="EMPTY";return wkt};Geometry.prototype._getWktCoordinate=function(point){var coordinates=point.x+" "+point.y;if(this.hasZ)coordinates+=" "+point.z;if(this.hasM)coordinates+=" "+point.m;return coordinates};Geometry.prototype._writeWkbType=function(wkb,geometryType,parentOptions){var dimensionType=0;if("undefined"===typeof this.srid&&(!parentOptions||"undefined"===typeof parentOptions.srid)){if(this.hasZ&&this.hasM)dimensionType+=3000;else if(this.hasZ)dimensionType+=1000;else if(this.hasM)dimensionType+=2000}else{if(this.hasZ)dimensionType|=2147483648;if(this.hasM)dimensionType|=1073741824}wkb.writeUInt32LE(dimensionType+geometryType,true)};Geometry.getTwkbPrecision=function(xyPrecision,zPrecision,mPrecision){return{xy:xyPrecision,z:zPrecision,m:mPrecision,xyFactor:Math.pow(10,xyPrecision),zFactor:Math.pow(10,zPrecision),mFactor:Math.pow(10,mPrecision)}};Geometry.prototype._writeTwkbHeader=function(twkb,geometryType,precision,isEmpty){var type=(ZigZag.encode(precision.xy)<<4)+geometryType;var metadataHeader=(this.hasZ||this.hasM)<<3;metadataHeader+=isEmpty<<4;twkb.writeUInt8(type);twkb.writeUInt8(metadataHeader);if(this.hasZ||this.hasM){var extendedPrecision=0;if(this.hasZ)extendedPrecision|=1;if(this.hasM)extendedPrecision|=2;twkb.writeUInt8(extendedPrecision)}};Geometry.prototype.toGeoJSON=function(options){var geoJSON={};if(this.srid){if(options){if(options.shortCrs){geoJSON.crs={type:"name",properties:{name:"EPSG:"+this.srid}}}else if(options.longCrs){geoJSON.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+this.srid}}}}}return geoJSON}}).call(this,{isBuffer:_require("../node_modules/is-buffer/index.js")})},{"../node_modules/is-buffer/index.js":16,"./binaryreader":1,"./binarywriter":2,"./geometrycollection":4,"./linestring":5,"./multilinestring":6,"./multipoint":7,"./multipolygon":8,"./point":9,"./polygon":10,"./types":11,"./wktparser":12,"./zigzag.js":13}],4:[function(_require,module,exports){module.exports=GeometryCollection;var util=_require("util");var Types=_require("./types");var Geometry=_require("./geometry");var BinaryWriter=_require("./binarywriter");function GeometryCollection(geometries){Geometry.call(this);this.geometries=geometries||[];if(0<this.geometries.length){this.hasZ=this.geometries[0].hasZ;this.hasM=this.geometries[0].hasM}}util.inherits(GeometryCollection,Geometry);GeometryCollection.Z=function(geometries){var geometryCollection=new GeometryCollection(geometries);geometryCollection.hasZ=true;return geometryCollection};GeometryCollection.M=function(geometries){var geometryCollection=new GeometryCollection(geometries);geometryCollection.hasM=true;return geometryCollection};GeometryCollection.ZM=function(geometries){var geometryCollection=new GeometryCollection(geometries);geometryCollection.hasZ=true;geometryCollection.hasM=true;return geometryCollection};GeometryCollection._parseWkt=function(value,options){var geometryCollection=new GeometryCollection;geometryCollection.srid=options.srid;geometryCollection.hasZ=options.hasZ;geometryCollection.hasM=options.hasM;if(value.isMatch(["EMPTY"]))return geometryCollection;value.expectGroupStart();do{geometryCollection.geometries.push(Geometry.parse(value))}while(value.isMatch([","]));value.expectGroupEnd();return geometryCollection};GeometryCollection._parseWkb=function(value,options){var geometryCollection=new GeometryCollection;geometryCollection.srid=options.srid;geometryCollection.hasZ=options.hasZ;geometryCollection.hasM=options.hasM;var geometryCount=value.readUInt32();for(var i=0;i<geometryCount;i++)geometryCollection.geometries.push(Geometry.parse(value,options));return geometryCollection};GeometryCollection._parseTwkb=function(value,options){var geometryCollection=new GeometryCollection;geometryCollection.hasZ=options.hasZ;geometryCollection.hasM=options.hasM;if(options.isEmpty)return geometryCollection;var geometryCount=value.readVarInt();for(var i=0;i<geometryCount;i++)geometryCollection.geometries.push(Geometry.parseTwkb(value));return geometryCollection};GeometryCollection._parseGeoJSON=function(value){var geometryCollection=new GeometryCollection;for(var i=0;i<value.geometries.length;i++)geometryCollection.geometries.push(Geometry.parseGeoJSON(value.geometries[i]));if(0<geometryCollection.geometries.length)geometryCollection.hasZ=geometryCollection.geometries[0].hasZ;return geometryCollection};GeometryCollection.prototype.toWkt=function(){if(0===this.geometries.length)return this._getWktType(Types.wkt.GeometryCollection,true);var wkt=this._getWktType(Types.wkt.GeometryCollection,false)+"(";for(var i=0;i<this.geometries.length;i++)wkt+=this.geometries[i].toWkt()+",";wkt=wkt.slice(0,-1);wkt+=")";return wkt};GeometryCollection.prototype.toWkb=function(){var wkb=new BinaryWriter(this._getWkbSize());wkb.writeInt8(1);this._writeWkbType(wkb,Types.wkb.GeometryCollection);wkb.writeUInt32LE(this.geometries.length);for(var i=0;i<this.geometries.length;i++)wkb.writeBuffer(this.geometries[i].toWkb({srid:this.srid}));return wkb.buffer};GeometryCollection.prototype.toTwkb=function(){var twkb=new BinaryWriter(0,true);var precision=Geometry.getTwkbPrecision(5,0,0);var isEmpty=0===this.geometries.length;this._writeTwkbHeader(twkb,Types.wkb.GeometryCollection,precision,isEmpty);if(0<this.geometries.length){twkb.writeVarInt(this.geometries.length);for(var i=0;i<this.geometries.length;i++)twkb.writeBuffer(this.geometries[i].toTwkb())}return twkb.buffer};GeometryCollection.prototype._getWkbSize=function(){var size=1+4+4;for(var i=0;i<this.geometries.length;i++)size+=this.geometries[i]._getWkbSize();return size};GeometryCollection.prototype.toGeoJSON=function(options){var geoJSON=Geometry.prototype.toGeoJSON.call(this,options);geoJSON.type=Types.geoJSON.GeometryCollection;geoJSON.geometries=[];for(var i=0;i<this.geometries.length;i++)geoJSON.geometries.push(this.geometries[i].toGeoJSON());return geoJSON}},{"./binarywriter":2,"./geometry":3,"./types":11,util:21}],5:[function(_require,module,exports){module.exports=LineString;var util=_require("util");var Geometry=_require("./geometry");var Types=_require("./types");var Point=_require("./point");var BinaryWriter=_require("./binarywriter");function LineString(points){Geometry.call(this);this.points=points||[];if(0<this.points.length){this.hasZ=this.points[0].hasZ;this.hasM=this.points[0].hasM}}util.inherits(LineString,Geometry);LineString.Z=function(points){var lineString=new LineString(points);lineString.hasZ=true;return lineString};LineString.M=function(points){var lineString=new LineString(points);lineString.hasM=true;return lineString};LineString.ZM=function(points){var lineString=new LineString(points);lineString.hasZ=true;lineString.hasM=true;return lineString};LineString._parseWkt=function(value,options){var lineString=new LineString;lineString.srid=options.srid;lineString.hasZ=options.hasZ;lineString.hasM=options.hasM;if(value.isMatch(["EMPTY"]))return lineString;value.expectGroupStart();lineString.points.push.apply(lineString.points,value.matchCoordinates(options));value.expectGroupEnd();return lineString};LineString._parseWkb=function(value,options){var lineString=new LineString;lineString.srid=options.srid;lineString.hasZ=options.hasZ;lineString.hasM=options.hasM;var pointCount=value.readUInt32();for(var i=0;i<pointCount;i++)lineString.points.push(Point._readWkbPoint(value,options));return lineString};LineString._parseTwkb=function(value,options){var lineString=new LineString;lineString.hasZ=options.hasZ;lineString.hasM=options.hasM;if(options.isEmpty)return lineString;var previousPoint=new Point(0,0,options.hasZ?0:undefined,options.hasM?0:undefined);var pointCount=value.readVarInt();for(var i=0;i<pointCount;i++)lineString.points.push(Point._readTwkbPoint(value,options,previousPoint));return lineString};LineString._parseGeoJSON=function(value){var lineString=new LineString;if(0<value.coordinates.length)lineString.hasZ=2<value.coordinates[0].length;for(var i=0;i<value.coordinates.length;i++)lineString.points.push(Point._readGeoJSONPoint(value.coordinates[i]));return lineString};LineString.prototype.toWkt=function(){if(0===this.points.length)return this._getWktType(Types.wkt.LineString,true);return this._getWktType(Types.wkt.LineString,false)+this._toInnerWkt()};LineString.prototype._toInnerWkt=function(){var innerWkt="(";for(var i=0;i<this.points.length;i++)innerWkt+=this._getWktCoordinate(this.points[i])+",";innerWkt=innerWkt.slice(0,-1);innerWkt+=")";return innerWkt};LineString.prototype.toWkb=function(parentOptions){var wkb=new BinaryWriter(this._getWkbSize());wkb.writeInt8(1);this._writeWkbType(wkb,Types.wkb.LineString,parentOptions);wkb.writeUInt32LE(this.points.length);for(var i=0;i<this.points.length;i++)this.points[i]._writeWkbPoint(wkb);return wkb.buffer};LineString.prototype.toTwkb=function(){var twkb=new BinaryWriter(0,true);var precision=Geometry.getTwkbPrecision(5,0,0);var isEmpty=0===this.points.length;this._writeTwkbHeader(twkb,Types.wkb.LineString,precision,isEmpty);if(0<this.points.length){twkb.writeVarInt(this.points.length);var previousPoint=new Point(0,0,0,0);for(var i=0;i<this.points.length;i++)this.points[i]._writeTwkbPoint(twkb,precision,previousPoint)}return twkb.buffer};LineString.prototype._getWkbSize=function(){var coordinateSize=16;if(this.hasZ)coordinateSize+=8;if(this.hasM)coordinateSize+=8;return 1+4+4+this.points.length*coordinateSize};LineString.prototype.toGeoJSON=function(options){var geoJSON=Geometry.prototype.toGeoJSON.call(this,options);geoJSON.type=Types.geoJSON.LineString;geoJSON.coordinates=[];for(var i=0;i<this.points.length;i++){if(this.hasZ)geoJSON.coordinates.push([this.points[i].x,this.points[i].y,this.points[i].z]);else geoJSON.coordinates.push([this.points[i].x,this.points[i].y])}return geoJSON}},{"./binarywriter":2,"./geometry":3,"./point":9,"./types":11,util:21}],6:[function(_require,module,exports){module.exports=MultiLineString;var util=_require("util");var Types=_require("./types");var Geometry=_require("./geometry");var Point=_require("./point");var LineString=_require("./linestring");var BinaryWriter=_require("./binarywriter");function MultiLineString(lineStrings){Geometry.call(this);this.lineStrings=lineStrings||[];if(0<this.lineStrings.length){this.hasZ=this.lineStrings[0].hasZ;this.hasM=this.lineStrings[0].hasM}}util.inherits(MultiLineString,Geometry);MultiLineString.Z=function(lineStrings){var multiLineString=new MultiLineString(lineStrings);multiLineString.hasZ=true;return multiLineString};MultiLineString.M=function(lineStrings){var multiLineString=new MultiLineString(lineStrings);multiLineString.hasM=true;return multiLineString};MultiLineString.ZM=function(lineStrings){var multiLineString=new MultiLineString(lineStrings);multiLineString.hasZ=true;multiLineString.hasM=true;return multiLineString};MultiLineString._parseWkt=function(value,options){var multiLineString=new MultiLineString;multiLineString.srid=options.srid;multiLineString.hasZ=options.hasZ;multiLineString.hasM=options.hasM;if(value.isMatch(["EMPTY"]))return multiLineString;value.expectGroupStart();do{value.expectGroupStart();multiLineString.lineStrings.push(new LineString(value.matchCoordinates(options)));value.expectGroupEnd()}while(value.isMatch([","]));value.expectGroupEnd();return multiLineString};MultiLineString._parseWkb=function(value,options){var multiLineString=new MultiLineString;multiLineString.srid=options.srid;multiLineString.hasZ=options.hasZ;multiLineString.hasM=options.hasM;var lineStringCount=value.readUInt32();for(var i=0;i<lineStringCount;i++)multiLineString.lineStrings.push(Geometry.parse(value,options));return multiLineString};MultiLineString._parseTwkb=function(value,options){var multiLineString=new MultiLineString;multiLineString.hasZ=options.hasZ;multiLineString.hasM=options.hasM;if(options.isEmpty)return multiLineString;var previousPoint=new Point(0,0,options.hasZ?0:undefined,options.hasM?0:undefined);var lineStringCount=value.readVarInt();for(var i=0;i<lineStringCount;i++){var lineString=new LineString;lineString.hasZ=options.hasZ;lineString.hasM=options.hasM;var pointCount=value.readVarInt();for(var j=0;j<pointCount;j++)lineString.points.push(Point._readTwkbPoint(value,options,previousPoint));multiLineString.lineStrings.push(lineString)}return multiLineString};MultiLineString._parseGeoJSON=function(value){var multiLineString=new MultiLineString;if(0<value.coordinates.length&&0<value.coordinates[0].length)multiLineString.hasZ=2<value.coordinates[0][0].length;for(var i=0;i<value.coordinates.length;i++)multiLineString.lineStrings.push(LineString._parseGeoJSON({coordinates:value.coordinates[i]}));return multiLineString};MultiLineString.prototype.toWkt=function(){if(0===this.lineStrings.length)return this._getWktType(Types.wkt.MultiLineString,true);var wkt=this._getWktType(Types.wkt.MultiLineString,false)+"(";for(var i=0;i<this.lineStrings.length;i++)wkt+=this.lineStrings[i]._toInnerWkt()+",";wkt=wkt.slice(0,-1);wkt+=")";return wkt};MultiLineString.prototype.toWkb=function(){var wkb=new BinaryWriter(this._getWkbSize());wkb.writeInt8(1);this._writeWkbType(wkb,Types.wkb.MultiLineString);wkb.writeUInt32LE(this.lineStrings.length);for(var i=0;i<this.lineStrings.length;i++)wkb.writeBuffer(this.lineStrings[i].toWkb({srid:this.srid}));return wkb.buffer};MultiLineString.prototype.toTwkb=function(){var twkb=new BinaryWriter(0,true);var precision=Geometry.getTwkbPrecision(5,0,0);var isEmpty=0===this.lineStrings.length;this._writeTwkbHeader(twkb,Types.wkb.MultiLineString,precision,isEmpty);if(0<this.lineStrings.length){twkb.writeVarInt(this.lineStrings.length);var previousPoint=new Point(0,0,0,0);for(var i=0;i<this.lineStrings.length;i++){twkb.writeVarInt(this.lineStrings[i].points.length);for(var j=0;j<this.lineStrings[i].points.length;j++)this.lineStrings[i].points[j]._writeTwkbPoint(twkb,precision,previousPoint)}}return twkb.buffer};MultiLineString.prototype._getWkbSize=function(){var size=1+4+4;for(var i=0;i<this.lineStrings.length;i++)size+=this.lineStrings[i]._getWkbSize();return size};MultiLineString.prototype.toGeoJSON=function(options){var geoJSON=Geometry.prototype.toGeoJSON.call(this,options);geoJSON.type=Types.geoJSON.MultiLineString;geoJSON.coordinates=[];for(var i=0;i<this.lineStrings.length;i++)geoJSON.coordinates.push(this.lineStrings[i].toGeoJSON().coordinates);return geoJSON}},{"./binarywriter":2,"./geometry":3,"./linestring":5,"./point":9,"./types":11,util:21}],7:[function(_require,module,exports){module.exports=MultiPoint;var util=_require("util");var Types=_require("./types");var Geometry=_require("./geometry");var Point=_require("./point");var BinaryWriter=_require("./binarywriter");function MultiPoint(points){Geometry.call(this);this.points=points||[];if(0<this.points.length){this.hasZ=this.points[0].hasZ;this.hasM=this.points[0].hasM}}util.inherits(MultiPoint,Geometry);MultiPoint.Z=function(points){var multiPoint=new MultiPoint(points);multiPoint.hasZ=true;return multiPoint};MultiPoint.M=function(points){var multiPoint=new MultiPoint(points);multiPoint.hasM=true;return multiPoint};MultiPoint.ZM=function(points){var multiPoint=new MultiPoint(points);multiPoint.hasZ=true;multiPoint.hasM=true;return multiPoint};MultiPoint._parseWkt=function(value,options){var multiPoint=new MultiPoint;multiPoint.srid=options.srid;multiPoint.hasZ=options.hasZ;multiPoint.hasM=options.hasM;if(value.isMatch(["EMPTY"]))return multiPoint;value.expectGroupStart();multiPoint.points.push.apply(multiPoint.points,value.matchCoordinates(options));value.expectGroupEnd();return multiPoint};MultiPoint._parseWkb=function(value,options){var multiPoint=new MultiPoint;multiPoint.srid=options.srid;multiPoint.hasZ=options.hasZ;multiPoint.hasM=options.hasM;var pointCount=value.readUInt32();for(var i=0;i<pointCount;i++)multiPoint.points.push(Geometry.parse(value,options));return multiPoint};MultiPoint._parseTwkb=function(value,options){var multiPoint=new MultiPoint;multiPoint.hasZ=options.hasZ;multiPoint.hasM=options.hasM;if(options.isEmpty)return multiPoint;var previousPoint=new Point(0,0,options.hasZ?0:undefined,options.hasM?0:undefined);var pointCount=value.readVarInt();for(var i=0;i<pointCount;i++)multiPoint.points.push(Point._readTwkbPoint(value,options,previousPoint));return multiPoint};MultiPoint._parseGeoJSON=function(value){var multiPoint=new MultiPoint;if(0<value.coordinates.length)multiPoint.hasZ=2<value.coordinates[0].length;for(var i=0;i<value.coordinates.length;i++)multiPoint.points.push(Point._parseGeoJSON({coordinates:value.coordinates[i]}));return multiPoint};MultiPoint.prototype.toWkt=function(){if(0===this.points.length)return this._getWktType(Types.wkt.MultiPoint,true);var wkt=this._getWktType(Types.wkt.MultiPoint,false)+"(";for(var i=0;i<this.points.length;i++)wkt+=this._getWktCoordinate(this.points[i])+",";wkt=wkt.slice(0,-1);wkt+=")";return wkt};MultiPoint.prototype.toWkb=function(){var wkb=new BinaryWriter(this._getWkbSize());wkb.writeInt8(1);this._writeWkbType(wkb,Types.wkb.MultiPoint);wkb.writeUInt32LE(this.points.length);for(var i=0;i<this.points.length;i++)wkb.writeBuffer(this.points[i].toWkb({srid:this.srid}));return wkb.buffer};MultiPoint.prototype.toTwkb=function(){var twkb=new BinaryWriter(0,true);var precision=Geometry.getTwkbPrecision(5,0,0);var isEmpty=0===this.points.length;this._writeTwkbHeader(twkb,Types.wkb.MultiPoint,precision,isEmpty);if(0<this.points.length){twkb.writeVarInt(this.points.length);var previousPoint=new Point(0,0,0,0);for(var i=0;i<this.points.length;i++)this.points[i]._writeTwkbPoint(twkb,precision,previousPoint)}return twkb.buffer};MultiPoint.prototype._getWkbSize=function(){var coordinateSize=16;if(this.hasZ)coordinateSize+=8;if(this.hasM)coordinateSize+=8;coordinateSize+=5;return 1+4+4+this.points.length*coordinateSize};MultiPoint.prototype.toGeoJSON=function(options){var geoJSON=Geometry.prototype.toGeoJSON.call(this,options);geoJSON.type=Types.geoJSON.MultiPoint;geoJSON.coordinates=[];for(var i=0;i<this.points.length;i++)geoJSON.coordinates.push(this.points[i].toGeoJSON().coordinates);return geoJSON}},{"./binarywriter":2,"./geometry":3,"./point":9,"./types":11,util:21}],8:[function(_require,module,exports){module.exports=MultiPolygon;var util=_require("util");var Types=_require("./types");var Geometry=_require("./geometry");var Point=_require("./point");var Polygon=_require("./polygon");var BinaryWriter=_require("./binarywriter");function MultiPolygon(polygons){Geometry.call(this);this.polygons=polygons||[];if(0<this.polygons.length){this.hasZ=this.polygons[0].hasZ;this.hasM=this.polygons[0].hasM}}util.inherits(MultiPolygon,Geometry);MultiPolygon.Z=function(polygons){var multiPolygon=new MultiPolygon(polygons);multiPolygon.hasZ=true;return multiPolygon};MultiPolygon.M=function(polygons){var multiPolygon=new MultiPolygon(polygons);multiPolygon.hasM=true;return multiPolygon};MultiPolygon.ZM=function(polygons){var multiPolygon=new MultiPolygon(polygons);multiPolygon.hasZ=true;multiPolygon.hasM=true;return multiPolygon};MultiPolygon._parseWkt=function(value,options){var multiPolygon=new MultiPolygon;multiPolygon.srid=options.srid;multiPolygon.hasZ=options.hasZ;multiPolygon.hasM=options.hasM;if(value.isMatch(["EMPTY"]))return multiPolygon;value.expectGroupStart();do{value.expectGroupStart();var exteriorRing=[];var interiorRings=[];value.expectGroupStart();exteriorRing.push.apply(exteriorRing,value.matchCoordinates(options));value.expectGroupEnd();while(value.isMatch([","])){value.expectGroupStart();interiorRings.push(value.matchCoordinates(options));value.expectGroupEnd()}multiPolygon.polygons.push(new Polygon(exteriorRing,interiorRings));value.expectGroupEnd()}while(value.isMatch([","]));value.expectGroupEnd();return multiPolygon};MultiPolygon._parseWkb=function(value,options){var multiPolygon=new MultiPolygon;multiPolygon.srid=options.srid;multiPolygon.hasZ=options.hasZ;multiPolygon.hasM=options.hasM;var polygonCount=value.readUInt32();for(var i=0;i<polygonCount;i++)multiPolygon.polygons.push(Geometry.parse(value,options));return multiPolygon};MultiPolygon._parseTwkb=function(value,options){var multiPolygon=new MultiPolygon;multiPolygon.hasZ=options.hasZ;multiPolygon.hasM=options.hasM;if(options.isEmpty)return multiPolygon;var previousPoint=new Point(0,0,options.hasZ?0:undefined,options.hasM?0:undefined);var polygonCount=value.readVarInt();for(var i=0;i<polygonCount;i++){var polygon=new Polygon;polygon.hasZ=options.hasZ;polygon.hasM=options.hasM;var ringCount=value.readVarInt();var exteriorRingCount=value.readVarInt();for(var j=0;j<exteriorRingCount;j++)polygon.exteriorRing.push(Point._readTwkbPoint(value,options,previousPoint));for(j=1;j<ringCount;j++){var interiorRing=[];var interiorRingCount=value.readVarInt();for(var k=0;k<interiorRingCount;k++)interiorRing.push(Point._readTwkbPoint(value,options,previousPoint));polygon.interiorRings.push(interiorRing)}multiPolygon.polygons.push(polygon)}return multiPolygon};MultiPolygon._parseGeoJSON=function(value){var multiPolygon=new MultiPolygon;if(0<value.coordinates.length&&0<value.coordinates[0].length&&0<value.coordinates[0][0].length)multiPolygon.hasZ=2<value.coordinates[0][0][0].length;for(var i=0;i<value.coordinates.length;i++)multiPolygon.polygons.push(Polygon._parseGeoJSON({coordinates:value.coordinates[i]}));return multiPolygon};MultiPolygon.prototype.toWkt=function(){if(0===this.polygons.length)return this._getWktType(Types.wkt.MultiPolygon,true);var wkt=this._getWktType(Types.wkt.MultiPolygon,false)+"(";for(var i=0;i<this.polygons.length;i++)wkt+=this.polygons[i]._toInnerWkt()+",";wkt=wkt.slice(0,-1);wkt+=")";return wkt};MultiPolygon.prototype.toWkb=function(){var wkb=new BinaryWriter(this._getWkbSize());wkb.writeInt8(1);this._writeWkbType(wkb,Types.wkb.MultiPolygon);wkb.writeUInt32LE(this.polygons.length);for(var i=0;i<this.polygons.length;i++)wkb.writeBuffer(this.polygons[i].toWkb({srid:this.srid}));return wkb.buffer};MultiPolygon.prototype.toTwkb=function(){var twkb=new BinaryWriter(0,true);var precision=Geometry.getTwkbPrecision(5,0,0);var isEmpty=0===this.polygons.length;this._writeTwkbHeader(twkb,Types.wkb.MultiPolygon,precision,isEmpty);if(0<this.polygons.length){twkb.writeVarInt(this.polygons.length);var previousPoint=new Point(0,0,0,0);for(var i=0;i<this.polygons.length;i++){twkb.writeVarInt(1+this.polygons[i].interiorRings.length);twkb.writeVarInt(this.polygons[i].exteriorRing.length);for(var j=0;j<this.polygons[i].exteriorRing.length;j++)this.polygons[i].exteriorRing[j]._writeTwkbPoint(twkb,precision,previousPoint);for(j=0;j<this.polygons[i].interiorRings.length;j++){twkb.writeVarInt(this.polygons[i].interiorRings[j].length);for(var k=0;k<this.polygons[i].interiorRings[j].length;k++)this.polygons[i].interiorRings[j][k]._writeTwkbPoint(twkb,precision,previousPoint)}}}return twkb.buffer};MultiPolygon.prototype._getWkbSize=function(){var size=1+4+4;for(var i=0;i<this.polygons.length;i++)size+=this.polygons[i]._getWkbSize();return size};MultiPolygon.prototype.toGeoJSON=function(options){var geoJSON=Geometry.prototype.toGeoJSON.call(this,options);geoJSON.type=Types.geoJSON.MultiPolygon;geoJSON.coordinates=[];for(var i=0;i<this.polygons.length;i++)geoJSON.coordinates.push(this.polygons[i].toGeoJSON().coordinates);return geoJSON}},{"./binarywriter":2,"./geometry":3,"./point":9,"./polygon":10,"./types":11,util:21}],9:[function(_require,module,exports){module.exports=Point;var util=_require("util");var Geometry=_require("./geometry");var Types=_require("./types");var BinaryWriter=_require("./binarywriter");var ZigZag=_require("./zigzag.js");function Point(x,y,z,m){Geometry.call(this);this.x=x;this.y=y;this.z=z;this.m=m;this.hasZ="undefined"!==typeof this.z;this.hasM="undefined"!==typeof this.m}util.inherits(Point,Geometry);Point.Z=function(x,y,z){var point=new Point(x,y,z);point.hasZ=true;return point};Point.M=function(x,y,m){var point=new Point(x,y,undefined,m);point.hasM=true;return point};Point.ZM=function(x,y,z,m){var point=new Point(x,y,z,m);point.hasZ=true;point.hasM=true;return point};Point._parseWkt=function(value,options){var point=new Point;point.srid=options.srid;point.hasZ=options.hasZ;point.hasM=options.hasM;if(value.isMatch(["EMPTY"]))return point;value.expectGroupStart();var coordinate=value.matchCoordinate(options);point.x=coordinate.x;point.y=coordinate.y;point.z=coordinate.z;point.m=coordinate.m;value.expectGroupEnd();return point};Point._parseWkb=function(value,options){var point=Point._readWkbPoint(value,options);point.srid=options.srid;return point};Point._readWkbPoint=function(value,options){return new Point(value.readDouble(),value.readDouble(),options.hasZ?value.readDouble():undefined,options.hasM?value.readDouble():undefined)};Point._parseTwkb=function(value,options){var point=new Point;point.hasZ=options.hasZ;point.hasM=options.hasM;if(options.isEmpty)return point;point.x=ZigZag.decode(value.readVarInt())/options.precisionFactor;point.y=ZigZag.decode(value.readVarInt())/options.precisionFactor;point.z=options.hasZ?ZigZag.decode(value.readVarInt())/options.zPrecisionFactor:undefined;point.m=options.hasM?ZigZag.decode(value.readVarInt())/options.mPrecisionFactor:undefined;return point};Point._readTwkbPoint=function(value,options,previousPoint){previousPoint.x+=ZigZag.decode(value.readVarInt())/options.precisionFactor;previousPoint.y+=ZigZag.decode(value.readVarInt())/options.precisionFactor;if(options.hasZ)previousPoint.z+=ZigZag.decode(value.readVarInt())/options.zPrecisionFactor;if(options.hasM)previousPoint.m+=ZigZag.decode(value.readVarInt())/options.mPrecisionFactor;return new Point(previousPoint.x,previousPoint.y,previousPoint.z,previousPoint.m)};Point._parseGeoJSON=function(value){return Point._readGeoJSONPoint(value.coordinates)};Point._readGeoJSONPoint=function(coordinates){if(0===coordinates.length)return new Point;if(2<coordinates.length)return new Point(coordinates[0],coordinates[1],coordinates[2]);return new Point(coordinates[0],coordinates[1])};Point.prototype.toWkt=function(){if("undefined"===typeof this.x&&"undefined"===typeof this.y&&"undefined"===typeof this.z&&"undefined"===typeof this.m)return this._getWktType(Types.wkt.Point,true);return this._getWktType(Types.wkt.Point,false)+"("+this._getWktCoordinate(this)+")"};Point.prototype.toWkb=function(parentOptions){var wkb=new BinaryWriter(this._getWkbSize());wkb.writeInt8(1);this._writeWkbType(wkb,Types.wkb.Point,parentOptions);if("undefined"===typeof this.x&&"undefined"===typeof this.y){wkb.writeDoubleLE(NaN);wkb.writeDoubleLE(NaN);if(this.hasZ)wkb.writeDoubleLE(NaN);if(this.hasM)wkb.writeDoubleLE(NaN)}else{this._writeWkbPoint(wkb)}return wkb.buffer};Point.prototype._writeWkbPoint=function(wkb){wkb.writeDoubleLE(this.x);wkb.writeDoubleLE(this.y);if(this.hasZ)wkb.writeDoubleLE(this.z);if(this.hasM)wkb.writeDoubleLE(this.m)};Point.prototype.toTwkb=function(){var twkb=new BinaryWriter(0,true);var precision=Geometry.getTwkbPrecision(5,0,0);var isEmpty="undefined"===typeof this.x&&"undefined"===typeof this.y;this._writeTwkbHeader(twkb,Types.wkb.Point,precision,isEmpty);if(!isEmpty)this._writeTwkbPoint(twkb,precision,new Point(0,0,0,0));return twkb.buffer};Point.prototype._writeTwkbPoint=function(twkb,precision,previousPoint){var x=this.x*precision.xyFactor;var y=this.y*precision.xyFactor;var z=this.z*precision.zFactor;var m=this.m*precision.mFactor;twkb.writeVarInt(ZigZag.encode(x-previousPoint.x));twkb.writeVarInt(ZigZag.encode(y-previousPoint.y));if(this.hasZ)twkb.writeVarInt(ZigZag.encode(z-previousPoint.z));if(this.hasM)twkb.writeVarInt(ZigZag.encode(m-previousPoint.m));previousPoint.x=x;previousPoint.y=y;previousPoint.z=z;previousPoint.m=m};Point.prototype._getWkbSize=function(){var size=1+4+8+8;if(this.hasZ)size+=8;if(this.hasM)size+=8;return size};Point.prototype.toGeoJSON=function(options){var geoJSON=Geometry.prototype.toGeoJSON.call(this,options);geoJSON.type=Types.geoJSON.Point;if("undefined"===typeof this.x&&"undefined"===typeof this.y)geoJSON.coordinates=[];else if("undefined"!==typeof this.z)geoJSON.coordinates=[this.x,this.y,this.z];else geoJSON.coordinates=[this.x,this.y];return geoJSON}},{"./binarywriter":2,"./geometry":3,"./types":11,"./zigzag.js":13,util:21}],10:[function(_require,module,exports){module.exports=Polygon;var util=_require("util");var Geometry=_require("./geometry");var Types=_require("./types");var Point=_require("./point");var BinaryWriter=_require("./binarywriter");function Polygon(exteriorRing,interiorRings){Geometry.call(this);this.exteriorRing=exteriorRing||[];this.interiorRings=interiorRings||[];if(0<this.exteriorRing.length){this.hasZ=this.exteriorRing[0].hasZ;this.hasM=this.exteriorRing[0].hasM}}util.inherits(Polygon,Geometry);Polygon.Z=function(exteriorRing,interiorRings){var polygon=new Polygon(exteriorRing,interiorRings);polygon.hasZ=true;return polygon};Polygon.M=function(exteriorRing,interiorRings){var polygon=new Polygon(exteriorRing,interiorRings);polygon.hasM=true;return polygon};Polygon.ZM=function(exteriorRing,interiorRings){var polygon=new Polygon(exteriorRing,interiorRings);polygon.hasZ=true;polygon.hasM=true;return polygon};Polygon._parseWkt=function(value,options){var polygon=new Polygon;polygon.srid=options.srid;polygon.hasZ=options.hasZ;polygon.hasM=options.hasM;if(value.isMatch(["EMPTY"]))return polygon;value.expectGroupStart();value.expectGroupStart();polygon.exteriorRing.push.apply(polygon.exteriorRing,value.matchCoordinates(options));value.expectGroupEnd();while(value.isMatch([","])){value.expectGroupStart();polygon.interiorRings.push(value.matchCoordinates(options));value.expectGroupEnd()}value.expectGroupEnd();return polygon};Polygon._parseWkb=function(value,options){var polygon=new Polygon;polygon.srid=options.srid;polygon.hasZ=options.hasZ;polygon.hasM=options.hasM;var ringCount=value.readUInt32();if(0<ringCount){var exteriorRingCount=value.readUInt32();for(var i=0;i<exteriorRingCount;i++)polygon.exteriorRing.push(Point._readWkbPoint(value,options));for(i=1;i<ringCount;i++){var interiorRing=[];var interiorRingCount=value.readUInt32();for(var j=0;j<interiorRingCount;j++)interiorRing.push(Point._readWkbPoint(value,options));polygon.interiorRings.push(interiorRing)}}return polygon};Polygon._parseTwkb=function(value,options){var polygon=new Polygon;polygon.hasZ=options.hasZ;polygon.hasM=options.hasM;if(options.isEmpty)return polygon;var previousPoint=new Point(0,0,options.hasZ?0:undefined,options.hasM?0:undefined);var ringCount=value.readVarInt();var exteriorRingCount=value.readVarInt();for(var i=0;i<exteriorRingCount;i++)polygon.exteriorRing.push(Point._readTwkbPoint(value,options,previousPoint));for(i=1;i<ringCount;i++){var interiorRing=[];var interiorRingCount=value.readVarInt();for(var j=0;j<interiorRingCount;j++)interiorRing.push(Point._readTwkbPoint(value,options,previousPoint));polygon.interiorRings.push(interiorRing)}return polygon};Polygon._parseGeoJSON=function(value){var polygon=new Polygon;if(0<value.coordinates.length&&0<value.coordinates[0].length)polygon.hasZ=2<value.coordinates[0][0].length;for(var i=0;i<value.coordinates.length;i++){if(0<i)polygon.interiorRings.push([]);for(var j=0;j<value.coordinates[i].length;j++){if(0===i)polygon.exteriorRing.push(Point._readGeoJSONPoint(value.coordinates[i][j]));else polygon.interiorRings[i-1].push(Point._readGeoJSONPoint(value.coordinates[i][j]))}}return polygon};Polygon.prototype.toWkt=function(){if(0===this.exteriorRing.length)return this._getWktType(Types.wkt.Polygon,true);return this._getWktType(Types.wkt.Polygon,false)+this._toInnerWkt()};Polygon.prototype._toInnerWkt=function(){var innerWkt="((";for(var i=0;i<this.exteriorRing.length;i++)innerWkt+=this._getWktCoordinate(this.exteriorRing[i])+",";innerWkt=innerWkt.slice(0,-1);innerWkt+=")";for(i=0;i<this.interiorRings.length;i++){innerWkt+=",(";for(var j=0;j<this.interiorRings[i].length;j++){innerWkt+=this._getWktCoordinate(this.interiorRings[i][j])+","}innerWkt=innerWkt.slice(0,-1);innerWkt+=")"}innerWkt+=")";return innerWkt};Polygon.prototype.toWkb=function(parentOptions){var wkb=new BinaryWriter(this._getWkbSize());wkb.writeInt8(1);this._writeWkbType(wkb,Types.wkb.Polygon,parentOptions);if(0<this.exteriorRing.length){wkb.writeUInt32LE(1+this.interiorRings.length);wkb.writeUInt32LE(this.exteriorRing.length)}else{wkb.writeUInt32LE(0)}for(var i=0;i<this.exteriorRing.length;i++)this.exteriorRing[i]._writeWkbPoint(wkb);for(i=0;i<this.interiorRings.length;i++){wkb.writeUInt32LE(this.interiorRings[i].length);for(var j=0;j<this.interiorRings[i].length;j++)this.interiorRings[i][j]._writeWkbPoint(wkb)}return wkb.buffer};Polygon.prototype.toTwkb=function(){var twkb=new BinaryWriter(0,true);var precision=Geometry.getTwkbPrecision(5,0,0);var isEmpty=0===this.exteriorRing.length;this._writeTwkbHeader(twkb,Types.wkb.Polygon,precision,isEmpty);if(0<this.exteriorRing.length){twkb.writeVarInt(1+this.interiorRings.length);twkb.writeVarInt(this.exteriorRing.length);var previousPoint=new Point(0,0,0,0);for(var i=0;i<this.exteriorRing.length;i++)this.exteriorRing[i]._writeTwkbPoint(twkb,precision,previousPoint);for(i=0;i<this.interiorRings.length;i++){twkb.writeVarInt(this.interiorRings[i].length);for(var j=0;j<this.interiorRings[i].length;j++)this.interiorRings[i][j]._writeTwkbPoint(twkb,precision,previousPoint)}}return twkb.buffer};Polygon.prototype._getWkbSize=function(){var coordinateSize=16;if(this.hasZ)coordinateSize+=8;if(this.hasM)coordinateSize+=8;var size=1+4+4;if(0<this.exteriorRing.length)size+=4+this.exteriorRing.length*coordinateSize;for(var i=0;i<this.interiorRings.length;i++)size+=4+this.interiorRings[i].length*coordinateSize;return size};Polygon.prototype.toGeoJSON=function(options){var geoJSON=Geometry.prototype.toGeoJSON.call(this,options);geoJSON.type=Types.geoJSON.Polygon;geoJSON.coordinates=[];if(0<this.exteriorRing.length){var exteriorRing=[];for(var i=0;i<this.exteriorRing.length;i++){if(this.hasZ)exteriorRing.push([this.exteriorRing[i].x,this.exteriorRing[i].y,this.exteriorRing[i].z]);else exteriorRing.push([this.exteriorRing[i].x,this.exteriorRing[i].y])}geoJSON.coordinates.push(exteriorRing)}for(var j=0;j<this.interiorRings.length;j++){var interiorRing=[];for(var k=0;k<this.interiorRings[j].length;k++){if(this.hasZ)interiorRing.push([this.interiorRings[j][k].x,this.interiorRings[j][k].y,this.interiorRings[j][k].z]);else interiorRing.push([this.interiorRings[j][k].x,this.interiorRings[j][k].y])}geoJSON.coordinates.push(interiorRing)}return geoJSON}},{"./binarywriter":2,"./geometry":3,"./point":9,"./types":11,util:21}],11:[function(_require,module,exports){module.exports={wkt:{Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION"},wkb:{Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6,GeometryCollection:7},geoJSON:{Point:"Point",LineString:"LineString",Polygon:"Polygon",MultiPoint:"MultiPoint",MultiLineString:"MultiLineString",MultiPolygon:"MultiPolygon",GeometryCollection:"GeometryCollection"}}},{}],12:[function(_require,module,exports){module.exports=WktParser;var Types=_require("./types");var Point=_require("./point");function WktParser(value){this.value=value;this.position=0}WktParser.prototype.match=function(tokens){this.skipWhitespaces();for(var i=0;i<tokens.length;i++){if(0===this.value.substring(this.position).indexOf(tokens[i])){this.position+=tokens[i].length;return tokens[i]}}return null};WktParser.prototype.matchRegex=function(tokens){this.skipWhitespaces();for(var i=0;i<tokens.length;i++){var match=this.value.substring(this.position).match(tokens[i]);if(match){this.position+=match[0].length;return match}}return null};WktParser.prototype.isMatch=function(tokens){this.skipWhitespaces();for(var i=0;i<tokens.length;i++){if(0===this.value.substring(this.position).indexOf(tokens[i])){this.position+=tokens[i].length;return true}}return false};WktParser.prototype.matchType=function(){var geometryType=this.match([Types.wkt.Point,Types.wkt.LineString,Types.wkt.Polygon,Types.wkt.MultiPoint,Types.wkt.MultiLineString,Types.wkt.MultiPolygon,Types.wkt.GeometryCollection]);if(!geometryType)throw new Error("Expected geometry type");return geometryType};WktParser.prototype.matchDimension=function(){var dimension=this.match(["ZM","Z","M"]);switch(dimension){case"ZM":return{hasZ:true,hasM:true};case"Z":return{hasZ:true,hasM:false};case"M":return{hasZ:false,hasM:true};default:return{hasZ:false,hasM:false};}};WktParser.prototype.expectGroupStart=function(){if(!this.isMatch(["("]))throw new Error("Expected group start")};WktParser.prototype.expectGroupEnd=function(){if(!this.isMatch([")"]))throw new Error("Expected group end")};WktParser.prototype.matchCoordinate=function(options){var match;if(options.hasZ&&options.hasM)match=this.matchRegex([/^(-?\d+\.?\d*)\s+(-?\d+\.?\d*)\s+(-?\d+\.?\d*)\s+(-?\d+\.?\d*)/]);else if(options.hasZ||options.hasM)match=this.matchRegex([/^(-?\d+\.?\d*)\s+(-?\d+\.?\d*)\s+(-?\d+\.?\d*)/]);else match=this.matchRegex([/^(-?\d+\.?\d*)\s+(-?\d+\.?\d*)/]);if(!match)throw new Error("Expected coordinates");if(options.hasZ&&options.hasM)return new Point(parseFloat(match[1]),parseFloat(match[2]),parseFloat(match[3]),parseFloat(match[4]));else if(options.hasZ)return new Point(parseFloat(match[1]),parseFloat(match[2]),parseFloat(match[3]));else if(options.hasM)return new Point(parseFloat(match[1]),parseFloat(match[2]),undefined,parseFloat(match[3]));else return new Point(parseFloat(match[1]),parseFloat(match[2]))};WktParser.prototype.matchCoordinates=function(options){var coordinates=[];do{var startsWithBracket=this.isMatch(["("]);coordinates.push(this.matchCoordinate(options));if(startsWithBracket)this.expectGroupEnd()}while(this.isMatch([","]));return coordinates};WktParser.prototype.skipWhitespaces=function(){while(this.position<this.value.length&&" "===this.value[this.position])this.position++}},{"./point":9,"./types":11}],13:[function(_require,module,exports){module.exports={encode:function(value){return value<<1^value>>31},decode:function(value){return value>>1^-(1&value)}}},{}],14:[function(_require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr="undefined"!==typeof Uint8Array?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(0<len%4){throw new Error("Invalid string. Length must be a multiple of 4")}return"="===b64[len-2]?2:"="===b64[len-1]?1:0}function byteLength(b64){return 3*b64.length/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(3*len/4-placeHolders);l=0<placeHolders?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=255&tmp>>16;arr[L++]=255&tmp>>8;arr[L++]=255&tmp}if(2===placeHolders){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=255&tmp}else if(1===placeHolders){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=255&tmp>>8;arr[L++]=255&tmp}return arr}function tripletToBase64(num){return lookup[63&num>>18]+lookup[63&num>>12]+lookup[63&num>>6]+lookup[63&num]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(1===extraBytes){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[63&tmp<<4];output+="=="}else if(2===extraBytes){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[63&tmp>>4];output+=lookup[63&tmp<<2];output+="="}parts.push(output);return parts.join("")}},{}],15:[function(_require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=8*nBytes-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8){}if(0===e){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=8*nBytes-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=0>value||0===value&&0>1/value?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(1>value*(c=Math.pow(2,-e))){e--;c*=2}if(1<=e+eBias){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(2<=value*c){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(1<=e+eBias){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=128*s}},{}],16:[function(_require,module,exports){module.exports=function(obj){return null!=obj&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&"function"===typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return"function"===typeof obj.readFloatLE&&"function"===typeof obj.slice&&isBuffer(obj.slice(0,0))}},{}],17:[function(_require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],18:[function(_require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")};;(function(){try{if("function"===typeof setTimeout){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if("function"===typeof clearTimeout){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(1===queue.length&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],19:[function(_require,module,exports){if("function"===typeof Object.create){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],20:[function(_require,module,exports){module.exports=function isBuffer(arg){return arg&&"object"===typeof arg&&"function"===typeof arg.copy&&"function"===typeof arg.fill&&"function"===typeof arg.readUInt8}},{}],21:[function(_require,module,exports){;;(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x;}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(true===process.noDeprecation){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(3<=arguments.length)ctx.depth=arguments[2];if(4<=arguments.length)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"\x1B["+inspect.colors[style][0]+"m"+str+"\x1B["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(0<=keys.indexOf("message")||0<=keys.indexOf("description"))){return formatError(value)}if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(0===keys.length&&(!array||0==value.length)){return braces[0]+base+braces[1]}if(0>recurseTimes){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\"")+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(0>ctx.seen.indexOf(desc.value)){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(-1<str.indexOf("\n")){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,"\"").replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(0<=cur.indexOf("\n"))numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(60<length){return braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return"boolean"===typeof arg}exports.isBoolean=isBoolean;function isNull(arg){return null===arg}exports.isNull=isNull;function isNullOrUndefined(arg){return null==arg}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return"number"===typeof arg}exports.isNumber=isNumber;function isString(arg){return"string"===typeof arg}exports.isString=isString;function isSymbol(arg){return"symbol"===typeof arg}exports.isSymbol=isSymbol;function isUndefined(arg){return void 0===arg}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}exports.isRegExp=isRegExp;function isObject(arg){return"object"===typeof arg&&null!==arg}exports.isObject=isObject;function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}exports.isDate=isDate;function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}exports.isError=isError;function isFunction(arg){return"function"===typeof arg}exports.isFunction=isFunction;function isPrimitive(arg){return null===arg||"boolean"===typeof arg||"number"===typeof arg||"string"===typeof arg||"symbol"===typeof arg||"undefined"===typeof arg}exports.isPrimitive=isPrimitive;exports.isBuffer=_require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=_require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,_require("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":20,_process:18,inherits:19}],buffer:[function(_require,module,exports){;;(function(global){"use strict";var base64=_require("base64-js");var ieee754=_require("ieee754");var isArray=_require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return 42===arr.foo()&&"function"===typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(null===that){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if("number"===typeof arg){if("string"===typeof encodingOrOffset){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if("number"===typeof value){throw new TypeError("\"value\" argument must not be a number")}if("undefined"!==typeof ArrayBuffer&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if("string"===typeof value){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if("undefined"!==typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if("number"!==typeof size){throw new TypeError("\"size\" argument must be a number")}else if(0>size){throw new RangeError("\"size\" argument must not be negative")}}function alloc(that,size,fill,encoding){assertSize(size);if(0>=size){return createBuffer(that,size)}if(fill!==undefined){return"string"===typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,0>size?0:0|checked(size));if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if("string"!==typeof encoding||""===encoding){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError("\"encoding\" must be a valid string encoding")}var length=0|byteLength(string,encoding);that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=0>array.length?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=255&array[i]}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(0>byteOffset||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);that=createBuffer(that,len);if(0===that.length){return that}obj.copy(that,0,0,len);return that}if(obj){if("undefined"!==typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj){if("number"!==typeof obj.length||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if("Buffer"===obj.type&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return 0|length}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(null!=b&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false;}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError("\"list\" argument must be an Array of Buffers")}if(0===list.length){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError("\"list\" argument must be an Array of Buffers")}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if("string"!==typeof string){string=""+string}var len=string.length;if(0===len)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true;}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||0>start){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(0>=end){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true;}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(0!==len%2){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(0!==len%4){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(0!==len%8){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=0|this.length;if(0===length)return"";if(0===arguments.length)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return 0===Buffer.compare(this,b)};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(0<this.length){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(0>start||end>target.length||0>thisStart||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"===typeof byteOffset){encoding=byteOffset;byteOffset=0}else if(2147483647<byteOffset){byteOffset=2147483647}else if(-2147483648>byteOffset){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(0>byteOffset)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(0>byteOffset){if(dir)byteOffset=0;else return-1}if("string"===typeof val){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(0===val.length){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if("number"===typeof val){val=255&val;if(Buffer.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if("ucs2"===encoding||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding){if(2>arr.length||2>val.length){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(1===indexSize){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(-1!==foundIndex)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;0<=i;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(0!==strLen%2)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&"string"===typeof offset){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=0|offset;if(isFinite(length)){length=0|length;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(0<string.length&&(0>length||0>offset)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true;}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(0===start&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(128>firstByte){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if(128===(192&secondByte)){tempCodePoint=(31&firstByte)<<6|63&secondByte;if(127<tempCodePoint){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if(128===(192&secondByte)&&128===(192&thirdByte)){tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte;if(2047<tempCodePoint&&(55296>tempCodePoint||57343<tempCodePoint)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if(128===(192&secondByte)&&128===(192&thirdByte)&&128===(192&fourthByte)){tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte;if(65535<tempCodePoint&&1114112>tempCodePoint){codePoint=tempCodePoint}}}}if(null===codePoint){codePoint=65533;bytesPerSequence=1}else if(65535<codePoint){codePoint-=65536;res.push(55296|1023&codePoint>>>10);codePoint=56320|1023&codePoint}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(127&buf[i])}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||0>start)start=0;if(!end||0>end||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+256*bytes[i+1])}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(0>start){start+=len;if(0>start)start=0}else if(start>len){start=len}if(0>end){end+=len;if(0>end)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(0!==offset%1||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=0|offset;byteLength=0|byteLength;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=0|offset;byteLength=0|byteLength;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(0<byteLength&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return 16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=0|offset;byteLength=0|byteLength;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=0|offset;byteLength=0|byteLength;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(0<i&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(128&this[offset]))return this[offset];return-1*(255-this[offset]+1)};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("\"buffer\" argument must be a Buffer instance");if(value>max||value<min)throw new RangeError("\"value\" argument is out of bounds");if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=0|offset;byteLength=0|byteLength;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=255&value;while(++i<byteLength&&(mul*=256)){this[offset+i]=255&value/mul}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=0|offset;byteLength=0|byteLength;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=255&value;while(0<=--i&&(mul*=256)){this[offset+i]=255&value/mul}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=255&value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(0>value)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=255&value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=255&value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(0>value)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=255&value>>>8*(littleEndian?i:3-i)}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=255&value}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=255&value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=0|offset;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=255&value;while(++i<byteLength&&(mul*=256)){if(0>value&&0===sub&&0!==this[offset+i-1]){sub=1}this[offset+i]=255&(value/mul>>0)-sub}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=0|offset;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=255&value;while(0<=--i&&(mul*=256)){if(0>value&&0===sub&&0!==this[offset+i+1]){sub=1}this[offset+i]=255&(value/mul>>0)-sub}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(0>value)value=255+value+1;this[offset]=255&value;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=255&value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=255&value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=255&value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(0>value)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=255&value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(0>offset)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e+38,-3.4028234663852886e+38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e+308,-1.7976931348623157e+308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&0!==end)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(0<end&&end<start)end=start;if(end===start)return 0;if(0===target.length||0===this.length)return 0;if(0>targetStart){throw new RangeError("targetStart out of bounds")}if(0>start||start>=this.length)throw new RangeError("sourceStart out of bounds");if(0>end)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;0<=i;--i){target[i+targetStart]=this[i+start]}}else if(1000>len||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if("string"===typeof val){if("string"===typeof start){encoding=start;start=0;end=this.length}else if("string"===typeof end){encoding=end;end=this.length}if(1===val.length){var code=val.charCodeAt(0);if(256>code){val=code}}if(encoding!==undefined&&"string"!==typeof encoding){throw new TypeError("encoding must be a string")}if("string"===typeof encoding&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if("number"===typeof val){val=255&val}if(0>start||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if("number"===typeof val){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(2>str.length)return"";while(0!==str.length%4){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(16>n)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(55295<codePoint&&57344>codePoint){if(!leadSurrogate){if(56319<codePoint){if(-1<(units-=3))bytes.push(239,191,189);continue}else if(i+1===length){if(-1<(units-=3))bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(56320>codePoint){if(-1<(units-=3))bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if(-1<(units-=3))bytes.push(239,191,189)}leadSurrogate=null;if(128>codePoint){if(0>(units-=1))break;bytes.push(codePoint)}else if(2048>codePoint){if(0>(units-=2))break;bytes.push(192|codePoint>>6,128|63&codePoint)}else if(65536>codePoint){if(0>(units-=3))break;bytes.push(224|codePoint>>12,128|63&codePoint>>6,128|63&codePoint)}else if(1114112>codePoint){if(0>(units-=4))break;bytes.push(240|codePoint>>18,128|63&codePoint>>12,128|63&codePoint>>6,128|63&codePoint)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(255&str.charCodeAt(i))}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if(0>(units-=2))break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"base64-js":14,ieee754:15,isarray:17}],wkx:[function(_require,module,exports){exports.Types=_require("./types");exports.Geometry=_require("./geometry");exports.Point=_require("./point");exports.LineString=_require("./linestring");exports.Polygon=_require("./polygon");exports.MultiPoint=_require("./multipoint");exports.MultiLineString=_require("./multilinestring");exports.MultiPolygon=_require("./multipolygon");exports.GeometryCollection=_require("./geometrycollection")},{"./geometry":3,"./geometrycollection":4,"./linestring":5,"./multilinestring":6,"./multipoint":7,"./multipolygon":8,"./point":9,"./polygon":10,"./types":11}]},{},["wkx"]);window.wkx=_require("wkx");;;d3.typeahead=function(){var event=d3.dispatch("accept"),autohighlight=false,data;var typeahead=function(selection){var container,hidden,idx=autohighlight?0:-1;function setup(){var rect=selection.node().getBoundingClientRect();container=d3.select(document.body).append("div").attr("class","typeahead").style({position:"absolute",left:rect.left+"px",top:rect.bottom+"px"});selection.on("keyup.typeahead",key);hidden=false}function hide(){container.remove();idx=autohighlight?0:-1;hidden=true}function slowHide(){if(autohighlight){if(container.select("a.selected").node()){select(container.select("a.selected").datum());event.accept()}}window.setTimeout(hide,150)}selection.on("focus.typeahead",setup).on("blur.typeahead",slowHide);function key(){var len=container.selectAll("a").data().length;if(40===d3.event.keyCode){idx=Math.min(idx+1,len-1);return highlight()}else if(38===d3.event.keyCode){idx=Math.max(idx-1,0);return highlight()}else if(13===d3.event.keyCode){if(container.select("a.selected").node()){select(container.select("a.selected").datum())}event.accept();hide()}else{update()}}function highlight(){container.selectAll("a").classed("selected",function(d,i){return i==idx})}function update(){if(hidden)setup();data(selection,function(data){container.style("display",function(){return data.length?"block":"none"});var options=container.selectAll("a").data(data,function(d){return d.value});options.enter().append("a").text(function(d){return d.value}).attr("title",function(d){return d.title}).on("click",select);options.exit().remove();options.classed("selected",function(d,i){return i==idx})})}function select(d){selection.property("value",d.value).trigger("change")}};typeahead.data=function(_){if(!arguments.length)return data;data=_;return typeahead};typeahead.autohighlight=function(_){if(!arguments.length)return autohighlight;autohighlight=_;return typeahead};return d3.rebind(typeahead,event,"on")};;;d3.combobox=function(){var event=d3.dispatch("accept"),data=[],suggestions=[],minItems=2;var fetcher=function(val,cb){cb(data.filter(function(d){return-1!==d.value.toString().toLowerCase().indexOf(val.toLowerCase())}))};var combobox=function(input){var idx=-1,container=d3.select(document.body).selectAll("div.combobox").filter(function(d){return d===input.node()}),shown=!container.empty();input.classed("combobox-input",true).on("focus.typeahead",focus).on("blur.typeahead",blur).on("keydown.typeahead",keydown).on("keyup.typeahead",keyup).on("input.typeahead",change).each(function(){var parent=this.parentNode,sibling=this.nextSibling;var caret=d3.select(parent).selectAll(".combobox-caret").filter(function(d){return d===input.node()}).data([input.node()]);caret.enter().insert("div",function(){return sibling}).attr("class","combobox-caret");caret.on("mousedown",function(){d3.event.stopPropagation();d3.event.preventDefault();if(!shown){input.node().focus();fetch("",render)}else{hide()}})});function focus(){fetch(value(),render)}function blur(){window.setTimeout(hide,150)}function show(){if(!shown){container=d3.select(document.body).insert("div",":first-child").datum(input.node()).attr("class","combobox").style({position:"absolute",display:"block",left:"0px"}).on("mousedown",function(){d3.event.preventDefault()});d3.select(document.body).on("scroll.combobox",render,true);shown=true}}function hide(){if(shown){idx=-1;container.remove();d3.select(document.body).on("scroll.combobox",null);shown=false}}function keydown(){switch(d3.event.keyCode){case 8:case 46:input.on("input.typeahead",function(){idx=-1;render();var start=input.property("selectionStart");input.node().setSelectionRange(start,start);input.on("input.typeahead",change)});break;case 9:container.selectAll("a.selected").each(event.accept);break;case 13:d3.event.preventDefault();break;case 38:nav(-1);d3.event.preventDefault();break;case 40:nav(+1);d3.event.preventDefault();break;}d3.event.stopPropagation()}function keyup(){switch(d3.event.keyCode){case 27:hide();break;case 13:container.selectAll("a.selected").each(event.accept);hide();break;}}function change(){fetch(value(),function(){autocomplete();render()})}function nav(dir){idx=Math.max(Math.min(idx+dir,suggestions.length-1),0);input.property("value",suggestions[idx].value);render();ensureVisible()}function value(){var value=input.property("value"),start=input.property("selectionStart"),end=input.property("selectionEnd");if(start&&end){value=value.substring(0,start)}return value}function fetch(v,cb){fetcher.call(input,v,function(_){suggestions=_;cb()})}function autocomplete(){var v=value();idx=-1;if(!v)return;for(var i=0;i<suggestions.length;i++){if(0===suggestions[i].value.toLowerCase().indexOf(v.toLowerCase())){var completion=v+suggestions[i].value.substr(v.length);idx=i;input.property("value",completion);input.node().setSelectionRange(v.length,completion.length);return}}}function render(){if(suggestions.length>=minItems&&document.activeElement===input.node()){show()}else{hide();return}var options=container.selectAll("a.combobox-option").data(suggestions,function(d){return d.value});options.enter().append("a").attr("class","combobox-option").text(function(d){return d.value});options.attr("title",function(d){return d.title}).classed("selected",function(d,i){return i==idx}).on("mouseover",select).on("click",accept).order();options.exit().remove();var rect=input.node().getBoundingClientRect();container.style({left:rect.left+"px",width:rect.width+"px",top:rect.height+rect.top+"px"})}function select(d,i){idx=i;render()}function ensureVisible(){var node=container.selectAll("a.selected").node();if(node)node.scrollIntoView()}function accept(d){if(!shown)return;input.attr("data-eventSrc","click");input.property("value",d.value).trigger("change");event.accept(d);hide()}};combobox.fetcher=function(_){if(!arguments.length)return fetcher;fetcher=_;return combobox};combobox.data=function(_){if(!arguments.length)return data;data=_;return combobox};combobox.minItems=function(_){if(!arguments.length)return minItems;minItems=_;return combobox};return d3.rebind(combobox,event,"on")};;;d3.geo.tile=function(){var size=[960,500],scale=256,scaleExtent=[0,20],translate=[size[0]/2,size[1]/2],zoomDelta=0;function bound(_){return Math.min(scaleExtent[1],Math.max(scaleExtent[0],_))}function tile(){var z=Math.max(Math.log(scale)/Math.LN2-8,0),z0=bound(Math.round(z+zoomDelta)),k=Math.pow(2,z-z0+8),origin=[(translate[0]-scale/2)/k,(translate[1]-scale/2)/k],tiles=[],cols=d3.range(Math.max(0,Math.floor(-origin[0])),Math.max(0,Math.ceil(size[0]/k-origin[0]))),rows=d3.range(Math.max(0,Math.floor(-origin[1])),Math.max(0,Math.ceil(size[1]/k-origin[1])));rows.forEach(function(y){cols.forEach(function(x){tiles.push([x,y,z0])})});tiles.translate=origin;tiles.scale=k;return tiles}tile.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=_;return tile};tile.size=function(_){if(!arguments.length)return size;size=_;return tile};tile.scale=function(_){if(!arguments.length)return scale;scale=_;return tile};tile.translate=function(_){if(!arguments.length)return translate;translate=_;return tile};tile.zoomDelta=function(_){if(!arguments.length)return zoomDelta;zoomDelta=+_;return tile};return tile};;;d3.selection.prototype.dimensions=function(dimensions){if(!arguments.length){var node=this.node();return[node.offsetWidth,node.offsetHeight]}return this.attr({width:dimensions[0],height:dimensions[1]})};;;;;(function(){"use strict";var use_int32=false;var use_xyz=false;var use_lines=true;var ClipperLib={};var isNode=false;if("undefined"!==typeof module&&module.exports){module.exports=ClipperLib;isNode=true}else{if("undefined"!==typeof document)window.ClipperLib=ClipperLib;else self["ClipperLib"]=ClipperLib}var navigator_appName;if(!isNode){var nav=navigator.userAgent.toString().toLowerCase();navigator_appName=navigator.appName}else{var nav="chrome";navigator_appName="Netscape"}var browser={};if(-1!=nav.indexOf("chrome")&&-1==nav.indexOf("chromium"))browser.chrome=1;else browser.chrome=0;if(-1!=nav.indexOf("chromium"))browser.chromium=1;else browser.chromium=0;if(-1!=nav.indexOf("safari")&&-1==nav.indexOf("chrome")&&-1==nav.indexOf("chromium"))browser.safari=1;else browser.safari=0;if(-1!=nav.indexOf("firefox"))browser.firefox=1;else browser.firefox=0;if(-1!=nav.indexOf("firefox/17"))browser.firefox17=1;else browser.firefox17=0;if(-1!=nav.indexOf("firefox/15"))browser.firefox15=1;else browser.firefox15=0;if(-1!=nav.indexOf("firefox/3"))browser.firefox3=1;else browser.firefox3=0;if(-1!=nav.indexOf("opera"))browser.opera=1;else browser.opera=0;if(-1!=nav.indexOf("msie 10"))browser.msie10=1;else browser.msie10=0;if(-1!=nav.indexOf("msie 9"))browser.msie9=1;else browser.msie9=0;if(-1!=nav.indexOf("msie 8"))browser.msie8=1;else browser.msie8=0;if(-1!=nav.indexOf("msie 7"))browser.msie7=1;else browser.msie7=0;if(-1!=nav.indexOf("msie "))browser.msie=1;else browser.msie=0;ClipperLib.biginteger_used=null;var dbits;var canary=0xdeadbeefcafe;var j_lm=15715070==(16777215&canary);function BigInteger(a,b,c){ClipperLib.biginteger_used=1;if(null!=a)if("number"==typeof a&&"undefined"==typeof b)this.fromInt(a);else if("number"==typeof a)this.fromNumber(a,b,c);else if(null==b&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b)}function nbi(){return new BigInteger(null,undefined,undefined)}function am1(i,x,w,j,c,n){while(0<=--n){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=67108863&v}return c}function am2(i,x,w,j,c,n){var xl=32767&x,xh=x>>15;while(0<=--n){var l=32767&this[i];var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((32767&m)<<15)+w[j]+(1073741823&c);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=1073741823&l}return c}function am3(i,x,w,j,c,n){var xl=16383&x,xh=x>>14;while(0<=--n){var l=16383&this[i];var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((16383&m)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=268435455&l}return c}if(j_lm&&"Microsoft Internet Explorer"==navigator_appName){BigInteger.prototype.am=am2;dbits=30}else if(j_lm&&"Netscape"!=navigator_appName){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array;var rr,vv;rr="0".charCodeAt(0);for(vv=0;9>=vv;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;36>vv;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;36>vv;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return null==c?-1:c}function bnpCopyTo(r){for(var i=this.t-1;0<=i;--i)r[i]=this[i];r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=0>x?-1:0;if(0<x)this[0]=x;else if(-1>x)this[0]=x+this.DV;else this.t=0}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(16==b)k=4;else if(8==b)k=3;else if(256==b)k=8;else if(2==b)k=1;else if(32==b)k=5;else if(4==b)k=2;else{this.fromRadix(s,b);return}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(0<=--i){var x=8==k?255&s[i]:intAt(s,i);if(0>x){if("-"==s.charAt(i))mi=true;continue}mi=false;if(0==sh)this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh;this[this.t++]=x>>this.DB-sh}else this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB}if(8==k&&0!=(128&s[0])){this.s=-1;if(0<sh)this[this.t-1]|=(1<<this.DB-sh)-1<<sh}this.clamp();if(mi)BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(0<this.t&&this[this.t-1]==c)--this.t}function bnToString(b){if(0>this.s)return"-"+this.negate().toString(b);var k;if(16==b)k=4;else if(8==b)k=3;else if(2==b)k=1;else if(32==b)k=5;else if(4==b)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-i*this.DB%k;if(0<i--){if(p<this.DB&&0<(d=this[i]>>p)){m=true;r=int2char(d)}while(0<=i){if(p<k){d=(this[i]&(1<<p)-1)<<k-p;d|=this[--i]>>(p+=this.DB-k)}else{d=this[i]>>(p-=k)&km;if(0>=p){p+=this.DB;--i}}if(0<d)m=true;if(m)r+=int2char(d)}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return 0>this.s?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(0!=r)return r;var i=this.t;r=i-a.t;if(0!=r)return 0>this.s?-r:r;while(0<=--i)if(0!=(r=this[i]-a[i]))return r;return 0}function nbits(x){var r=1,t;if(0!=(t=x>>>16)){x=t;r+=16}if(0!=(t=x>>8)){x=t;r+=8}if(0!=(t=x>>4)){x=t;r+=4}if(0!=(t=x>>2)){x=t;r+=2}if(0!=(t=x>>1)){x=t;r+=1}return r}function bnBitLength(){if(0>=this.t)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;0<=i;--i)r[i+n]=this[i];for(i=n-1;0<=i;--i)r[i]=0;r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM,i;for(i=this.t-1;0<=i;--i){r[i+ds+1]=this[i]>>cbs|c;c=(this[i]&bm)<<bs}for(i=ds-1;0<=i;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(0<bs)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=0>c?-1:0;if(-1>c)r[i++]=this.DV+c;else if(0<c)r[i++]=c;r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(0<=--i)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(0<=--i)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(0<r.t)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(0>=pm.t)return;var pt=this.abs();if(pt.t<pm.t){if(null!=q)q.fromInt(0);if(null!=r)this.copyTo(r);return}if(null==r)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(0<nsh){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(0==y0)return;var yt=y0*(1<<this.F1)+(1<ys?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=null==q?nbi():q;y.dlShiftTo(j,t);if(0<=r.compareTo(t)){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(0<=--j){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}if(null!=q){r.drShiftTo(ys,q);if(ts!=ms)BigInteger.ZERO.subTo(q,q)}r.t=ys;r.clamp();if(0<nsh)r.rShiftTo(nsh,r);if(0>ts)BigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(0>this.s&&0<r.compareTo(BigInteger.ZERO))a.subTo(r,r);return r}function Classic(m){this.m=m}function cConvert(x){if(0>x.s||0<=x.compareTo(this.m))return x.mod(this.m);else return x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(1>this.t)return 0;var x=this[0];if(0==(1&x))return 0;var y=3&x;y=15&y*(2-(15&x)*y);y=255&y*(2-(255&x)*y);y=65535&y*(2-(65535&(65535&x)*y));y=y*(2-x*y%this.DV)%this.DV;return 0<y?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=32767&this.mp;this.mph=this.mp>>15;this.um=(1<<m.DB-15)-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(0>x.s&&0<r.compareTo(BigInteger.ZERO))this.m.subTo(r,r);return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=32767&x[i];var u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(0<=x.compareTo(this.m))x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return 0==(0<this.t?1&this[0]:this.s)}function bnpExp(e,z){if(4294967295<e||1>e)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(0<=--i){z.sqrTo(r,r2);if(0<(e&1<<i))z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(256>e||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function bnClone(){var r=nbi();this.copyTo(r);return r}function bnIntValue(){if(0>this.s){if(1==this.t)return this[0]-this.DV;else if(0==this.t)return-1}else if(1==this.t)return this[0];else if(0==this.t)return 0;return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){if(0>this.s)return-1;else if(0>=this.t||1==this.t&&0>=this[0])return 0;else return 1}function bnpToRadix(b){if(null==b)b=10;if(0==this.signum()||2>b||36<b)return"0";var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(0<y.signum()){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z)}return z.intValue().toString(b)+r}function bnpFromRadix(s,b){this.fromInt(0);if(null==b)b=10;var cs=this.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(0>x){if("-"==s.charAt(i)&&0==this.signum())mi=true;continue}w=b*w+x;if(++j>=cs){this.dMultiply(d);this.dAddOffset(w,0);j=0;w=0}}if(0<j){this.dMultiply(Math.pow(b,j));this.dAddOffset(w,0)}if(mi)BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(a,b,c){if("number"==typeof b){if(2>a)this.fromInt(1);else{this.fromNumber(a,c);if(!this.testBit(a-1))this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this);if(this.isEven())this.dAddOffset(1,0);while(!this.isProbablePrime(b)){this.dAddOffset(2,0);if(this.bitLength()>a)this.subTo(BigInteger.ONE.shiftLeft(a-1),this)}}}else{var x=new Array,t=7&a;x.length=(a>>3)+1;b.nextBytes(x);if(0<t)x[0]&=(1<<t)-1;else x[0]=0;this.fromString(x,256)}}function bnToByteArray(){var i=this.t,r=new Array;r[0]=this.s;var p=this.DB-i*this.DB%8,d,k=0;if(0<i--){if(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p)r[k++]=d|this.s<<this.DB-p;while(0<=i){if(8>p){d=(this[i]&(1<<p)-1)<<8-p;d|=this[--i]>>(p+=this.DB-8)}else{d=255&this[i]>>(p-=8);if(0>=p){p+=this.DB;--i}}if(0!=(128&d))d|=-256;if(0==k&&(128&this.s)!=(128&d))++k;if(0<k||d!=this.s)r[k++]=d}}return r}function bnEquals(a){return 0==this.compareTo(a)}function bnMin(a){return 0>this.compareTo(a)?this:a}function bnMax(a){return 0<this.compareTo(a)?this:a}function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){f=a.s&this.DM;for(i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{f=this.s&this.DM;for(i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s);r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();this.bitwiseTo(a,op_and,r);return r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();this.bitwiseTo(a,op_or,r);return r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();this.bitwiseTo(a,op_xor,r);return r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();this.bitwiseTo(a,op_andnot,r);return r}function bnNot(){var r=nbi();for(var i=0;i<this.t;++i)r[i]=this.DM&~this[i];r.t=this.t;r.s=~this.s;return r}function bnShiftLeft(n){var r=nbi();if(0>n)this.rShiftTo(-n,r);else this.lShiftTo(n,r);return r}function bnShiftRight(n){var r=nbi();if(0>n)this.lShiftTo(-n,r);else this.rShiftTo(n,r);return r}function lbit(x){if(0==x)return-1;var r=0;if(0==(65535&x)){x>>=16;r+=16}if(0==(255&x)){x>>=8;r+=8}if(0==(15&x)){x>>=4;r+=4}if(0==(3&x)){x>>=2;r+=2}if(0==(1&x))++r;return r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(0!=this[i])return i*this.DB+lbit(this[i]);if(0>this.s)return this.t*this.DB;return-1}function cbit(x){var r=0;while(0!=x){x&=x-1;++r}return r}function bnBitCount(){var r=0,x=this.s&this.DM;for(var i=0;i<this.t;++i)r+=cbit(this[i]^x);return r}function bnTestBit(n){var j=Math.floor(n/this.DB);if(j>=this.t)return 0!=this.s;return 0!=(this[j]&1<<n%this.DB)}function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);this.bitwiseTo(r,op,r);return r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]+a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c+=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c+=a[i];r[i++]=c&this.DM;c>>=this.DB}c+=a.s}r.s=0>c?-1:0;if(0<c)r[i++]=c;else if(-1>c)r[i++]=this.DV+c;r.t=i;r.clamp()}function bnAdd(a){var r=nbi();this.addTo(a,r);return r}function bnSubtract(a){var r=nbi();this.subTo(a,r);return r}function bnMultiply(a){var r=nbi();this.multiplyTo(a,r);return r}function bnSquare(){var r=nbi();this.squareTo(r);return r}function bnDivide(a){var r=nbi();this.divRemTo(a,r,null);return r}function bnRemainder(a){var r=nbi();this.divRemTo(a,null,r);return r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();this.divRemTo(a,q,r);return new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(n,w){if(0==n)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t)this[this.t++]=0;++this[w]}}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);r.s=0;r.t=i;while(0<i)r[--i]=0;var j;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;r.s=0;while(0<=--i)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp();r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*m.t,this.r2);this.mu=this.r2.divide(m);this.m=m}function barrettConvert(x){if(0>x.s||x.t>2*this.m.t)return x.mod(this.m);else if(0>x.compareTo(this.m))return x;else{var r=nbi();x.copyTo(r);this.reduce(r);return r}}function barrettRevert(x){return x}function barrettReduce(x){x.drShiftTo(this.m.t-1,this.r2);if(x.t>this.m.t+1){x.t=this.m.t+1;x.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(0>x.compareTo(this.r2))x.dAddOffset(1,this.m.t+1);x.subTo(this.r2,x);while(0<=x.compareTo(this.m))x.subTo(this.m,x)}function barrettSqrTo(x,r){x.squareTo(r);this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(e,m){var i=e.bitLength(),k,r=nbv(1),z;if(0>=i)return r;else if(18>i)k=1;else if(48>i)k=3;else if(144>i)k=4;else if(768>i)k=5;else k=6;if(8>i)z=new Classic(m);else if(m.isEven())z=new Barrett(m);else z=new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;g[1]=z.convert(this);if(1<k){var g2=nbi();z.sqrTo(g[1],g2);while(n<=km){g[n]=nbi();z.mulTo(g2,g[n-2],g[n]);n+=2}}var j=e.t-1,w,is1=true,r2=nbi(),t;i=nbits(e[j])-1;while(0<=j){if(i>=k1)w=e[j]>>i-k1&km;else{w=(e[j]&(1<<i+1)-1)<<k1-i;if(0<j)w|=e[j-1]>>this.DB+i-k1}n=k;while(0==(1&w)){w>>=1;--n}if(0>(i-=n)){i+=this.DB;--j}if(is1){g[w].copyTo(r);is1=false}else{while(1<n){z.sqrTo(r,r2);z.sqrTo(r2,r);n-=2}if(0<n)z.sqrTo(r,r2);else{t=r;r=r2;r2=t}z.mulTo(r2,g[w],r)}while(0<=j&&0==(e[j]&1<<i)){z.sqrTo(r,r2);t=r;r=r2;r2=t;if(0>--i){i=this.DB-1;--j}}}return z.revert(r)}function bnGCD(a){var x=0>this.s?this.negate():this.clone();var y=0>a.s?a.negate():a.clone();if(0>x.compareTo(y)){var t=x;x=y;y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(0>g)return x;if(i<g)g=i;if(0<g){x.rShiftTo(g,x);y.rShiftTo(g,y)}while(0<x.signum()){if(0<(i=x.getLowestSetBit()))x.rShiftTo(i,x);if(0<(i=y.getLowestSetBit()))y.rShiftTo(i,y);if(0<=x.compareTo(y)){x.subTo(y,x);x.rShiftTo(1,x)}else{y.subTo(x,y);y.rShiftTo(1,y)}}if(0<g)y.lShiftTo(g,y);return y}function bnpModInt(n){if(0>=n)return 0;var d=this.DV%n,r=0>this.s?n-1:0;if(0<this.t)if(0==d)r=this[0]%n;else for(var i=this.t-1;0<=i;--i)r=(d*r+this[i])%n;return r}function bnModInverse(m){var ac=m.isEven();if(this.isEven()&&ac||0==m.signum())return BigInteger.ZERO;var u=m.clone(),v=this.clone();var a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);while(0!=u.signum()){while(u.isEven()){u.rShiftTo(1,u);if(ac){if(!a.isEven()||!b.isEven()){a.addTo(this,a);b.subTo(m,b)}a.rShiftTo(1,a)}else if(!b.isEven())b.subTo(m,b);b.rShiftTo(1,b)}while(v.isEven()){v.rShiftTo(1,v);if(ac){if(!c.isEven()||!d.isEven()){c.addTo(this,c);d.subTo(m,d)}c.rShiftTo(1,c)}else if(!d.isEven())d.subTo(m,d);d.rShiftTo(1,d)}if(0<=u.compareTo(v)){u.subTo(v,u);if(ac)a.subTo(c,a);b.subTo(d,b)}else{v.subTo(u,v);if(ac)c.subTo(a,c);d.subTo(b,d)}}if(0!=v.compareTo(BigInteger.ONE))return BigInteger.ZERO;if(0<=d.compareTo(m))return d.subtract(m);if(0>d.signum())d.addTo(m,d);else return d;if(0>d.signum())return d.add(m);else return d}var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];var lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(t){var i,x=this.abs();if(1==x.t&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return true;return false}if(x.isEven())return false;i=1;while(i<lowprimes.length){var m=lowprimes[i],j=i+1;while(j<lowprimes.length&&m<lplim)m*=lowprimes[j++];m=x.modInt(m);while(i<j)if(0==m%lowprimes[i++])return false}return x.millerRabin(t)}function bnpMillerRabin(t){var n1=this.subtract(BigInteger.ONE);var k=n1.getLowestSetBit();if(0>=k)return false;var r=n1.shiftRight(k);t=t+1>>1;if(t>lowprimes.length)t=lowprimes.length;var a=nbi();for(var i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(0!=y.compareTo(BigInteger.ONE)&&0!=y.compareTo(n1)){var j=1;while(j++<k&&0!=y.compareTo(n1)){y=y.modPowInt(2,this);if(0==y.compareTo(BigInteger.ONE))return false}if(0!=y.compareTo(n1))return false}}return true}BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.fromNumber=bnpFromNumber;BigInteger.prototype.bitwiseTo=bnpBitwiseTo;BigInteger.prototype.changeBit=bnpChangeBit;BigInteger.prototype.addTo=bnpAddTo;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo;BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo;BigInteger.prototype.modInt=bnpModInt;BigInteger.prototype.millerRabin=bnpMillerRabin;BigInteger.prototype.clone=bnClone;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.byteValue=bnByteValue;BigInteger.prototype.shortValue=bnShortValue;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.toByteArray=bnToByteArray;BigInteger.prototype.equals=bnEquals;BigInteger.prototype.min=bnMin;BigInteger.prototype.max=bnMax;BigInteger.prototype.and=bnAnd;BigInteger.prototype.or=bnOr;BigInteger.prototype.xor=bnXor;BigInteger.prototype.andNot=bnAndNot;BigInteger.prototype.not=bnNot;BigInteger.prototype.shiftLeft=bnShiftLeft;BigInteger.prototype.shiftRight=bnShiftRight;BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit;BigInteger.prototype.bitCount=bnBitCount;BigInteger.prototype.testBit=bnTestBit;BigInteger.prototype.setBit=bnSetBit;BigInteger.prototype.clearBit=bnClearBit;BigInteger.prototype.flipBit=bnFlipBit;BigInteger.prototype.add=bnAdd;BigInteger.prototype.subtract=bnSubtract;BigInteger.prototype.multiply=bnMultiply;BigInteger.prototype.divide=bnDivide;BigInteger.prototype.remainder=bnRemainder;BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder;BigInteger.prototype.modPow=bnModPow;BigInteger.prototype.modInverse=bnModInverse;BigInteger.prototype.pow=bnPow;BigInteger.prototype.gcd=bnGCD;BigInteger.prototype.isProbablePrime=bnIsProbablePrime;BigInteger.prototype.square=bnSquare;var Int128=BigInteger;Int128.prototype.IsNegative=function(){if(-1==this.compareTo(Int128.ZERO))return true;else return false};Int128.op_Equality=function(val1,val2){if(0==val1.compareTo(val2))return true;else return false};Int128.op_Inequality=function(val1,val2){if(0!=val1.compareTo(val2))return true;else return false};Int128.op_GreaterThan=function(val1,val2){if(0<val1.compareTo(val2))return true;else return false};Int128.op_LessThan=function(val1,val2){if(0>val1.compareTo(val2))return true;else return false};Int128.op_Addition=function(lhs,rhs){return new Int128(lhs).add(new Int128(rhs))};Int128.op_Subtraction=function(lhs,rhs){return new Int128(lhs).subtract(new Int128(rhs))};Int128.Int128Mul=function(lhs,rhs){return new Int128(lhs).multiply(new Int128(rhs))};Int128.op_Division=function(lhs,rhs){return lhs.divide(rhs)};Int128.prototype.ToDouble=function(){return parseFloat(this.toString())};var Inherit=function(ce,ce2){var p;if("undefined"==typeof Object.getOwnPropertyNames){for(p in ce2.prototype)if("undefined"==typeof ce.prototype[p]||ce.prototype[p]==Object.prototype[p])ce.prototype[p]=ce2.prototype[p];for(p in ce2)if("undefined"==typeof ce[p])ce[p]=ce2[p];ce.$baseCtor=ce2}else{var props=Object.getOwnPropertyNames(ce2.prototype);for(var i=0;i<props.length;i++)if("undefined"==typeof Object.getOwnPropertyDescriptor(ce.prototype,props[i]))Object.defineProperty(ce.prototype,props[i],Object.getOwnPropertyDescriptor(ce2.prototype,props[i]));for(p in ce2)if("undefined"==typeof ce[p])ce[p]=ce2[p];ce.$baseCtor=ce2}};ClipperLib.Path=function(){return[]};ClipperLib.Paths=function(){return[]};ClipperLib.DoublePoint=function(){var a=arguments;this.X=0;this.Y=0;if(1==a.length){this.X=a[0].X;this.Y=a[0].Y}else if(2==a.length){this.X=a[0];this.Y=a[1]}};ClipperLib.DoublePoint0=function(){this.X=0;this.Y=0};ClipperLib.DoublePoint1=function(dp){this.X=dp.X;this.Y=dp.Y};ClipperLib.DoublePoint2=function(x,y){this.X=x;this.Y=y};ClipperLib.PolyNode=function(){this.m_Parent=null;this.m_polygon=new ClipperLib.Path;this.m_Index=0;this.m_jointype=0;this.m_endtype=0;this.m_Childs=[];this.IsOpen=false};ClipperLib.PolyNode.prototype.IsHoleNode=function(){var result=true;var node=this.m_Parent;while(null!==node){result=!result;node=node.m_Parent}return result};ClipperLib.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};ClipperLib.PolyNode.prototype.Contour=function(){return this.m_polygon};ClipperLib.PolyNode.prototype.AddChild=function(Child){var cnt=this.m_Childs.length;this.m_Childs.push(Child);Child.m_Parent=this;Child.m_Index=cnt};ClipperLib.PolyNode.prototype.GetNext=function(){if(0<this.m_Childs.length)return this.m_Childs[0];else return this.GetNextSiblingUp()};ClipperLib.PolyNode.prototype.GetNextSiblingUp=function(){if(null===this.m_Parent)return null;else if(this.m_Index==this.m_Parent.m_Childs.length-1)return this.m_Parent.GetNextSiblingUp();else return this.m_Parent.m_Childs[this.m_Index+1]};ClipperLib.PolyNode.prototype.Childs=function(){return this.m_Childs};ClipperLib.PolyNode.prototype.Parent=function(){return this.m_Parent};ClipperLib.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};ClipperLib.PolyTree=function(){this.m_AllPolys=[];ClipperLib.PolyNode.call(this)};ClipperLib.PolyTree.prototype.Clear=function(){for(var i=0,ilen=this.m_AllPolys.length;i<ilen;i++)this.m_AllPolys[i]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};ClipperLib.PolyTree.prototype.GetFirst=function(){if(0<this.m_Childs.length)return this.m_Childs[0];else return null};ClipperLib.PolyTree.prototype.Total=function(){var result=this.m_AllPolys.length;if(0<result&&this.m_Childs[0]!=this.m_AllPolys[0])result--;return result};Inherit(ClipperLib.PolyTree,ClipperLib.PolyNode);ClipperLib.Math_Abs_Int64=ClipperLib.Math_Abs_Int32=ClipperLib.Math_Abs_Double=function(a){return Math.abs(a)};ClipperLib.Math_Max_Int32_Int32=function(a,b){return Math.max(a,b)};if(browser.msie||browser.opera||browser.safari)ClipperLib.Cast_Int32=function(a){return 0|a};else ClipperLib.Cast_Int32=function(a){return~~a};if(browser.chrome)ClipperLib.Cast_Int64=function(a){if(-2147483648>a||2147483647<a)return 0>a?Math.ceil(a):Math.floor(a);else return~~a};else if(browser.firefox&&"function"==typeof Number.toInteger)ClipperLib.Cast_Int64=function(a){return Number.toInteger(a)};else if(browser.msie7||browser.msie8)ClipperLib.Cast_Int64=function(a){return parseInt(a,10)};else if(browser.msie)ClipperLib.Cast_Int64=function(a){if(-2147483648>a||2147483647<a)return 0>a?Math.ceil(a):Math.floor(a);return 0|a};else ClipperLib.Cast_Int64=function(a){return 0>a?Math.ceil(a):Math.floor(a)};ClipperLib.Clear=function(a){a.length=0};ClipperLib.PI=3.141592653589793;ClipperLib.PI2=3.141592653589793*2;ClipperLib.IntPoint=function(){var a=arguments,alen=a.length;this.X=0;this.Y=0;if(use_xyz){this.Z=0;if(3==alen){this.X=a[0];this.Y=a[1];this.Z=a[2]}else if(2==alen){this.X=a[0];this.Y=a[1];this.Z=0}else if(1==alen){if(a[0]instanceof ClipperLib.DoublePoint){var dp=a[0];this.X=ClipperLib.Clipper.Round(dp.X);this.Y=ClipperLib.Clipper.Round(dp.Y);this.Z=0}else{var pt=a[0];if("undefined"==typeof pt.Z)pt.Z=0;this.X=pt.X;this.Y=pt.Y;this.Z=pt.Z}}else{this.X=0;this.Y=0;this.Z=0}}else{if(2==alen){this.X=a[0];this.Y=a[1]}else if(1==alen){if(a[0]instanceof ClipperLib.DoublePoint){var dp=a[0];this.X=ClipperLib.Clipper.Round(dp.X);this.Y=ClipperLib.Clipper.Round(dp.Y)}else{var pt=a[0];this.X=pt.X;this.Y=pt.Y}}else{this.X=0;this.Y=0}}};ClipperLib.IntPoint.op_Equality=function(a,b){return a.X==b.X&&a.Y==b.Y};ClipperLib.IntPoint.op_Inequality=function(a,b){return a.X!=b.X||a.Y!=b.Y};if(use_xyz){ClipperLib.IntPoint0=function(){this.X=0;this.Y=0;this.Z=0};ClipperLib.IntPoint1=function(pt){this.X=pt.X;this.Y=pt.Y;this.Z=pt.Z};ClipperLib.IntPoint1dp=function(dp){this.X=ClipperLib.Clipper.Round(dp.X);this.Y=ClipperLib.Clipper.Round(dp.Y);this.Z=0};ClipperLib.IntPoint2=function(x,y){this.X=x;this.Y=y;this.Z=0};ClipperLib.IntPoint3=function(x,y,z){this.X=x;this.Y=y;this.Z=z}}else{ClipperLib.IntPoint0=function(){this.X=0;this.Y=0};ClipperLib.IntPoint1=function(pt){this.X=pt.X;this.Y=pt.Y};ClipperLib.IntPoint1dp=function(dp){this.X=ClipperLib.Clipper.Round(dp.X);this.Y=ClipperLib.Clipper.Round(dp.Y)};ClipperLib.IntPoint2=function(x,y){this.X=x;this.Y=y}}ClipperLib.IntRect=function(){var a=arguments,alen=a.length;if(4==alen){this.left=a[0];this.top=a[1];this.right=a[2];this.bottom=a[3]}else if(1==alen){this.left=ir.left;this.top=ir.top;this.right=ir.right;this.bottom=ir.bottom}else{this.left=0;this.top=0;this.right=0;this.bottom=0}};ClipperLib.IntRect0=function(){this.left=0;this.top=0;this.right=0;this.bottom=0};ClipperLib.IntRect1=function(ir){this.left=ir.left;this.top=ir.top;this.right=ir.right;this.bottom=ir.bottom};ClipperLib.IntRect4=function(l,t,r,b){this.left=l;this.top=t;this.right=r;this.bottom=b};ClipperLib.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};ClipperLib.PolyType={ptSubject:0,ptClip:1};ClipperLib.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};ClipperLib.JoinType={jtSquare:0,jtRound:1,jtMiter:2};ClipperLib.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};ClipperLib.EdgeSide={esLeft:0,esRight:1};ClipperLib.Direction={dRightToLeft:0,dLeftToRight:1};ClipperLib.TEdge=function(){this.Bot=new ClipperLib.IntPoint;this.Curr=new ClipperLib.IntPoint;this.Top=new ClipperLib.IntPoint;this.Delta=new ClipperLib.IntPoint;this.Dx=0;this.PolyTyp=ClipperLib.PolyType.ptSubject;this.Side=ClipperLib.EdgeSide.esLeft;this.WindDelta=0;this.WindCnt=0;this.WindCnt2=0;this.OutIdx=0;this.Next=null;this.Prev=null;this.NextInLML=null;this.NextInAEL=null;this.PrevInAEL=null;this.NextInSEL=null;this.PrevInSEL=null};ClipperLib.IntersectNode=function(){this.Edge1=null;this.Edge2=null;this.Pt=new ClipperLib.IntPoint};ClipperLib.MyIntersectNodeSort=function(){};ClipperLib.MyIntersectNodeSort.Compare=function(node1,node2){var i=node2.Pt.Y-node1.Pt.Y;if(0<i)return 1;else if(0>i)return-1;else return 0};ClipperLib.LocalMinima=function(){this.Y=0;this.LeftBound=null;this.RightBound=null;this.Next=null};ClipperLib.Scanbeam=function(){this.Y=0;this.Next=null};ClipperLib.OutRec=function(){this.Idx=0;this.IsHole=false;this.IsOpen=false;this.FirstLeft=null;this.Pts=null;this.BottomPt=null;this.PolyNode=null};ClipperLib.OutPt=function(){this.Idx=0;this.Pt=new ClipperLib.IntPoint;this.Next=null;this.Prev=null};ClipperLib.Join=function(){this.OutPt1=null;this.OutPt2=null;this.OffPt=new ClipperLib.IntPoint};ClipperLib.ClipperBase=function(){this.m_MinimaList=null;this.m_CurrentLM=null;this.m_edges=new Array;this.m_UseFullRange=false;this.m_HasOpenPaths=false;this.PreserveCollinear=false;this.m_MinimaList=null;this.m_CurrentLM=null;this.m_UseFullRange=false;this.m_HasOpenPaths=false};ClipperLib.ClipperBase.horizontal=-9007199254740992;ClipperLib.ClipperBase.Skip=-2;ClipperLib.ClipperBase.Unassigned=-1;ClipperLib.ClipperBase.tolerance=1e-20;if(use_int32){ClipperLib.ClipperBase.loRange=32767;ClipperLib.ClipperBase.hiRange=32767}else{ClipperLib.ClipperBase.loRange=47453132;ClipperLib.ClipperBase.hiRange=4503599627370495}ClipperLib.ClipperBase.near_zero=function(val){return val>-ClipperLib.ClipperBase.tolerance&&val<ClipperLib.ClipperBase.tolerance};ClipperLib.ClipperBase.IsHorizontal=function(e){return 0===e.Delta.Y};ClipperLib.ClipperBase.prototype.PointIsVertex=function(pt,pp){var pp2=pp;do{if(ClipperLib.IntPoint.op_Equality(pp2.Pt,pt))return true;pp2=pp2.Next}while(pp2!=pp);return false};ClipperLib.ClipperBase.prototype.PointOnLineSegment=function(pt,linePt1,linePt2,UseFullRange){if(UseFullRange)return pt.X==linePt1.X&&pt.Y==linePt1.Y||pt.X==linePt2.X&&pt.Y==linePt2.Y||pt.X>linePt1.X==pt.X<linePt2.X&&pt.Y>linePt1.Y==pt.Y<linePt2.Y&&Int128.op_Equality(Int128.Int128Mul(pt.X-linePt1.X,linePt2.Y-linePt1.Y),Int128.Int128Mul(linePt2.X-linePt1.X,pt.Y-linePt1.Y));else return pt.X==linePt1.X&&pt.Y==linePt1.Y||pt.X==linePt2.X&&pt.Y==linePt2.Y||pt.X>linePt1.X==pt.X<linePt2.X&&pt.Y>linePt1.Y==pt.Y<linePt2.Y&&(pt.X-linePt1.X)*(linePt2.Y-linePt1.Y)==(linePt2.X-linePt1.X)*(pt.Y-linePt1.Y)};ClipperLib.ClipperBase.prototype.PointOnPolygon=function(pt,pp,UseFullRange){var pp2=pp;while(true){if(this.PointOnLineSegment(pt,pp2.Pt,pp2.Next.Pt,UseFullRange))return true;pp2=pp2.Next;if(pp2==pp)break}return false};ClipperLib.ClipperBase.prototype.SlopesEqual=ClipperLib.ClipperBase.SlopesEqual=function(){var a=arguments,alen=a.length;var e1,e2,pt1,pt2,pt3,pt4,UseFullRange;if(3==alen){e1=a[0];e2=a[1];UseFullRange=a[2];if(UseFullRange)return Int128.op_Equality(Int128.Int128Mul(e1.Delta.Y,e2.Delta.X),Int128.Int128Mul(e1.Delta.X,e2.Delta.Y));else return ClipperLib.Cast_Int64(e1.Delta.Y*e2.Delta.X)==ClipperLib.Cast_Int64(e1.Delta.X*e2.Delta.Y)}else if(4==alen){pt1=a[0];pt2=a[1];pt3=a[2];UseFullRange=a[3];if(UseFullRange)return Int128.op_Equality(Int128.Int128Mul(pt1.Y-pt2.Y,pt2.X-pt3.X),Int128.Int128Mul(pt1.X-pt2.X,pt2.Y-pt3.Y));else return 0===ClipperLib.Cast_Int64((pt1.Y-pt2.Y)*(pt2.X-pt3.X))-ClipperLib.Cast_Int64((pt1.X-pt2.X)*(pt2.Y-pt3.Y))}else{pt1=a[0];pt2=a[1];pt3=a[2];pt4=a[3];UseFullRange=a[4];if(UseFullRange)return Int128.op_Equality(Int128.Int128Mul(pt1.Y-pt2.Y,pt3.X-pt4.X),Int128.Int128Mul(pt1.X-pt2.X,pt3.Y-pt4.Y));else return 0===ClipperLib.Cast_Int64((pt1.Y-pt2.Y)*(pt3.X-pt4.X))-ClipperLib.Cast_Int64((pt1.X-pt2.X)*(pt3.Y-pt4.Y))}};ClipperLib.ClipperBase.SlopesEqual3=function(e1,e2,UseFullRange){if(UseFullRange)return Int128.op_Equality(Int128.Int128Mul(e1.Delta.Y,e2.Delta.X),Int128.Int128Mul(e1.Delta.X,e2.Delta.Y));else return ClipperLib.Cast_Int64(e1.Delta.Y*e2.Delta.X)==ClipperLib.Cast_Int64(e1.Delta.X*e2.Delta.Y)};ClipperLib.ClipperBase.SlopesEqual4=function(pt1,pt2,pt3,UseFullRange){if(UseFullRange)return Int128.op_Equality(Int128.Int128Mul(pt1.Y-pt2.Y,pt2.X-pt3.X),Int128.Int128Mul(pt1.X-pt2.X,pt2.Y-pt3.Y));else return 0===ClipperLib.Cast_Int64((pt1.Y-pt2.Y)*(pt2.X-pt3.X))-ClipperLib.Cast_Int64((pt1.X-pt2.X)*(pt2.Y-pt3.Y))};ClipperLib.ClipperBase.SlopesEqual5=function(pt1,pt2,pt3,pt4,UseFullRange){if(UseFullRange)return Int128.op_Equality(Int128.Int128Mul(pt1.Y-pt2.Y,pt3.X-pt4.X),Int128.Int128Mul(pt1.X-pt2.X,pt3.Y-pt4.Y));else return 0===ClipperLib.Cast_Int64((pt1.Y-pt2.Y)*(pt3.X-pt4.X))-ClipperLib.Cast_Int64((pt1.X-pt2.X)*(pt3.Y-pt4.Y))};ClipperLib.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var i=0,ilen=this.m_edges.length;i<ilen;++i){for(var j=0,jlen=this.m_edges[i].length;j<jlen;++j)this.m_edges[i][j]=null;ClipperLib.Clear(this.m_edges[i])}ClipperLib.Clear(this.m_edges);this.m_UseFullRange=false;this.m_HasOpenPaths=false};ClipperLib.ClipperBase.prototype.DisposeLocalMinimaList=function(){while(null!==this.m_MinimaList){var tmpLm=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=tmpLm}this.m_CurrentLM=null};ClipperLib.ClipperBase.prototype.RangeTest=function(Pt,useFullRange){if(useFullRange.Value){if(Pt.X>ClipperLib.ClipperBase.hiRange||Pt.Y>ClipperLib.ClipperBase.hiRange||-Pt.X>ClipperLib.ClipperBase.hiRange||-Pt.Y>ClipperLib.ClipperBase.hiRange)ClipperLib.Error("Coordinate outside allowed range in RangeTest().")}else if(Pt.X>ClipperLib.ClipperBase.loRange||Pt.Y>ClipperLib.ClipperBase.loRange||-Pt.X>ClipperLib.ClipperBase.loRange||-Pt.Y>ClipperLib.ClipperBase.loRange){useFullRange.Value=true;this.RangeTest(Pt,useFullRange)}};ClipperLib.ClipperBase.prototype.InitEdge=function(e,eNext,ePrev,pt){e.Next=eNext;e.Prev=ePrev;e.Curr.X=pt.X;e.Curr.Y=pt.Y;e.OutIdx=-1};ClipperLib.ClipperBase.prototype.InitEdge2=function(e,polyType){if(e.Curr.Y>=e.Next.Curr.Y){e.Bot.X=e.Curr.X;e.Bot.Y=e.Curr.Y;e.Top.X=e.Next.Curr.X;e.Top.Y=e.Next.Curr.Y}else{e.Top.X=e.Curr.X;e.Top.Y=e.Curr.Y;e.Bot.X=e.Next.Curr.X;e.Bot.Y=e.Next.Curr.Y}this.SetDx(e);e.PolyTyp=polyType};ClipperLib.ClipperBase.prototype.FindNextLocMin=function(E){var E2;for(;;){while(ClipperLib.IntPoint.op_Inequality(E.Bot,E.Prev.Bot)||ClipperLib.IntPoint.op_Equality(E.Curr,E.Top))E=E.Next;if(E.Dx!=ClipperLib.ClipperBase.horizontal&&E.Prev.Dx!=ClipperLib.ClipperBase.horizontal)break;while(E.Prev.Dx==ClipperLib.ClipperBase.horizontal)E=E.Prev;E2=E;while(E.Dx==ClipperLib.ClipperBase.horizontal)E=E.Next;if(E.Top.Y==E.Prev.Bot.Y)continue;if(E2.Prev.Bot.X<E.Bot.X)E=E2;break}return E};ClipperLib.ClipperBase.prototype.ProcessBound=function(E,LeftBoundIsForward){var EStart;var Result=E;var Horz;if(Result.OutIdx==ClipperLib.ClipperBase.Skip){E=Result;if(LeftBoundIsForward){while(E.Top.Y==E.Next.Bot.Y)E=E.Next;while(E!=Result&&E.Dx==ClipperLib.ClipperBase.horizontal)E=E.Prev}else{while(E.Top.Y==E.Prev.Bot.Y)E=E.Prev;while(E!=Result&&E.Dx==ClipperLib.ClipperBase.horizontal)E=E.Next}if(E==Result){if(LeftBoundIsForward)Result=E.Next;else Result=E.Prev}else{if(LeftBoundIsForward)E=Result.Next;else E=Result.Prev;var locMin=new ClipperLib.LocalMinima;locMin.Next=null;locMin.Y=E.Bot.Y;locMin.LeftBound=null;locMin.RightBound=E;E.WindDelta=0;Result=this.ProcessBound(E,LeftBoundIsForward);this.InsertLocalMinima(locMin)}return Result}if(E.Dx==ClipperLib.ClipperBase.horizontal){if(LeftBoundIsForward)EStart=E.Prev;else EStart=E.Next;if(EStart.OutIdx!=ClipperLib.ClipperBase.Skip){if(EStart.Dx==ClipperLib.ClipperBase.horizontal){if(EStart.Bot.X!=E.Bot.X&&EStart.Top.X!=E.Bot.X)this.ReverseHorizontal(E)}else if(EStart.Bot.X!=E.Bot.X)this.ReverseHorizontal(E)}}EStart=E;if(LeftBoundIsForward){while(Result.Top.Y==Result.Next.Bot.Y&&Result.Next.OutIdx!=ClipperLib.ClipperBase.Skip)Result=Result.Next;if(Result.Dx==ClipperLib.ClipperBase.horizontal&&Result.Next.OutIdx!=ClipperLib.ClipperBase.Skip){Horz=Result;while(Horz.Prev.Dx==ClipperLib.ClipperBase.horizontal)Horz=Horz.Prev;if(Horz.Prev.Top.X==Result.Next.Top.X){if(!LeftBoundIsForward)Result=Horz.Prev}else if(Horz.Prev.Top.X>Result.Next.Top.X)Result=Horz.Prev}while(E!=Result){E.NextInLML=E.Next;if(E.Dx==ClipperLib.ClipperBase.horizontal&&E!=EStart&&E.Bot.X!=E.Prev.Top.X)this.ReverseHorizontal(E);E=E.Next}if(E.Dx==ClipperLib.ClipperBase.horizontal&&E!=EStart&&E.Bot.X!=E.Prev.Top.X)this.ReverseHorizontal(E);Result=Result.Next}else{while(Result.Top.Y==Result.Prev.Bot.Y&&Result.Prev.OutIdx!=ClipperLib.ClipperBase.Skip)Result=Result.Prev;if(Result.Dx==ClipperLib.ClipperBase.horizontal&&Result.Prev.OutIdx!=ClipperLib.ClipperBase.Skip){Horz=Result;while(Horz.Next.Dx==ClipperLib.ClipperBase.horizontal)Horz=Horz.Next;if(Horz.Next.Top.X==Result.Prev.Top.X){if(!LeftBoundIsForward)Result=Horz.Next}else if(Horz.Next.Top.X>Result.Prev.Top.X)Result=Horz.Next}while(E!=Result){E.NextInLML=E.Prev;if(E.Dx==ClipperLib.ClipperBase.horizontal&&E!=EStart&&E.Bot.X!=E.Next.Top.X)this.ReverseHorizontal(E);E=E.Prev}if(E.Dx==ClipperLib.ClipperBase.horizontal&&E!=EStart&&E.Bot.X!=E.Next.Top.X)this.ReverseHorizontal(E);Result=Result.Prev}return Result};ClipperLib.ClipperBase.prototype.AddPath=function(pg,polyType,Closed){if(use_lines){if(!Closed&&polyType==ClipperLib.PolyType.ptClip)ClipperLib.Error("AddPath: Open paths must be subject.")}else{if(!Closed)ClipperLib.Error("AddPath: Open paths have been disabled.")}var highI=pg.length-1;if(Closed)while(0<highI&&ClipperLib.IntPoint.op_Equality(pg[highI],pg[0]))--highI;while(0<highI&&ClipperLib.IntPoint.op_Equality(pg[highI],pg[highI-1]))--highI;if(Closed&&2>highI||!Closed&&1>highI)return false;var edges=new Array;for(var i=0;i<=highI;i++)edges.push(new ClipperLib.TEdge);var IsFlat=true;edges[1].Curr.X=pg[1].X;edges[1].Curr.Y=pg[1].Y;var $1={Value:this.m_UseFullRange};this.RangeTest(pg[0],$1);this.m_UseFullRange=$1.Value;$1.Value=this.m_UseFullRange;this.RangeTest(pg[highI],$1);this.m_UseFullRange=$1.Value;this.InitEdge(edges[0],edges[1],edges[highI],pg[0]);this.InitEdge(edges[highI],edges[0],edges[highI-1],pg[highI]);for(var i=highI-1;1<=i;--i){$1.Value=this.m_UseFullRange;this.RangeTest(pg[i],$1);this.m_UseFullRange=$1.Value;this.InitEdge(edges[i],edges[i+1],edges[i-1],pg[i])}var eStart=edges[0];var E=eStart,eLoopStop=eStart;for(;;){if(E.Curr==E.Next.Curr&&(Closed||E.Next!=eStart)){if(E==E.Next)break;if(E==eStart)eStart=E.Next;E=this.RemoveEdge(E);eLoopStop=E;continue}if(E.Prev==E.Next)break;else if(Closed&&ClipperLib.ClipperBase.SlopesEqual(E.Prev.Curr,E.Curr,E.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(E.Prev.Curr,E.Curr,E.Next.Curr))){if(E==eStart)eStart=E.Next;E=this.RemoveEdge(E);E=E.Prev;eLoopStop=E;continue}E=E.Next;if(E==eLoopStop||!Closed&&E.Next==eStart)break}if(!Closed&&E==E.Next||Closed&&E.Prev==E.Next)return false;if(!Closed){this.m_HasOpenPaths=true;eStart.Prev.OutIdx=ClipperLib.ClipperBase.Skip}E=eStart;do{this.InitEdge2(E,polyType);E=E.Next;if(IsFlat&&E.Curr.Y!=eStart.Curr.Y)IsFlat=false}while(E!=eStart);if(IsFlat){if(Closed)return false;E.Prev.OutIdx=ClipperLib.ClipperBase.Skip;if(E.Prev.Bot.X<E.Prev.Top.X)this.ReverseHorizontal(E.Prev);var locMin=new ClipperLib.LocalMinima;locMin.Next=null;locMin.Y=E.Bot.Y;locMin.LeftBound=null;locMin.RightBound=E;locMin.RightBound.Side=ClipperLib.EdgeSide.esRight;locMin.RightBound.WindDelta=0;while(E.Next.OutIdx!=ClipperLib.ClipperBase.Skip){E.NextInLML=E.Next;if(E.Bot.X!=E.Prev.Top.X)this.ReverseHorizontal(E);E=E.Next}this.InsertLocalMinima(locMin);this.m_edges.push(edges);return true}this.m_edges.push(edges);var leftBoundIsForward;var EMin=null;if(ClipperLib.IntPoint.op_Equality(E.Prev.Bot,E.Prev.Top))E=E.Next;for(;;){E=this.FindNextLocMin(E);if(E==EMin)break;else if(null==EMin)EMin=E;var locMin=new ClipperLib.LocalMinima;locMin.Next=null;locMin.Y=E.Bot.Y;if(E.Dx<E.Prev.Dx){locMin.LeftBound=E.Prev;locMin.RightBound=E;leftBoundIsForward=false}else{locMin.LeftBound=E;locMin.RightBound=E.Prev;leftBoundIsForward=true}locMin.LeftBound.Side=ClipperLib.EdgeSide.esLeft;locMin.RightBound.Side=ClipperLib.EdgeSide.esRight;if(!Closed)locMin.LeftBound.WindDelta=0;else if(locMin.LeftBound.Next==locMin.RightBound)locMin.LeftBound.WindDelta=-1;else locMin.LeftBound.WindDelta=1;locMin.RightBound.WindDelta=-locMin.LeftBound.WindDelta;E=this.ProcessBound(locMin.LeftBound,leftBoundIsForward);if(E.OutIdx==ClipperLib.ClipperBase.Skip)E=this.ProcessBound(E,leftBoundIsForward);var E2=this.ProcessBound(locMin.RightBound,!leftBoundIsForward);if(E2.OutIdx==ClipperLib.ClipperBase.Skip)E2=this.ProcessBound(E2,!leftBoundIsForward);if(locMin.LeftBound.OutIdx==ClipperLib.ClipperBase.Skip)locMin.LeftBound=null;else if(locMin.RightBound.OutIdx==ClipperLib.ClipperBase.Skip)locMin.RightBound=null;this.InsertLocalMinima(locMin);if(!leftBoundIsForward)E=E2}return true};ClipperLib.ClipperBase.prototype.AddPaths=function(ppg,polyType,closed){var result=false;for(var i=0,ilen=ppg.length;i<ilen;++i)if(this.AddPath(ppg[i],polyType,closed))result=true;return result};ClipperLib.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(pt1,pt2,pt3){if(ClipperLib.IntPoint.op_Equality(pt1,pt3)||ClipperLib.IntPoint.op_Equality(pt1,pt2)||ClipperLib.IntPoint.op_Equality(pt3,pt2))return false;else if(pt1.X!=pt3.X)return pt2.X>pt1.X==pt2.X<pt3.X;else return pt2.Y>pt1.Y==pt2.Y<pt3.Y};ClipperLib.ClipperBase.prototype.RemoveEdge=function(e){e.Prev.Next=e.Next;e.Next.Prev=e.Prev;var result=e.Next;e.Prev=null;return result};ClipperLib.ClipperBase.prototype.SetDx=function(e){e.Delta.X=e.Top.X-e.Bot.X;e.Delta.Y=e.Top.Y-e.Bot.Y;if(0===e.Delta.Y)e.Dx=ClipperLib.ClipperBase.horizontal;else e.Dx=e.Delta.X/e.Delta.Y};ClipperLib.ClipperBase.prototype.InsertLocalMinima=function(newLm){if(null===this.m_MinimaList){this.m_MinimaList=newLm}else if(newLm.Y>=this.m_MinimaList.Y){newLm.Next=this.m_MinimaList;this.m_MinimaList=newLm}else{var tmpLm=this.m_MinimaList;while(null!==tmpLm.Next&&newLm.Y<tmpLm.Next.Y)tmpLm=tmpLm.Next;newLm.Next=tmpLm.Next;tmpLm.Next=newLm}};ClipperLib.ClipperBase.prototype.PopLocalMinima=function(){if(null===this.m_CurrentLM)return;this.m_CurrentLM=this.m_CurrentLM.Next};ClipperLib.ClipperBase.prototype.ReverseHorizontal=function(e){var tmp=e.Top.X;e.Top.X=e.Bot.X;e.Bot.X=tmp;if(use_xyz){tmp=e.Top.Z;e.Top.Z=e.Bot.Z;e.Bot.Z=tmp}};ClipperLib.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null==this.m_CurrentLM)return;var lm=this.m_MinimaList;while(null!=lm){var e=lm.LeftBound;if(null!=e){e.Curr.X=e.Bot.X;e.Curr.Y=e.Bot.Y;e.Side=ClipperLib.EdgeSide.esLeft;e.OutIdx=ClipperLib.ClipperBase.Unassigned}e=lm.RightBound;if(null!=e){e.Curr.X=e.Bot.X;e.Curr.Y=e.Bot.Y;e.Side=ClipperLib.EdgeSide.esRight;e.OutIdx=ClipperLib.ClipperBase.Unassigned}lm=lm.Next}};ClipperLib.Clipper=function(InitOptions){if("undefined"==typeof InitOptions)InitOptions=0;this.m_PolyOuts=null;this.m_ClipType=ClipperLib.ClipType.ctIntersection;this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.m_IntersectList=null;this.m_IntersectNodeComparer=null;this.m_ExecuteLocked=false;this.m_ClipFillType=ClipperLib.PolyFillType.pftEvenOdd;this.m_SubjFillType=ClipperLib.PolyFillType.pftEvenOdd;this.m_Joins=null;this.m_GhostJoins=null;this.m_UsingPolyTree=false;this.ReverseSolution=false;this.StrictlySimple=false;ClipperLib.ClipperBase.call(this);this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;this.m_IntersectList=new Array;this.m_IntersectNodeComparer=ClipperLib.MyIntersectNodeSort.Compare;this.m_ExecuteLocked=false;this.m_UsingPolyTree=false;this.m_PolyOuts=new Array;this.m_Joins=new Array;this.m_GhostJoins=new Array;this.ReverseSolution=0!==(1&InitOptions);this.StrictlySimple=0!==(2&InitOptions);this.PreserveCollinear=0!==(4&InitOptions);if(use_xyz){this.ZFillFunction=null}};ClipperLib.Clipper.ioReverseSolution=1;ClipperLib.Clipper.ioStrictlySimple=2;ClipperLib.Clipper.ioPreserveCollinear=4;ClipperLib.Clipper.prototype.Clear=function(){if(0===this.m_edges.length)return;this.DisposeAllPolyPts();ClipperLib.ClipperBase.prototype.Clear.call(this)};ClipperLib.Clipper.prototype.DisposeScanbeamList=function(){while(null!==this.m_Scanbeam){var sb2=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=sb2}};ClipperLib.Clipper.prototype.Reset=function(){ClipperLib.ClipperBase.prototype.Reset.call(this);this.m_Scanbeam=null;this.m_ActiveEdges=null;this.m_SortedEdges=null;var lm=this.m_MinimaList;while(null!==lm){this.InsertScanbeam(lm.Y);lm=lm.Next}};ClipperLib.Clipper.prototype.InsertScanbeam=function(Y){if(null===this.m_Scanbeam){this.m_Scanbeam=new ClipperLib.Scanbeam;this.m_Scanbeam.Next=null;this.m_Scanbeam.Y=Y}else if(Y>this.m_Scanbeam.Y){var newSb=new ClipperLib.Scanbeam;newSb.Y=Y;newSb.Next=this.m_Scanbeam;this.m_Scanbeam=newSb}else{var sb2=this.m_Scanbeam;while(null!==sb2.Next&&Y<=sb2.Next.Y)sb2=sb2.Next;if(Y==sb2.Y)return;var newSb=new ClipperLib.Scanbeam;newSb.Y=Y;newSb.Next=sb2.Next;sb2.Next=newSb}};ClipperLib.Clipper.prototype.Execute=function(){var a=arguments,alen=a.length,ispolytree=a[1]instanceof ClipperLib.PolyTree;if(4==alen&&!ispolytree){var clipType=a[0],solution=a[1],subjFillType=a[2],clipFillType=a[3];if(this.m_ExecuteLocked)return false;if(this.m_HasOpenPaths)ClipperLib.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=true;ClipperLib.Clear(solution);this.m_SubjFillType=subjFillType;this.m_ClipFillType=clipFillType;this.m_ClipType=clipType;this.m_UsingPolyTree=false;try{var succeeded=this.ExecuteInternal();if(succeeded)this.BuildResult(solution)}finally{this.DisposeAllPolyPts();this.m_ExecuteLocked=false}return succeeded}else if(4==alen&&ispolytree){var clipType=a[0],polytree=a[1],subjFillType=a[2],clipFillType=a[3];if(this.m_ExecuteLocked)return false;this.m_ExecuteLocked=true;this.m_SubjFillType=subjFillType;this.m_ClipFillType=clipFillType;this.m_ClipType=clipType;this.m_UsingPolyTree=true;try{var succeeded=this.ExecuteInternal();if(succeeded)this.BuildResult2(polytree)}finally{this.DisposeAllPolyPts();this.m_ExecuteLocked=false}return succeeded}else if(2==alen&&!ispolytree){var clipType=a[0],solution=a[1];return this.Execute(clipType,solution,ClipperLib.PolyFillType.pftEvenOdd,ClipperLib.PolyFillType.pftEvenOdd)}else if(2==alen&&ispolytree){var clipType=a[0],polytree=a[1];return this.Execute(clipType,polytree,ClipperLib.PolyFillType.pftEvenOdd,ClipperLib.PolyFillType.pftEvenOdd)}};ClipperLib.Clipper.prototype.FixHoleLinkage=function(outRec){if(null===outRec.FirstLeft||outRec.IsHole!=outRec.FirstLeft.IsHole&&null!==outRec.FirstLeft.Pts)return;var orfl=outRec.FirstLeft;while(null!==orfl&&(orfl.IsHole==outRec.IsHole||null===orfl.Pts))orfl=orfl.FirstLeft;outRec.FirstLeft=orfl};ClipperLib.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===this.m_CurrentLM)return false;var botY=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(botY);ClipperLib.Clear(this.m_GhostJoins);this.ProcessHorizontals(false);if(null===this.m_Scanbeam)break;var topY=this.PopScanbeam();if(!this.ProcessIntersections(topY))return false;this.ProcessEdgesAtTopOfScanbeam(topY);botY=topY}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec=this.m_PolyOuts[i];if(null===outRec.Pts||outRec.IsOpen)continue;if((outRec.IsHole^this.ReverseSolution)==0<this.Area(outRec))this.ReversePolyPtLinks(outRec.Pts)}this.JoinCommonEdges();for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec=this.m_PolyOuts[i];if(null!==outRec.Pts&&!outRec.IsOpen)this.FixupOutPolygon(outRec)}if(this.StrictlySimple)this.DoSimplePolygons();return true}finally{ClipperLib.Clear(this.m_Joins);ClipperLib.Clear(this.m_GhostJoins)}};ClipperLib.Clipper.prototype.PopScanbeam=function(){var Y=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return Y};ClipperLib.Clipper.prototype.DisposeAllPolyPts=function(){for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;++i)this.DisposeOutRec(i);ClipperLib.Clear(this.m_PolyOuts)};ClipperLib.Clipper.prototype.DisposeOutRec=function(index){var outRec=this.m_PolyOuts[index];outRec.Pts=null;outRec=null;this.m_PolyOuts[index]=null};ClipperLib.Clipper.prototype.AddJoin=function(Op1,Op2,OffPt){var j=new ClipperLib.Join;j.OutPt1=Op1;j.OutPt2=Op2;j.OffPt.X=OffPt.X;j.OffPt.Y=OffPt.Y;this.m_Joins.push(j)};ClipperLib.Clipper.prototype.AddGhostJoin=function(Op,OffPt){var j=new ClipperLib.Join;j.OutPt1=Op;j.OffPt.X=OffPt.X;j.OffPt.Y=OffPt.Y;this.m_GhostJoins.push(j)};if(use_xyz){ClipperLib.Clipper.prototype.SetZ=function(pt,e1,e2){if(null!==this.ZFillFunction){if(0!=pt.Z||null===this.ZFillFunction)return;else if(ClipperLib.IntPoint.op_Equality(pt,e1.Bot))pt.Z=e1.Bot.Z;else if(ClipperLib.IntPoint.op_Equality(pt,e1.Top))pt.Z=e1.Top.Z;else if(ClipperLib.IntPoint.op_Equality(pt,e2.Bot))pt.Z=e2.Bot.Z;else if(ClipperLib.IntPoint.op_Equality(pt,e2.Top))pt.Z=e2.Top.Z;else ZFillFunction(e1.Bot,e1.Top,e2.Bot,e2.Top,pt)}}}ClipperLib.Clipper.prototype.InsertLocalMinimaIntoAEL=function(botY){while(null!==this.m_CurrentLM&&this.m_CurrentLM.Y==botY){var lb=this.m_CurrentLM.LeftBound;var rb=this.m_CurrentLM.RightBound;this.PopLocalMinima();var Op1=null;if(null===lb){this.InsertEdgeIntoAEL(rb,null);this.SetWindingCount(rb);if(this.IsContributing(rb))Op1=this.AddOutPt(rb,rb.Bot)}else if(null==rb){this.InsertEdgeIntoAEL(lb,null);this.SetWindingCount(lb);if(this.IsContributing(lb))Op1=this.AddOutPt(lb,lb.Bot);this.InsertScanbeam(lb.Top.Y)}else{this.InsertEdgeIntoAEL(lb,null);this.InsertEdgeIntoAEL(rb,lb);this.SetWindingCount(lb);rb.WindCnt=lb.WindCnt;rb.WindCnt2=lb.WindCnt2;if(this.IsContributing(lb))Op1=this.AddLocalMinPoly(lb,rb,lb.Bot);this.InsertScanbeam(lb.Top.Y)}if(null!=rb){if(ClipperLib.ClipperBase.IsHorizontal(rb))this.AddEdgeToSEL(rb);else this.InsertScanbeam(rb.Top.Y)}if(null==lb||null==rb)continue;if(null!==Op1&&ClipperLib.ClipperBase.IsHorizontal(rb)&&0<this.m_GhostJoins.length&&0!==rb.WindDelta){for(var i=0,ilen=this.m_GhostJoins.length;i<ilen;i++){var j=this.m_GhostJoins[i];if(this.HorzSegmentsOverlap(j.OutPt1.Pt.X,j.OffPt.X,rb.Bot.X,rb.Top.X))this.AddJoin(j.OutPt1,Op1,j.OffPt)}}if(0<=lb.OutIdx&&null!==lb.PrevInAEL&&lb.PrevInAEL.Curr.X==lb.Bot.X&&0<=lb.PrevInAEL.OutIdx&&ClipperLib.ClipperBase.SlopesEqual(lb.PrevInAEL,lb,this.m_UseFullRange)&&0!==lb.WindDelta&&0!==lb.PrevInAEL.WindDelta){var Op2=this.AddOutPt(lb.PrevInAEL,lb.Bot);this.AddJoin(Op1,Op2,lb.Top)}if(lb.NextInAEL!=rb){if(0<=rb.OutIdx&&0<=rb.PrevInAEL.OutIdx&&ClipperLib.ClipperBase.SlopesEqual(rb.PrevInAEL,rb,this.m_UseFullRange)&&0!==rb.WindDelta&&0!==rb.PrevInAEL.WindDelta){var Op2=this.AddOutPt(rb.PrevInAEL,rb.Bot);this.AddJoin(Op1,Op2,rb.Top)}var e=lb.NextInAEL;if(null!==e)while(e!=rb){this.IntersectEdges(rb,e,lb.Curr,false);e=e.NextInAEL}}}};ClipperLib.Clipper.prototype.InsertEdgeIntoAEL=function(edge,startEdge){if(null===this.m_ActiveEdges){edge.PrevInAEL=null;edge.NextInAEL=null;this.m_ActiveEdges=edge}else if(null===startEdge&&this.E2InsertsBeforeE1(this.m_ActiveEdges,edge)){edge.PrevInAEL=null;edge.NextInAEL=this.m_ActiveEdges;this.m_ActiveEdges.PrevInAEL=edge;this.m_ActiveEdges=edge}else{if(null===startEdge)startEdge=this.m_ActiveEdges;while(null!==startEdge.NextInAEL&&!this.E2InsertsBeforeE1(startEdge.NextInAEL,edge))startEdge=startEdge.NextInAEL;edge.NextInAEL=startEdge.NextInAEL;if(null!==startEdge.NextInAEL)startEdge.NextInAEL.PrevInAEL=edge;edge.PrevInAEL=startEdge;startEdge.NextInAEL=edge}};ClipperLib.Clipper.prototype.E2InsertsBeforeE1=function(e1,e2){if(e2.Curr.X==e1.Curr.X){if(e2.Top.Y>e1.Top.Y)return e2.Top.X<ClipperLib.Clipper.TopX(e1,e2.Top.Y);else return e1.Top.X>ClipperLib.Clipper.TopX(e2,e1.Top.Y)}else return e2.Curr.X<e1.Curr.X};ClipperLib.Clipper.prototype.IsEvenOddFillType=function(edge){if(edge.PolyTyp==ClipperLib.PolyType.ptSubject)return this.m_SubjFillType==ClipperLib.PolyFillType.pftEvenOdd;else return this.m_ClipFillType==ClipperLib.PolyFillType.pftEvenOdd};ClipperLib.Clipper.prototype.IsEvenOddAltFillType=function(edge){if(edge.PolyTyp==ClipperLib.PolyType.ptSubject)return this.m_ClipFillType==ClipperLib.PolyFillType.pftEvenOdd;else return this.m_SubjFillType==ClipperLib.PolyFillType.pftEvenOdd};ClipperLib.Clipper.prototype.IsContributing=function(edge){var pft,pft2;if(edge.PolyTyp==ClipperLib.PolyType.ptSubject){pft=this.m_SubjFillType;pft2=this.m_ClipFillType}else{pft=this.m_ClipFillType;pft2=this.m_SubjFillType}switch(pft){case ClipperLib.PolyFillType.pftEvenOdd:if(0===edge.WindDelta&&1!=edge.WindCnt)return false;break;case ClipperLib.PolyFillType.pftNonZero:if(1!=Math.abs(edge.WindCnt))return false;break;case ClipperLib.PolyFillType.pftPositive:if(1!=edge.WindCnt)return false;break;default:if(-1!=edge.WindCnt)return false;break;}switch(this.m_ClipType){case ClipperLib.ClipType.ctIntersection:switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0!==edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return 0<edge.WindCnt2;default:return 0>edge.WindCnt2;}case ClipperLib.ClipType.ctUnion:switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0===edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return 0>=edge.WindCnt2;default:return 0<=edge.WindCnt2;}case ClipperLib.ClipType.ctDifference:if(edge.PolyTyp==ClipperLib.PolyType.ptSubject)switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0===edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return 0>=edge.WindCnt2;default:return 0<=edge.WindCnt2;}else switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0!==edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return 0<edge.WindCnt2;default:return 0>edge.WindCnt2;}case ClipperLib.ClipType.ctXor:if(0===edge.WindDelta)switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0===edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return 0>=edge.WindCnt2;default:return 0<=edge.WindCnt2;}else return true;}return true};ClipperLib.Clipper.prototype.SetWindingCount=function(edge){var e=edge.PrevInAEL;while(null!==e&&(e.PolyTyp!=edge.PolyTyp||0===e.WindDelta))e=e.PrevInAEL;if(null===e){edge.WindCnt=0===edge.WindDelta?1:edge.WindDelta;edge.WindCnt2=0;e=this.m_ActiveEdges}else if(0===edge.WindDelta&&this.m_ClipType!=ClipperLib.ClipType.ctUnion){edge.WindCnt=1;edge.WindCnt2=e.WindCnt2;e=e.NextInAEL}else if(this.IsEvenOddFillType(edge)){if(0===edge.WindDelta){var Inside=true;var e2=e.PrevInAEL;while(null!==e2){if(e2.PolyTyp==e.PolyTyp&&0!==e2.WindDelta)Inside=!Inside;e2=e2.PrevInAEL}edge.WindCnt=Inside?0:1}else{edge.WindCnt=edge.WindDelta}edge.WindCnt2=e.WindCnt2;e=e.NextInAEL}else{if(0>e.WindCnt*e.WindDelta){if(1<Math.abs(e.WindCnt)){if(0>e.WindDelta*edge.WindDelta)edge.WindCnt=e.WindCnt;else edge.WindCnt=e.WindCnt+edge.WindDelta}else edge.WindCnt=0===edge.WindDelta?1:edge.WindDelta}else{if(0===edge.WindDelta)edge.WindCnt=0>e.WindCnt?e.WindCnt-1:e.WindCnt+1;else if(0>e.WindDelta*edge.WindDelta)edge.WindCnt=e.WindCnt;else edge.WindCnt=e.WindCnt+edge.WindDelta}edge.WindCnt2=e.WindCnt2;e=e.NextInAEL}if(this.IsEvenOddAltFillType(edge)){while(e!=edge){if(0!==e.WindDelta)edge.WindCnt2=0===edge.WindCnt2?1:0;e=e.NextInAEL}}else{while(e!=edge){edge.WindCnt2+=e.WindDelta;e=e.NextInAEL}}};ClipperLib.Clipper.prototype.AddEdgeToSEL=function(edge){if(null===this.m_SortedEdges){this.m_SortedEdges=edge;edge.PrevInSEL=null;edge.NextInSEL=null}else{edge.NextInSEL=this.m_SortedEdges;edge.PrevInSEL=null;this.m_SortedEdges.PrevInSEL=edge;this.m_SortedEdges=edge}};ClipperLib.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;this.m_SortedEdges=e;while(null!==e){e.PrevInSEL=e.PrevInAEL;e.NextInSEL=e.NextInAEL;e=e.NextInAEL}};ClipperLib.Clipper.prototype.SwapPositionsInAEL=function(edge1,edge2){if(edge1.NextInAEL==edge1.PrevInAEL||edge2.NextInAEL==edge2.PrevInAEL)return;if(edge1.NextInAEL==edge2){var next=edge2.NextInAEL;if(null!==next)next.PrevInAEL=edge1;var prev=edge1.PrevInAEL;if(null!==prev)prev.NextInAEL=edge2;edge2.PrevInAEL=prev;edge2.NextInAEL=edge1;edge1.PrevInAEL=edge2;edge1.NextInAEL=next}else if(edge2.NextInAEL==edge1){var next=edge1.NextInAEL;if(null!==next)next.PrevInAEL=edge2;var prev=edge2.PrevInAEL;if(null!==prev)prev.NextInAEL=edge1;edge1.PrevInAEL=prev;edge1.NextInAEL=edge2;edge2.PrevInAEL=edge1;edge2.NextInAEL=next}else{var next=edge1.NextInAEL;var prev=edge1.PrevInAEL;edge1.NextInAEL=edge2.NextInAEL;if(null!==edge1.NextInAEL)edge1.NextInAEL.PrevInAEL=edge1;edge1.PrevInAEL=edge2.PrevInAEL;if(null!==edge1.PrevInAEL)edge1.PrevInAEL.NextInAEL=edge1;edge2.NextInAEL=next;if(null!==edge2.NextInAEL)edge2.NextInAEL.PrevInAEL=edge2;edge2.PrevInAEL=prev;if(null!==edge2.PrevInAEL)edge2.PrevInAEL.NextInAEL=edge2}if(null===edge1.PrevInAEL)this.m_ActiveEdges=edge1;else if(null===edge2.PrevInAEL)this.m_ActiveEdges=edge2};ClipperLib.Clipper.prototype.SwapPositionsInSEL=function(edge1,edge2){if(null===edge1.NextInSEL&&null===edge1.PrevInSEL)return;if(null===edge2.NextInSEL&&null===edge2.PrevInSEL)return;if(edge1.NextInSEL==edge2){var next=edge2.NextInSEL;if(null!==next)next.PrevInSEL=edge1;var prev=edge1.PrevInSEL;if(null!==prev)prev.NextInSEL=edge2;edge2.PrevInSEL=prev;edge2.NextInSEL=edge1;edge1.PrevInSEL=edge2;edge1.NextInSEL=next}else if(edge2.NextInSEL==edge1){var next=edge1.NextInSEL;if(null!==next)next.PrevInSEL=edge2;var prev=edge2.PrevInSEL;if(null!==prev)prev.NextInSEL=edge1;edge1.PrevInSEL=prev;edge1.NextInSEL=edge2;edge2.PrevInSEL=edge1;edge2.NextInSEL=next}else{var next=edge1.NextInSEL;var prev=edge1.PrevInSEL;edge1.NextInSEL=edge2.NextInSEL;if(null!==edge1.NextInSEL)edge1.NextInSEL.PrevInSEL=edge1;edge1.PrevInSEL=edge2.PrevInSEL;if(null!==edge1.PrevInSEL)edge1.PrevInSEL.NextInSEL=edge1;edge2.NextInSEL=next;if(null!==edge2.NextInSEL)edge2.NextInSEL.PrevInSEL=edge2;edge2.PrevInSEL=prev;if(null!==edge2.PrevInSEL)edge2.PrevInSEL.NextInSEL=edge2}if(null===edge1.PrevInSEL)this.m_SortedEdges=edge1;else if(null===edge2.PrevInSEL)this.m_SortedEdges=edge2};ClipperLib.Clipper.prototype.AddLocalMaxPoly=function(e1,e2,pt){this.AddOutPt(e1,pt);if(0==e2.WindDelta)this.AddOutPt(e2,pt);if(e1.OutIdx==e2.OutIdx){e1.OutIdx=-1;e2.OutIdx=-1}else if(e1.OutIdx<e2.OutIdx)this.AppendPolygon(e1,e2);else this.AppendPolygon(e2,e1)};ClipperLib.Clipper.prototype.AddLocalMinPoly=function(e1,e2,pt){var result;var e,prevE;if(ClipperLib.ClipperBase.IsHorizontal(e2)||e1.Dx>e2.Dx){result=this.AddOutPt(e1,pt);e2.OutIdx=e1.OutIdx;e1.Side=ClipperLib.EdgeSide.esLeft;e2.Side=ClipperLib.EdgeSide.esRight;e=e1;if(e.PrevInAEL==e2)prevE=e2.PrevInAEL;else prevE=e.PrevInAEL}else{result=this.AddOutPt(e2,pt);e1.OutIdx=e2.OutIdx;e1.Side=ClipperLib.EdgeSide.esRight;e2.Side=ClipperLib.EdgeSide.esLeft;e=e2;if(e.PrevInAEL==e1)prevE=e1.PrevInAEL;else prevE=e.PrevInAEL}if(null!==prevE&&0<=prevE.OutIdx&&ClipperLib.Clipper.TopX(prevE,pt.Y)==ClipperLib.Clipper.TopX(e,pt.Y)&&ClipperLib.ClipperBase.SlopesEqual(e,prevE,this.m_UseFullRange)&&0!==e.WindDelta&&0!==prevE.WindDelta){var outPt=this.AddOutPt(prevE,pt);this.AddJoin(result,outPt,e.Top)}return result};ClipperLib.Clipper.prototype.CreateOutRec=function(){var result=new ClipperLib.OutRec;result.Idx=-1;result.IsHole=false;result.IsOpen=false;result.FirstLeft=null;result.Pts=null;result.BottomPt=null;result.PolyNode=null;this.m_PolyOuts.push(result);result.Idx=this.m_PolyOuts.length-1;return result};ClipperLib.Clipper.prototype.AddOutPt=function(e,pt){var ToFront=e.Side==ClipperLib.EdgeSide.esLeft;if(0>e.OutIdx){var outRec=this.CreateOutRec();outRec.IsOpen=0===e.WindDelta;var newOp=new ClipperLib.OutPt;outRec.Pts=newOp;newOp.Idx=outRec.Idx;newOp.Pt.X=pt.X;newOp.Pt.Y=pt.Y;newOp.Next=newOp;newOp.Prev=newOp;if(!outRec.IsOpen)this.SetHoleState(e,outRec);e.OutIdx=outRec.Idx;return newOp}else{var outRec=this.m_PolyOuts[e.OutIdx];var op=outRec.Pts;if(ToFront&&ClipperLib.IntPoint.op_Equality(pt,op.Pt))return op;else if(!ToFront&&ClipperLib.IntPoint.op_Equality(pt,op.Prev.Pt))return op.Prev;var newOp=new ClipperLib.OutPt;newOp.Idx=outRec.Idx;newOp.Pt.X=pt.X;newOp.Pt.Y=pt.Y;newOp.Next=op;newOp.Prev=op.Prev;newOp.Prev.Next=newOp;op.Prev=newOp;if(ToFront)outRec.Pts=newOp;return newOp}};ClipperLib.Clipper.prototype.SwapPoints=function(pt1,pt2){var tmp=new ClipperLib.IntPoint(pt1.Value);pt1.Value.X=pt2.Value.X;pt1.Value.Y=pt2.Value.Y;pt2.Value.X=tmp.X;pt2.Value.Y=tmp.Y};ClipperLib.Clipper.prototype.HorzSegmentsOverlap=function(seg1a,seg1b,seg2a,seg2b){var tmp;if(seg1a>seg1b){tmp=seg1a;seg1a=seg1b;seg1b=tmp}if(seg2a>seg2b){tmp=seg2a;seg2a=seg2b;seg2b=tmp}return seg1a<seg2b&&seg2a<seg1b};ClipperLib.Clipper.prototype.SetHoleState=function(e,outRec){var isHole=false;var e2=e.PrevInAEL;while(null!==e2){if(0<=e2.OutIdx&&0!=e2.WindDelta){isHole=!isHole;if(null===outRec.FirstLeft)outRec.FirstLeft=this.m_PolyOuts[e2.OutIdx]}e2=e2.PrevInAEL}if(isHole)outRec.IsHole=true};ClipperLib.Clipper.prototype.GetDx=function(pt1,pt2){if(pt1.Y==pt2.Y)return ClipperLib.ClipperBase.horizontal;else return(pt2.X-pt1.X)/(pt2.Y-pt1.Y)};ClipperLib.Clipper.prototype.FirstIsBottomPt=function(btmPt1,btmPt2){var p=btmPt1.Prev;while(ClipperLib.IntPoint.op_Equality(p.Pt,btmPt1.Pt)&&p!=btmPt1)p=p.Prev;var dx1p=Math.abs(this.GetDx(btmPt1.Pt,p.Pt));p=btmPt1.Next;while(ClipperLib.IntPoint.op_Equality(p.Pt,btmPt1.Pt)&&p!=btmPt1)p=p.Next;var dx1n=Math.abs(this.GetDx(btmPt1.Pt,p.Pt));p=btmPt2.Prev;while(ClipperLib.IntPoint.op_Equality(p.Pt,btmPt2.Pt)&&p!=btmPt2)p=p.Prev;var dx2p=Math.abs(this.GetDx(btmPt2.Pt,p.Pt));p=btmPt2.Next;while(ClipperLib.IntPoint.op_Equality(p.Pt,btmPt2.Pt)&&p!=btmPt2)p=p.Next;var dx2n=Math.abs(this.GetDx(btmPt2.Pt,p.Pt));return dx1p>=dx2p&&dx1p>=dx2n||dx1n>=dx2p&&dx1n>=dx2n};ClipperLib.Clipper.prototype.GetBottomPt=function(pp){var dups=null;var p=pp.Next;while(p!=pp){if(p.Pt.Y>pp.Pt.Y){pp=p;dups=null}else if(p.Pt.Y==pp.Pt.Y&&p.Pt.X<=pp.Pt.X){if(p.Pt.X<pp.Pt.X){dups=null;pp=p}else{if(p.Next!=pp&&p.Prev!=pp)dups=p}}p=p.Next}if(null!==dups){while(dups!=p){if(!this.FirstIsBottomPt(p,dups))pp=dups;dups=dups.Next;while(ClipperLib.IntPoint.op_Inequality(dups.Pt,pp.Pt))dups=dups.Next}}return pp};ClipperLib.Clipper.prototype.GetLowermostRec=function(outRec1,outRec2){if(null===outRec1.BottomPt)outRec1.BottomPt=this.GetBottomPt(outRec1.Pts);if(null===outRec2.BottomPt)outRec2.BottomPt=this.GetBottomPt(outRec2.Pts);var bPt1=outRec1.BottomPt;var bPt2=outRec2.BottomPt;if(bPt1.Pt.Y>bPt2.Pt.Y)return outRec1;else if(bPt1.Pt.Y<bPt2.Pt.Y)return outRec2;else if(bPt1.Pt.X<bPt2.Pt.X)return outRec1;else if(bPt1.Pt.X>bPt2.Pt.X)return outRec2;else if(bPt1.Next==bPt1)return outRec2;else if(bPt2.Next==bPt2)return outRec1;else if(this.FirstIsBottomPt(bPt1,bPt2))return outRec1;else return outRec2};ClipperLib.Clipper.prototype.Param1RightOfParam2=function(outRec1,outRec2){do{outRec1=outRec1.FirstLeft;if(outRec1==outRec2)return true}while(null!==outRec1);return false};ClipperLib.Clipper.prototype.GetOutRec=function(idx){var outrec=this.m_PolyOuts[idx];while(outrec!=this.m_PolyOuts[outrec.Idx])outrec=this.m_PolyOuts[outrec.Idx];return outrec};ClipperLib.Clipper.prototype.AppendPolygon=function(e1,e2){var outRec1=this.m_PolyOuts[e1.OutIdx];var outRec2=this.m_PolyOuts[e2.OutIdx];var holeStateRec;if(this.Param1RightOfParam2(outRec1,outRec2))holeStateRec=outRec2;else if(this.Param1RightOfParam2(outRec2,outRec1))holeStateRec=outRec1;else holeStateRec=this.GetLowermostRec(outRec1,outRec2);var p1_lft=outRec1.Pts;var p1_rt=p1_lft.Prev;var p2_lft=outRec2.Pts;var p2_rt=p2_lft.Prev;var side;if(e1.Side==ClipperLib.EdgeSide.esLeft){if(e2.Side==ClipperLib.EdgeSide.esLeft){this.ReversePolyPtLinks(p2_lft);p2_lft.Next=p1_lft;p1_lft.Prev=p2_lft;p1_rt.Next=p2_rt;p2_rt.Prev=p1_rt;outRec1.Pts=p2_rt}else{p2_rt.Next=p1_lft;p1_lft.Prev=p2_rt;p2_lft.Prev=p1_rt;p1_rt.Next=p2_lft;outRec1.Pts=p2_lft}side=ClipperLib.EdgeSide.esLeft}else{if(e2.Side==ClipperLib.EdgeSide.esRight){this.ReversePolyPtLinks(p2_lft);p1_rt.Next=p2_rt;p2_rt.Prev=p1_rt;p2_lft.Next=p1_lft;p1_lft.Prev=p2_lft}else{p1_rt.Next=p2_lft;p2_lft.Prev=p1_rt;p1_lft.Prev=p2_rt;p2_rt.Next=p1_lft}side=ClipperLib.EdgeSide.esRight}outRec1.BottomPt=null;if(holeStateRec==outRec2){if(outRec2.FirstLeft!=outRec1)outRec1.FirstLeft=outRec2.FirstLeft;outRec1.IsHole=outRec2.IsHole}outRec2.Pts=null;outRec2.BottomPt=null;outRec2.FirstLeft=outRec1;var OKIdx=e1.OutIdx;var ObsoleteIdx=e2.OutIdx;e1.OutIdx=-1;e2.OutIdx=-1;var e=this.m_ActiveEdges;while(null!==e){if(e.OutIdx==ObsoleteIdx){e.OutIdx=OKIdx;e.Side=side;break}e=e.NextInAEL}outRec2.Idx=outRec1.Idx};ClipperLib.Clipper.prototype.ReversePolyPtLinks=function(pp){if(null===pp)return;var pp1;var pp2;pp1=pp;do{pp2=pp1.Next;pp1.Next=pp1.Prev;pp1.Prev=pp2;pp1=pp2}while(pp1!=pp)};ClipperLib.Clipper.SwapSides=function(edge1,edge2){var side=edge1.Side;edge1.Side=edge2.Side;edge2.Side=side};ClipperLib.Clipper.SwapPolyIndexes=function(edge1,edge2){var outIdx=edge1.OutIdx;edge1.OutIdx=edge2.OutIdx;edge2.OutIdx=outIdx};ClipperLib.Clipper.prototype.IntersectEdges=function(e1,e2,pt){var e1Contributing=0<=e1.OutIdx;var e2Contributing=0<=e2.OutIdx;if(use_xyz)this.SetZ(pt,e1,e2);if(use_lines){if(0===e1.WindDelta||0===e2.WindDelta){if(0==e1.WindDelta&&0==e2.WindDelta)return;else if(e1.PolyTyp==e2.PolyTyp&&e1.WindDelta!=e2.WindDelta&&this.m_ClipType==ClipperLib.ClipType.ctUnion){if(0===e1.WindDelta){if(e2Contributing){this.AddOutPt(e1,pt);if(e1Contributing)e1.OutIdx=-1}}else{if(e1Contributing){this.AddOutPt(e2,pt);if(e2Contributing)e2.OutIdx=-1}}}else if(e1.PolyTyp!=e2.PolyTyp){if(0===e1.WindDelta&&1==Math.abs(e2.WindCnt)&&(this.m_ClipType!=ClipperLib.ClipType.ctUnion||0===e2.WindCnt2)){this.AddOutPt(e1,pt);if(e1Contributing)e1.OutIdx=-1}else if(0===e2.WindDelta&&1==Math.abs(e1.WindCnt)&&(this.m_ClipType!=ClipperLib.ClipType.ctUnion||0===e1.WindCnt2)){this.AddOutPt(e2,pt);if(e2Contributing)e2.OutIdx=-1}}return}}if(e1.PolyTyp==e2.PolyTyp){if(this.IsEvenOddFillType(e1)){var oldE1WindCnt=e1.WindCnt;e1.WindCnt=e2.WindCnt;e2.WindCnt=oldE1WindCnt}else{if(0===e1.WindCnt+e2.WindDelta)e1.WindCnt=-e1.WindCnt;else e1.WindCnt+=e2.WindDelta;if(0===e2.WindCnt-e1.WindDelta)e2.WindCnt=-e2.WindCnt;else e2.WindCnt-=e1.WindDelta}}else{if(!this.IsEvenOddFillType(e2))e1.WindCnt2+=e2.WindDelta;else e1.WindCnt2=0===e1.WindCnt2?1:0;if(!this.IsEvenOddFillType(e1))e2.WindCnt2-=e1.WindDelta;else e2.WindCnt2=0===e2.WindCnt2?1:0}var e1FillType,e2FillType,e1FillType2,e2FillType2;if(e1.PolyTyp==ClipperLib.PolyType.ptSubject){e1FillType=this.m_SubjFillType;e1FillType2=this.m_ClipFillType}else{e1FillType=this.m_ClipFillType;e1FillType2=this.m_SubjFillType}if(e2.PolyTyp==ClipperLib.PolyType.ptSubject){e2FillType=this.m_SubjFillType;e2FillType2=this.m_ClipFillType}else{e2FillType=this.m_ClipFillType;e2FillType2=this.m_SubjFillType}var e1Wc,e2Wc;switch(e1FillType){case ClipperLib.PolyFillType.pftPositive:e1Wc=e1.WindCnt;break;case ClipperLib.PolyFillType.pftNegative:e1Wc=-e1.WindCnt;break;default:e1Wc=Math.abs(e1.WindCnt);break;}switch(e2FillType){case ClipperLib.PolyFillType.pftPositive:e2Wc=e2.WindCnt;break;case ClipperLib.PolyFillType.pftNegative:e2Wc=-e2.WindCnt;break;default:e2Wc=Math.abs(e2.WindCnt);break;}if(e1Contributing&&e2Contributing){if(0!=e1Wc&&1!=e1Wc||0!=e2Wc&&1!=e2Wc||e1.PolyTyp!=e2.PolyTyp&&this.m_ClipType!=ClipperLib.ClipType.ctXor){this.AddLocalMaxPoly(e1,e2,pt)}else{this.AddOutPt(e1,pt);this.AddOutPt(e2,pt);ClipperLib.Clipper.SwapSides(e1,e2);ClipperLib.Clipper.SwapPolyIndexes(e1,e2)}}else if(e1Contributing){if(0===e2Wc||1==e2Wc){this.AddOutPt(e1,pt);ClipperLib.Clipper.SwapSides(e1,e2);ClipperLib.Clipper.SwapPolyIndexes(e1,e2)}}else if(e2Contributing){if(0===e1Wc||1==e1Wc){this.AddOutPt(e2,pt);ClipperLib.Clipper.SwapSides(e1,e2);ClipperLib.Clipper.SwapPolyIndexes(e1,e2)}}else if((0==e1Wc||1==e1Wc)&&(0==e2Wc||1==e2Wc)){var e1Wc2,e2Wc2;switch(e1FillType2){case ClipperLib.PolyFillType.pftPositive:e1Wc2=e1.WindCnt2;break;case ClipperLib.PolyFillType.pftNegative:e1Wc2=-e1.WindCnt2;break;default:e1Wc2=Math.abs(e1.WindCnt2);break;}switch(e2FillType2){case ClipperLib.PolyFillType.pftPositive:e2Wc2=e2.WindCnt2;break;case ClipperLib.PolyFillType.pftNegative:e2Wc2=-e2.WindCnt2;break;default:e2Wc2=Math.abs(e2.WindCnt2);break;}if(e1.PolyTyp!=e2.PolyTyp){this.AddLocalMinPoly(e1,e2,pt)}else if(1==e1Wc&&1==e2Wc)switch(this.m_ClipType){case ClipperLib.ClipType.ctIntersection:if(0<e1Wc2&&0<e2Wc2)this.AddLocalMinPoly(e1,e2,pt);break;case ClipperLib.ClipType.ctUnion:if(0>=e1Wc2&&0>=e2Wc2)this.AddLocalMinPoly(e1,e2,pt);break;case ClipperLib.ClipType.ctDifference:if(e1.PolyTyp==ClipperLib.PolyType.ptClip&&0<e1Wc2&&0<e2Wc2||e1.PolyTyp==ClipperLib.PolyType.ptSubject&&0>=e1Wc2&&0>=e2Wc2)this.AddLocalMinPoly(e1,e2,pt);break;case ClipperLib.ClipType.ctXor:this.AddLocalMinPoly(e1,e2,pt);break;}else ClipperLib.Clipper.SwapSides(e1,e2)}};ClipperLib.Clipper.prototype.DeleteFromAEL=function(e){var AelPrev=e.PrevInAEL;var AelNext=e.NextInAEL;if(null===AelPrev&&null===AelNext&&e!=this.m_ActiveEdges)return;if(null!==AelPrev)AelPrev.NextInAEL=AelNext;else this.m_ActiveEdges=AelNext;if(null!==AelNext)AelNext.PrevInAEL=AelPrev;e.NextInAEL=null;e.PrevInAEL=null};ClipperLib.Clipper.prototype.DeleteFromSEL=function(e){var SelPrev=e.PrevInSEL;var SelNext=e.NextInSEL;if(null===SelPrev&&null===SelNext&&e!=this.m_SortedEdges)return;if(null!==SelPrev)SelPrev.NextInSEL=SelNext;else this.m_SortedEdges=SelNext;if(null!==SelNext)SelNext.PrevInSEL=SelPrev;e.NextInSEL=null;e.PrevInSEL=null};ClipperLib.Clipper.prototype.UpdateEdgeIntoAEL=function(e){if(null===e.NextInLML)ClipperLib.Error("UpdateEdgeIntoAEL: invalid call");var AelPrev=e.PrevInAEL;var AelNext=e.NextInAEL;e.NextInLML.OutIdx=e.OutIdx;if(null!==AelPrev)AelPrev.NextInAEL=e.NextInLML;else this.m_ActiveEdges=e.NextInLML;if(null!==AelNext)AelNext.PrevInAEL=e.NextInLML;e.NextInLML.Side=e.Side;e.NextInLML.WindDelta=e.WindDelta;e.NextInLML.WindCnt=e.WindCnt;e.NextInLML.WindCnt2=e.WindCnt2;e=e.NextInLML;e.Curr.X=e.Bot.X;e.Curr.Y=e.Bot.Y;e.PrevInAEL=AelPrev;e.NextInAEL=AelNext;if(!ClipperLib.ClipperBase.IsHorizontal(e))this.InsertScanbeam(e.Top.Y);return e};ClipperLib.Clipper.prototype.ProcessHorizontals=function(isTopOfScanbeam){var horzEdge=this.m_SortedEdges;while(null!==horzEdge){this.DeleteFromSEL(horzEdge);this.ProcessHorizontal(horzEdge,isTopOfScanbeam);horzEdge=this.m_SortedEdges}};ClipperLib.Clipper.prototype.GetHorzDirection=function(HorzEdge,$var){if(HorzEdge.Bot.X<HorzEdge.Top.X){$var.Left=HorzEdge.Bot.X;$var.Right=HorzEdge.Top.X;$var.Dir=ClipperLib.Direction.dLeftToRight}else{$var.Left=HorzEdge.Top.X;$var.Right=HorzEdge.Bot.X;$var.Dir=ClipperLib.Direction.dRightToLeft}};ClipperLib.Clipper.prototype.ProcessHorizontal=function(horzEdge,isTopOfScanbeam){var $var={Dir:null,Left:null,Right:null};this.GetHorzDirection(horzEdge,$var);var dir=$var.Dir;var horzLeft=$var.Left;var horzRight=$var.Right;var eLastHorz=horzEdge,eMaxPair=null;while(null!==eLastHorz.NextInLML&&ClipperLib.ClipperBase.IsHorizontal(eLastHorz.NextInLML))eLastHorz=eLastHorz.NextInLML;if(null===eLastHorz.NextInLML)eMaxPair=this.GetMaximaPair(eLastHorz);for(;;){var IsLastHorz=horzEdge==eLastHorz;var e=this.GetNextInAEL(horzEdge,dir);while(null!==e){if(e.Curr.X==horzEdge.Top.X&&null!==horzEdge.NextInLML&&e.Dx<horzEdge.NextInLML.Dx)break;var eNext=this.GetNextInAEL(e,dir);if(dir==ClipperLib.Direction.dLeftToRight&&e.Curr.X<=horzRight||dir==ClipperLib.Direction.dRightToLeft&&e.Curr.X>=horzLeft){if(e==eMaxPair&&IsLastHorz){if(0<=horzEdge.OutIdx){var op1=this.AddOutPt(horzEdge,horzEdge.Top);var eNextHorz=this.m_SortedEdges;while(null!==eNextHorz){if(0<=eNextHorz.OutIdx&&this.HorzSegmentsOverlap(horzEdge.Bot.X,horzEdge.Top.X,eNextHorz.Bot.X,eNextHorz.Top.X)){var op2=this.AddOutPt(eNextHorz,eNextHorz.Bot);this.AddJoin(op2,op1,eNextHorz.Top)}eNextHorz=eNextHorz.NextInSEL}this.AddGhostJoin(op1,horzEdge.Bot);this.AddLocalMaxPoly(horzEdge,eMaxPair,horzEdge.Top)}this.DeleteFromAEL(horzEdge);this.DeleteFromAEL(eMaxPair);return}else if(dir==ClipperLib.Direction.dLeftToRight){var Pt=new ClipperLib.IntPoint(e.Curr.X,horzEdge.Curr.Y);this.IntersectEdges(horzEdge,e,Pt)}else{var Pt=new ClipperLib.IntPoint(e.Curr.X,horzEdge.Curr.Y);this.IntersectEdges(e,horzEdge,Pt)}this.SwapPositionsInAEL(horzEdge,e)}else if(dir==ClipperLib.Direction.dLeftToRight&&e.Curr.X>=horzRight||dir==ClipperLib.Direction.dRightToLeft&&e.Curr.X<=horzLeft)break;e=eNext}if(null!==horzEdge.NextInLML&&ClipperLib.ClipperBase.IsHorizontal(horzEdge.NextInLML)){horzEdge=this.UpdateEdgeIntoAEL(horzEdge);if(0<=horzEdge.OutIdx)this.AddOutPt(horzEdge,horzEdge.Bot);var $var={Dir:dir,Left:horzLeft,Right:horzRight};this.GetHorzDirection(horzEdge,$var);dir=$var.Dir;horzLeft=$var.Left;horzRight=$var.Right}else break}if(null!==horzEdge.NextInLML){if(0<=horzEdge.OutIdx){var op1=this.AddOutPt(horzEdge,horzEdge.Top);if(isTopOfScanbeam)this.AddGhostJoin(op1,horzEdge.Bot);horzEdge=this.UpdateEdgeIntoAEL(horzEdge);if(0===horzEdge.WindDelta)return;var ePrev=horzEdge.PrevInAEL;var eNext=horzEdge.NextInAEL;if(null!==ePrev&&ePrev.Curr.X==horzEdge.Bot.X&&ePrev.Curr.Y==horzEdge.Bot.Y&&0!==ePrev.WindDelta&&0<=ePrev.OutIdx&&ePrev.Curr.Y>ePrev.Top.Y&&ClipperLib.ClipperBase.SlopesEqual(horzEdge,ePrev,this.m_UseFullRange)){var op2=this.AddOutPt(ePrev,horzEdge.Bot);this.AddJoin(op1,op2,horzEdge.Top)}else if(null!==eNext&&eNext.Curr.X==horzEdge.Bot.X&&eNext.Curr.Y==horzEdge.Bot.Y&&0!==eNext.WindDelta&&0<=eNext.OutIdx&&eNext.Curr.Y>eNext.Top.Y&&ClipperLib.ClipperBase.SlopesEqual(horzEdge,eNext,this.m_UseFullRange)){var op2=this.AddOutPt(eNext,horzEdge.Bot);this.AddJoin(op1,op2,horzEdge.Top)}}else horzEdge=this.UpdateEdgeIntoAEL(horzEdge)}else{if(0<=horzEdge.OutIdx)this.AddOutPt(horzEdge,horzEdge.Top);this.DeleteFromAEL(horzEdge)}};ClipperLib.Clipper.prototype.GetNextInAEL=function(e,Direction){return Direction==ClipperLib.Direction.dLeftToRight?e.NextInAEL:e.PrevInAEL};ClipperLib.Clipper.prototype.IsMinima=function(e){return null!==e&&e.Prev.NextInLML!=e&&e.Next.NextInLML!=e};ClipperLib.Clipper.prototype.IsMaxima=function(e,Y){return null!==e&&e.Top.Y==Y&&null===e.NextInLML};ClipperLib.Clipper.prototype.IsIntermediate=function(e,Y){return e.Top.Y==Y&&null!==e.NextInLML};ClipperLib.Clipper.prototype.GetMaximaPair=function(e){var result=null;if(ClipperLib.IntPoint.op_Equality(e.Next.Top,e.Top)&&null===e.Next.NextInLML)result=e.Next;else if(ClipperLib.IntPoint.op_Equality(e.Prev.Top,e.Top)&&null===e.Prev.NextInLML)result=e.Prev;if(null!==result&&(-2==result.OutIdx||result.NextInAEL==result.PrevInAEL&&!ClipperLib.ClipperBase.IsHorizontal(result)))return null;return result};ClipperLib.Clipper.prototype.ProcessIntersections=function(topY){if(null==this.m_ActiveEdges)return true;try{this.BuildIntersectList(topY);if(0==this.m_IntersectList.length)return true;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return false}catch($$e2){this.m_SortedEdges=null;this.m_IntersectList.length=0;ClipperLib.Error("ProcessIntersections error")}this.m_SortedEdges=null;return true};ClipperLib.Clipper.prototype.BuildIntersectList=function(topY){if(null===this.m_ActiveEdges)return;var e=this.m_ActiveEdges;this.m_SortedEdges=e;while(null!==e){e.PrevInSEL=e.PrevInAEL;e.NextInSEL=e.NextInAEL;e.Curr.X=ClipperLib.Clipper.TopX(e,topY);e=e.NextInAEL}var isModified=true;while(isModified&&null!==this.m_SortedEdges){isModified=false;e=this.m_SortedEdges;while(null!==e.NextInSEL){var eNext=e.NextInSEL;var pt=new ClipperLib.IntPoint;if(e.Curr.X>eNext.Curr.X){this.IntersectPoint(e,eNext,pt);var newNode=new ClipperLib.IntersectNode;newNode.Edge1=e;newNode.Edge2=eNext;newNode.Pt.X=pt.X;newNode.Pt.Y=pt.Y;this.m_IntersectList.push(newNode);this.SwapPositionsInSEL(e,eNext);isModified=true}else e=eNext}if(null!==e.PrevInSEL)e.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null};ClipperLib.Clipper.prototype.EdgesAdjacent=function(inode){return inode.Edge1.NextInSEL==inode.Edge2||inode.Edge1.PrevInSEL==inode.Edge2};ClipperLib.Clipper.IntersectNodeSort=function(node1,node2){return node2.Pt.Y-node1.Pt.Y};ClipperLib.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();var cnt=this.m_IntersectList.length;for(var i=0;i<cnt;i++){if(!this.EdgesAdjacent(this.m_IntersectList[i])){var j=i+1;while(j<cnt&&!this.EdgesAdjacent(this.m_IntersectList[j]))j++;if(j==cnt)return false;var tmp=this.m_IntersectList[i];this.m_IntersectList[i]=this.m_IntersectList[j];this.m_IntersectList[j]=tmp}this.SwapPositionsInSEL(this.m_IntersectList[i].Edge1,this.m_IntersectList[i].Edge2)}return true};ClipperLib.Clipper.prototype.ProcessIntersectList=function(){for(var i=0,ilen=this.m_IntersectList.length;i<ilen;i++){var iNode=this.m_IntersectList[i];this.IntersectEdges(iNode.Edge1,iNode.Edge2,iNode.Pt);this.SwapPositionsInAEL(iNode.Edge1,iNode.Edge2)}this.m_IntersectList.length=0};var R1=function(a){return 0>a?Math.ceil(a-0.5):Math.round(a)};var R2=function(a){return 0>a?Math.ceil(a-0.5):Math.floor(a+0.5)};var R3=function(a){return 0>a?-Math.round(Math.abs(a)):Math.round(a)};var R4=function(a){if(0>a){a-=0.5;return-2147483648>a?Math.ceil(a):0|a}else{a+=0.5;return 2147483647<a?Math.floor(a):0|a}};if(browser.msie)ClipperLib.Clipper.Round=R1;else if(browser.chromium)ClipperLib.Clipper.Round=R3;else if(browser.safari)ClipperLib.Clipper.Round=R4;else ClipperLib.Clipper.Round=R2;ClipperLib.Clipper.TopX=function(edge,currentY){if(currentY==edge.Top.Y)return edge.Top.X;return edge.Bot.X+ClipperLib.Clipper.Round(edge.Dx*(currentY-edge.Bot.Y))};ClipperLib.Clipper.prototype.IntersectPoint=function(edge1,edge2,ip){ip.X=0;ip.Y=0;var b1,b2;if(edge1.Dx==edge2.Dx){ip.Y=edge1.Curr.Y;ip.X=ClipperLib.Clipper.TopX(edge1,ip.Y);return}if(0===edge1.Delta.X){ip.X=edge1.Bot.X;if(ClipperLib.ClipperBase.IsHorizontal(edge2)){ip.Y=edge2.Bot.Y}else{b2=edge2.Bot.Y-edge2.Bot.X/edge2.Dx;ip.Y=ClipperLib.Clipper.Round(ip.X/edge2.Dx+b2)}}else if(0===edge2.Delta.X){ip.X=edge2.Bot.X;if(ClipperLib.ClipperBase.IsHorizontal(edge1)){ip.Y=edge1.Bot.Y}else{b1=edge1.Bot.Y-edge1.Bot.X/edge1.Dx;ip.Y=ClipperLib.Clipper.Round(ip.X/edge1.Dx+b1)}}else{b1=edge1.Bot.X-edge1.Bot.Y*edge1.Dx;b2=edge2.Bot.X-edge2.Bot.Y*edge2.Dx;var q=(b2-b1)/(edge1.Dx-edge2.Dx);ip.Y=ClipperLib.Clipper.Round(q);if(Math.abs(edge1.Dx)<Math.abs(edge2.Dx))ip.X=ClipperLib.Clipper.Round(edge1.Dx*q+b1);else ip.X=ClipperLib.Clipper.Round(edge2.Dx*q+b2)}if(ip.Y<edge1.Top.Y||ip.Y<edge2.Top.Y){if(edge1.Top.Y>edge2.Top.Y){ip.Y=edge1.Top.Y;ip.X=ClipperLib.Clipper.TopX(edge2,edge1.Top.Y);return ip.X<edge1.Top.X}else ip.Y=edge2.Top.Y;if(Math.abs(edge1.Dx)<Math.abs(edge2.Dx))ip.X=ClipperLib.Clipper.TopX(edge1,ip.Y);else ip.X=ClipperLib.Clipper.TopX(edge2,ip.Y)}if(ip.Y>edge1.Curr.Y){ip.Y=edge1.Curr.Y;if(Math.abs(edge1.Dx)>Math.abs(edge2.Dx))ip.X=ClipperLib.Clipper.TopX(edge2,ip.Y);else ip.X=ClipperLib.Clipper.TopX(edge1,ip.Y)}};ClipperLib.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(topY){var e=this.m_ActiveEdges;while(null!==e){var IsMaximaEdge=this.IsMaxima(e,topY);if(IsMaximaEdge){var eMaxPair=this.GetMaximaPair(e);IsMaximaEdge=null===eMaxPair||!ClipperLib.ClipperBase.IsHorizontal(eMaxPair)}if(IsMaximaEdge){var ePrev=e.PrevInAEL;this.DoMaxima(e);if(null===ePrev)e=this.m_ActiveEdges;else e=ePrev.NextInAEL}else{if(this.IsIntermediate(e,topY)&&ClipperLib.ClipperBase.IsHorizontal(e.NextInLML)){e=this.UpdateEdgeIntoAEL(e);if(0<=e.OutIdx)this.AddOutPt(e,e.Bot);this.AddEdgeToSEL(e)}else{e.Curr.X=ClipperLib.Clipper.TopX(e,topY);e.Curr.Y=topY}if(this.StrictlySimple){var ePrev=e.PrevInAEL;if(0<=e.OutIdx&&0!==e.WindDelta&&null!==ePrev&&0<=ePrev.OutIdx&&ePrev.Curr.X==e.Curr.X&&0!==ePrev.WindDelta){var ip=new ClipperLib.IntPoint(e.Curr);if(use_xyz){this.SetZ(ip,ePrev,e)}var op=this.AddOutPt(ePrev,ip);var op2=this.AddOutPt(e,ip);this.AddJoin(op,op2,ip)}}e=e.NextInAEL}}this.ProcessHorizontals(true);e=this.m_ActiveEdges;while(null!==e){if(this.IsIntermediate(e,topY)){var op=null;if(0<=e.OutIdx)op=this.AddOutPt(e,e.Top);e=this.UpdateEdgeIntoAEL(e);var ePrev=e.PrevInAEL;var eNext=e.NextInAEL;if(null!==ePrev&&ePrev.Curr.X==e.Bot.X&&ePrev.Curr.Y==e.Bot.Y&&null!==op&&0<=ePrev.OutIdx&&ePrev.Curr.Y>ePrev.Top.Y&&ClipperLib.ClipperBase.SlopesEqual(e,ePrev,this.m_UseFullRange)&&0!==e.WindDelta&&0!==ePrev.WindDelta){var op2=this.AddOutPt(ePrev,e.Bot);this.AddJoin(op,op2,e.Top)}else if(null!==eNext&&eNext.Curr.X==e.Bot.X&&eNext.Curr.Y==e.Bot.Y&&null!==op&&0<=eNext.OutIdx&&eNext.Curr.Y>eNext.Top.Y&&ClipperLib.ClipperBase.SlopesEqual(e,eNext,this.m_UseFullRange)&&0!==e.WindDelta&&0!==eNext.WindDelta){var op2=this.AddOutPt(eNext,e.Bot);this.AddJoin(op,op2,e.Top)}}e=e.NextInAEL}};ClipperLib.Clipper.prototype.DoMaxima=function(e){var eMaxPair=this.GetMaximaPair(e);if(null===eMaxPair){if(0<=e.OutIdx)this.AddOutPt(e,e.Top);this.DeleteFromAEL(e);return}var eNext=e.NextInAEL;var use_lines=true;while(null!==eNext&&eNext!=eMaxPair){this.IntersectEdges(e,eNext,e.Top);this.SwapPositionsInAEL(e,eNext);eNext=e.NextInAEL}if(-1==e.OutIdx&&-1==eMaxPair.OutIdx){this.DeleteFromAEL(e);this.DeleteFromAEL(eMaxPair)}else if(0<=e.OutIdx&&0<=eMaxPair.OutIdx){if(0<=e.OutIdx)this.AddLocalMaxPoly(e,eMaxPair,e.Top);this.DeleteFromAEL(e);this.DeleteFromAEL(eMaxPair)}else if(use_lines&&0===e.WindDelta){if(0<=e.OutIdx){this.AddOutPt(e,e.Top);e.OutIdx=-1}this.DeleteFromAEL(e);if(0<=eMaxPair.OutIdx){this.AddOutPt(eMaxPair,e.Top);eMaxPair.OutIdx=-1}this.DeleteFromAEL(eMaxPair)}else ClipperLib.Error("DoMaxima error")};ClipperLib.Clipper.ReversePaths=function(polys){for(var i=0,len=polys.length;i<len;i++)polys[i].reverse()};ClipperLib.Clipper.Orientation=function(poly){return 0<=ClipperLib.Clipper.Area(poly)};ClipperLib.Clipper.prototype.PointCount=function(pts){if(null===pts)return 0;var result=0;var p=pts;do{result++;p=p.Next}while(p!=pts);return result};ClipperLib.Clipper.prototype.BuildResult=function(polyg){ClipperLib.Clear(polyg);for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec=this.m_PolyOuts[i];if(null===outRec.Pts)continue;var p=outRec.Pts.Prev;var cnt=this.PointCount(p);if(2>cnt)continue;var pg=new Array(cnt);for(var j=0;j<cnt;j++){pg[j]=p.Pt;p=p.Prev}polyg.push(pg)}};ClipperLib.Clipper.prototype.BuildResult2=function(polytree){polytree.Clear();for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec=this.m_PolyOuts[i];var cnt=this.PointCount(outRec.Pts);if(outRec.IsOpen&&2>cnt||!outRec.IsOpen&&3>cnt)continue;this.FixHoleLinkage(outRec);var pn=new ClipperLib.PolyNode;polytree.m_AllPolys.push(pn);outRec.PolyNode=pn;pn.m_polygon.length=cnt;var op=outRec.Pts.Prev;for(var j=0;j<cnt;j++){pn.m_polygon[j]=op.Pt;op=op.Prev}}for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec=this.m_PolyOuts[i];if(null===outRec.PolyNode)continue;else if(outRec.IsOpen){outRec.PolyNode.IsOpen=true;polytree.AddChild(outRec.PolyNode)}else if(null!==outRec.FirstLeft&&null!=outRec.FirstLeft.PolyNode)outRec.FirstLeft.PolyNode.AddChild(outRec.PolyNode);else polytree.AddChild(outRec.PolyNode)}};ClipperLib.Clipper.prototype.FixupOutPolygon=function(outRec){var lastOK=null;outRec.BottomPt=null;var pp=outRec.Pts;for(;;){if(pp.Prev==pp||pp.Prev==pp.Next){outRec.Pts=null;return}if(ClipperLib.IntPoint.op_Equality(pp.Pt,pp.Next.Pt)||ClipperLib.IntPoint.op_Equality(pp.Pt,pp.Prev.Pt)||ClipperLib.ClipperBase.SlopesEqual(pp.Prev.Pt,pp.Pt,pp.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(pp.Prev.Pt,pp.Pt,pp.Next.Pt))){lastOK=null;pp.Prev.Next=pp.Next;pp.Next.Prev=pp.Prev;pp=pp.Prev}else if(pp==lastOK)break;else{if(null===lastOK)lastOK=pp;pp=pp.Next}}outRec.Pts=pp};ClipperLib.Clipper.prototype.DupOutPt=function(outPt,InsertAfter){var result=new ClipperLib.OutPt;result.Pt.X=outPt.Pt.X;result.Pt.Y=outPt.Pt.Y;result.Idx=outPt.Idx;if(InsertAfter){result.Next=outPt.Next;result.Prev=outPt;outPt.Next.Prev=result;outPt.Next=result}else{result.Prev=outPt.Prev;result.Next=outPt;outPt.Prev.Next=result;outPt.Prev=result}return result};ClipperLib.Clipper.prototype.GetOverlap=function(a1,a2,b1,b2,$val){if(a1<a2){if(b1<b2){$val.Left=Math.max(a1,b1);$val.Right=Math.min(a2,b2)}else{$val.Left=Math.max(a1,b2);$val.Right=Math.min(a2,b1)}}else{if(b1<b2){$val.Left=Math.max(a2,b1);$val.Right=Math.min(a1,b2)}else{$val.Left=Math.max(a2,b2);$val.Right=Math.min(a1,b1)}}return $val.Left<$val.Right};ClipperLib.Clipper.prototype.JoinHorz=function(op1,op1b,op2,op2b,Pt,DiscardLeft){var Dir1=op1.Pt.X>op1b.Pt.X?ClipperLib.Direction.dRightToLeft:ClipperLib.Direction.dLeftToRight;var Dir2=op2.Pt.X>op2b.Pt.X?ClipperLib.Direction.dRightToLeft:ClipperLib.Direction.dLeftToRight;if(Dir1==Dir2)return false;if(Dir1==ClipperLib.Direction.dLeftToRight){while(op1.Next.Pt.X<=Pt.X&&op1.Next.Pt.X>=op1.Pt.X&&op1.Next.Pt.Y==Pt.Y)op1=op1.Next;if(DiscardLeft&&op1.Pt.X!=Pt.X)op1=op1.Next;op1b=this.DupOutPt(op1,!DiscardLeft);if(ClipperLib.IntPoint.op_Inequality(op1b.Pt,Pt)){op1=op1b;op1.Pt.X=Pt.X;op1.Pt.Y=Pt.Y;op1b=this.DupOutPt(op1,!DiscardLeft)}}else{while(op1.Next.Pt.X>=Pt.X&&op1.Next.Pt.X<=op1.Pt.X&&op1.Next.Pt.Y==Pt.Y)op1=op1.Next;if(!DiscardLeft&&op1.Pt.X!=Pt.X)op1=op1.Next;op1b=this.DupOutPt(op1,DiscardLeft);if(ClipperLib.IntPoint.op_Inequality(op1b.Pt,Pt)){op1=op1b;op1.Pt.X=Pt.X;op1.Pt.Y=Pt.Y;op1b=this.DupOutPt(op1,DiscardLeft)}}if(Dir2==ClipperLib.Direction.dLeftToRight){while(op2.Next.Pt.X<=Pt.X&&op2.Next.Pt.X>=op2.Pt.X&&op2.Next.Pt.Y==Pt.Y)op2=op2.Next;if(DiscardLeft&&op2.Pt.X!=Pt.X)op2=op2.Next;op2b=this.DupOutPt(op2,!DiscardLeft);if(ClipperLib.IntPoint.op_Inequality(op2b.Pt,Pt)){op2=op2b;op2.Pt.X=Pt.X;op2.Pt.Y=Pt.Y;op2b=this.DupOutPt(op2,!DiscardLeft)}}else{while(op2.Next.Pt.X>=Pt.X&&op2.Next.Pt.X<=op2.Pt.X&&op2.Next.Pt.Y==Pt.Y)op2=op2.Next;if(!DiscardLeft&&op2.Pt.X!=Pt.X)op2=op2.Next;op2b=this.DupOutPt(op2,DiscardLeft);if(ClipperLib.IntPoint.op_Inequality(op2b.Pt,Pt)){op2=op2b;op2.Pt.X=Pt.X;op2.Pt.Y=Pt.Y;op2b=this.DupOutPt(op2,DiscardLeft)}}if(Dir1==ClipperLib.Direction.dLeftToRight==DiscardLeft){op1.Prev=op2;op2.Next=op1;op1b.Next=op2b;op2b.Prev=op1b}else{op1.Next=op2;op2.Prev=op1;op1b.Prev=op2b;op2b.Next=op1b}return true};ClipperLib.Clipper.prototype.JoinPoints=function(j,outRec1,outRec2){var op1=j.OutPt1,op1b=new ClipperLib.OutPt;var op2=j.OutPt2,op2b=new ClipperLib.OutPt;var isHorizontal=j.OutPt1.Pt.Y==j.OffPt.Y;if(isHorizontal&&ClipperLib.IntPoint.op_Equality(j.OffPt,j.OutPt1.Pt)&&ClipperLib.IntPoint.op_Equality(j.OffPt,j.OutPt2.Pt)){if(outRec1!=outRec2)return false;op1b=j.OutPt1.Next;while(op1b!=op1&&ClipperLib.IntPoint.op_Equality(op1b.Pt,j.OffPt))op1b=op1b.Next;var reverse1=op1b.Pt.Y>j.OffPt.Y;op2b=j.OutPt2.Next;while(op2b!=op2&&ClipperLib.IntPoint.op_Equality(op2b.Pt,j.OffPt))op2b=op2b.Next;var reverse2=op2b.Pt.Y>j.OffPt.Y;if(reverse1==reverse2)return false;if(reverse1){op1b=this.DupOutPt(op1,false);op2b=this.DupOutPt(op2,true);op1.Prev=op2;op2.Next=op1;op1b.Next=op2b;op2b.Prev=op1b;j.OutPt1=op1;j.OutPt2=op1b;return true}else{op1b=this.DupOutPt(op1,true);op2b=this.DupOutPt(op2,false);op1.Next=op2;op2.Prev=op1;op1b.Prev=op2b;op2b.Next=op1b;j.OutPt1=op1;j.OutPt2=op1b;return true}}else if(isHorizontal){op1b=op1;while(op1.Prev.Pt.Y==op1.Pt.Y&&op1.Prev!=op1b&&op1.Prev!=op2)op1=op1.Prev;while(op1b.Next.Pt.Y==op1b.Pt.Y&&op1b.Next!=op1&&op1b.Next!=op2)op1b=op1b.Next;if(op1b.Next==op1||op1b.Next==op2)return false;op2b=op2;while(op2.Prev.Pt.Y==op2.Pt.Y&&op2.Prev!=op2b&&op2.Prev!=op1b)op2=op2.Prev;while(op2b.Next.Pt.Y==op2b.Pt.Y&&op2b.Next!=op2&&op2b.Next!=op1)op2b=op2b.Next;if(op2b.Next==op2||op2b.Next==op1)return false;var $val={Left:null,Right:null};if(!this.GetOverlap(op1.Pt.X,op1b.Pt.X,op2.Pt.X,op2b.Pt.X,$val))return false;var Left=$val.Left;var Right=$val.Right;var Pt=new ClipperLib.IntPoint;var DiscardLeftSide;if(op1.Pt.X>=Left&&op1.Pt.X<=Right){Pt.X=op1.Pt.X;Pt.Y=op1.Pt.Y;DiscardLeftSide=op1.Pt.X>op1b.Pt.X}else if(op2.Pt.X>=Left&&op2.Pt.X<=Right){Pt.X=op2.Pt.X;Pt.Y=op2.Pt.Y;DiscardLeftSide=op2.Pt.X>op2b.Pt.X}else if(op1b.Pt.X>=Left&&op1b.Pt.X<=Right){Pt.X=op1b.Pt.X;Pt.Y=op1b.Pt.Y;DiscardLeftSide=op1b.Pt.X>op1.Pt.X}else{Pt.X=op2b.Pt.X;Pt.Y=op2b.Pt.Y;DiscardLeftSide=op2b.Pt.X>op2.Pt.X}j.OutPt1=op1;j.OutPt2=op2;return this.JoinHorz(op1,op1b,op2,op2b,Pt,DiscardLeftSide)}else{op1b=op1.Next;while(ClipperLib.IntPoint.op_Equality(op1b.Pt,op1.Pt)&&op1b!=op1)op1b=op1b.Next;var Reverse1=op1b.Pt.Y>op1.Pt.Y||!ClipperLib.ClipperBase.SlopesEqual(op1.Pt,op1b.Pt,j.OffPt,this.m_UseFullRange);if(Reverse1){op1b=op1.Prev;while(ClipperLib.IntPoint.op_Equality(op1b.Pt,op1.Pt)&&op1b!=op1)op1b=op1b.Prev;if(op1b.Pt.Y>op1.Pt.Y||!ClipperLib.ClipperBase.SlopesEqual(op1.Pt,op1b.Pt,j.OffPt,this.m_UseFullRange))return false}op2b=op2.Next;while(ClipperLib.IntPoint.op_Equality(op2b.Pt,op2.Pt)&&op2b!=op2)op2b=op2b.Next;var Reverse2=op2b.Pt.Y>op2.Pt.Y||!ClipperLib.ClipperBase.SlopesEqual(op2.Pt,op2b.Pt,j.OffPt,this.m_UseFullRange);if(Reverse2){op2b=op2.Prev;while(ClipperLib.IntPoint.op_Equality(op2b.Pt,op2.Pt)&&op2b!=op2)op2b=op2b.Prev;if(op2b.Pt.Y>op2.Pt.Y||!ClipperLib.ClipperBase.SlopesEqual(op2.Pt,op2b.Pt,j.OffPt,this.m_UseFullRange))return false}if(op1b==op1||op2b==op2||op1b==op2b||outRec1==outRec2&&Reverse1==Reverse2)return false;if(Reverse1){op1b=this.DupOutPt(op1,false);op2b=this.DupOutPt(op2,true);op1.Prev=op2;op2.Next=op1;op1b.Next=op2b;op2b.Prev=op1b;j.OutPt1=op1;j.OutPt2=op1b;return true}else{op1b=this.DupOutPt(op1,true);op2b=this.DupOutPt(op2,false);op1.Next=op2;op2.Prev=op1;op1b.Prev=op2b;op2b.Next=op1b;j.OutPt1=op1;j.OutPt2=op1b;return true}}};ClipperLib.Clipper.GetBounds=function(paths){var i=0,cnt=paths.length;while(i<cnt&&0==paths[i].length)i++;if(i==cnt)return new ClipperLib.IntRect(0,0,0,0);var result=new ClipperLib.IntRect;result.left=paths[i][0].X;result.right=result.left;result.top=paths[i][0].Y;result.bottom=result.top;for(;i<cnt;i++)for(var j=0,jlen=paths[i].length;j<jlen;j++){if(paths[i][j].X<result.left)result.left=paths[i][j].X;else if(paths[i][j].X>result.right)result.right=paths[i][j].X;if(paths[i][j].Y<result.top)result.top=paths[i][j].Y;else if(paths[i][j].Y>result.bottom)result.bottom=paths[i][j].Y}return result};ClipperLib.Clipper.prototype.GetBounds2=function(ops){var opStart=ops;var result=new ClipperLib.IntRect;result.left=ops.Pt.X;result.right=ops.Pt.X;result.top=ops.Pt.Y;result.bottom=ops.Pt.Y;ops=ops.Next;while(ops!=opStart){if(ops.Pt.X<result.left)result.left=ops.Pt.X;if(ops.Pt.X>result.right)result.right=ops.Pt.X;if(ops.Pt.Y<result.top)result.top=ops.Pt.Y;if(ops.Pt.Y>result.bottom)result.bottom=ops.Pt.Y;ops=ops.Next}return result};ClipperLib.Clipper.PointInPolygon=function(pt,path){var result=0,cnt=path.length;if(3>cnt)return 0;var ip=path[0];for(var i=1;i<=cnt;++i){var ipNext=i==cnt?path[0]:path[i];if(ipNext.Y==pt.Y){if(ipNext.X==pt.X||ip.Y==pt.Y&&ipNext.X>pt.X==ip.X<pt.X)return-1}if(ip.Y<pt.Y!=ipNext.Y<pt.Y){if(ip.X>=pt.X){if(ipNext.X>pt.X)result=1-result;else{var d=(ip.X-pt.X)*(ipNext.Y-pt.Y)-(ipNext.X-pt.X)*(ip.Y-pt.Y);if(0==d)return-1;else if(0<d==ipNext.Y>ip.Y)result=1-result}}else{if(ipNext.X>pt.X){var d=(ip.X-pt.X)*(ipNext.Y-pt.Y)-(ipNext.X-pt.X)*(ip.Y-pt.Y);if(0==d)return-1;else if(0<d==ipNext.Y>ip.Y)result=1-result}}}ip=ipNext}return result};ClipperLib.Clipper.prototype.PointInPolygon=function(pt,op){var result=0;var startOp=op;var ptx=pt.X,pty=pt.Y;var poly0x=op.Pt.X,poly0y=op.Pt.Y;do{op=op.Next;var poly1x=op.Pt.X,poly1y=op.Pt.Y;if(poly1y==pty){if(poly1x==ptx||poly0y==pty&&poly1x>ptx==poly0x<ptx)return-1}if(poly0y<pty!=poly1y<pty){if(poly0x>=ptx){if(poly1x>ptx)result=1-result;else{var d=(poly0x-ptx)*(poly1y-pty)-(poly1x-ptx)*(poly0y-pty);if(0==d)return-1;if(0<d==poly1y>poly0y)result=1-result}}else{if(poly1x>ptx){var d=(poly0x-ptx)*(poly1y-pty)-(poly1x-ptx)*(poly0y-pty);if(0==d)return-1;if(0<d==poly1y>poly0y)result=1-result}}}poly0x=poly1x;poly0y=poly1y}while(startOp!=op);return result};ClipperLib.Clipper.prototype.Poly2ContainsPoly1=function(outPt1,outPt2){var op=outPt1;do{var res=this.PointInPolygon(op.Pt,outPt2);if(0<=res)return 0<res;op=op.Next}while(op!=outPt1);return true};ClipperLib.Clipper.prototype.FixupFirstLefts1=function(OldOutRec,NewOutRec){for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec=this.m_PolyOuts[i];if(null==outRec.Pts||null==outRec.FirstLeft)continue;var firstLeft=this.ParseFirstLeft(outRec.FirstLeft);if(firstLeft==OldOutRec){if(this.Poly2ContainsPoly1(outRec.Pts,NewOutRec.Pts))outRec.FirstLeft=NewOutRec}}};ClipperLib.Clipper.prototype.FixupFirstLefts2=function(OldOutRec,NewOutRec){for(var $i2=0,$t2=this.m_PolyOuts,$l2=$t2.length,outRec=$t2[$i2];$i2<$l2;$i2++,outRec=$t2[$i2])if(outRec.FirstLeft==OldOutRec)outRec.FirstLeft=NewOutRec};ClipperLib.Clipper.ParseFirstLeft=function(FirstLeft){while(null!=FirstLeft&&null==FirstLeft.Pts)FirstLeft=FirstLeft.FirstLeft;return FirstLeft};ClipperLib.Clipper.prototype.JoinCommonEdges=function(){for(var i=0,ilen=this.m_Joins.length;i<ilen;i++){var join=this.m_Joins[i];var outRec1=this.GetOutRec(join.OutPt1.Idx);var outRec2=this.GetOutRec(join.OutPt2.Idx);if(null==outRec1.Pts||null==outRec2.Pts)continue;var holeStateRec;if(outRec1==outRec2)holeStateRec=outRec1;else if(this.Param1RightOfParam2(outRec1,outRec2))holeStateRec=outRec2;else if(this.Param1RightOfParam2(outRec2,outRec1))holeStateRec=outRec1;else holeStateRec=this.GetLowermostRec(outRec1,outRec2);if(!this.JoinPoints(join,outRec1,outRec2))continue;if(outRec1==outRec2){outRec1.Pts=join.OutPt1;outRec1.BottomPt=null;outRec2=this.CreateOutRec();outRec2.Pts=join.OutPt2;this.UpdateOutPtIdxs(outRec2);if(this.m_UsingPolyTree)for(var j=0,jlen=this.m_PolyOuts.length;j<jlen-1;j++){var oRec=this.m_PolyOuts[j];if(null==oRec.Pts||ClipperLib.Clipper.ParseFirstLeft(oRec.FirstLeft)!=outRec1||oRec.IsHole==outRec1.IsHole)continue;if(this.Poly2ContainsPoly1(oRec.Pts,join.OutPt2))oRec.FirstLeft=outRec2}if(this.Poly2ContainsPoly1(outRec2.Pts,outRec1.Pts)){outRec2.IsHole=!outRec1.IsHole;outRec2.FirstLeft=outRec1;if(this.m_UsingPolyTree)this.FixupFirstLefts2(outRec2,outRec1);if((outRec2.IsHole^this.ReverseSolution)==0<this.Area(outRec2))this.ReversePolyPtLinks(outRec2.Pts)}else if(this.Poly2ContainsPoly1(outRec1.Pts,outRec2.Pts)){outRec2.IsHole=outRec1.IsHole;outRec1.IsHole=!outRec2.IsHole;outRec2.FirstLeft=outRec1.FirstLeft;outRec1.FirstLeft=outRec2;if(this.m_UsingPolyTree)this.FixupFirstLefts2(outRec1,outRec2);if((outRec1.IsHole^this.ReverseSolution)==0<this.Area(outRec1))this.ReversePolyPtLinks(outRec1.Pts)}else{outRec2.IsHole=outRec1.IsHole;outRec2.FirstLeft=outRec1.FirstLeft;if(this.m_UsingPolyTree)this.FixupFirstLefts1(outRec1,outRec2)}}else{outRec2.Pts=null;outRec2.BottomPt=null;outRec2.Idx=outRec1.Idx;outRec1.IsHole=holeStateRec.IsHole;if(holeStateRec==outRec2)outRec1.FirstLeft=outRec2.FirstLeft;outRec2.FirstLeft=outRec1;if(this.m_UsingPolyTree)this.FixupFirstLefts2(outRec2,outRec1)}}};ClipperLib.Clipper.prototype.UpdateOutPtIdxs=function(outrec){var op=outrec.Pts;do{op.Idx=outrec.Idx;op=op.Prev}while(op!=outrec.Pts)};ClipperLib.Clipper.prototype.DoSimplePolygons=function(){var i=0;while(i<this.m_PolyOuts.length){var outrec=this.m_PolyOuts[i++];var op=outrec.Pts;if(null==op||outrec.IsOpen)continue;do{var op2=op.Next;while(op2!=outrec.Pts){if(ClipperLib.IntPoint.op_Equality(op.Pt,op2.Pt)&&op2.Next!=op&&op2.Prev!=op){var op3=op.Prev;var op4=op2.Prev;op.Prev=op4;op4.Next=op;op2.Prev=op3;op3.Next=op2;outrec.Pts=op;var outrec2=this.CreateOutRec();outrec2.Pts=op2;this.UpdateOutPtIdxs(outrec2);if(this.Poly2ContainsPoly1(outrec2.Pts,outrec.Pts)){outrec2.IsHole=!outrec.IsHole;outrec2.FirstLeft=outrec;if(this.m_UsingPolyTree)this.FixupFirstLefts2(outrec2,outrec)}else if(this.Poly2ContainsPoly1(outrec.Pts,outrec2.Pts)){outrec2.IsHole=outrec.IsHole;outrec.IsHole=!outrec2.IsHole;outrec2.FirstLeft=outrec.FirstLeft;outrec.FirstLeft=outrec2;if(this.m_UsingPolyTree)this.FixupFirstLefts2(outrec,outrec2)}else{outrec2.IsHole=outrec.IsHole;outrec2.FirstLeft=outrec.FirstLeft;if(this.m_UsingPolyTree)this.FixupFirstLefts1(outrec,outrec2)}op2=op}op2=op2.Next}op=op.Next}while(op!=outrec.Pts)}};ClipperLib.Clipper.Area=function(poly){var cnt=poly.length;if(3>cnt)return 0;var a=0;for(var i=0,j=cnt-1;i<cnt;++i){a+=(poly[j].X+poly[i].X)*(poly[j].Y-poly[i].Y);j=i}return 0.5*-a};ClipperLib.Clipper.prototype.Area=function(outRec){var op=outRec.Pts;if(null==op)return 0;var a=0;do{a=a+(op.Prev.Pt.X+op.Pt.X)*(op.Prev.Pt.Y-op.Pt.Y);op=op.Next}while(op!=outRec.Pts);return 0.5*a};ClipperLib.Clipper.SimplifyPolygon=function(poly,fillType){var result=new Array;var c=new ClipperLib.Clipper(0);c.StrictlySimple=true;c.AddPath(poly,ClipperLib.PolyType.ptSubject,true);c.Execute(ClipperLib.ClipType.ctUnion,result,fillType,fillType);return result};ClipperLib.Clipper.SimplifyPolygons=function(polys,fillType){if("undefined"==typeof fillType)fillType=ClipperLib.PolyFillType.pftEvenOdd;var result=new Array;var c=new ClipperLib.Clipper(0);c.StrictlySimple=true;c.AddPaths(polys,ClipperLib.PolyType.ptSubject,true);c.Execute(ClipperLib.ClipType.ctUnion,result,fillType,fillType);return result};ClipperLib.Clipper.DistanceSqrd=function(pt1,pt2){var dx=pt1.X-pt2.X;var dy=pt1.Y-pt2.Y;return dx*dx+dy*dy};ClipperLib.Clipper.DistanceFromLineSqrd=function(pt,ln1,ln2){var A=ln1.Y-ln2.Y;var B=ln2.X-ln1.X;var C=A*ln1.X+B*ln1.Y;C=A*pt.X+B*pt.Y-C;return C*C/(A*A+B*B)};ClipperLib.Clipper.SlopesNearCollinear=function(pt1,pt2,pt3,distSqrd){if(Math.abs(pt1.X-pt2.X)>Math.abs(pt1.Y-pt2.Y)){if(pt1.X>pt2.X==pt1.X<pt3.X)return ClipperLib.Clipper.DistanceFromLineSqrd(pt1,pt2,pt3)<distSqrd;else if(pt2.X>pt1.X==pt2.X<pt3.X)return ClipperLib.Clipper.DistanceFromLineSqrd(pt2,pt1,pt3)<distSqrd;else return ClipperLib.Clipper.DistanceFromLineSqrd(pt3,pt1,pt2)<distSqrd}else{if(pt1.Y>pt2.Y==pt1.Y<pt3.Y)return ClipperLib.Clipper.DistanceFromLineSqrd(pt1,pt2,pt3)<distSqrd;else if(pt2.Y>pt1.Y==pt2.Y<pt3.Y)return ClipperLib.Clipper.DistanceFromLineSqrd(pt2,pt1,pt3)<distSqrd;else return ClipperLib.Clipper.DistanceFromLineSqrd(pt3,pt1,pt2)<distSqrd}};ClipperLib.Clipper.PointsAreClose=function(pt1,pt2,distSqrd){var dx=pt1.X-pt2.X;var dy=pt1.Y-pt2.Y;return dx*dx+dy*dy<=distSqrd};ClipperLib.Clipper.ExcludeOp=function(op){var result=op.Prev;result.Next=op.Next;op.Next.Prev=result;result.Idx=0;return result};ClipperLib.Clipper.CleanPolygon=function(path,distance){if("undefined"==typeof distance)distance=1.415;var cnt=path.length;if(0==cnt)return new Array;var outPts=new Array(cnt);for(var i=0;i<cnt;++i)outPts[i]=new ClipperLib.OutPt;for(var i=0;i<cnt;++i){outPts[i].Pt=path[i];outPts[i].Next=outPts[(i+1)%cnt];outPts[i].Next.Prev=outPts[i];outPts[i].Idx=0}var distSqrd=distance*distance;var op=outPts[0];while(0==op.Idx&&op.Next!=op.Prev){if(ClipperLib.Clipper.PointsAreClose(op.Pt,op.Prev.Pt,distSqrd)){op=ClipperLib.Clipper.ExcludeOp(op);cnt--}else if(ClipperLib.Clipper.PointsAreClose(op.Prev.Pt,op.Next.Pt,distSqrd)){ClipperLib.Clipper.ExcludeOp(op.Next);op=ClipperLib.Clipper.ExcludeOp(op);cnt-=2}else if(ClipperLib.Clipper.SlopesNearCollinear(op.Prev.Pt,op.Pt,op.Next.Pt,distSqrd)){op=ClipperLib.Clipper.ExcludeOp(op);cnt--}else{op.Idx=1;op=op.Next}}if(3>cnt)cnt=0;var result=new Array(cnt);for(var i=0;i<cnt;++i){result[i]=new ClipperLib.IntPoint(op.Pt);op=op.Next}outPts=null;return result};ClipperLib.Clipper.CleanPolygons=function(polys,distance){var result=new Array(polys.length);for(var i=0,ilen=polys.length;i<ilen;i++)result[i]=ClipperLib.Clipper.CleanPolygon(polys[i],distance);return result};ClipperLib.Clipper.Minkowski=function(pattern,path,IsSum,IsClosed){var delta=IsClosed?1:0;var polyCnt=pattern.length;var pathCnt=path.length;var result=new Array;if(IsSum)for(var i=0;i<pathCnt;i++){var p=new Array(polyCnt);for(var j=0,jlen=pattern.length,ip=pattern[j];j<jlen;j++,ip=pattern[j])p[j]=new ClipperLib.IntPoint(path[i].X+ip.X,path[i].Y+ip.Y);result.push(p)}else for(var i=0;i<pathCnt;i++){var p=new Array(polyCnt);for(var j=0,jlen=pattern.length,ip=pattern[j];j<jlen;j++,ip=pattern[j])p[j]=new ClipperLib.IntPoint(path[i].X-ip.X,path[i].Y-ip.Y);result.push(p)}var quads=new Array;for(var i=0;i<pathCnt-1+delta;i++)for(var j=0;j<polyCnt;j++){var quad=new Array;quad.push(result[i%pathCnt][j%polyCnt]);quad.push(result[(i+1)%pathCnt][j%polyCnt]);quad.push(result[(i+1)%pathCnt][(j+1)%polyCnt]);quad.push(result[i%pathCnt][(j+1)%polyCnt]);if(!ClipperLib.Clipper.Orientation(quad))quad.reverse();quads.push(quad)}return quads};ClipperLib.Clipper.MinkowskiSum=function(pattern,path_or_paths,pathIsClosed){if(!(path_or_paths[0]instanceof Array)){var path=path_or_paths;var paths=ClipperLib.Clipper.Minkowski(pattern,path,true,pathIsClosed);var c=new ClipperLib.Clipper;c.AddPaths(paths,ClipperLib.PolyType.ptSubject,true);c.Execute(ClipperLib.ClipType.ctUnion,paths,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);return paths}else{var paths=path_or_paths;var solution=new ClipperLib.Paths;var c=new ClipperLib.Clipper;for(var i=0;i<paths.length;++i){var tmp=ClipperLib.Clipper.Minkowski(pattern,paths[i],true,pathIsClosed);c.AddPaths(tmp,ClipperLib.PolyType.ptSubject,true);if(pathIsClosed){var path=ClipperLib.Clipper.TranslatePath(paths[i],pattern[0]);c.AddPath(path,ClipperLib.PolyType.ptClip,true)}}c.Execute(ClipperLib.ClipType.ctUnion,solution,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);return solution}};ClipperLib.Clipper.TranslatePath=function(path,delta){var outPath=new ClipperLib.Path;for(var i=0;i<path.length;i++)outPath.push(new ClipperLib.IntPoint(path[i].X+delta.X,path[i].Y+delta.Y));return outPath};ClipperLib.Clipper.MinkowskiDiff=function(poly1,poly2){var paths=ClipperLib.Clipper.Minkowski(poly1,poly2,false,true);var c=new ClipperLib.Clipper;c.AddPaths(paths,ClipperLib.PolyType.ptSubject,true);c.Execute(ClipperLib.ClipType.ctUnion,paths,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);return paths};ClipperLib.Clipper.PolyTreeToPaths=function(polytree){var result=new Array;ClipperLib.Clipper.AddPolyNodeToPaths(polytree,ClipperLib.Clipper.NodeType.ntAny,result);return result};ClipperLib.Clipper.AddPolyNodeToPaths=function(polynode,nt,paths){var match=true;switch(nt){case ClipperLib.Clipper.NodeType.ntOpen:return;case ClipperLib.Clipper.NodeType.ntClosed:match=!polynode.IsOpen;break;default:break;}if(0<polynode.m_polygon.length&&match)paths.push(polynode.m_polygon);for(var $i3=0,$t3=polynode.Childs(),$l3=$t3.length,pn=$t3[$i3];$i3<$l3;$i3++,pn=$t3[$i3])ClipperLib.Clipper.AddPolyNodeToPaths(pn,nt,paths)};ClipperLib.Clipper.OpenPathsFromPolyTree=function(polytree){var result=new ClipperLib.Paths;for(var i=0,ilen=polytree.ChildCount();i<ilen;i++)if(polytree.Childs()[i].IsOpen)result.push(polytree.Childs()[i].m_polygon);return result};ClipperLib.Clipper.ClosedPathsFromPolyTree=function(polytree){var result=new ClipperLib.Paths;ClipperLib.Clipper.AddPolyNodeToPaths(polytree,ClipperLib.Clipper.NodeType.ntClosed,result);return result};Inherit(ClipperLib.Clipper,ClipperLib.ClipperBase);ClipperLib.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};ClipperLib.ClipperOffset=function(miterLimit,arcTolerance){if("undefined"==typeof miterLimit)miterLimit=2;if("undefined"==typeof arcTolerance)arcTolerance=ClipperLib.ClipperOffset.def_arc_tolerance;this.m_destPolys=new ClipperLib.Paths;this.m_srcPoly=new ClipperLib.Path;this.m_destPoly=new ClipperLib.Path;this.m_normals=new Array;this.m_delta=0;this.m_sinA=0;this.m_sin=0;this.m_cos=0;this.m_miterLim=0;this.m_StepsPerRad=0;this.m_lowest=new ClipperLib.IntPoint;this.m_polyNodes=new ClipperLib.PolyNode;this.MiterLimit=miterLimit;this.ArcTolerance=arcTolerance;this.m_lowest.X=-1};ClipperLib.ClipperOffset.two_pi=6.28318530717959;ClipperLib.ClipperOffset.def_arc_tolerance=0.25;ClipperLib.ClipperOffset.prototype.Clear=function(){ClipperLib.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};ClipperLib.ClipperOffset.Round=ClipperLib.Clipper.Round;ClipperLib.ClipperOffset.prototype.AddPath=function(path,joinType,endType){var highI=path.length-1;if(0>highI)return;var newNode=new ClipperLib.PolyNode;newNode.m_jointype=joinType;newNode.m_endtype=endType;if(endType==ClipperLib.EndType.etClosedLine||endType==ClipperLib.EndType.etClosedPolygon)while(0<highI&&ClipperLib.IntPoint.op_Equality(path[0],path[highI]))highI--;newNode.m_polygon.push(path[0]);var j=0,k=0;for(var i=1;i<=highI;i++)if(ClipperLib.IntPoint.op_Inequality(newNode.m_polygon[j],path[i])){j++;newNode.m_polygon.push(path[i]);if(path[i].Y>newNode.m_polygon[k].Y||path[i].Y==newNode.m_polygon[k].Y&&path[i].X<newNode.m_polygon[k].X)k=j}if(endType==ClipperLib.EndType.etClosedPolygon&&2>j)return;this.m_polyNodes.AddChild(newNode);if(endType!=ClipperLib.EndType.etClosedPolygon)return;if(0>this.m_lowest.X)this.m_lowest=new ClipperLib.IntPoint(this.m_polyNodes.ChildCount()-1,k);else{var ip=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];if(newNode.m_polygon[k].Y>ip.Y||newNode.m_polygon[k].Y==ip.Y&&newNode.m_polygon[k].X<ip.X)this.m_lowest=new ClipperLib.IntPoint(this.m_polyNodes.ChildCount()-1,k)}};ClipperLib.ClipperOffset.prototype.AddPaths=function(paths,joinType,endType){for(var i=0,ilen=paths.length;i<ilen;i++)this.AddPath(paths[i],joinType,endType)};ClipperLib.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!ClipperLib.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon)){for(var i=0;i<this.m_polyNodes.ChildCount();i++){var node=this.m_polyNodes.Childs()[i];if(node.m_endtype==ClipperLib.EndType.etClosedPolygon||node.m_endtype==ClipperLib.EndType.etClosedLine&&ClipperLib.Clipper.Orientation(node.m_polygon))node.m_polygon.reverse()}}else{for(var i=0;i<this.m_polyNodes.ChildCount();i++){var node=this.m_polyNodes.Childs()[i];if(node.m_endtype==ClipperLib.EndType.etClosedLine&&!ClipperLib.Clipper.Orientation(node.m_polygon))node.m_polygon.reverse()}}};ClipperLib.ClipperOffset.GetUnitNormal=function(pt1,pt2){var dx=pt2.X-pt1.X;var dy=pt2.Y-pt1.Y;if(0==dx&&0==dy)return new ClipperLib.DoublePoint(0,0);var f=1/Math.sqrt(dx*dx+dy*dy);dx*=f;dy*=f;return new ClipperLib.DoublePoint(dy,-dx)};ClipperLib.ClipperOffset.prototype.DoOffset=function(delta){this.m_destPolys=new Array;this.m_delta=delta;if(ClipperLib.ClipperBase.near_zero(delta)){for(var i=0;i<this.m_polyNodes.ChildCount();i++){var node=this.m_polyNodes.Childs()[i];if(node.m_endtype==ClipperLib.EndType.etClosedPolygon)this.m_destPolys.push(node.m_polygon)}return}if(2<this.MiterLimit)this.m_miterLim=2/(this.MiterLimit*this.MiterLimit);else this.m_miterLim=0.5;var y;if(0>=this.ArcTolerance)y=ClipperLib.ClipperOffset.def_arc_tolerance;else if(this.ArcTolerance>Math.abs(delta)*ClipperLib.ClipperOffset.def_arc_tolerance)y=Math.abs(delta)*ClipperLib.ClipperOffset.def_arc_tolerance;else y=this.ArcTolerance;var steps=3.14159265358979/Math.acos(1-y/Math.abs(delta));this.m_sin=Math.sin(ClipperLib.ClipperOffset.two_pi/steps);this.m_cos=Math.cos(ClipperLib.ClipperOffset.two_pi/steps);this.m_StepsPerRad=steps/ClipperLib.ClipperOffset.two_pi;if(0>delta)this.m_sin=-this.m_sin;for(var i=0;i<this.m_polyNodes.ChildCount();i++){var node=this.m_polyNodes.Childs()[i];this.m_srcPoly=node.m_polygon;var len=this.m_srcPoly.length;if(0==len||0>=delta&&(3>len||node.m_endtype!=ClipperLib.EndType.etClosedPolygon))continue;this.m_destPoly=new Array;if(1==len){if(node.m_jointype==ClipperLib.JoinType.jtRound){var X=1,Y=0;for(var j=1;j<=steps;j++){this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].X+X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].Y+Y*delta)));var X2=X;X=X*this.m_cos-this.m_sin*Y;Y=X2*this.m_sin+Y*this.m_cos}}else{var X=-1,Y=-1;for(var j=0;4>j;++j){this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].X+X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].Y+Y*delta)));if(0>X)X=1;else if(0>Y)Y=1;else X=-1}}this.m_destPolys.push(this.m_destPoly);continue}this.m_normals.length=0;for(var j=0;j<len-1;j++)this.m_normals.push(ClipperLib.ClipperOffset.GetUnitNormal(this.m_srcPoly[j],this.m_srcPoly[j+1]));if(node.m_endtype==ClipperLib.EndType.etClosedLine||node.m_endtype==ClipperLib.EndType.etClosedPolygon)this.m_normals.push(ClipperLib.ClipperOffset.GetUnitNormal(this.m_srcPoly[len-1],this.m_srcPoly[0]));else this.m_normals.push(new ClipperLib.DoublePoint(this.m_normals[len-2]));if(node.m_endtype==ClipperLib.EndType.etClosedPolygon){var k=len-1;for(var j=0;j<len;j++)k=this.OffsetPoint(j,k,node.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(node.m_endtype==ClipperLib.EndType.etClosedLine){var k=len-1;for(var j=0;j<len;j++)k=this.OffsetPoint(j,k,node.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=new Array;var n=this.m_normals[len-1];for(var j=len-1;0<j;j--)this.m_normals[j]=new ClipperLib.DoublePoint(-this.m_normals[j-1].X,-this.m_normals[j-1].Y);this.m_normals[0]=new ClipperLib.DoublePoint(-n.X,-n.Y);k=0;for(var j=len-1;0<=j;j--)k=this.OffsetPoint(j,k,node.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{var k=0;for(var j=1;j<len-1;++j)k=this.OffsetPoint(j,k,node.m_jointype);var pt1;if(node.m_endtype==ClipperLib.EndType.etOpenButt){var j=len-1;pt1=new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_normals[j].X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_normals[j].Y*delta));this.m_destPoly.push(pt1);pt1=new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X-this.m_normals[j].X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y-this.m_normals[j].Y*delta));this.m_destPoly.push(pt1)}else{var j=len-1;k=len-2;this.m_sinA=0;this.m_normals[j]=new ClipperLib.DoublePoint(-this.m_normals[j].X,-this.m_normals[j].Y);if(node.m_endtype==ClipperLib.EndType.etOpenSquare)this.DoSquare(j,k);else this.DoRound(j,k)}for(var j=len-1;0<j;j--)this.m_normals[j]=new ClipperLib.DoublePoint(-this.m_normals[j-1].X,-this.m_normals[j-1].Y);this.m_normals[0]=new ClipperLib.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y);k=len-1;for(var j=k-1;0<j;--j)k=this.OffsetPoint(j,k,node.m_jointype);if(node.m_endtype==ClipperLib.EndType.etOpenButt){pt1=new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*delta));this.m_destPoly.push(pt1);pt1=new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*delta));this.m_destPoly.push(pt1)}else{k=1;this.m_sinA=0;if(node.m_endtype==ClipperLib.EndType.etOpenSquare)this.DoSquare(0,1);else this.DoRound(0,1)}this.m_destPolys.push(this.m_destPoly)}}};ClipperLib.ClipperOffset.prototype.Execute=function(){var a=arguments,ispolytree=a[0]instanceof ClipperLib.PolyTree;if(!ispolytree){var solution=a[0],delta=a[1];ClipperLib.Clear(solution);this.FixOrientations();this.DoOffset(delta);var clpr=new ClipperLib.Clipper(0);clpr.AddPaths(this.m_destPolys,ClipperLib.PolyType.ptSubject,true);if(0<delta){clpr.Execute(ClipperLib.ClipType.ctUnion,solution,ClipperLib.PolyFillType.pftPositive,ClipperLib.PolyFillType.pftPositive)}else{var r=ClipperLib.Clipper.GetBounds(this.m_destPolys);var outer=new ClipperLib.Path;outer.push(new ClipperLib.IntPoint(r.left-10,r.bottom+10));outer.push(new ClipperLib.IntPoint(r.right+10,r.bottom+10));outer.push(new ClipperLib.IntPoint(r.right+10,r.top-10));outer.push(new ClipperLib.IntPoint(r.left-10,r.top-10));clpr.AddPath(outer,ClipperLib.PolyType.ptSubject,true);clpr.ReverseSolution=true;clpr.Execute(ClipperLib.ClipType.ctUnion,solution,ClipperLib.PolyFillType.pftNegative,ClipperLib.PolyFillType.pftNegative);if(0<solution.length)solution.splice(0,1)}}else{var solution=a[0],delta=a[1];solution.Clear();this.FixOrientations();this.DoOffset(delta);var clpr=new ClipperLib.Clipper(0);clpr.AddPaths(this.m_destPolys,ClipperLib.PolyType.ptSubject,true);if(0<delta){clpr.Execute(ClipperLib.ClipType.ctUnion,solution,ClipperLib.PolyFillType.pftPositive,ClipperLib.PolyFillType.pftPositive)}else{var r=ClipperLib.Clipper.GetBounds(this.m_destPolys);var outer=new ClipperLib.Path;outer.push(new ClipperLib.IntPoint(r.left-10,r.bottom+10));outer.push(new ClipperLib.IntPoint(r.right+10,r.bottom+10));outer.push(new ClipperLib.IntPoint(r.right+10,r.top-10));outer.push(new ClipperLib.IntPoint(r.left-10,r.top-10));clpr.AddPath(outer,ClipperLib.PolyType.ptSubject,true);clpr.ReverseSolution=true;clpr.Execute(ClipperLib.ClipType.ctUnion,solution,ClipperLib.PolyFillType.pftNegative,ClipperLib.PolyFillType.pftNegative);if(1==solution.ChildCount()&&0<solution.Childs()[0].ChildCount()){var outerNode=solution.Childs()[0];solution.Childs()[0]=outerNode.Childs()[0];solution.Childs()[0].m_Parent=solution;for(var i=1;i<outerNode.ChildCount();i++)solution.AddChild(outerNode.Childs()[i])}else solution.Clear()}}};ClipperLib.ClipperOffset.prototype.OffsetPoint=function(j,k,jointype){this.m_sinA=this.m_normals[k].X*this.m_normals[j].Y-this.m_normals[j].X*this.m_normals[k].Y;if(1>Math.abs(this.m_sinA*this.m_delta)){var cosA=this.m_normals[k].X*this.m_normals[j].X+this.m_normals[j].Y*this.m_normals[k].Y;if(0<cosA){this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_normals[k].X*this.m_delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_normals[k].Y*this.m_delta)));return k}}else if(1<this.m_sinA)this.m_sinA=1;else if(-1>this.m_sinA)this.m_sinA=-1;if(0>this.m_sinA*this.m_delta){this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_normals[k].X*this.m_delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_normals[k].Y*this.m_delta)));this.m_destPoly.push(new ClipperLib.IntPoint(this.m_srcPoly[j]));this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_normals[j].X*this.m_delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_normals[j].Y*this.m_delta)))}else switch(jointype){case ClipperLib.JoinType.jtMiter:{var r=1+(this.m_normals[j].X*this.m_normals[k].X+this.m_normals[j].Y*this.m_normals[k].Y);if(r>=this.m_miterLim)this.DoMiter(j,k,r);else this.DoSquare(j,k);break}case ClipperLib.JoinType.jtSquare:this.DoSquare(j,k);break;case ClipperLib.JoinType.jtRound:this.DoRound(j,k);break;}k=j;return k};ClipperLib.ClipperOffset.prototype.DoSquare=function(j,k){var dx=Math.tan(Math.atan2(this.m_sinA,this.m_normals[k].X*this.m_normals[j].X+this.m_normals[k].Y*this.m_normals[j].Y)/4);this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_delta*(this.m_normals[k].X-this.m_normals[k].Y*dx)),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_delta*(this.m_normals[k].Y+this.m_normals[k].X*dx))));this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_delta*(this.m_normals[j].X+this.m_normals[j].Y*dx)),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_delta*(this.m_normals[j].Y-this.m_normals[j].X*dx))))};ClipperLib.ClipperOffset.prototype.DoMiter=function(j,k,r){var q=this.m_delta/r;this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+(this.m_normals[k].X+this.m_normals[j].X)*q),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+(this.m_normals[k].Y+this.m_normals[j].Y)*q)))};ClipperLib.ClipperOffset.prototype.DoRound=function(j,k){var a=Math.atan2(this.m_sinA,this.m_normals[k].X*this.m_normals[j].X+this.m_normals[k].Y*this.m_normals[j].Y);var steps=Math.max(ClipperLib.Cast_Int32(ClipperLib.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(a))),1);var X=this.m_normals[k].X,Y=this.m_normals[k].Y,X2;for(var i=0;i<steps;++i){this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+X*this.m_delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+Y*this.m_delta)));X2=X;X=X*this.m_cos-this.m_sin*Y;Y=X2*this.m_sin+Y*this.m_cos}this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_normals[j].X*this.m_delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_normals[j].Y*this.m_delta)))};ClipperLib.Error=function(message){try{throw new Error(message)}catch(err){alert(err.message)}};ClipperLib.JS={};ClipperLib.JS.AreaOfPolygon=function(poly,scale){if(!scale)scale=1;return ClipperLib.Clipper.Area(poly)/(scale*scale)};ClipperLib.JS.AreaOfPolygons=function(poly,scale){if(!scale)scale=1;var area=0;for(var i=0;i<poly.length;i++){area+=ClipperLib.Clipper.Area(poly[i])}return area/(scale*scale)};ClipperLib.JS.BoundsOfPath=function(path,scale){return ClipperLib.JS.BoundsOfPaths([path],scale)};ClipperLib.JS.BoundsOfPaths=function(paths,scale){if(!scale)scale=1;var bounds=ClipperLib.Clipper.GetBounds(paths);bounds.left/=scale;bounds.bottom/=scale;bounds.right/=scale;bounds.top/=scale;return bounds};ClipperLib.JS.Clean=function(polygon,delta){if(!(polygon instanceof Array))return[];var isPolygons=polygon[0]instanceof Array;var polygon=ClipperLib.JS.Clone(polygon);if("number"!=typeof delta||null===delta){ClipperLib.Error("Delta is not a number in Clean().");return polygon}if(0===polygon.length||1==polygon.length&&0===polygon[0].length||0>delta)return polygon;if(!isPolygons)polygon=[polygon];var k_length=polygon.length;var len,poly,result,d,p,j,i;var results=[];for(var k=0;k<k_length;k++){poly=polygon[k];len=poly.length;if(0===len)continue;else if(3>len){result=poly;results.push(result);continue}result=poly;d=delta*delta;p=poly[0];j=1;for(i=1;i<len;i++){if((poly[i].X-p.X)*(poly[i].X-p.X)+(poly[i].Y-p.Y)*(poly[i].Y-p.Y)<=d)continue;result[j]=poly[i];p=poly[i];j++}p=poly[j-1];if((poly[0].X-p.X)*(poly[0].X-p.X)+(poly[0].Y-p.Y)*(poly[0].Y-p.Y)<=d)j--;if(j<len)result.splice(j,len-j);if(result.length)results.push(result)}if(!isPolygons&&results.length)results=results[0];else if(!isPolygons&&0===results.length)results=[];else if(isPolygons&&0===results.length)results=[[]];return results};ClipperLib.JS.Clone=function(polygon){if(!(polygon instanceof Array))return[];if(0===polygon.length)return[];else if(1==polygon.length&&0===polygon[0].length)return[[]];var isPolygons=polygon[0]instanceof Array;if(!isPolygons)polygon=[polygon];var len=polygon.length,plen,i,j,result;var results=new Array(len);for(i=0;i<len;i++){plen=polygon[i].length;result=new Array(plen);for(j=0;j<plen;j++){result[j]={X:polygon[i][j].X,Y:polygon[i][j].Y}}results[i]=result}if(!isPolygons)results=results[0];return results};ClipperLib.JS.Lighten=function(polygon,tolerance){if(!(polygon instanceof Array))return[];if("number"!=typeof tolerance||null===tolerance){ClipperLib.Error("Tolerance is not a number in Lighten().");return ClipperLib.JS.Clone(polygon)}if(0===polygon.length||1==polygon.length&&0===polygon[0].length||0>tolerance){return ClipperLib.JS.Clone(polygon)}if(!(polygon[0]instanceof Array))polygon=[polygon];var i,j,poly,k,poly2,plen,A,B,P,d,rem,addlast;var bxax,byay,l,ax,ay;var len=polygon.length;var toleranceSq=tolerance*tolerance;var results=[];for(i=0;i<len;i++){poly=polygon[i];plen=poly.length;if(0==plen)continue;for(k=0;1000000>k;k++){poly2=[];plen=poly.length;if(poly[plen-1].X!=poly[0].X||poly[plen-1].Y!=poly[0].Y){addlast=1;poly.push({X:poly[0].X,Y:poly[0].Y});plen=poly.length}else addlast=0;rem=[];for(j=0;j<plen-2;j++){A=poly[j];P=poly[j+1];B=poly[j+2];ax=A.X;ay=A.Y;bxax=B.X-ax;byay=B.Y-ay;if(0!==bxax||0!==byay){l=((P.X-ax)*bxax+(P.Y-ay)*byay)/(bxax*bxax+byay*byay);if(1<l){ax=B.X;ay=B.Y}else if(0<l){ax+=bxax*l;ay+=byay*l}}bxax=P.X-ax;byay=P.Y-ay;d=bxax*bxax+byay*byay;if(d<=toleranceSq){rem[j+1]=1;j++}}poly2.push({X:poly[0].X,Y:poly[0].Y});for(j=1;j<plen-1;j++)if(!rem[j])poly2.push({X:poly[j].X,Y:poly[j].Y});poly2.push({X:poly[plen-1].X,Y:poly[plen-1].Y});if(addlast)poly.pop();if(!rem.length)break;else poly=poly2}plen=poly2.length;if(poly2[plen-1].X==poly2[0].X&&poly2[plen-1].Y==poly2[0].Y){poly2.pop()}if(2<poly2.length)results.push(poly2)}if(!(polygon[0]instanceof Array))results=results[0];if("undefined"==typeof results)results=[[]];return results};ClipperLib.JS.PerimeterOfPath=function(path,closed,scale){if("undefined"==typeof path)return 0;var sqrt=Math.sqrt;var perimeter=0;var p1,p2,p1x=0,p1y=0,p2x=0,p2y=0;var j=path.length;if(2>j)return 0;if(closed){path[j]=path[0];j++}while(--j){p1=path[j];p1x=p1.X;p1y=p1.Y;p2=path[j-1];p2x=p2.X;p2y=p2.Y;perimeter+=sqrt((p1x-p2x)*(p1x-p2x)+(p1y-p2y)*(p1y-p2y))}if(closed)path.pop();return perimeter/scale};ClipperLib.JS.PerimeterOfPaths=function(paths,closed,scale){if(!scale)scale=1;var perimeter=0;for(var i=0;i<paths.length;i++){perimeter+=ClipperLib.JS.PerimeterOfPath(paths[i],closed,scale)}return perimeter};ClipperLib.JS.ScaleDownPath=function(path,scale){var i,p;if(!scale)scale=1;i=path.length;while(i--){p=path[i];p.X=p.X/scale;p.Y=p.Y/scale}};ClipperLib.JS.ScaleDownPaths=function(paths,scale){var i,j,p;if(!scale)scale=1;i=paths.length;while(i--){j=paths[i].length;while(j--){p=paths[i][j];p.X=p.X/scale;p.Y=p.Y/scale}}};ClipperLib.JS.ScaleUpPath=function(path,scale){var i,p,round=Math.round;if(!scale)scale=1;i=path.length;while(i--){p=path[i];p.X=round(p.X*scale);p.Y=round(p.Y*scale)}};ClipperLib.JS.ScaleUpPaths=function(paths,scale){var i,j,p,round=Math.round;if(!scale)scale=1;i=paths.length;while(i--){j=paths[i].length;while(j--){p=paths[i][j];p.X=round(p.X*scale);p.Y=round(p.Y*scale)}}};ClipperLib.ExPolygons=function(){return[]};ClipperLib.ExPolygon=function(){this.outer=null;this.holes=null};ClipperLib.JS.AddOuterPolyNodeToExPolygons=function(polynode,expolygons){var ep=new ClipperLib.ExPolygon;ep.outer=polynode.Contour();var childs=polynode.Childs();var ilen=childs.length;ep.holes=new Array(ilen);var node,n,i,j,childs2,jlen;for(i=0;i<ilen;i++){node=childs[i];ep.holes[i]=node.Contour();for(j=0,childs2=node.Childs(),jlen=childs2.length;j<jlen;j++){n=childs2[j];ClipperLib.JS.AddOuterPolyNodeToExPolygons(n,expolygons)}}expolygons.push(ep)};ClipperLib.JS.ExPolygonsToPaths=function(expolygons){var a,i,alen,ilen;var paths=new ClipperLib.Paths;for(a=0,alen=expolygons.length;a<alen;a++){paths.push(expolygons[a].outer);for(i=0,ilen=expolygons[a].holes.length;i<ilen;i++){paths.push(expolygons[a].holes[i])}}return paths};ClipperLib.JS.PolyTreeToExPolygons=function(polytree){var expolygons=new ClipperLib.ExPolygons;var node,i,childs,ilen;for(i=0,childs=polytree.Childs(),ilen=childs.length;i<ilen;i++){node=childs[i];ClipperLib.JS.AddOuterPolyNodeToExPolygons(node,expolygons)}return expolygons}})();;;d3.selection.prototype.trigger=function(type){this.each(function(){var evt=document.createEvent("HTMLEvents");evt.initEvent(type,true,true);this.dispatchEvent(evt)})};;;d3.jsonp=function(url,callback){function rand(){var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",c="",i=-1;while(15>++i)c+=chars.charAt(Math.floor(52*Math.random()));return c}function create(url){var e=url.match(/callback=d3.jsonp.(\w+)/),c=e?e[1]:rand();d3.jsonp[c]=function(data){callback(data);delete d3.jsonp[c];script.remove()};return"d3.jsonp."+c}var cb=create(url),script=d3.select("head").append("script").attr("type","text/javascript").attr("src",url.replace(/(\{|%7B)callback(\}|%7D)/,cb));script.on("error",function(){var temp=eval(cb);temp([])})};;;;;(function(d3){var rnowhite=/\S+/g;var reventType=/^([.\w:-]*)\s*(.*)$/;var rprivate=/^_/;var widgetUuid=0;var noop=function(){};var extend=function(target){var input=Array.prototype.slice.call(arguments,1);var inputIndex=0;var inputLength=input.length;var key;var value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if(value&&value.constructor===Object){target[key]=target[key]&&target[key].constructor===Object?extend({},target[key],value):extend({},value)}else{target[key]=value}}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();d3.selection.prototype.remove=function(){return this.each(function(){var parent=this.parentNode;if(parent){parent.removeChild(this);this.dispatchEvent(new UIEvent("remove"))}})};d3.widget=function(name,base,prototype){var constructor,basePrototype;var proxiedPrototype={};if(!prototype){prototype=base;base=d3.Widget}if(Array.isArray(prototype)){prototype=extend.apply(null,[{}].concat(prototype))}var bak=window[name];window.eval(`var ${name} = function ${name}( selection, options ) {

            // Allow instantiation without "new" keyword
            if ( !this._createWidget ) {
                return new ${name}( selection, options );
            }

            // Allow instantiation without initializing for simple inheritance
            // must use "new" keyword (the code above always passes args)
            if ( arguments.length ) {
                this._createWidget( selection, options );
            }
        }`);constructor=window[name];if("undefined"===typeof bak){delete window[name]}else{window[name]=bak}extend(constructor,{version:prototype.version,_proto:extend({},prototype)});basePrototype=new base;basePrototype.options=extend({},basePrototype.options);Object.keys(prototype).forEach(function(prop){var value=prototype[prop];if("function"!==typeof value){proxiedPrototype[prop]=value;return}proxiedPrototype[prop]=function(){function _super(){return base.prototype[prop].apply(this,arguments)}function _superApply(args){return base.prototype[prop].apply(this,args)}return function(){var __super=this._super;var __superApply=this._superApply;var returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}()});constructor.prototype=extend(basePrototype,{widgetEventPrefix:name},proxiedPrototype,{constructor:constructor,widgetName:name});return constructor};d3.Widget=function(){};d3.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"div",options:{classes:{},disabled:false},events:{},_createWidget:function(selection,options){this.element=d3.$(selection||document.createElement(this.defaultElement));this.uuid=widgetUuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.hoverable=[];this.focusable=[];this.bindings={};this.classesElementLookup={};this.dispatched=[];var element=this.element.node();this._on(true,this.element,{remove:function(){if(d3.event.target===element){this.destroy()}}});this.document=d3.select(element.style?element.ownerDocument:element.document||element);this.window=d3.select(this.document.node().defaultView||this.document.node().parentWindow);this.options=extend({},this.options,this._getCreateOptions(),options);this._on(this.events);this._create();if(this.options.disabled){this._setOptionDisabled(this.options.disabled)}this._dispatch("create",this._getCreateEventData())},_getCreateOptions:function(){return{}},_getCreateEventData:noop,_create:noop,destroy:function(){var that=this;this._destroy();Object.keys(this.classesElementLookup).forEach(function(key){that._removeClass(that.classesElementLookup[key],key)});this.element.on(this.eventNamespace,null);this.widget().on(this.eventNamespace,null);Object.keys(this.bindings).forEach(function(eventName){that.bindings[eventName].forEach(function(element){element.on(that.eventNamespace,null)})})},_destroy:noop,widget:function(){return this.element},option:function(key,value){var options=key;var parts;var curOption;var i;if(0===arguments.length){return extend({},this.options)}if("string"===typeof key){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(1===arguments.length){return curOption[key]===undefined?null:curOption[key]}curOption[key]=value}else{if(1===arguments.length){return this.options[key]===undefined?null:this.options[key]}options[key]=value}}this._setOptions(options);return this},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key])}return this},_setOption:function(key,value){if("classes"===key){this._setOptionClasses(value)}this.options[key]=value;if("disabled"===key){this._setOptionDisabled(value)}return this},_setOptionClasses:function(value){var classKey,elements,currentElements;for(classKey in value){currentElements=this.classesElementLookup[classKey];if(value[classKey]===this.options.classes[classKey]||!currentElements||!currentElements.length){continue}elements=d3(currentElements.get());this._removeClass(currentElements,classKey);elements.classed(this._classes({element:elements,keys:classKey,classes:value,add:true}),true)}},_setOptionDisabled:function(value){this._toggleClass(this.widget(),"ui-state-disabled",null,!!value);if(value){this._removeClass(this.hoverable,null,"ui-state-hover");this._removeClass(this.focusable,null,"ui-state-focus")}},enable:function(){return this._setOptions({disabled:false})},disable:function(){return this._setOptions({disabled:true})},_classes:function(options){var full=[];var that=this;options=extend({element:this.element,classes:this.options.classes||{}},options);function processClassString(classes,checkOption){var current,i;for(i=0;i<classes.length;i++){current=that.classesElementLookup[classes[i]]||d3.selectAll([]);if(options.add){current=d3.selectAll(current[0].concat(options.element[0]))}else{current=current.filter(function(){var e=this;return!options.element.some(function(element){return e===element})})}that.classesElementLookup[classes[i]]=current;full.push(classes[i]);if(checkOption&&options.classes[classes[i]]){full.push(options.classes[classes[i]])}}}if(options.keys){processClassString(options.keys.match(rnowhite)||[],true)}if(options.extra){processClassString(options.extra.match(rnowhite)||[])}return full.join(" ")},_removeClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,false)},_addClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,true)},_toggleClass:function(element,keys,extra,add){add="boolean"===typeof add?add:extra;var shift="string"===typeof element||null===element,options={extra:shift?keys:extra,keys:shift?element:keys,element:shift?this.element:element,add:add};options.element.classed(this._classes(options),add);return this},on:function(type,handler){if(this.dispatched){var i=this.dispatched.indexOf(type);if(-1<i){handler.apply(this,arguments);this.dispatched.splice(i,1);if(0===this.dispatched.length){this.dispatched=null}}}type=(this.widgetEventPrefix+":"+type).toLowerCase();this._on({[type]:function(){handler.apply(this,Array.prototype.slice.call(arguments,3))}})},_on:function(suppressDisabledCheck,element,handlers){var delegateElement;var instance=this;if("boolean"!==typeof suppressDisabledCheck){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false}if(!handlers){handlers=element;element=this.element;delegateElement=this.widget()}else{delegateElement=element=d3.$$(element)}Object.keys(handlers).forEach(function(event){var handler=handlers[event];function handlerProxy(){if(!suppressDisabledCheck&&(true===instance.options.disabled||d3.event.target.closest&&d3.event.target.closest(".ui-state-disabled"))){return}return("string"===typeof handler?instance[handler]:handler).apply(instance,arguments)}var match=event.match(reventType);var eventName=match[1]+instance.eventNamespace;var selector=match[2];if(selector){delegateElement.on(eventName,selector,handlerProxy)}else{element.on(eventName,handlerProxy)}element.each(function(){if(this!==instance.element.node()&&this!==instance.widget().node()){instance[match[1]]=instance[match[1]]||[];instance[match[1]].push(element)}})})},off:function(type){type=(this.widgetEventPrefix+":"+type).toLowerCase();this._off(this.element,type)},_off:function(element,eventName){if(1===arguments.length){eventName=element;element=this.element}eventName+=this.eventNamespace;element.on(eventName,null);var elements=this.bindings[eventName],i,j,e;if(elements){for(i=0;i<elements.length;i+=1){if(elements[i].size()!==element.size()){continue}for(j=0;j<elements[i].size();j+=1){if(elements[i][j]!==element[j]){break}}if(j===elements[i].size()){elements.splice(i,1);i-=1}}}},_delay:function(handler,delay){function handlerProxy(){return("string"===typeof handler?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_dispatch:function(type){var data=Array.prototype.slice.call(arguments,1);if(this.dispatched){this.dispatched.push(type)}type=(this.widgetEventPrefix+":"+type).toLowerCase();data.unshift(type);this.element.dispatch.apply(this.element,data)}};return d3.widget})(d3);;;;;(function(d3){function d3_selection_selector(selector){return"function"===typeof selector?selector:function(){return this.querySelector(selector)}}d3.$=function(nodes,context){if(nodes&&nodes.d3===d3.version){return d3.select(nodes.node())}else{if(context){context=d3.$$(context);var selector=d3_selection_selector(nodes);var subgroups=[],subgroup,subnode,group,node;for(var j=-1,m=context.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=context[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j))}else{subgroup.push(null)}}}Object.setPrototypeOf(subgroups,d3.selection.prototype);return subgroups}else{return d3.select(nodes)}}};d3.$$=function(nodes,context){if(nodes&&nodes.d3===d3.version){return nodes}else{if(nodes.nodeType){nodes=[nodes]}return(context?d3.$$(context):d3).selectAll(nodes)}};d3.selection.prototype.d3=d3.version;d3.selection.prototype.nodes=function(){return _.uniq(_.flatten(this))};d3.selection.prototype.dispatch=function(type){var eventInit={bubbles:true};var data=Array.prototype.slice.call(arguments,1);if(data.length){eventInit.detail=data}return this.each(function(){var customEvent=new CustomEvent(type,eventInit);this.dispatchEvent(customEvent)})};var reventType=/^([.\w:-]*)\s*(.*)$/;var dispatch=function(selector,listener,args){var current=d3.event.target,trigger=false;if(!selector){listener.apply(this,args.concat(d3.event.detail||[]));return}var delegateElements=Array.from(this.querySelectorAll(selector));for(;current&&current!==this;current=current.parentNode){trigger=delegateElements.some(function(element){return element===current});if(trigger){listener.apply(this,args.concat(d3.event.detail||[]));break}}};var d3On=d3.selection.prototype.on;d3.selection.prototype.on=function(type,selector,listener,capture){if("object"===typeof type){return d3On.call(this,type,"boolean"===typeof selector?selector:false)}if("string"!==typeof selector){capture=listener;listener=selector;selector=null}if("undefined"===typeof listener){return d3On.call(this,type)}return d3On.call(this,type,listener?function(){dispatch.call(this,selector,listener,Array.from(arguments))}:listener,capture)}})(d3);;;d3.keybinding=function(namespace){var bindings=[];function matches(binding,event){for(var p in binding.event){if(event[p]!=binding.event[p])return false}return!binding.capture===(event.eventPhase!==Event.CAPTURING_PHASE)}function capture(){for(var i=0;i<bindings.length;i++){var binding=bindings[i];if(matches(binding,d3.event)){binding.callback()}}}function bubble(){var tagName=d3.select(d3.event.target).node().tagName;if("INPUT"==tagName||"SELECT"==tagName||"TEXTAREA"==tagName){return}capture()}function keybinding(selection){selection=selection||d3.select(document);selection.on("keydown.capture"+namespace,capture,true);selection.on("keydown.bubble"+namespace,bubble,false);return keybinding}keybinding.off=function(selection){selection=selection||d3.select(document);selection.on("keydown.capture"+namespace,null);selection.on("keydown.bubble"+namespace,null);return keybinding};keybinding.on=function(code,callback,capture){var binding={event:{keyCode:0,shiftKey:false,ctrlKey:false,altKey:false,metaKey:false},capture:capture,callback:callback};code=code.toLowerCase().match(/(?:(?:[^+⇧⌃⌥⌘])+|[⇧⌃⌥⌘]|\+\+|^\+$)/g);for(var i=0;i<code.length;i++){if("++"===code[i])code[i]="+";if(code[i]in d3.keybinding.modifierCodes){binding.event[d3.keybinding.modifierProperties[d3.keybinding.modifierCodes[code[i]]]]=true}else if(code[i]in d3.keybinding.keyCodes){binding.event.keyCode=d3.keybinding.keyCodes[code[i]]}}bindings.push(binding);return keybinding};return keybinding};;;(function(){d3.keybinding.modifierCodes={"⇧":16,shift:16,"⌃":17,ctrl:17,"⌥":18,alt:18,option:18,"⌘":91,meta:91,cmd:91,super:91,win:91};d3.keybinding.modifierProperties={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"};d3.keybinding.keyCodes={"⌫":8,backspace:8,"⇥":9,"⇆":9,tab:9,"↩":13,return:13,enter:13,"⌅":13,pause:19,"pause-break":19,"⇪":20,caps:20,"caps-lock":20,"⎋":27,escape:27,esc:27,space:32,"↖":33,pgup:33,"page-up":33,"↘":34,pgdown:34,"page-down":34,"⇟":35,end:35,"⇞":36,home:36,ins:45,insert:45,"⌦":46,del:46,delete:46,"←":37,left:37,"arrow-left":37,"↑":38,up:38,"arrow-up":38,"→":39,right:39,"arrow-right":39,"↓":40,down:40,"arrow-down":40,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,dash:189,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostrophe:222};var ua=navigator.userAgent.toLowerCase(),firefox=-1!==ua.indexOf("firefox");if(firefox){d3.keybinding.keyCodes["+"]=61;d3.keybinding.keyCodes["plus"]=61;d3.keybinding.keyCodes["-"]=173;d3.keybinding.keyCodes.subtract=173}var i=95,n=0;while(106>++i){d3.keybinding.keyCodes["num-"+n]=i;++n}i=47;n=0;while(58>++i){d3.keybinding.keyCodes[n]=i;++n}i=111;n=1;while(136>++i){d3.keybinding.keyCodes["f"+n]=i;++n}i=64;while(91>++i){d3.keybinding.keyCodes[String.fromCharCode(i).toLowerCase()]=i}})();;;d3.curtain=function(){var event=d3.dispatch(),surface,tooltip,darkness;function curtain(selection){surface=selection.append("svg").attr("id","curtain").style({"z-index":1000,"pointer-events":"none",position:"absolute",top:0,left:0});darkness=surface.append("path").attr({x:0,y:0,class:"curtain-darkness"});d3.select(window).on("resize.curtain",resize);tooltip=selection.append("div").attr("class","tooltip").style("z-index",1002);tooltip.append("div").attr("class","tooltip-arrow");tooltip.append("div").attr("class","tooltip-inner");resize();function resize(){surface.attr({width:window.innerWidth,height:window.innerHeight});curtain.cut(darkness.datum())}}curtain.reveal=function(box,text,tooltipclass,duration){if("string"===typeof box)box=d3.select(box).node();if(box.getBoundingClientRect)box=box.getBoundingClientRect();curtain.cut(box,duration);if(text){var parts=text.split("**");var html=parts[0]?"<span>"+parts[0]+"</span>":"";if(parts[1])html+="<span class=\"bold\">"+parts[1]+"</span>";var dimensions=tooltip.classed("in",true).select(".tooltip-inner").html(html).dimensions();var pos;var w=window.innerWidth,h=window.innerHeight;if(box.top+box.height<Math.min(100,box.width+box.left)){side="bottom";pos=[box.left+box.width/2-dimensions[0]/2,box.top+box.height]}else if(box.left+box.width+300<window.innerWidth){side="right";pos=[box.left+box.width,box.top+box.height/2-dimensions[1]/2]}else if(300<box.left){side="left";pos=[box.left-200,box.top+box.height/2-dimensions[1]/2]}else{side="bottom";pos=[box.left,box.top+box.height]}pos=[Math.min(Math.max(10,pos[0]),w-dimensions[0]-10),Math.min(Math.max(10,pos[1]),h-dimensions[1]-10)];if(0!==duration||!tooltip.classed(side))tooltip.call(iD.ui.Toggle(true));tooltip.style("top",pos[1]+"px").style("left",pos[0]+"px").attr("class","curtain-tooltip tooltip in "+side+" "+tooltipclass).select(".tooltip-inner").html(html)}else{tooltip.call(iD.ui.Toggle(false))}};curtain.cut=function(datum,duration){darkness.datum(datum);(0===duration?darkness:darkness.transition().duration(duration||600)).attr("d",function(d){var string="M 0,0 L 0,"+window.innerHeight+" L "+window.innerWidth+","+window.innerHeight+"L"+window.innerWidth+",0 Z";if(!d)return string;return string+"M"+d.left+","+d.top+"L"+d.left+","+(d.top+d.height)+"L"+(d.left+d.width)+","+(d.top+d.height)+"L"+(d.left+d.width)+","+d.top+"Z"})};curtain.remove=function(){surface.remove();tooltip.remove()};return d3.rebind(curtain,event,"on")};;;d3.selection.prototype.one=function(type,listener,capture){var target=this,typeOnce=type+".once";function one(){target.on(typeOnce,null);listener.apply(this,arguments)}target.on(typeOnce,one,capture);return this};;;d3.selection.prototype.value=function(value){function d3_selection_value(value){function valueNull(){delete this.value}function valueConstant(){if(this.value!==value)this.value=value}function valueFunction(){var x=value.apply(this,arguments);if(null==x)delete this.value;else if(this.value!==x)this.value=x}return null==value?valueNull:"function"===typeof value?valueFunction:valueConstant}if(!arguments.length)return this.property("value");return this.each(d3_selection_value(value))};;;;;(function(){var d3_selectionPrototype=d3.selection.prototype,d3_on=d3_selectionPrototype.on;var shims={mouseenter:["mouseover",relatedTarget],mouseleave:["mouseout",relatedTarget]};d3_selectionPrototype.on=function(evt,callback,useCapture){var bits=evt.split("."),type=bits.shift(),shim=shims[type];if(shim){evt=bits.length?[shim[0],bits].join("."):shim[0];if("function"===typeof callback){callback=shim[1](callback)}return d3_on.call(this,evt,callback,useCapture)}else{return d3_on.apply(this,arguments)}};function relatedTarget(callback){return function(){var related=d3.event.relatedTarget;if(this===related||childOf(this,related)){return undefined}return callback.apply(this,arguments)}}function childOf(p,c){if(p===c)return false;while(c&&c!==p)c=c.parentNode;return c===p}})();;;;;(function(exports){var bootstrap="object"===typeof exports.bootstrap?exports.bootstrap:exports.bootstrap={};bootstrap.tooltip=function(){var tooltip=function(selection){selection.each(setup)},animation=d3.functor(false),html=d3.functor(false),title=function(){var title=this.getAttribute("data-original-title");if(title){return title}else{title=this.getAttribute("title");this.removeAttribute("title");this.setAttribute("data-original-title",title)}return title},over="mouseenter.tooltip",out="mouseleave.tooltip",placements="top left bottom right".split(" "),placement=d3.functor("top");tooltip.title=function(_){if(arguments.length){title=d3.functor(_);return tooltip}else{return title}};tooltip.html=function(_){if(arguments.length){html=d3.functor(_);return tooltip}else{return html}};tooltip.placement=function(_){if(arguments.length){placement=d3.functor(_);return tooltip}else{return placement}};tooltip.show=function(selection){selection.each(show)};tooltip.hide=function(selection){selection.each(hide)};tooltip.toggle=function(selection){selection.each(toggle)};tooltip.destroy=function(selection){selection.on(over,null).on(out,null).attr("title",function(){return this.getAttribute("data-original-title")||this.getAttribute("title")}).attr("data-original-title",null).select(".tooltip").remove()};function setup(){var root=d3.select(this),animate=animation.apply(this,arguments),tip=root.append("div").attr("class","tooltip");if(animate){tip.classed("fade",true)}tip.append("div").attr("class","tooltip-arrow");tip.append("div").attr("class","tooltip-inner");var place=placement.apply(this,arguments);tip.classed(place,true);root.on(over,show);root.on(out,hide)}function show(){var root=d3.select(this),content=title.apply(this,arguments),tip=root.select(".tooltip").classed("in",true),markup=html.apply(this,arguments),innercontent=tip.select(".tooltip-inner")[markup?"html":"text"](content),place=placement.apply(this,arguments),outer=getPosition(root.node()),inner=getPosition(tip.node()),pos;switch(place){case"top":pos={x:outer.x+(outer.w-inner.w)/2,y:outer.y-inner.h};break;case"right":pos={x:outer.x+outer.w,y:outer.y+(outer.h-inner.h)/2};break;case"left":pos={x:outer.x-inner.w,y:outer.y+(outer.h-inner.h)/2};break;case"bottom":pos={x:Math.max(0,outer.x+(outer.w-inner.w)/2),y:outer.y+outer.h};break;}tip.style(pos?{left:~~pos.x+"px",top:~~pos.y+"px"}:{left:null,top:null});this.tooltipVisible=true}function hide(){d3.select(this).select(".tooltip").classed("in",false);this.tooltipVisible=false}function toggle(){if(this.tooltipVisible){hide.apply(this,arguments)}else{show.apply(this,arguments)}}return tooltip};function getPosition(node){var mode=d3.select(node).style("position");if("absolute"===mode||"static"===mode){return{x:node.offsetLeft,y:node.offsetTop,w:node.offsetWidth,h:node.offsetHeight}}else{return{x:0,y:0,w:node.offsetWidth,h:node.offsetHeight}}}})(window);;;;;(function(exports){var bootstrap="object"===typeof exports.bootstrap?exports.bootstrap:exports.bootstrap={};bootstrap.pagination=function(){var pageIndex=1,pageSize=10,total=0,pageCount=0,event=d3.dispatch("change");var pagination=function(selection){pageCount=Math.ceil(total/pageSize);if(0==total)return;selection.append("span").attr("class","count").html("<label class=\"current\">"+pageIndex+"</label>/"+pageCount+"&nbsp;"+t("pagination.total")+"<label class=\"total\">"+total+"</label>");function click(p){selection.selectAll(".current").html(pageIndex);drawLink();event.change(p)}function drawLink(){var linkWrapper=selection.selectAll(".link").data([0]);var $enter=linkWrapper.enter().append("span").attr("class","link");$enter.append("a").attr("class","first").html(t("pagination.first"));$enter.append("a").attr("class","pre").html(t("pagination.pre"));$enter.append("a").attr("class","next").html(t("pagination.next"));var firstPage=selection.selectAll(".first"),prePage=selection.selectAll(".pre"),nextPage=selection.selectAll(".next");firstPage.classed("disabled",!(0<pageIndex-1)).on("click",null);prePage.classed("disabled",!(0<pageIndex-1)).on("click",null);nextPage.classed("disabled",!(pageIndex+1<=pageCount)).on("click",null);if(0<pageIndex-1){firstPage.attr("href","javascript:void(0);").on("click",function(){pageIndex=1;click(pageIndex)});prePage.attr("href","javascript:void(0);").on("click",function(){pageIndex=pageIndex-1;click(pageIndex)})}if(pageIndex+1<=pageCount){nextPage.attr("href","javascript:void(0);").on("click",function(){pageIndex=pageIndex+1;click(pageIndex)})}linkWrapper.exit().remove()}drawLink()};pagination.pageIndex=function(_){if(!arguments.length)return pagination;pageIndex=_;return pagination};pagination.pageSize=function(_){if(!arguments.length)return pagination;pageSize=_;return pagination};pagination.total=function(_){if(!arguments.length)return pagination;total=_;return pagination};return d3.rebind(pagination,event,"on")}})(window);;;;;(function(exports){var bootstrap="object"===typeof exports.bootstrap?exports.bootstrap:exports.bootstrap={};bootstrap.tabs=function(){var event=d3.dispatch("change");var tabs=function(id,controlId){var element=d3.select("#"+id),control=d3.select("#"+controlId);element.selectAll("li").on("click",function(){var tabName=d3.select(this).attr("data-tab");changeTab(tabName)});var controlFilter=function(){var tabName=d3.select(this).attr("data-tab");if(tabName&&0<tabName.length){return true}return false};function changeTab(tabName){element.selectAll("li").classed("active",false);element.selectAll("li").filter(function(){if(d3.select(this).attr("data-tab")===tabName){return true}}).classed("active",true);control.selectAll("div").filter(controlFilter).style("display","none");control.selectAll("div").filter(controlFilter).filter(function(){if(d3.select(this).attr("data-tab")===tabName){return true}}).style("display","block");event.change(tabName)}var firstName=element.selectAll("li").filter(":first-child").attr("data-tab");changeTab(firstName)};return d3.rebind(tabs,event,"on")}})(window);;;;;(function(){"use strict";function rbush(maxEntries,format){if(!(this instanceof rbush)){return new rbush(maxEntries,format)}this._maxEntries=Math.max(4,maxEntries||9);this._minEntries=Math.max(2,Math.ceil(0.4*this._maxEntries));if(format){this._initFormat(format)}this.clear()}rbush.prototype={all:function(){return this._all(this.data,[])},search:function(bbox){var node=this.data,result=[];if(!this._intersects(bbox,node.bbox)){return result}var nodesToSearch=[],i,len,child,childBBox;while(node){for(i=0,len=node.children.length;i<len;i++){child=node.children[i];childBBox=node.leaf?this.toBBox(child):child.bbox;if(this._intersects(bbox,childBBox)){if(node.leaf){result.push(child)}else if(this._contains(bbox,childBBox)){this._all(child,result)}else{nodesToSearch.push(child)}}}node=nodesToSearch.pop()}return result},load:function(data){if(!(data&&data.length)){return this}if(data.length<this._minEntries){for(var i=0,len=data.length;i<len;i++){this.insert(data[i])}return this}var node=this._build(data.slice(),0);if(!this.data.children.length){this.data=node}else if(this.data.height===node.height){this._splitRoot(this.data,node)}else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node;node=tmpNode}this._insert(node,this.data.height-node.height-1,true)}return this},insert:function(item){if(item){this._insert(item,this.data.height-1)}return this},clear:function(){this.data={children:[],leaf:true,bbox:this._empty(),height:1};return this},remove:function(item){if(!item){return this}var node=this.data,bbox=this.toBBox(item),path=[],indexes=[],i,parent,index,goingUp;while(node||path.length){if(!node){node=path.pop();parent=path[path.length-1];i=indexes.pop();goingUp=true}if(node.leaf){index=node.children.indexOf(item);if(-1!==index){node.children.splice(index,1);path.push(node);this._condense(path);return this}}if(!goingUp&&!node.leaf&&this._intersects(bbox,node.bbox)){path.push(node);indexes.push(i);i=0;parent=node;node=node.children[0]}else if(parent){i++;node=parent.children[i];goingUp=false}else{node=null}}return this},toBBox:function(item){return item},compareMinX:function(a,b){return a[0]-b[0]},compareMinY:function(a,b){return a[1]-b[1]},toJSON:function(){return this.data},fromJSON:function(data){this.data=data;return this},_all:function(node,result){var nodesToSearch=[];while(node){if(node.leaf){result.push.apply(result,node.children)}else{nodesToSearch.push.apply(nodesToSearch,node.children)}node=nodesToSearch.pop()}return result},_build:function(items,level,height){var N=items.length,M=this._maxEntries,node;if(N<=M){node={children:items,leaf:true,height:1};this._calcBBox(node);return node}if(!level){height=Math.ceil(Math.log(N)/Math.log(M));M=Math.ceil(N/Math.pow(M,height-1));items.sort(this.compareMinX)}node={children:[],height:height};var N1=Math.ceil(N/M)*Math.ceil(Math.sqrt(M)),N2=Math.ceil(N/M),compare=1===level%2?this.compareMinX:this.compareMinY,i,j,slice,sliceLen,childNode;for(i=0;i<N;i+=N1){slice=items.slice(i,i+N1).sort(compare);for(j=0,sliceLen=slice.length;j<sliceLen;j+=N2){childNode=this._build(slice.slice(j,j+N2),level+1,height-1);node.children.push(childNode)}}this._calcBBox(node);return node},_chooseSubtree:function(bbox,node,level,path){var i,len,child,targetNode,area,enlargement,minArea,minEnlargement;while(true){path.push(node);if(node.leaf||path.length-1===level){break}minArea=minEnlargement=Infinity;for(i=0,len=node.children.length;i<len;i++){child=node.children[i];area=this._area(child.bbox);enlargement=this._enlargedArea(bbox,child.bbox)-area;if(enlargement<minEnlargement){minEnlargement=enlargement;minArea=area<minArea?area:minArea;targetNode=child}else if(enlargement===minEnlargement){if(area<minArea){minArea=area;targetNode=child}}}node=targetNode}return node},_insert:function(item,level,isNode,root){var bbox=isNode?item.bbox:this.toBBox(item),insertPath=[];var node=this._chooseSubtree(bbox,root||this.data,level,insertPath),splitOccured;node.children.push(item);this._extend(node.bbox,bbox);do{splitOccured=false;if(insertPath[level].children.length>this._maxEntries){this._split(insertPath,level);splitOccured=true;level--}}while(0<=level&&splitOccured);this._adjustParentBBoxes(bbox,insertPath,level)},_split:function(insertPath,level){var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var newNode={children:node.children.splice(this._chooseSplitIndex(node,m,M)),height:node.height};if(node.leaf){newNode.leaf=true}this._calcBBox(node);this._calcBBox(newNode);if(level){insertPath[level-1].children.push(newNode)}else{this._splitRoot(node,newNode)}},_splitRoot:function(node,newNode){this.data={};this.data.children=[node,newNode];this.data.height=node.height+1;this._calcBBox(this.data)},_chooseSplitIndex:function(node,m,M){var i,bbox1,bbox2,overlap,area,minOverlap,minArea,index;minOverlap=minArea=Infinity;for(i=m;i<=M-m;i++){bbox1=this._distBBox(node,0,i);bbox2=this._distBBox(node,i,M);overlap=this._intersectionArea(bbox1,bbox2);area=this._area(bbox1)+this._area(bbox2);if(overlap<minOverlap){minOverlap=overlap;index=i;minArea=area<minArea?area:minArea}else if(overlap===minOverlap){if(area<minArea){minArea=area;index=i}}}return index},_chooseSplitAxis:function(node,m,M){var compareMinX=node.leaf?this.compareMinX:this._compareNodeMinX,compareMinY=node.leaf?this.compareMinY:this._compareNodeMinY,xMargin=this._allDistMargin(node,m,M,compareMinX),yMargin=this._allDistMargin(node,m,M,compareMinY);if(xMargin<yMargin){node.children.sort(compareMinX)}},_allDistMargin:function(node,m,M,compare){node.children.sort(compare);var leftBBox=this._distBBox(node,0,m),rightBBox=this._distBBox(node,M-m,M),margin=this._margin(leftBBox)+this._margin(rightBBox),i,child;for(i=m;i<M-m;i++){child=node.children[i];this._extend(leftBBox,node.leaf?this.toBBox(child):child.bbox);margin+=this._margin(leftBBox)}for(i=M-m-1;0<=i;i--){child=node.children[i];this._extend(rightBBox,node.leaf?this.toBBox(child):child.bbox);margin+=this._margin(rightBBox)}return margin},_distBBox:function(node,k,p){var bbox=this._empty();for(var i=k,child;i<p;i++){child=node.children[i];this._extend(bbox,node.leaf?this.toBBox(child):child.bbox)}return bbox},_calcBBox:function(node){node.bbox=this._empty();for(var i=0,len=node.children.length,child;i<len;i++){child=node.children[i];this._extend(node.bbox,node.leaf?this.toBBox(child):child.bbox)}},_adjustParentBBoxes:function(bbox,path,level){for(var i=level;0<=i;i--){this._extend(path[i].bbox,bbox)}},_condense:function(path){for(var i=path.length-1,parent;0<=i;i--){if(0===path[i].children.length){if(0<i){parent=path[i-1].children;parent.splice(parent.indexOf(path[i]),1)}else{this.clear()}}else{this._calcBBox(path[i])}}},_contains:function(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&b[2]<=a[2]&&b[3]<=a[3]},_intersects:function(a,b){return b[0]<=a[2]&&b[1]<=a[3]&&b[2]>=a[0]&&b[3]>=a[1]},_extend:function(a,b){a[0]=Math.min(a[0],b[0]);a[1]=Math.min(a[1],b[1]);a[2]=Math.max(a[2],b[2]);a[3]=Math.max(a[3],b[3]);return a},_area:function(a){return(a[2]-a[0])*(a[3]-a[1])},_margin:function(a){return a[2]-a[0]+(a[3]-a[1])},_enlargedArea:function(a,b){return(Math.max(b[2],a[2])-Math.min(b[0],a[0]))*(Math.max(b[3],a[3])-Math.min(b[1],a[1]))},_intersectionArea:function(a,b){var minX=Math.max(a[0],b[0]),minY=Math.max(a[1],b[1]),maxX=Math.min(a[2],b[2]),maxY=Math.min(a[3],b[3]);return Math.max(0,maxX-minX)*Math.max(0,maxY-minY)},_empty:function(){return[Infinity,Infinity,-Infinity,-Infinity]},_compareNodeMinX:function(a,b){return a.bbox[0]-b.bbox[0]},_compareNodeMinY:function(a,b){return a.bbox[1]-b.bbox[1]},_initFormat:function(format){var compareArr=["return a"," - b",";"];this.compareMinX=new Function("a","b",compareArr.join(format[0]));this.compareMinY=new Function("a","b",compareArr.join(format[1]));this.toBBox=new Function("a","return [a"+format.join(", a")+"];")}};if("function"===typeof define&&define.amd){define(function(){return rbush})}else if("undefined"!==typeof module){module.exports=rbush}else if("undefined"!==typeof self){self.rbush=rbush}else{window.rbush=rbush}})();;;;;(function(e){if("function"==typeof bootstrap)bootstrap("sexagesimal",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeSexagesimal=e}else"undefined"!=typeof window?window.sexagesimal=e():global.sexagesimal=e()})(function(){var define,ses,bootstrap,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i="function"==typeof require&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=element;module.exports.pair=pair;module.exports.format=format;module.exports.formatPair=formatPair;function element(x,dims){return search(x,dims).val}function formatPair(x){return format(x.lat,"lat")+" "+format(x.lon,"lon")}function format(x,dim){var dirs={lat:["N","S"],lon:["E","W"]}[dim]||"",dir=dirs[0<=x?0:1],abs=Math.abs(x),whole=Math.floor(abs),fraction=abs-whole,fractionMinutes=60*fraction,minutes=Math.floor(fractionMinutes),seconds=Math.floor(60*(fractionMinutes-minutes));return whole+"\xB0 "+(minutes?minutes+"' ":"")+(seconds?seconds+"\" ":"")+dir}function search(x,dims,r){if(!dims)dims="NSEW";if("string"!==typeof x)return{val:null,regex:r};r=r||/[\s\,]*([\-|\—|\―]?[0-9.]+)°? *(?:([0-9.]+)['’′‘] *)?(?:([0-9.]+)(?:''|"|”|″) *)?([NSEW])?/gi;var m=r.exec(x);if(!m)return{val:null,regex:r};else if(m[4]&&-1===dims.indexOf(m[4]))return{val:null,regex:r};else return{val:((m[1]?parseFloat(m[1]):0)+(m[2]?parseFloat(m[2])/60:0)+(m[3]?parseFloat(m[3])/3600:0))*(m[4]&&"S"===m[4]||"W"===m[4]?-1:1),regex:r,raw:m[0],dim:m[4]}}function pair(x,dims){x=x.trim();var one=search(x,dims);if(null===one.val)return null;var two=search(x,dims,one.regex);if(null===two.val)return null;if(one.raw+two.raw!==x)return null;if(one.dim)return swapdim(one.val,two.val,one.dim);else return[one.val,two.val]}function swapdim(a,b,dim){if("N"==dim||"S"==dim)return[a,b];if("W"==dim||"E"==dim)return[b,a]}},{}]},{},[1])(1)});;;;(function(window){var removeSpace=/\s*/g,trimSpace=/^\s*|\s*$/g,splitSpace=/\s+/;function okhash(x){if(!x||!x.length)return 0;for(var i=0,h=0;i<x.length;i++){h=0|(h<<5)-h+x.charCodeAt(i)}return h}function get(x,y){return x.getElementsByTagName(y)}function attr(x,y){return x.getAttribute(y)}function attrf(x,y){return parseFloat(attr(x,y))}function get1(x,y){var n=get(x,y);return n.length?n[0]:null}function norm(el){if(el.normalize){el.normalize()}return el}function numarray(x){for(var j=0,o=[];j<x.length;j++)o[j]=parseFloat(x[j]);return o}function clean(x){var o={};for(var i in x)if(x[i])o[i]=x[i];return o}function nodeVal(x){if(x){norm(x)}return x&&x.firstChild&&x.firstChild.nodeValue}function coord1(v){return numarray(v.replace(removeSpace,"").split(","))}function coord(v){var coords=v.replace(trimSpace,"").split(splitSpace),o=[];for(var i=0;i<coords.length;i++){o.push(coord1(coords[i]))}return o}function coordPair(x){return[attrf(x,"lon"),attrf(x,"lat")]}function fc(){return{type:"FeatureCollection",features:[]}}var styleSupport=false;if("undefined"!==typeof XMLSerializer){var serializer=new XMLSerializer;styleSupport=true}function xml2str(str){return serializer.serializeToString(str)}var t={kml:function(doc,o){o=o||{};var gj=fc(),styleIndex={},geotypes=["Polygon","LineString","Point","Track"],placemarks=get(doc,"Placemark"),styles=get(doc,"Style");if(styleSupport)for(var k=0;k<styles.length;k++){styleIndex["#"+attr(styles[k],"id")]=okhash(xml2str(styles[k])).toString(16)}for(var j=0;j<placemarks.length;j++){gj.features=gj.features.concat(getPlacemark(placemarks[j]))}function gxCoord(v){return numarray(v.split(" "))}function gxCoords(root){var elems=get(root,"coord","gx"),coords=[];for(var i=0;i<elems.length;i++)coords.push(gxCoord(nodeVal(elems[i])));return coords}function getGeometry(root){var geomNode,geomNodes,i,j,k,geoms=[];if(get1(root,"MultiGeometry"))return getGeometry(get1(root,"MultiGeometry"));if(get1(root,"MultiTrack"))return getGeometry(get1(root,"MultiTrack"));for(i=0;i<geotypes.length;i++){geomNodes=get(root,geotypes[i]);if(geomNodes){for(j=0;j<geomNodes.length;j++){geomNode=geomNodes[j];if("Point"==geotypes[i]){geoms.push({type:"Point",coordinates:coord1(nodeVal(get1(geomNode,"coordinates")))})}else if("LineString"==geotypes[i]){geoms.push({type:"LineString",coordinates:coord(nodeVal(get1(geomNode,"coordinates")))})}else if("Polygon"==geotypes[i]){var rings=get(geomNode,"LinearRing"),coords=[];for(k=0;k<rings.length;k++){coords.push(coord(nodeVal(get1(rings[k],"coordinates"))))}geoms.push({type:"Polygon",coordinates:coords})}else if("Track"==geotypes[i]){geoms.push({type:"LineString",coordinates:gxCoords(geomNode)})}}}}return geoms}function getPlacemark(root){var geoms=getGeometry(root),i,properties={},name=nodeVal(get1(root,"name")),styleUrl=nodeVal(get1(root,"styleUrl")),description=nodeVal(get1(root,"description")),extendedData=get1(root,"ExtendedData");if(!geoms.length)return[];if(name)properties.name=name;if(styleUrl&&styleIndex[styleUrl]){properties.styleUrl=styleUrl;properties.styleHash=styleIndex[styleUrl]}if(description)properties.description=description;if(extendedData){var datas=get(extendedData,"Data"),simpleDatas=get(extendedData,"SimpleData");for(i=0;i<datas.length;i++){properties[datas[i].getAttribute("name")]=nodeVal(get1(datas[i],"value"))}for(i=0;i<simpleDatas.length;i++){properties[simpleDatas[i].getAttribute("name")]=nodeVal(simpleDatas[i])}}return[{type:"Feature",geometry:1===geoms.length?geoms[0]:{type:"GeometryCollection",geometries:geoms},properties:properties}]}return gj},gpx:function(doc,o){var i,tracks=get(doc,"trk"),routes=get(doc,"rte"),waypoints=get(doc,"wpt"),gj=fc();for(i=0;i<tracks.length;i++){gj.features.push(getLinestring(tracks[i],"trkpt"))}for(i=0;i<routes.length;i++){gj.features.push(getLinestring(routes[i],"rtept"))}for(i=0;i<waypoints.length;i++){gj.features.push(getPoint(waypoints[i]))}function getLinestring(node,pointname){var j,pts=get(node,pointname),line=[];for(j=0;j<pts.length;j++){line.push(coordPair(pts[j]))}return{type:"Feature",properties:getProperties(node),geometry:{type:"LineString",coordinates:line}}}function getPoint(node){var prop=getProperties(node);prop.ele=nodeVal(get1(node,"ele"));prop.sym=nodeVal(get1(node,"sym"));return{type:"Feature",properties:prop,geometry:{type:"Point",coordinates:coordPair(node)}}}function getProperties(node){var meta=["name","desc","author","copyright","link","time","keywords"],prop={},k;for(k=0;k<meta.length;k++){prop[meta[k]]=nodeVal(get1(node,meta[k]))}return clean(prop)}return gj}};window.toGeoJSON=t})(window);if("undefined"!==typeof module)module.exports=window.toGeoJSON;;;;(function(){var block={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:noop,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:noop,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:noop,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};block.bullet=/(?:[*+-]|\d+\.)/;block.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/;block.item=replace(block.item,"gm")(/bull/g,block.bullet)();block.list=replace(block.list)(/bull/g,block.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)();block._tag="(?!(?:"+"a|em|strong|small|s|cite|q|dfn|abbr|data|time|code"+"|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo"+"|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b";block.html=replace(block.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,block._tag)();block.paragraph=replace(block.paragraph)("hr",block.hr)("heading",block.heading)("lheading",block.lheading)("blockquote",block.blockquote)("tag","<"+block._tag)("def",block.def)();block.normal=merge({},block);block.gfm=merge({},block.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/});block.gfm.paragraph=replace(block.paragraph)("(?!","(?!"+block.gfm.fences.source.replace("\\1","\\2")+"|")();block.tables=merge({},block.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/});function Lexer(options){this.tokens=[];this.tokens.links={};this.options=options||marked.defaults;this.rules=block.normal;if(this.options.gfm){if(this.options.tables){this.rules=block.tables}else{this.rules=block.gfm}}}Lexer.rules=block;Lexer.lex=function(src,options){var lexer=new Lexer(options);return lexer.lex(src)};Lexer.prototype.lex=function(src){src=src.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n");return this.token(src,true)};Lexer.prototype.token=function(src,top){var src=src.replace(/^ +$/gm,""),next,loose,cap,bull,b,item,space,i,l;while(src){if(cap=this.rules.newline.exec(src)){src=src.substring(cap[0].length);if(1<cap[0].length){this.tokens.push({type:"space"})}}if(cap=this.rules.code.exec(src)){src=src.substring(cap[0].length);cap=cap[0].replace(/^ {4}/gm,"");this.tokens.push({type:"code",text:!this.options.pedantic?cap.replace(/\n+$/,""):cap});continue}if(cap=this.rules.fences.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"code",lang:cap[2],text:cap[3]});continue}if(cap=this.rules.heading.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"heading",depth:cap[1].length,text:cap[2]});continue}if(top&&(cap=this.rules.nptable.exec(src))){src=src.substring(cap[0].length);item={type:"table",header:cap[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:cap[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:cap[3].replace(/\n$/,"").split("\n")};for(i=0;i<item.align.length;i++){if(/^ *-+: *$/.test(item.align[i])){item.align[i]="right"}else if(/^ *:-+: *$/.test(item.align[i])){item.align[i]="center"}else if(/^ *:-+ *$/.test(item.align[i])){item.align[i]="left"}else{item.align[i]=null}}for(i=0;i<item.cells.length;i++){item.cells[i]=item.cells[i].split(/ *\| */)}this.tokens.push(item);continue}if(cap=this.rules.lheading.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"heading",depth:"="===cap[2]?1:2,text:cap[1]});continue}if(cap=this.rules.hr.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"hr"});continue}if(cap=this.rules.blockquote.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"blockquote_start"});cap=cap[0].replace(/^ *> ?/gm,"");this.token(cap,top);this.tokens.push({type:"blockquote_end"});continue}if(cap=this.rules.list.exec(src)){src=src.substring(cap[0].length);bull=cap[2];this.tokens.push({type:"list_start",ordered:1<bull.length});cap=cap[0].match(this.rules.item);next=false;l=cap.length;i=0;for(;i<l;i++){item=cap[i];space=item.length;item=item.replace(/^ *([*+-]|\d+\.) +/,"");if(~item.indexOf("\n ")){space-=item.length;item=!this.options.pedantic?item.replace(new RegExp("^ {1,"+space+"}","gm"),""):item.replace(/^ {1,4}/gm,"")}if(this.options.smartLists&&i!==l-1){b=block.bullet.exec(cap[i+1])[0];if(bull!==b&&!(1<bull.length&&1<b.length)){src=cap.slice(i+1).join("\n")+src;i=l-1}}loose=next||/\n\n(?!\s*$)/.test(item);if(i!==l-1){next="\n"===item[item.length-1];if(!loose)loose=next}this.tokens.push({type:loose?"loose_item_start":"list_item_start"});this.token(item,false);this.tokens.push({type:"list_item_end"})}this.tokens.push({type:"list_end"});continue}if(cap=this.rules.html.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===cap[1]||"script"===cap[1],text:cap[0]});continue}if(top&&(cap=this.rules.def.exec(src))){src=src.substring(cap[0].length);this.tokens.links[cap[1].toLowerCase()]={href:cap[2],title:cap[3]};continue}if(top&&(cap=this.rules.table.exec(src))){src=src.substring(cap[0].length);item={type:"table",header:cap[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:cap[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:cap[3].replace(/(?: *\| *)?\n$/,"").split("\n")};for(i=0;i<item.align.length;i++){if(/^ *-+: *$/.test(item.align[i])){item.align[i]="right"}else if(/^ *:-+: *$/.test(item.align[i])){item.align[i]="center"}else if(/^ *:-+ *$/.test(item.align[i])){item.align[i]="left"}else{item.align[i]=null}}for(i=0;i<item.cells.length;i++){item.cells[i]=item.cells[i].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */)}this.tokens.push(item);continue}if(top&&(cap=this.rules.paragraph.exec(src))){src=src.substring(cap[0].length);this.tokens.push({type:"paragraph",text:"\n"===cap[1][cap[1].length-1]?cap[1].slice(0,-1):cap[1]});continue}if(cap=this.rules.text.exec(src)){src=src.substring(cap[0].length);this.tokens.push({type:"text",text:cap[0]});continue}if(src){throw new Error("Infinite loop on byte: "+src.charCodeAt(0))}}return this.tokens};var inline={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:noop,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:noop,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};inline._inside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/;inline._href=/\s*<?([^\s]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/;inline.link=replace(inline.link)("inside",inline._inside)("href",inline._href)();inline.reflink=replace(inline.reflink)("inside",inline._inside)();inline.normal=merge({},inline);inline.pedantic=merge({},inline.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/});inline.gfm=merge({},inline.normal,{escape:replace(inline.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:replace(inline.text)("]|","~]|")("|","|https?://|")()});inline.breaks=merge({},inline.gfm,{br:replace(inline.br)("{2,}","*")(),text:replace(inline.gfm.text)("{2,}","*")()});function InlineLexer(links,options){this.options=options||marked.defaults;this.links=links;this.rules=inline.normal;if(!this.links){throw new Error("Tokens array requires a `links` property.")}if(this.options.gfm){if(this.options.breaks){this.rules=inline.breaks}else{this.rules=inline.gfm}}else if(this.options.pedantic){this.rules=inline.pedantic}}InlineLexer.rules=inline;InlineLexer.output=function(src,links,options){var inline=new InlineLexer(links,options);return inline.output(src)};InlineLexer.prototype.output=function(src){var out="",link,text,href,cap;while(src){if(cap=this.rules.escape.exec(src)){src=src.substring(cap[0].length);out+=cap[1];continue}if(cap=this.rules.autolink.exec(src)){src=src.substring(cap[0].length);if("@"===cap[2]){text=":"===cap[1][6]?this.mangle(cap[1].substring(7)):this.mangle(cap[1]);href=this.mangle("mailto:")+text}else{text=escape(cap[1]);href=text}out+="<a href=\""+href+"\">"+text+"</a>";continue}if(cap=this.rules.url.exec(src)){src=src.substring(cap[0].length);text=escape(cap[1]);href=text;out+="<a href=\""+href+"\">"+text+"</a>";continue}if(cap=this.rules.tag.exec(src)){src=src.substring(cap[0].length);out+=this.options.sanitize?escape(cap[0]):cap[0];continue}if(cap=this.rules.link.exec(src)){src=src.substring(cap[0].length);out+=this.outputLink(cap,{href:cap[2],title:cap[3]});continue}if((cap=this.rules.reflink.exec(src))||(cap=this.rules.nolink.exec(src))){src=src.substring(cap[0].length);link=(cap[2]||cap[1]).replace(/\s+/g," ");link=this.links[link.toLowerCase()];if(!link||!link.href){out+=cap[0][0];src=cap[0].substring(1)+src;continue}out+=this.outputLink(cap,link);continue}if(cap=this.rules.strong.exec(src)){src=src.substring(cap[0].length);out+="<strong>"+this.output(cap[2]||cap[1])+"</strong>";continue}if(cap=this.rules.em.exec(src)){src=src.substring(cap[0].length);out+="<em>"+this.output(cap[2]||cap[1])+"</em>";continue}if(cap=this.rules.code.exec(src)){src=src.substring(cap[0].length);out+="<code>"+escape(cap[2],true)+"</code>";continue}if(cap=this.rules.br.exec(src)){src=src.substring(cap[0].length);out+="<br>";continue}if(cap=this.rules.del.exec(src)){src=src.substring(cap[0].length);out+="<del>"+this.output(cap[1])+"</del>";continue}if(cap=this.rules.text.exec(src)){src=src.substring(cap[0].length);out+=escape(cap[0]);continue}if(src){throw new Error("Infinite loop on byte: "+src.charCodeAt(0))}}return out};InlineLexer.prototype.outputLink=function(cap,link){if("!"!==cap[0][0]){return"<a href=\""+escape(link.href)+"\""+(link.title?" title=\""+escape(link.title)+"\"":"")+">"+this.output(cap[1])+"</a>"}else{return"<img src=\""+escape(link.href)+"\" alt=\""+escape(cap[1])+"\""+(link.title?" title=\""+escape(link.title)+"\"":"")+">"}};InlineLexer.prototype.smartypants=function(text){if(!this.options.smartypants)return text;return text.replace(/--/g,"\u2014").replace(/'([^']*)'/g,"\u2018$1\u2019").replace(/"([^"]*)"/g,"\u201C$1\u201D").replace(/\.{3}/g,"\u2026")};InlineLexer.prototype.mangle=function(text){var out="",l=text.length,i=0,ch;for(;i<l;i++){ch=text.charCodeAt(i);if(0.5<Math.random()){ch="x"+ch.toString(16)}out+="&#"+ch+";"}return out};function Parser(options){this.tokens=[];this.token=null;this.options=options||marked.defaults}Parser.parse=function(src,options){var parser=new Parser(options);return parser.parse(src)};Parser.prototype.parse=function(src){this.inline=new InlineLexer(src.links,this.options);this.tokens=src.reverse();var out="";while(this.next()){out+=this.tok()}return out};Parser.prototype.next=function(){return this.token=this.tokens.pop()};Parser.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0};Parser.prototype.parseText=function(){var body=this.token.text;while("text"===this.peek().type){body+="\n"+this.next().text}return this.inline.output(body)};Parser.prototype.tok=function(){switch(this.token.type){case"space":{return""}case"hr":{return"<hr>\n"}case"heading":{return"<h"+this.token.depth+">"+this.inline.output(this.token.text)+"</h"+this.token.depth+">\n"}case"code":{if(this.options.highlight){var code=this.options.highlight(this.token.text,this.token.lang);if(null!=code&&code!==this.token.text){this.token.escaped=true;this.token.text=code}}if(!this.token.escaped){this.token.text=escape(this.token.text,true)}return"<pre><code"+(this.token.lang?" class=\""+this.options.langPrefix+this.token.lang+"\"":"")+">"+this.token.text+"</code></pre>\n"}case"table":{var body="",heading,i,row,cell,j;body+="<thead>\n<tr>\n";for(i=0;i<this.token.header.length;i++){heading=this.inline.output(this.token.header[i]);body+=this.token.align[i]?"<th align=\""+this.token.align[i]+"\">"+heading+"</th>\n":"<th>"+heading+"</th>\n"}body+="</tr>\n</thead>\n";body+="<tbody>\n";for(i=0;i<this.token.cells.length;i++){row=this.token.cells[i];body+="<tr>\n";for(j=0;j<row.length;j++){cell=this.inline.output(row[j]);body+=this.token.align[j]?"<td align=\""+this.token.align[j]+"\">"+cell+"</td>\n":"<td>"+cell+"</td>\n"}body+="</tr>\n"}body+="</tbody>\n";return"<table>\n"+body+"</table>\n"}case"blockquote_start":{var body="";while("blockquote_end"!==this.next().type){body+=this.tok()}return"<blockquote>\n"+body+"</blockquote>\n"}case"list_start":{var type=this.token.ordered?"ol":"ul",body="";while("list_end"!==this.next().type){body+=this.tok()}return"<"+type+">\n"+body+"</"+type+">\n"}case"list_item_start":{var body="";while("list_item_end"!==this.next().type){body+="text"===this.token.type?this.parseText():this.tok()}return"<li>"+body+"</li>\n"}case"loose_item_start":{var body="";while("list_item_end"!==this.next().type){body+=this.tok()}return"<li>"+body+"</li>\n"}case"html":{return!this.token.pre&&!this.options.pedantic?this.inline.output(this.token.text):this.token.text}case"paragraph":{return"<p>"+this.inline.output(this.token.text)+"</p>\n"}case"text":{return"<p>"+this.parseText()+"</p>\n"}}};function escape(html,encode){return html.replace(!encode?/&(?!#?\w+;)/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function replace(regex,opt){regex=regex.source;opt=opt||"";return function self(name,val){if(!name)return new RegExp(regex,opt);val=val.source||val;val=val.replace(/(^|[^\[])\^/g,"$1");regex=regex.replace(name,val);return self}}function noop(){}noop.exec=noop;function merge(obj){var i=1,target,key;for(;i<arguments.length;i++){target=arguments[i];for(key in target){if(Object.prototype.hasOwnProperty.call(target,key)){obj[key]=target[key]}}}return obj}function marked(src,opt,callback){if(callback||"function"===typeof opt){if(!callback){callback=opt;opt=null}if(opt)opt=merge({},marked.defaults,opt);var tokens=Lexer.lex(tokens,opt),highlight=opt.highlight,pending=0,l=tokens.length,i=0;if(!highlight||3>highlight.length){return callback(null,Parser.parse(tokens,opt))}var done=function(){delete opt.highlight;var out=Parser.parse(tokens,opt);opt.highlight=highlight;return callback(null,out)};for(;i<l;i++){(function(token){if("code"!==token.type)return;pending++;return highlight(token.text,token.lang,function(err,code){if(null==code||code===token.text){return--pending||done()}token.text=code;token.escaped=true;--pending||done()})})(tokens[i])}return}try{if(opt)opt=merge({},marked.defaults,opt);return Parser.parse(Lexer.lex(src,opt),opt)}catch(e){e.message+="\nPlease report this to https://github.com/chjj/marked.";if((opt||marked.defaults).silent){return"<p>An error occured:</p><pre>"+escape(e.message+"",true)+"</pre>"}throw e}}marked.options=marked.setOptions=function(opt){merge(marked.defaults,opt);return marked};marked.defaults={gfm:true,tables:true,breaks:false,pedantic:false,sanitize:false,smartLists:false,silent:false,highlight:null,langPrefix:"lang-"};marked.Parser=Parser;marked.parser=Parser.parse;marked.Lexer=Lexer;marked.lexer=Lexer.lex;marked.InlineLexer=InlineLexer;marked.inlineLexer=InlineLexer.output;marked.parse=marked;if("object"===typeof exports){module.exports=marked}else if("function"===typeof define&&define.amd){define(function(){return marked})}else{this.marked=marked}}).call(function(){return this||("undefined"!==typeof window?window:global)}());;;;;(function defineMustache(global,factory){if("object"===typeof exports&&exports&&"string"!==typeof exports.nodeName){factory(exports)}else if("function"===typeof define&&define.amd){define(["exports"],factory)}else{global.Mustache={};factory(global.Mustache)}})(window,function mustacheFactory(mustache){var objectToString=Object.prototype.toString;var isArray=Array.isArray||function isArrayPolyfill(object){return"[object Array]"===objectToString.call(object)};function isFunction(object){return"function"===typeof object}function typeStr(obj){return isArray(obj)?"array":typeof obj}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function hasProperty(obj,propName){return null!=obj&&"object"===typeof obj&&propName in obj}var regExpTest=RegExp.prototype.test;function testRegExp(re,string){return regExpTest.call(re,string)}var nonSpaceRe=/\S/;function isWhitespace(string){return!testRegExp(nonSpaceRe,string)}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function escapeHtml(string){return String(string).replace(/[&<>"'`=\/]/g,function fromEntityMap(s){return entityMap[s]})}var whiteRe=/\s*/;var spaceRe=/\s+/;var equalsRe=/\s*=/;var curlyRe=/\s*\}/;var tagRe=/#|\^|\/|>|\{|&|=|!/;function parseTemplate(template,tags){if(!template)return[];var sections=[];var tokens=[];var spaces=[];var hasTag=false;var nonSpace=false;function stripSpace(){if(hasTag&&!nonSpace){while(spaces.length)delete tokens[spaces.pop()]}else{spaces=[]}hasTag=false;nonSpace=false}var openingTagRe,closingTagRe,closingCurlyRe;function compileTags(tagsToCompile){if("string"===typeof tagsToCompile)tagsToCompile=tagsToCompile.split(spaceRe,2);if(!isArray(tagsToCompile)||2!==tagsToCompile.length)throw new Error("Invalid tags: "+tagsToCompile);openingTagRe=new RegExp(escapeRegExp(tagsToCompile[0])+"\\s*");closingTagRe=new RegExp("\\s*"+escapeRegExp(tagsToCompile[1]));closingCurlyRe=new RegExp("\\s*"+escapeRegExp("}"+tagsToCompile[1]))}compileTags(tags||mustache.tags);var scanner=new Scanner(template);var start,type,value,chr,token,openSection;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(openingTagRe);if(value){for(var i=0,valueLength=value.length;i<valueLength;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length)}else{nonSpace=true}tokens.push(["text",chr,start,start+1]);start+=1;if("\n"===chr)stripSpace()}}if(!scanner.scan(openingTagRe))break;hasTag=true;type=scanner.scan(tagRe)||"name";scanner.scan(whiteRe);if("="===type){value=scanner.scanUntil(equalsRe);scanner.scan(equalsRe);scanner.scanUntil(closingTagRe)}else if("{"===type){value=scanner.scanUntil(closingCurlyRe);scanner.scan(curlyRe);scanner.scanUntil(closingTagRe);type="&"}else{value=scanner.scanUntil(closingTagRe)}if(!scanner.scan(closingTagRe))throw new Error("Unclosed tag at "+scanner.pos);token=[type,value,start,scanner.pos];tokens.push(token);if("#"===type||"^"===type){sections.push(token)}else if("/"===type){openSection=sections.pop();if(!openSection)throw new Error("Unopened section \""+value+"\" at "+start);if(openSection[1]!==value)throw new Error("Unclosed section \""+openSection[1]+"\" at "+start)}else if("name"===type||"{"===type||"&"===type){nonSpace=true}else if("="===type){compileTags(value)}}openSection=sections.pop();if(openSection)throw new Error("Unclosed section \""+openSection[1]+"\" at "+scanner.pos);return nestTokens(squashTokens(tokens))}function squashTokens(tokens){var squashedTokens=[];var token,lastToken;for(var i=0,numTokens=tokens.length;i<numTokens;++i){token=tokens[i];if(token){if("text"===token[0]&&lastToken&&"text"===lastToken[0]){lastToken[1]+=token[1];lastToken[3]=token[3]}else{squashedTokens.push(token);lastToken=token}}}return squashedTokens}function nestTokens(tokens){var nestedTokens=[];var collector=nestedTokens;var sections=[];var token,section;for(var i=0,numTokens=tokens.length;i<numTokens;++i){token=tokens[i];switch(token[0]){case"#":case"^":collector.push(token);sections.push(token);collector=token[4]=[];break;case"/":section=sections.pop();section[5]=token[2];collector=0<sections.length?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token);}}return nestedTokens}function Scanner(string){this.string=string;this.tail=string;this.pos=0}Scanner.prototype.eos=function eos(){return""===this.tail};Scanner.prototype.scan=function scan(re){var match=this.tail.match(re);if(!match||0!==match.index)return"";var string=match[0];this.tail=this.tail.substring(string.length);this.pos+=string.length;return string};Scanner.prototype.scanUntil=function scanUntil(re){var index=this.tail.search(re),match;switch(index){case-1:match=this.tail;this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index);this.tail=this.tail.substring(index);}this.pos+=match.length;return match};function Context(view,parentContext){this.view=view;this.cache={".":this.view};this.parent=parentContext}Context.prototype.push=function push(view){return new Context(view,this)};Context.prototype.lookup=function lookup(name){var cache=this.cache;var value;if(cache.hasOwnProperty(name)){value=cache[name]}else{var context=this,names,index,lookupHit=false;while(context){if(0<name.indexOf(".")){value=context.view;names=name.split(".");index=0;while(null!=value&&index<names.length){if(index===names.length-1)lookupHit=hasProperty(value,names[index]);value=value[names[index++]]}}else{value=context.view[name];lookupHit=hasProperty(context.view,name)}if(lookupHit)break;context=context.parent}cache[name]=value}if(isFunction(value))value=value.call(this.view);return value};function Writer(){this.cache={}}Writer.prototype.clearCache=function clearCache(){this.cache={}};Writer.prototype.parse=function parse(template,tags){var cache=this.cache;var tokens=cache[template];if(null==tokens)tokens=cache[template]=parseTemplate(template,tags);return tokens};Writer.prototype.render=function render(template,view,partials){var tokens=this.parse(template);var context=view instanceof Context?view:new Context(view);return this.renderTokens(tokens,context,partials,template)};Writer.prototype.renderTokens=function renderTokens(tokens,context,partials,originalTemplate){var buffer="";var token,symbol,value;for(var i=0,numTokens=tokens.length;i<numTokens;++i){value=undefined;token=tokens[i];symbol=token[0];if("#"===symbol)value=this.renderSection(token,context,partials,originalTemplate);else if("^"===symbol)value=this.renderInverted(token,context,partials,originalTemplate);else if(">"===symbol)value=this.renderPartial(token,context,partials,originalTemplate);else if("&"===symbol)value=this.unescapedValue(token,context);else if("name"===symbol)value=this.escapedValue(token,context);else if("text"===symbol)value=this.rawValue(token);if(value!==undefined)buffer+=value}return buffer};Writer.prototype.renderSection=function renderSection(token,context,partials,originalTemplate){var self=this;var buffer="";var value=context.lookup(token[1]);function subRender(template){return self.render(template,context,partials)}if(!value)return;if(isArray(value)){for(var j=0,valueLength=value.length;j<valueLength;++j){buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate)}}else if("object"===typeof value||"string"===typeof value||"number"===typeof value){buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate)}else if(isFunction(value)){if("string"!==typeof originalTemplate)throw new Error("Cannot use higher-order sections without the original template");value=value.call(context.view,originalTemplate.slice(token[3],token[5]),subRender);if(null!=value)buffer+=value}else{buffer+=this.renderTokens(token[4],context,partials,originalTemplate)}return buffer};Writer.prototype.renderInverted=function renderInverted(token,context,partials,originalTemplate){var value=context.lookup(token[1]);if(!value||isArray(value)&&0===value.length)return this.renderTokens(token[4],context,partials,originalTemplate)};Writer.prototype.renderPartial=function renderPartial(token,context,partials){if(!partials)return;var value=isFunction(partials)?partials(token[1]):partials[token[1]];if(null!=value)return this.renderTokens(this.parse(value),context,partials,value)};Writer.prototype.unescapedValue=function unescapedValue(token,context){var value=context.lookup(token[1]);if(null!=value)return value};Writer.prototype.escapedValue=function escapedValue(token,context){var value=context.lookup(token[1]);if(null!=value)return mustache.escape(value)};Writer.prototype.rawValue=function rawValue(token){return token[1]};mustache.name="mustache.js";mustache.version="2.2.1";mustache.tags=["{{","}}"];var defaultWriter=new Writer;mustache.clearCache=function clearCache(){return defaultWriter.clearCache()};mustache.parse=function parse(template,tags){return defaultWriter.parse(template,tags)};mustache.render=function render(template,view,partials){if("string"!==typeof template){throw new TypeError("Invalid template! Template should be a \"string\" "+"but \""+typeStr(template)+"\" was given as the first "+"argument for mustache#render(template, view, partials)")}return defaultWriter.render(template,view,partials)};mustache.to_html=function to_html(template,view,partials,send){var result=mustache.render(template,view,partials);if(isFunction(send)){send(result)}else{return result}};mustache.escape=escapeHtml;mustache.Scanner=Scanner;mustache.Context=Context;mustache.Writer=Writer});;;var __s__path=window.KDSEditorLibraryPath||"";var CROSSHAIRS_LOCATION=__s__path+"dist/img/colorpicker/crosshairs.png";var HUE_SLIDER_LOCATION=__s__path+"dist/img/colorpicker/h.png";var HUE_SLIDER_ARROWS_LOCATION=__s__path+"dist/img/colorpicker/position.png";var SAT_VAL_SQUARE_LOCATION=__s__path+"dist/img/colorpicker/sv.png";var HEIGHT_OF_OBJ=25;var WIDTH_OF_OBJ=150;var is_div_init=false;function hexToRgb(hex_string,default_){if(default_==undefined){default_=null}if("#"==hex_string.substr(0,1)){hex_string=hex_string.substr(1)}var r;var g;var b;if(3==hex_string.length){r=hex_string.substr(0,1);r+=r;g=hex_string.substr(1,1);g+=g;b=hex_string.substr(2,1);b+=b}else if(6==hex_string.length){r=hex_string.substr(0,2);g=hex_string.substr(2,2);b=hex_string.substr(4,2)}else{return default_}r=parseInt(r,16);g=parseInt(g,16);b=parseInt(b,16);if(isNaN(r)||isNaN(g)||isNaN(b)){return default_}else{return{r:r/255,g:g/255,b:b/255}}}function rgbToHex(r,g,b,includeHash){r=Math.round(255*r);g=Math.round(255*g);b=Math.round(255*b);if(includeHash==undefined){includeHash=true}r=r.toString(16);if(1==r.length){r="0"+r}g=g.toString(16);if(1==g.length){g="0"+g}b=b.toString(16);if(1==b.length){b="0"+b}return((includeHash?"#":"")+r+g+b).toUpperCase()}var arVersion=navigator.appVersion.split("MSIE");var version=parseFloat(arVersion[1]);function fixPNG(myImage){if(5.5<=version&&7>version&&document.body.filters){var node=document.createElement("span");node.id=myImage.id;node.className=myImage.className;node.title=myImage.title;node.style.cssText=myImage.style.cssText;node.style.setAttribute("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader"+"(src='"+myImage.src+"', sizingMethod='scale')");node.style.fontSize="0";node.style.width=myImage.width.toString()+"px";node.style.height=myImage.height.toString()+"px";node.style.display="inline-block";return node}else{return myImage.cloneNode(false)}}function trackDrag(node,handler){function fixCoords(x,y){var nodePageCoords=pageCoords(node);x=x-nodePageCoords.x+document.documentElement.scrollLeft;y=y-nodePageCoords.y+document.documentElement.scrollTop;if(0>x)x=0;if(0>y)y=0;if(x>node.offsetWidth-1)x=node.offsetWidth-1;if(y>node.offsetHeight-1)y=node.offsetHeight-1;return{x:x,y:y}}function mouseDown(ev){var coords=fixCoords(ev.clientX,ev.clientY);var lastX=coords.x;var lastY=coords.y;handler(coords.x,coords.y);function moveHandler(ev){var coords=fixCoords(ev.clientX,ev.clientY);if(coords.x!=lastX||coords.y!=lastY){lastX=coords.x;lastY=coords.y;handler(coords.x,coords.y)}}function upHandler(ev){myRemoveEventListener(document,"mouseup",upHandler);myRemoveEventListener(document,"mousemove",moveHandler);myAddEventListener(node,"mousedown",mouseDown)}myAddEventListener(document,"mouseup",upHandler);myAddEventListener(document,"mousemove",moveHandler);myRemoveEventListener(node,"mousedown",mouseDown);if(ev.preventDefault)ev.preventDefault()}myAddEventListener(node,"mousedown",mouseDown);node.onmousedown=function(e){return false};node.onselectstart=function(e){return false};node.ondragstart=function(e){return false}}var eventListeners=[];function findEventListener(node,event,handler){var i;for(i in eventListeners){if(eventListeners[i].node==node&&eventListeners[i].event==event&&eventListeners[i].handler==handler){return i}}return null}function myAddEventListener(node,event,handler){if(null!=findEventListener(node,event,handler)){return}if(!node.addEventListener){node.attachEvent("on"+event,handler)}else{node.addEventListener(event,handler,false)}eventListeners.push({node:node,event:event,handler:handler})}function removeEventListenerIndex(index){var eventListener=eventListeners[index];delete eventListeners[index];if(!eventListener.node.removeEventListener){eventListener.node.detachEvent("on"+eventListener.event,eventListener.handler)}else{eventListener.node.removeEventListener(eventListener.event,eventListener.handler,false)}}function myRemoveEventListener(node,event,handler){removeEventListenerIndex(findEventListener(node,event,handler))}function cleanupEventListeners(){var i;for(i=eventListeners.length;0<i;i--){if(eventListeners[i]!=undefined){removeEventListenerIndex(i)}}}myAddEventListener(window,"unload",cleanupEventListeners);function hsvToRgb(hue,saturation,value){var red;var green;var blue;if(0==value){red=0;green=0;blue=0}else{var i=Math.floor(6*hue);var f=6*hue-i;var p=value*(1-saturation);var q=value*(1-saturation*f);var t=value*(1-saturation*(1-f));switch(i){case 1:red=q;green=value;blue=p;break;case 2:red=p;green=value;blue=t;break;case 3:red=p;green=q;blue=value;break;case 4:red=t;green=p;blue=value;break;case 5:red=value;green=p;blue=q;break;case 6:case 0:red=value;green=t;blue=p;break;}}return{r:red,g:green,b:blue}}function rgbToHsv(red,green,blue){var max=Math.max(Math.max(red,green),blue);var min=Math.min(Math.min(red,green),blue);var hue;var saturation;var value=max;if(min==max){hue=0;saturation=0}else{var delta=max-min;saturation=delta/max;if(red==max){hue=(green-blue)/delta}else if(green==max){hue=2+(blue-red)/delta}else{hue=4+(red-green)/delta}hue/=6;if(0>hue){hue+=1}if(1<hue){hue-=1}}return{h:hue,s:saturation,v:value}}function pageCoords(node){var x=node.offsetLeft;var y=node.offsetTop;var parent=node.offsetParent;while(null!=parent){x+=parent.offsetLeft;y+=parent.offsetTop;parent=parent.offsetParent}return{x:x,y:y}}var huePositionImg=document.createElement("img");huePositionImg.galleryImg=false;huePositionImg.width=35;huePositionImg.height=11;huePositionImg.src=HUE_SLIDER_ARROWS_LOCATION;huePositionImg.style.position="absolute";var hueSelectorImg=document.createElement("img");hueSelectorImg.galleryImg=false;hueSelectorImg.width=35;hueSelectorImg.height=200;hueSelectorImg.src=HUE_SLIDER_LOCATION;hueSelectorImg.style.display="block";var satValImg=document.createElement("img");satValImg.galleryImg=false;satValImg.width=200;satValImg.height=200;satValImg.src=SAT_VAL_SQUARE_LOCATION;satValImg.style.display="block";var crossHairsImg=document.createElement("img");crossHairsImg.galleryImg=false;crossHairsImg.width=21;crossHairsImg.height=21;crossHairsImg.src=CROSSHAIRS_LOCATION;crossHairsImg.style.position="absolute";var buttonCloseImg=document.createElement("span");buttonCloseImg.innerHTML="\u5173\u95ED";buttonCloseImg.style.position="absolute";buttonCloseImg.style.cursor="pointer";buttonCloseImg.onclick=hideColorPicker;function makeColorSelector(inputBox){var rgb,hsv;function colorChanged(){is_div_init=false;var hex=rgbToHex(rgb.r,rgb.g,rgb.b);var hueRgb=hsvToRgb(hsv.h,1,1);var hueHex=rgbToHex(hueRgb.r,hueRgb.g,hueRgb.b);inputBox.style.background=hex;inputBox.value=hex;if(65>(100*rgb.r+100*rgb.g+100*rgb.b)/3)inputBox.style.color="#fff";else inputBox.style.color="#000";satValDiv.style.background=hueHex;crossHairs.style.left=(199*hsv.v-10).toString()+"px";crossHairs.style.top=(199*(1-hsv.s)-10).toString()+"px";huePos.style.top=(199*hsv.h-5).toString()+"px";is_div_init=true}function rgbChanged(){hsv=rgbToHsv(rgb.r,rgb.g,rgb.b);colorChanged()}function hsvChanged(){rgb=hsvToRgb(hsv.h,hsv.s,hsv.v);colorChanged()}var colorSelectorDiv=document.createElement("div");colorSelectorDiv.style.paddingLeft="5px";colorSelectorDiv.style.paddingRight="5px";colorSelectorDiv.style.paddingBottom="5px";colorSelectorDiv.style.position="relative";colorSelectorDiv.style.diplay="inline";colorSelectorDiv.style.height="220px";colorSelectorDiv.style.width="210px";var butonclose=document.createElement("div");butonclose.style.position="relative";butonclose.style.diplay="inline";butonclose.style.height="10px";butonclose.style.width="50px";butonclose.style.left="210px";butonclose.appendChild(buttonCloseImg);colorSelectorDiv.appendChild(butonclose);var satValDiv=document.createElement("div");satValDiv.style.position="relative";satValDiv.style.diplay="inline";satValDiv.style.top="10px";satValDiv.style.width="200px";satValDiv.style.height="200px";var newSatValImg=fixPNG(satValImg);satValDiv.appendChild(newSatValImg);var crossHairs=crossHairsImg.cloneNode(false);satValDiv.appendChild(crossHairs);function satValDragged(x,y){hsv.s=1-y/199;hsv.v=x/199;hsvChanged()}trackDrag(satValDiv,satValDragged);colorSelectorDiv.appendChild(satValDiv);var hueDiv=document.createElement("div");hueDiv.style.position="absolute";hueDiv.style.diplay="inline";hueDiv.style.left="210px";hueDiv.style.top="19px";hueDiv.style.width="35px";hueDiv.style.height="200px";var huePos=fixPNG(huePositionImg);hueDiv.appendChild(hueSelectorImg.cloneNode(false));hueDiv.appendChild(huePos);function hueDragged(x,y){is_div_init=false;hsv.h=y/199;hsvChanged()}trackDrag(hueDiv,hueDragged);colorSelectorDiv.appendChild(hueDiv);function inputBoxChanged(){rgb=hexToRgb(inputBox.value,{r:0,g:0,b:0});rgbChanged()}myAddEventListener(inputBox,"change",inputBoxChanged);myAddEventListener(inputBox,"blur",function(){hideColorPicker()});inputBoxChanged();return colorSelectorDiv}function colorPickerGetTopPos(inputObj){var returnValue=inputObj.offsetTop;while(null!=(inputObj=inputObj.offsetParent)){returnValue+=inputObj.offsetTop}return returnValue-HEIGHT_OF_OBJ}function colorPickerGetLeftPos(inputObj){var returnValue=inputObj.offsetLeft;while(null!=(inputObj=inputObj.offsetParent))returnValue+=inputObj.offsetLeft;return returnValue+WIDTH_OF_OBJ}function startColorPicker(inputObj){hideColorPicker();var color_picker_div=document.createElement("DIV");color_picker_div.style.zIndex="999999";color_picker_div.style.left=colorPickerGetLeftPos(inputObj)+5+"px";color_picker_div.style.width="250px";color_picker_div.style.heigth="190px";color_picker_div.style.backgroundColor="#FFF";color_picker_div.style.top=colorPickerGetTopPos(inputObj)+inputObj.offsetHeight+"px";color_picker_div.id="The_colorPicker";color_picker_div.style.display="block";color_picker_div.style.position="absolute";color_picker_div.style.border="1px solid #317082";color_picker_div.appendChild(makeColorSelector(inputObj));document.body.appendChild(color_picker_div);is_div_init=true}function hideColorPicker(){if(is_div_init){is_div_init=false;document.body.removeChild(document.getElementById("The_colorPicker"))}}function maskedHex(input){var mask="#[0-9a-fA-F]{7}";input.value=input.value.replace(mask,"")};;;;(function(exports){var bootstrap="object"===typeof exports.bootstrap?exports.bootstrap:exports.bootstrap={};bootstrap.timepicker=function(){var hour=23,minute=59,hourStep=1,minuteStep=1,isOpen=false,dispatch=d3.dispatch("show");var timepicker=function(input){var inputNode=input.node(),selection=d3.select(inputNode.parentNode);input.on("click.timepicker",highlightUnit).on("focus.timepicker",highlightUnit).on("blur.timepicker",blurElement);selection.append("button").attr("class","button add-on").on("click.timepicker",showWidget).append("span").attr("class","label").html("\u9009\u62E9");var wrap=selection.append("div").attr("class","bootstrap-timepicker-widget");var table=wrap.append("table");var tr1=table.append("tr");tr1.append("td").append("a").attr("href","javascript:void(0);").attr("data-action","incrementHour").on("click.timepicker",incrementHour).append("i").attr("class","KDSEditor-icon-chevron-up");tr1.append("td").attr("class","separator").html("&nbsp;");tr1.append("td").append("a").attr("href","javascript:void(0);").attr("data-action","incrementMinute").on("click.timepicker",incrementMinute).append("i").attr("class","KDSEditor-icon-chevron-up");var tr2=table.append("tr");tr2.append("td").append("input").attr("type","text").attr("name","hour").attr("class","bootstrap-timepicker-hour").attr("maxlength",2).property("disabled",true).property("value",hour);tr2.append("td").attr("class","separator").html(":");tr2.append("td").append("input").attr("type","text").attr("name","minute").property("disabled",true).attr("class","bootstrap-timepicker-minute").attr("maxlength",2).property("value",minute);var tr3=table.append("tr");tr3.append("td").append("a").attr("href","javascript:void(0);").attr("data-action","decrementHour").on("click.timepicker",decrementHour).append("i").attr("class","KDSEditor-icon-chevron-down");tr3.append("td").attr("class","separator").html("&nbsp;");tr3.append("td").append("a").attr("href","javascript:void(0);").attr("data-action","decrementMinute").on("click.timepicker",decrementMinute).append("i").attr("class","KDSEditor-icon-chevron-down");function blurElement(){updateFromElementVal()}function highlightUnit(){var position=getCursorPosition();if(0<=position&&2>=position){highlightHour()}else if(3<=position&&5>=position){highlightMinute()}}function highlightHour(){if(inputNode.setSelectionRange){setTimeout(function(){inputNode.setSelectionRange(0,2)},0)}}function highlightMinute(){if(inputNode.setSelectionRange){setTimeout(function(){inputNode.setSelectionRange(3,5)},0)}}function getCursorPosition(){var input=inputNode;if("selectionStart"in input){return input.selectionStart}else if(document.selection){input.focus();var sel=document.selection.createRange(),selLen=document.selection.createRange().text.length;sel.moveStart("character",-input.value.length);return sel.text.length-selLen}}function setTime(time){var timeArray=time.split(":");hour=parseInt(timeArray[0],10);minute=parseInt(timeArray[1],10);if(isNaN(hour)){hour=0}if(isNaN(minute)){minute=0}if(24<=hour){hour=24}else if(0>hour){hour=0}if(0>minute){minute=0}else if(60<=minute){minute=59}if(24===hour){minute=0}update()}function isSelfClick(cur){var flag=false;while(cur&&cur.ownerDocument&&11!==cur.nodeType){if(cur===wrap.node()){flag=true;break}cur=cur.parentNode}return flag}function updateFromElementVal(){var val=inputNode.value;if(val){setTime(val)}}function showWidget(){dispatch.show();if(isOpen){return}d3.select(document.body).on("mousedown.timepicker",function(){if(!isSelfClick(d3.event.target)){hideWidget()}});updateFromElementVal();var outer=getPosition(inputNode),pos={x:outer.x,y:outer.y+outer.h+5};;wrap.style({left:~~pos.x+"px",top:~~pos.y+"px"}).classed("open",true);isOpen=true}function hideWidget(){if(false===isOpen){return}wrap.classed("open",false);d3.select(document.body).on("mousedown.timepicker",null);isOpen=false}function incrementHour(){if(24===hour){hour=0;update();return}hour++;update()}function incrementMinute(){var newVal=minute+minuteStep;if(59<newVal){incrementHour();minute=newVal-60}else{minute=newVal;if(24===hour){incrementHour()}}update()}function decrementHour(){if(0===hour){hour=23}else{hour--}update()}function decrementMinute(){var newVal=minute-minuteStep;if(0>newVal){decrementHour();minute=newVal+60}else{minute=newVal;if(24===hour){decrementHour()}}update()}function update(){var time=formatTime(parseInt(hour,10),parseInt(minute,10));table.selectAll("input.bootstrap-timepicker-hour").property("value",time.hour);table.selectAll("input.bootstrap-timepicker-minute").property("value",time.minute);d3.select(inputNode).property("value",time.hour+":"+time.minute)}function formatTime(hour,minute){var obj={};obj.hour=hour;obj.minute=minute;if(10>hour){obj.hour="0"+hour}if(10>minute){obj.minute="0"+minute}return obj}};timepicker.hourStep=function(_){if(!arguments.length)return hourStep;hourStep=_;return timepicker};timepicker.minuteStep=function(_){if(!arguments.length)return minuteStep;minuteStep=_;return timepicker};return d3.rebind(timepicker,dispatch,"on")};function getPosition(node){var mode=d3.select(node).style("position");if("absolute"===mode||"static"===mode){return{x:node.offsetLeft,y:node.offsetTop,w:node.offsetWidth,h:node.offsetHeight}}else{return{x:0,y:0,w:node.offsetWidth,h:node.offsetHeight}}}})(window);;;var requirejs,require,define;;;(function(global,setTimeout){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.3",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!!("undefined"!==typeof window&&"undefined"!==typeof navigator&&window.document),isWebWorker=!isBrowser&&"undefined"!==typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=false;function commentReplace(match,singlePrefix){return singlePrefix||""}function isFunction(it){return"[object Function]"===ostring.call(it)}function isArray(it){return"[object Array]"===ostring.call(it)}function each(ary,func){if(ary){var i;for(i=0;i<ary.length;i+=1){if(ary[i]&&func(ary[i],i,ary)){break}}}}function eachReverse(ary,func){if(ary){var i;for(i=ary.length-1;-1<i;i-=1){if(ary[i]&&func(ary[i],i,ary)){break}}}}function hasProp(obj,prop){return hasOwn.call(obj,prop)}function getOwn(obj,prop){return hasProp(obj,prop)&&obj[prop]}function eachProp(obj,func){var prop;for(prop in obj){if(hasProp(obj,prop)){if(func(obj[prop],prop)){break}}}}function mixin(target,source,force,deepStringMixin){if(source){eachProp(source,function(value,prop){if(force||!hasProp(target,prop)){if(deepStringMixin&&"object"===typeof value&&value&&!isArray(value)&&!isFunction(value)&&!(value instanceof RegExp)){if(!target[prop]){target[prop]={}}mixin(target[prop],value,force,deepStringMixin)}else{target[prop]=value}}})}return target}function bind(obj,fn){return function(){return fn.apply(obj,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(err){throw err}function getGlobal(value){if(!value){return value}var g=global;each(value.split("."),function(part){g=g[part]});return g}function makeError(id,msg,err,requireModules){var e=new Error(msg+"\nhttp://requirejs.org/docs/errors.html#"+id);e.requireType=id;e.requireModules=requireModules;if(err){e.originalError=err}return e}if("undefined"!==typeof define){return}if("undefined"!==typeof requirejs){if(isFunction(requirejs)){return}cfg=requirejs;requirejs=undefined}if("undefined"!==typeof require&&!isFunction(require)){cfg=require;require=undefined}function newContext(contextName){var inCheckLoaded,Module,context,handlers,checkLoadedTimeoutId,config={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},registry={},enabledRegistry={},undefEvents={},defQueue=[],defined={},urlFetched={},bundlesMap={},requireCounter=1,unnormalizedCounter=1;function trimDots(ary){var i,part;for(i=0;i<ary.length;i++){part=ary[i];if("."===part){ary.splice(i,1);i-=1}else if(".."===part){if(0===i||1===i&&".."===ary[2]||".."===ary[i-1]){continue}else if(0<i){ary.splice(i-1,2);i-=2}}}}function normalize(name,baseName,applyMap){var pkgMain,mapValue,nameParts,i,j,nameSegment,lastIndex,foundMap,foundI,foundStarMap,starI,normalizedBaseParts,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"];if(name){name=name.split("/");lastIndex=name.length-1;if(config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])){name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,"")}if("."===name[0].charAt(0)&&baseParts){normalizedBaseParts=baseParts.slice(0,baseParts.length-1);name=normalizedBaseParts.concat(name)}trimDots(name);name=name.join("/")}if(applyMap&&map&&(baseParts||starMap)){nameParts=name.split("/");outerLoop:for(i=nameParts.length;0<i;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts){for(j=baseParts.length;0<j;j-=1){mapValue=getOwn(map,baseParts.slice(0,j).join("/"));if(mapValue){mapValue=getOwn(mapValue,nameSegment);if(mapValue){foundMap=mapValue;foundI=i;break outerLoop}}}}if(!foundStarMap&&starMap&&getOwn(starMap,nameSegment)){foundStarMap=getOwn(starMap,nameSegment);starI=i}}if(!foundMap&&foundStarMap){foundMap=foundStarMap;foundI=starI}if(foundMap){nameParts.splice(0,foundI,foundMap);name=nameParts.join("/")}}pkgMain=getOwn(config.pkgs,name);return pkgMain?pkgMain:name}function removeScript(name){if(isBrowser){each(scripts(),function(scriptNode){if(scriptNode.getAttribute("data-requiremodule")===name&&scriptNode.getAttribute("data-requirecontext")===context.contextName){scriptNode.parentNode.removeChild(scriptNode);return true}})}}function hasPathFallback(id){var pathConfig=getOwn(config.paths,id);if(pathConfig&&isArray(pathConfig)&&1<pathConfig.length){pathConfig.shift();context.require.undef(id);context.makeRequire(null,{skipMap:true})([id]);return true}}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;if(-1<index){prefix=name.substring(0,index);name=name.substring(index+1,name.length)}return[prefix,name]}function makeModuleMap(name,parentModuleMap,isNormalized,applyMap){var url,pluginModule,suffix,nameParts,prefix=null,parentName=parentModuleMap?parentModuleMap.name:null,originalName=name,isDefine=true,normalizedName="";if(!name){isDefine=false;name="_@r"+(requireCounter+=1)}nameParts=splitPrefix(name);prefix=nameParts[0];name=nameParts[1];if(prefix){prefix=normalize(prefix,parentName,applyMap);pluginModule=getOwn(defined,prefix)}if(name){if(prefix){if(isNormalized){normalizedName=name}else if(pluginModule&&pluginModule.normalize){normalizedName=pluginModule.normalize(name,function(name){return normalize(name,parentName,applyMap)})}else{normalizedName=-1===name.indexOf("!")?normalize(name,parentName,applyMap):name}}else{normalizedName=normalize(name,parentName,applyMap);nameParts=splitPrefix(normalizedName);prefix=nameParts[0];normalizedName=nameParts[1];isNormalized=true;url=context.nameToUrl(normalizedName)}}suffix=prefix&&!pluginModule&&!isNormalized?"_unnormalized"+(unnormalizedCounter+=1):"";return{prefix:prefix,name:normalizedName,parentMap:parentModuleMap,unnormalized:!!suffix,url:url,originalName:originalName,isDefine:isDefine,id:(prefix?prefix+"!"+normalizedName:normalizedName)+suffix}}function getModule(depMap){var id=depMap.id,mod=getOwn(registry,id);if(!mod){mod=registry[id]=new context.Module(depMap)}return mod}function on(depMap,name,fn){var id=depMap.id,mod=getOwn(registry,id);if(hasProp(defined,id)&&(!mod||mod.defineEmitComplete)){if("defined"===name){fn(defined[id])}}else{mod=getModule(depMap);if(mod.error&&"error"===name){fn(mod.error)}else{mod.on(name,fn)}}}function onError(err,errback){var ids=err.requireModules,notified=false;if(errback){errback(err)}else{each(ids,function(id){var mod=getOwn(registry,id);if(mod){mod.error=err;if(mod.events.error){notified=true;mod.emit("error",err)}}});if(!notified){req.onError(err)}}}function takeGlobalQueue(){if(globalDefQueue.length){each(globalDefQueue,function(queueItem){var id=queueItem[0];if("string"===typeof id){context.defQueueMap[id]=true}defQueue.push(queueItem)});globalDefQueue=[]}}handlers={require:function(mod){if(mod.require){return mod.require}else{return mod.require=context.makeRequire(mod.map)}},exports:function(mod){mod.usingExports=true;if(mod.map.isDefine){if(mod.exports){return defined[mod.map.id]=mod.exports}else{return mod.exports=defined[mod.map.id]={}}}},module:function(mod){if(mod.module){return mod.module}else{return mod.module={id:mod.map.id,uri:mod.map.url,config:function(){return getOwn(config.config,mod.map.id)||{}},exports:mod.exports||(mod.exports={})}}}};function cleanRegistry(id){delete registry[id];delete enabledRegistry[id]}function breakCycle(mod,traced,processed){var id=mod.map.id;if(mod.error){mod.emit("error",mod.error)}else{traced[id]=true;each(mod.depMaps,function(depMap,i){var depId=depMap.id,dep=getOwn(registry,depId);if(dep&&!mod.depMatched[i]&&!processed[depId]){if(getOwn(traced,depId)){mod.defineDep(i,defined[depId]);mod.check()}else{breakCycle(dep,traced,processed)}}});processed[id]=true}}function checkLoaded(){var err,usingPathFallback,waitInterval=1000*config.waitSeconds,expired=waitInterval&&context.startTime+waitInterval<new Date().getTime(),noLoads=[],reqCalls=[],stillLoading=false,needCycleCheck=true;if(inCheckLoaded){return}inCheckLoaded=true;eachProp(enabledRegistry,function(mod){var map=mod.map,modId=map.id;if(!mod.enabled){return}if(!map.isDefine){reqCalls.push(mod)}if(!mod.error){if(!mod.inited&&expired){if(hasPathFallback(modId)){usingPathFallback=true;stillLoading=true}else{noLoads.push(modId);removeScript(modId)}}else if(!mod.inited&&mod.fetched&&map.isDefine){stillLoading=true;if(!map.prefix){return needCycleCheck=false}}}});if(expired&&noLoads.length){err=makeError("timeout","Load timeout for modules: "+noLoads,null,noLoads);err.contextName=context.contextName;return onError(err)}if(needCycleCheck){each(reqCalls,function(mod){breakCycle(mod,{},{})})}if((!expired||usingPathFallback)&&stillLoading){if((isBrowser||isWebWorker)&&!checkLoadedTimeoutId){checkLoadedTimeoutId=setTimeout(function(){checkLoadedTimeoutId=0;checkLoaded()},50)}}inCheckLoaded=false}Module=function(map){this.events=getOwn(undefEvents,map.id)||{};this.map=map;this.shim=getOwn(config.shim,map.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};Module.prototype={init:function(depMaps,factory,errback,options){options=options||{};if(this.inited){return}this.factory=factory;if(errback){this.on("error",errback)}else if(this.events.error){errback=bind(this,function(err){this.emit("error",err)})}this.depMaps=depMaps&&depMaps.slice(0);this.errback=errback;this.inited=true;this.ignore=options.ignore;if(options.enabled||this.enabled){this.enable()}else{this.check()}},defineDep:function(i,depExports){if(!this.depMatched[i]){this.depMatched[i]=true;this.depCount-=1;this.depExports[i]=depExports}},fetch:function(){if(this.fetched){return}this.fetched=true;context.startTime=new Date().getTime();var map=this.map;if(this.shim){context.makeRequire(this.map,{enableBuildCallback:true})(this.shim.deps||[],bind(this,function(){return map.prefix?this.callPlugin():this.load()}))}else{return map.prefix?this.callPlugin():this.load()}},load:function(){var url=this.map.url;if(!urlFetched[url]){urlFetched[url]=true;context.load(this.map.id,url)}},check:function(){if(!this.enabled||this.enabling){return}var err,cjsModule,id=this.map.id,depExports=this.depExports,exports=this.exports,factory=this.factory;if(!this.inited){if(!hasProp(context.defQueueMap,id)){this.fetch()}}else if(this.error){this.emit("error",this.error)}else if(!this.defining){this.defining=true;if(1>this.depCount&&!this.defined){if(isFunction(factory)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError){try{exports=context.execCb(id,factory,depExports,exports)}catch(e){err=e}}else{exports=context.execCb(id,factory,depExports,exports)}if(this.map.isDefine&&exports===undefined){cjsModule=this.module;if(cjsModule){exports=cjsModule.exports}else if(this.usingExports){exports=this.exports}}if(err){err.requireMap=this.map;err.requireModules=this.map.isDefine?[this.map.id]:null;err.requireType=this.map.isDefine?"define":"require";return onError(this.error=err)}}else{exports=factory}this.exports=exports;if(this.map.isDefine&&!this.ignore){defined[id]=exports;if(req.onResourceLoad){var resLoadMaps=[];each(this.depMaps,function(depMap){resLoadMaps.push(depMap.normalizedMap||depMap)});req.onResourceLoad(context,this.map,resLoadMaps)}}cleanRegistry(id);this.defined=true}this.defining=false;if(this.defined&&!this.defineEmitted){this.defineEmitted=true;this.emit("defined",this.exports);this.defineEmitComplete=true}}},callPlugin:function(){var map=this.map,id=map.id,pluginMap=makeModuleMap(map.prefix);this.depMaps.push(pluginMap);on(pluginMap,"defined",bind(this,function(plugin){var load,normalizedMap,normalizedMod,bundleId=getOwn(bundlesMap,this.map.id),name=this.map.name,parentName=this.map.parentMap?this.map.parentMap.name:null,localRequire=context.makeRequire(map.parentMap,{enableBuildCallback:true});if(this.map.unnormalized){if(plugin.normalize){name=plugin.normalize(name,function(name){return normalize(name,parentName,true)})||""}normalizedMap=makeModuleMap(map.prefix+"!"+name,this.map.parentMap,true);on(normalizedMap,"defined",bind(this,function(value){this.map.normalizedMap=normalizedMap;this.init([],function(){return value},null,{enabled:true,ignore:true})}));normalizedMod=getOwn(registry,normalizedMap.id);if(normalizedMod){this.depMaps.push(normalizedMap);if(this.events.error){normalizedMod.on("error",bind(this,function(err){this.emit("error",err)}))}normalizedMod.enable()}return}if(bundleId){this.map.url=context.nameToUrl(bundleId);this.load();return}load=bind(this,function(value){this.init([],function(){return value},null,{enabled:true})});load.error=bind(this,function(err){this.inited=true;this.error=err;err.requireModules=[id];eachProp(registry,function(mod){if(0===mod.map.id.indexOf(id+"_unnormalized")){cleanRegistry(mod.map.id)}});onError(err)});load.fromText=bind(this,function(text,textAlt){var moduleName=map.name,moduleMap=makeModuleMap(moduleName),hasInteractive=useInteractive;if(textAlt){text=textAlt}if(hasInteractive){useInteractive=false}getModule(moduleMap);if(hasProp(config.config,id)){config.config[moduleName]=config.config[id]}try{req.exec(text)}catch(e){return onError(makeError("fromtexteval","fromText eval for "+id+" failed: "+e,e,[id]))}if(hasInteractive){useInteractive=true}this.depMaps.push(moduleMap);context.completeLoad(moduleName);localRequire([moduleName],load)});plugin.load(map.name,localRequire,load,config)}));context.enable(pluginMap,this);this.pluginMaps[pluginMap.id]=pluginMap},enable:function(){enabledRegistry[this.map.id]=this;this.enabled=true;this.enabling=true;each(this.depMaps,bind(this,function(depMap,i){var id,mod,handler;if("string"===typeof depMap){depMap=makeModuleMap(depMap,this.map.isDefine?this.map:this.map.parentMap,false,!this.skipMap);this.depMaps[i]=depMap;handler=getOwn(handlers,depMap.id);if(handler){this.depExports[i]=handler(this);return}this.depCount+=1;on(depMap,"defined",bind(this,function(depExports){if(this.undefed){return}this.defineDep(i,depExports);this.check()}));if(this.errback){on(depMap,"error",bind(this,this.errback))}else if(this.events.error){on(depMap,"error",bind(this,function(err){this.emit("error",err)}))}}id=depMap.id;mod=registry[id];if(!hasProp(handlers,id)&&mod&&!mod.enabled){context.enable(depMap,this)}}));eachProp(this.pluginMaps,bind(this,function(pluginMap){var mod=getOwn(registry,pluginMap.id);if(mod&&!mod.enabled){context.enable(pluginMap,this)}}));this.enabling=false;this.check()},on:function(name,cb){var cbs=this.events[name];if(!cbs){cbs=this.events[name]=[]}cbs.push(cb)},emit:function(name,evt){each(this.events[name],function(cb){cb(evt)});if("error"===name){delete this.events[name]}}};function callGetModule(args){if(!hasProp(defined,args[0])){getModule(makeModuleMap(args[0],null,true)).init(args[1],args[2])}}function removeListener(node,func,name,ieName){if(node.detachEvent&&!isOpera){if(ieName){node.detachEvent(ieName,func)}}else{node.removeEventListener(name,func,false)}}function getScriptData(evt){var node=evt.currentTarget||evt.srcElement;removeListener(node,context.onScriptLoad,"load","onreadystatechange");removeListener(node,context.onScriptError,"error");return{node:node,id:node&&node.getAttribute("data-requiremodule")}}function intakeDefines(){var args;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(null===args[0]){return onError(makeError("mismatch","Mismatched anonymous define() module: "+args[args.length-1]))}else{callGetModule(args)}}context.defQueueMap={}}context={config:config,contextName:contextName,registry:registry,defined:defined,urlFetched:urlFetched,defQueue:defQueue,defQueueMap:{},Module:Module,makeModuleMap:makeModuleMap,nextTick:req.nextTick,onError:onError,configure:function(cfg){if(cfg.baseUrl){if("/"!==cfg.baseUrl.charAt(cfg.baseUrl.length-1)){cfg.baseUrl+="/"}}if("string"===typeof cfg.urlArgs){var urlArgs=cfg.urlArgs;cfg.urlArgs=function(id,url){return(-1===url.indexOf("?")?"?":"&")+urlArgs}}var shim=config.shim,objs={paths:true,bundles:true,config:true,map:true};eachProp(cfg,function(value,prop){if(objs[prop]){if(!config[prop]){config[prop]={}}mixin(config[prop],value,true,true)}else{config[prop]=value}});if(cfg.bundles){eachProp(cfg.bundles,function(value,prop){each(value,function(v){if(v!==prop){bundlesMap[v]=prop}})})}if(cfg.shim){eachProp(cfg.shim,function(value,id){if(isArray(value)){value={deps:value}}if((value.exports||value.init)&&!value.exportsFn){value.exportsFn=context.makeShimExports(value)}shim[id]=value});config.shim=shim}if(cfg.packages){each(cfg.packages,function(pkgObj){var location,name;pkgObj="string"===typeof pkgObj?{name:pkgObj}:pkgObj;name=pkgObj.name;location=pkgObj.location;if(location){config.paths[name]=pkgObj.location}config.pkgs[name]=pkgObj.name+"/"+(pkgObj.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")})}eachProp(registry,function(mod,id){if(!mod.inited&&!mod.map.unnormalized){mod.map=makeModuleMap(id,null,true)}});if(cfg.deps||cfg.callback){context.require(cfg.deps||[],cfg.callback)}},makeShimExports:function(value){function fn(){var ret;if(value.init){ret=value.init.apply(global,arguments)}return ret||value.exports&&getGlobal(value.exports)}return fn},makeRequire:function(relMap,options){options=options||{};function localRequire(deps,callback,errback){var id,map,requireMod;if(options.enableBuildCallback&&callback&&isFunction(callback)){callback.__requireJsBuild=true}if("string"===typeof deps){if(isFunction(callback)){return onError(makeError("requireargs","Invalid require call"),errback)}if(relMap&&hasProp(handlers,deps)){return handlers[deps](registry[relMap.id])}if(req.get){return req.get(context,deps,relMap,localRequire)}map=makeModuleMap(deps,relMap,false,true);id=map.id;if(!hasProp(defined,id)){return onError(makeError("notloaded","Module name \""+id+"\" has not been loaded yet for context: "+contextName+(relMap?"":". Use require([])")))}return defined[id]}intakeDefines();context.nextTick(function(){intakeDefines();requireMod=getModule(makeModuleMap(null,relMap));requireMod.skipMap=options.skipMap;requireMod.init(deps,callback,errback,{enabled:true});checkLoaded()});return localRequire}mixin(localRequire,{isBrowser:isBrowser,toUrl:function(moduleNamePlusExt){var ext,index=moduleNamePlusExt.lastIndexOf("."),segment=moduleNamePlusExt.split("/")[0],isRelative="."===segment||".."===segment;if(-1!==index&&(!isRelative||1<index)){ext=moduleNamePlusExt.substring(index,moduleNamePlusExt.length);moduleNamePlusExt=moduleNamePlusExt.substring(0,index)}return context.nameToUrl(normalize(moduleNamePlusExt,relMap&&relMap.id,true),ext,true)},defined:function(id){return hasProp(defined,makeModuleMap(id,relMap,false,true).id)},specified:function(id){id=makeModuleMap(id,relMap,false,true).id;return hasProp(defined,id)||hasProp(registry,id)}});if(!relMap){localRequire.undef=function(id){takeGlobalQueue();var map=makeModuleMap(id,relMap,true),mod=getOwn(registry,id);mod.undefed=true;removeScript(id);delete defined[id];delete urlFetched[map.url];delete undefEvents[id];eachReverse(defQueue,function(args,i){if(args[0]===id){defQueue.splice(i,1)}});delete context.defQueueMap[id];if(mod){if(mod.events.defined){undefEvents[id]=mod.events}cleanRegistry(id)}}}return localRequire},enable:function(depMap){var mod=getOwn(registry,depMap.id);if(mod){getModule(depMap).enable()}},completeLoad:function(moduleName){var found,args,mod,shim=getOwn(config.shim,moduleName)||{},shExports=shim.exports;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(null===args[0]){args[0]=moduleName;if(found){break}found=true}else if(args[0]===moduleName){found=true}callGetModule(args)}context.defQueueMap={};mod=getOwn(registry,moduleName);if(!found&&!hasProp(defined,moduleName)&&mod&&!mod.inited){if(config.enforceDefine&&(!shExports||!getGlobal(shExports))){if(hasPathFallback(moduleName)){return}else{return onError(makeError("nodefine","No define call for "+moduleName,null,[moduleName]))}}else{callGetModule([moduleName,shim.deps||[],shim.exportsFn])}}checkLoaded()},nameToUrl:function(moduleName,ext,skipExt){var paths,syms,i,parentModule,url,parentPath,bundleId,pkgMain=getOwn(config.pkgs,moduleName);if(pkgMain){moduleName=pkgMain}bundleId=getOwn(bundlesMap,moduleName);if(bundleId){return context.nameToUrl(bundleId,ext,skipExt)}if(req.jsExtRegExp.test(moduleName)){url=moduleName+(ext||"")}else{paths=config.paths;syms=moduleName.split("/");for(i=syms.length;0<i;i-=1){parentModule=syms.slice(0,i).join("/");parentPath=getOwn(paths,parentModule);if(parentPath){if(isArray(parentPath)){parentPath=parentPath[0]}syms.splice(0,i,parentPath);break}}url=syms.join("/");url+=ext||(/^data\:|^blob\:|\?/.test(url)||skipExt?"":".js");url=("/"===url.charAt(0)||url.match(/^[\w\+\.\-]+:/)?"":config.baseUrl)+url}return config.urlArgs&&!/^blob\:/.test(url)?url+config.urlArgs(moduleName,url):url},load:function(id,url){req.load(context,id,url)},execCb:function(name,callback,args,exports){return callback.apply(exports,args)},onScriptLoad:function(evt){if("load"===evt.type||readyRegExp.test((evt.currentTarget||evt.srcElement).readyState)){interactiveScript=null;var data=getScriptData(evt);context.completeLoad(data.id)}},onScriptError:function(evt){var data=getScriptData(evt);if(!hasPathFallback(data.id)){var parents=[];eachProp(registry,function(value,key){if(0!==key.indexOf("_@r")){each(value.depMaps,function(depMap){if(depMap.id===data.id){parents.push(key);return true}})}});return onError(makeError("scripterror","Script error for \""+data.id+(parents.length?"\", needed by: "+parents.join(", "):"\""),evt,[data.id]))}}};context.require=context.makeRequire();return context}req=requirejs=function(deps,callback,errback,optional){var context,config,contextName=defContextName;if(!isArray(deps)&&"string"!==typeof deps){config=deps;if(isArray(callback)){deps=callback;callback=errback;errback=optional}else{deps=[]}}if(config&&config.context){contextName=config.context}context=getOwn(contexts,contextName);if(!context){context=contexts[contextName]=req.s.newContext(contextName)}if(config){context.configure(config)}return context.require(deps,callback,errback)};req.config=function(config){return req(config)};req.nextTick="undefined"!==typeof setTimeout?function(fn){setTimeout(fn,4)}:function(fn){fn()};if(!require){require=req}req.version=version;req.jsExtRegExp=/^\/|:|\?|\.js$/;req.isBrowser=isBrowser;s=req.s={contexts:contexts,newContext:newContext};req({});each(["toUrl","undef","defined","specified"],function(prop){req[prop]=function(){var ctx=contexts[defContextName];return ctx.require[prop].apply(ctx,arguments)}});if(isBrowser){head=s.head=document.getElementsByTagName("head")[0];baseElement=document.getElementsByTagName("base")[0];if(baseElement){head=s.head=baseElement.parentNode}}req.onError=defaultOnError;req.createNode=function(config,moduleName,url){var node=config.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");node.type=config.scriptType||"text/javascript";node.charset="utf-8";node.async=true;return node};req.load=function(context,moduleName,url){var config=context&&context.config||{},node;if(isBrowser){node=req.createNode(config,moduleName,url);node.setAttribute("data-requirecontext",context.contextName);node.setAttribute("data-requiremodule",moduleName);if(node.attachEvent&&!(node.attachEvent.toString&&0>node.attachEvent.toString().indexOf("[native code"))&&!isOpera){useInteractive=true;node.attachEvent("onreadystatechange",context.onScriptLoad)}else{node.addEventListener("load",context.onScriptLoad,false);node.addEventListener("error",context.onScriptError,false)}node.src=url;if(config.onNodeCreated){config.onNodeCreated(node,config,moduleName,url)}currentlyAddingScript=node;if(baseElement){head.insertBefore(node,baseElement)}else{head.appendChild(node)}currentlyAddingScript=null;return node}else if(isWebWorker){try{setTimeout(function(){},0);importScripts(url);context.completeLoad(moduleName)}catch(e){context.onError(makeError("importscripts","importScripts failed for "+moduleName+" at "+url,e,[moduleName]))}}};function getInteractiveScript(){if(interactiveScript&&"interactive"===interactiveScript.readyState){return interactiveScript}eachReverse(scripts(),function(script){if("interactive"===script.readyState){return interactiveScript=script}});return interactiveScript}if(isBrowser&&!cfg.skipDataMain){eachReverse(scripts(),function(script){if(!head){head=script.parentNode}dataMain=script.getAttribute("data-main");if(dataMain){mainScript=dataMain;if(!cfg.baseUrl&&-1===mainScript.indexOf("!")){src=mainScript.split("/");mainScript=src.pop();subPath=src.length?src.join("/")+"/":"./";cfg.baseUrl=subPath}mainScript=mainScript.replace(jsSuffixRegExp,"");if(req.jsExtRegExp.test(mainScript)){mainScript=dataMain}cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript];return true}})}define=function(name,deps,callback){var node,context;if("string"!==typeof name){callback=deps;deps=name;name=null}if(!isArray(deps)){callback=deps;deps=null}if(!deps&&isFunction(callback)){deps=[];if(callback.length){callback.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(match,dep){deps.push(dep)});deps=(1===callback.length?["require"]:["require","exports","module"]).concat(deps)}}if(useInteractive){node=currentlyAddingScript||getInteractiveScript();if(node){if(!name){name=node.getAttribute("data-requiremodule")}context=contexts[node.getAttribute("data-requirecontext")]}}if(context){context.defQueue.push([name,deps,callback]);context.defQueueMap[name]=true}else{globalDefQueue.push([name,deps,callback])}};define.amd={jQuery:true};req.exec=function(text){return eval(text)};req(cfg)})(this,"undefined"===typeof setTimeout?undefined:setTimeout);;;(function(global,factory){"object"===typeof exports&&"undefined"!==typeof module?factory(exports):factory(global.zrender={})})(window,function(exports){"use strict";var idStart=2311;var guid=function(){return idStart++};var env={};if("undefined"!==typeof wx){env={browser:{},os:{},node:false,wxa:true,canvasSupported:true,svgSupported:false,touchEventsSupported:true}}else if("undefined"===typeof document&&"undefined"!==typeof self){env={browser:{},os:{},node:false,worker:true,canvasSupported:true}}else if("undefined"===typeof navigator){env={browser:{},os:{},node:true,worker:false,canvasSupported:true,svgSupported:true}}else{env=detect(navigator.userAgent)}var env$1=env;function detect(ua){var os={};var browser={};var firefox=ua.match(/Firefox\/([\d.]+)/);var ie=ua.match(/MSIE\s([\d.]+)/)||ua.match(/Trident\/.+?rv:(([\d.]+))/);var edge=ua.match(/Edge\/([\d.]+)/);var weChat=/micromessenger/i.test(ua);if(firefox){browser.firefox=true;browser.version=firefox[1]}if(ie){browser.ie=true;browser.version=ie[1]}if(edge){browser.edge=true;browser.version=edge[1]}if(weChat){browser.weChat=true}return{browser:browser,os:os,node:false,canvasSupported:!!document.createElement("canvas").getContext,svgSupported:"undefined"!==typeof SVGRect,touchEventsSupported:"ontouchstart"in window&&!browser.ie&&!browser.edge,pointerEventsSupported:"onpointerdown"in window&&(browser.edge||browser.ie&&11<=browser.version)}}var BUILTIN_OBJECT={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1};var TYPED_ARRAY={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1};var objToString=Object.prototype.toString;var arrayProto=Array.prototype;var nativeForEach=arrayProto.forEach;var nativeFilter=arrayProto.filter;var nativeSlice=arrayProto.slice;var nativeMap=arrayProto.map;var nativeReduce=arrayProto.reduce;var methods={};function $override(name,fn){if("createCanvas"===name){_ctx=null}methods[name]=fn}function clone(source){if(null==source||"object"!=typeof source){return source}var result=source;var typeStr=objToString.call(source);if("[object Array]"===typeStr){if(!isPrimitive(source)){result=[];for(var i=0,len=source.length;i<len;i++){result[i]=clone(source[i])}}}else if(TYPED_ARRAY[typeStr]){if(!isPrimitive(source)){var Ctor=source.constructor;if(source.constructor.from){result=Ctor.from(source)}else{result=new Ctor(source.length);for(var i=0,len=source.length;i<len;i++){result[i]=clone(source[i])}}}}else if(!BUILTIN_OBJECT[typeStr]&&!isPrimitive(source)&&!isDom(source)){result={};for(var key in source){if(source.hasOwnProperty(key)){result[key]=clone(source[key])}}}return result}function merge(target,source,overwrite){if(!isObject(source)||!isObject(target)){return overwrite?clone(source):target}for(var key in source){if(source.hasOwnProperty(key)){var targetProp=target[key];var sourceProp=source[key];if(isObject(sourceProp)&&isObject(targetProp)&&!isArray(sourceProp)&&!isArray(targetProp)&&!isDom(sourceProp)&&!isDom(targetProp)&&!isBuiltInObject(sourceProp)&&!isBuiltInObject(targetProp)&&!isPrimitive(sourceProp)&&!isPrimitive(targetProp)){merge(targetProp,sourceProp,overwrite)}else if(overwrite||!(key in target)){target[key]=clone(source[key],true)}}}return target}function mergeAll(targetAndSources,overwrite){var result=targetAndSources[0];for(var i=1,len=targetAndSources.length;i<len;i++){result=merge(result,targetAndSources[i],overwrite)}return result}function extend(target,source){for(var key in source){if(source.hasOwnProperty(key)){target[key]=source[key]}}return target}function defaults(target,source,overlay){for(var key in source){if(source.hasOwnProperty(key)&&(overlay?null!=source[key]:null==target[key])){target[key]=source[key]}}return target}var createCanvas=function(){return methods.createCanvas()};methods.createCanvas=function(){return document.createElement("canvas")};var _ctx;function getContext(){if(!_ctx){_ctx=createCanvas().getContext("2d")}return _ctx}function indexOf(array,value){if(array){if(array.indexOf){return array.indexOf(value)}for(var i=0,len=array.length;i<len;i++){if(array[i]===value){return i}}}return-1}function inherits(clazz,baseClazz){var clazzPrototype=clazz.prototype;function F(){}F.prototype=baseClazz.prototype;clazz.prototype=new F;for(var prop in clazzPrototype){clazz.prototype[prop]=clazzPrototype[prop]}clazz.prototype.constructor=clazz;clazz.superClass=baseClazz}function mixin(target,source,overlay){target="prototype"in target?target.prototype:target;source="prototype"in source?source.prototype:source;defaults(target,source,overlay)}function isArrayLike(data){if(!data){return}if("string"==typeof data){return false}return"number"==typeof data.length}function each(obj,cb,context){if(!(obj&&cb)){return}if(obj.forEach&&obj.forEach===nativeForEach){obj.forEach(cb,context)}else if(obj.length===+obj.length){for(var i=0,len=obj.length;i<len;i++){cb.call(context,obj[i],i,obj)}}else{for(var key in obj){if(obj.hasOwnProperty(key)){cb.call(context,obj[key],key,obj)}}}}function map(obj,cb,context){if(!(obj&&cb)){return}if(obj.map&&obj.map===nativeMap){return obj.map(cb,context)}else{var result=[];for(var i=0,len=obj.length;i<len;i++){result.push(cb.call(context,obj[i],i,obj))}return result}}function reduce(obj,cb,memo,context){if(!(obj&&cb)){return}if(obj.reduce&&obj.reduce===nativeReduce){return obj.reduce(cb,memo,context)}else{for(var i=0,len=obj.length;i<len;i++){memo=cb.call(context,memo,obj[i],i,obj)}return memo}}function filter(obj,cb,context){if(!(obj&&cb)){return}if(obj.filter&&obj.filter===nativeFilter){return obj.filter(cb,context)}else{var result=[];for(var i=0,len=obj.length;i<len;i++){if(cb.call(context,obj[i],i,obj)){result.push(obj[i])}}return result}}function find(obj,cb,context){if(!(obj&&cb)){return}for(var i=0,len=obj.length;i<len;i++){if(cb.call(context,obj[i],i,obj)){return obj[i]}}}function bind(func,context){var args=nativeSlice.call(arguments,2);return function(){return func.apply(context,args.concat(nativeSlice.call(arguments)))}}function curry(func){var args=nativeSlice.call(arguments,1);return function(){return func.apply(this,args.concat(nativeSlice.call(arguments)))}}function isArray(value){return"[object Array]"===objToString.call(value)}function isFunction(value){return"function"===typeof value}function isString(value){return"[object String]"===objToString.call(value)}function isObject(value){var type=typeof value;return"function"===type||!!value&&"object"==type}function isBuiltInObject(value){return!!BUILTIN_OBJECT[objToString.call(value)]}function isTypedArray(value){return!!TYPED_ARRAY[objToString.call(value)]}function isDom(value){return"object"===typeof value&&"number"===typeof value.nodeType&&"object"===typeof value.ownerDocument}function eqNaN(value){return value!==value}function retrieve(values){for(var i=0,len=arguments.length;i<len;i++){if(null!=arguments[i]){return arguments[i]}}}function retrieve2(value0,value1){return null!=value0?value0:value1}function retrieve3(value0,value1,value2){return null!=value0?value0:null!=value1?value1:value2}function slice(){return Function.call.apply(nativeSlice,arguments)}function normalizeCssArray(val){if("number"===typeof val){return[val,val,val,val]}var len=val.length;if(2===len){return[val[0],val[1],val[0],val[1]]}else if(3===len){return[val[0],val[1],val[2],val[1]]}return val}function assert(condition,message){if(!condition){throw new Error(message)}}function trim(str){if(null==str){return null}else if("function"===typeof str.trim){return str.trim()}else{return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}var primitiveKey="__ec_primitive__";function setAsPrimitive(obj){obj[primitiveKey]=true}function isPrimitive(obj){return obj[primitiveKey]}function HashMap(obj){var isArr=isArray(obj);var thisMap=this;obj instanceof HashMap?obj.each(visit):obj&&each(obj,visit);function visit(value,key){isArr?thisMap.set(value,key):thisMap.set(key,value)}}HashMap.prototype={constructor:HashMap,get:function(key){return this.hasOwnProperty(key)?this[key]:null},set:function(key,value){return this[key]=value},each:function(cb,context){void 0!==context&&(cb=bind(cb,context));for(var key in this){this.hasOwnProperty(key)&&cb(this[key],key)}},removeKey:function(key){delete this[key]}};function createHashMap(obj){return new HashMap(obj)}function concatArray(a,b){var newArray=new a.constructor(a.length+b.length);for(var i=0;i<a.length;i++){newArray[i]=a[i]}var offset=a.length;for(i=0;i<b.length;i++){newArray[i+offset]=b[i]}return newArray}function noop(){}var util=(Object.freeze||Object)({$override:$override,clone:clone,merge:merge,mergeAll:mergeAll,extend:extend,defaults:defaults,createCanvas:createCanvas,getContext:getContext,indexOf:indexOf,inherits:inherits,mixin:mixin,isArrayLike:isArrayLike,each:each,map:map,reduce:reduce,filter:filter,find:find,bind:bind,curry:curry,isArray:isArray,isFunction:isFunction,isString:isString,isObject:isObject,isBuiltInObject:isBuiltInObject,isTypedArray:isTypedArray,isDom:isDom,eqNaN:eqNaN,retrieve:retrieve,retrieve2:retrieve2,retrieve3:retrieve3,slice:slice,normalizeCssArray:normalizeCssArray,assert:assert,trim:trim,setAsPrimitive:setAsPrimitive,isPrimitive:isPrimitive,createHashMap:createHashMap,concatArray:concatArray,noop:noop});var ArrayCtor="undefined"===typeof Float32Array?Array:Float32Array;function create(x,y){var out=new ArrayCtor(2);if(null==x){x=0}if(null==y){y=0}out[0]=x;out[1]=y;return out}function copy(out,v){out[0]=v[0];out[1]=v[1];return out}function clone$1(v){var out=new ArrayCtor(2);out[0]=v[0];out[1]=v[1];return out}function set(out,a,b){out[0]=a;out[1]=b;return out}function add(out,v1,v2){out[0]=v1[0]+v2[0];out[1]=v1[1]+v2[1];return out}function scaleAndAdd(out,v1,v2,a){out[0]=v1[0]+v2[0]*a;out[1]=v1[1]+v2[1]*a;return out}function sub(out,v1,v2){out[0]=v1[0]-v2[0];out[1]=v1[1]-v2[1];return out}function len(v){return Math.sqrt(lenSquare(v))}var length=len;function lenSquare(v){return v[0]*v[0]+v[1]*v[1]}var lengthSquare=lenSquare;function mul(out,v1,v2){out[0]=v1[0]*v2[0];out[1]=v1[1]*v2[1];return out}function div(out,v1,v2){out[0]=v1[0]/v2[0];out[1]=v1[1]/v2[1];return out}function dot(v1,v2){return v1[0]*v2[0]+v1[1]*v2[1]}function scale(out,v,s){out[0]=v[0]*s;out[1]=v[1]*s;return out}function normalize(out,v){var d=len(v);if(0===d){out[0]=0;out[1]=0}else{out[0]=v[0]/d;out[1]=v[1]/d}return out}function distance(v1,v2){return Math.sqrt((v1[0]-v2[0])*(v1[0]-v2[0])+(v1[1]-v2[1])*(v1[1]-v2[1]))}var dist=distance;function distanceSquare(v1,v2){return(v1[0]-v2[0])*(v1[0]-v2[0])+(v1[1]-v2[1])*(v1[1]-v2[1])}var distSquare=distanceSquare;function negate(out,v){out[0]=-v[0];out[1]=-v[1];return out}function lerp(out,v1,v2,t){out[0]=v1[0]+t*(v2[0]-v1[0]);out[1]=v1[1]+t*(v2[1]-v1[1]);return out}function applyTransform(out,v,m){var x=v[0];var y=v[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out}function min(out,v1,v2){out[0]=Math.min(v1[0],v2[0]);out[1]=Math.min(v1[1],v2[1]);return out}function max(out,v1,v2){out[0]=Math.max(v1[0],v2[0]);out[1]=Math.max(v1[1],v2[1]);return out}var vector=(Object.freeze||Object)({create:create,copy:copy,clone:clone$1,set:set,add:add,scaleAndAdd:scaleAndAdd,sub:sub,len:len,length:length,lenSquare:lenSquare,lengthSquare:lengthSquare,mul:mul,div:div,dot:dot,scale:scale,normalize:normalize,distance:distance,dist:dist,distanceSquare:distanceSquare,distSquare:distSquare,negate:negate,lerp:lerp,applyTransform:applyTransform,min:min,max:max});function Draggable(){this.on("mousedown._zrender_draggable",function(e){var draggingTarget=e.target;if(draggingTarget){draggingTarget.__drag_status=undefined}if(draggingTarget&&draggingTarget.draggable){this._draggingTarget=draggingTarget;draggingTarget.__drag_status=0}},this);this.on("mousemove._zrender_draggable",_drag,this);this.on("mouseup._zrender_draggable",_dragEnd,this);this.on("globalout._zrender_draggable",_dragEnd,this);function _drag(){var draggingTarget=this._draggingTarget;if(draggingTarget){var args=Array.prototype.slice.call(arguments);if(0===draggingTarget.__drag_status){if(args[0]){args[0].target=draggingTarget}this._dragStart.apply(this,args)}draggingTarget.__drag_status=1;this._drag.apply(this,args)}}function _dragEnd(){var draggingTarget=this._draggingTarget;if(draggingTarget){var args=Array.prototype.slice.call(arguments);if(1===draggingTarget.__drag_status){this._dragEnd.apply(this,args)}draggingTarget.__drag_status=undefined}this._draggingTarget=undefined}}Draggable.prototype={constructor:Draggable,_dragStart:function(e){var draggingTarget=e.target;if(draggingTarget&&draggingTarget.draggable){this._draggingTarget=draggingTarget;draggingTarget.dragging=true;this._x=e.offsetX;this._y=e.offsetY;this.dispatchToElement(param(draggingTarget,e),"dragstart",e.event)}},_drag:function(e){var draggingTarget=this._draggingTarget;if(draggingTarget){var x=e.offsetX;var y=e.offsetY;var dx=x-this._x;var dy=y-this._y;this._x=x;this._y=y;draggingTarget.drift(dx,dy,e);this.dispatchToElement(param(draggingTarget,e),"drag",e.event);var dropTarget=this.findHover(x,y,draggingTarget).target;var lastDropTarget=this._dropTarget;this._dropTarget=dropTarget;if(draggingTarget!==dropTarget){if(lastDropTarget&&dropTarget!==lastDropTarget){this.dispatchToElement(param(lastDropTarget,e),"dragleave",e.event)}if(dropTarget&&dropTarget!==lastDropTarget){this.dispatchToElement(param(dropTarget,e),"dragenter",e.event)}}}},_dragEnd:function(e){var draggingTarget=this._draggingTarget;if(draggingTarget){draggingTarget.dragging=false}this.dispatchToElement(param(draggingTarget,e),"dragend",e.event);if(this._dropTarget){this.dispatchToElement(param(this._dropTarget,e),"drop",e.event)}this._draggingTarget=null;this._dropTarget=null}};function param(target,e){return{target:target,topTarget:e&&e.topTarget}}var arrySlice=Array.prototype.slice;var Eventful=function(){this._$handlers={}};Eventful.prototype={constructor:Eventful,one:function(event,handler,context){var _h=this._$handlers;if(!handler||!event){return this}if(!_h[event]){_h[event]=[]}for(var i=0;i<_h[event].length;i++){if(_h[event][i].h===handler){return this}}_h[event].push({h:handler,one:true,ctx:context||this});return this},on:function(event,handler,context){var _h=this._$handlers;if(!handler||!event){return this}if(!_h[event]){_h[event]=[]}for(var i=0;i<_h[event].length;i++){if(_h[event][i].h===handler){return this}}var suffix=event.split(".");suffix=1<suffix.length&&suffix[suffix.length-1]||undefined;_h[event].push({h:handler,one:false,ctx:context||this,suffix:suffix});return this},isSilent:function(event){var _h=this._$handlers;return _h[event]&&_h[event].length},off:function(event,handler){var _h=this._$handlers;if(!event){this._$handlers={};return this}if(handler){if(_h[event]){var newList=[];for(var i=0,l=_h[event].length;i<l;i++){if(_h[event][i]["h"]!=handler){newList.push(_h[event][i])}}_h[event]=newList}if(_h[event]&&0===_h[event].length){delete _h[event]}}else{delete _h[event]}return this},trigger:function(type){var handlers=this._handlersByEvent(type);if(handlers.length){var args=arguments;var argLen=args.length;if(3<argLen){args=arrySlice.call(args,1)}}handlers.forEach(_h=>{var len=_h.length;for(var i=0;i<len;){switch(argLen){case 1:_h[i]["h"].call(_h[i]["ctx"]);break;case 2:_h[i]["h"].call(_h[i]["ctx"],args[1]);break;case 3:_h[i]["h"].call(_h[i]["ctx"],args[1],args[2]);break;default:_h[i]["h"].apply(_h[i]["ctx"],args);break;}if(_h[i]["one"]){_h.splice(i,1);len--}else{i++}}});return this},triggerBAK:function(type){if(this._$handlers[type]){var args=arguments;var argLen=args.length;if(3<argLen){args=arrySlice.call(args,1)}var _h=this._$handlers[type];var len=_h.length;for(var i=0;i<len;){switch(argLen){case 1:_h[i]["h"].call(_h[i]["ctx"]);break;case 2:_h[i]["h"].call(_h[i]["ctx"],args[1]);break;case 3:_h[i]["h"].call(_h[i]["ctx"],args[1],args[2]);break;default:_h[i]["h"].apply(_h[i]["ctx"],args);break;}if(_h[i]["one"]){_h.splice(i,1);len--}else{i++}}}return this},triggerWithContext:function(type){if(this._$handlers[type]){var args=arguments;var argLen=args.length;if(4<argLen){args=arrySlice.call(args,1,args.length-1)}var ctx=args[args.length-1];var _h=this._$handlers[type];var len=_h.length;for(var i=0;i<len;){switch(argLen){case 1:_h[i]["h"].call(ctx);break;case 2:_h[i]["h"].call(ctx,args[1]);break;case 3:_h[i]["h"].call(ctx,args[1],args[2]);break;default:_h[i]["h"].apply(ctx,args);break;}if(_h[i]["one"]){_h.splice(i,1);len--}else{i++}}}return this},_handlersByEvent:function(type){var suffix=type.split(".");var result=[];if(1<suffix.length){var list=this._$handlers[type];if(list)result.push(list);return result}var obj=this._$handlers,flist;for(var key in obj){if(obj.hasOwnProperty(key)){let names=key.split(".");if(names[0]===type){if(1==names.length){flist=obj[key];continue}result.push(obj[key])}}}if(flist)result.unshift(flist);return result}};var SILENT="silent";function makeEventPacket(eveType,targetInfo,event){return{type:eveType,event:event,target:targetInfo.target,topTarget:targetInfo.topTarget,cancelBubble:false,offsetX:event.zrX,offsetY:event.zrY,gestureEvent:event.gestureEvent,pinchX:event.pinchX,pinchY:event.pinchY,pinchScale:event.pinchScale,wheelDelta:event.zrDelta,zrByTouch:event.zrByTouch,which:event.which}}function EmptyProxy(){}EmptyProxy.prototype.dispose=function(){};var handlerNames=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"];var Handler=function(storage,painter,proxy,painterRoot){Eventful.call(this);this.storage=storage;this.painter=painter;this.painterRoot=painterRoot;proxy=proxy||new EmptyProxy;this.proxy=null;this._hovered={};this._lastTouchMoment;this._lastX;this._lastY;Draggable.call(this);this.setHandlerProxy(proxy)};Handler.prototype={constructor:Handler,defaultCursor:"inherit",setHandlerProxy:function(proxy){if(this.proxy){this.proxy.dispose()}if(proxy){each(handlerNames,function(name){proxy.on&&proxy.on(name,this[name],this)},this);proxy.handler=this}this.proxy=proxy},mousemove:function(event){var x=event.zrX;var y=event.zrY;var lastHovered=this._hovered;var lastHoveredTarget=lastHovered.target;if(lastHoveredTarget&&!lastHoveredTarget.__zr){lastHovered=this.findHover(lastHovered.x,lastHovered.y);lastHoveredTarget=lastHovered.target}var hovered=this._hovered=this.findHover(x,y);var hoveredTarget=hovered.target;var proxy=this.proxy;proxy.setCursor&&proxy.setCursor(hoveredTarget?hoveredTarget.cursor:this.defaultCursor);if(lastHoveredTarget&&hoveredTarget!==lastHoveredTarget){this.dispatchToElement(lastHovered,"mouseout",event)}this.dispatchToElement(hovered,"mousemove",event);if(hoveredTarget&&hoveredTarget!==lastHoveredTarget){this.dispatchToElement(hovered,"mouseover",event)}},mouseout:function(event){this.dispatchToElement(this._hovered,"mouseout",event);var element=event.toElement||event.relatedTarget;var innerDom;do{element=element&&element.parentNode}while(element&&9!=element.nodeType&&!(innerDom=element===this.painterRoot));!innerDom&&this.trigger("globalout",{event:event})},resize:function(event){this._hovered={}},dispatch:function(eventName,eventArgs){var handler=this[eventName];handler&&handler.call(this,eventArgs)},dispose:function(){this.proxy.dispose();this.storage=this.proxy=this.painter=null},setCursorStyle:function(cursorStyle){var proxy=this.proxy;proxy.setCursor&&proxy.setCursor(cursorStyle)},dispatchToElement:function(targetInfo,eventName,event){targetInfo=targetInfo||{};var el=targetInfo.target;if(el&&el.silent){return}var eventHandler="on"+eventName;var eventPacket=makeEventPacket(eventName,targetInfo,event);while(el){el[eventHandler]&&(eventPacket.cancelBubble=el[eventHandler].call(el,eventPacket));el.trigger(eventName,eventPacket);el=el.parent;if(eventPacket.cancelBubble){break}}if(!eventPacket.cancelBubble){this.trigger(eventName,eventPacket);this.painter&&this.painter.eachOtherLayer(function(layer){if("function"==typeof layer[eventHandler]){layer[eventHandler].call(layer,eventPacket)}if(layer.trigger){layer.trigger(eventName,eventPacket)}})}},findHover:function(x,y,exclude){var list=this.storage.getDisplayList();var out={x:x,y:y};for(var i=list.length-1;0<=i;i--){var hoverCheckResult;if(list[i]!==exclude&&!list[i].ignore&&(hoverCheckResult=isHover(list[i],x,y))){!out.topTarget&&(out.topTarget=list[i]);if(hoverCheckResult!==SILENT){out.target=list[i];break}}}return out}};each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(name){Handler.prototype[name]=function(event){var hovered=this.findHover(event.zrX,event.zrY);var hoveredTarget=hovered.target;if("mousedown"===name){this._downEl=hoveredTarget;this._downPoint=[event.zrX,event.zrY];this._upEl=hoveredTarget}else if("mouseup"===name){this._upEl=hoveredTarget}else if("click"===name){if(this._downEl!==this._upEl||!this._downPoint||4<dist(this._downPoint,[event.zrX,event.zrY])){return}this._downPoint=null}this.dispatchToElement(hovered,name,event)}});function isHover(displayable,x,y){if(displayable[displayable.rectHover?"rectContain":"contain"](x,y)){var el=displayable;var isSilent;while(el){if(el.clipPath&&!el.clipPath.contain(x,y)){return false}if(el.silent){isSilent=true}el=el.parent}return isSilent?SILENT:true}return false}mixin(Handler,Eventful);mixin(Handler,Draggable);var ArrayCtor$1="undefined"===typeof Float32Array?Array:Float32Array;function create$1(){var out=new ArrayCtor$1(6);identity(out);return out}function identity(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out}function copy$1(out,m){out[0]=m[0];out[1]=m[1];out[2]=m[2];out[3]=m[3];out[4]=m[4];out[5]=m[5];return out}function mul$1(out,m1,m2){var out0=m1[0]*m2[0]+m1[2]*m2[1];var out1=m1[1]*m2[0]+m1[3]*m2[1];var out2=m1[0]*m2[2]+m1[2]*m2[3];var out3=m1[1]*m2[2]+m1[3]*m2[3];var out4=m1[0]*m2[4]+m1[2]*m2[5]+m1[4];var out5=m1[1]*m2[4]+m1[3]*m2[5]+m1[5];out[0]=out0;out[1]=out1;out[2]=out2;out[3]=out3;out[4]=out4;out[5]=out5;return out}function translate(out,a,v){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4]+v[0];out[5]=a[5]+v[1];return out}function rotate(out,a,rad){var aa=a[0];var ac=a[2];var atx=a[4];var ab=a[1];var ad=a[3];var aty=a[5];var st=Math.sin(rad);var ct=Math.cos(rad);out[0]=aa*ct+ab*st;out[1]=-aa*st+ab*ct;out[2]=ac*ct+ad*st;out[3]=-ac*st+ct*ad;out[4]=ct*atx+st*aty;out[5]=ct*aty-st*atx;return out}function scale$1(out,a,v){var vx=v[0];var vy=v[1];out[0]=a[0]*vx;out[1]=a[1]*vy;out[2]=a[2]*vx;out[3]=a[3]*vy;out[4]=a[4]*vx;out[5]=a[5]*vy;return out}function invert(out,a){var aa=a[0];var ac=a[2];var atx=a[4];var ab=a[1];var ad=a[3];var aty=a[5];var det=aa*ad-ab*ac;if(!det){return null}det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out}function clone$2(a){var b=create$1();copy$1(b,a);return b}var matrix=(Object.freeze||Object)({create:create$1,identity:identity,copy:copy$1,mul:mul$1,translate:translate,rotate:rotate,scale:scale$1,invert:invert,clone:clone$2});var mIdentity=identity;var EPSILON=5e-5;function isNotAroundZero(val){return val>EPSILON||val<-EPSILON}var Transformable=function(opts){opts=opts||{};if(!opts.position){this.position=[0,0]}if(null==opts.rotation){this.rotation=0}if(!opts.scale){this.scale=[1,1]}this.origin=this.origin||null};var transformableProto=Transformable.prototype;transformableProto.transform=null;transformableProto.needLocalTransform=function(){return isNotAroundZero(this.rotation)||isNotAroundZero(this.position[0])||isNotAroundZero(this.position[1])||isNotAroundZero(this.scale[0]-1)||isNotAroundZero(this.scale[1]-1)};transformableProto.updateTransform=function(){var parent=this.parent;var parentHasTransform=parent&&parent.transform;var needLocalTransform=this.needLocalTransform();var m=this.transform;if(!(needLocalTransform||parentHasTransform)){m&&mIdentity(m);return}m=m||create$1();if(needLocalTransform){this.getLocalTransform(m)}else{mIdentity(m)}if(parentHasTransform){if(needLocalTransform){mul$1(m,parent.transform,m)}else{copy$1(m,parent.transform)}}this.transform=m;this.invTransform=this.invTransform||create$1();invert(this.invTransform,m)};transformableProto.getLocalTransform=function(m){return Transformable.getLocalTransform(this,m)};transformableProto.setTransform=function(ctx){var m=this.transform;var dpr=ctx.dpr||1;if(m){ctx.setTransform(dpr*m[0],dpr*m[1],dpr*m[2],dpr*m[3],dpr*m[4],dpr*m[5])}else{ctx.setTransform(dpr,0,0,dpr,0,0)}};transformableProto.restoreTransform=function(ctx){var dpr=ctx.dpr||1;ctx.setTransform(dpr,0,0,dpr,0,0)};var tmpTransform=[];transformableProto.decomposeTransform=function(){if(!this.transform){return}var parent=this.parent;var m=this.transform;if(parent&&parent.transform){mul$1(tmpTransform,parent.invTransform,m);m=tmpTransform}var sx=m[0]*m[0]+m[1]*m[1];var sy=m[2]*m[2]+m[3]*m[3];var position=this.position;var scale$$1=this.scale;if(isNotAroundZero(sx-1)){sx=Math.sqrt(sx)}if(isNotAroundZero(sy-1)){sy=Math.sqrt(sy)}if(0>m[0]){sx=-sx}if(0>m[3]){sy=-sy}position[0]=m[4];position[1]=m[5];scale$$1[0]=sx;scale$$1[1]=sy;this.rotation=Math.atan2(-m[1]/sy,m[0]/sx)};transformableProto.getGlobalScale=function(){var m=this.transform;if(!m){return[1,1]}var sx=Math.sqrt(m[0]*m[0]+m[1]*m[1]);var sy=Math.sqrt(m[2]*m[2]+m[3]*m[3]);if(0>m[0]){sx=-sx}if(0>m[3]){sy=-sy}return[sx,sy]};transformableProto.transformCoordToLocal=function(x,y){var v2=[x,y];var invTransform=this.invTransform;if(invTransform){applyTransform(v2,v2,invTransform)}return v2};transformableProto.transformCoordToGlobal=function(x,y){var v2=[x,y];var transform=this.transform;if(transform){applyTransform(v2,v2,transform)}return v2};Transformable.getLocalTransform=function(target,m){m=m||[];mIdentity(m);var origin=target.origin;var scale$$1=target.scale||[1,1];var rotation=target.rotation||0;var position=target.position||[0,0];if(origin){m[4]-=origin[0];m[5]-=origin[1]}scale$1(m,m,scale$$1);if(rotation){rotate(m,m,rotation)}if(origin){m[4]+=origin[0];m[5]+=origin[1]}m[4]+=position[0];m[5]+=position[1];return m};var easing={linear:function(k){return k},quadraticIn:function(k){return k*k},quadraticOut:function(k){return k*(2-k)},quadraticInOut:function(k){if(1>(k*=2)){return 0.5*k*k}return-0.5*(--k*(k-2)-1)},cubicIn:function(k){return k*k*k},cubicOut:function(k){return--k*k*k+1},cubicInOut:function(k){if(1>(k*=2)){return 0.5*k*k*k}return 0.5*((k-=2)*k*k+2)},quarticIn:function(k){return k*k*k*k},quarticOut:function(k){return 1- --k*k*k*k},quarticInOut:function(k){if(1>(k*=2)){return 0.5*k*k*k*k}return-0.5*((k-=2)*k*k*k-2)},quinticIn:function(k){return k*k*k*k*k},quinticOut:function(k){return--k*k*k*k*k+1},quinticInOut:function(k){if(1>(k*=2)){return 0.5*k*k*k*k*k}return 0.5*((k-=2)*k*k*k*k+2)},sinusoidalIn:function(k){return 1-Math.cos(k*Math.PI/2)},sinusoidalOut:function(k){return Math.sin(k*Math.PI/2)},sinusoidalInOut:function(k){return 0.5*(1-Math.cos(Math.PI*k))},exponentialIn:function(k){return 0===k?0:Math.pow(1024,k-1)},exponentialOut:function(k){return 1===k?1:1-Math.pow(2,-10*k)},exponentialInOut:function(k){if(0===k){return 0}if(1===k){return 1}if(1>(k*=2)){return 0.5*Math.pow(1024,k-1)}return 0.5*(-Math.pow(2,-10*(k-1))+2)},circularIn:function(k){return 1-Math.sqrt(1-k*k)},circularOut:function(k){return Math.sqrt(1- --k*k)},circularInOut:function(k){if(1>(k*=2)){return-0.5*(Math.sqrt(1-k*k)-1)}return 0.5*(Math.sqrt(1-(k-=2)*k)+1)},elasticIn:function(k){var s;var a=0.1;var p=0.4;if(0===k){return 0}if(1===k){return 1}if(!a||1>a){a=1;s=p/4}else{s=p*Math.asin(1/a)/(2*Math.PI)}return-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},elasticOut:function(k){var s;var a=0.1;var p=0.4;if(0===k){return 0}if(1===k){return 1}if(!a||1>a){a=1;s=p/4}else{s=p*Math.asin(1/a)/(2*Math.PI)}return a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1},elasticInOut:function(k){var s;var a=0.1;var p=0.4;if(0===k){return 0}if(1===k){return 1}if(!a||1>a){a=1;s=p/4}else{s=p*Math.asin(1/a)/(2*Math.PI)}if(1>(k*=2)){return-0.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))}return 0.5*(a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))+1},backIn:function(k){var s=1.70158;return k*k*((s+1)*k-s)},backOut:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},backInOut:function(k){var s=1.525*1.70158;if(1>(k*=2)){return 0.5*(k*k*((s+1)*k-s))}return 0.5*((k-=2)*k*((s+1)*k+s)+2)},bounceIn:function(k){return 1-easing.bounceOut(1-k)},bounceOut:function(k){if(k<1/2.75){return 7.5625*k*k}else if(k<2/2.75){return 7.5625*(k-=1.5/2.75)*k+0.75}else if(k<2.5/2.75){return 7.5625*(k-=2.25/2.75)*k+0.9375}else{return 7.5625*(k-=2.625/2.75)*k+0.984375}},bounceInOut:function(k){if(0.5>k){return 0.5*easing.bounceIn(2*k)}return 0.5*easing.bounceOut(2*k-1)+0.5}};function Clip(options){this._target=options.target;this._life=options.life||1000;this._delay=options.delay||0;this._initialized=false;this.loop=null==options.loop?false:options.loop;this.gap=options.gap||0;this.easing=options.easing||"Linear";this.onframe=options.onframe;this.ondestroy=options.ondestroy;this.onrestart=options.onrestart;this._pausedTime=0;this._paused=false}Clip.prototype={constructor:Clip,step:function(globalTime,deltaTime){if(!this._initialized){this._startTime=globalTime+this._delay;this._initialized=true}if(this._paused){this._pausedTime+=deltaTime;return}var percent=(globalTime-this._startTime-this._pausedTime)/this._life;if(0>percent){return}percent=Math.min(percent,1);var easing$$1=this.easing;var easingFunc="string"==typeof easing$$1?easing[easing$$1]:easing$$1;var schedule="function"===typeof easingFunc?easingFunc(percent):percent;this.fire("frame",schedule);if(1==percent){if(this.loop){this.restart(globalTime);return"restart"}this._needsRemove=true;return"destroy"}return null},restart:function(globalTime){var remainder=(globalTime-this._startTime-this._pausedTime)%this._life;this._startTime=globalTime-remainder+this.gap;this._pausedTime=0;this._needsRemove=false},fire:function(eventType,arg){eventType="on"+eventType;if(this[eventType]){this[eventType](this._target,arg)}},pause:function(){this._paused=true},resume:function(){this._paused=false}};var LinkedList=function(){this.head=null;this.tail=null;this._len=0};var linkedListProto=LinkedList.prototype;linkedListProto.insert=function(val){var entry=new Entry(val);this.insertEntry(entry);return entry};linkedListProto.insertEntry=function(entry){if(!this.head){this.head=this.tail=entry}else{this.tail.next=entry;entry.prev=this.tail;entry.next=null;this.tail=entry}this._len++};linkedListProto.remove=function(entry){var prev=entry.prev;var next=entry.next;if(prev){prev.next=next}else{this.head=next}if(next){next.prev=prev}else{this.tail=prev}entry.next=entry.prev=null;this._len--};linkedListProto.len=function(){return this._len};linkedListProto.clear=function(){this.head=this.tail=null;this._len=0};var Entry=function(val){this.value=val;this.next;this.prev};var LRU=function(maxSize){this._list=new LinkedList;this._map={};this._maxSize=maxSize||10;this._lastRemovedEntry=null};var LRUProto=LRU.prototype;LRUProto.put=function(key,value){var list=this._list;var map=this._map;var removed=null;if(null==map[key]){var len=list.len();var entry=this._lastRemovedEntry;if(len>=this._maxSize&&0<len){var leastUsedEntry=list.head;list.remove(leastUsedEntry);delete map[leastUsedEntry.key];removed=leastUsedEntry.value;this._lastRemovedEntry=leastUsedEntry}if(entry){entry.value=value}else{entry=new Entry(value)}entry.key=key;list.insertEntry(entry);map[key]=entry}return removed};LRUProto.get=function(key){var entry=this._map[key];var list=this._list;if(null!=entry){if(entry!==list.tail){list.remove(entry);list.insertEntry(entry)}return entry.value}};LRUProto.clear=function(){this._list.clear();this._map={}};var kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function clampCssByte(i){i=Math.round(i);return 0>i?0:255<i?255:i}function clampCssAngle(i){i=Math.round(i);return 0>i?0:360<i?360:i}function clampCssFloat(f){return 0>f?0:1<f?1:f}function parseCssInt(str){if(str.length&&"%"===str.charAt(str.length-1)){return clampCssByte(255*(parseFloat(str)/100))}return clampCssByte(parseInt(str,10))}function parseCssFloat(str){if(str.length&&"%"===str.charAt(str.length-1)){return clampCssFloat(parseFloat(str)/100)}return clampCssFloat(parseFloat(str))}function cssHueToRgb(m1,m2,h){if(0>h){h+=1}else if(1<h){h-=1}if(1>6*h){return m1+6*((m2-m1)*h)}if(1>2*h){return m2}if(2>3*h){return m1+6*((m2-m1)*(2/3-h))}return m1}function lerpNumber(a,b,p){return a+(b-a)*p}function setRgba(out,r,g,b,a){out[0]=r;out[1]=g;out[2]=b;out[3]=a;return out}function copyRgba(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}var colorCache=new LRU(20);var lastRemovedArr=null;function putToCache(colorStr,rgbaArr){if(lastRemovedArr){copyRgba(lastRemovedArr,rgbaArr)}lastRemovedArr=colorCache.put(colorStr,lastRemovedArr||rgbaArr.slice())}function parse(colorStr,rgbaArr){if(!colorStr){return}rgbaArr=rgbaArr||[];var cached=colorCache.get(colorStr);if(cached){return copyRgba(rgbaArr,cached)}colorStr=colorStr+"";var str=colorStr.replace(/ /g,"").toLowerCase();if(str in kCSSColorTable){copyRgba(rgbaArr,kCSSColorTable[str]);putToCache(colorStr,rgbaArr);return rgbaArr}if("#"===str.charAt(0)){if(4===str.length){var iv=parseInt(str.substr(1),16);if(!(0<=iv&&4095>=iv)){setRgba(rgbaArr,0,0,0,1);return}setRgba(rgbaArr,(3840&iv)>>4|(3840&iv)>>8,240&iv|(240&iv)>>4,15&iv|(15&iv)<<4,1);putToCache(colorStr,rgbaArr);return rgbaArr}else if(7===str.length){var iv=parseInt(str.substr(1),16);if(!(0<=iv&&16777215>=iv)){setRgba(rgbaArr,0,0,0,1);return}setRgba(rgbaArr,(16711680&iv)>>16,(65280&iv)>>8,255&iv,1);putToCache(colorStr,rgbaArr);return rgbaArr}return}var op=str.indexOf("("),ep=str.indexOf(")");if(-1!==op&&ep+1===str.length){var fname=str.substr(0,op);var params=str.substr(op+1,ep-(op+1)).split(",");var alpha=1;switch(fname){case"rgba":if(4!==params.length){setRgba(rgbaArr,0,0,0,1);return}alpha=parseCssFloat(params.pop());case"rgb":if(3!==params.length){setRgba(rgbaArr,0,0,0,1);return}setRgba(rgbaArr,parseCssInt(params[0]),parseCssInt(params[1]),parseCssInt(params[2]),alpha);putToCache(colorStr,rgbaArr);return rgbaArr;case"hsla":if(4!==params.length){setRgba(rgbaArr,0,0,0,1);return}params[3]=parseCssFloat(params[3]);hsla2rgba(params,rgbaArr);putToCache(colorStr,rgbaArr);return rgbaArr;case"hsl":if(3!==params.length){setRgba(rgbaArr,0,0,0,1);return}hsla2rgba(params,rgbaArr);putToCache(colorStr,rgbaArr);return rgbaArr;default:return;}}setRgba(rgbaArr,0,0,0,1);return}function hsla2rgba(hsla,rgba){var h=(parseFloat(hsla[0])%360+360)%360/360;var s=parseCssFloat(hsla[1]);var l=parseCssFloat(hsla[2]);var m2=0.5>=l?l*(s+1):l+s-l*s;var m1=2*l-m2;rgba=rgba||[];setRgba(rgba,clampCssByte(255*cssHueToRgb(m1,m2,h+1/3)),clampCssByte(255*cssHueToRgb(m1,m2,h)),clampCssByte(255*cssHueToRgb(m1,m2,h-1/3)),1);if(4===hsla.length){rgba[3]=hsla[3]}return rgba}function rgba2hsla(rgba){if(!rgba){return}var R=rgba[0]/255;var G=rgba[1]/255;var B=rgba[2]/255;var vMin=Math.min(R,G,B);var vMax=Math.max(R,G,B);var delta=vMax-vMin;var L=(vMax+vMin)/2;var H;var S;if(0===delta){H=0;S=0}else{if(0.5>L){S=delta/(vMax+vMin)}else{S=delta/(2-vMax-vMin)}var deltaR=((vMax-R)/6+delta/2)/delta;var deltaG=((vMax-G)/6+delta/2)/delta;var deltaB=((vMax-B)/6+delta/2)/delta;if(R===vMax){H=deltaB-deltaG}else if(G===vMax){H=1/3+deltaR-deltaB}else if(B===vMax){H=2/3+deltaG-deltaR}if(0>H){H+=1}if(1<H){H-=1}}var hsla=[360*H,S,L];if(null!=rgba[3]){hsla.push(rgba[3])}return hsla}function lift(color,level){var colorArr=parse(color);if(colorArr){for(var i=0;3>i;i++){if(0>level){colorArr[i]=0|colorArr[i]*(1-level)}else{colorArr[i]=0|(255-colorArr[i])*level+colorArr[i]}if(255<colorArr[i]){colorArr[i]=255}else if(0>color[i]){colorArr[i]=0}}return stringify(colorArr,4===colorArr.length?"rgba":"rgb")}}function toHex(color){var colorArr=parse(color);if(colorArr){return((1<<24)+(colorArr[0]<<16)+(colorArr[1]<<8)+ +colorArr[2]).toString(16).slice(1)}}function fastLerp(normalizedValue,colors,out){if(!(colors&&colors.length)||!(0<=normalizedValue&&1>=normalizedValue)){return}out=out||[];var value=normalizedValue*(colors.length-1);var leftIndex=Math.floor(value);var rightIndex=Math.ceil(value);var leftColor=colors[leftIndex];var rightColor=colors[rightIndex];var dv=value-leftIndex;out[0]=clampCssByte(lerpNumber(leftColor[0],rightColor[0],dv));out[1]=clampCssByte(lerpNumber(leftColor[1],rightColor[1],dv));out[2]=clampCssByte(lerpNumber(leftColor[2],rightColor[2],dv));out[3]=clampCssFloat(lerpNumber(leftColor[3],rightColor[3],dv));return out}var fastMapToColor=fastLerp;function lerp$1(normalizedValue,colors,fullOutput){if(!(colors&&colors.length)||!(0<=normalizedValue&&1>=normalizedValue)){return}var value=normalizedValue*(colors.length-1);var leftIndex=Math.floor(value);var rightIndex=Math.ceil(value);var leftColor=parse(colors[leftIndex]);var rightColor=parse(colors[rightIndex]);var dv=value-leftIndex;var color=stringify([clampCssByte(lerpNumber(leftColor[0],rightColor[0],dv)),clampCssByte(lerpNumber(leftColor[1],rightColor[1],dv)),clampCssByte(lerpNumber(leftColor[2],rightColor[2],dv)),clampCssFloat(lerpNumber(leftColor[3],rightColor[3],dv))],"rgba");return fullOutput?{color:color,leftIndex:leftIndex,rightIndex:rightIndex,value:value}:color}var mapToColor=lerp$1;function modifyHSL(color,h,s,l){color=parse(color);if(color){color=rgba2hsla(color);null!=h&&(color[0]=clampCssAngle(h));null!=s&&(color[1]=parseCssFloat(s));null!=l&&(color[2]=parseCssFloat(l));return stringify(hsla2rgba(color),"rgba")}}function modifyAlpha(color,alpha){color=parse(color);if(color&&null!=alpha){color[3]=clampCssFloat(alpha);return stringify(color,"rgba")}}function stringify(arrColor,type){if(!arrColor||!arrColor.length){return}var colorStr=arrColor[0]+","+arrColor[1]+","+arrColor[2];if("rgba"===type||"hsva"===type||"hsla"===type){colorStr+=","+arrColor[3]}return type+"("+colorStr+")"}var color=(Object.freeze||Object)({parse:parse,lift:lift,toHex:toHex,fastLerp:fastLerp,fastMapToColor:fastMapToColor,lerp:lerp$1,mapToColor:mapToColor,modifyHSL:modifyHSL,modifyAlpha:modifyAlpha,stringify:stringify});var arraySlice=Array.prototype.slice;function defaultGetter(target,key){return target[key]}function defaultSetter(target,key,value){target[key]=value}function interpolateNumber(p0,p1,percent){return(p1-p0)*percent+p0}function interpolateString(p0,p1,percent){return 0.5<percent?p1:p0}function interpolateArray(p0,p1,percent,out,arrDim){var len=p0.length;if(1==arrDim){for(var i=0;i<len;i++){out[i]=interpolateNumber(p0[i],p1[i],percent)}}else{var len2=len&&p0[0].length;for(var i=0;i<len;i++){for(var j=0;j<len2;j++){out[i][j]=interpolateNumber(p0[i][j],p1[i][j],percent)}}}}function fillArr(arr0,arr1,arrDim){var arr0Len=arr0.length;var arr1Len=arr1.length;if(arr0Len!==arr1Len){var isPreviousLarger=arr0Len>arr1Len;if(isPreviousLarger){arr0.length=arr1Len}else{for(var i=arr0Len;i<arr1Len;i++){arr0.push(1===arrDim?arr1[i]:arraySlice.call(arr1[i]))}}}var len2=arr0[0]&&arr0[0].length;for(var i=0;i<arr0.length;i++){if(1===arrDim){if(isNaN(arr0[i])){arr0[i]=arr1[i]}}else{for(var j=0;j<len2;j++){if(isNaN(arr0[i][j])){arr0[i][j]=arr1[i][j]}}}}}function isArraySame(arr0,arr1,arrDim){if(arr0===arr1){return true}var len=arr0.length;if(len!==arr1.length){return false}if(1===arrDim){for(var i=0;i<len;i++){if(arr0[i]!==arr1[i]){return false}}}else{var len2=arr0[0].length;for(var i=0;i<len;i++){for(var j=0;j<len2;j++){if(arr0[i][j]!==arr1[i][j]){return false}}}}return true}function catmullRomInterpolateArray(p0,p1,p2,p3,t,t2,t3,out,arrDim){var len=p0.length;if(1==arrDim){for(var i=0;i<len;i++){out[i]=catmullRomInterpolate(p0[i],p1[i],p2[i],p3[i],t,t2,t3)}}else{var len2=p0[0].length;for(var i=0;i<len;i++){for(var j=0;j<len2;j++){out[i][j]=catmullRomInterpolate(p0[i][j],p1[i][j],p2[i][j],p3[i][j],t,t2,t3)}}}}function catmullRomInterpolate(p0,p1,p2,p3,t,t2,t3){var v0=0.5*(p2-p0);var v1=0.5*(p3-p1);return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1}function cloneValue(value){if(isArrayLike(value)){var len=value.length;if(isArrayLike(value[0])){var ret=[];for(var i=0;i<len;i++){ret.push(arraySlice.call(value[i]))}return ret}return arraySlice.call(value)}return value}function rgba2String(rgba){rgba[0]=Math.floor(rgba[0]);rgba[1]=Math.floor(rgba[1]);rgba[2]=Math.floor(rgba[2]);return"rgba("+rgba.join(",")+")"}function getArrayDim(keyframes){var lastValue=keyframes[keyframes.length-1].value;return isArrayLike(lastValue&&lastValue[0])?2:1}function createTrackClip(animator,easing,oneTrackDone,keyframes,propName,forceAnimate){var getter=animator._getter;var setter=animator._setter;var useSpline="spline"===easing;var trackLen=keyframes.length;if(!trackLen){return}var firstVal=keyframes[0].value;var isValueArray=isArrayLike(firstVal);var isValueColor=false;var isValueString=false;var arrDim=isValueArray?getArrayDim(keyframes):0;var trackMaxTime;keyframes.sort(function(a,b){return a.time-b.time});trackMaxTime=keyframes[trackLen-1].time;var kfPercents=[];var kfValues=[];var prevValue=keyframes[0].value;var isAllValueEqual=true;for(var i=0;i<trackLen;i++){kfPercents.push(keyframes[i].time/trackMaxTime);var value=keyframes[i].value;if(!(isValueArray&&isArraySame(value,prevValue,arrDim)||!isValueArray&&value===prevValue)){isAllValueEqual=false}prevValue=value;if("string"==typeof value){var colorArray=parse(value);if(colorArray){value=colorArray;isValueColor=true}else{isValueString=true}}kfValues.push(value)}if(!forceAnimate&&isAllValueEqual){return}var lastValue=kfValues[trackLen-1];for(var i=0;i<trackLen-1;i++){if(isValueArray){fillArr(kfValues[i],lastValue,arrDim)}else{if(isNaN(kfValues[i])&&!isNaN(lastValue)&&!isValueString&&!isValueColor){kfValues[i]=lastValue}}}isValueArray&&fillArr(getter(animator._target,propName),lastValue,arrDim);var lastFrame=0;var lastFramePercent=0;var start;var w;var p0;var p1;var p2;var p3;if(isValueColor){var rgba=[0,0,0,0]}var onframe=function(target,percent){var frame;if(0>percent){frame=0}else if(percent<lastFramePercent){start=Math.min(lastFrame+1,trackLen-1);for(frame=start;0<=frame;frame--){if(kfPercents[frame]<=percent){break}}frame=Math.min(frame,trackLen-2)}else{for(frame=lastFrame;frame<trackLen;frame++){if(kfPercents[frame]>percent){break}}frame=Math.min(frame-1,trackLen-2)}lastFrame=frame;lastFramePercent=percent;var range=kfPercents[frame+1]-kfPercents[frame];if(0===range){return}else{w=(percent-kfPercents[frame])/range}if(useSpline){p1=kfValues[frame];p0=kfValues[0===frame?frame:frame-1];p2=kfValues[frame>trackLen-2?trackLen-1:frame+1];p3=kfValues[frame>trackLen-3?trackLen-1:frame+2];if(isValueArray){catmullRomInterpolateArray(p0,p1,p2,p3,w,w*w,w*w*w,getter(target,propName),arrDim)}else{var value;if(isValueColor){value=catmullRomInterpolateArray(p0,p1,p2,p3,w,w*w,w*w*w,rgba,1);value=rgba2String(rgba)}else if(isValueString){return interpolateString(p1,p2,w)}else{value=catmullRomInterpolate(p0,p1,p2,p3,w,w*w,w*w*w)}setter(target,propName,value)}}else{if(isValueArray){interpolateArray(kfValues[frame],kfValues[frame+1],w,getter(target,propName),arrDim)}else{var value;if(isValueColor){interpolateArray(kfValues[frame],kfValues[frame+1],w,rgba,1);value=rgba2String(rgba)}else if(isValueString){return interpolateString(kfValues[frame],kfValues[frame+1],w)}else{value=interpolateNumber(kfValues[frame],kfValues[frame+1],w)}setter(target,propName,value)}}};var clip=new Clip({target:animator._target,life:trackMaxTime,loop:animator._loop,delay:animator._delay,onframe:onframe,ondestroy:oneTrackDone});if(easing&&"spline"!==easing){clip.easing=easing}return clip}var Animator=function(target,loop,getter,setter){this._tracks={};this._target=target;this._loop=loop||false;this._getter=getter||defaultGetter;this._setter=setter||defaultSetter;this._clipCount=0;this._delay=0;this._doneList=[];this._onframeList=[];this._clipList=[]};Animator.prototype={when:function(time,props){var tracks=this._tracks;for(var propName in props){if(!props.hasOwnProperty(propName)){continue}if(!tracks[propName]){tracks[propName]=[];var value=this._getter(this._target,propName);if(null==value){continue}if(0!==time){tracks[propName].push({time:0,value:cloneValue(value)})}}tracks[propName].push({time:time,value:props[propName]})}return this},during:function(callback){this._onframeList.push(callback);return this},pause:function(){for(var i=0;i<this._clipList.length;i++){this._clipList[i].pause()}this._paused=true},resume:function(){for(var i=0;i<this._clipList.length;i++){this._clipList[i].resume()}this._paused=false},isPaused:function(){return!!this._paused},_doneCallback:function(){this._tracks={};this._clipList.length=0;var doneList=this._doneList;var len=doneList.length;for(var i=0;i<len;i++){doneList[i].call(this)}},start:function(easing,forceAnimate){var self=this;var clipCount=0;var oneTrackDone=function(){clipCount--;if(!clipCount){self._doneCallback()}};var lastClip;for(var propName in this._tracks){if(!this._tracks.hasOwnProperty(propName)){continue}var clip=createTrackClip(this,easing,oneTrackDone,this._tracks[propName],propName,forceAnimate);if(clip){this._clipList.push(clip);clipCount++;if(this.animation){this.animation.addClip(clip)}lastClip=clip}}if(lastClip){var oldOnFrame=lastClip.onframe;lastClip.onframe=function(target,percent){oldOnFrame(target,percent);for(var i=0;i<self._onframeList.length;i++){self._onframeList[i](target,percent)}}}if(!clipCount){this._doneCallback()}return this},stop:function(forwardToLast){var clipList=this._clipList;var animation=this.animation;for(var i=0;i<clipList.length;i++){var clip=clipList[i];if(forwardToLast){clip.onframe(this._target,1)}animation&&animation.removeClip(clip)}clipList.length=0},delay:function(time){this._delay=time;return this},done:function(cb){if(cb){this._doneList.push(cb)}return this},getClips:function(){return this._clipList}};var dpr=1;if("undefined"!==typeof window){dpr=Math.max(window.devicePixelRatio||1,1)}var debugMode=0;var devicePixelRatio=dpr;var log=function(){};if(1===debugMode){log=function(){for(var k in arguments){throw new Error(arguments[k])}}}else if(1<debugMode){log=function(){for(var k in arguments){console.log(arguments[k])}}}var zrLog=log;var Animatable=function(){this.animators=[]};Animatable.prototype={constructor:Animatable,animate:function(path,loop){var target;var animatingShape=false;var el=this;var zr=this.__zr;if(path){var pathSplitted=path.split(".");var prop=el;animatingShape="shape"===pathSplitted[0];for(var i=0,l=pathSplitted.length;i<l;i++){if(!prop){continue}prop=prop[pathSplitted[i]]}if(prop){target=prop}}else{target=el}if(!target){zrLog("Property \""+path+"\" is not existed in element "+el.id);return}var animators=el.animators;var animator=new Animator(target,loop);animator.during(function(target){el.dirty(animatingShape)}).done(function(){animators.splice(indexOf(animators,animator),1)});animators.push(animator);if(zr){zr.animation.addAnimator(animator)}return animator},stopAnimation:function(forwardToLast){var animators=this.animators;var len=animators.length;for(var i=0;i<len;i++){animators[i].stop(forwardToLast)}animators.length=0;return this},animateTo:function(target,time,delay,easing,callback,forceAnimate){if(isString(delay)){callback=easing;easing=delay;delay=0}else if(isFunction(easing)){callback=easing;easing="linear";delay=0}else if(isFunction(delay)){callback=delay;delay=0}else if(isFunction(time)){callback=time;time=500}else if(!time){time=500}this.stopAnimation();this._animateToShallow("",this,target,time,delay);var animators=this.animators.slice();var count=animators.length;function done(){count--;if(!count){callback&&callback()}}if(!count){callback&&callback()}for(var i=0;i<animators.length;i++){animators[i].done(done).start(easing,forceAnimate)}},_animateToShallow:function(path,source,target,time,delay){var objShallow={};var propertyCount=0;for(var name in target){if(!target.hasOwnProperty(name)){continue}if(null!=source[name]){if(isObject(target[name])&&!isArrayLike(target[name])){this._animateToShallow(path?path+"."+name:name,source[name],target[name],time,delay)}else{objShallow[name]=target[name];propertyCount++}}else if(null!=target[name]){if(!path){this.attr(name,target[name])}else{var props={};props[path]={};props[path][name]=target[name];this.attr(props)}}}if(0<propertyCount){this.animate(path,false).when(null==time?500:time,objShallow).delay(delay||0)}return this}};var Element=function(opts){Transformable.call(this,opts);Eventful.call(this,opts);Animatable.call(this,opts);this.id=opts.id||guid()};Element.prototype={type:"element",name:"",__zr:null,ignore:false,clipPath:null,isGroup:false,drift:function(dx,dy){switch(this.draggable){case"horizontal":dy=0;break;case"vertical":dx=0;break;}var m=this.transform;if(!m){m=this.transform=[1,0,0,1,0,0]}m[4]+=dx;m[5]+=dy;this.decomposeTransform();this.dirty(false)},beforeUpdate:function(){},afterUpdate:function(){},update:function(){this.updateTransform()},traverse:function(cb,context){},attrKV:function(key,value){if("position"===key||"scale"===key||"origin"===key){if(value){var target=this[key];if(!target){target=this[key]=[]}target[0]=value[0];target[1]=value[1]}}else{this[key]=value}},hide:function(){this.ignore=true;this.__zr&&this.__zr.refresh()},show:function(){this.ignore=false;this.__zr&&this.__zr.refresh()},attr:function(key,value){if("string"===typeof key){this.attrKV(key,value)}else if(isObject(key)){for(var name in key){if(key.hasOwnProperty(name)){this.attrKV(name,key[name])}}}this.dirty(false);return this},setClipPath:function(clipPath){var zr=this.__zr;if(zr){clipPath.addSelfToZr(zr)}if(this.clipPath&&this.clipPath!==clipPath){this.removeClipPath()}this.clipPath=clipPath;clipPath.__zr=zr;clipPath.__clipTarget=this;this.dirty(false)},removeClipPath:function(){var clipPath=this.clipPath;if(clipPath){if(clipPath.__zr){clipPath.removeSelfFromZr(clipPath.__zr)}clipPath.__zr=null;clipPath.__clipTarget=null;this.clipPath=null;this.dirty(false)}},addSelfToZr:function(zr){this.__zr=zr;var animators=this.animators;if(animators){for(var i=0;i<animators.length;i++){zr.animation.addAnimator(animators[i])}}if(this.clipPath){this.clipPath.addSelfToZr(zr)}},removeSelfFromZr:function(zr){this.__zr=null;var animators=this.animators;if(animators){for(var i=0;i<animators.length;i++){zr.animation.removeAnimator(animators[i])}}if(this.clipPath){this.clipPath.removeSelfFromZr(zr)}}};mixin(Element,Animatable);mixin(Element,Transformable);mixin(Element,Eventful);var v2ApplyTransform=applyTransform;var mathMin=Math.min;var mathMax=Math.max;function BoundingRect(x,y,width,height){if(0>width){x=x+width;width=-width}if(0>height){y=y+height;height=-height}this.x=x;this.y=y;this.width=width;this.height=height}BoundingRect.prototype={constructor:BoundingRect,union:function(other){var x=mathMin(other.x,this.x);var y=mathMin(other.y,this.y);this.width=mathMax(other.x+other.width,this.x+this.width)-x;this.height=mathMax(other.y+other.height,this.y+this.height)-y;this.x=x;this.y=y},applyTransform:function(){var lt=[];var rb=[];var lb=[];var rt=[];return function(m){if(!m){return}lt[0]=lb[0]=this.x;lt[1]=rt[1]=this.y;rb[0]=rt[0]=this.x+this.width;rb[1]=lb[1]=this.y+this.height;v2ApplyTransform(lt,lt,m);v2ApplyTransform(rb,rb,m);v2ApplyTransform(lb,lb,m);v2ApplyTransform(rt,rt,m);this.x=mathMin(lt[0],rb[0],lb[0],rt[0]);this.y=mathMin(lt[1],rb[1],lb[1],rt[1]);var maxX=mathMax(lt[0],rb[0],lb[0],rt[0]);var maxY=mathMax(lt[1],rb[1],lb[1],rt[1]);this.width=maxX-this.x;this.height=maxY-this.y}}(),calculateTransform:function(b){var a=this;var sx=b.width/a.width;var sy=b.height/a.height;var m=create$1();translate(m,m,[-a.x,-a.y]);scale$1(m,m,[sx,sy]);translate(m,m,[b.x,b.y]);return m},intersect:function(b){if(!b){return false}if(!(b instanceof BoundingRect)){b=BoundingRect.create(b)}var a=this;var ax0=a.x;var ax1=a.x+a.width;var ay0=a.y;var ay1=a.y+a.height;var bx0=b.x;var bx1=b.x+b.width;var by0=b.y;var by1=b.y+b.height;return!(ax1<bx0||bx1<ax0||ay1<by0||by1<ay0)},contain:function(x,y){var rect=this;return x>=rect.x&&x<=rect.x+rect.width&&y>=rect.y&&y<=rect.y+rect.height},clone:function(){return new BoundingRect(this.x,this.y,this.width,this.height)},copy:function(other){this.x=other.x;this.y=other.y;this.width=other.width;this.height=other.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}};BoundingRect.create=function(rect){return new BoundingRect(rect.x,rect.y,rect.width,rect.height)};var Group=function(opts){opts=opts||{};Element.call(this,opts);for(var key in opts){if(opts.hasOwnProperty(key)){this[key]=opts[key]}}this._children=[];this.__storage=null;this.__dirty=true};Group.prototype={constructor:Group,isGroup:true,type:"group",silent:false,children:function(){return this._children.slice()},childAt:function(idx){return this._children[idx]},childOfName:function(name){var children=this._children;for(var i=0;i<children.length;i++){if(children[i].name===name){return children[i]}}},childCount:function(){return this._children.length},add:function(child){if(child&&child!==this&&child.parent!==this){this._children.push(child);this._doAdd(child)}return this},addBefore:function(child,nextSibling){if(child&&child!==this&&child.parent!==this&&nextSibling&&nextSibling.parent===this){var children=this._children;var idx=children.indexOf(nextSibling);if(0<=idx){children.splice(idx,0,child);this._doAdd(child)}}return this},_doAdd:function(child){if(child.parent){child.parent.remove(child)}child.parent=this;var storage=this.__storage;var zr=this.__zr;if(storage&&storage!==child.__storage){storage.addToStorage(child);if(child instanceof Group){child.addChildrenToStorage(storage)}}zr&&zr.refresh()},remove:function(child){var zr=this.__zr;var storage=this.__storage;var children=this._children;var idx=indexOf(children,child);if(0>idx){return this}children.splice(idx,1);child.parent=null;if(storage){storage.delFromStorage(child);if(child instanceof Group){child.delChildrenFromStorage(storage)}}zr&&zr.refresh();return this},removeAll:function(){var children=this._children;var storage=this.__storage;var child;var i;for(i=0;i<children.length;i++){child=children[i];if(storage){storage.delFromStorage(child);if(child instanceof Group){child.delChildrenFromStorage(storage)}}child.parent=null}children.length=0;return this},eachChild:function(cb,context){var children=this._children;for(var i=0;i<children.length;i++){var child=children[i];cb.call(context,child,i)}return this},traverse:function(cb,context){for(var i=0;i<this._children.length;i++){var child=this._children[i];cb.call(context,child);if("group"===child.type){child.traverse(cb,context)}}return this},addChildrenToStorage:function(storage){for(var i=0;i<this._children.length;i++){var child=this._children[i];storage.addToStorage(child);if(child instanceof Group){child.addChildrenToStorage(storage)}}},delChildrenFromStorage:function(storage){for(var i=0;i<this._children.length;i++){var child=this._children[i];storage.delFromStorage(child);if(child instanceof Group){child.delChildrenFromStorage(storage)}}},dirty:function(){this.__dirty=true;this.__zr&&this.__zr.refresh();return this},getBoundingRect:function(includeChildren){var rect=null;var tmpRect=new BoundingRect(0,0,0,0);var children=includeChildren||this._children;var tmpMat=[];for(var i=0;i<children.length;i++){var child=children[i];if(child.ignore||child.invisible){continue}var childRect=child.getBoundingRect();var transform=child.getLocalTransform(tmpMat);if(transform){tmpRect.copy(childRect);tmpRect.applyTransform(transform);rect=rect||tmpRect.clone();rect.union(tmpRect)}else{rect=rect||childRect.clone();rect.union(childRect)}}return rect||tmpRect}};inherits(Group,Element);var DEFAULT_MIN_MERGE=32;var DEFAULT_MIN_GALLOPING=7;function minRunLength(n){var r=0;while(n>=DEFAULT_MIN_MERGE){r|=1&n;n>>=1}return n+r}function makeAscendingRun(array,lo,hi,compare){var runHi=lo+1;if(runHi===hi){return 1}if(0>compare(array[runHi++],array[lo])){while(runHi<hi&&0>compare(array[runHi],array[runHi-1])){runHi++}reverseRun(array,lo,runHi)}else{while(runHi<hi&&0<=compare(array[runHi],array[runHi-1])){runHi++}}return runHi-lo}function reverseRun(array,lo,hi){hi--;while(lo<hi){var t=array[lo];array[lo++]=array[hi];array[hi--]=t}}function binaryInsertionSort(array,lo,hi,start,compare){if(start===lo){start++}for(;start<hi;start++){var pivot=array[start];var left=lo;var right=start;var mid;while(left<right){mid=left+right>>>1;if(0>compare(pivot,array[mid])){right=mid}else{left=mid+1}}var n=start-left;switch(n){case 3:array[left+3]=array[left+2];case 2:array[left+2]=array[left+1];case 1:array[left+1]=array[left];break;default:while(0<n){array[left+n]=array[left+n-1];n--}}array[left]=pivot}}function gallopLeft(value,array,start,length,hint,compare){var lastOffset=0;var maxOffset=0;var offset=1;if(0<compare(value,array[start+hint])){maxOffset=length-hint;while(offset<maxOffset&&0<compare(value,array[start+hint+offset])){lastOffset=offset;offset=(offset<<1)+1;if(0>=offset){offset=maxOffset}}if(offset>maxOffset){offset=maxOffset}lastOffset+=hint;offset+=hint}else{maxOffset=hint+1;while(offset<maxOffset&&0>=compare(value,array[start+hint-offset])){lastOffset=offset;offset=(offset<<1)+1;if(0>=offset){offset=maxOffset}}if(offset>maxOffset){offset=maxOffset}var tmp=lastOffset;lastOffset=hint-offset;offset=hint-tmp}lastOffset++;while(lastOffset<offset){var m=lastOffset+(offset-lastOffset>>>1);if(0<compare(value,array[start+m])){lastOffset=m+1}else{offset=m}}return offset}function gallopRight(value,array,start,length,hint,compare){var lastOffset=0;var maxOffset=0;var offset=1;if(0>compare(value,array[start+hint])){maxOffset=hint+1;while(offset<maxOffset&&0>compare(value,array[start+hint-offset])){lastOffset=offset;offset=(offset<<1)+1;if(0>=offset){offset=maxOffset}}if(offset>maxOffset){offset=maxOffset}var tmp=lastOffset;lastOffset=hint-offset;offset=hint-tmp}else{maxOffset=length-hint;while(offset<maxOffset&&0<=compare(value,array[start+hint+offset])){lastOffset=offset;offset=(offset<<1)+1;if(0>=offset){offset=maxOffset}}if(offset>maxOffset){offset=maxOffset}lastOffset+=hint;offset+=hint}lastOffset++;while(lastOffset<offset){var m=lastOffset+(offset-lastOffset>>>1);if(0>compare(value,array[start+m])){offset=m}else{lastOffset=m+1}}return offset}function TimSort(array,compare){var minGallop=DEFAULT_MIN_GALLOPING;var runStart;var runLength;var stackSize=0;var tmp=[];runStart=[];runLength=[];function pushRun(_runStart,_runLength){runStart[stackSize]=_runStart;runLength[stackSize]=_runLength;stackSize+=1}function mergeRuns(){while(1<stackSize){var n=stackSize-2;if(1<=n&&runLength[n-1]<=runLength[n]+runLength[n+1]||2<=n&&runLength[n-2]<=runLength[n]+runLength[n-1]){if(runLength[n-1]<runLength[n+1]){n--}}else if(runLength[n]>runLength[n+1]){break}mergeAt(n)}}function forceMergeRuns(){while(1<stackSize){var n=stackSize-2;if(0<n&&runLength[n-1]<runLength[n+1]){n--}mergeAt(n)}}function mergeAt(i){var start1=runStart[i];var length1=runLength[i];var start2=runStart[i+1];var length2=runLength[i+1];runLength[i]=length1+length2;if(i===stackSize-3){runStart[i+1]=runStart[i+2];runLength[i+1]=runLength[i+2]}stackSize--;var k=gallopRight(array[start2],array,start1,length1,0,compare);start1+=k;length1-=k;if(0===length1){return}length2=gallopLeft(array[start1+length1-1],array,start2,length2,length2-1,compare);if(0===length2){return}if(length1<=length2){mergeLow(start1,length1,start2,length2)}else{mergeHigh(start1,length1,start2,length2)}}function mergeLow(start1,length1,start2,length2){var i=0;for(i=0;i<length1;i++){tmp[i]=array[start1+i]}var cursor1=0;var cursor2=start2;var dest=start1;array[dest++]=array[cursor2++];if(0===--length2){for(i=0;i<length1;i++){array[dest+i]=tmp[cursor1+i]}return}if(1===length1){for(i=0;i<length2;i++){array[dest+i]=array[cursor2+i]}array[dest+length2]=tmp[cursor1];return}var _minGallop=minGallop;var count1,count2,exit;while(1){count1=0;count2=0;exit=false;do{if(0>compare(array[cursor2],tmp[cursor1])){array[dest++]=array[cursor2++];count2++;count1=0;if(0===--length2){exit=true;break}}else{array[dest++]=tmp[cursor1++];count1++;count2=0;if(1===--length1){exit=true;break}}}while((count1|count2)<_minGallop);if(exit){break}do{count1=gallopRight(array[cursor2],tmp,cursor1,length1,0,compare);if(0!==count1){for(i=0;i<count1;i++){array[dest+i]=tmp[cursor1+i]}dest+=count1;cursor1+=count1;length1-=count1;if(1>=length1){exit=true;break}}array[dest++]=array[cursor2++];if(0===--length2){exit=true;break}count2=gallopLeft(tmp[cursor1],array,cursor2,length2,0,compare);if(0!==count2){for(i=0;i<count2;i++){array[dest+i]=array[cursor2+i]}dest+=count2;cursor2+=count2;length2-=count2;if(0===length2){exit=true;break}}array[dest++]=tmp[cursor1++];if(1===--length1){exit=true;break}_minGallop--}while(count1>=DEFAULT_MIN_GALLOPING||count2>=DEFAULT_MIN_GALLOPING);if(exit){break}if(0>_minGallop){_minGallop=0}_minGallop+=2}minGallop=_minGallop;1>minGallop&&(minGallop=1);if(1===length1){for(i=0;i<length2;i++){array[dest+i]=array[cursor2+i]}array[dest+length2]=tmp[cursor1]}else if(0===length1){throw new Error}else{for(i=0;i<length1;i++){array[dest+i]=tmp[cursor1+i]}}}function mergeHigh(start1,length1,start2,length2){var i=0;for(i=0;i<length2;i++){tmp[i]=array[start2+i]}var cursor1=start1+length1-1;var cursor2=length2-1;var dest=start2+length2-1;var customCursor=0;var customDest=0;array[dest--]=array[cursor1--];if(0===--length1){customCursor=dest-(length2-1);for(i=0;i<length2;i++){array[customCursor+i]=tmp[i]}return}if(1===length2){dest-=length1;cursor1-=length1;customDest=dest+1;customCursor=cursor1+1;for(i=length1-1;0<=i;i--){array[customDest+i]=array[customCursor+i]}array[dest]=tmp[cursor2];return}var _minGallop=minGallop;while(true){var count1=0;var count2=0;var exit=false;do{if(0>compare(tmp[cursor2],array[cursor1])){array[dest--]=array[cursor1--];count1++;count2=0;if(0===--length1){exit=true;break}}else{array[dest--]=tmp[cursor2--];count2++;count1=0;if(1===--length2){exit=true;break}}}while((count1|count2)<_minGallop);if(exit){break}do{count1=length1-gallopRight(tmp[cursor2],array,start1,length1,length1-1,compare);if(0!==count1){dest-=count1;cursor1-=count1;length1-=count1;customDest=dest+1;customCursor=cursor1+1;for(i=count1-1;0<=i;i--){array[customDest+i]=array[customCursor+i]}if(0===length1){exit=true;break}}array[dest--]=tmp[cursor2--];if(1===--length2){exit=true;break}count2=length2-gallopLeft(array[cursor1],tmp,0,length2,length2-1,compare);if(0!==count2){dest-=count2;cursor2-=count2;length2-=count2;customDest=dest+1;customCursor=cursor2+1;for(i=0;i<count2;i++){array[customDest+i]=tmp[customCursor+i]}if(1>=length2){exit=true;break}}array[dest--]=array[cursor1--];if(0===--length1){exit=true;break}_minGallop--}while(count1>=DEFAULT_MIN_GALLOPING||count2>=DEFAULT_MIN_GALLOPING);if(exit){break}if(0>_minGallop){_minGallop=0}_minGallop+=2}minGallop=_minGallop;if(1>minGallop){minGallop=1}if(1===length2){dest-=length1;cursor1-=length1;customDest=dest+1;customCursor=cursor1+1;for(i=length1-1;0<=i;i--){array[customDest+i]=array[customCursor+i]}array[dest]=tmp[cursor2]}else if(0===length2){throw new Error}else{customCursor=dest-(length2-1);for(i=0;i<length2;i++){array[customCursor+i]=tmp[i]}}}this.mergeRuns=mergeRuns;this.forceMergeRuns=forceMergeRuns;this.pushRun=pushRun}function sort(array,compare,lo,hi){if(!lo){lo=0}if(!hi){hi=array.length}var remaining=hi-lo;if(2>remaining){return}var runLength=0;if(remaining<DEFAULT_MIN_MERGE){runLength=makeAscendingRun(array,lo,hi,compare);binaryInsertionSort(array,lo,hi,lo+runLength,compare);return}var ts=new TimSort(array,compare);var minRun=minRunLength(remaining);do{runLength=makeAscendingRun(array,lo,hi,compare);if(runLength<minRun){var force=remaining;if(force>minRun){force=minRun}binaryInsertionSort(array,lo,lo+force,lo+runLength,compare);runLength=force}ts.pushRun(lo,runLength);ts.mergeRuns();remaining-=runLength;lo+=runLength}while(0!==remaining);ts.forceMergeRuns()}function shapeCompareFunc(a,b){if(a.zlevel===b.zlevel){if(a.z===b.z){return a.z2-b.z2}return a.z-b.z}return a.zlevel-b.zlevel}var Storage=function(){this._roots=[];this._displayList=[];this._displayListLen=0};Storage.prototype={constructor:Storage,traverse:function(cb,context){for(var i=0;i<this._roots.length;i++){this._roots[i].traverse(cb,context)}},getDisplayList:function(update,includeIgnore){includeIgnore=includeIgnore||false;if(update){this.updateDisplayList(includeIgnore)}return this._displayList},updateDisplayList:function(includeIgnore){this._displayListLen=0;var roots=this._roots;var displayList=this._displayList;for(var i=0,len=roots.length;i<len;i++){this._updateAndAddDisplayable(roots[i],null,includeIgnore)}displayList.length=this._displayListLen;env$1.canvasSupported&&sort(displayList,shapeCompareFunc)},_updateAndAddDisplayable:function(el,clipPaths,includeIgnore){if(el.ignore&&!includeIgnore){return}el.beforeUpdate();if(el.__dirty){el.update()}el.afterUpdate();var userSetClipPath=el.clipPath;if(userSetClipPath){if(clipPaths){clipPaths=clipPaths.slice()}else{clipPaths=[]}var currentClipPath=userSetClipPath;var parentClipPath=el;while(currentClipPath){currentClipPath.parent=parentClipPath;currentClipPath.updateTransform();clipPaths.push(currentClipPath);parentClipPath=currentClipPath;currentClipPath=currentClipPath.clipPath}}if(el.isGroup){var children=el._children;for(var i=0;i<children.length;i++){var child=children[i];if(el.__dirty){child.__dirty=true}this._updateAndAddDisplayable(child,clipPaths,includeIgnore)}el.__dirty=false}else{el.__clipPaths=clipPaths;this._displayList[this._displayListLen++]=el}},addRoot:function(el){if(el.__storage===this){return}if(el instanceof Group){el.addChildrenToStorage(this)}this.addToStorage(el);this._roots.push(el)},delRoot:function(el){if(null==el){for(var i=0;i<this._roots.length;i++){var root=this._roots[i];if(root instanceof Group){root.delChildrenFromStorage(this)}}this._roots=[];this._displayList=[];this._displayListLen=0;return}if(el instanceof Array){for(var i=0,l=el.length;i<l;i++){this.delRoot(el[i])}return}var idx=indexOf(this._roots,el);if(0<=idx){this.delFromStorage(el);this._roots.splice(idx,1);if(el instanceof Group){el.delChildrenFromStorage(this)}}},addToStorage:function(el){if(el){el.__storage=this;el.dirty(false)}return this},delFromStorage:function(el){if(el){el.__storage=null}return this},dispose:function(){this._renderList=this._roots=null},displayableSortFunc:shapeCompareFunc};var SHADOW_PROPS={shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1,textShadowBlur:1,textShadowOffsetX:1,textShadowOffsetY:1,textBoxShadowBlur:1,textBoxShadowOffsetX:1,textBoxShadowOffsetY:1};var fixShadow=function(ctx,propName,value){if(SHADOW_PROPS.hasOwnProperty(propName)){return value*=ctx.dpr}return value};var STYLE_COMMON_PROPS=[["shadowBlur",0],["shadowOffsetX",0],["shadowOffsetY",0],["shadowColor","#000"],["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];var Style=function(opts,host){this.extendFrom(opts,false);this.host=host};function createLinearGradient(ctx,obj,rect){var x=null==obj.x?0:obj.x;var x2=null==obj.x2?1:obj.x2;var y=null==obj.y?0:obj.y;var y2=null==obj.y2?0:obj.y2;if(!obj.global){x=x*rect.width+rect.x;x2=x2*rect.width+rect.x;y=y*rect.height+rect.y;y2=y2*rect.height+rect.y}x=isNaN(x)?0:x;x2=isNaN(x2)?1:x2;y=isNaN(y)?0:y;y2=isNaN(y2)?0:y2;var canvasGradient=ctx.createLinearGradient(x,y,x2,y2);return canvasGradient}function createRadialGradient(ctx,obj,rect){var width=rect.width;var height=rect.height;var min=Math.min(width,height);var x=null==obj.x?0.5:obj.x;var y=null==obj.y?0.5:obj.y;var r=null==obj.r?0.5:obj.r;if(!obj.global){x=x*width+rect.x;y=y*height+rect.y;r=r*min}var canvasGradient=ctx.createRadialGradient(x,y,0,x,y,r);return canvasGradient}Style.prototype={constructor:Style,host:null,fill:"#000",stroke:null,opacity:1,lineDash:null,lineDashOffset:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineWidth:1,strokeNoScale:false,text:null,font:null,textFont:null,fontStyle:null,fontWeight:null,fontSize:null,fontFamily:null,textTag:null,textFill:"#000",textStroke:null,textWidth:null,textHeight:null,textStrokeWidth:0,textLineHeight:null,textPosition:"inside",textRect:null,textOffset:null,textAlign:null,textVerticalAlign:null,textDistance:5,textShadowColor:"transparent",textShadowBlur:0,textShadowOffsetX:0,textShadowOffsetY:0,textBoxShadowColor:"transparent",textBoxShadowBlur:0,textBoxShadowOffsetX:0,textBoxShadowOffsetY:0,transformText:false,textRotation:0,textOrigin:null,textBackgroundColor:null,textBorderColor:null,textBorderWidth:0,textBorderRadius:0,textPadding:null,rich:null,truncate:null,blend:null,bind:function(ctx,el,prevEl){var style=this;var prevStyle=prevEl&&prevEl.style;var firstDraw=!prevStyle;for(var i=0;i<STYLE_COMMON_PROPS.length;i++){var prop=STYLE_COMMON_PROPS[i];var styleName=prop[0];if(firstDraw||style[styleName]!==prevStyle[styleName]){ctx[styleName]=fixShadow(ctx,styleName,style[styleName]||prop[1])}}if(firstDraw||style.fill!==prevStyle.fill){ctx.fillStyle=style.fill}if(firstDraw||style.stroke!==prevStyle.stroke){ctx.strokeStyle=style.stroke}if(firstDraw||style.opacity!==prevStyle.opacity){ctx.globalAlpha=null==style.opacity?1:style.opacity}if(firstDraw||style.blend!==prevStyle.blend){ctx.globalCompositeOperation=style.blend||"source-over"}if(this.hasStroke()){var lineWidth=style.lineWidth;ctx.lineWidth=lineWidth/(this.strokeNoScale&&el&&el.getLineScale?el.getLineScale():1)}},hasFill:function(){var fill=this.fill;return null!=fill&&"none"!==fill},hasStroke:function(){var stroke=this.stroke;return null!=stroke&&"none"!==stroke&&0<this.lineWidth},extendFrom:function(otherStyle,overwrite){if(otherStyle){for(var name in otherStyle){if(otherStyle.hasOwnProperty(name)&&(true===overwrite||(false===overwrite?!this.hasOwnProperty(name):null!=otherStyle[name]))){this[name]=otherStyle[name]}}}},set:function(obj,value){if("string"===typeof obj){this[obj]=value}else{this.extendFrom(obj,true)}},clone:function(){var newStyle=new this.constructor;newStyle.extendFrom(this,true);return newStyle},getGradient:function(ctx,obj,rect){var method="radial"===obj.type?createRadialGradient:createLinearGradient;var canvasGradient=method(ctx,obj,rect);var colorStops=obj.colorStops;for(var i=0;i<colorStops.length;i++){canvasGradient.addColorStop(colorStops[i].offset,colorStops[i].color)}return canvasGradient}};var styleProto=Style.prototype;for(var i=0;i<STYLE_COMMON_PROPS.length;i++){var prop=STYLE_COMMON_PROPS[i];if(!(prop[0]in styleProto)){styleProto[prop[0]]=prop[1]}}Style.getGradient=styleProto.getGradient;var Pattern=function(image,repeat){this.image=image;this.repeat=repeat;this.type="pattern"};Pattern.prototype.getCanvasPattern=function(ctx){return ctx.createPattern(this.image,this.repeat||"repeat")};function returnFalse(){return false}function createDom(id,painter,dpr){var newDom=createCanvas();var width=painter.getWidth();var height=painter.getHeight();var newDomStyle=newDom.style;if(newDomStyle){newDomStyle.position="absolute";newDomStyle.left=0;newDomStyle.top=0;newDomStyle.width=width+"px";newDomStyle.height=height+"px";newDom.setAttribute("data-zr-dom-id",id)}newDom.width=width*dpr;newDom.height=height*dpr;return newDom}var Layer=function(id,painter,dpr){var dom;dpr=dpr||devicePixelRatio;if("string"===typeof id){dom=createDom(id,painter,dpr)}else if(isObject(id)){dom=id;id=dom.id}this.id=id;this.dom=dom;var domStyle=dom.style;if(domStyle){dom.onselectstart=returnFalse;domStyle["-webkit-user-select"]="none";domStyle["user-select"]="none";domStyle["-webkit-touch-callout"]="none";domStyle["-webkit-tap-highlight-color"]="rgba(0,0,0,0)";domStyle["padding"]=0;domStyle["margin"]=0;domStyle["border-width"]=0}this.domBack=null;this.ctxBack=null;this.painter=painter;this.config=null;this.clearColor=0;this.motionBlur=false;this.lastFrameAlpha=0.7;this.dpr=dpr};Layer.prototype={constructor:Layer,__dirty:true,__used:false,__drawIndex:0,__startIndex:0,__endIndex:0,incremental:false,getElementCount:function(){return this.__endIndex-this.__startIndex},initContext:function(){this.ctx=this.dom.getContext("2d");this.ctx.dpr=this.dpr},createBackBuffer:function(){var dpr=this.dpr;this.domBack=createDom("back-"+this.id,this.painter,dpr);this.ctxBack=this.domBack.getContext("2d");if(1!=dpr){this.ctxBack.scale(dpr,dpr)}},resize:function(width,height){var dpr=this.dpr;var dom=this.dom;var domStyle=dom.style;var domBack=this.domBack;if(domStyle){domStyle.width=width+"px";domStyle.height=height+"px"}dom.width=width*dpr;dom.height=height*dpr;if(domBack){domBack.width=width*dpr;domBack.height=height*dpr;if(1!=dpr){this.ctxBack.scale(dpr,dpr)}}},clear:function(clearAll,clearColor){var dom=this.dom;var ctx=this.ctx;var width=dom.width;var height=dom.height;var clearColor=clearColor||this.clearColor;var haveMotionBLur=this.motionBlur&&!clearAll;var lastFrameAlpha=this.lastFrameAlpha;var dpr=this.dpr;if(haveMotionBLur){if(!this.domBack){this.createBackBuffer()}this.ctxBack.globalCompositeOperation="copy";this.ctxBack.drawImage(dom,0,0,width/dpr,height/dpr)}ctx.clearRect(0,0,width,height);if(clearColor&&"transparent"!==clearColor){var clearColorGradientOrPattern;if(clearColor.colorStops){clearColorGradientOrPattern=clearColor.__canvasGradient||Style.getGradient(ctx,clearColor,{x:0,y:0,width:width,height:height});clearColor.__canvasGradient=clearColorGradientOrPattern}else if(clearColor.image){clearColorGradientOrPattern=Pattern.prototype.getCanvasPattern.call(clearColor,ctx)}ctx.save();ctx.fillStyle=clearColorGradientOrPattern||clearColor;ctx.fillRect(0,0,width,height);ctx.restore()}if(haveMotionBLur){var domBack=this.domBack;ctx.save();ctx.globalAlpha=lastFrameAlpha;ctx.drawImage(domBack,0,0,width,height);ctx.restore()}}};var requestAnimationFrame="undefined"!==typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(func){setTimeout(func,16)};var globalImageCache=new LRU(50);function findExistImage(newImageOrSrc){if("string"===typeof newImageOrSrc){var cachedImgObj=globalImageCache.get(newImageOrSrc);return cachedImgObj&&cachedImgObj.image}else{return newImageOrSrc}}function createOrUpdateImage(newImageOrSrc,image,hostEl,cb,cbPayload){if(!newImageOrSrc){return image}else if("string"===typeof newImageOrSrc){if(image&&image.__zrImageSrc===newImageOrSrc||!hostEl){return image}var cachedImgObj=globalImageCache.get(newImageOrSrc);var pendingWrap={hostEl:hostEl,cb:cb,cbPayload:cbPayload};if(cachedImgObj){image=cachedImgObj.image;!isImageReady(image)&&cachedImgObj.pending.push(pendingWrap)}else{!image&&(image=new Image);image.onload=imageOnLoad;globalImageCache.put(newImageOrSrc,image.__cachedImgObj={image:image,pending:[pendingWrap]});image.src=image.__zrImageSrc=newImageOrSrc}return image}else{return newImageOrSrc}}function imageOnLoad(){var cachedImgObj=this.__cachedImgObj;this.onload=this.__cachedImgObj=null;for(var i=0;i<cachedImgObj.pending.length;i++){var pendingWrap=cachedImgObj.pending[i];var cb=pendingWrap.cb;cb&&cb(this,pendingWrap.cbPayload);pendingWrap.hostEl.dirty()}cachedImgObj.pending.length=0}function isImageReady(image){return image&&image.width&&image.height}var textWidthCache={};var textWidthCacheCounter=0;var TEXT_CACHE_MAX=5000;var STYLE_REG=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;var DEFAULT_FONT="12px sans-serif";var methods$1={};function $override$1(name,fn){methods$1[name]=fn}function getWidth(text,font){font=font||DEFAULT_FONT;var key=text+":"+font;if(textWidthCache[key]){return textWidthCache[key]}var textLines=(text+"").split("\n");var width=0;for(var i=0,l=textLines.length;i<l;i++){width=Math.max(measureText(textLines[i],font).width,width)}if(textWidthCacheCounter>TEXT_CACHE_MAX){textWidthCacheCounter=0;textWidthCache={}}textWidthCacheCounter++;textWidthCache[key]=width;return width}function getBoundingRect(text,font,textAlign,textVerticalAlign,textPadding,rich,truncate){return rich?getRichTextRect(text,font,textAlign,textVerticalAlign,textPadding,rich,truncate):getPlainTextRect(text,font,textAlign,textVerticalAlign,textPadding,truncate)}function getPlainTextRect(text,font,textAlign,textVerticalAlign,textPadding,truncate){var contentBlock=parsePlainText(text,font,textPadding,truncate);var outerWidth=getWidth(text,font);if(textPadding){outerWidth+=textPadding[1]+textPadding[3]}var outerHeight=contentBlock.outerHeight;var x=adjustTextX(0,outerWidth,textAlign);var y=adjustTextY(0,outerHeight,textVerticalAlign);var rect=new BoundingRect(x,y,outerWidth,outerHeight);rect.lineHeight=contentBlock.lineHeight;return rect}function getRichTextRect(text,font,textAlign,textVerticalAlign,textPadding,rich,truncate){var contentBlock=parseRichText(text,{rich:rich,truncate:truncate,font:font,textAlign:textAlign,textPadding:textPadding});var outerWidth=contentBlock.outerWidth;var outerHeight=contentBlock.outerHeight;var x=adjustTextX(0,outerWidth,textAlign);var y=adjustTextY(0,outerHeight,textVerticalAlign);return new BoundingRect(x,y,outerWidth,outerHeight)}function adjustTextX(x,width,textAlign){if("right"===textAlign){x-=width}else if("center"===textAlign){x-=width/2}return x}function adjustTextY(y,height,textVerticalAlign){if("middle"===textVerticalAlign){y-=height/2}else if("bottom"===textVerticalAlign){y-=height}return y}function adjustTextPositionOnRect(textPosition,rect,distance){var x=rect.x;var y=rect.y;var height=rect.height;var width=rect.width;var halfHeight=height/2;var textAlign="left";var textVerticalAlign="top";switch(textPosition){case"left":x-=distance;y+=halfHeight;textAlign="right";textVerticalAlign="middle";break;case"right":x+=distance+width;y+=halfHeight;textVerticalAlign="middle";break;case"top":x+=width/2;y-=distance;textAlign="center";textVerticalAlign="bottom";break;case"bottom":x+=width/2;y+=height+distance;textAlign="center";break;case"inside":x+=width/2;y+=halfHeight;textAlign="center";textVerticalAlign="middle";break;case"insideLeft":x+=distance;y+=halfHeight;textVerticalAlign="middle";break;case"insideRight":x+=width-distance;y+=halfHeight;textAlign="right";textVerticalAlign="middle";break;case"insideTop":x+=width/2;y+=distance;textAlign="center";break;case"insideBottom":x+=width/2;y+=height-distance;textAlign="center";textVerticalAlign="bottom";break;case"insideTopLeft":x+=distance;y+=distance;break;case"insideTopRight":x+=width-distance;y+=distance;textAlign="right";break;case"insideBottomLeft":x+=distance;y+=height-distance;textVerticalAlign="bottom";break;case"insideBottomRight":x+=width-distance;y+=height-distance;textAlign="right";textVerticalAlign="bottom";break;}return{x:x,y:y,textAlign:textAlign,textVerticalAlign:textVerticalAlign}}function truncateText(text,containerWidth,font,ellipsis,options){if(!containerWidth){return""}var textLines=(text+"").split("\n");options=prepareTruncateOptions(containerWidth,font,ellipsis,options);for(var i=0,len=textLines.length;i<len;i++){textLines[i]=truncateSingleLine(textLines[i],options)}return textLines.join("\n")}function prepareTruncateOptions(containerWidth,font,ellipsis,options){options=extend({},options);options.font=font;var ellipsis=retrieve2(ellipsis,"...");options.maxIterations=retrieve2(options.maxIterations,2);var minChar=options.minChar=retrieve2(options.minChar,0);options.cnCharWidth=getWidth("\u56FD",font);var ascCharWidth=options.ascCharWidth=getWidth("a",font);options.placeholder=retrieve2(options.placeholder,"");var contentWidth=containerWidth=Math.max(0,containerWidth-1);for(var i=0;i<minChar&&contentWidth>=ascCharWidth;i++){contentWidth-=ascCharWidth}var ellipsisWidth=getWidth(ellipsis);if(ellipsisWidth>contentWidth){ellipsis="";ellipsisWidth=0}contentWidth=containerWidth-ellipsisWidth;options.ellipsis=ellipsis;options.ellipsisWidth=ellipsisWidth;options.contentWidth=contentWidth;options.containerWidth=containerWidth;return options}function truncateSingleLine(textLine,options){var containerWidth=options.containerWidth;var font=options.font;var contentWidth=options.contentWidth;if(!containerWidth){return""}var lineWidth=getWidth(textLine,font);if(lineWidth<=containerWidth){return textLine}for(var j=0;;j++){if(lineWidth<=contentWidth||j>=options.maxIterations){textLine+=options.ellipsis;break}var subLength=0===j?estimateLength(textLine,contentWidth,options.ascCharWidth,options.cnCharWidth):0<lineWidth?Math.floor(textLine.length*contentWidth/lineWidth):0;textLine=textLine.substr(0,subLength);lineWidth=getWidth(textLine,font)}if(""===textLine){textLine=options.placeholder}return textLine}function estimateLength(text,contentWidth,ascCharWidth,cnCharWidth){var width=0;var i=0;for(var len=text.length;i<len&&width<contentWidth;i++){var charCode=text.charCodeAt(i);width+=0<=charCode&&127>=charCode?ascCharWidth:cnCharWidth}return i}function getLineHeight(font){return getWidth("\u56FD",font)}function measureText(text,font){return methods$1.measureText(text,font)}methods$1.measureText=function(text,font){var ctx=getContext();ctx.font=font||DEFAULT_FONT;return ctx.measureText(text)};function parsePlainText(text,font,padding,truncate){null!=text&&(text+="");var lineHeight=getLineHeight(font);var lines=text?text.split("\n"):[];var height=lines.length*lineHeight;var outerHeight=height;if(padding){outerHeight+=padding[0]+padding[2]}if(text&&truncate){var truncOuterHeight=truncate.outerHeight;var truncOuterWidth=truncate.outerWidth;if(null!=truncOuterHeight&&outerHeight>truncOuterHeight){text="";lines=[]}else if(null!=truncOuterWidth){var options=prepareTruncateOptions(truncOuterWidth-(padding?padding[1]+padding[3]:0),font,truncate.ellipsis,{minChar:truncate.minChar,placeholder:truncate.placeholder});for(var i=0,len=lines.length;i<len;i++){lines[i]=truncateSingleLine(lines[i],options)}}}return{lines:lines,height:height,outerHeight:outerHeight,lineHeight:lineHeight}}function parseRichText(text,style){var contentBlock={lines:[],width:0,height:0};null!=text&&(text+="");if(!text){return contentBlock}var lastIndex=STYLE_REG.lastIndex=0;var result;while(null!=(result=STYLE_REG.exec(text))){var matchedIndex=result.index;if(matchedIndex>lastIndex){pushTokens(contentBlock,text.substring(lastIndex,matchedIndex))}pushTokens(contentBlock,result[2],result[1]);lastIndex=STYLE_REG.lastIndex}if(lastIndex<text.length){pushTokens(contentBlock,text.substring(lastIndex,text.length))}var lines=contentBlock.lines;var contentHeight=0;var contentWidth=0;var pendingList=[];var stlPadding=style.textPadding;var truncate=style.truncate;var truncateWidth=truncate&&truncate.outerWidth;var truncateHeight=truncate&&truncate.outerHeight;if(stlPadding){null!=truncateWidth&&(truncateWidth-=stlPadding[1]+stlPadding[3]);null!=truncateHeight&&(truncateHeight-=stlPadding[0]+stlPadding[2])}for(var i=0;i<lines.length;i++){var line=lines[i];var lineHeight=0;var lineWidth=0;for(var j=0;j<line.tokens.length;j++){var token=line.tokens[j];var tokenStyle=token.styleName&&style.rich[token.styleName]||{};var textPadding=token.textPadding=tokenStyle.textPadding;var font=token.font=tokenStyle.font||style.font;var tokenHeight=token.textHeight=retrieve2(tokenStyle.textHeight,getLineHeight(font));textPadding&&(tokenHeight+=textPadding[0]+textPadding[2]);token.height=tokenHeight;token.lineHeight=retrieve3(tokenStyle.textLineHeight,style.textLineHeight,tokenHeight);token.textAlign=tokenStyle&&tokenStyle.textAlign||style.textAlign;token.textVerticalAlign=tokenStyle&&tokenStyle.textVerticalAlign||"middle";if(null!=truncateHeight&&contentHeight+token.lineHeight>truncateHeight){return{lines:[],width:0,height:0}}token.textWidth=getWidth(token.text,font);var tokenWidth=tokenStyle.textWidth;var tokenWidthNotSpecified=null==tokenWidth||"auto"===tokenWidth;if("string"===typeof tokenWidth&&"%"===tokenWidth.charAt(tokenWidth.length-1)){token.percentWidth=tokenWidth;pendingList.push(token);tokenWidth=0}else{if(tokenWidthNotSpecified){tokenWidth=token.textWidth;var textBackgroundColor=tokenStyle.textBackgroundColor;var bgImg=textBackgroundColor&&textBackgroundColor.image;if(bgImg){bgImg=findExistImage(bgImg);if(isImageReady(bgImg)){tokenWidth=Math.max(tokenWidth,bgImg.width*tokenHeight/bgImg.height)}}}var paddingW=textPadding?textPadding[1]+textPadding[3]:0;tokenWidth+=paddingW;var remianTruncWidth=null!=truncateWidth?truncateWidth-lineWidth:null;if(null!=remianTruncWidth&&remianTruncWidth<tokenWidth){if(!tokenWidthNotSpecified||remianTruncWidth<paddingW){token.text="";token.textWidth=tokenWidth=0}else{token.text=truncateText(token.text,remianTruncWidth-paddingW,font,truncate.ellipsis,{minChar:truncate.minChar});token.textWidth=getWidth(token.text,font);tokenWidth=token.textWidth+paddingW}}}lineWidth+=token.width=tokenWidth;tokenStyle&&(lineHeight=Math.max(lineHeight,token.lineHeight))}line.width=lineWidth;line.lineHeight=lineHeight;contentHeight+=lineHeight;contentWidth=Math.max(contentWidth,lineWidth)}contentBlock.outerWidth=contentBlock.width=retrieve2(style.textWidth,contentWidth);contentBlock.outerHeight=contentBlock.height=retrieve2(style.textHeight,contentHeight);if(stlPadding){contentBlock.outerWidth+=stlPadding[1]+stlPadding[3];contentBlock.outerHeight+=stlPadding[0]+stlPadding[2]}for(var i=0;i<pendingList.length;i++){var token=pendingList[i];var percentWidth=token.percentWidth;token.width=parseInt(percentWidth,10)/100*contentWidth}return contentBlock}function pushTokens(block,str,styleName){var isEmptyStr=""===str;var strs=str.split("\n");var lines=block.lines;for(var i=0;i<strs.length;i++){var text=strs[i];var token={styleName:styleName,text:text,isLineHolder:!text&&!isEmptyStr};if(!i){var tokens=(lines[lines.length-1]||(lines[0]={tokens:[]})).tokens;var tokensLen=tokens.length;1===tokensLen&&tokens[0].isLineHolder?tokens[0]=token:(text||!tokensLen||isEmptyStr)&&tokens.push(token)}else{lines.push({tokens:[token]})}}}function makeFont(style){var font=(style.fontSize||style.fontFamily)&&[style.fontStyle,style.fontWeight,(style.fontSize||12)+"px",style.fontFamily||"sans-serif"].join(" ");return font&&trim(font)||style.textFont||style.font}function buildPath(ctx,shape){var x=shape.x;var y=shape.y;var width=shape.width;var height=shape.height;var r=shape.r;var r1;var r2;var r3;var r4;if(0>width){x=x+width;width=-width}if(0>height){y=y+height;height=-height}if("number"===typeof r){r1=r2=r3=r4=r}else if(r instanceof Array){if(1===r.length){r1=r2=r3=r4=r[0]}else if(2===r.length){r1=r3=r[0];r2=r4=r[1]}else if(3===r.length){r1=r[0];r2=r4=r[1];r3=r[2]}else{r1=r[0];r2=r[1];r3=r[2];r4=r[3]}}else{r1=r2=r3=r4=0}var total;if(r1+r2>width){total=r1+r2;r1*=width/total;r2*=width/total}if(r3+r4>width){total=r3+r4;r3*=width/total;r4*=width/total}if(r2+r3>height){total=r2+r3;r2*=height/total;r3*=height/total}if(r1+r4>height){total=r1+r4;r1*=height/total;r4*=height/total}ctx.moveTo(x+r1,y);ctx.lineTo(x+width-r2,y);0!==r2&&ctx.arc(x+width-r2,y+r2,r2,-Math.PI/2,0);ctx.lineTo(x+width,y+height-r3);0!==r3&&ctx.arc(x+width-r3,y+height-r3,r3,0,Math.PI/2);ctx.lineTo(x+r4,y+height);0!==r4&&ctx.arc(x+r4,y+height-r4,r4,Math.PI/2,Math.PI);ctx.lineTo(x,y+r1);0!==r1&&ctx.arc(x+r1,y+r1,r1,Math.PI,1.5*Math.PI)}var VALID_TEXT_ALIGN={left:1,right:1,center:1};var VALID_TEXT_VERTICAL_ALIGN={top:1,bottom:1,middle:1};function normalizeTextStyle(style){normalizeStyle(style);each(style.rich,normalizeStyle);return style}function normalizeStyle(style){if(style){style.font=makeFont(style);var textAlign=style.textAlign;"middle"===textAlign&&(textAlign="center");style.textAlign=null==textAlign||VALID_TEXT_ALIGN[textAlign]?textAlign:"left";var textVerticalAlign=style.textVerticalAlign||style.textBaseline;"center"===textVerticalAlign&&(textVerticalAlign="middle");style.textVerticalAlign=null==textVerticalAlign||VALID_TEXT_VERTICAL_ALIGN[textVerticalAlign]?textVerticalAlign:"top";var textPadding=style.textPadding;if(textPadding){style.textPadding=normalizeCssArray(style.textPadding)}}}function renderText(hostEl,ctx,text,style,rect){style.rich?renderRichText(hostEl,ctx,text,style,rect):renderPlainText(hostEl,ctx,text,style,rect)}function renderPlainText(hostEl,ctx,text,style,rect){var font=setCtx(ctx,"font",style.font||DEFAULT_FONT);var textPadding=style.textPadding;var contentBlock=hostEl.__textCotentBlock;if(!contentBlock||hostEl.__dirty){contentBlock=hostEl.__textCotentBlock=parsePlainText(text,font,textPadding,style.truncate)}var outerHeight=contentBlock.outerHeight;var textLines=contentBlock.lines;var lineHeight=contentBlock.lineHeight;var boxPos=getBoxPosition(outerHeight,style,rect);var baseX=boxPos.baseX;var baseY=boxPos.baseY;var textAlign=boxPos.textAlign;var textVerticalAlign=boxPos.textVerticalAlign;applyTextRotation(ctx,style,rect,baseX,baseY);var boxY=adjustTextY(baseY,outerHeight,textVerticalAlign);var textX=baseX;var textY=boxY;var needDrawBg=needDrawBackground(style);if(needDrawBg||textPadding){var textWidth=getWidth(text,font);var outerWidth=textWidth;textPadding&&(outerWidth+=textPadding[1]+textPadding[3]);var boxX=adjustTextX(baseX,outerWidth,textAlign);needDrawBg&&drawBackground(hostEl,ctx,style,boxX,boxY,outerWidth,outerHeight);if(textPadding){textX=getTextXForPadding(baseX,textAlign,textPadding);textY+=textPadding[0]}}setCtx(ctx,"textAlign",textAlign||"left");setCtx(ctx,"textBaseline","middle");setCtx(ctx,"shadowBlur",style.textShadowBlur||0);setCtx(ctx,"shadowColor",style.textShadowColor||"transparent");setCtx(ctx,"shadowOffsetX",style.textShadowOffsetX||0);setCtx(ctx,"shadowOffsetY",style.textShadowOffsetY||0);textY+=lineHeight/2;var textStrokeWidth=style.textStrokeWidth;var textStroke=getStroke(style.textStroke,textStrokeWidth);var textFill=getFill(style.textFill);if(textStroke){setCtx(ctx,"lineWidth",textStrokeWidth);setCtx(ctx,"strokeStyle",textStroke)}if(textFill){setCtx(ctx,"fillStyle",textFill)}for(var i=0;i<textLines.length;i++){textStroke&&ctx.strokeText(textLines[i],textX,textY);textFill&&ctx.fillText(textLines[i],textX,textY);textY+=lineHeight}}function renderRichText(hostEl,ctx,text,style,rect){var contentBlock=hostEl.__textCotentBlock;if(!contentBlock||hostEl.__dirty){contentBlock=hostEl.__textCotentBlock=parseRichText(text,style)}drawRichText(hostEl,ctx,contentBlock,style,rect)}function drawRichText(hostEl,ctx,contentBlock,style,rect){var contentWidth=contentBlock.width;var outerWidth=contentBlock.outerWidth;var outerHeight=contentBlock.outerHeight;var textPadding=style.textPadding;var boxPos=getBoxPosition(outerHeight,style,rect);var baseX=boxPos.baseX;var baseY=boxPos.baseY;var textAlign=boxPos.textAlign;var textVerticalAlign=boxPos.textVerticalAlign;applyTextRotation(ctx,style,rect,baseX,baseY);var boxX=adjustTextX(baseX,outerWidth,textAlign);var boxY=adjustTextY(baseY,outerHeight,textVerticalAlign);var xLeft=boxX;var lineTop=boxY;if(textPadding){xLeft+=textPadding[3];lineTop+=textPadding[0]}var xRight=xLeft+contentWidth;needDrawBackground(style)&&drawBackground(hostEl,ctx,style,boxX,boxY,outerWidth,outerHeight);for(var i=0;i<contentBlock.lines.length;i++){var line=contentBlock.lines[i];var tokens=line.tokens;var tokenCount=tokens.length;var lineHeight=line.lineHeight;var usedWidth=line.width;var leftIndex=0;var lineXLeft=xLeft;var lineXRight=xRight;var rightIndex=tokenCount-1;var token;while(leftIndex<tokenCount&&(token=tokens[leftIndex],!token.textAlign||"left"===token.textAlign)){placeToken(hostEl,ctx,token,style,lineHeight,lineTop,lineXLeft,"left");usedWidth-=token.width;lineXLeft+=token.width;leftIndex++}while(0<=rightIndex&&(token=tokens[rightIndex],"right"===token.textAlign)){placeToken(hostEl,ctx,token,style,lineHeight,lineTop,lineXRight,"right");usedWidth-=token.width;lineXRight-=token.width;rightIndex--}lineXLeft+=(contentWidth-(lineXLeft-xLeft)-(xRight-lineXRight)-usedWidth)/2;while(leftIndex<=rightIndex){token=tokens[leftIndex];placeToken(hostEl,ctx,token,style,lineHeight,lineTop,lineXLeft+token.width/2,"center");lineXLeft+=token.width;leftIndex++}lineTop+=lineHeight}}function applyTextRotation(ctx,style,rect,x,y){if(rect&&style.textRotation){var origin=style.textOrigin;if("center"===origin){x=rect.width/2+rect.x;y=rect.height/2+rect.y}else if(origin){x=origin[0]+rect.x;y=origin[1]+rect.y}ctx.translate(x,y);ctx.rotate(-style.textRotation);ctx.translate(-x,-y)}}function placeToken(hostEl,ctx,token,style,lineHeight,lineTop,x,textAlign){var tokenStyle=style.rich[token.styleName]||{};var textVerticalAlign=token.textVerticalAlign;var y=lineTop+lineHeight/2;if("top"===textVerticalAlign){y=lineTop+token.height/2}else if("bottom"===textVerticalAlign){y=lineTop+lineHeight-token.height/2}!token.isLineHolder&&needDrawBackground(tokenStyle)&&drawBackground(hostEl,ctx,tokenStyle,"right"===textAlign?x-token.width:"center"===textAlign?x-token.width/2:x,y-token.height/2,token.width,token.height);var textPadding=token.textPadding;if(textPadding){x=getTextXForPadding(x,textAlign,textPadding);y-=token.height/2-textPadding[2]-token.textHeight/2}setCtx(ctx,"shadowBlur",retrieve3(tokenStyle.textShadowBlur,style.textShadowBlur,0));setCtx(ctx,"shadowColor",tokenStyle.textShadowColor||style.textShadowColor||"transparent");setCtx(ctx,"shadowOffsetX",retrieve3(tokenStyle.textShadowOffsetX,style.textShadowOffsetX,0));setCtx(ctx,"shadowOffsetY",retrieve3(tokenStyle.textShadowOffsetY,style.textShadowOffsetY,0));setCtx(ctx,"textAlign",textAlign);setCtx(ctx,"textBaseline","middle");setCtx(ctx,"font",token.font||DEFAULT_FONT);var textStroke=getStroke(tokenStyle.textStroke||style.textStroke,textStrokeWidth);var textFill=getFill(tokenStyle.textFill||style.textFill);var textStrokeWidth=retrieve2(tokenStyle.textStrokeWidth,style.textStrokeWidth);if(textStroke){setCtx(ctx,"lineWidth",textStrokeWidth);setCtx(ctx,"strokeStyle",textStroke);ctx.strokeText(token.text,x,y)}if(textFill){setCtx(ctx,"fillStyle",textFill);ctx.fillText(token.text,x,y)}}function needDrawBackground(style){return style.textBackgroundColor||style.textBorderWidth&&style.textBorderColor}function drawBackground(hostEl,ctx,style,x,y,width,height){var textBackgroundColor=style.textBackgroundColor;var textBorderWidth=style.textBorderWidth;var textBorderColor=style.textBorderColor;var isPlainBg=isString(textBackgroundColor);setCtx(ctx,"shadowBlur",style.textBoxShadowBlur||0);setCtx(ctx,"shadowColor",style.textBoxShadowColor||"transparent");setCtx(ctx,"shadowOffsetX",style.textBoxShadowOffsetX||0);setCtx(ctx,"shadowOffsetY",style.textBoxShadowOffsetY||0);if(isPlainBg||textBorderWidth&&textBorderColor){ctx.beginPath();var textBorderRadius=style.textBorderRadius;if(!textBorderRadius){ctx.rect(x,y,width,height)}else{buildPath(ctx,{x:x,y:y,width:width,height:height,r:textBorderRadius})}ctx.closePath()}if(isPlainBg){setCtx(ctx,"fillStyle",textBackgroundColor);ctx.fill()}else if(isObject(textBackgroundColor)){var image=textBackgroundColor.image;image=createOrUpdateImage(image,null,hostEl,onBgImageLoaded,textBackgroundColor);if(image&&isImageReady(image)){ctx.drawImage(image,x,y,width,height)}}if(textBorderWidth&&textBorderColor){setCtx(ctx,"lineWidth",textBorderWidth);setCtx(ctx,"strokeStyle",textBorderColor);ctx.stroke()}}function onBgImageLoaded(image,textBackgroundColor){textBackgroundColor.image=image}function getBoxPosition(blockHeiht,style,rect){var baseX=style.x||0;var baseY=style.y||0;var textAlign=style.textAlign;var textVerticalAlign=style.textVerticalAlign;if(rect){var textPosition=style.textPosition;if(textPosition instanceof Array){baseX=rect.x+parsePercent(textPosition[0],rect.width);baseY=rect.y+parsePercent(textPosition[1],rect.height)}else{var res=adjustTextPositionOnRect(textPosition,rect,style.textDistance);baseX=res.x;baseY=res.y;textAlign=textAlign||res.textAlign;textVerticalAlign=textVerticalAlign||res.textVerticalAlign}var textOffset=style.textOffset;if(textOffset){baseX+=textOffset[0];baseY+=textOffset[1]}}return{baseX:baseX,baseY:baseY,textAlign:textAlign,textVerticalAlign:textVerticalAlign}}function setCtx(ctx,prop,value){ctx[prop]=fixShadow(ctx,prop,value);return ctx[prop]}function getStroke(stroke,lineWidth){return null==stroke||0>=lineWidth||"transparent"===stroke||"none"===stroke?null:stroke.image||stroke.colorStops?"#000":stroke}function getFill(fill){return null==fill||"none"===fill?null:fill.image||fill.colorStops?"#000":fill}function parsePercent(value,maxValue){if("string"===typeof value){if(0<=value.lastIndexOf("%")){return parseFloat(value)/100*maxValue}return parseFloat(value)}return value}function getTextXForPadding(x,textAlign,textPadding){return"right"===textAlign?x-textPadding[1]:"center"===textAlign?x+textPadding[3]/2-textPadding[1]/2:x+textPadding[3]}function needDrawText(text,style){return null!=text&&(text||style.textBackgroundColor||style.textBorderWidth&&style.textBorderColor||style.textPadding)}var tmpRect$1=new BoundingRect;var RectText=function(){};RectText.prototype={constructor:RectText,drawRectText:function(ctx,rect){var style=this.style;rect=style.textRect||rect;this.__dirty&&normalizeTextStyle(style,true);var text=style.text;null!=text&&(text+="");if(!needDrawText(text,style)){return}ctx.save();var transform=this.transform;if(!style.transformText){if(transform){tmpRect$1.copy(rect);tmpRect$1.applyTransform(transform);rect=tmpRect$1}}else{this.setTransform(ctx)}renderText(this,ctx,text,style,rect);ctx.restore()}};function Displayable(opts){opts=opts||{};Element.call(this,opts);for(var name in opts){if(opts.hasOwnProperty(name)&&"style"!==name){this[name]=opts[name]}}this.style=new Style(opts.style,this);this._rect=null;this.__clipPaths=[]}Displayable.prototype={constructor:Displayable,type:"displayable",__dirty:true,invisible:false,z:0,z2:0,zlevel:0,draggable:false,dragging:false,silent:false,culling:false,cursor:"inherit",rectHover:false,progressive:false,incremental:false,inplace:false,beforeBrush:function(ctx){},afterBrush:function(ctx){},brush:function(ctx,prevEl){},getBoundingRect:function(){},contain:function(x,y){return this.rectContain(x,y)},traverse:function(cb,context){cb.call(context,this)},rectContain:function(x,y){var coord=this.transformCoordToLocal(x,y);var rect=this.getBoundingRect();return rect.contain(coord[0],coord[1])},dirty:function(){this.__dirty=true;this._rect=null;this.__zr&&this.__zr.refresh()},animateStyle:function(loop){return this.animate("style",loop)},attrKV:function(key,value){if("style"!==key){Element.prototype.attrKV.call(this,key,value)}else{this.style.set(value)}},setStyle:function(key,value){this.style.set(key,value);this.dirty(false);return this},useStyle:function(obj){this.style=new Style(obj,this);this.dirty(false);return this}};inherits(Displayable,Element);mixin(Displayable,RectText);function ZImage(opts){Displayable.call(this,opts)}ZImage.prototype={constructor:ZImage,type:"image",brush:function(ctx,prevEl){var style=this.style;var src=style.image;style.bind(ctx,this,prevEl);var image=this._image=createOrUpdateImage(src,this._image,this,this.onload);if(!image||!isImageReady(image)){return}var x=style.x||0;var y=style.y||0;var width=style.width;var height=style.height;var aspect=image.width/image.height;if(null==width&&null!=height){width=height*aspect}else if(null==height&&null!=width){height=width/aspect}else if(null==width&&null==height){width=image.width;height=image.height}this.setTransform(ctx);if(style.sWidth&&style.sHeight){var sx=style.sx||0;var sy=style.sy||0;ctx.drawImage(image,sx,sy,style.sWidth,style.sHeight,x,y,width,height)}else if(style.sx&&style.sy){var sx=style.sx;var sy=style.sy;var sWidth=width-sx;var sHeight=height-sy;ctx.drawImage(image,sx,sy,sWidth,sHeight,x,y,width,height)}else{ctx.drawImage(image,x,y,width,height)}if(null!=style.text){this.restoreTransform(ctx);this.drawRectText(ctx,this.getBoundingRect())}},getBoundingRect:function(){var style=this.style;if(!this._rect){this._rect=new BoundingRect(style.x||0,style.y||0,style.width||0,style.height||0)}return this._rect}};inherits(ZImage,Displayable);var HOVER_LAYER_ZLEVEL=1e5;var CANVAS_ZLEVEL=314159;var EL_AFTER_INCREMENTAL_INC=0.01;var INCREMENTAL_INC=0.001;function parseInt10(val){return parseInt(val,10)}function isLayerValid(layer){if(!layer){return false}if(layer.__builtin__){return true}if("function"!==typeof layer.resize||"function"!==typeof layer.refresh){return false}return true}var tmpRect=new BoundingRect(0,0,0,0);var viewRect=new BoundingRect(0,0,0,0);function isDisplayableCulled(el,width,height){tmpRect.copy(el.getBoundingRect());if(el.transform){tmpRect.applyTransform(el.transform)}viewRect.width=width;viewRect.height=height;return!tmpRect.intersect(viewRect)}function isClipPathChanged(clipPaths,prevClipPaths){if(clipPaths==prevClipPaths){return false}if(!clipPaths||!prevClipPaths||clipPaths.length!==prevClipPaths.length){return true}for(var i=0;i<clipPaths.length;i++){if(clipPaths[i]!==prevClipPaths[i]){return true}}}function doClip(clipPaths,ctx){for(var i=0;i<clipPaths.length;i++){var clipPath=clipPaths[i];clipPath.setTransform(ctx);ctx.beginPath();clipPath.buildPath(ctx,clipPath.shape);ctx.clip();clipPath.restoreTransform(ctx)}}function createRoot(width,height){var domRoot=document.createElement("div");domRoot.style.cssText=["position:relative","overflow:hidden","width:"+width+"px","height:"+height+"px","padding:0","margin:0","border-width:0"].join(";")+";";return domRoot}var Painter=function(root,storage,opts){this.type="canvas";var singleCanvas=!root.nodeName||"CANVAS"===root.nodeName.toUpperCase();this._opts=opts=extend({},opts||{});this.dpr=opts.devicePixelRatio||devicePixelRatio;this._singleCanvas=singleCanvas;this.root=root;var rootStyle=root.style;if(rootStyle){rootStyle["-webkit-tap-highlight-color"]="transparent";rootStyle["-webkit-user-select"]=rootStyle["user-select"]=rootStyle["-webkit-touch-callout"]="none";root.innerHTML=""}this.storage=storage;var zlevelList=this._zlevelList=[];var layers=this._layers={};this._layerConfig={};this._needsManuallyCompositing=false;if(!singleCanvas){this._width=this._getSize(0);this._height=this._getSize(1);var domRoot=this._domRoot=createRoot(this._width,this._height);root.appendChild(domRoot)}else{var width=root.width;var height=root.height;if(null!=opts.width){width=opts.width}if(null!=opts.height){height=opts.height}this.dpr=opts.devicePixelRatio||1;root.width=width*this.dpr;root.height=height*this.dpr;this._width=width;this._height=height;var mainLayer=new Layer(root,this,this.dpr);mainLayer.__builtin__=true;mainLayer.initContext();layers[CANVAS_ZLEVEL]=mainLayer;zlevelList.push(CANVAS_ZLEVEL);this._domRoot=root}this._hoverlayer=null;this._hoverElements=[]};Painter.prototype={constructor:Painter,getType:function(){return"canvas"},isSingleCanvas:function(){return this._singleCanvas},getViewportRoot:function(){return this._domRoot},getViewportRootOffset:function(){var viewportRoot=this.getViewportRoot();if(viewportRoot){return{offsetLeft:viewportRoot.offsetLeft||0,offsetTop:viewportRoot.offsetTop||0}}},refresh:function(paintAll){var list=this.storage.getDisplayList(true);var zlevelList=this._zlevelList;this._redrawId=Math.random();this._paintList(list,paintAll,this._redrawId);for(var i=0;i<zlevelList.length;i++){var z=zlevelList[i];var layer=this._layers[z];if(!layer.__builtin__&&layer.refresh){var clearColor=0===i?this._backgroundColor:null;layer.refresh(clearColor)}}this.refreshHover();return this},addHover:function(el,hoverStyle){if(el.__hoverMir){return}var elMirror=new el.constructor({style:el.style,shape:el.shape});elMirror.__from=el;el.__hoverMir=elMirror;elMirror.setStyle(hoverStyle);this._hoverElements.push(elMirror)},removeHover:function(el){var elMirror=el.__hoverMir;var hoverElements=this._hoverElements;var idx=indexOf(hoverElements,elMirror);if(0<=idx){hoverElements.splice(idx,1)}el.__hoverMir=null},clearHover:function(el){var hoverElements=this._hoverElements;for(var i=0;i<hoverElements.length;i++){var from=hoverElements[i].__from;if(from){from.__hoverMir=null}}hoverElements.length=0},refreshHover:function(){var hoverElements=this._hoverElements;var len=hoverElements.length;var hoverLayer=this._hoverlayer;hoverLayer&&hoverLayer.clear();if(!len){return}sort(hoverElements,this.storage.displayableSortFunc);if(!hoverLayer){hoverLayer=this._hoverlayer=this.getLayer(HOVER_LAYER_ZLEVEL)}var scope={};hoverLayer.ctx.save();for(var i=0;i<len;){var el=hoverElements[i];var originalEl=el.__from;if(!(originalEl&&originalEl.__zr)){hoverElements.splice(i,1);originalEl.__hoverMir=null;len--;continue}i++;if(!originalEl.invisible){el.transform=originalEl.transform;el.invTransform=originalEl.invTransform;el.__clipPaths=originalEl.__clipPaths;this._doPaintEl(el,hoverLayer,true,scope)}}hoverLayer.ctx.restore()},getHoverLayer:function(){return this.getLayer(HOVER_LAYER_ZLEVEL)},_paintList:function(list,paintAll,redrawId){if(this._redrawId!==redrawId){return}paintAll=paintAll||false;this._updateLayerStatus(list);var finished=this._doPaintList(list,paintAll);if(this._needsManuallyCompositing){this._compositeManually()}if(!finished){var self=this;requestAnimationFrame(function(){self._paintList(list,paintAll,redrawId)})}},_compositeManually:function(){var ctx=this.getLayer(CANVAS_ZLEVEL).ctx;var width=this._domRoot.width;var height=this._domRoot.height;ctx.clearRect(0,0,width,height);this.eachBuiltinLayer(function(layer){if(layer.virtual){ctx.drawImage(layer.dom,0,0,width,height)}})},_doPaintList:function(list,paintAll){var layerList=[];for(var zi=0;zi<this._zlevelList.length;zi++){var zlevel=this._zlevelList[zi];var layer=this._layers[zlevel];if(layer.__builtin__&&layer!==this._hoverlayer&&(layer.__dirty||paintAll)){layerList.push(layer)}}var finished=true;for(var k=0;k<layerList.length;k++){var layer=layerList[k];var ctx=layer.ctx;var scope={};ctx.save();var start=paintAll?layer.__startIndex:layer.__drawIndex;var useTimer=!paintAll&&layer.incremental&&Date.now;var startTime=useTimer&&Date.now();var clearColor=layer.zlevel===this._zlevelList[0]?this._backgroundColor:null;if(layer.__startIndex===layer.__endIndex){layer.clear(false,clearColor)}else if(start===layer.__startIndex){var firstEl=list[start];if(!firstEl.incremental||!firstEl.notClear||paintAll){layer.clear(false,clearColor)}}if(-1===start){console.error("For some unknown reason. drawIndex is -1");start=layer.__startIndex}for(var i=start;i<layer.__endIndex;i++){var el=list[i];this._doPaintEl(el,layer,paintAll,scope);el.__dirty=false;if(useTimer){var dTime=Date.now()-startTime;if(15<dTime){break}}}layer.__drawIndex=i;if(layer.__drawIndex<layer.__endIndex){finished=false}if(scope.prevElClipPaths){ctx.restore()}ctx.restore()}if(env$1.wxa){each(this._layers,function(layer){if(layer&&layer.ctx&&layer.ctx.draw){layer.ctx.draw()}})}return finished},_doPaintEl:function(el,currentLayer,forcePaint,scope){var ctx=currentLayer.ctx;var m=el.transform;if((currentLayer.__dirty||forcePaint)&&!el.invisible&&0!==el.style.opacity&&!(m&&!m[0]&&!m[3])&&!(el.culling&&isDisplayableCulled(el,this._width,this._height))){var clipPaths=el.__clipPaths;if(!scope.prevElClipPaths||isClipPathChanged(clipPaths,scope.prevElClipPaths)){if(scope.prevElClipPaths){currentLayer.ctx.restore();scope.prevElClipPaths=null;scope.prevEl=null}if(clipPaths){ctx.save();doClip(clipPaths,ctx);scope.prevElClipPaths=clipPaths}}el.beforeBrush&&el.beforeBrush(ctx);el.brush(ctx,scope.prevEl||null);scope.prevEl=el;el.afterBrush&&el.afterBrush(ctx)}},getLayer:function(zlevel,virtual){if(this._singleCanvas&&!this._needsManuallyCompositing){zlevel=CANVAS_ZLEVEL}var layer=this._layers[zlevel];if(!layer){layer=new Layer("zr_"+zlevel,this,this.dpr);layer.zlevel=zlevel;layer.__builtin__=true;if(this._layerConfig[zlevel]){merge(layer,this._layerConfig[zlevel],true)}if(virtual){layer.virtual=virtual}this.insertLayer(zlevel,layer);layer.initContext()}return layer},insertLayer:function(zlevel,layer){var layersMap=this._layers;var zlevelList=this._zlevelList;var len=zlevelList.length;var prevLayer=null;var i=-1;var domRoot=this._domRoot;if(layersMap[zlevel]){zrLog("ZLevel "+zlevel+" has been used already");return}if(!isLayerValid(layer)){zrLog("Layer of zlevel "+zlevel+" is not valid");return}if(0<len&&zlevel>zlevelList[0]){for(i=0;i<len-1;i++){if(zlevelList[i]<zlevel&&zlevelList[i+1]>zlevel){break}}prevLayer=layersMap[zlevelList[i]]}zlevelList.splice(i+1,0,zlevel);layersMap[zlevel]=layer;if(!layer.virtual){if(prevLayer){var prevDom=prevLayer.dom;if(prevDom.nextSibling){domRoot.insertBefore(layer.dom,prevDom.nextSibling)}else{domRoot.appendChild(layer.dom)}}else{if(domRoot.firstChild){domRoot.insertBefore(layer.dom,domRoot.firstChild)}else{domRoot.appendChild(layer.dom)}}}},eachLayer:function(cb,context){var zlevelList=this._zlevelList;var z;var i;for(i=0;i<zlevelList.length;i++){z=zlevelList[i];cb.call(context,this._layers[z],z)}},eachBuiltinLayer:function(cb,context){var zlevelList=this._zlevelList;var layer;var z;var i;for(i=0;i<zlevelList.length;i++){z=zlevelList[i];layer=this._layers[z];if(layer.__builtin__){cb.call(context,layer,z)}}},eachOtherLayer:function(cb,context){var zlevelList=this._zlevelList;var layer;var z;var i;for(i=0;i<zlevelList.length;i++){z=zlevelList[i];layer=this._layers[z];if(!layer.__builtin__){cb.call(context,layer,z)}}},getLayers:function(){return this._layers},_updateLayerStatus:function(list){this.eachBuiltinLayer(function(layer,z){layer.__dirty=layer.__used=false});function updatePrevLayer(idx){if(prevLayer){if(prevLayer.__endIndex!==idx){prevLayer.__dirty=true}prevLayer.__endIndex=idx}}if(this._singleCanvas){for(var i=1;i<list.length;i++){var el=list[i];if(el.zlevel!==list[i-1].zlevel||el.incremental){this._needsManuallyCompositing=true;break}}}var prevLayer=null;var incrementalLayerCount=0;for(var i=0;i<list.length;i++){var el=list[i];var zlevel=el.zlevel;var layer;if(el.incremental){layer=this.getLayer(zlevel+INCREMENTAL_INC,this._needsManuallyCompositing);layer.incremental=true;incrementalLayerCount=1}else{layer=this.getLayer(zlevel+(0<incrementalLayerCount?EL_AFTER_INCREMENTAL_INC:0),this._needsManuallyCompositing)}if(!layer.__builtin__){zrLog("ZLevel "+zlevel+" has been used by unkown layer "+layer.id)}if(layer!==prevLayer){layer.__used=true;if(layer.__startIndex!==i){layer.__dirty=true}layer.__startIndex=i;if(!layer.incremental){layer.__drawIndex=i}else{layer.__drawIndex=-1}updatePrevLayer(i);prevLayer=layer}if(el.__dirty){layer.__dirty=true;if(layer.incremental&&0>layer.__drawIndex){layer.__drawIndex=i}}}updatePrevLayer(i);this.eachBuiltinLayer(function(layer,z){if(!layer.__used&&0<layer.getElementCount()){layer.__dirty=true;layer.__startIndex=layer.__endIndex=layer.__drawIndex=0}if(layer.__dirty&&0>layer.__drawIndex){layer.__drawIndex=layer.__startIndex}})},clear:function(){this.eachBuiltinLayer(this._clearLayer);return this},_clearLayer:function(layer){layer.clear()},setBackgroundColor:function(backgroundColor){this._backgroundColor=backgroundColor},configLayer:function(zlevel,config){if(config){var layerConfig=this._layerConfig;if(!layerConfig[zlevel]){layerConfig[zlevel]=config}else{merge(layerConfig[zlevel],config,true)}for(var i=0;i<this._zlevelList.length;i++){var _zlevel=this._zlevelList[i];if(_zlevel===zlevel||_zlevel===zlevel+EL_AFTER_INCREMENTAL_INC){var layer=this._layers[_zlevel];merge(layer,layerConfig[zlevel],true)}}}},delLayer:function(zlevel){var layers=this._layers;var zlevelList=this._zlevelList;var layer=layers[zlevel];if(!layer){return}layer.dom.parentNode.removeChild(layer.dom);delete layers[zlevel];zlevelList.splice(indexOf(zlevelList,zlevel),1)},resize:function(width,height){if(!this._domRoot.style){if(null==width||null==height){return}this._width=width;this._height=height;this.getLayer(CANVAS_ZLEVEL).resize(width,height)}else{var domRoot=this._domRoot;domRoot.style.display="none";var opts=this._opts;null!=width&&(opts.width=width);null!=height&&(opts.height=height);width=this._getSize(0);height=this._getSize(1);domRoot.style.display="";if(this._width!=width||height!=this._height){domRoot.style.width=width+"px";domRoot.style.height=height+"px";for(var id in this._layers){if(this._layers.hasOwnProperty(id)){this._layers[id].resize(width,height)}}each(this._progressiveLayers,function(layer){layer.resize(width,height)});this.refresh(true)}this._width=width;this._height=height}return this},clearLayer:function(zlevel){var layer=this._layers[zlevel];if(layer){layer.clear()}},dispose:function(){this.root.innerHTML="";this.root=this.storage=this._domRoot=this._layers=null},getRenderedCanvas:function(opts){opts=opts||{};if(this._singleCanvas&&!this._compositeManually){return this._layers[CANVAS_ZLEVEL].dom}var imageLayer=new Layer("image",this,opts.pixelRatio||this.dpr);imageLayer.initContext();imageLayer.clear(false,opts.backgroundColor||this._backgroundColor);if(opts.pixelRatio<=this.dpr){this.refresh();var width=imageLayer.dom.width;var height=imageLayer.dom.height;var ctx=imageLayer.ctx;this.eachLayer(function(layer){if(layer.__builtin__){ctx.drawImage(layer.dom,0,0,width,height)}else if(layer.renderToCanvas){imageLayer.ctx.save();layer.renderToCanvas(imageLayer.ctx);imageLayer.ctx.restore()}})}else{var scope={};var displayList=this.storage.getDisplayList(true);for(var i=0;i<displayList.length;i++){var el=displayList[i];this._doPaintEl(el,imageLayer,true,scope)}}return imageLayer.dom},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(whIdx){var opts=this._opts;var wh=["width","height"][whIdx];var cwh=["clientWidth","clientHeight"][whIdx];var plt=["paddingLeft","paddingTop"][whIdx];var prb=["paddingRight","paddingBottom"][whIdx];if(null!=opts[wh]&&"auto"!==opts[wh]){return parseFloat(opts[wh])}var root=this.root;var stl=document.defaultView.getComputedStyle(root);return 0|(root[cwh]||parseInt10(stl[wh])||parseInt10(root.style[wh]))-(parseInt10(stl[plt])||0)-(parseInt10(stl[prb])||0)},pathToImage:function(path,dpr){dpr=dpr||this.dpr;var canvas=document.createElement("canvas");var ctx=canvas.getContext("2d");var rect=path.getBoundingRect();var style=path.style;var shadowBlurSize=style.shadowBlur*dpr;var shadowOffsetX=style.shadowOffsetX*dpr;var shadowOffsetY=style.shadowOffsetY*dpr;var lineWidth=style.hasStroke()?style.lineWidth:0;var leftMargin=Math.max(lineWidth/2,-shadowOffsetX+shadowBlurSize);var rightMargin=Math.max(lineWidth/2,shadowOffsetX+shadowBlurSize);var topMargin=Math.max(lineWidth/2,-shadowOffsetY+shadowBlurSize);var bottomMargin=Math.max(lineWidth/2,shadowOffsetY+shadowBlurSize);var width=rect.width+leftMargin+rightMargin;var height=rect.height+topMargin+bottomMargin;canvas.width=width*dpr;canvas.height=height*dpr;ctx.scale(dpr,dpr);ctx.clearRect(0,0,width,height);ctx.dpr=dpr;var pathTransform={position:path.position,rotation:path.rotation,scale:path.scale};path.position=[leftMargin-rect.x,topMargin-rect.y];path.rotation=0;path.scale=[1,1];path.updateTransform();if(path){path.brush(ctx)}var ImageShape=ZImage;var imgShape=new ImageShape({style:{x:0,y:0,image:canvas}});if(null!=pathTransform.position){imgShape.position=path.position=pathTransform.position}if(null!=pathTransform.rotation){imgShape.rotation=path.rotation=pathTransform.rotation}if(null!=pathTransform.scale){imgShape.scale=path.scale=pathTransform.scale}return imgShape}};var isDomLevel2="undefined"!==typeof window&&!!window.addEventListener;var MOUSE_EVENT_REG=/^(?:mouse|pointer|contextmenu|drag|drop)|click/;function getBoundingClientRect(el){return el.getBoundingClientRect?el.getBoundingClientRect():{left:0,top:0}}function clientToLocal(el,e,out,calculate){out=out||{};if(calculate||!env$1.canvasSupported){defaultGetZrXY(el,e,out)}else if(env$1.browser.firefox&&null!=e.layerX&&e.layerX!==e.offsetX){out.zrX=e.layerX;out.zrY=e.layerY}else if(null!=e.offsetX){out.zrX=e.offsetX;out.zrY=e.offsetY}else{defaultGetZrXY(el,e,out)}return out}function defaultGetZrXY(el,e,out){var box=getBoundingClientRect(el);out.zrX=e.clientX-box.left;out.zrY=e.clientY-box.top}function normalizeEvent(el,e,calculate){e=e||window.event;if(null!=e.zrX){return e}var eventType=e.type;var isTouch=eventType&&0<=eventType.indexOf("touch");if(!isTouch){clientToLocal(el,e,e,calculate);e.zrDelta=e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3}else{var touch="touchend"!=eventType?e.targetTouches[0]:e.changedTouches[0];touch&&clientToLocal(el,touch,e,calculate)}var button=e.button;if(null==e.which&&button!==undefined&&MOUSE_EVENT_REG.test(e.type)){e.which=1&button?1:2&button?3:4&button?2:0}return e}function addEventListener(el,name,handler){if(isDomLevel2){el.addEventListener(name,handler)}else{el.attachEvent("on"+name,handler)}}function removeEventListener(el,name,handler){if(isDomLevel2){el.removeEventListener(name,handler)}else{el.detachEvent("on"+name,handler)}}var Animation=function(options){options=options||{};this.stage=options.stage||{};this.onframe=options.onframe||function(){};this._clips=[];this._running=false;this._time;this._pausedTime;this._pauseStart;this._paused=false;Eventful.call(this)};Animation.prototype={constructor:Animation,addClip:function(clip){this._clips.push(clip)},addAnimator:function(animator){animator.animation=this;var clips=animator.getClips();for(var i=0;i<clips.length;i++){this.addClip(clips[i])}},removeClip:function(clip){var idx=indexOf(this._clips,clip);if(0<=idx){this._clips.splice(idx,1)}},removeAnimator:function(animator){var clips=animator.getClips();for(var i=0;i<clips.length;i++){this.removeClip(clips[i])}animator.animation=null},_update:function(){var time=new Date().getTime()-this._pausedTime;var delta=time-this._time;var clips=this._clips;var len=clips.length;var deferredEvents=[];var deferredClips=[];for(var i=0;i<len;i++){var clip=clips[i];var e=clip.step(time,delta);if(e){deferredEvents.push(e);deferredClips.push(clip)}}for(var i=0;i<len;){if(clips[i]._needsRemove){clips[i]=clips[len-1];clips.pop();len--}else{i++}}len=deferredEvents.length;for(var i=0;i<len;i++){deferredClips[i].fire(deferredEvents[i])}this._time=time;this.onframe(delta);this.trigger("frame",delta);if(this.stage.update){this.stage.update()}},_startLoop:function(){var self=this;this._running=true;function step(){if(self._running){requestAnimationFrame(step);!self._paused&&self._update()}}requestAnimationFrame(step)},start:function(){this._time=new Date().getTime();this._pausedTime=0;this._startLoop()},stop:function(){this._running=false},pause:function(){if(!this._paused){this._pauseStart=new Date().getTime();this._paused=true}},resume:function(){if(this._paused){this._pausedTime+=new Date().getTime()-this._pauseStart;this._paused=false}},clear:function(){this._clips=[]},isFinished:function(){return!this._clips.length},animate:function(target,options){options=options||{};var animator=new Animator(target,options.loop,options.getter,options.setter);this.addAnimator(animator);return animator}};mixin(Animation,Eventful);var GestureMgr=function(){this._track=[]};GestureMgr.prototype={constructor:GestureMgr,recognize:function(event,target,root){this._doTrack(event,target,root);return this._recognize(event)},clear:function(){this._track.length=0;return this},_doTrack:function(event,target,root){var touches=event.touches;if(!touches){return}var trackItem={points:[],touches:[],target:target,event:event};for(var i=0,len=touches.length;i<len;i++){var touch=touches[i];var pos=clientToLocal(root,touch,{});trackItem.points.push([pos.zrX,pos.zrY]);trackItem.touches.push(touch)}this._track.push(trackItem)},_recognize:function(event){for(var eventName in recognizers){if(recognizers.hasOwnProperty(eventName)){var gestureInfo=recognizers[eventName](this._track,event);if(gestureInfo){return gestureInfo}}}}};function dist$1(pointPair){var dx=pointPair[1][0]-pointPair[0][0];var dy=pointPair[1][1]-pointPair[0][1];return Math.sqrt(dx*dx+dy*dy)}function center(pointPair){return[(pointPair[0][0]+pointPair[1][0])/2,(pointPair[0][1]+pointPair[1][1])/2]}var recognizers={pinch:function(track,event){var trackLen=track.length;if(!trackLen){return}var pinchEnd=(track[trackLen-1]||{}).points;var pinchPre=(track[trackLen-2]||{}).points||pinchEnd;if(pinchPre&&1<pinchPre.length&&pinchEnd&&1<pinchEnd.length){var pinchScale=dist$1(pinchEnd)/dist$1(pinchPre);!isFinite(pinchScale)&&(pinchScale=1);event.pinchScale=pinchScale;var pinchCenter=center(pinchEnd);event.pinchX=pinchCenter[0];event.pinchY=pinchCenter[1];return{type:"pinch",target:track[0].target,event:event}}}};var TOUCH_CLICK_DELAY=300;var mouseHandlerNames=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"];var touchHandlerNames=["touchstart","touchend","touchmove"];var pointerEventNames={pointerdown:1,pointerup:1,pointermove:1,pointerout:1};var pointerHandlerNames=map(mouseHandlerNames,function(name){var nm=name.replace("mouse","pointer");return pointerEventNames[nm]?nm:name});function eventNameFix(name){return"mousewheel"===name&&env$1.browser.firefox?"DOMMouseScroll":name}function processGesture(proxy,event,stage){var gestureMgr=proxy._gestureMgr;"start"===stage&&gestureMgr.clear();var gestureInfo=gestureMgr.recognize(event,proxy.handler.findHover(event.zrX,event.zrY,null).target,proxy.dom);"end"===stage&&gestureMgr.clear();if(gestureInfo){var type=gestureInfo.type;event.gestureEvent=type;proxy.handler.dispatchToElement({target:gestureInfo.target},type,gestureInfo.event)}}function setTouchTimer(instance){instance._touching=true;clearTimeout(instance._touchTimer);instance._touchTimer=setTimeout(function(){instance._touching=false},700)}var domHandlers={mousemove:function(event){event=normalizeEvent(this.dom,event);this.trigger("mousemove",event)},mouseout:function(event){event=normalizeEvent(this.dom,event);var element=event.toElement||event.relatedTarget;if(element!=this.dom){while(element&&9!=element.nodeType){if(element===this.dom){return}element=element.parentNode}}this.trigger("mouseout",event)},touchstart:function(event){event=normalizeEvent(this.dom,event);event.zrByTouch=true;this._lastTouchMoment=new Date;processGesture(this,event,"start");domHandlers.mousemove.call(this,event);domHandlers.mousedown.call(this,event);setTouchTimer(this)},touchmove:function(event){event=normalizeEvent(this.dom,event);event.zrByTouch=true;processGesture(this,event,"change");domHandlers.mousemove.call(this,event);setTouchTimer(this)},touchend:function(event){event=normalizeEvent(this.dom,event);event.zrByTouch=true;processGesture(this,event,"end");domHandlers.mouseup.call(this,event);if(+new Date-this._lastTouchMoment<TOUCH_CLICK_DELAY){domHandlers.click.call(this,event)}setTouchTimer(this)},pointerdown:function(event){domHandlers.mousedown.call(this,event)},pointermove:function(event){if(!isPointerFromTouch(event)){domHandlers.mousemove.call(this,event)}},pointerup:function(event){domHandlers.mouseup.call(this,event)},pointerout:function(event){if(!isPointerFromTouch(event)){domHandlers.mouseout.call(this,event)}}};function isPointerFromTouch(event){var pointerType=event.pointerType;return"pen"===pointerType||"touch"===pointerType}each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(name){domHandlers[name]=function(event){event=normalizeEvent(this.dom,event);this.trigger(name,event)}});function initDomHandler(instance){each(touchHandlerNames,function(name){instance._handlers[name]=bind(domHandlers[name],instance)});each(pointerHandlerNames,function(name){instance._handlers[name]=bind(domHandlers[name],instance)});each(mouseHandlerNames,function(name){instance._handlers[name]=makeMouseHandler(domHandlers[name],instance)});function makeMouseHandler(fn,instance){return function(){if(instance._touching){return}return fn.apply(instance,arguments)}}}function HandlerDomProxy(dom){Eventful.call(this);this.dom=dom;this._touching=false;this._touchTimer;this._gestureMgr=new GestureMgr;this._handlers={};initDomHandler(this);if(env$1.pointerEventsSupported){mountHandlers(pointerHandlerNames,this)}else{if(env$1.touchEventsSupported){mountHandlers(touchHandlerNames,this)}mountHandlers(mouseHandlerNames,this)}function mountHandlers(handlerNames,instance){each(handlerNames,function(name){addEventListener(dom,eventNameFix(name),instance._handlers[name])},instance)}}var handlerDomProxyProto=HandlerDomProxy.prototype;handlerDomProxyProto.dispose=function(){var handlerNames=mouseHandlerNames.concat(touchHandlerNames);for(var i=0;i<handlerNames.length;i++){var name=handlerNames[i];removeEventListener(this.dom,eventNameFix(name),this._handlers[name])}};handlerDomProxyProto.setCursor=function(cursorStyle){this.dom.style&&(this.dom.style.cursor=cursorStyle||"default")};mixin(HandlerDomProxy,Eventful);var useVML=!env$1.canvasSupported;var painterCtors={canvas:Painter};var instances={};var version="4.0.3";function init(dom,opts){var zr=new ZRender(guid(),dom,opts);instances[zr.id]=zr;return zr}function dispose(zr){if(zr){zr.dispose()}else{for(var key in instances){if(instances.hasOwnProperty(key)){instances[key].dispose()}}instances={}}return this}function getInstance(id){return instances[id]}function registerPainter(name,Ctor){painterCtors[name]=Ctor}function delInstance(id){delete instances[id]}var ZRender=function(id,dom,opts){opts=opts||{};this.dom=dom;this.id=id;var self=this;var storage=new Storage;var rendererType=opts.renderer;if(useVML){if(!painterCtors.vml){throw new Error("You need to require 'zrender/vml/vml' to support IE8")}rendererType="vml"}else if(!rendererType||!painterCtors[rendererType]){rendererType="canvas"}var painter=new painterCtors[rendererType](dom,storage,opts,id);this.storage=storage;this.painter=painter;var handerProxy=!env$1.node&&!env$1.worker?new HandlerDomProxy(painter.getViewportRoot()):null;this.handler=new Handler(storage,painter,handerProxy,painter.root);this.animation=new Animation({stage:{update:bind(this.flush,this)}});this.animation.start();this._needsRefresh;var oldDelFromStorage=storage.delFromStorage;var oldAddToStorage=storage.addToStorage;storage.delFromStorage=function(el){oldDelFromStorage.call(storage,el);el&&el.removeSelfFromZr(self)};storage.addToStorage=function(el){oldAddToStorage.call(storage,el);el.addSelfToZr(self)}};ZRender.prototype={constructor:ZRender,getId:function(){return this.id},add:function(el){this.storage.addRoot(el);this._needsRefresh=true},remove:function(el){this.storage.delRoot(el);this._needsRefresh=true},configLayer:function(zLevel,config){if(this.painter.configLayer){this.painter.configLayer(zLevel,config)}this._needsRefresh=true},setBackgroundColor:function(backgroundColor){if(this.painter.setBackgroundColor){this.painter.setBackgroundColor(backgroundColor)}this._needsRefresh=true},refreshImmediately:function(){this._needsRefresh=false;this.painter.refresh();this._needsRefresh=false},refresh:function(){this._needsRefresh=true},flush:function(){var triggerRendered;if(this._needsRefresh){triggerRendered=true;this.refreshImmediately()}if(this._needsRefreshHover){triggerRendered=true;this.refreshHoverImmediately()}triggerRendered&&this.trigger("rendered")},addHover:function(el,style){if(this.painter.addHover){this.painter.addHover(el,style);this.refreshHover()}},removeHover:function(el){if(this.painter.removeHover){this.painter.removeHover(el);this.refreshHover()}},clearHover:function(){if(this.painter.clearHover){this.painter.clearHover();this.refreshHover()}},refreshHover:function(){this._needsRefreshHover=true},refreshHoverImmediately:function(){this._needsRefreshHover=false;this.painter.refreshHover&&this.painter.refreshHover()},resize:function(opts){opts=opts||{};this.painter.resize(opts.width,opts.height);this.handler.resize()},clearAnimation:function(){this.animation.clear()},getWidth:function(){return this.painter.getWidth()},getHeight:function(){return this.painter.getHeight()},pathToImage:function(e,dpr){return this.painter.pathToImage(e,dpr)},setCursorStyle:function(cursorStyle){this.handler.setCursorStyle(cursorStyle)},findHover:function(x,y){return this.handler.findHover(x,y)},on:function(eventName,eventHandler,context){this.handler.on(eventName,eventHandler,context)},off:function(eventName,eventHandler){this.handler.off(eventName,eventHandler)},trigger:function(eventName,event){this.handler.trigger(eventName,event)},clear:function(){this.storage.delRoot();this.painter.clear()},dispose:function(){this.animation.stop();this.clear();this.storage.dispose();this.painter.dispose();this.handler.dispose();this.animation=this.storage=this.painter=this.handler=null;delInstance(this.id)}};var mathPow=Math.pow;var mathSqrt$2=Math.sqrt;var EPSILON$1=1e-8;var EPSILON_NUMERIC=1e-4;var THREE_SQRT=mathSqrt$2(3);var ONE_THIRD=1/3;var _v0=create();var _v1=create();var _v2=create();function isAroundZero(val){return val>-EPSILON$1&&val<EPSILON$1}function isNotAroundZero$1(val){return val>EPSILON$1||val<-EPSILON$1}function cubicAt(p0,p1,p2,p3,t){var onet=1-t;return onet*onet*(onet*p0+3*t*p1)+t*t*(t*p3+3*onet*p2)}function cubicDerivativeAt(p0,p1,p2,p3,t){var onet=1-t;return 3*(((p1-p0)*onet+2*(p2-p1)*t)*onet+(p3-p2)*t*t)}function cubicRootAt(p0,p1,p2,p3,val,roots){var a=p3+3*(p1-p2)-p0;var b=3*(p2-2*p1+p0);var c=3*(p1-p0);var d=p0-val;var A=b*b-3*a*c;var B=b*c-9*a*d;var C=c*c-3*b*d;var n=0;if(isAroundZero(A)&&isAroundZero(B)){if(isAroundZero(b)){roots[0]=0}else{var t1=-c/b;if(0<=t1&&1>=t1){roots[n++]=t1}}}else{var disc=B*B-4*A*C;if(isAroundZero(disc)){var K=B/A;var t1=-b/a+K;var t2=-K/2;if(0<=t1&&1>=t1){roots[n++]=t1}if(0<=t2&&1>=t2){roots[n++]=t2}}else if(0<disc){var discSqrt=mathSqrt$2(disc);var Y1=A*b+1.5*a*(-B+discSqrt);var Y2=A*b+1.5*a*(-B-discSqrt);if(0>Y1){Y1=-mathPow(-Y1,ONE_THIRD)}else{Y1=mathPow(Y1,ONE_THIRD)}if(0>Y2){Y2=-mathPow(-Y2,ONE_THIRD)}else{Y2=mathPow(Y2,ONE_THIRD)}var t1=(-b-(Y1+Y2))/(3*a);if(0<=t1&&1>=t1){roots[n++]=t1}}else{var T=(2*A*b-3*a*B)/(2*mathSqrt$2(A*A*A));var theta=Math.acos(T)/3;var ASqrt=mathSqrt$2(A);var tmp=Math.cos(theta);var t1=(-b-2*ASqrt*tmp)/(3*a);var t2=(-b+ASqrt*(tmp+THREE_SQRT*Math.sin(theta)))/(3*a);var t3=(-b+ASqrt*(tmp-THREE_SQRT*Math.sin(theta)))/(3*a);if(0<=t1&&1>=t1){roots[n++]=t1}if(0<=t2&&1>=t2){roots[n++]=t2}if(0<=t3&&1>=t3){roots[n++]=t3}}}return n}function cubicExtrema(p0,p1,p2,p3,extrema){var b=6*p2-12*p1+6*p0;var a=9*p1+3*p3-3*p0-9*p2;var c=3*p1-3*p0;var n=0;if(isAroundZero(a)){if(isNotAroundZero$1(b)){var t1=-c/b;if(0<=t1&&1>=t1){extrema[n++]=t1}}}else{var disc=b*b-4*a*c;if(isAroundZero(disc)){extrema[0]=-b/(2*a)}else if(0<disc){var discSqrt=mathSqrt$2(disc);var t1=(-b+discSqrt)/(2*a);var t2=(-b-discSqrt)/(2*a);if(0<=t1&&1>=t1){extrema[n++]=t1}if(0<=t2&&1>=t2){extrema[n++]=t2}}}return n}function cubicSubdivide(p0,p1,p2,p3,t,out){var p01=(p1-p0)*t+p0;var p12=(p2-p1)*t+p1;var p23=(p3-p2)*t+p2;var p012=(p12-p01)*t+p01;var p123=(p23-p12)*t+p12;var p0123=(p123-p012)*t+p012;out[0]=p0;out[1]=p01;out[2]=p012;out[3]=p0123;out[4]=p0123;out[5]=p123;out[6]=p23;out[7]=p3}function cubicProjectPoint(x0,y0,x1,y1,x2,y2,x3,y3,x,y,out){var t;var interval=0.005;var d=Infinity;var prev;var next;var d1;var d2;_v0[0]=x;_v0[1]=y;for(var _t=0;1>_t;_t+=0.05){_v1[0]=cubicAt(x0,x1,x2,x3,_t);_v1[1]=cubicAt(y0,y1,y2,y3,_t);d1=distSquare(_v0,_v1);if(d1<d){t=_t;d=d1}}d=Infinity;for(var i=0;32>i;i++){if(interval<EPSILON_NUMERIC){break}prev=t-interval;next=t+interval;_v1[0]=cubicAt(x0,x1,x2,x3,prev);_v1[1]=cubicAt(y0,y1,y2,y3,prev);d1=distSquare(_v1,_v0);if(0<=prev&&d1<d){t=prev;d=d1}else{_v2[0]=cubicAt(x0,x1,x2,x3,next);_v2[1]=cubicAt(y0,y1,y2,y3,next);d2=distSquare(_v2,_v0);if(1>=next&&d2<d){t=next;d=d2}else{interval*=0.5}}}if(out){out[0]=cubicAt(x0,x1,x2,x3,t);out[1]=cubicAt(y0,y1,y2,y3,t)}return mathSqrt$2(d)}function quadraticAt(p0,p1,p2,t){var onet=1-t;return onet*(onet*p0+2*t*p1)+t*t*p2}function quadraticDerivativeAt(p0,p1,p2,t){return 2*((1-t)*(p1-p0)+t*(p2-p1))}function quadraticRootAt(p0,p1,p2,val,roots){var a=p0-2*p1+p2;var b=2*(p1-p0);var c=p0-val;var n=0;if(isAroundZero(a)){if(isNotAroundZero$1(b)){var t1=-c/b;if(0<=t1&&1>=t1){roots[n++]=t1}}}else{var disc=b*b-4*a*c;if(isAroundZero(disc)){var t1=-b/(2*a);if(0<=t1&&1>=t1){roots[n++]=t1}}else if(0<disc){var discSqrt=mathSqrt$2(disc);var t1=(-b+discSqrt)/(2*a);var t2=(-b-discSqrt)/(2*a);if(0<=t1&&1>=t1){roots[n++]=t1}if(0<=t2&&1>=t2){roots[n++]=t2}}}return n}function quadraticExtremum(p0,p1,p2){var divider=p0+p2-2*p1;if(0===divider){return 0.5}else{return(p0-p1)/divider}}function quadraticSubdivide(p0,p1,p2,t,out){var p01=(p1-p0)*t+p0;var p12=(p2-p1)*t+p1;var p012=(p12-p01)*t+p01;out[0]=p0;out[1]=p01;out[2]=p012;out[3]=p012;out[4]=p12;out[5]=p2}function quadraticProjectPoint(x0,y0,x1,y1,x2,y2,x,y,out){var t;var interval=0.005;var d=Infinity;_v0[0]=x;_v0[1]=y;for(var _t=0;1>_t;_t+=0.05){_v1[0]=quadraticAt(x0,x1,x2,_t);_v1[1]=quadraticAt(y0,y1,y2,_t);var d1=distSquare(_v0,_v1);if(d1<d){t=_t;d=d1}}d=Infinity;for(var i=0;32>i;i++){if(interval<EPSILON_NUMERIC){break}var prev=t-interval;var next=t+interval;_v1[0]=quadraticAt(x0,x1,x2,prev);_v1[1]=quadraticAt(y0,y1,y2,prev);var d1=distSquare(_v1,_v0);if(0<=prev&&d1<d){t=prev;d=d1}else{_v2[0]=quadraticAt(x0,x1,x2,next);_v2[1]=quadraticAt(y0,y1,y2,next);var d2=distSquare(_v2,_v0);if(1>=next&&d2<d){t=next;d=d2}else{interval*=0.5}}}if(out){out[0]=quadraticAt(x0,x1,x2,t);out[1]=quadraticAt(y0,y1,y2,t)}return mathSqrt$2(d)}var mathMin$2=Math.min;var mathMax$2=Math.max;var mathSin$2=Math.sin;var mathCos$2=Math.cos;var PI2=2*Math.PI;var start=create();var end=create();var extremity=create();function fromLine(x0,y0,x1,y1,min$$1,max$$1){min$$1[0]=mathMin$2(x0,x1);min$$1[1]=mathMin$2(y0,y1);max$$1[0]=mathMax$2(x0,x1);max$$1[1]=mathMax$2(y0,y1)}var xDim=[];var yDim=[];function fromCubic(x0,y0,x1,y1,x2,y2,x3,y3,min$$1,max$$1){var cubicExtrema$$1=cubicExtrema;var cubicAt$$1=cubicAt;var i;var n=cubicExtrema$$1(x0,x1,x2,x3,xDim);min$$1[0]=Infinity;min$$1[1]=Infinity;max$$1[0]=-Infinity;max$$1[1]=-Infinity;for(i=0;i<n;i++){var x=cubicAt$$1(x0,x1,x2,x3,xDim[i]);min$$1[0]=mathMin$2(x,min$$1[0]);max$$1[0]=mathMax$2(x,max$$1[0])}n=cubicExtrema$$1(y0,y1,y2,y3,yDim);for(i=0;i<n;i++){var y=cubicAt$$1(y0,y1,y2,y3,yDim[i]);min$$1[1]=mathMin$2(y,min$$1[1]);max$$1[1]=mathMax$2(y,max$$1[1])}min$$1[0]=mathMin$2(x0,min$$1[0]);max$$1[0]=mathMax$2(x0,max$$1[0]);min$$1[0]=mathMin$2(x3,min$$1[0]);max$$1[0]=mathMax$2(x3,max$$1[0]);min$$1[1]=mathMin$2(y0,min$$1[1]);max$$1[1]=mathMax$2(y0,max$$1[1]);min$$1[1]=mathMin$2(y3,min$$1[1]);max$$1[1]=mathMax$2(y3,max$$1[1])}function fromQuadratic(x0,y0,x1,y1,x2,y2,min$$1,max$$1){var quadraticExtremum$$1=quadraticExtremum;var quadraticAt$$1=quadraticAt;var tx=mathMax$2(mathMin$2(quadraticExtremum$$1(x0,x1,x2),1),0);var ty=mathMax$2(mathMin$2(quadraticExtremum$$1(y0,y1,y2),1),0);var x=quadraticAt$$1(x0,x1,x2,tx);var y=quadraticAt$$1(y0,y1,y2,ty);min$$1[0]=mathMin$2(x0,x2,x);min$$1[1]=mathMin$2(y0,y2,y);max$$1[0]=mathMax$2(x0,x2,x);max$$1[1]=mathMax$2(y0,y2,y)}function fromArc(x,y,rx,ry,startAngle,endAngle,anticlockwise,min$$1,max$$1){var vec2Min=min;var vec2Max=max;var diff=Math.abs(startAngle-endAngle);if(1e-4>diff%PI2&&1e-4<diff){min$$1[0]=x-rx;min$$1[1]=y-ry;max$$1[0]=x+rx;max$$1[1]=y+ry;return}start[0]=mathCos$2(startAngle)*rx+x;start[1]=mathSin$2(startAngle)*ry+y;end[0]=mathCos$2(endAngle)*rx+x;end[1]=mathSin$2(endAngle)*ry+y;vec2Min(min$$1,start,end);vec2Max(max$$1,start,end);startAngle=startAngle%PI2;if(0>startAngle){startAngle=startAngle+PI2}endAngle=endAngle%PI2;if(0>endAngle){endAngle=endAngle+PI2}if(startAngle>endAngle&&!anticlockwise){endAngle+=PI2}else if(startAngle<endAngle&&anticlockwise){startAngle+=PI2}if(anticlockwise){var tmp=endAngle;endAngle=startAngle;startAngle=tmp}for(var angle=0;angle<endAngle;angle+=Math.PI/2){if(angle>startAngle){extremity[0]=mathCos$2(angle)*rx+x;extremity[1]=mathSin$2(angle)*ry+y;vec2Min(min$$1,extremity,min$$1);vec2Max(max$$1,extremity,max$$1)}}}var CMD={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7};var min$1=[];var max$1=[];var min2=[];var max2=[];var mathMin$1=Math.min;var mathMax$1=Math.max;var mathCos$1=Math.cos;var mathSin$1=Math.sin;var mathSqrt$1=Math.sqrt;var mathAbs=Math.abs;var hasTypedArray="undefined"!=typeof Float32Array;var PathProxy=function(notSaveData){this._saveData=!(notSaveData||false);if(this._saveData){this.data=[]}this._ctx=null};PathProxy.prototype={constructor:PathProxy,_xi:0,_yi:0,_x0:0,_y0:0,_ux:0,_uy:0,_len:0,_lineDash:null,_dashOffset:0,_dashIdx:0,_dashSum:0,setScale:function(sx,sy){this._ux=mathAbs(1/devicePixelRatio/sx)||0;this._uy=mathAbs(1/devicePixelRatio/sy)||0},getContext:function(){return this._ctx},beginPath:function(ctx){this._ctx=ctx;ctx&&ctx.beginPath();ctx&&(this.dpr=ctx.dpr);if(this._saveData){this._len=0}if(this._lineDash){this._lineDash=null;this._dashOffset=0}return this},moveTo:function(x,y){this.addData(CMD.M,x,y);this._ctx&&this._ctx.moveTo(x,y);this._x0=x;this._y0=y;this._xi=x;this._yi=y;return this},lineTo:function(x,y){var exceedUnit=mathAbs(x-this._xi)>this._ux||mathAbs(y-this._yi)>this._uy||5>this._len;this.addData(CMD.L,x,y);if(this._ctx&&exceedUnit){this._needsDash()?this._dashedLineTo(x,y):this._ctx.lineTo(x,y)}if(exceedUnit){this._xi=x;this._yi=y}return this},bezierCurveTo:function(x1,y1,x2,y2,x3,y3){this.addData(CMD.C,x1,y1,x2,y2,x3,y3);if(this._ctx){this._needsDash()?this._dashedBezierTo(x1,y1,x2,y2,x3,y3):this._ctx.bezierCurveTo(x1,y1,x2,y2,x3,y3)}this._xi=x3;this._yi=y3;return this},quadraticCurveTo:function(x1,y1,x2,y2){this.addData(CMD.Q,x1,y1,x2,y2);if(this._ctx){this._needsDash()?this._dashedQuadraticTo(x1,y1,x2,y2):this._ctx.quadraticCurveTo(x1,y1,x2,y2)}this._xi=x2;this._yi=y2;return this},arc:function(cx,cy,r,startAngle,endAngle,anticlockwise){this.addData(CMD.A,cx,cy,r,r,startAngle,endAngle-startAngle,0,anticlockwise?0:1);this._ctx&&this._ctx.arc(cx,cy,r,startAngle,endAngle,anticlockwise);this._xi=mathCos$1(endAngle)*r+cx;this._yi=mathSin$1(endAngle)*r+cx;return this},arcTo:function(x1,y1,x2,y2,radius){if(this._ctx){this._ctx.arcTo(x1,y1,x2,y2,radius)}return this},rect:function(x,y,w,h){this._ctx&&this._ctx.rect(x,y,w,h);this.addData(CMD.R,x,y,w,h);return this},closePath:function(){this.addData(CMD.Z);var ctx=this._ctx;var x0=this._x0;var y0=this._y0;if(ctx){this._needsDash()&&this._dashedLineTo(x0,y0);ctx.closePath()}this._xi=x0;this._yi=y0;return this},fill:function(ctx){ctx&&ctx.fill();this.toStatic()},stroke:function(ctx){ctx&&ctx.stroke();this.toStatic()},setLineDash:function(lineDash){if(lineDash instanceof Array){this._lineDash=lineDash;this._dashIdx=0;var lineDashSum=0;for(var i=0;i<lineDash.length;i++){lineDashSum+=lineDash[i]}this._dashSum=lineDashSum}return this},setLineDashOffset:function(offset){this._dashOffset=offset;return this},len:function(){return this._len},setData:function(data){var len$$1=data.length;if(!(this.data&&this.data.length==len$$1)&&hasTypedArray){this.data=new Float32Array(len$$1)}for(var i=0;i<len$$1;i++){this.data[i]=data[i]}this._len=len$$1},appendPath:function(path){if(!(path instanceof Array)){path=[path]}var len$$1=path.length;var appendSize=0;var offset=this._len;for(var i=0;i<len$$1;i++){appendSize+=path[i].len()}if(hasTypedArray&&this.data instanceof Float32Array){this.data=new Float32Array(offset+appendSize)}for(var i=0;i<len$$1;i++){var appendPathData=path[i].data;for(var k=0;k<appendPathData.length;k++){this.data[offset++]=appendPathData[k]}}this._len=offset},addData:function(cmd){if(!this._saveData){return}var data=this.data;if(this._len+arguments.length>data.length){this._expandData();data=this.data}for(var i=0;i<arguments.length;i++){data[this._len++]=arguments[i]}this._prevCmd=cmd},_expandData:function(){if(!(this.data instanceof Array)){var newData=[];for(var i=0;i<this._len;i++){newData[i]=this.data[i]}this.data=newData}},_needsDash:function(){return this._lineDash},_dashedLineTo:function(x1,y1){var dashSum=this._dashSum;var offset=this._dashOffset;var lineDash=this._lineDash;var ctx=this._ctx;var x0=this._xi;var y0=this._yi;var dx=x1-x0;var dy=y1-y0;var dist$$1=mathSqrt$1(dx*dx+dy*dy);var x=x0;var y=y0;var dash;var nDash=lineDash.length;var idx;dx/=dist$$1;dy/=dist$$1;if(0>offset){offset=dashSum+offset}offset%=dashSum;x-=offset*dx;y-=offset*dy;while(0<dx&&x<=x1||0>dx&&x>=x1||0==dx&&(0<dy&&y<=y1||0>dy&&y>=y1)){idx=this._dashIdx;dash=lineDash[idx];x+=dx*dash;y+=dy*dash;this._dashIdx=(idx+1)%nDash;if(0<dx&&x<x0||0>dx&&x>x0||0<dy&&y<y0||0>dy&&y>y0){continue}ctx[idx%2?"moveTo":"lineTo"](0<=dx?mathMin$1(x,x1):mathMax$1(x,x1),0<=dy?mathMin$1(y,y1):mathMax$1(y,y1))}dx=x-x1;dy=y-y1;this._dashOffset=-mathSqrt$1(dx*dx+dy*dy)},_dashedBezierTo:function(x1,y1,x2,y2,x3,y3){var dashSum=this._dashSum;var offset=this._dashOffset;var lineDash=this._lineDash;var ctx=this._ctx;var x0=this._xi;var y0=this._yi;var t;var dx;var dy;var cubicAt$$1=cubicAt;var bezierLen=0;var idx=this._dashIdx;var nDash=lineDash.length;var x;var y;var tmpLen=0;if(0>offset){offset=dashSum+offset}offset%=dashSum;for(t=0;1>t;t+=0.1){dx=cubicAt$$1(x0,x1,x2,x3,t+0.1)-cubicAt$$1(x0,x1,x2,x3,t);dy=cubicAt$$1(y0,y1,y2,y3,t+0.1)-cubicAt$$1(y0,y1,y2,y3,t);bezierLen+=mathSqrt$1(dx*dx+dy*dy)}for(;idx<nDash;idx++){tmpLen+=lineDash[idx];if(tmpLen>offset){break}}t=(tmpLen-offset)/bezierLen;while(1>=t){x=cubicAt$$1(x0,x1,x2,x3,t);y=cubicAt$$1(y0,y1,y2,y3,t);idx%2?ctx.moveTo(x,y):ctx.lineTo(x,y);t+=lineDash[idx]/bezierLen;idx=(idx+1)%nDash}0!==idx%2&&ctx.lineTo(x3,y3);dx=x3-x;dy=y3-y;this._dashOffset=-mathSqrt$1(dx*dx+dy*dy)},_dashedQuadraticTo:function(x1,y1,x2,y2){var x3=x2;var y3=y2;x2=(x2+2*x1)/3;y2=(y2+2*y1)/3;x1=(this._xi+2*x1)/3;y1=(this._yi+2*y1)/3;this._dashedBezierTo(x1,y1,x2,y2,x3,y3)},toStatic:function(){var data=this.data;if(data instanceof Array){data.length=this._len;if(hasTypedArray){this.data=new Float32Array(data)}}},getBoundingRect:function(){min$1[0]=min$1[1]=min2[0]=min2[1]=Number.MAX_VALUE;max$1[0]=max$1[1]=max2[0]=max2[1]=-Number.MAX_VALUE;var data=this.data;var xi=0;var yi=0;var x0=0;var y0=0;for(var i=0;i<data.length;){var cmd=data[i++];if(1==i){xi=data[i];yi=data[i+1];x0=xi;y0=yi}switch(cmd){case CMD.M:x0=data[i++];y0=data[i++];xi=x0;yi=y0;min2[0]=x0;min2[1]=y0;max2[0]=x0;max2[1]=y0;break;case CMD.L:fromLine(xi,yi,data[i],data[i+1],min2,max2);xi=data[i++];yi=data[i++];break;case CMD.C:fromCubic(xi,yi,data[i++],data[i++],data[i++],data[i++],data[i],data[i+1],min2,max2);xi=data[i++];yi=data[i++];break;case CMD.Q:fromQuadratic(xi,yi,data[i++],data[i++],data[i],data[i+1],min2,max2);xi=data[i++];yi=data[i++];break;case CMD.A:var cx=data[i++];var cy=data[i++];var rx=data[i++];var ry=data[i++];var startAngle=data[i++];var endAngle=data[i++]+startAngle;var psi=data[i++];var anticlockwise=1-data[i++];if(1==i){x0=mathCos$1(startAngle)*rx+cx;y0=mathSin$1(startAngle)*ry+cy}fromArc(cx,cy,rx,ry,startAngle,endAngle,anticlockwise,min2,max2);xi=mathCos$1(endAngle)*rx+cx;yi=mathSin$1(endAngle)*ry+cy;break;case CMD.R:x0=xi=data[i++];y0=yi=data[i++];var width=data[i++];var height=data[i++];fromLine(x0,y0,x0+width,y0+height,min2,max2);break;case CMD.Z:xi=x0;yi=y0;break;}min(min$1,min$1,min2);max(max$1,max$1,max2)}if(0===i){min$1[0]=min$1[1]=max$1[0]=max$1[1]=0}return new BoundingRect(min$1[0],min$1[1],max$1[0]-min$1[0],max$1[1]-min$1[1])},rebuildPath:function(ctx){var d=this.data;var x0,y0;var xi,yi;var x,y;var ux=this._ux;var uy=this._uy;var len$$1=this._len;for(var i=0;i<len$$1;){var cmd=d[i++];if(1==i){xi=d[i];yi=d[i+1];x0=xi;y0=yi}switch(cmd){case CMD.M:x0=xi=d[i++];y0=yi=d[i++];ctx.moveTo(xi,yi);break;case CMD.L:x=d[i++];y=d[i++];if(mathAbs(x-xi)>ux||mathAbs(y-yi)>uy||i===len$$1-1){ctx.lineTo(x,y);xi=x;yi=y}break;case CMD.C:ctx.bezierCurveTo(d[i++],d[i++],d[i++],d[i++],d[i++],d[i++]);xi=d[i-2];yi=d[i-1];break;case CMD.Q:ctx.quadraticCurveTo(d[i++],d[i++],d[i++],d[i++]);xi=d[i-2];yi=d[i-1];break;case CMD.A:var cx=d[i++];var cy=d[i++];var rx=d[i++];var ry=d[i++];var theta=d[i++];var dTheta=d[i++];var psi=d[i++];var fs=d[i++];var r=rx>ry?rx:ry;var scaleX=rx>ry?1:rx/ry;var scaleY=rx>ry?ry/rx:1;var isEllipse=1e-3<Math.abs(rx-ry);var endAngle=theta+dTheta;if(isEllipse){ctx.translate(cx,cy);ctx.rotate(psi);ctx.scale(scaleX,scaleY);ctx.arc(0,0,r,theta,endAngle,1-fs);ctx.scale(1/scaleX,1/scaleY);ctx.rotate(-psi);ctx.translate(-cx,-cy)}else{ctx.arc(cx,cy,r,theta,endAngle,1-fs)}if(1==i){x0=mathCos$1(theta)*rx+cx;y0=mathSin$1(theta)*ry+cy}xi=mathCos$1(endAngle)*rx+cx;yi=mathSin$1(endAngle)*ry+cy;break;case CMD.R:x0=xi=d[i];y0=yi=d[i+1];ctx.rect(d[i++],d[i++],d[i++],d[i++]);break;case CMD.Z:ctx.closePath();xi=x0;yi=y0;}}}};PathProxy.CMD=CMD;function containStroke$1(x0,y0,x1,y1,lineWidth,x,y){if(0===lineWidth){return false}var _l=lineWidth;var _a=0;var _b=x0;if(y>y0+_l&&y>y1+_l||y<y0-_l&&y<y1-_l||x>x0+_l&&x>x1+_l||x<x0-_l&&x<x1-_l){return false}if(x0!==x1){_a=(y0-y1)/(x0-x1);_b=(x0*y1-x1*y0)/(x0-x1)}else{return Math.abs(x-x0)<=_l/2}var tmp=_a*x-y+_b;var _s=tmp*tmp/(_a*_a+1);return _s<=_l/2*_l/2}function containStroke$2(x0,y0,x1,y1,x2,y2,x3,y3,lineWidth,x,y){if(0===lineWidth){return false}var _l=lineWidth;if(y>y0+_l&&y>y1+_l&&y>y2+_l&&y>y3+_l||y<y0-_l&&y<y1-_l&&y<y2-_l&&y<y3-_l||x>x0+_l&&x>x1+_l&&x>x2+_l&&x>x3+_l||x<x0-_l&&x<x1-_l&&x<x2-_l&&x<x3-_l){return false}var d=cubicProjectPoint(x0,y0,x1,y1,x2,y2,x3,y3,x,y,null);return d<=_l/2}function containStroke$3(x0,y0,x1,y1,x2,y2,lineWidth,x,y){if(0===lineWidth){return false}var _l=lineWidth;if(y>y0+_l&&y>y1+_l&&y>y2+_l||y<y0-_l&&y<y1-_l&&y<y2-_l||x>x0+_l&&x>x1+_l&&x>x2+_l||x<x0-_l&&x<x1-_l&&x<x2-_l){return false}var d=quadraticProjectPoint(x0,y0,x1,y1,x2,y2,x,y,null);return d<=_l/2}var PI2$3=2*Math.PI;function normalizeRadian(angle){angle%=PI2$3;if(0>angle){angle+=PI2$3}return angle}var PI2$2=2*Math.PI;function containStroke$4(cx,cy,r,startAngle,endAngle,anticlockwise,lineWidth,x,y){if(0===lineWidth){return false}var _l=lineWidth;x-=cx;y-=cy;var d=Math.sqrt(x*x+y*y);if(d-_l>r||d+_l<r){return false}if(1e-4>Math.abs(startAngle-endAngle)%PI2$2){return true}if(anticlockwise){var tmp=startAngle;startAngle=normalizeRadian(endAngle);endAngle=normalizeRadian(tmp)}else{startAngle=normalizeRadian(startAngle);endAngle=normalizeRadian(endAngle)}if(startAngle>endAngle){endAngle+=PI2$2}var angle=Math.atan2(y,x);if(0>angle){angle+=PI2$2}return angle>=startAngle&&angle<=endAngle||angle+PI2$2>=startAngle&&angle+PI2$2<=endAngle}function windingLine(x0,y0,x1,y1,x,y){if(y>y0&&y>y1||y<y0&&y<y1){return 0}if(y1===y0){return 0}var dir=y1<y0?1:-1;var t=(y-y0)/(y1-y0);if(1===t||0===t){dir=y1<y0?0.5:-0.5}var x_=t*(x1-x0)+x0;return x_>x?dir:0}var CMD$1=PathProxy.CMD;var PI2$1=2*Math.PI;var EPSILON$2=1e-4;function isAroundEqual(a,b){return Math.abs(a-b)<EPSILON$2}var roots=[-1,-1,-1];var extrema=[-1,-1];function swapExtrema(){var tmp=extrema[0];extrema[0]=extrema[1];extrema[1]=tmp}function windingCubic(x0,y0,x1,y1,x2,y2,x3,y3,x,y){if(y>y0&&y>y1&&y>y2&&y>y3||y<y0&&y<y1&&y<y2&&y<y3){return 0}var nRoots=cubicRootAt(y0,y1,y2,y3,y,roots);if(0===nRoots){return 0}else{var w=0;var nExtrema=-1;var y0_,y1_;for(var i=0;i<nRoots;i++){var t=roots[i];var unit=0===t||1===t?0.5:1;var x_=cubicAt(x0,x1,x2,x3,t);if(x_<x){continue}if(0>nExtrema){nExtrema=cubicExtrema(y0,y1,y2,y3,extrema);if(extrema[1]<extrema[0]&&1<nExtrema){swapExtrema()}y0_=cubicAt(y0,y1,y2,y3,extrema[0]);if(1<nExtrema){y1_=cubicAt(y0,y1,y2,y3,extrema[1])}}if(2==nExtrema){if(t<extrema[0]){w+=y0_<y0?unit:-unit}else if(t<extrema[1]){w+=y1_<y0_?unit:-unit}else{w+=y3<y1_?unit:-unit}}else{if(t<extrema[0]){w+=y0_<y0?unit:-unit}else{w+=y3<y0_?unit:-unit}}}return w}}function windingQuadratic(x0,y0,x1,y1,x2,y2,x,y){if(y>y0&&y>y1&&y>y2||y<y0&&y<y1&&y<y2){return 0}var nRoots=quadraticRootAt(y0,y1,y2,y,roots);if(0===nRoots){return 0}else{var t=quadraticExtremum(y0,y1,y2);if(0<=t&&1>=t){var w=0;var y_=quadraticAt(y0,y1,y2,t);for(var i=0;i<nRoots;i++){var unit=0===roots[i]||1===roots[i]?0.5:1;var x_=quadraticAt(x0,x1,x2,roots[i]);if(x_<x){continue}if(roots[i]<t){w+=y_<y0?unit:-unit}else{w+=y2<y_?unit:-unit}}return w}else{var unit=0===roots[0]||1===roots[0]?0.5:1;var x_=quadraticAt(x0,x1,x2,roots[0]);if(x_<x){return 0}return y2<y0?unit:-unit}}}function windingArc(cx,cy,r,startAngle,endAngle,anticlockwise,x,y){y-=cy;if(y>r||y<-r){return 0}var tmp=Math.sqrt(r*r-y*y);roots[0]=-tmp;roots[1]=tmp;var diff=Math.abs(startAngle-endAngle);if(1e-4>diff){return 0}if(1e-4>diff%PI2$1){startAngle=0;endAngle=PI2$1;var dir=anticlockwise?1:-1;if(x>=roots[0]+cx&&x<=roots[1]+cx){return dir}else{return 0}}if(anticlockwise){var tmp=startAngle;startAngle=normalizeRadian(endAngle);endAngle=normalizeRadian(tmp)}else{startAngle=normalizeRadian(startAngle);endAngle=normalizeRadian(endAngle)}if(startAngle>endAngle){endAngle+=PI2$1}var w=0;for(var i=0;2>i;i++){var x_=roots[i];if(x_+cx>x){var angle=Math.atan2(y,x_);var dir=anticlockwise?1:-1;if(0>angle){angle=PI2$1+angle}if(angle>=startAngle&&angle<=endAngle||angle+PI2$1>=startAngle&&angle+PI2$1<=endAngle){if(angle>Math.PI/2&&angle<1.5*Math.PI){dir=-dir}w+=dir}}}return w}function containPath(data,lineWidth,isStroke,x,y){var w=0;var xi=0;var yi=0;var x0=0;var y0=0;for(var i=0;i<data.length;){var cmd=data[i++];if(cmd===CMD$1.M&&1<i){if(!isStroke){w+=windingLine(xi,yi,x0,y0,x,y)}}if(1==i){xi=data[i];yi=data[i+1];x0=xi;y0=yi}switch(cmd){case CMD$1.M:x0=data[i++];y0=data[i++];xi=x0;yi=y0;break;case CMD$1.L:if(isStroke){if(containStroke$1(xi,yi,data[i],data[i+1],lineWidth,x,y)){return true}}else{w+=windingLine(xi,yi,data[i],data[i+1],x,y)||0}xi=data[i++];yi=data[i++];break;case CMD$1.C:if(isStroke){if(containStroke$2(xi,yi,data[i++],data[i++],data[i++],data[i++],data[i],data[i+1],lineWidth,x,y)){return true}}else{w+=windingCubic(xi,yi,data[i++],data[i++],data[i++],data[i++],data[i],data[i+1],x,y)||0}xi=data[i++];yi=data[i++];break;case CMD$1.Q:if(isStroke){if(containStroke$3(xi,yi,data[i++],data[i++],data[i],data[i+1],lineWidth,x,y)){return true}}else{w+=windingQuadratic(xi,yi,data[i++],data[i++],data[i],data[i+1],x,y)||0}xi=data[i++];yi=data[i++];break;case CMD$1.A:var cx=data[i++];var cy=data[i++];var rx=data[i++];var ry=data[i++];var theta=data[i++];var dTheta=data[i++];var psi=data[i++];var anticlockwise=1-data[i++];var x1=Math.cos(theta)*rx+cx;var y1=Math.sin(theta)*ry+cy;if(1<i){w+=windingLine(xi,yi,x1,y1,x,y)}else{x0=x1;y0=y1}var _x=(x-cx)*ry/rx+cx;if(isStroke){if(containStroke$4(cx,cy,ry,theta,theta+dTheta,anticlockwise,lineWidth,_x,y)){return true}}else{w+=windingArc(cx,cy,ry,theta,theta+dTheta,anticlockwise,_x,y)}xi=Math.cos(theta+dTheta)*rx+cx;yi=Math.sin(theta+dTheta)*ry+cy;break;case CMD$1.R:x0=xi=data[i++];y0=yi=data[i++];var width=data[i++];var height=data[i++];var x1=x0+width;var y1=y0+height;if(isStroke){if(containStroke$1(x0,y0,x1,y0,lineWidth,x,y)||containStroke$1(x1,y0,x1,y1,lineWidth,x,y)||containStroke$1(x1,y1,x0,y1,lineWidth,x,y)||containStroke$1(x0,y1,x0,y0,lineWidth,x,y)){return true}}else{w+=windingLine(x1,y0,x1,y1,x,y);w+=windingLine(x0,y1,x0,y0,x,y)}break;case CMD$1.Z:if(isStroke){if(containStroke$1(xi,yi,x0,y0,lineWidth,x,y)){return true}}else{w+=windingLine(xi,yi,x0,y0,x,y)}xi=x0;yi=y0;break;}}if(!isStroke&&!isAroundEqual(yi,y0)){w+=windingLine(xi,yi,x0,y0,x,y)||0}return 0!==w}function contain(pathData,x,y){return containPath(pathData,0,false,x,y)}function containStroke(pathData,lineWidth,x,y){return containPath(pathData,lineWidth,true,x,y)}var getCanvasPattern=Pattern.prototype.getCanvasPattern;var abs=Math.abs;var pathProxyForDraw=new PathProxy(true);function Path(opts){Displayable.call(this,opts);this.path=null}Path.prototype={constructor:Path,type:"path",__dirtyPath:true,strokeContainThreshold:5,brush:function(ctx,prevEl){var style=this.style;var path=this.path||pathProxyForDraw;var hasStroke=style.hasStroke();var hasFill=style.hasFill();var fill=style.fill;var stroke=style.stroke;var hasFillGradient=hasFill&&!!fill.colorStops;var hasStrokeGradient=hasStroke&&!!stroke.colorStops;var hasFillPattern=hasFill&&!!fill.image;var hasStrokePattern=hasStroke&&!!stroke.image;style.bind(ctx,this,prevEl);this.setTransform(ctx);if(this.__dirty){var rect;if(hasFillGradient){rect=rect||this.getBoundingRect();this._fillGradient=style.getGradient(ctx,fill,rect)}if(hasStrokeGradient){rect=rect||this.getBoundingRect();this._strokeGradient=style.getGradient(ctx,stroke,rect)}}if(hasFillGradient){ctx.fillStyle=this._fillGradient}else if(hasFillPattern){ctx.fillStyle=getCanvasPattern.call(fill,ctx)}if(hasStrokeGradient){ctx.strokeStyle=this._strokeGradient}else if(hasStrokePattern){ctx.strokeStyle=getCanvasPattern.call(stroke,ctx)}var lineDash=style.lineDash;var lineDashOffset=style.lineDashOffset;var ctxLineDash=!!ctx.setLineDash;var scale=this.getGlobalScale();path.setScale(scale[0],scale[1]);if(this.__dirtyPath||lineDash&&!ctxLineDash&&hasStroke){path.beginPath(ctx);if(lineDash&&!ctxLineDash){path.setLineDash(lineDash);path.setLineDashOffset(lineDashOffset)}this.buildPath(path,this.shape,false);if(this.path){this.__dirtyPath=false}}else{ctx.beginPath();this.path.rebuildPath(ctx)}hasFill&&path.fill(ctx);if(lineDash&&ctxLineDash){ctx.setLineDash(lineDash);ctx.lineDashOffset=lineDashOffset}hasStroke&&path.stroke(ctx);if(lineDash&&ctxLineDash){ctx.setLineDash([])}if(null!=style.text){this.restoreTransform(ctx);this.drawRectText(ctx,this.getBoundingRect())}},buildPath:function(ctx,shapeCfg,inBundle){},createPathProxy:function(){this.path=new PathProxy},getBoundingRect:function(){var rect=this._rect;var style=this.style;var needsUpdateRect=!rect;if(needsUpdateRect){var path=this.path;if(!path){path=this.path=new PathProxy}if(this.__dirtyPath){path.beginPath();this.buildPath(path,this.shape,false)}rect=path.getBoundingRect()}this._rect=rect;if(style.hasStroke()){var rectWithStroke=this._rectWithStroke||(this._rectWithStroke=rect.clone());if(this.__dirty||needsUpdateRect){rectWithStroke.copy(rect);var w=style.lineWidth;var lineScale=style.strokeNoScale?this.getLineScale():1;if(!style.hasFill()){w=Math.max(w,this.strokeContainThreshold||4)}if(1e-10<lineScale){rectWithStroke.width+=w/lineScale;rectWithStroke.height+=w/lineScale;rectWithStroke.x-=w/lineScale/2;rectWithStroke.y-=w/lineScale/2}}return rectWithStroke}return rect},contain:function(x,y){var localPos=this.transformCoordToLocal(x,y);var rect=this.getBoundingRect();var style=this.style;x=localPos[0];y=localPos[1];if(rect.contain(x,y)){var pathData=this.path.data;if(style.hasStroke()){var lineWidth=style.lineWidth;var lineScale=style.strokeNoScale?this.getLineScale():1;if(1e-10<lineScale){if(!style.hasFill()){lineWidth=Math.max(lineWidth,this.strokeContainThreshold)}if(containStroke(pathData,lineWidth/lineScale,x,y)){return true}}}if(style.hasFill()){return contain(pathData,x,y)}}return false},dirty:function(dirtyPath){if(null==dirtyPath){dirtyPath=true}if(dirtyPath){this.__dirtyPath=dirtyPath;this._rect=null}this.__dirty=true;this.__zr&&this.__zr.refresh();if(this.__clipTarget){this.__clipTarget.dirty()}},animateShape:function(loop){return this.animate("shape",loop)},attrKV:function(key,value){if("shape"===key){this.setShape(value);this.__dirtyPath=true;this._rect=null}else{Displayable.prototype.attrKV.call(this,key,value)}},setShape:function(key,value){var shape=this.shape;if(shape){if(isObject(key)){for(var name in key){if(key.hasOwnProperty(name)){shape[name]=key[name]}}}else{shape[key]=value}this.dirty(true)}return this},getLineScale:function(){var m=this.transform;return m&&1e-10<abs(m[0]-1)&&1e-10<abs(m[3]-1)?Math.sqrt(abs(m[0]*m[3]-m[2]*m[1])):1}};Path.extend=function(defaults$$1){var Sub=function(opts){Path.call(this,opts);if(defaults$$1.style){this.style.extendFrom(defaults$$1.style,false)}var defaultShape=defaults$$1.shape;if(defaultShape){this.shape=this.shape||{};var thisShape=this.shape;for(var name in defaultShape){if(!thisShape.hasOwnProperty(name)&&defaultShape.hasOwnProperty(name)){thisShape[name]=defaultShape[name]}}}defaults$$1.init&&defaults$$1.init.call(this,opts)};inherits(Sub,Path);for(var name in defaults$$1){if("style"!==name&&"shape"!==name){Sub.prototype[name]=defaults$$1[name]}}return Sub};inherits(Path,Displayable);var CMD$2=PathProxy.CMD;var points=[[],[],[]];var mathSqrt$3=Math.sqrt;var mathAtan2=Math.atan2;var transformPath=function(path,m){var data=path.data;var cmd;var nPoint;var i;var j;var k;var p;var M=CMD$2.M;var C=CMD$2.C;var L=CMD$2.L;var R=CMD$2.R;var A=CMD$2.A;var Q=CMD$2.Q;for(i=0,j=0;i<data.length;){cmd=data[i++];j=i;nPoint=0;switch(cmd){case M:nPoint=1;break;case L:nPoint=1;break;case C:nPoint=3;break;case Q:nPoint=2;break;case A:var x=m[4];var y=m[5];var sx=mathSqrt$3(m[0]*m[0]+m[1]*m[1]);var sy=mathSqrt$3(m[2]*m[2]+m[3]*m[3]);var angle=mathAtan2(-m[1]/sy,m[0]/sx);data[i]*=sx;data[i++]+=x;data[i]*=sy;data[i++]+=y;data[i++]*=sx;data[i++]*=sy;data[i++]+=angle;data[i++]+=angle;i+=2;j=i;break;case R:p[0]=data[i++];p[1]=data[i++];applyTransform(p,p,m);data[j++]=p[0];data[j++]=p[1];p[0]+=data[i++];p[1]+=data[i++];applyTransform(p,p,m);data[j++]=p[0];data[j++]=p[1];}for(k=0;k<nPoint;k++){var p=points[k];p[0]=data[i++];p[1]=data[i++];applyTransform(p,p,m);data[j++]=p[0];data[j++]=p[1]}}};var cc=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];var mathSqrt=Math.sqrt;var mathSin=Math.sin;var mathCos=Math.cos;var PI=Math.PI;var vMag=function(v){return Math.sqrt(v[0]*v[0]+v[1]*v[1])};var vRatio=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(vMag(u)*vMag(v))};var vAngle=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(vRatio(u,v))};function processArc(x1,y1,x2,y2,fa,fs,rx,ry,psiDeg,cmd,path){var psi=psiDeg*(PI/180);var xp=mathCos(psi)*(x1-x2)/2+mathSin(psi)*(y1-y2)/2;var yp=-1*mathSin(psi)*(x1-x2)/2+mathCos(psi)*(y1-y2)/2;var lambda=xp*xp/(rx*rx)+yp*yp/(ry*ry);if(1<lambda){rx*=mathSqrt(lambda);ry*=mathSqrt(lambda)}var f=(fa===fs?-1:1)*mathSqrt((rx*rx*(ry*ry)-rx*rx*(yp*yp)-ry*ry*(xp*xp))/(rx*rx*(yp*yp)+ry*ry*(xp*xp)))||0;var cxp=f*rx*yp/ry;var cyp=f*-ry*xp/rx;var cx=(x1+x2)/2+mathCos(psi)*cxp-mathSin(psi)*cyp;var cy=(y1+y2)/2+mathSin(psi)*cxp+mathCos(psi)*cyp;var theta=vAngle([1,0],[(xp-cxp)/rx,(yp-cyp)/ry]);var u=[(xp-cxp)/rx,(yp-cyp)/ry];var v=[(-1*xp-cxp)/rx,(-1*yp-cyp)/ry];var dTheta=vAngle(u,v);if(-1>=vRatio(u,v)){dTheta=PI}if(1<=vRatio(u,v)){dTheta=0}if(0===fs&&0<dTheta){dTheta=dTheta-2*PI}if(1===fs&&0>dTheta){dTheta=dTheta+2*PI}path.addData(cmd,cx,cy,rx,ry,theta,dTheta,psi,fs)}function createPathProxyFromString(data){if(!data){return[]}var cs=data.replace(/-/g," -").replace(/  /g," ").replace(/ /g,",").replace(/,,/g,",");var n;for(n=0;n<cc.length;n++){cs=cs.replace(new RegExp(cc[n],"g"),"|"+cc[n])}var arr=cs.split("|");var cpx=0;var cpy=0;var path=new PathProxy;var CMD=PathProxy.CMD;var prevCmd;for(n=1;n<arr.length;n++){var str=arr[n];var c=str.charAt(0);var off=0;var p=str.slice(1).replace(/e,-/g,"e-").split(",");var cmd;if(0<p.length&&""===p[0]){p.shift()}for(var i=0;i<p.length;i++){p[i]=parseFloat(p[i])}while(off<p.length&&!isNaN(p[off])){if(isNaN(p[0])){break}var ctlPtx;var ctlPty;var rx;var ry;var psi;var fa;var fs;var x1=cpx;var y1=cpy;switch(c){case"l":cpx+=p[off++];cpy+=p[off++];cmd=CMD.L;path.addData(cmd,cpx,cpy);break;case"L":cpx=p[off++];cpy=p[off++];cmd=CMD.L;path.addData(cmd,cpx,cpy);break;case"m":cpx+=p[off++];cpy+=p[off++];cmd=CMD.M;path.addData(cmd,cpx,cpy);c="l";break;case"M":cpx=p[off++];cpy=p[off++];cmd=CMD.M;path.addData(cmd,cpx,cpy);c="L";break;case"h":cpx+=p[off++];cmd=CMD.L;path.addData(cmd,cpx,cpy);break;case"H":cpx=p[off++];cmd=CMD.L;path.addData(cmd,cpx,cpy);break;case"v":cpy+=p[off++];cmd=CMD.L;path.addData(cmd,cpx,cpy);break;case"V":cpy=p[off++];cmd=CMD.L;path.addData(cmd,cpx,cpy);break;case"C":cmd=CMD.C;path.addData(cmd,p[off++],p[off++],p[off++],p[off++],p[off++],p[off++]);cpx=p[off-2];cpy=p[off-1];break;case"c":cmd=CMD.C;path.addData(cmd,p[off++]+cpx,p[off++]+cpy,p[off++]+cpx,p[off++]+cpy,p[off++]+cpx,p[off++]+cpy);cpx+=p[off-2];cpy+=p[off-1];break;case"S":ctlPtx=cpx;ctlPty=cpy;var len=path.len();var pathData=path.data;if(prevCmd===CMD.C){ctlPtx+=cpx-pathData[len-4];ctlPty+=cpy-pathData[len-3]}cmd=CMD.C;x1=p[off++];y1=p[off++];cpx=p[off++];cpy=p[off++];path.addData(cmd,ctlPtx,ctlPty,x1,y1,cpx,cpy);break;case"s":ctlPtx=cpx;ctlPty=cpy;var len=path.len();var pathData=path.data;if(prevCmd===CMD.C){ctlPtx+=cpx-pathData[len-4];ctlPty+=cpy-pathData[len-3]}cmd=CMD.C;x1=cpx+p[off++];y1=cpy+p[off++];cpx+=p[off++];cpy+=p[off++];path.addData(cmd,ctlPtx,ctlPty,x1,y1,cpx,cpy);break;case"Q":x1=p[off++];y1=p[off++];cpx=p[off++];cpy=p[off++];cmd=CMD.Q;path.addData(cmd,x1,y1,cpx,cpy);break;case"q":x1=p[off++]+cpx;y1=p[off++]+cpy;cpx+=p[off++];cpy+=p[off++];cmd=CMD.Q;path.addData(cmd,x1,y1,cpx,cpy);break;case"T":ctlPtx=cpx;ctlPty=cpy;var len=path.len();var pathData=path.data;if(prevCmd===CMD.Q){ctlPtx+=cpx-pathData[len-4];ctlPty+=cpy-pathData[len-3]}cpx=p[off++];cpy=p[off++];cmd=CMD.Q;path.addData(cmd,ctlPtx,ctlPty,cpx,cpy);break;case"t":ctlPtx=cpx;ctlPty=cpy;var len=path.len();var pathData=path.data;if(prevCmd===CMD.Q){ctlPtx+=cpx-pathData[len-4];ctlPty+=cpy-pathData[len-3]}cpx+=p[off++];cpy+=p[off++];cmd=CMD.Q;path.addData(cmd,ctlPtx,ctlPty,cpx,cpy);break;case"A":rx=p[off++];ry=p[off++];psi=p[off++];fa=p[off++];fs=p[off++];x1=cpx,y1=cpy;cpx=p[off++];cpy=p[off++];cmd=CMD.A;processArc(x1,y1,cpx,cpy,fa,fs,rx,ry,psi,cmd,path);break;case"a":rx=p[off++];ry=p[off++];psi=p[off++];fa=p[off++];fs=p[off++];x1=cpx,y1=cpy;cpx+=p[off++];cpy+=p[off++];cmd=CMD.A;processArc(x1,y1,cpx,cpy,fa,fs,rx,ry,psi,cmd,path);break;}}if("z"===c||"Z"===c){cmd=CMD.Z;path.addData(cmd)}prevCmd=cmd}path.toStatic();return path}function createPathOptions(str,opts){var pathProxy=createPathProxyFromString(str);opts=opts||{};opts.buildPath=function(path){if(path.setData){path.setData(pathProxy.data);var ctx=path.getContext();if(ctx){path.rebuildPath(ctx)}}else{var ctx=path;pathProxy.rebuildPath(ctx)}};opts.applyTransform=function(m){transformPath(pathProxy,m);this.dirty(true)};return opts}function createFromString(str,opts){return new Path(createPathOptions(str,opts))}function extendFromString(str,opts){return Path.extend(createPathOptions(str,opts))}function mergePath(pathEls,opts){var pathList=[];var len=pathEls.length;for(var i=0;i<len;i++){var pathEl=pathEls[i];if(!pathEl.path){pathEl.createPathProxy()}if(pathEl.__dirtyPath){pathEl.buildPath(pathEl.path,pathEl.shape,true)}pathList.push(pathEl.path)}var pathBundle=new Path(opts);pathBundle.createPathProxy();pathBundle.buildPath=function(path){path.appendPath(pathList);var ctx=path.getContext();if(ctx){path.rebuildPath(ctx)}};return pathBundle}var path=(Object.freeze||Object)({createFromString:createFromString,extendFromString:extendFromString,mergePath:mergePath});var CompoundPath=Path.extend({type:"compound",shape:{paths:null},_updatePathDirty:function(){var dirtyPath=this.__dirtyPath;var paths=this.shape.paths;for(var i=0;i<paths.length;i++){dirtyPath=dirtyPath||paths[i].__dirtyPath}this.__dirtyPath=dirtyPath;this.__dirty=this.__dirty||dirtyPath},beforeBrush:function(){this._updatePathDirty();var paths=this.shape.paths||[];var scale=this.getGlobalScale();for(var i=0;i<paths.length;i++){if(!paths[i].path){paths[i].createPathProxy()}paths[i].path.setScale(scale[0],scale[1])}},buildPath:function(ctx,shape){var paths=shape.paths||[];for(var i=0;i<paths.length;i++){paths[i].buildPath(ctx,paths[i].shape,true)}},afterBrush:function(){var paths=this.shape.paths||[];for(var i=0;i<paths.length;i++){paths[i].__dirtyPath=false}},getBoundingRect:function(){this._updatePathDirty();return Path.prototype.getBoundingRect.call(this)}});var Text=function(opts){Displayable.call(this,opts)};Text.prototype={constructor:Text,type:"text",brush:function(ctx,prevEl){var style=this.style;this.__dirty&&normalizeTextStyle(style,true);style.fill=style.stroke=style.shadowBlur=style.shadowColor=style.shadowOffsetX=style.shadowOffsetY=null;var text=style.text;null!=text&&(text+="");style.bind(ctx,this,prevEl);if(!needDrawText(text,style)){return}this.setTransform(ctx);renderText(this,ctx,text,style);this.restoreTransform(ctx)},getBoundingRect:function(){var style=this.style;this.__dirty&&normalizeTextStyle(style,true);if(!this._rect){var text=style.text;null!=text?text+="":text="";var rect=getBoundingRect(style.text+"",style.font,style.textAlign,style.textVerticalAlign,style.textPadding,style.rich);rect.x+=style.x||0;rect.y+=style.y||0;if(getStroke(style.textStroke,style.textStrokeWidth)){var w=style.textStrokeWidth;rect.x-=w/2;rect.y-=w/2;rect.width+=w;rect.height+=w}this._rect=rect}return this._rect}};inherits(Text,Displayable);function IncrementalDisplayble(opts){Displayable.call(this,opts);this._displayables=[];this._temporaryDisplayables=[];this._cursor=0;this.notClear=true}IncrementalDisplayble.prototype.incremental=true;IncrementalDisplayble.prototype.clearDisplaybles=function(){this._displayables=[];this._temporaryDisplayables=[];this._cursor=0;this.dirty();this.notClear=false};IncrementalDisplayble.prototype.addDisplayable=function(displayable,notPersistent){if(notPersistent){this._temporaryDisplayables.push(displayable)}else{this._displayables.push(displayable)}this.dirty()};IncrementalDisplayble.prototype.addDisplayables=function(displayables,notPersistent){notPersistent=notPersistent||false;for(var i=0;i<displayables.length;i++){this.addDisplayable(displayables[i],notPersistent)}};IncrementalDisplayble.prototype.eachPendingDisplayable=function(cb){for(var i=this._cursor;i<this._displayables.length;i++){cb&&cb(this._displayables[i])}for(var i=0;i<this._temporaryDisplayables.length;i++){cb&&cb(this._temporaryDisplayables[i])}};IncrementalDisplayble.prototype.update=function(){this.updateTransform();for(var i=this._cursor;i<this._displayables.length;i++){var displayable=this._displayables[i];displayable.parent=this;displayable.update();displayable.parent=null}for(var i=0;i<this._temporaryDisplayables.length;i++){var displayable=this._temporaryDisplayables[i];displayable.parent=this;displayable.update();displayable.parent=null}};IncrementalDisplayble.prototype.brush=function(ctx,prevEl){for(var i=this._cursor;i<this._displayables.length;i++){var displayable=this._temporaryDisplayables[i];displayable.beforeBrush&&displayable.beforeBrush(ctx);displayable.brush(ctx,i===this._cursor?null:this._displayables[i-1]);displayable.afterBrush&&displayable.afterBrush(ctx)}this._cursor=i;for(var i=0;i<this._temporaryDisplayables.length;i++){var displayable=this._temporaryDisplayables[i];displayable.beforeBrush&&displayable.beforeBrush(ctx);displayable.brush(ctx,0===i?null:this._temporaryDisplayables[i-1]);displayable.afterBrush&&displayable.afterBrush(ctx)}this._temporaryDisplayables=[];this.notClear=true};var m=[];IncrementalDisplayble.prototype.getBoundingRect=function(){if(!this._rect){var rect=new BoundingRect(Infinity,Infinity,-Infinity,-Infinity);for(var i=0;i<this._displayables.length;i++){var displayable=this._displayables[i];var childRect=displayable.getBoundingRect().clone();if(displayable.needLocalTransform()){childRect.applyTransform(displayable.getLocalTransform(m))}rect.union(childRect)}this._rect=rect}return this._rect};IncrementalDisplayble.prototype.contain=function(x,y){var localPos=this.transformCoordToLocal(x,y);var rect=this.getBoundingRect();if(rect.contain(localPos[0],localPos[1])){for(var i=0;i<this._displayables.length;i++){var displayable=this._displayables[i];if(displayable.contain(x,y)){return true}}}return false};inherits(IncrementalDisplayble,Displayable);var Arc=Path.extend({type:"arc",shape:{cx:0,cy:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:true},style:{stroke:"#000",fill:null},buildPath:function(ctx,shape){var x=shape.cx;var y=shape.cy;var r=Math.max(shape.r,0);var startAngle=shape.startAngle;var endAngle=shape.endAngle;var clockwise=shape.clockwise;var unitX=Math.cos(startAngle);var unitY=Math.sin(startAngle);ctx.moveTo(unitX*r+x,unitY*r+y);ctx.arc(x,y,r,startAngle,endAngle,!clockwise)}});var out=[];function someVectorAt(shape,t,isTangent){var cpx2=shape.cpx2;var cpy2=shape.cpy2;if(null===cpx2||null===cpy2){return[(isTangent?cubicDerivativeAt:cubicAt)(shape.x1,shape.cpx1,shape.cpx2,shape.x2,t),(isTangent?cubicDerivativeAt:cubicAt)(shape.y1,shape.cpy1,shape.cpy2,shape.y2,t)]}else{return[(isTangent?quadraticDerivativeAt:quadraticAt)(shape.x1,shape.cpx1,shape.x2,t),(isTangent?quadraticDerivativeAt:quadraticAt)(shape.y1,shape.cpy1,shape.y2,t)]}}var BezierCurve=Path.extend({type:"bezier-curve",shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(ctx,shape){var x1=shape.x1;var y1=shape.y1;var x2=shape.x2;var y2=shape.y2;var cpx1=shape.cpx1;var cpy1=shape.cpy1;var cpx2=shape.cpx2;var cpy2=shape.cpy2;var percent=shape.percent;if(0===percent){return}ctx.moveTo(x1,y1);if(null==cpx2||null==cpy2){if(1>percent){quadraticSubdivide(x1,cpx1,x2,percent,out);cpx1=out[1];x2=out[2];quadraticSubdivide(y1,cpy1,y2,percent,out);cpy1=out[1];y2=out[2]}ctx.quadraticCurveTo(cpx1,cpy1,x2,y2)}else{if(1>percent){cubicSubdivide(x1,cpx1,cpx2,x2,percent,out);cpx1=out[1];cpx2=out[2];x2=out[3];cubicSubdivide(y1,cpy1,cpy2,y2,percent,out);cpy1=out[1];cpy2=out[2];y2=out[3]}ctx.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,x2,y2)}},pointAt:function(t){return someVectorAt(this.shape,t,false)},tangentAt:function(t){var p=someVectorAt(this.shape,t,true);return normalize(p,p)}});var Circle=Path.extend({type:"circle",shape:{cx:0,cy:0,r:0},buildPath:function(ctx,shape,inBundle){if(inBundle){ctx.moveTo(shape.cx+shape.r,shape.cy)}ctx.arc(shape.cx,shape.cy,shape.r,0,2*Math.PI,true)}});var Droplet=Path.extend({type:"droplet",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(ctx,shape){var x=shape.cx;var y=shape.cy;var a=shape.width;var b=shape.height;ctx.moveTo(x,y+a);ctx.bezierCurveTo(x+a,y+a,x+3*a/2,y-a/3,x,y-b);ctx.bezierCurveTo(x-3*a/2,y-a/3,x-a,y+a,x,y+a);ctx.closePath()}});var Ellipse=Path.extend({type:"ellipse",shape:{cx:0,cy:0,rx:0,ry:0},buildPath:function(ctx,shape){var k=0.5522848;var x=shape.cx;var y=shape.cy;var a=shape.rx;var b=shape.ry;var ox=a*k;var oy=b*k;ctx.moveTo(x-a,y);ctx.bezierCurveTo(x-a,y-oy,x-ox,y-b,x,y-b);ctx.bezierCurveTo(x+ox,y-b,x+a,y-oy,x+a,y);ctx.bezierCurveTo(x+a,y+oy,x+ox,y+b,x,y+b);ctx.bezierCurveTo(x-ox,y+b,x-a,y+oy,x-a,y);ctx.closePath()}});var Heart=Path.extend({type:"heart",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(ctx,shape){var x=shape.cx;var y=shape.cy;var a=shape.width;var b=shape.height;ctx.moveTo(x,y);ctx.bezierCurveTo(x+a/2,y-2*b/3,x+2*a,y+b/3,x,y+b);ctx.bezierCurveTo(x-2*a,y+b/3,x-a/2,y-2*b/3,x,y)}});var PI$1=Math.PI;var sin=Math.sin;var cos=Math.cos;var Isogon=Path.extend({type:"isogon",shape:{x:0,y:0,r:0,n:0},buildPath:function(ctx,shape){var n=shape.n;if(!n||2>n){return}var x=shape.x;var y=shape.y;var r=shape.r;var dStep=2*PI$1/n;var deg=-PI$1/2;ctx.moveTo(x+r*cos(deg),y+r*sin(deg));for(var i=0,end=n-1;i<end;i++){deg+=dStep;ctx.lineTo(x+r*cos(deg),y+r*sin(deg))}ctx.closePath();return}});var Line=Path.extend({type:"line",shape:{x1:0,y1:0,x2:0,y2:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(ctx,shape){var x1=shape.x1;var y1=shape.y1;var x2=shape.x2;var y2=shape.y2;var percent=shape.percent;if(0===percent){return}ctx.moveTo(x1,y1);if(1>percent){x2=x1*(1-percent)+x2*percent;y2=y1*(1-percent)+y2*percent}ctx.lineTo(x2,y2)},pointAt:function(p){var shape=this.shape;return[shape.x1*(1-p)+shape.x2*p,shape.y1*(1-p)+shape.y2*p]}});function interpolate(p0,p1,p2,p3,t,t2,t3){var v0=0.5*(p2-p0);var v1=0.5*(p3-p1);return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1}var smoothSpline=function(points,isLoop){var len$$1=points.length;var ret=[];var distance$$1=0;for(var i=1;i<len$$1;i++){distance$$1+=distance(points[i-1],points[i])}var segs=distance$$1/2;segs=segs<len$$1?len$$1:segs;for(var i=0;i<segs;i++){var pos=i/(segs-1)*(isLoop?len$$1:len$$1-1);var idx=Math.floor(pos);var w=pos-idx;var p0;var p1=points[idx%len$$1];var p2;var p3;if(!isLoop){p0=points[0===idx?idx:idx-1];p2=points[idx>len$$1-2?len$$1-1:idx+1];p3=points[idx>len$$1-3?len$$1-1:idx+2]}else{p0=points[(idx-1+len$$1)%len$$1];p2=points[(idx+1)%len$$1];p3=points[(idx+2)%len$$1]}var w2=w*w;var w3=w*w2;ret.push([interpolate(p0[0],p1[0],p2[0],p3[0],w,w2,w3),interpolate(p0[1],p1[1],p2[1],p3[1],w,w2,w3)])}return ret};var smoothBezier=function(points,smooth,isLoop,constraint){var cps=[];var v=[];var v1=[];var v2=[];var prevPoint;var nextPoint;var min$$1,max$$1;if(constraint){min$$1=[Infinity,Infinity];max$$1=[-Infinity,-Infinity];for(var i=0,len$$1=points.length;i<len$$1;i++){min(min$$1,min$$1,points[i]);max(max$$1,max$$1,points[i])}min(min$$1,min$$1,constraint[0]);max(max$$1,max$$1,constraint[1])}for(var i=0,len$$1=points.length;i<len$$1;i++){var point=points[i];if(isLoop){prevPoint=points[i?i-1:len$$1-1];nextPoint=points[(i+1)%len$$1]}else{if(0===i||i===len$$1-1){cps.push(clone$1(points[i]));continue}else{prevPoint=points[i-1];nextPoint=points[i+1]}}sub(v,nextPoint,prevPoint);scale(v,v,smooth);var d0=distance(point,prevPoint);var d1=distance(point,nextPoint);var sum=d0+d1;if(0!==sum){d0/=sum;d1/=sum}scale(v1,v,-d0);scale(v2,v,d1);var cp0=add([],point,v1);var cp1=add([],point,v2);if(constraint){max(cp0,cp0,min$$1);min(cp0,cp0,max$$1);max(cp1,cp1,min$$1);min(cp1,cp1,max$$1)}cps.push(cp0);cps.push(cp1)}if(isLoop){cps.push(cps.shift())}return cps};function buildPath$1(ctx,shape,closePath){var points=shape.points;var smooth=shape.smooth;if(points&&2<=points.length){if(smooth&&"spline"!==smooth){var controlPoints=smoothBezier(points,smooth,closePath,shape.smoothConstraint);ctx.moveTo(points[0][0],points[0][1]);var len=points.length;for(var i=0;i<(closePath?len:len-1);i++){var cp1=controlPoints[2*i];var cp2=controlPoints[2*i+1];var p=points[(i+1)%len];ctx.bezierCurveTo(cp1[0],cp1[1],cp2[0],cp2[1],p[0],p[1])}}else{if("spline"===smooth){points=smoothSpline(points,closePath)}var len=points.length;if(!shape.lineType||"solid"==shape.lineType){ctx.moveTo(points[0][0],points[0][1]);for(var i=1;i<len;i++){ctx.lineTo(points[i][0],points[i][1])}}else if("dashed"==shape.lineType||"dotted"==shape.lineType){var dashLength=(shape.lineWidth||1)*("dashed"==shape.lineType?5:1);ctx.moveTo(points[0][0],points[0][1]);for(var i=1;i<len;i++){dashedLineTo(ctx,points[i-1][0],points[i-1][1],points[i][0],points[i][1],dashLength)}}else if("dashed&solid"==shape.lineType){var prevStart=false;for(var i=0;i<points.length;i++){var point=points[i];if(0==i){if("end"!=point[2]){ctx.moveTo(point[0],point[1])}}else{var lastStep=points[i-1];if(lastStep[2]){if("start"==lastStep[2]){ctx.lineTo(point[0],point[1])}else if("end"==lastStep[2]){ctx.moveTo(point[0],point[1])}else if("middle"==lastStep[2]){if(isVisibleMiddle(i-1)){ctx.lineTo(point[0],point[1])}else{ctx.moveTo(point[0],point[1])}}}else{if(isVisibleMiddle(i-1)){ctx.lineTo(point[0],point[1])}else{ctx.moveTo(point[0],point[1])}}}}}}function isVisibleMiddle(i){for(i=i-1;0<=i;i--){var point=points[i];if(!["start","end"].includes(point[2]))continue;if("start"==point[2]){return true}else{break}}return false}closePath&&ctx.closePath()}}var Polygon=Path.extend({type:"polygon",shape:{points:null,smooth:false,smoothConstraint:null},buildPath:function(ctx,shape){buildPath$1(ctx,shape,true)}});var Polyline=Path.extend({type:"polyline",shape:{points:null,smooth:false,smoothConstraint:null},style:{stroke:"#000",fill:null},buildPath:function(ctx,shape){buildPath$1(ctx,shape,false)}});var Rect=Path.extend({type:"rect",shape:{r:0,x:0,y:0,width:0,height:0},buildPath:function(ctx,shape){var x=shape.x;var y=shape.y;var width=shape.width;var height=shape.height;if(!shape.r){ctx.rect(x,y,width,height)}else{buildPath(ctx,shape)}ctx.closePath();return}});var Ring=Path.extend({type:"ring",shape:{cx:0,cy:0,r:0,r0:0},buildPath:function(ctx,shape){var x=shape.cx;var y=shape.cy;var PI2=2*Math.PI;ctx.moveTo(x+shape.r,y);ctx.arc(x,y,shape.r,0,PI2,false);ctx.moveTo(x+shape.r0,y);ctx.arc(x,y,shape.r0,0,PI2,true)}});var sin$1=Math.sin;var cos$1=Math.cos;var radian=Math.PI/180;var Rose=Path.extend({type:"rose",shape:{cx:0,cy:0,r:[],k:0,n:1},style:{stroke:"#000",fill:null},buildPath:function(ctx,shape){var x;var y;var R=shape.r;var r;var k=shape.k;var n=shape.n;var x0=shape.cx;var y0=shape.cy;ctx.moveTo(x0,y0);for(var i=0,len=R.length;i<len;i++){r=R[i];for(var j=0;j<=360*n;j++){x=r*sin$1(k/n*j%360*radian)*cos$1(j*radian)+x0;y=r*sin$1(k/n*j%360*radian)*sin$1(j*radian)+y0;ctx.lineTo(x,y)}}}});var shadowTemp=[["shadowBlur",0],["shadowColor","#000"],["shadowOffsetX",0],["shadowOffsetY",0]];var fixClipWithShadow=function(orignalBrush){return env$1.browser.ie&&11<=env$1.browser.version?function(){var clipPaths=this.__clipPaths;var style=this.style;var modified;if(clipPaths){for(var i=0;i<clipPaths.length;i++){var clipPath=clipPaths[i];var shape=clipPath&&clipPath.shape;var type=clipPath&&clipPath.type;if(shape&&("sector"===type&&shape.startAngle===shape.endAngle||"rect"===type&&(!shape.width||!shape.height))){for(var j=0;j<shadowTemp.length;j++){shadowTemp[j][2]=style[shadowTemp[j][0]];style[shadowTemp[j][0]]=shadowTemp[j][1]}modified=true;break}}}orignalBrush.apply(this,arguments);if(modified){for(var j=0;j<shadowTemp.length;j++){style[shadowTemp[j][0]]=shadowTemp[j][2]}}}:orignalBrush};var Sector=Path.extend({type:"sector",shape:{cx:0,cy:0,r0:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:true},brush:fixClipWithShadow(Path.prototype.brush),buildPath:function(ctx,shape){var x=shape.cx;var y=shape.cy;var r0=Math.max(shape.r0||0,0);var r=Math.max(shape.r,0);var startAngle=shape.startAngle;var endAngle=shape.endAngle;var clockwise=shape.clockwise;var unitX=Math.cos(startAngle);var unitY=Math.sin(startAngle);ctx.moveTo(unitX*r0+x,unitY*r0+y);ctx.lineTo(unitX*r+x,unitY*r+y);ctx.arc(x,y,r,startAngle,endAngle,!clockwise);ctx.lineTo(Math.cos(endAngle)*r0+x,Math.sin(endAngle)*r0+y);if(0!==r0){ctx.arc(x,y,r0,endAngle,startAngle,clockwise)}ctx.closePath()}});var PI$2=Math.PI;var cos$2=Math.cos;var sin$2=Math.sin;var Star=Path.extend({type:"star",shape:{cx:0,cy:0,n:3,r0:null,r:0},buildPath:function(ctx,shape){var n=shape.n;if(!n||2>n){return}var x=shape.cx;var y=shape.cy;var r=shape.r;var r0=shape.r0;if(null==r0){r0=4<n?r*cos$2(2*PI$2/n)/cos$2(PI$2/n):r/3}var dStep=PI$2/n;var deg=-PI$2/2;var xStart=x+r*cos$2(deg);var yStart=y+r*sin$2(deg);deg+=dStep;ctx.moveTo(xStart,yStart);for(var i=0,end=2*n-1,ri;i<end;i++){ri=0===i%2?r0:r;ctx.lineTo(x+ri*cos$2(deg),y+ri*sin$2(deg));deg+=dStep}ctx.closePath()}});var cos$3=Math.cos;var sin$3=Math.sin;var Trochoid=Path.extend({type:"trochoid",shape:{cx:0,cy:0,r:0,r0:0,d:0,location:"out"},style:{stroke:"#000",fill:null},buildPath:function(ctx,shape){var x1;var y1;var x2;var y2;var R=shape.r;var r=shape.r0;var d=shape.d;var offsetX=shape.cx;var offsetY=shape.cy;var delta="out"==shape.location?1:-1;if(shape.location&&R<=r){return}var num=0;var i=1;var theta;x1=(R+delta*r)*cos$3(0)-delta*d*cos$3(0)+offsetX;y1=(R+delta*r)*sin$3(0)-d*sin$3(0)+offsetY;ctx.moveTo(x1,y1);do{num++}while(0!==r*num%(R+delta*r));do{theta=Math.PI/180*i;x2=(R+delta*r)*cos$3(theta)-delta*d*cos$3((R/r+delta)*theta)+offsetX;y2=(R+delta*r)*sin$3(theta)-d*sin$3((R/r+delta)*theta)+offsetY;ctx.lineTo(x2,y2);i++}while(i<=360*(r*num/(R+delta*r)))}});var Gradient=function(colorStops){this.colorStops=colorStops||[]};Gradient.prototype={constructor:Gradient,addColorStop:function(offset,color){this.colorStops.push({offset:offset,color:color})}};var LinearGradient=function(x,y,x2,y2,colorStops,globalCoord){this.x=null==x?0:x;this.y=null==y?0:y;this.x2=null==x2?1:x2;this.y2=null==y2?0:y2;this.type="linear";this.global=globalCoord||false;Gradient.call(this,colorStops)};LinearGradient.prototype={constructor:LinearGradient};inherits(LinearGradient,Gradient);var RadialGradient=function(x,y,r,colorStops,globalCoord){this.x=null==x?0.5:x;this.y=null==y?0.5:y;this.r=null==r?0.5:r;this.type="radial";this.global=globalCoord||false;Gradient.call(this,colorStops)};RadialGradient.prototype={constructor:RadialGradient};inherits(RadialGradient,Gradient);var svgURI="http://www.w3.org/2000/svg";function createElement(name){return document.createElementNS(svgURI,name)}var CMD$3=PathProxy.CMD;var arrayJoin=Array.prototype.join;var NONE="none";var mathRound=Math.round;var mathSin$3=Math.sin;var mathCos$3=Math.cos;var PI$3=Math.PI;var PI2$4=2*Math.PI;var degree=180/PI$3;var EPSILON$3=1e-4;function round4(val){return mathRound(1e4*val)/1e4}function isAroundZero$1(val){return val<EPSILON$3&&val>-EPSILON$3}function pathHasFill(style,isText){var fill=isText?style.textFill:style.fill;return null!=fill&&fill!==NONE}function pathHasStroke(style,isText){var stroke=isText?style.textStroke:style.stroke;return null!=stroke&&stroke!==NONE}function setTransform(svgEl,m){if(m){attr(svgEl,"transform","matrix("+arrayJoin.call(m,",")+")")}}function attr(el,key,val){if(!val||"linear"!==val.type&&"radial"!==val.type){el.setAttribute(key,val)}}function attrXLink(el,key,val){el.setAttributeNS("http://www.w3.org/1999/xlink",key,val)}function bindStyle(svgEl,style,isText){if(pathHasFill(style,isText)){var fill=isText?style.textFill:style.fill;fill="transparent"===fill?NONE:fill;if("none"!==svgEl.getAttribute("clip-path")&&fill===NONE){fill="rgba(0, 0, 0, 0.002)"}attr(svgEl,"fill",fill);attr(svgEl,"fill-opacity",style.opacity)}else{attr(svgEl,"fill",NONE)}if(pathHasStroke(style,isText)){var stroke=isText?style.textStroke:style.stroke;stroke="transparent"===stroke?NONE:stroke;attr(svgEl,"stroke",stroke);var strokeWidth=isText?style.textStrokeWidth:style.lineWidth;var strokeScale=!isText&&style.strokeNoScale?style.host.getLineScale():1;attr(svgEl,"stroke-width",strokeWidth/strokeScale);attr(svgEl,"paint-order",isText?"stroke":"fill");attr(svgEl,"stroke-opacity",style.opacity);var lineDash=style.lineDash;if(lineDash){attr(svgEl,"stroke-dasharray",style.lineDash.join(","));attr(svgEl,"stroke-dashoffset",mathRound(style.lineDashOffset||0))}else{attr(svgEl,"stroke-dasharray","")}style.lineCap&&attr(svgEl,"stroke-linecap",style.lineCap);style.lineJoin&&attr(svgEl,"stroke-linejoin",style.lineJoin);style.miterLimit&&attr(svgEl,"stroke-miterlimit",style.miterLimit)}else{attr(svgEl,"stroke",NONE)}}function pathDataToString(path){var str=[];var data=path.data;var dataLength=path.len();for(var i=0;i<dataLength;){var cmd=data[i++];var cmdStr="";var nData=0;switch(cmd){case CMD$3.M:cmdStr="M";nData=2;break;case CMD$3.L:cmdStr="L";nData=2;break;case CMD$3.Q:cmdStr="Q";nData=4;break;case CMD$3.C:cmdStr="C";nData=6;break;case CMD$3.A:var cx=data[i++];var cy=data[i++];var rx=data[i++];var ry=data[i++];var theta=data[i++];var dTheta=data[i++];var psi=data[i++];var clockwise=data[i++];var dThetaPositive=Math.abs(dTheta);var isCircle=isAroundZero$1(dThetaPositive-PI2$4)&&!isAroundZero$1(dThetaPositive);var large=false;if(dThetaPositive>=PI2$4){large=true}else if(isAroundZero$1(dThetaPositive)){large=false}else{large=(dTheta>-PI$3&&0>dTheta||dTheta>PI$3)===!!clockwise}var x0=round4(cx+rx*mathCos$3(theta));var y0=round4(cy+ry*mathSin$3(theta));if(isCircle){if(clockwise){dTheta=PI2$4-1e-4}else{dTheta=-PI2$4+1e-4}large=true;if(9===i){str.push("M",x0,y0)}}var x=round4(cx+rx*mathCos$3(theta+dTheta));var y=round4(cy+ry*mathSin$3(theta+dTheta));str.push("A",round4(rx),round4(ry),mathRound(psi*degree),+large,+clockwise,x,y);break;case CMD$3.Z:cmdStr="Z";break;case CMD$3.R:var x=round4(data[i++]);var y=round4(data[i++]);var w=round4(data[i++]);var h=round4(data[i++]);str.push("M",x,y,"L",x+w,y,"L",x+w,y+h,"L",x,y+h,"L",x,y);break;}cmdStr&&str.push(cmdStr);for(var j=0;j<nData;j++){str.push(round4(data[i++]))}}return str.join(" ")}var svgPath={};svgPath.brush=function(el){var style=el.style;var svgEl=el.__svgEl;if(!svgEl){svgEl=createElement("path");el.__svgEl=svgEl}if(!el.path){el.createPathProxy()}var path=el.path;if(el.__dirtyPath){path.beginPath();el.buildPath(path,el.shape);el.__dirtyPath=false;var pathStr=pathDataToString(path);if(0>pathStr.indexOf("NaN")){attr(svgEl,"d",pathStr)}}bindStyle(svgEl,style);setTransform(svgEl,el.transform);if(null!=style.text){svgTextDrawRectText(el,el.getBoundingRect())}};var svgImage={};svgImage.brush=function(el){var style=el.style;var image=style.image;if(image instanceof HTMLImageElement){var src=image.src;image=src}if(!image){return}var x=style.x||0;var y=style.y||0;var dw=style.width;var dh=style.height;var svgEl=el.__svgEl;if(!svgEl){svgEl=createElement("image");el.__svgEl=svgEl}if(image!==el.__imageSrc){attrXLink(svgEl,"href",image);el.__imageSrc=image}attr(svgEl,"width",dw);attr(svgEl,"height",dh);attr(svgEl,"x",x);attr(svgEl,"y",y);setTransform(svgEl,el.transform);if(null!=style.text){svgTextDrawRectText(el,el.getBoundingRect())}};var svgText={};var tmpRect$2=new BoundingRect;var svgTextDrawRectText=function(el,rect,textRect){var style=el.style;el.__dirty&&normalizeTextStyle(style,true);var text=style.text;if(null==text){return}else{text+=""}var textSvgEl=el.__textSvgEl;if(!textSvgEl){textSvgEl=createElement("text");el.__textSvgEl=textSvgEl}var x;var y;var textPosition=style.textPosition;var distance=style.textDistance;var align=style.textAlign||"left";if("number"===typeof style.fontSize){style.fontSize+="px"}var font=style.font||[style.fontStyle||"",style.fontWeight||"",style.fontSize||"",style.fontFamily||""].join(" ")||DEFAULT_FONT;var verticalAlign=getVerticalAlignForSvg(style.textVerticalAlign);textRect=getBoundingRect(text,font,align,verticalAlign);var lineHeight=textRect.lineHeight;if(textPosition instanceof Array){x=rect.x+textPosition[0];y=rect.y+textPosition[1]}else{var newPos=adjustTextPositionOnRect(textPosition,rect,distance);x=newPos.x;y=newPos.y;verticalAlign=getVerticalAlignForSvg(newPos.textVerticalAlign);align=newPos.textAlign}attr(textSvgEl,"alignment-baseline",verticalAlign);if(font){textSvgEl.style.font=font}var textPadding=style.textPadding;attr(textSvgEl,"x",x);attr(textSvgEl,"y",y);bindStyle(textSvgEl,style,true);if(el instanceof Text||el.style.transformText){setTransform(textSvgEl,el.transform)}else{if(el.transform){tmpRect$2.copy(rect);tmpRect$2.applyTransform(el.transform);rect=tmpRect$2}else{var pos=el.transformCoordToGlobal(rect.x,rect.y);rect.x=pos[0];rect.y=pos[1]}var origin=style.textOrigin;if("center"===origin){x=textRect.width/2+x;y=textRect.height/2+y}else if(origin){x=origin[0]+x;y=origin[1]+y}var rotate=180*-style.textRotation/Math.PI;attr(textSvgEl,"transform","rotate("+rotate+","+x+","+y+")")}var textLines=text.split("\n");var nTextLines=textLines.length;var textAnchor=align;if("left"===textAnchor){textAnchor="start";textPadding&&(x+=textPadding[3])}else if("right"===textAnchor){textAnchor="end";textPadding&&(x-=textPadding[1])}else if("center"===textAnchor){textAnchor="middle";textPadding&&(x+=(textPadding[3]-textPadding[1])/2)}var dy=0;if("baseline"===verticalAlign){dy=-textRect.height+lineHeight;textPadding&&(dy-=textPadding[2])}else if("middle"===verticalAlign){dy=(-textRect.height+lineHeight)/2;textPadding&&(y+=(textPadding[0]-textPadding[2])/2)}else{textPadding&&(dy+=textPadding[0])}if(el.__text!==text||el.__textFont!==font){var tspanList=el.__tspanList||[];el.__tspanList=tspanList;for(var i=0;i<nTextLines;i++){var tspan=tspanList[i];if(!tspan){tspan=tspanList[i]=createElement("tspan");textSvgEl.appendChild(tspan);attr(tspan,"alignment-baseline",verticalAlign);attr(tspan,"text-anchor",textAnchor)}else{tspan.innerHTML=""}attr(tspan,"x",x);attr(tspan,"y",y+i*lineHeight+dy);tspan.appendChild(document.createTextNode(textLines[i]))}for(;i<tspanList.length;i++){textSvgEl.removeChild(tspanList[i])}tspanList.length=nTextLines;el.__text=text;el.__textFont=font}else if(el.__tspanList.length){var len=el.__tspanList.length;for(var i=0;i<len;++i){var tspan=el.__tspanList[i];if(tspan){attr(tspan,"x",x);attr(tspan,"y",y+i*lineHeight+dy)}}}};function getVerticalAlignForSvg(verticalAlign){if("middle"===verticalAlign){return"middle"}else if("bottom"===verticalAlign){return"baseline"}else{return"hanging"}}svgText.drawRectText=svgTextDrawRectText;svgText.brush=function(el){var style=el.style;if(null!=style.text){style.textPosition=[0,0];svgTextDrawRectText(el,{x:style.x||0,y:style.y||0,width:0,height:0},el.getBoundingRect())}};function Diff(){}Diff.prototype={diff:function(oldArr,newArr,equals){if(!equals){equals=function(a,b){return a===b}}this.equals=equals;var self=this;oldArr=oldArr.slice();newArr=newArr.slice();var newLen=newArr.length;var oldLen=oldArr.length;var editLength=1;var maxEditLength=newLen+oldLen;var bestPath=[{newPos:-1,components:[]}];var oldPos=this.extractCommon(bestPath[0],newArr,oldArr,0);if(bestPath[0].newPos+1>=newLen&&oldPos+1>=oldLen){var indices=[];for(var i=0;i<newArr.length;i++){indices.push(i)}return[{indices:indices,count:newArr.length}]}function execEditLength(){for(var diagonalPath=-1*editLength;diagonalPath<=editLength;diagonalPath+=2){var basePath;var addPath=bestPath[diagonalPath-1];var removePath=bestPath[diagonalPath+1];var oldPos=(removePath?removePath.newPos:0)-diagonalPath;if(addPath){bestPath[diagonalPath-1]=undefined}var canAdd=addPath&&addPath.newPos+1<newLen;var canRemove=removePath&&0<=oldPos&&oldPos<oldLen;if(!canAdd&&!canRemove){bestPath[diagonalPath]=undefined;continue}if(!canAdd||canRemove&&addPath.newPos<removePath.newPos){basePath=clonePath(removePath);self.pushComponent(basePath.components,undefined,true)}else{basePath=addPath;basePath.newPos++;self.pushComponent(basePath.components,true,undefined)}oldPos=self.extractCommon(basePath,newArr,oldArr,diagonalPath);if(basePath.newPos+1>=newLen&&oldPos+1>=oldLen){return buildValues(self,basePath.components,newArr,oldArr)}else{bestPath[diagonalPath]=basePath}}editLength++}while(editLength<=maxEditLength){var ret=execEditLength();if(ret){return ret}}},pushComponent:function(components,added,removed){var last=components[components.length-1];if(last&&last.added===added&&last.removed===removed){components[components.length-1]={count:last.count+1,added:added,removed:removed}}else{components.push({count:1,added:added,removed:removed})}},extractCommon:function(basePath,newArr,oldArr,diagonalPath){var newLen=newArr.length;var oldLen=oldArr.length;var newPos=basePath.newPos;var oldPos=newPos-diagonalPath;var commonCount=0;while(newPos+1<newLen&&oldPos+1<oldLen&&this.equals(newArr[newPos+1],oldArr[oldPos+1])){newPos++;oldPos++;commonCount++}if(commonCount){basePath.components.push({count:commonCount})}basePath.newPos=newPos;return oldPos},tokenize:function(value){return value.slice()},join:function(value){return value.slice()}};function buildValues(diff,components,newArr,oldArr){var componentPos=0;var componentLen=components.length;var newPos=0;var oldPos=0;for(;componentPos<componentLen;componentPos++){var component=components[componentPos];if(!component.removed){var indices=[];for(var i=newPos;i<newPos+component.count;i++){indices.push(i)}component.indices=indices;newPos+=component.count;if(!component.added){oldPos+=component.count}}else{var indices=[];for(var i=oldPos;i<oldPos+component.count;i++){indices.push(i)}component.indices=indices;oldPos+=component.count}}return components}function clonePath(path){return{newPos:path.newPos,components:path.components.slice(0)}}var arrayDiff=new Diff;var arrayDiff$1=function(oldArr,newArr,callback){return arrayDiff.diff(oldArr,newArr,callback)};var MARK_UNUSED="0";var MARK_USED="1";function Definable(zrId,svgRoot,tagNames,markLabel,domName){this._zrId=zrId;this._svgRoot=svgRoot;this._tagNames="string"===typeof tagNames?[tagNames]:tagNames;this._markLabel=markLabel;this._domName=domName||"_dom";this.nextId=0}Definable.prototype.createElement=createElement;Definable.prototype.getDefs=function(isForceCreating){var svgRoot=this._svgRoot;var defs=this._svgRoot.getElementsByTagName("defs");if(0===defs.length){if(isForceCreating){defs=svgRoot.insertBefore(this.createElement("defs"),svgRoot.firstChild);if(!defs.contains){defs.contains=function(el){var children=defs.children;if(!children){return false}for(var i=children.length-1;0<=i;--i){if(children[i]===el){return true}}return false}}return defs}else{return null}}else{return defs[0]}};Definable.prototype.update=function(element,onUpdate){if(!element){return}var defs=this.getDefs(false);if(element[this._domName]&&defs.contains(element[this._domName])){if("function"===typeof onUpdate){onUpdate(element)}}else{var dom=this.add(element);if(dom){element[this._domName]=dom}}};Definable.prototype.addDom=function(dom){var defs=this.getDefs(true);defs.appendChild(dom)};Definable.prototype.removeDom=function(element){var defs=this.getDefs(false);if(defs&&element[this._domName]){defs.removeChild(element[this._domName]);element[this._domName]=null}};Definable.prototype.getDoms=function(){var defs=this.getDefs(false);if(!defs){return[]}var doms=[];each(this._tagNames,function(tagName){var tags=defs.getElementsByTagName(tagName);doms=doms.concat([].slice.call(tags))});return doms};Definable.prototype.markAllUnused=function(){var doms=this.getDoms();var that=this;each(doms,function(dom){dom[that._markLabel]=MARK_UNUSED})};Definable.prototype.markUsed=function(dom){if(dom){dom[this._markLabel]=MARK_USED}};Definable.prototype.removeUnused=function(){var defs=this.getDefs(false);if(!defs){return}var doms=this.getDoms();var that=this;each(doms,function(dom){if(dom[that._markLabel]!==MARK_USED){defs.removeChild(dom)}})};Definable.prototype.getSvgProxy=function(displayable){if(displayable instanceof Path){return svgPath}else if(displayable instanceof ZImage){return svgImage}else if(displayable instanceof Text){return svgText}else{return svgPath}};Definable.prototype.getTextSvgElement=function(displayable){return displayable.__textSvgEl};Definable.prototype.getSvgElement=function(displayable){return displayable.__svgEl};function GradientManager(zrId,svgRoot){Definable.call(this,zrId,svgRoot,["linearGradient","radialGradient"],"__gradient_in_use__")}inherits(GradientManager,Definable);GradientManager.prototype.addWithoutUpdate=function(svgElement,displayable){if(displayable&&displayable.style){var that=this;each(["fill","stroke"],function(fillOrStroke){if(displayable.style[fillOrStroke]&&("linear"===displayable.style[fillOrStroke].type||"radial"===displayable.style[fillOrStroke].type)){var gradient=displayable.style[fillOrStroke];var defs=that.getDefs(true);var dom;if(gradient._dom){dom=gradient._dom;if(!defs.contains(gradient._dom)){that.addDom(dom)}}else{dom=that.add(gradient)}that.markUsed(displayable);var id=dom.getAttribute("id");svgElement.setAttribute(fillOrStroke,"url(#"+id+")")}})}};GradientManager.prototype.add=function(gradient){var dom;if("linear"===gradient.type){dom=this.createElement("linearGradient")}else if("radial"===gradient.type){dom=this.createElement("radialGradient")}else{zrLog("Illegal gradient type.");return null}gradient.id=gradient.id||this.nextId++;dom.setAttribute("id","zr"+this._zrId+"-gradient-"+gradient.id);this.updateDom(gradient,dom);this.addDom(dom);return dom};GradientManager.prototype.update=function(gradient){var that=this;Definable.prototype.update.call(this,gradient,function(){var type=gradient.type;var tagName=gradient._dom.tagName;if("linear"===type&&"linearGradient"===tagName||"radial"===type&&"radialGradient"===tagName){that.updateDom(gradient,gradient._dom)}else{that.removeDom(gradient);that.add(gradient)}})};GradientManager.prototype.updateDom=function(gradient,dom){if("linear"===gradient.type){dom.setAttribute("x1",gradient.x);dom.setAttribute("y1",gradient.y);dom.setAttribute("x2",gradient.x2);dom.setAttribute("y2",gradient.y2)}else if("radial"===gradient.type){dom.setAttribute("cx",gradient.x);dom.setAttribute("cy",gradient.y);dom.setAttribute("r",gradient.r)}else{zrLog("Illegal gradient type.");return}if(gradient.global){dom.setAttribute("gradientUnits","userSpaceOnUse")}else{dom.setAttribute("gradientUnits","objectBoundingBox")}dom.innerHTML="";var colors=gradient.colorStops;for(var i=0,len=colors.length;i<len;++i){var stop=this.createElement("stop");stop.setAttribute("offset",100*colors[i].offset+"%");stop.setAttribute("stop-color",colors[i].color);dom.appendChild(stop)}gradient._dom=dom};GradientManager.prototype.markUsed=function(displayable){if(displayable.style){var gradient=displayable.style.fill;if(gradient&&gradient._dom){Definable.prototype.markUsed.call(this,gradient._dom)}gradient=displayable.style.stroke;if(gradient&&gradient._dom){Definable.prototype.markUsed.call(this,gradient._dom)}}};function ClippathManager(zrId,svgRoot){Definable.call(this,zrId,svgRoot,"clipPath","__clippath_in_use__")}inherits(ClippathManager,Definable);ClippathManager.prototype.update=function(displayable){var svgEl=this.getSvgElement(displayable);if(svgEl){this.updateDom(svgEl,displayable.__clipPaths,false)}var textEl=this.getTextSvgElement(displayable);if(textEl){this.updateDom(textEl,displayable.__clipPaths,true)}this.markUsed(displayable)};ClippathManager.prototype.updateDom=function(parentEl,clipPaths,isText){if(clipPaths&&0<clipPaths.length){var defs=this.getDefs(true);var clipPath=clipPaths[0];var clipPathEl;var id;var dom=isText?"_textDom":"_dom";if(clipPath[dom]){id=clipPath[dom].getAttribute("id");clipPathEl=clipPath[dom];if(!defs.contains(clipPathEl)){defs.appendChild(clipPathEl)}}else{id="zr"+this._zrId+"-clip-"+this.nextId;++this.nextId;clipPathEl=this.createElement("clipPath");clipPathEl.setAttribute("id",id);defs.appendChild(clipPathEl);clipPath[dom]=clipPathEl}var svgProxy=this.getSvgProxy(clipPath);if(clipPath.transform&&clipPath.parent.invTransform&&!isText){var transform=Array.prototype.slice.call(clipPath.transform);mul$1(clipPath.transform,clipPath.parent.invTransform,clipPath.transform);svgProxy.brush(clipPath);clipPath.transform=transform}else{svgProxy.brush(clipPath)}var pathEl=this.getSvgElement(clipPath);clipPathEl.innerHTML="";clipPathEl.appendChild(pathEl.cloneNode());parentEl.setAttribute("clip-path","url(#"+id+")");if(1<clipPaths.length){this.updateDom(clipPathEl,clipPaths.slice(1),isText)}}else{if(parentEl){parentEl.setAttribute("clip-path","none")}}};ClippathManager.prototype.markUsed=function(displayable){var that=this;if(displayable.__clipPaths&&0<displayable.__clipPaths.length){each(displayable.__clipPaths,function(clipPath){if(clipPath._dom){Definable.prototype.markUsed.call(that,clipPath._dom)}if(clipPath._textDom){Definable.prototype.markUsed.call(that,clipPath._textDom)}})}};function ShadowManager(zrId,svgRoot){Definable.call(this,zrId,svgRoot,["filter"],"__filter_in_use__","_shadowDom")}inherits(ShadowManager,Definable);ShadowManager.prototype.addWithoutUpdate=function(svgElement,displayable){if(displayable&&hasShadow(displayable.style)){var style=displayable.style;var dom;if(style._shadowDom){dom=style._shadowDom;var defs=this.getDefs(true);if(!defs.contains(style._shadowDom)){this.addDom(dom)}}else{dom=this.add(displayable)}this.markUsed(displayable);var id=dom.getAttribute("id");svgElement.style.filter="url(#"+id+")"}};ShadowManager.prototype.add=function(displayable){var dom=this.createElement("filter");var style=displayable.style;style._shadowDomId=style._shadowDomId||this.nextId++;dom.setAttribute("id","zr"+this._zrId+"-shadow-"+style._shadowDomId);this.updateDom(displayable,dom);this.addDom(dom);return dom};ShadowManager.prototype.update=function(svgElement,displayable){var style=displayable.style;if(hasShadow(style)){var that=this;Definable.prototype.update.call(this,displayable,function(style){that.updateDom(displayable,style._shadowDom)})}else{this.remove(svgElement,style)}};ShadowManager.prototype.remove=function(svgElement,style){if(null!=style._shadowDomId){this.removeDom(style);svgElement.style.filter=""}};ShadowManager.prototype.updateDom=function(displayable,dom){var domChild=dom.getElementsByTagName("feDropShadow");if(0===domChild.length){domChild=this.createElement("feDropShadow")}else{domChild=domChild[0]}var style=displayable.style;var scaleX=displayable.scale?displayable.scale[0]||1:1;var scaleY=displayable.scale?displayable.scale[1]||1:1;var offsetX,offsetY,blur,color;if(style.shadowBlur||style.shadowOffsetX||style.shadowOffsetY){offsetX=style.shadowOffsetX||0;offsetY=style.shadowOffsetY||0;blur=style.shadowBlur;color=style.shadowColor}else if(style.textShadowBlur){offsetX=style.textShadowOffsetX||0;offsetY=style.textShadowOffsetY||0;blur=style.textShadowBlur;color=style.textShadowColor}else{this.removeDom(dom,style);return}domChild.setAttribute("dx",offsetX/scaleX);domChild.setAttribute("dy",offsetY/scaleY);domChild.setAttribute("flood-color",color);var stdDx=blur/2/scaleX;var stdDy=blur/2/scaleY;var stdDeviation=stdDx+" "+stdDy;domChild.setAttribute("stdDeviation",stdDeviation);dom.setAttribute("x","-100%");dom.setAttribute("y","-100%");dom.setAttribute("width",Math.ceil(200*(blur/2))+"%");dom.setAttribute("height",Math.ceil(200*(blur/2))+"%");dom.appendChild(domChild);style._shadowDom=dom};ShadowManager.prototype.markUsed=function(displayable){var style=displayable.style;if(style&&style._shadowDom){Definable.prototype.markUsed.call(this,style._shadowDom)}};function hasShadow(style){return style&&(style.shadowBlur||style.shadowOffsetX||style.shadowOffsetY||style.textShadowBlur||style.textShadowOffsetX||style.textShadowOffsetY)}function parseInt10$1(val){return parseInt(val,10)}function getSvgProxy(el){if(el instanceof Path){return svgPath}else if(el instanceof ZImage){return svgImage}else if(el instanceof Text){return svgText}else{return svgPath}}function checkParentAvailable(parent,child){return child&&parent&&child.parentNode!==parent}function insertAfter(parent,child,prevSibling){if(checkParentAvailable(parent,child)&&prevSibling){var nextSibling=prevSibling.nextSibling;nextSibling?parent.insertBefore(child,nextSibling):parent.appendChild(child)}}function prepend(parent,child){if(checkParentAvailable(parent,child)){var firstChild=parent.firstChild;firstChild?parent.insertBefore(child,firstChild):parent.appendChild(child)}}function remove(parent,child){if(child&&parent&&child.parentNode===parent){parent.removeChild(child)}}function getTextSvgElement(displayable){return displayable.__textSvgEl}function getSvgElement(displayable){return displayable.__svgEl}var SVGPainter=function(root,storage,opts,zrId){this.root=root;this.storage=storage;this._opts=opts=extend({},opts||{});var svgRoot=createElement("svg");svgRoot.setAttribute("xmlns","http://www.w3.org/2000/svg");svgRoot.setAttribute("version","1.1");svgRoot.setAttribute("baseProfile","full");svgRoot.style.cssText="user-select:none;position:absolute;left:0;top:0;";this.gradientManager=new GradientManager(zrId,svgRoot);this.clipPathManager=new ClippathManager(zrId,svgRoot);this.shadowManager=new ShadowManager(zrId,svgRoot);var viewport=document.createElement("div");viewport.style.cssText="overflow:hidden;position:relative";this._svgRoot=svgRoot;this._viewport=viewport;root.appendChild(viewport);viewport.appendChild(svgRoot);this.resize(opts.width,opts.height);this._visibleList=[]};SVGPainter.prototype={constructor:SVGPainter,getType:function(){return"svg"},getViewportRoot:function(){return this._viewport},getViewportRootOffset:function(){var viewportRoot=this.getViewportRoot();if(viewportRoot){return{offsetLeft:viewportRoot.offsetLeft||0,offsetTop:viewportRoot.offsetTop||0}}},refresh:function(){var list=this.storage.getDisplayList(true);this._paintList(list)},setBackgroundColor:function(backgroundColor){this._viewport.style.background=backgroundColor},_paintList:function(list){this.gradientManager.markAllUnused();this.clipPathManager.markAllUnused();this.shadowManager.markAllUnused();var svgRoot=this._svgRoot;var visibleList=this._visibleList;var listLen=list.length;var newVisibleList=[];var i;for(i=0;i<listLen;i++){var displayable=list[i];var svgProxy=getSvgProxy(displayable);var svgElement=getSvgElement(displayable)||getTextSvgElement(displayable);if(!displayable.invisible){if(displayable.__dirty){svgProxy&&svgProxy.brush(displayable);this.clipPathManager.update(displayable);if(displayable.style){this.gradientManager.update(displayable.style.fill);this.gradientManager.update(displayable.style.stroke);this.shadowManager.update(svgElement,displayable)}displayable.__dirty=false}newVisibleList.push(displayable)}}var diff=arrayDiff$1(visibleList,newVisibleList);var prevSvgElement;for(i=0;i<diff.length;i++){var item=diff[i];if(item.removed){for(var k=0;k<item.count;k++){var displayable=visibleList[item.indices[k]];var svgElement=getSvgElement(displayable);var textSvgElement=getTextSvgElement(displayable);remove(svgRoot,svgElement);remove(svgRoot,textSvgElement)}}}for(i=0;i<diff.length;i++){var item=diff[i];if(item.added){for(var k=0;k<item.count;k++){var displayable=newVisibleList[item.indices[k]];var svgElement=getSvgElement(displayable);var textSvgElement=getTextSvgElement(displayable);prevSvgElement?insertAfter(svgRoot,svgElement,prevSvgElement):prepend(svgRoot,svgElement);if(svgElement){insertAfter(svgRoot,textSvgElement,svgElement)}else if(prevSvgElement){insertAfter(svgRoot,textSvgElement,prevSvgElement)}else{prepend(svgRoot,textSvgElement)}insertAfter(svgRoot,textSvgElement,svgElement);prevSvgElement=textSvgElement||svgElement||prevSvgElement;this.gradientManager.addWithoutUpdate(svgElement,displayable);this.shadowManager.addWithoutUpdate(prevSvgElement,displayable);this.clipPathManager.markUsed(displayable)}}else if(!item.removed){for(var k=0;k<item.count;k++){var displayable=newVisibleList[item.indices[k]];prevSvgElement=svgElement=getTextSvgElement(displayable)||getSvgElement(displayable)||prevSvgElement;this.gradientManager.markUsed(displayable);this.gradientManager.addWithoutUpdate(svgElement,displayable);this.shadowManager.markUsed(displayable);this.shadowManager.addWithoutUpdate(svgElement,displayable);this.clipPathManager.markUsed(displayable)}}}this.gradientManager.removeUnused();this.clipPathManager.removeUnused();this.shadowManager.removeUnused();this._visibleList=newVisibleList},_getDefs:function(isForceCreating){var svgRoot=this._svgRoot;var defs=this._svgRoot.getElementsByTagName("defs");if(0===defs.length){if(isForceCreating){var defs=svgRoot.insertBefore(createElement("defs"),svgRoot.firstChild);if(!defs.contains){defs.contains=function(el){var children=defs.children;if(!children){return false}for(var i=children.length-1;0<=i;--i){if(children[i]===el){return true}}return false}}return defs}else{return null}}else{return defs[0]}},resize:function(width,height){var viewport=this._viewport;viewport.style.display="none";var opts=this._opts;null!=width&&(opts.width=width);null!=height&&(opts.height=height);width=this._getSize(0);height=this._getSize(1);viewport.style.display="";if(this._width!==width||this._height!==height){this._width=width;this._height=height;var viewportStyle=viewport.style;viewportStyle.width=width+"px";viewportStyle.height=height+"px";var svgRoot=this._svgRoot;svgRoot.setAttribute("width",width);svgRoot.setAttribute("height",height)}},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(whIdx){var opts=this._opts;var wh=["width","height"][whIdx];var cwh=["clientWidth","clientHeight"][whIdx];var plt=["paddingLeft","paddingTop"][whIdx];var prb=["paddingRight","paddingBottom"][whIdx];if(null!=opts[wh]&&"auto"!==opts[wh]){return parseFloat(opts[wh])}var root=this.root;var stl=document.defaultView.getComputedStyle(root);return 0|(root[cwh]||parseInt10$1(stl[wh])||parseInt10$1(root.style[wh]))-(parseInt10$1(stl[plt])||0)-(parseInt10$1(stl[prb])||0)},dispose:function(){this.root.innerHTML="";this._svgRoot=this._viewport=this.storage=null},clear:function(){if(this._viewport){this.root.removeChild(this._viewport)}},pathToDataUrl:function(){this.refresh();var html=this._svgRoot.outerHTML;return"data:image/svg+xml;charset=UTF-8,"+html}};function createMethodNotSupport(method){return function(){zrLog("In SVG mode painter not support method \""+method+"\"")}}each(["getLayer","insertLayer","eachLayer","eachBuiltinLayer","eachOtherLayer","getLayers","modLayer","delLayer","clearLayer","toDataURL","pathToImage"],function(name){SVGPainter.prototype[name]=createMethodNotSupport(name)});registerPainter("svg",SVGPainter);var urn="urn:schemas-microsoft-com:vml";var win="undefined"===typeof window?null:window;var vmlInited=false;var doc=win&&win.document;function createNode(tagName){return doCreateNode(tagName)}var doCreateNode;if(doc&&!env$1.canvasSupported){try{!doc.namespaces.zrvml&&doc.namespaces.add("zrvml",urn);doCreateNode=function(tagName){return doc.createElement("<zrvml:"+tagName+" class=\"zrvml\">")}}catch(e){doCreateNode=function(tagName){return doc.createElement("<"+tagName+" xmlns=\""+urn+"\" class=\"zrvml\">")}}}function initVML(){if(vmlInited||!doc){return}vmlInited=true;var styleSheets=doc.styleSheets;if(31>styleSheets.length){doc.createStyleSheet().addRule(".zrvml","behavior:url(#default#VML)")}else{styleSheets[0].addRule(".zrvml","behavior:url(#default#VML)")}}var CMD$4=PathProxy.CMD;var round=Math.round;var sqrt=Math.sqrt;var abs$1=Math.abs;var cos$4=Math.cos;var sin$4=Math.sin;var mathMax$3=Math.max;if(!env$1.canvasSupported){var comma=",";var imageTransformPrefix="progid:DXImageTransform.Microsoft";var Z=21600;var Z2=Z/2;var ZLEVEL_BASE=100000;var Z_BASE=1000;var initRootElStyle=function(el){el.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px;";el.coordsize=Z+","+Z;el.coordorigin="0,0"};var encodeHtmlAttribute=function(s){return String(s).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};var rgb2Str=function(r,g,b){return"rgb("+[r,g,b].join(",")+")"};var append$1=function(parent,child){if(child&&parent&&child.parentNode!==parent){parent.appendChild(child)}};var remove$1=function(parent,child){if(child&&parent&&child.parentNode===parent){parent.removeChild(child)}};var getZIndex=function(zlevel,z,z2){return(parseFloat(zlevel)||0)*ZLEVEL_BASE+(parseFloat(z)||0)*Z_BASE+z2};var parsePercent$1=function(value,maxValue){if("string"===typeof value){if(0<=value.lastIndexOf("%")){return parseFloat(value)/100*maxValue}return parseFloat(value)}return value};var setColorAndOpacity=function(el,color,opacity){var colorArr=parse(color);opacity=+opacity;if(isNaN(opacity)){opacity=1}if(colorArr){el.color=rgb2Str(colorArr[0],colorArr[1],colorArr[2]);el.opacity=opacity*colorArr[3]}};var getColorAndAlpha=function(color){var colorArr=parse(color);return[rgb2Str(colorArr[0],colorArr[1],colorArr[2]),colorArr[3]]};var updateFillNode=function(el,style,zrEl){var fill=style.fill;if(null!=fill){if(fill instanceof Gradient){var gradientType;var angle=0;var focus=[0,0];var shift=0;var expansion=1;var rect=zrEl.getBoundingRect();var rectWidth=rect.width;var rectHeight=rect.height;if("linear"===fill.type){gradientType="gradient";var transform=zrEl.transform;var p0=[fill.x*rectWidth,fill.y*rectHeight];var p1=[fill.x2*rectWidth,fill.y2*rectHeight];if(transform){applyTransform(p0,p0,transform);applyTransform(p1,p1,transform)}var dx=p1[0]-p0[0];var dy=p1[1]-p0[1];angle=180*Math.atan2(dx,dy)/Math.PI;if(0>angle){angle+=360}if(1e-6>angle){angle=0}}else{gradientType="gradientradial";var p0=[fill.x*rectWidth,fill.y*rectHeight];var transform=zrEl.transform;var scale$$1=zrEl.scale;var width=rectWidth;var height=rectHeight;focus=[(p0[0]-rect.x)/width,(p0[1]-rect.y)/height];if(transform){applyTransform(p0,p0,transform)}width/=scale$$1[0]*Z;height/=scale$$1[1]*Z;var dimension=mathMax$3(width,height);shift=0*2/dimension;expansion=2*fill.r/dimension-shift}var stops=fill.colorStops.slice();stops.sort(function(cs1,cs2){return cs1.offset-cs2.offset});var length$$1=stops.length;var colorAndAlphaList=[];var colors=[];for(var i=0;i<length$$1;i++){var stop=stops[i];var colorAndAlpha=getColorAndAlpha(stop.color);colors.push(stop.offset*expansion+shift+" "+colorAndAlpha[0]);if(0===i||i===length$$1-1){colorAndAlphaList.push(colorAndAlpha)}}if(2<=length$$1){var color1=colorAndAlphaList[0][0];var color2=colorAndAlphaList[1][0];var opacity1=colorAndAlphaList[0][1]*style.opacity;var opacity2=colorAndAlphaList[1][1]*style.opacity;el.type=gradientType;el.method="none";el.focus="100%";el.angle=angle;el.color=color1;el.color2=color2;el.colors=colors.join(",");el.opacity=opacity2;el.opacity2=opacity1}if("radial"===gradientType){el.focusposition=focus.join(",")}}else{setColorAndOpacity(el,fill,style.opacity)}}};var updateStrokeNode=function(el,style){if(null!=style.lineDash){el.dashstyle=style.lineDash.join(" ")}if(null!=style.stroke&&!(style.stroke instanceof Gradient)){setColorAndOpacity(el,style.stroke,style.opacity)}};var updateFillAndStroke=function(vmlEl,type,style,zrEl){var isFill="fill"==type;var el=vmlEl.getElementsByTagName(type)[0];if(null!=style[type]&&"none"!==style[type]&&(isFill||!isFill&&style.lineWidth)){vmlEl[isFill?"filled":"stroked"]="true";if(style[type]instanceof Gradient){remove$1(vmlEl,el)}if(!el){el=createNode(type)}isFill?updateFillNode(el,style,zrEl):updateStrokeNode(el,style);append$1(vmlEl,el)}else{vmlEl[isFill?"filled":"stroked"]="false";remove$1(vmlEl,el)}};var points$1=[[],[],[]];var pathDataToString$1=function(path,m){var M=CMD$4.M;var C=CMD$4.C;var L=CMD$4.L;var A=CMD$4.A;var Q=CMD$4.Q;var str=[];var nPoint;var cmdStr;var cmd;var i;var xi;var yi;var data=path.data;var dataLength=path.len();for(i=0;i<dataLength;){cmd=data[i++];cmdStr="";nPoint=0;switch(cmd){case M:cmdStr=" m ";nPoint=1;xi=data[i++];yi=data[i++];points$1[0][0]=xi;points$1[0][1]=yi;break;case L:cmdStr=" l ";nPoint=1;xi=data[i++];yi=data[i++];points$1[0][0]=xi;points$1[0][1]=yi;break;case Q:case C:cmdStr=" c ";nPoint=3;var x1=data[i++];var y1=data[i++];var x2=data[i++];var y2=data[i++];var x3;var y3;if(cmd===Q){x3=x2;y3=y2;x2=(x2+2*x1)/3;y2=(y2+2*y1)/3;x1=(xi+2*x1)/3;y1=(yi+2*y1)/3}else{x3=data[i++];y3=data[i++]}points$1[0][0]=x1;points$1[0][1]=y1;points$1[1][0]=x2;points$1[1][1]=y2;points$1[2][0]=x3;points$1[2][1]=y3;xi=x3;yi=y3;break;case A:var x=0;var y=0;var sx=1;var sy=1;var angle=0;if(m){x=m[4];y=m[5];sx=sqrt(m[0]*m[0]+m[1]*m[1]);sy=sqrt(m[2]*m[2]+m[3]*m[3]);angle=Math.atan2(-m[1]/sy,m[0]/sx)}var cx=data[i++];var cy=data[i++];var rx=data[i++];var ry=data[i++];var startAngle=data[i++]+angle;var endAngle=data[i++]+startAngle+angle;i++;var clockwise=data[i++];var x0=cx+cos$4(startAngle)*rx;var y0=cy+sin$4(startAngle)*ry;var x1=cx+cos$4(endAngle)*rx;var y1=cy+sin$4(endAngle)*ry;var type=clockwise?" wa ":" at ";if(1e-4>Math.abs(x0-x1)){if(0.01<Math.abs(endAngle-startAngle)){if(clockwise){x0+=270/Z}}else{if(1e-4>Math.abs(y0-cy)){if(clockwise&&x0<cx||!clockwise&&x0>cx){y1-=270/Z}else{y1+=270/Z}}else if(clockwise&&y0<cy||!clockwise&&y0>cy){x1+=270/Z}else{x1-=270/Z}}}str.push(type,round(((cx-rx)*sx+x)*Z-Z2),comma,round(((cy-ry)*sy+y)*Z-Z2),comma,round(((cx+rx)*sx+x)*Z-Z2),comma,round(((cy+ry)*sy+y)*Z-Z2),comma,round((x0*sx+x)*Z-Z2),comma,round((y0*sy+y)*Z-Z2),comma,round((x1*sx+x)*Z-Z2),comma,round((y1*sy+y)*Z-Z2));xi=x1;yi=y1;break;case CMD$4.R:var p0=points$1[0];var p1=points$1[1];p0[0]=data[i++];p0[1]=data[i++];p1[0]=p0[0]+data[i++];p1[1]=p0[1]+data[i++];if(m){applyTransform(p0,p0,m);applyTransform(p1,p1,m)}p0[0]=round(p0[0]*Z-Z2);p1[0]=round(p1[0]*Z-Z2);p0[1]=round(p0[1]*Z-Z2);p1[1]=round(p1[1]*Z-Z2);str.push(" m ",p0[0],comma,p0[1]," l ",p1[0],comma,p0[1]," l ",p1[0],comma,p1[1]," l ",p0[0],comma,p1[1]);break;case CMD$4.Z:str.push(" x ");}if(0<nPoint){str.push(cmdStr);for(var k=0;k<nPoint;k++){var p=points$1[k];m&&applyTransform(p,p,m);str.push(round(p[0]*Z-Z2),comma,round(p[1]*Z-Z2),k<nPoint-1?comma:"")}}}return str.join("")};Path.prototype.brushVML=function(vmlRoot){var style=this.style;var vmlEl=this._vmlEl;if(!vmlEl){vmlEl=createNode("shape");initRootElStyle(vmlEl);this._vmlEl=vmlEl}updateFillAndStroke(vmlEl,"fill",style,this);updateFillAndStroke(vmlEl,"stroke",style,this);var m=this.transform;var needTransform=null!=m;var strokeEl=vmlEl.getElementsByTagName("stroke")[0];if(strokeEl){var lineWidth=style.lineWidth;if(needTransform&&!style.strokeNoScale){var det=m[0]*m[3]-m[1]*m[2];lineWidth*=sqrt(abs$1(det))}strokeEl.weight=lineWidth+"px"}var path=this.path||(this.path=new PathProxy);if(this.__dirtyPath){path.beginPath();this.buildPath(path,this.shape);path.toStatic();this.__dirtyPath=false}vmlEl.path=pathDataToString$1(path,this.transform);vmlEl.style.zIndex=getZIndex(this.zlevel,this.z,this.z2);append$1(vmlRoot,vmlEl);if(null!=style.text){this.drawRectText(vmlRoot,this.getBoundingRect())}else{this.removeRectText(vmlRoot)}};Path.prototype.onRemove=function(vmlRoot){remove$1(vmlRoot,this._vmlEl);this.removeRectText(vmlRoot)};Path.prototype.onAdd=function(vmlRoot){append$1(vmlRoot,this._vmlEl);this.appendRectText(vmlRoot)};var isImage=function(img){return"object"===typeof img&&img.tagName&&"IMG"===img.tagName.toUpperCase()};ZImage.prototype.brushVML=function(vmlRoot){var style=this.style;var image=style.image;var ow;var oh;if(isImage(image)){var src=image.src;if(src===this._imageSrc){ow=this._imageWidth;oh=this._imageHeight}else{var imageRuntimeStyle=image.runtimeStyle;var oldRuntimeWidth=imageRuntimeStyle.width;var oldRuntimeHeight=imageRuntimeStyle.height;imageRuntimeStyle.width="auto";imageRuntimeStyle.height="auto";ow=image.width;oh=image.height;imageRuntimeStyle.width=oldRuntimeWidth;imageRuntimeStyle.height=oldRuntimeHeight;this._imageSrc=src;this._imageWidth=ow;this._imageHeight=oh}image=src}else{if(image===this._imageSrc){ow=this._imageWidth;oh=this._imageHeight}}if(!image){return}var x=style.x||0;var y=style.y||0;var dw=style.width;var dh=style.height;var sw=style.sWidth;var sh=style.sHeight;var sx=style.sx||0;var sy=style.sy||0;var hasCrop=sw&&sh;var vmlEl=this._vmlEl;if(!vmlEl){vmlEl=doc.createElement("div");initRootElStyle(vmlEl);this._vmlEl=vmlEl}var vmlElStyle=vmlEl.style;var hasRotation=false;var m;var scaleX=1;var scaleY=1;if(this.transform){m=this.transform;scaleX=sqrt(m[0]*m[0]+m[1]*m[1]);scaleY=sqrt(m[2]*m[2]+m[3]*m[3]);hasRotation=m[1]||m[2]}if(hasRotation){var p0=[x,y];var p1=[x+dw,y];var p2=[x,y+dh];var p3=[x+dw,y+dh];applyTransform(p0,p0,m);applyTransform(p1,p1,m);applyTransform(p2,p2,m);applyTransform(p3,p3,m);var maxX=mathMax$3(p0[0],p1[0],p2[0],p3[0]);var maxY=mathMax$3(p0[1],p1[1],p2[1],p3[1]);var transformFilter=[];transformFilter.push("M11=",m[0]/scaleX,comma,"M12=",m[2]/scaleY,comma,"M21=",m[1]/scaleX,comma,"M22=",m[3]/scaleY,comma,"Dx=",round(x*scaleX+m[4]),comma,"Dy=",round(y*scaleY+m[5]));vmlElStyle.padding="0 "+round(maxX)+"px "+round(maxY)+"px 0";vmlElStyle.filter=imageTransformPrefix+".Matrix("+transformFilter.join("")+", SizingMethod=clip)"}else{if(m){x=x*scaleX+m[4];y=y*scaleY+m[5]}vmlElStyle.filter="";vmlElStyle.left=round(x)+"px";vmlElStyle.top=round(y)+"px"}var imageEl=this._imageEl;var cropEl=this._cropEl;if(!imageEl){imageEl=doc.createElement("div");this._imageEl=imageEl}var imageELStyle=imageEl.style;if(hasCrop){if(!(ow&&oh)){var tmpImage=new Image;var self=this;tmpImage.onload=function(){tmpImage.onload=null;ow=tmpImage.width;oh=tmpImage.height;imageELStyle.width=round(scaleX*ow*dw/sw)+"px";imageELStyle.height=round(scaleY*oh*dh/sh)+"px";self._imageWidth=ow;self._imageHeight=oh;self._imageSrc=image};tmpImage.src=image}else{imageELStyle.width=round(scaleX*ow*dw/sw)+"px";imageELStyle.height=round(scaleY*oh*dh/sh)+"px"}if(!cropEl){cropEl=doc.createElement("div");cropEl.style.overflow="hidden";this._cropEl=cropEl}var cropElStyle=cropEl.style;cropElStyle.width=round((dw+sx*dw/sw)*scaleX);cropElStyle.height=round((dh+sy*dh/sh)*scaleY);cropElStyle.filter=imageTransformPrefix+".Matrix(Dx="+-sx*dw/sw*scaleX+",Dy="+-sy*dh/sh*scaleY+")";if(!cropEl.parentNode){vmlEl.appendChild(cropEl)}if(imageEl.parentNode!=cropEl){cropEl.appendChild(imageEl)}}else{imageELStyle.width=round(scaleX*dw)+"px";imageELStyle.height=round(scaleY*dh)+"px";vmlEl.appendChild(imageEl);if(cropEl&&cropEl.parentNode){vmlEl.removeChild(cropEl);this._cropEl=null}}var filterStr="";var alpha=style.opacity;if(1>alpha){filterStr+=".Alpha(opacity="+round(100*alpha)+") "}filterStr+=imageTransformPrefix+".AlphaImageLoader(src="+image+", SizingMethod=scale)";imageELStyle.filter=filterStr;vmlEl.style.zIndex=getZIndex(this.zlevel,this.z,this.z2);append$1(vmlRoot,vmlEl);if(null!=style.text){this.drawRectText(vmlRoot,this.getBoundingRect())}};ZImage.prototype.onRemove=function(vmlRoot){remove$1(vmlRoot,this._vmlEl);this._vmlEl=null;this._cropEl=null;this._imageEl=null;this.removeRectText(vmlRoot)};ZImage.prototype.onAdd=function(vmlRoot){append$1(vmlRoot,this._vmlEl);this.appendRectText(vmlRoot)};var DEFAULT_STYLE_NORMAL="normal";var fontStyleCache={};var fontStyleCacheCount=0;var MAX_FONT_CACHE_SIZE=100;var fontEl=document.createElement("div");var getFontStyle=function(fontString){var fontStyle=fontStyleCache[fontString];if(!fontStyle){if(fontStyleCacheCount>MAX_FONT_CACHE_SIZE){fontStyleCacheCount=0;fontStyleCache={}}var style=fontEl.style;var fontFamily;try{style.font=fontString;fontFamily=style.fontFamily.split(",")[0]}catch(e){}fontStyle={style:style.fontStyle||DEFAULT_STYLE_NORMAL,variant:style.fontVariant||DEFAULT_STYLE_NORMAL,weight:style.fontWeight||DEFAULT_STYLE_NORMAL,size:0|parseFloat(style.fontSize||12),family:fontFamily||"Microsoft YaHei"};fontStyleCache[fontString]=fontStyle;fontStyleCacheCount++}return fontStyle};var textMeasureEl;$override$1("measureText",function(text,textFont){var doc$$1=doc;if(!textMeasureEl){textMeasureEl=doc$$1.createElement("div");textMeasureEl.style.cssText="position:absolute;top:-20000px;left:0;"+"padding:0;margin:0;border:none;white-space:pre;";doc.body.appendChild(textMeasureEl)}try{textMeasureEl.style.font=textFont}catch(ex){}textMeasureEl.innerHTML="";textMeasureEl.appendChild(doc$$1.createTextNode(text));return{width:textMeasureEl.offsetWidth}});var tmpRect$3=new BoundingRect;var drawRectText=function(vmlRoot,rect,textRect,fromTextEl){var style=this.style;this.__dirty&&normalizeTextStyle(style,true);var text=style.text;null!=text&&(text+="");if(!text){return}if(style.rich){var contentBlock=parseRichText(text,style);text=[];for(var i=0;i<contentBlock.lines.length;i++){var tokens=contentBlock.lines[i].tokens;var textLine=[];for(var j=0;j<tokens.length;j++){textLine.push(tokens[j].text)}text.push(textLine.join(""))}text=text.join("\n")}var x;var y;var align=style.textAlign;var verticalAlign=style.textVerticalAlign;var fontStyle=getFontStyle(style.font);var font=fontStyle.style+" "+fontStyle.variant+" "+fontStyle.weight+" "+fontStyle.size+"px \""+fontStyle.family+"\"";textRect=textRect||getBoundingRect(text,font,align,verticalAlign);var m=this.transform;if(m&&!fromTextEl){tmpRect$3.copy(rect);tmpRect$3.applyTransform(m);rect=tmpRect$3}if(!fromTextEl){var textPosition=style.textPosition;var distance$$1=style.textDistance;if(textPosition instanceof Array){x=rect.x+parsePercent$1(textPosition[0],rect.width);y=rect.y+parsePercent$1(textPosition[1],rect.height);align=align||"left"}else{var res=adjustTextPositionOnRect(textPosition,rect,distance$$1);x=res.x;y=res.y;align=align||res.textAlign;verticalAlign=verticalAlign||res.textVerticalAlign}}else{x=rect.x;y=rect.y}x=adjustTextX(x,textRect.width,align);y=adjustTextY(y,textRect.height,verticalAlign);y+=textRect.height/2;var createNode$$1=createNode;var textVmlEl=this._textVmlEl;var pathEl;var textPathEl;var skewEl;if(!textVmlEl){textVmlEl=createNode$$1("line");pathEl=createNode$$1("path");textPathEl=createNode$$1("textpath");skewEl=createNode$$1("skew");textPathEl.style["v-text-align"]="left";initRootElStyle(textVmlEl);pathEl.textpathok=true;textPathEl.on=true;textVmlEl.from="0 0";textVmlEl.to="1000 0.05";append$1(textVmlEl,skewEl);append$1(textVmlEl,pathEl);append$1(textVmlEl,textPathEl);this._textVmlEl=textVmlEl}else{skewEl=textVmlEl.firstChild;pathEl=skewEl.nextSibling;textPathEl=pathEl.nextSibling}var coords=[x,y];var textVmlElStyle=textVmlEl.style;if(m&&fromTextEl){applyTransform(coords,coords,m);skewEl.on=true;skewEl.matrix=m[0].toFixed(3)+comma+m[2].toFixed(3)+comma+m[1].toFixed(3)+comma+m[3].toFixed(3)+",0,0";skewEl.offset=(round(coords[0])||0)+","+(round(coords[1])||0);skewEl.origin="0 0";textVmlElStyle.left="0px";textVmlElStyle.top="0px"}else{skewEl.on=false;textVmlElStyle.left=round(x)+"px";textVmlElStyle.top=round(y)+"px"}textPathEl.string=encodeHtmlAttribute(text);try{textPathEl.style.font=font}catch(e){}updateFillAndStroke(textVmlEl,"fill",{fill:style.textFill,opacity:style.opacity},this);updateFillAndStroke(textVmlEl,"stroke",{stroke:style.textStroke,opacity:style.opacity,lineDash:style.lineDash},this);textVmlEl.style.zIndex=getZIndex(this.zlevel,this.z,this.z2);append$1(vmlRoot,textVmlEl)};var removeRectText=function(vmlRoot){remove$1(vmlRoot,this._textVmlEl);this._textVmlEl=null};var appendRectText=function(vmlRoot){append$1(vmlRoot,this._textVmlEl)};var list=[RectText,Displayable,ZImage,Path,Text];for(var i$1=0;i$1<list.length;i$1++){var proto=list[i$1].prototype;proto.drawRectText=drawRectText;proto.removeRectText=removeRectText;proto.appendRectText=appendRectText}Text.prototype.brushVML=function(vmlRoot){var style=this.style;if(null!=style.text){this.drawRectText(vmlRoot,{x:style.x||0,y:style.y||0,width:0,height:0},this.getBoundingRect(),true)}else{this.removeRectText(vmlRoot)}};Text.prototype.onRemove=function(vmlRoot){this.removeRectText(vmlRoot)};Text.prototype.onAdd=function(vmlRoot){this.appendRectText(vmlRoot)}}function parseInt10$2(val){return parseInt(val,10)}function VMLPainter(root,storage){initVML();this.root=root;this.storage=storage;var vmlViewport=document.createElement("div");var vmlRoot=document.createElement("div");vmlViewport.style.cssText="display:inline-block;overflow:hidden;position:relative;width:300px;height:150px;";vmlRoot.style.cssText="position:absolute;left:0;top:0;";root.appendChild(vmlViewport);this._vmlRoot=vmlRoot;this._vmlViewport=vmlViewport;this.resize();var oldDelFromStorage=storage.delFromStorage;var oldAddToStorage=storage.addToStorage;storage.delFromStorage=function(el){oldDelFromStorage.call(storage,el);if(el){el.onRemove&&el.onRemove(vmlRoot)}};storage.addToStorage=function(el){el.onAdd&&el.onAdd(vmlRoot);oldAddToStorage.call(storage,el)};this._firstPaint=true}VMLPainter.prototype={constructor:VMLPainter,getType:function(){return"vml"},getViewportRoot:function(){return this._vmlViewport},getViewportRootOffset:function(){var viewportRoot=this.getViewportRoot();if(viewportRoot){return{offsetLeft:viewportRoot.offsetLeft||0,offsetTop:viewportRoot.offsetTop||0}}},refresh:function(){var list=this.storage.getDisplayList(true,true);this._paintList(list)},_paintList:function(list){var vmlRoot=this._vmlRoot;for(var i=0;i<list.length;i++){var el=list[i];if(el.invisible||el.ignore){if(!el.__alreadyNotVisible){el.onRemove(vmlRoot)}el.__alreadyNotVisible=true}else{if(el.__alreadyNotVisible){el.onAdd(vmlRoot)}el.__alreadyNotVisible=false;if(el.__dirty){el.beforeBrush&&el.beforeBrush();(el.brushVML||el.brush).call(el,vmlRoot);el.afterBrush&&el.afterBrush()}}el.__dirty=false}if(this._firstPaint){this._vmlViewport.appendChild(vmlRoot);this._firstPaint=false}},resize:function(width,height){var width=null==width?this._getWidth():width;var height=null==height?this._getHeight():height;if(this._width!=width||this._height!=height){this._width=width;this._height=height;var vmlViewportStyle=this._vmlViewport.style;vmlViewportStyle.width=width+"px";vmlViewportStyle.height=height+"px"}},dispose:function(){this.root.innerHTML="";this._vmlRoot=this._vmlViewport=this.storage=null},getWidth:function(){return this._width},getHeight:function(){return this._height},clear:function(){if(this._vmlViewport){this.root.removeChild(this._vmlViewport)}},_getWidth:function(){var root=this.root;var stl=root.currentStyle;return 0|(root.clientWidth||parseInt10$2(stl.width))-parseInt10$2(stl.paddingLeft)-parseInt10$2(stl.paddingRight)},_getHeight:function(){var root=this.root;var stl=root.currentStyle;return 0|(root.clientHeight||parseInt10$2(stl.height))-parseInt10$2(stl.paddingTop)-parseInt10$2(stl.paddingBottom)}};function createMethodNotSupport$1(method){return function(){zrLog("In IE8.0 VML mode painter not support method \""+method+"\"")}}each(["getLayer","insertLayer","eachLayer","eachBuiltinLayer","eachOtherLayer","getLayers","modLayer","delLayer","clearLayer","toDataURL","pathToImage"],function(name){VMLPainter.prototype[name]=createMethodNotSupport$1(name)});registerPainter("vml",VMLPainter);exports.version=version;exports.init=init;exports.dispose=dispose;exports.getInstance=getInstance;exports.registerPainter=registerPainter;exports.matrix=matrix;exports.vector=vector;exports.color=color;exports.path=path;exports.util=util;exports.Group=Group;exports.Path=Path;exports.Image=ZImage;exports.CompoundPath=CompoundPath;exports.Text=Text;exports.IncrementalDisplayable=IncrementalDisplayble;exports.Arc=Arc;exports.BezierCurve=BezierCurve;exports.Circle=Circle;exports.Droplet=Droplet;exports.Ellipse=Ellipse;exports.Heart=Heart;exports.Isogon=Isogon;exports.Line=Line;exports.Polygon=Polygon;exports.Polyline=Polyline;exports.Rect=Rect;exports.Ring=Ring;exports.Rose=Rose;exports.Sector=Sector;exports.Star=Star;exports.Trochoid=Trochoid;exports.LinearGradient=LinearGradient;exports.RadialGradient=RadialGradient;exports.Pattern=Pattern;exports.BoundingRect=BoundingRect});;;window.iD=function(){window.locale.en=iD.data.en;window.locale.current("en");var context={},storage;try{storage=localStorage}catch(e){}storage=storage||function(){var s={};return{getItem:function(k){return s[k]},setItem:function(k,v){s[k]=v},removeItem:function(k){delete s[k]}}}();context.storage=function(k,v){try{if(1===arguments.length)return storage.getItem(k);else if(null===v)storage.removeItem(k);else storage.setItem(k,v)}catch(e){if("undefined"!==typeof console)console.error("localStorage quota exceeded")}};var history=iD.History(context),dispatch=d3.dispatch("enter","exit","refresh"),mode,container,_editArea=[],ui=iD.ui(context),connection=iD.Connection(context),locale=iD.detect().locale,localePath;if(!iD.fileHistory){}else{var filehistory=iD.fileHistory(context)}if(locale&&-1===iD.data.locales.indexOf(locale)){locale=locale.split("-")[0]}connection.on("load.context",function loadContext(err,result,url){history.merge(result.data,result.extent,url,result.loaded)});context.preauth=function(options){connection.switch(options);return context};context.locale=function(_,path){locale=_;localePath=path;return context};context.loadLocale=function(cb){if(locale&&"en"!==locale&&-1!==iD.data.locales.indexOf(locale)){setTimeout(function(){window.locale[locale]=iD.data.zh_cn;window.locale.current(locale);cb()},300)}else{cb()}};context.localStorageClean=function(){localStorage.clear()};context.ui=function(){return ui};context.connection=function(){return connection};context.history=function(){return history};context.filehistory=function(){return filehistory};context.graph=history.graph;context.changes=history.changes;context.intersects=history.intersects;var inIntro=false;context.inIntro=function(_){if(!arguments.length)return inIntro;inIntro=_;return context};context.save=function(){if(inIntro)return;history.save();if(history.hasChanges()){return t("save.unsaved_changes")}};context.flush=function(){connection.flush();history.reset();return context};var debouncedSave=_.debounce(context.save,350);function withDebouncedSave(fn){return function(){var result=fn.apply(history,arguments);debouncedSave();return result}}context.perform=withDebouncedSave(history.perform);context.replace=withDebouncedSave(history.replace);context.pop=withDebouncedSave(history.pop);context.undo=withDebouncedSave(history.undo);context.redo=withDebouncedSave(history.redo);context.hasEntity=function(id){return history.graph().hasEntity(id)};context.entity=function(id){return history.graph().entity(id)};context.childNodes=function(way){return history.graph().childNodes(way)};context.geometry=function(id){return context.entity(id).geometry(history.graph())};context.enter=function(newMode){if(mode){mode.exit();dispatch.exit(mode)}mode=newMode;mode.enter();dispatch.enter(mode)};context.mode=function(){return mode};context.selectedIDs=function(){if(mode&&mode.selectedIDs){return mode.selectedIDs()}else{return[]}};context.loadEntity=function(id,zoomTo,layerInfo){if(false!==zoomTo){connection.loadEntity(id,layerInfo,function(error,entity){if(entity.loc&&(180<entity.loc[0]||90<entity.loc[1])){entity.loc[0]/=10000;entity.loc[1]/=10000}if(entity){map.zoomTo(entity)}})}map.on("drawn.loadEntity",function(){if(!context.hasEntity(id))return;map.on("drawn.loadEntity",null);context.on("enter.loadEntity",null);context.enter(iD.modes.Select(context,[id]))});context.on("enter.loadEntity",function(){if("browse"!==mode.id){map.on("drawn.loadEntity",null);context.on("enter.loadEntity",null)}})};context.editable=function(){return map.editable()&&mode&&"save"!==mode.id};context.install=function(behavior){context.surface().call(behavior)};context.uninstall=function(behavior){context.surface().call(behavior.off)};context.projection=iD.geo.RawMercator();var background=iD.Background(context);context.background=function(){return background};context.event=iD.Event();iD.Options=context.options={};var map=iD.Map(context);context.map=function(){return map};context.surface=function(){return map.surface};context.mouse=map.mouse;context.extent=map.extent;context.pan=map.pan;context.zoomIn=map.zoomIn;context.zoomOut=map.zoomOut;context.layers=function(layerId){if(!arguments.length)return iD.Layers;return iD.Layers.getLayerById(layerId)};context.surfaceRect=function(){return context.surface().node().parentNode.getBoundingClientRect()};context.overview_projection=iD.geo.RawMercator();var overview=iD.Overview(context);context.overview=function(){return overview};var presets=iD.presets().load(iD.data.presets);context.presets=function(){return presets};context.Constant=function(){return iD.data.Constant};context.container=function(_){if(!arguments.length)return container;container=_;container.classed("KDSEditor-id-container",true);return context};context.editArea=function(_){if(!arguments.length)return _editArea;_editArea=_;return context};var embed=false;context.embed=function(_){if(!arguments.length)return embed;embed=_;return context};var assetPath="";context.assetPath=function(_){if(!arguments.length)return assetPath;assetPath=_;return context};var assetMap={};context.assetMap=function(_){if(!arguments.length)return assetMap;assetMap=_;return context};context.imagePath=function(_){var asset="img/"+_;return assetMap[asset]||assetPath+asset};context.temp=function(){context.temp||(context.temp={});return context.temp};context.tempv=function(k,v){context.temp();if(k)context.temp[k]=v||0;return true};context.transportation=iD.Transportation.operations;context.isRoadCross=function(entity){return entity.isRoadCross&&entity.isRoadCross()};context.isPlaceName=function(entity){return entity.isPlaceName&&entity.isPlaceName()};context.isDetailSlope=function(entity){return entity.isDetailSlope&&entity.isDetailSlope()};context.isWalkZlevel=function(entity){return entity.isWalkZlevel&&entity.isWalkZlevel()};context.isQcTag=function(entity){return entity.isQcTag&&entity.isQcTag()};context.isWalkEnter=function(entity){return entity.isWalkEnter&&entity.isWalkEnter()};context.isRoadNode=function(entity){return entity.isRoadNode&&entity.isRoadNode()};context.isOneRoadCrossWay=function(entity){return entity.isOneRoadCrossWay&&entity.isOneRoadCrossWay()};context.lightOverlays=function(){return map._lightselector||""};var placeNameEdit=false;context.placeNameEdit=function(_){if(!arguments.length)return placeNameEdit;placeNameEdit=_;return context};var qcTagEdit=false;context.qcTagEdit=function(_){if(!arguments.length)return qcTagEdit;qcTagEdit=_;return context};context.autoSave=function(){if(history.hasChanges()&&!context.variable.isOpenSaveDialog){context.variable.isOpenSaveDialog=true;window.clearInterval(context.variable.autoSaveTime);Dialog.confirm("\u60A8\u5DF2\u957F\u65F6\u95F4\u6CA1\u6709\u4FDD\u5B58\u6570\u636E\u4E86\uFF0C\u662F\u5426\u4FDD\u5B58\uFF1F",function(){context.enter(iD.modes.Save(context,"auto saving"));context.variable.isOpenSaveDialog=false},function(){context.variable.isOpenSaveDialog=false;if(context.variable.autoSaveTime){window.clearInterval(context.variable.autoSaveTime);context.variable.autoSaveTime=window.setInterval(context.autoSave,900000)}})}};context.variable={roadLabel:null,nodeLabel:null,singleNodeByTopoSplit:null,singleNode:null,isDividerAttrHighlight:false,isLaneHighlight:false,isOpenSaveDialog:false,autoSaveTime:null,altKeyDown:false,firstInTopo:null,blankFieldList:[iD.data.DataType.OBJECT_PG_NODE,iD.data.DataType.OBJECT_PL_NODE,iD.data.DataType.TRAFFICSIGN_NODE,iD.data.DataType.BRIDGE_NODE],canNotDrag:[iD.data.DataType.OBJECT_PT,iD.data.DataType.LAMPPOST,iD.data.DataType.OBJECT_PG_NODE,iD.data.DataType.OBJECT_PL_NODE,iD.data.DataType.TRAFFICSIGN_NODE,iD.data.DataType.ROAD_ATTRIBUTE,iD.data.DataType.BRIDGE_NODE,iD.data.DataType.IMAGE_TAG,iD.data.DataType.ANALYSIS_TAG,iD.data.DataType.QUESTION_TAG],firstInZoomLevel:null,showShapePoint:false,edit:{editDivider:false,editOther:false}};if(iD.User&&!iD.User.isEditCheckSystemAndRole()){context.variable.canNotDrag.push(iD.data.DataType.CHECK_TAG)}context.ui().layermanager.on("tag",function(type,isDisplay){var layers=editor.getOverlayers();layers.forEach(function(layer){if(0==layer.id.indexOf(type)){layer.visible=isDisplay;context.background().setOverlayLayer(iD.BackgroundSource(layer),isDisplay)}})});context.ui().layermanager.on("background",function(layerId,isDisplay){if(!isDisplay){context.background().layerVisible(layerId,false)}else{context.background().layerVisible(layerId,true);var exclusiveIds=context.background().getOverlayLayers(layerId).source().data().exclusiveIds;if(exclusiveIds){exclusiveIds.forEach(function(id){context.background().layerVisible(id,false)})}}});return d3.rebind(context,dispatch,"on")};iD.Event=function(context){var dispatch=d3.dispatch("lasso","click","hover","movestart","move","moveend","zoom","savestart","saveend","dragbox","add","drawoverlayers","polygonend","selected","drawstart","drawing","draw","openpanorama","closepanorama","changelayer","changemap","mousedown","mouseup","mousemove","openoverview","closeoverview","moveoverview","openinfowindow","closeinfowindow","moveinfowindow","changeinfowindow","dragstart","draging","dragend","entityedite","delete","changeeffect","change_scene");function event(){}event.addEventDispatch=function(e,args){!dispatch[e]&&d3.addEventDispatch(dispatch,e);args&&dispatch[e](args)};event.removeEvent=function(){};event.mousedown=function(args){dispatch.mousedown(args)};event.mouseup=function(args){dispatch.mouseup(args)};event.dragstart=function(args){dispatch.dragstart(args)};event.draging=function(args){dispatch.draging(args)};event.dragend=function(args){dispatch.dragend(args)};event.delete=function(args){dispatch.delete(args)};event.changemap=function(args){dispatch.changemap(args)};event.mousemove=function(args){dispatch.mousemove(args)};event.drawstart=function(args){dispatch.drawstart(args)};event.drawing=function(args){dispatch.drawing(args)};event.draw=function(args){dispatch.draw(args)};event.polygonend=function(args){dispatch.polygonend(args)};event.drawoverlayers=function(args){dispatch.drawoverlayers(args)};event.lasso=function(args){dispatch.lasso(args)};event.click=function(args){dispatch.click(args)};event.hover=function(args){dispatch.hover(args)};event.movestart=function(args){dispatch.movestart(args)};event.move=function(args){dispatch.move(args)};event.moveend=function(args){dispatch.moveend(args)};event.zoom=function(args){dispatch.zoom(args)};event.savestart=function(args){dispatch.savestart(args)};event.saveend=function(args){dispatch.saveend(args)};event.dragbox=function(args){dispatch.dragbox(args)};event.add=function(args){dispatch.add(args)};event.selected=function(args){dispatch.selected(args)};event.changelayer=function(args){dispatch.changelayer(args)};event.openoverview=function(args){dispatch.openoverview(args)};event.closeoverview=function(args){dispatch.closeoverview(args)};event.moveoverview=function(args){dispatch.moveoverview(args)};event.openinfowindow=function(args){dispatch.openinfowindow(args)};event.closeinfowindow=function(args){dispatch.closeinfowindow(args)};event.entityedite=function(args){dispatch.entityedite(args)};event.moveinfowindow=function(args){dispatch.moveinfowindow(args)};event.changeinfowindow=function(args){dispatch.changeinfowindow(args)};event.changeeffect=function(args){dispatch.changeeffect(args)};event.change_scene=function(args){dispatch.change_scene(args)};return d3.rebind(event,dispatch,"on")};iD.data={};iD.data.presets={};iD.data.layers=[];iD.version="1.5.4";;;(function(){var detected={};var ua=navigator.userAgent,msie=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})");if(null!==msie.exec(ua)){var rv=parseFloat(RegExp.$1);detected.support=!(rv&&9>rv)}else{detected.support=true}detected.opera=0<=ua.indexOf("Opera");detected.locale=navigator.language||navigator.userLanguage;detected.filedrop=window.FileReader&&"ondrop"in window;function nav(x){return-1!==navigator.userAgent.indexOf(x)}if(nav("Win"))detected.os="win";else if(nav("Mac"))detected.os="mac";else if(nav("X11"))detected.os="linux";else if(nav("Linux"))detected.os="linux";else detected.os="win";iD.detect=function(){return detected}})();;;iD.util={};iD.util.tagText=function(entity){return d3.entries(entity.tags).map(function(e){return e.key+"="+e.value}).join(", ")};iD.util.entitySelector=function(ids){return ids.length?"."+ids.join(",."):"nothing"};iD.util.entityOrMemberSelector=function(ids,graph){if(ids){var s=iD.util.entitySelector(ids)}else{return}ids.forEach(function(id){var entity=graph.hasEntity(id);if(entity&&"relation"===entity.type){entity.members.forEach(function(member){s+=",."+member.id})}});return s};iD.util.entityRelationFooterHighlightSelector=function(entity,context,highlight){if(!entity)return"";var graph=context.graph();if(highlight){context.surface().selectAll(".selected").classed("selected",false)}if(entity.geometry(graph)!=iD.data.GeomType.RELATION){if(highlight){context.surface().selectAll("."+entity.id).classed("selected",true)}return""}var entityList=_.map(_.pluck(entity.members,"id"),graph.entity,graph);var typeMap=_.groupBy(entityList,function(d){return d.type});var selecteds=[],onlySelect;var nodes=typeMap[iD.data.GeomType.NODE]||[];for(var d of nodes){if(d.modelName==iD.data.DataType.C_NODE){onlySelect=d.id;break}selecteds.push(d.id)}var ways=typeMap[iD.data.GeomType.WAY]||[];if(!onlySelect&&!selecteds.length&&entity.modelName==iD.data.DataType.R_DIVIDER_DREF){for(var d of ways){if(d.modelName==iD.data.DataType.DIVIDER&&"1"==d.tags.R_LINE){onlySelect=d.id;break}}}if(!onlySelect&&!selecteds.length){for(var d of ways){selecteds.push(d.id)}}var result="";if(onlySelect){result=iD.util.entitySelector([onlySelect])}else if(selecteds.length){result=iD.util.entitySelector(selecteds)}if(highlight&&result){context.surface().selectAll(result).classed("selected",true)}return result};iD.util.entityRelationMainMember=function(entity,context){if(!(entity instanceof iD.Relation)){return}var result;var geoType="",filterFun=()=>true;if(_.include([iD.data.DataType.DIVIDER_ATTRIBUTE,iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.R_ROAD_RA],entity.modelName)){geoType=iD.data.GeomType.NODE}else if(entity.modelName==iD.data.DataType.R_DIVIDER_DREF){geoType=iD.data.GeomType.WAY;filterFun=function(d){return d&&"1"==d.tags.R_LINE}}for(let m of entity.members||[]){let d=context.hasEntity(m.id);if(d&&d.type==geoType&&filterFun(d)){result=d.id;break}}if(!result&&entity.members&&entity.members.length){result=entity.members[0].id}return result};iD.util.displayName=function(entity,custom){var localeName;if("roadcrossline"==entity.tags.road_class){localeName=entity.tags[custom||"name_chn"]||entity.tags["name"]||"\u672A\u547D\u540D"}else if("undefined"!=typeof entity.tags&&"undefined"!=typeof entity.modelName&&"Highway"==entity.modelName){localeName=entity.tags[custom||"name_chn"]||entity.tags["name"]||"\u672A\u547D\u540D"}else{localeName=entity.tags[custom||"name_chn"]||entity.tags["name"]}return localeName||""};iD.util.displayTypeName=function(entity,custom,context){var localeName;if("roadcrossline"==entity.tags.road_class){localeName="\u5185\u90E8\u9053\u8DEF"}else if("undefined"!=typeof entity.tags&&"undefined"!=typeof entity.modelName&&"Highway"==entity.modelName){var findTypeName=function(k,v){var n=_.find(_.find(iD.Layers.getLayer(context.entity(entity.id).layerId).modelEntity().getFields(),function(a){return a.fieldName==k}).fieldInput.values,function(b){return b.value==v});return n&&"undefined"!=typeof n.name?n.name:""};localeName=custom?findTypeName(custom,entity.tags[custom]):findTypeName("road_class",entity.tags["road_class"])}else if("undefined"!=typeof entity.tags&&"undefined"!=typeof entity.modelName&&entity.modelName==iD.data.DataType.WALKLINK){var findTypeName=function(k,v){var currentLayer=iD.Layers.getLayer(entity.layerId),modelEntity=currentLayer.modelEntity(),geoType=modelEntity.getGeoType();if(currentLayer.isRoad()){var typeModelEntity=currentLayer.typeModelEntity()[entity.modelName];if(typeModelEntity){geoType=typeModelEntity.modelId;modelEntity=typeModelEntity.model}else{geoType=""}}var fields=modelEntity.getFields(geoType);var n=_.find(_.find(fields,function(a){return a.fieldName==k}).fieldInput.values,function(b){return b.value==v});return n&&"undefined"!=typeof n.name?n.name:""};localeName=custom?findTypeName(custom,entity.tags[custom]):findTypeName("wf_type",entity.tags["wf_type"])}else if("undefined"!=typeof entity.tags&&"undefined"!=typeof entity.modelName){if(entity.modelName==iD.data.Constant.ROADNODE){localeName="\u8DEF\u53E3"}else if(entity.modelName==iD.data.Constant.C_NODE){localeName="\u7EFC\u5408\u4EA4\u53C9\u8DEF\u53E3"}}return localeName||""};iD.util.empty=function(){return true};iD.util.stringQs=function(str){return str.split("&").reduce(function(obj,pair){var parts=pair.split("=");if(2===parts.length){obj[parts[0]]=null===parts[1]?"":decodeURIComponent(parts[1])}return obj},{})};iD.util.qsString=function(obj,noencode){function softEncode(s){return s.replace("&","%26")}return Object.keys(obj).sort().map(function(key){return encodeURIComponent(key)+"="+(noencode?softEncode(obj[key]):encodeURIComponent(obj[key]))}).join("&")};iD.util.prefixDOMProperty=function(property){var prefixes=["webkit","ms","moz","o"],i=-1,n=prefixes.length,s=document.body;if(property in s)return property;property=property.substr(0,1).toUpperCase()+property.substr(1);while(++i<n)if(prefixes[i]+property in s)return prefixes[i]+property;return false};iD.util.prefixCSSProperty=function(property){var prefixes=["webkit","ms","Moz","O"],i=-1,n=prefixes.length,s=document.body.style;if(property.toLowerCase()in s)return property.toLowerCase();while(++i<n)if(prefixes[i]+property in s)return"-"+prefixes[i].toLowerCase()+property.replace(/([A-Z])/g,"-$1").toLowerCase();return false};iD.util.setTransform=function(el,x,y,scale){var prop=iD.util.transformProperty=iD.util.transformProperty||iD.util.prefixCSSProperty("Transform"),translate=iD.detect().opera?"translate("+x+"px,"+y+"px)":"translate3d("+x+"px,"+y+"px,0)";return el.style(prop,translate+(scale?" scale("+scale+")":""))};iD.util.getStyle=function(selector){for(var i=0;i<document.styleSheets.length;i++){var rules=document.styleSheets[i].rules||document.styleSheets[i].cssRules||[];for(var k=0;k<rules.length;k++){var selectorText=rules[k].selectorText&&rules[k].selectorText.split(", ");if(_.contains(selectorText,selector)){return rules[k]}}}};iD.util.editDistance=function(a,b){if(0===a.length)return b.length;if(0===b.length)return a.length;var matrix=[];for(var i=0;i<=b.length;i++){matrix[i]=[i]}for(var j=0;j<=a.length;j++){matrix[0][j]=j}for(i=1;i<=b.length;i++){for(j=1;j<=a.length;j++){if(b.charAt(i-1)===a.charAt(j-1)){matrix[i][j]=matrix[i-1][j-1]}else{matrix[i][j]=Math.min(matrix[i-1][j-1]+1,Math.min(matrix[i][j-1]+1,matrix[i-1][j]+1))}}}return matrix[b.length][a.length]};iD.util.fastMouse=function(container){var rect=_.clone(container.getBoundingClientRect()),rectLeft=rect.left,rectTop=rect.top,clientLeft=+container.clientLeft,clientTop=+container.clientTop;return function(e){return[e.clientX-rectLeft-clientLeft,e.clientY-rectTop-clientTop]}};iD.util.substring=function(text,length){var v=text.trim(),l=v.length;if(length<l){v=v.substring(0,length)+"..."}return v};iD.util.getPrototypeOf=Object.getPrototypeOf||function(obj){return obj.__proto__};iD.util.asyncMap=function(inputs,func,callback){var remaining=inputs.length,results=[],errors=[];inputs.forEach(function(d,i){func(d,function done(err,data){errors[i]=err;results[i]=data;remaining--;if(!remaining)callback(errors,results)})})};iD.util.wrap=function(index,length){if(0>index)index+=Math.ceil(-index/length)*length;return index%length};iD.util.arrayRemove=function(o,array){var news=[];for(var i=0;i<array.length;i++){var node=array[i];if(node!==o&&news[news.length-1]!==node){news.push(node)}}if(1<array.length&&array[0]===o&&array[array.length-1]===o&&news[news.length-1]!==news[0]){news.push(news[0])}return news};iD.util.merge=function(json1,json2){for(var key in json1){json2[key]=json1[key]}var r={};for(var k in json2){r[k]=json2[k]}return r};iD.util.pt2WayDist=function(nodes,pt){};iD.util.pt2LineDist=function(line,Pt){var a={dis:Number.MAX_VALUE};for(var i=0;i<line.length-1;i++){var arr=[line[i],line[i+1]];var b=this.pt2LineSegmentDist(arr,Pt);if(b.dis<a.dis){a={x:b["x"],y:b["y"],dis:b["dis"],i:i}}}return a};iD.util.pt2LineSegmentDist=function(line,pt){var x=0,y=0;var dX=line[1][0]-line[0][0],dY=line[1][1]-line[0][1];var dR=-(line[0][1]-pt[1])*dY-(line[0][0]-pt[0])*dX;var dL;if(0>=dR){x=line[0][0];y=line[0][1]}else if(dR>=(dL=dX*dX+dY*dY)){x=line[1][0];y=line[1][1]}else{x=line[0][0]+dR*dX/dL;y=line[0][1]+dR*dY/dL}return{x:x,y:y,dis:Math.sqrt(Math.pow(pt[0]-x,2)+Math.pow(pt[1]-y,2))}};iD.util.pt2LineDist2=function(line,Pt){var a={dis:Number.MAX_VALUE};for(var i=0;i<line.length-1;i++){var arr=[line[i],line[i+1]];var b=this.pt2LineSegmentDist2(arr,Pt);if(b.dis<a.dis){a={x:b["x"],y:b["y"],dis:b["dis"],i:i}}}return a};iD.util.pt2LineSegmentDist2=function(line,pt){var x=0,y=0;var dX=line[1][0]-line[0][0],dY=line[1][1]-line[0][1];var dR=-(line[0][1]-pt[1])*dY-(line[0][0]-pt[0])*dX;var dL;if(0>=dR){x=line[0][0];y=line[0][1]}else if(dR>=(dL=dX*dX+dY*dY)){x=line[1][0];y=line[1][1]}else{x=line[0][0]+dR*dX/dL;y=line[0][1]+dR*dY/dL}return{x:x,y:y,dis:iD.geo.sphericalDistance(pt,[x,y])}};iD.util.trackPointToPicPixe=function(k,point,xyz){let r=point.tags.R;let t=point.tags.T;let p=this.KRt(k,r,t);let x1=matrix.multiply(p,this.UTMProjection(xyz));return[x1[0]/x1[2],x1[1]/x1[2],x1[2][0]]};iD.util.UTMProjection=function(xyz){var lon=xyz[0],lat=xyz[1],z=xyz[2];var utm=iD.util.LLtoUTM_(lon,lat);var X=[[utm.x],[utm.y],[z]];X.push([1]);return X};iD.util.hnormalized=function(x1){return[[x1[0]/x1[2]],[x1[1]/x1[2]],[x1[2][0]]]};iD.util.normalizedSqrt=function(x1){let R=Math.sqrt(Math.pow(x1[0],2)+Math.pow(x1[1],2)+Math.pow(x1[2],2));return[x1[0]/R,x1[1]/R,x1[2]/R]};iD.util.normalized=function(x1,x2){let r=Math.pow(x2[0]-x1[0],2)+Math.pow(x2[1]-x1[1],2)+Math.pow(x2[2]-x1[2],2);r=Math.sqrt(r);return[[(x2[0]-x1[0])/r],[(x2[1]-x1[1])/r],[(x2[2]-x1[2])/r]]};iD.util.norm=function(nx1,nx2){return Math.sqrt(Math.pow(nx1[0]-nx2[0],2)+Math.pow(nx1[1]-nx2[1],2)+Math.pow(nx1[2]-nx2[2],2))};iD.util.getScreenLineSegment=function(k,r,t,width,height,point1,point2){let p=this.KRt(k,r,t);let x1=this.UTMProjection(point1);let x2=this.UTMProjection(point2);let px1=matrix.multiply(p,x1);let px2=matrix.multiply(p,x2);if(0>px1[2]&&0>px2){return false}if(0<=px1[2]&&0<=px2[2]){sx1=this.hnormalized(px1);sx2=this.hnormalized(px2);return[sx1,sx2]}else{var nx1,nx2,nsx1=[],nsx2,npx2;if(0>px1[2]){nx1=x1;nx2=x2;npx2=px2}else{nx1=x2;nx2=x1;npx2=px1}let n=this.normalized(nx2,nx1);let length=this.norm(nx2,nx1);let nXLength=matrix.scalar(n,length);nXLength.push([1]);let x3=matrix.addition(nx2,nXLength);x3[3]=[1];let px3=matrix.multiply(p,x3);nsx2=this.hnormalized(npx2);let sx3=this.hnormalized(px3);let d32=matrix.subtraction(sx3,nsx2);let a=sx3[1]-nsx2[1];let b=nsx2[0]-sx3[0];let c=sx3[0]*nsx2[1]-nsx2[0]*sx3[1];if(Math.abs(d32[0])>=Math.abs(d32[1])){if(0<d32[0]){nsx1[0]=0;nsx1[1]=-c/b}else if(0>d32[0]){nsx1[0]=width;nsx1[1]=-(c+a*width)/b}else{nsx1[0]=nsx2[0];if(0<d32[1]){nsx1[1]=0}else{nsx1[1]=height}}}else{if(0<d32[1]){nsx1[0]=0;nsx1[1]=-c/a}else if(0>d32[1]){nsx1[1]=height;nsx1[0]=-(c+b*height)/a}else{nsx1[1]=nsx2[1];if(0<d32[0]){nsx1[1]=0}else{nsx1[1]=width}}}if(0>px1[2]){sx1=nsx1;sx2=nsx2}else{sx1=nsx2;sx2=nsx1}}return[sx1,sx2]};iD.util.lineIntersectionRectangles=function(rect,line){let x1=rect[0][0],y1=rect[0][1];let x2=rect[1][0],y2=rect[1][1];let line1=[x1,y1,x2,y1];let line2=[x2,y1,x2,y2];let line3=[x2,y2,x1,y2];let line4=[x1,y2,x1,y1];let rectLines=[line1,line2,line3,line4];for(let i=0,len=rectLines.length;i<len;i++){let SegmentA=rectLines[i];let r=this.extendIntersection(SegmentA,line);if(!isNaN(r[0])&&!isNaN(r[1])){return r}}return false};iD.util.multiply=function(sp,ep,op){return(sp[0]-op[0])*(ep[1]-op[1])-(ep[0]-op[0])*(sp[1]-op[1])};iD.util.onLine=function(l,p){return 0==+this.multiply([l[2],l[3]],p,[l[0],l[1]]).toFixed(8)&&0>=(p[0]-l[0])*(p[0]-l[2])&&0>=(p[1]-l[1])*(p[1]-l[3])};iD.util.extendIntersection=function(line1,line2){var m1=line1[0]-line1[2];var m2=line2[2]-line2[0];if(0==m1)m1=1;if(0==m2)m2=1;var k0=(line1[1]-line1[3])/m1;var e=line1[3]-k0*line1[2];var k1=(line2[3]-line2[1])/m2;var e1=line2[3]-k1*line2[2];var x=(e1-e)/(k0-k1);var y=k0*x+e;return[x,y]};iD.util.triangleSolveIncircle=function(vertexs,lengths){let A=vertexs[0],B=vertexs[1],C=vertexs[2];let a=lengths[0],b=lengths[1],c=lengths[2];if(A&&B&&C&&a&&b&&c){var X=(a*A[0]+b*B[0]+c*C[0])/(a+b+c);var Y=(a*A[1]+b*B[1]+c*C[1])/(a+b+c);return[X,Y]}return[]};iD.util.isPointInPolygon=function(point,polygon){var pts=polygon.nodes;var N=pts.length;var boundOrVertex=true;var intersectCount=0;var precision=2e-10;var p1,p2;var p=point;p1=pts[0];for(var i=1;i<=N;++i){if(p.loc[0]==p1.loc[0]&&p.loc[1]==p1.loc[1]){return boundOrVertex}p2=pts[i%N];if(p.loc[1]<Math.min(p1.loc[1],p2.loc[1])||p.loc[1]>Math.max(p1.loc[1],p2.loc[1])){p1=p2;continue}if(p.loc[1]>Math.min(p1.loc[1],p2.loc[1])&&p.loc[1]<Math.max(p1.loc[1],p2.loc[1])){if(p.loc[0]<=Math.max(p1.loc[0],p2.loc[0])){if(p1.loc[1]==p2.loc[1]&&p.loc[0]>=Math.min(p1.loc[0],p2.loc[0])){return boundOrVertex}if(p1.loc[0]==p2.loc[0]){if(p1.loc[0]==p.loc[0]){return boundOrVertex}else{++intersectCount}}else{var xinters=(p.loc[1]-p1.loc[1])*(p2.loc[0]-p1.loc[0])/(p2.loc[1]-p1.loc[1])+p1.loc[0];if(Math.abs(p.loc[0]-xinters)<precision){return boundOrVertex}if(p.loc[0]<xinters){++intersectCount}}}}else{if(p.loc[1]==p2.loc[1]&&p.loc[0]<=p2.loc[0]){var p3=pts[(i+1)%N];if(p.loc[1]>=Math.min(p1.loc[1],p3.loc[1])&&p.loc[1]<=Math.max(p1.loc[1],p3.loc[1])){++intersectCount}else{intersectCount+=2}}}p1=p2}if(0==intersectCount%2){return false}else{return true}};iD.util.getDom=function(id){return document.getElementById(id)};iD.util.transArray=function(object){if(object&&"string"===typeof object){object=[object]}return object||[]};iD.util.angleTranslate=function(angle,delt){var x=0,y=0;if(0>=angle)angle=360+angle;var deltx=delt*Math.abs(Math.sin(Math.PI/180*angle)).toFixed(2),delty=delt*Math.abs(Math.cos(Math.PI/180*angle)).toFixed(2);if(90>angle&&0<=angle){x=deltx;y=-delty}else if(180>angle&&90<=angle){x=deltx;y=delty}else if(270>angle&&180<=angle){x=-deltx;y=delty}else if(360>=angle&&270<=angle){x=-deltx;y=-delty}return{x:x,y:y,angle:angle}};iD.util.getStyleValue=function(obj,key){var value=obj.style[key];if(!value&&obj.currentStyle){value=obj.currentStyle[key]}if((!value||"auto"===value)&&document.defaultView){var css=document.defaultView.getComputedStyle(obj,null);value=css?css[key]:null}if((!value||"auto"===value)&&"height"===key){value=obj.clientHeight+"px"}if((!value||"auto"===value)&&"width"===key){value=obj.clientWidth+"px"}return"auto"===value?null:value};iD.util.getLocsCenter=function(locs){var total_lng=0,total_lat=0,len=locs.length;for(var i in locs){total_lng+=locs[i][0];total_lat+=locs[i][1]}return[total_lng/len,total_lat/len]};iD.util.getLocsLenCenter=function(locs,projection){var pixels=[],len=locs.length;for(var i=0;i<len;i++){pixels.push(projection(locs[i]))}var total_dis1=0,distances=[];for(var j=0;j<len-1;j++){var x1=pixels[j][0],y1=pixels[j][1],x2=pixels[j+1][0],y2=pixels[j+1][1];var dis=Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));total_dis1+=dis;distances.push(dis)}var total_dis_avg=total_dis1/2;var total_dis2=0,n=0;for(var k=0;k<len-1;k++){total_dis2+=distances[k];if(total_dis2>=total_dis_avg){n=k+1;break}}var a=pixels[n],b=pixels[n-1],delt=total_dis2-total_dis_avg;var x_y=iD.util.getLenCenter(a,b,delt);var coords=projection.invert([x_y[0],x_y[1]]);return coords};iD.util.getLenCenter=function(a,b,delt){var pixel=[],angle=0;if(b[0]!==a[0]){angle=Math.atan(Math.abs((b[1]-a[1])/(b[0]-a[0])));if(0<b[1]-a[1]&&0<b[0]-a[0]){pixel.push(a[0]+delt*Math.cos(angle));pixel.push(a[1]+delt*Math.sin(angle))}if(0>b[1]-a[1]&&0<b[0]-a[0]){pixel.push(a[0]+delt*Math.cos(angle));pixel.push(a[1]-delt*Math.sin(angle))}if(0>b[1]-a[1]&&0>b[0]-a[0]){pixel.push(a[0]-delt*Math.cos(angle));pixel.push(a[1]-delt*Math.sin(angle))}if(0<b[1]-a[1]&&0>b[0]-a[0]){pixel.push(a[0]-delt*Math.cos(angle));pixel.push(a[1]+delt*Math.sin(angle))}}if(b[1]===a[1]){pixel.push(a[0]+(0<b[0]-a[0]?1:-1)*delt);pixel.push(a[1])}if(b[0]===a[0]){pixel.push(a[0]);pixel.push(a[1]+(0<b[1]-a[1]?1:-1)*delt)}return pixel};iD.util.storeDottedLoc=function(entity,way,key,store,context,entities){var wNodes=way.nodes,nlocs=[];if(entities){for(var j in wNodes)for(var k in entities)if(wNodes[j]===entities[k].id)nlocs.push(entities[k].loc)}else{for(var j in wNodes)nlocs.push(context.graph().entity(wNodes[j]).loc)}var upright=iD.util.pt2LineDist(nlocs,entity.loc);store[key]=[upright.x,upright.y]};iD.util.cookie={getItem:function(sKey){if(!sKey){return null}return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(!sKey||/^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)){return false}var sExpires="";if(vEnd){switch(vEnd.constructor){case Number:sExpires=vEnd===Infinity?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+vEnd;break;case String:sExpires="; expires="+vEnd;break;case Date:sExpires="; expires="+vEnd.toUTCString();break;}}document.cookie=encodeURIComponent(sKey)+"="+encodeURIComponent(sValue)+sExpires+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"")+(bSecure?"; secure":"");return true},removeItem:function(sKey,sPath,sDomain){if(!this.hasItem(sKey)){return false}document.cookie=encodeURIComponent(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"");return true},hasItem:function(sKey){if(!sKey){return false}return new RegExp("(?:^|;\\s*)"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){var aKeys=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(var nLen=aKeys.length,nIdx=0;nIdx<nLen;nIdx++){aKeys[nIdx]=decodeURIComponent(aKeys[nIdx])}return aKeys}};iD.util.path=function(locs,projection,polygon){var round=iD.svg.Round().stream,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return polygon?project(round(output)):project(clip(round(output)))}}),json={type:polygon?"Polygon":"LineString",coordinates:locs};if(locs&&locs[0]&&locs[0][0].loc){json.coordinates=[];for(var k=0;k<locs.length;k++){var lcs=[];for(var n=0;n<locs[k].length;n++){lcs.push(locs[k][n].loc)}json.coordinates.push(lcs)}}return path(json)};iD.util.wayInPlyGonx=function(datum,context){if("1"==datum.tags.O_B_S){return false}if(!context.editArea()){return false}var nodes=datum.nodes;var holes=context.editArea().coordinates;for(var j=0;j<holes.length;j++){var holes_nodes=[];for(var k=0;k<holes[j].length;k++){holes_nodes.push(holes[j][k])}var flag=0;for(var i=0;i<nodes.length;i++){var node=context.entity(nodes[i]).loc;if(iD.geo.pointInPolygon(node,holes_nodes)){flag++};}return flag==nodes.length}return false};iD.util.nodeInPlyGonx=function(datum,context){if("1"==datum.tags.O_B_S){return false}if(!context.editArea()){return false}var parentWays=context.graph().parentWays(datum);for(var i=0;i<parentWays.length;i++){if(iD.util.wayInPlyGonx(parentWays[i],context))return true}var holes=context.editArea().coordinates;for(var j=0;j<holes.length;j++){var holes_nodes=[];for(var k=0;k<holes[j].length;k++){holes_nodes.push(holes[j][k])}var node=datum.loc;if(iD.geo.pointInPolygon(node,holes_nodes)){return true}}return false};iD.util.justNodeInPlyGonx=function(datum,context){if("1"==datum.tags.O_B_S){return false}if(!context.editArea()){return false}var holes=context.editArea().coordinates;if(holes)for(var j=0;j<holes.length;j++){var holes_nodes=[];if(!holes[j].length){return false}for(var k=0;k<holes[j].length;k++){holes_nodes.push(holes[j][k])}var node=datum.loc;if(iD.geo.pointInPolygon(node,holes_nodes)){return true};}return false};iD.util.entityInPlyGon=function(datum,context){if(datum instanceof iD.Node){return iD.util.nodeInPlyGonx(datum,context)}else if(datum instanceof iD.Way){return iD.util.wayInPlyGonx(context.entity(datum.id),context)}};iD.util.pointNotInPlyGonx=function(loc,context){var flag=false;if(!context.editArea()){return flag}var holes=context.editArea().coordinates;for(var j=0;j<holes.length;j++){var holes_nodes=[];for(var k=0;k<holes[j].length;k++){holes_nodes.push(holes[j][k])}if(!iD.geo.pointInPolygon(loc,holes_nodes)){flag=true;return flag};}return flag};iD.util.computeBbox=function(plygon){var log_max=0,log_min=0,lat_max=0,lat_min=0;if(0<plygon.length){log_max=parseFloat(plygon[0].trim().split(" ")[0],10);log_min=parseFloat(plygon[0].trim().split(" ")[0],10);lat_max=parseFloat(plygon[0].trim().split(" ")[1],10);lat_min=parseFloat(plygon[0].trim().split(" ")[1],10)}_.forEach(plygon,function(loc,i){var locArray=loc.trim().split(" ");var log=parseFloat(locArray[0],10);var lat=parseFloat(locArray[1],10);if(log>log_max){log_max=log}if(log<log_min){log_min=log}if(lat>lat_max){lat_max=lat}if(lat<lat_min){lat_min=lat}});return[log_min,lat_min,log_max,lat_max]};iD.util.SplitRoadRule=function(selectIDs,context,flag,originalEntity){var constant=iD.data.DataType;if(flag==iD.walkRoadFlag.ROAD||flag==iD.walkRoadFlag.WALKROAD&&originalEntity.modelName==constant.WALKLINK||selectIDs[0]!=originalEntity.id&&flag==iD.walkRoadFlag.WALKROAD&&(originalEntity.modelName==constant.WALKENTER||originalEntity.modelName==constant.WALKLINK)){return iD.actions.SplitRoad(selectIDs,context)}else{var action=function(graph){return graph};action.disabled=function(){return false};return action}};iD.util.getBounds=function(loc,radius){var sw=this.getLngLatByOffsetMeter(loc,-radius,-radius);var ne=this.getLngLatByOffsetMeter(loc,radius,radius);return[sw,ne]};iD.util.getLngLatByOffsetMeter=function(loc,W,S){var aLng=2*Math.asin(Math.sin(W/(6378137*2))/Math.cos(loc[1]*Math.PI/180));var lng=loc[0]+180*aLng/Math.PI;var aLat=2*Math.asin(S/(6378137*2));var lat=loc[1]+180*aLat/Math.PI;return[lng,lat]};iD.util.parseParam2String=function(param){param=param||{};var result=[];for(var key in param){null!=param[key]&&result.push(key+"="+param[key])}return result.join("&")};iD.util.urlParamSystemType=function(){return iD.url.getUrlParam("system_type")};iD.util.urlParamHistory=function(){return"true"==iD.url.getUrlParam("history")};iD.util.parse2SystypeParam=function(){var systype=iD.url.getUrlParam("system_type");var isInstance=false;var type=1;if(systype){type=systype}if(1==systype||3==systype||4==systype||5==systype||6==systype){isInstance=false}else if(2==systype){isInstance=true}window._systemType=type;window._isInstance=isInstance;if(null!=window._systemType){console.log("system_type\u53C2\u6570 "+systype+" \uFF1A",["","\u6BCD\u5E93","\u878D\u5408","\u8BC6\u522B","\u6807\u6E05","\u8D28\u68C0","\u56FE\u50CF\u6807\u8BB0"][systype]||"\u672A\u77E5\u53C2\u6570")}};iD.util.getClickTimeout=function(){var clickTimeout={_timeout:null,set:function(fn){var that=this;that.clear();var args=Array.prototype.slice.call(arguments,1);that._timeout=window.setTimeout(function(){fn.apply(window,args)},200)},clear:function(){var that=this;if(that._timeout){window.clearTimeout(that._timeout)}}};return clickTimeout};iD.util.computeEpilines=function(pt,whichImage,F){let newF=F;if(2==whichImage){newF=matrix.transpose(F)}let f=newF;let a=f[0][0]*pt[0]+f[1][0]*pt[1]+f[2][0];let b=f[0][1]*pt[0]+f[1][1]*pt[1]+f[2][1];let c=f[0][2]*pt[0]+f[1][2]*pt[1]+f[2][2];let nu=a*a+b*b;nu=nu?1/Math.sqrt(nu):1;a*=nu;b*=nu;c*=nu;return[a,b,c]};iD.util.KRt=function(k,r,t){let rt=matrix.addCols(r,t);return matrix.multiply(k,rt)};iD.util.F_From_KRT=function(k,r1,t1,r2,t2,k2){let p1=this.KRt(k,r1,t1);let p2;if(k2)p2=this.KRt(k2,r2,t2);else p2=this.KRt(k,r2,t2);return this.F_from_P(p1,p2)};iD.util.F_from_P=function(p1,p2){var x1=matrix.block(p1,2,1,2,4);var x2;x2=[matrix.getRow(p1,2),matrix.getRow(p1,0)];var x3=matrix.block(p1,1,1,2,4);var y1=matrix.block(p2,2,1,2,4);var y2;y2=[matrix.getRow(p2,2),matrix.getRow(p2,0)];var y3=matrix.block(p2,1,1,2,4);var x1y1,x2y1,x3y1,x1y2,x2y2,x3y2,X1Y3,x2y3,x3y3;x1y1=[...x1,...y1];x2y1=[...x2,...y1];x3y1=[...x3,...y1];x1y2=[...x1,...y2];x2y2=[...x2,...y2];x3y2=[...x3,...y2];X1Y3=[...x1,...y3];x2y3=[...x2,...y3];x3y3=[...x3,...y3];let res3=[[this.determinant(x1y1),this.determinant(x2y1),this.determinant(x3y1)],[this.determinant(x1y2),this.determinant(x2y2),this.determinant(x3y2)],[this.determinant(X1Y3),this.determinant(x2y3),this.determinant(x3y3)]];return res3};iD.util.determinant=function(t2){var a=_.flatten(t2);let a00=a[0],a01=a[1],a02=a[2],a03=a[3];let a10=a[4],a11=a[5],a12=a[6],a13=a[7];let a20=a[8],a21=a[9],a22=a[10],a23=a[11];let a30=a[12],a31=a[13],a32=a[14],a33=a[15];let b00=a00*a11-a01*a10;let b01=a00*a12-a02*a10;let b02=a00*a13-a03*a10;let b03=a01*a12-a02*a11;let b04=a01*a13-a03*a11;let b05=a02*a13-a03*a12;let b06=a20*a31-a21*a30;let b07=a20*a32-a22*a30;let b08=a20*a33-a23*a30;let b09=a21*a32-a22*a31;let b10=a21*a33-a23*a31;let b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06};iD.util.pointToPicpixe=function(k,point,xyz){let r=point.tags.R;let t=point.tags.T;let temp=[[1,0,0],[0,-1,0],[0,0,-1]];let r1=matrix.multiply(r,temp);let rt=matrix.addCols(r1,t);let p=matrix.multiply(k,rt);let lon=xyz[0],lat=xyz[1],z=xyz[2];let utm=iD.util.LLtoUTM_(lon,lat);let x=[[utm.x],[utm.y],[z]];x.push([1]);var x1=matrix.multiply(p,x);return[x1[0]/x1[2],x1[1]/x1[2],z,x1[2][0]]};iD.util.picPixelToLonLat=function(k,picPoint,UTMZone,xy,h){let r=picPoint.tags.R;let c=picPoint.tags.C;let m=[[xy[0]],[xy[1]],[1]];let inversK=matrix.inverse(k);let transposeR=matrix.transpose(r);let kr=matrix.multiply(transposeR,inversK);let tmp=matrix.multiply(kr,m);let lambda=(h-c[2][0])/tmp[2][0];let cod=matrix.scalar(tmp,lambda);cod=matrix.addition(cod,c);return UTMtoLL(cod[0][0],cod[1][0],UTMZone)};iD.util.getDefauteTags=function(entity,lay){var defaultTags={};var modelEntity;if("string"===typeof entity){modelEntity=iD.ModelEntitys[entity]}else{modelEntity=iD.ModelEntitys[entity.modelName]}if(!modelEntity){return defaultTags}var username=iD.User.getInfo().username;var gtype=modelEntity.getGeoType();modelEntity.getFields(gtype).forEach(function(d){defaultTags[d.fieldName]=d.defaultValue});if(iD.Task.d){defaultTags.TASKID=iD.Task.d.task_id;defaultTags.FLAG="2";if(lay&&lay.batch){defaultTags.BATCH=lay.batch}var isWorker=iD.User.isWorkRole();var isChecker=iD.User.isCheckRole();if(defaultTags.hasOwnProperty("OPERATOR")&&isWorker){defaultTags.OPERATOR=username}if(defaultTags.hasOwnProperty("SDATE")){defaultTags.SDATE=new Date().getTime()}if(modelEntity.modelName()==iD.data.DataType.CHECK_TAG){if(defaultTags.hasOwnProperty("EDITBY")&&isWorker){defaultTags.EDITBY=username}if(defaultTags.hasOwnProperty("CHECKBY")&&isChecker){defaultTags.CHECKBY=username}}}return defaultTags};iD.util.colorRGBA=function(r,g,b,alpha=1){return"rgba("+r+", "+g+", "+b+", "+alpha+")"};iD.util.getDividerParentRelation=function(graph,way,modelName){var rels=graph.parentRelations(way,modelName)||[];var relation;if(_.include([iD.data.DataType.DIVIDER_ATTRIBUTE,iD.data.DataType.LANE_ATTRIBUTE],modelName)){var direction=way.tags.DIRECTION||"0";var relNode;if("3"==direction){relNode=_.last(way.nodes)}else{relNode=way.nodes[0]}for(let i in rels){let rel=rels[i];for(let j in rel.members){let member=rel.members[j];if(member.id==relNode){relation=rel;break}}if(relation){break}}}else{relation=rels[0]}return relation};iD.util.isInsideRect=function(rect,xy){let x1=rect[0][0],y1=rect[0][1];let x2=rect[1][0],y2=rect[1][1];return xy[0]>=x1&&xy[0]<=x2&&xy[1]<=y2&&xy[1]>=y1};iD.util.getTagMulDatas_POI_TYPE=function(dataList){var result={};var reg=/\B(?=(?:\d{2})+\b)/g;var _keys=_.keys(dataList);for(let i in dataList){let item=dataList[i];if(!item.value){continue}let kname=item.value;let valueName=item.name;let keyNames=kname.split(reg);let tempObj=result,_count=0;for(let idx in keyNames){let key=keyNames[idx];_count++;if(!tempObj[key]){tempObj[key]={name:valueName,value:key,children:{}}}if(_count==keyNames.length){delete tempObj[key].children}tempObj=tempObj[key].children}}return result};iD.util.getIntersectLoc=function(nodes1,nodes2,graph){var locs=[];var lineCal=iD.util.LineCalCulate();var interPoint=[0,0];for(var j=0;j<nodes1.length;j++){if(j+1>nodes1.length-1)break;var nodes1_pre=nodes1[j],nodes1_next=nodes1[j+1],pre_arr1=[nodes1_pre[0],nodes1_pre[1],nodes1_next[0],nodes1_next[1]];for(var k=0;k<nodes2.length;k++){if(k+1>nodes2.length-1)break;var nodes2_pre=graph.entity(nodes2[k]),nodes2_next=graph.entity(nodes2[k+1]),pre_arr2=[nodes2_pre.loc[0],nodes2_pre.loc[1],nodes2_next.loc[0],nodes2_next.loc[1]];var loc=iD.util.extendIntersection(pre_arr1,pre_arr2);if(loc&&iD.util.onLine(pre_arr2,loc)){loc=iD.util.getBetweenPointLoc(nodes2_pre.loc,nodes2_next.loc,loc);locs.push(loc)}}}return locs};iD.util.getSegmentIntersectLoc=function(nodes1,nodes2,graph){var locs=[];var lineCal=iD.util.LineCalCulate();var interPoint=[0,0];for(var j=0;j<nodes1.length;j++){if(j+1>nodes1.length-1)break;var nodes1_pre=nodes1[j],nodes1_next=nodes1[j+1],pre_arr1=[nodes1_pre[0],nodes1_pre[1],nodes1_next[0],nodes1_next[1]];for(var k=0;k<nodes2.length;k++){if(k+1>nodes2.length-1)break;var nodes2_pre=graph.entity(nodes2[k]),nodes2_next=graph.entity(nodes2[k+1]),pre_arr2=[nodes2_pre.loc[0],nodes2_pre.loc[1],nodes2_next.loc[0],nodes2_next.loc[1]];var loc=iD.util.lassExtend.SegmentIntersect(pre_arr1,pre_arr2);if(loc&&iD.util.onLine(pre_arr2,loc)){loc=iD.util.getBetweenPointLoc(nodes2_pre.loc,nodes2_next.loc,loc);locs.push(loc)}}}return locs};iD.util.getIntersectLocByNodes=function(nodes1,nodes2,graph){var locs=[];var lineCal=iD.util.LineCalCulate();var interPoint=[0,0];for(var j=0;j<nodes1.length;j++){if(j+1>nodes1.length-1)break;var nodes1_pre=graph.entity(nodes1[j]),nodes1_next=graph.entity(nodes1[j+1]),pre_arr1=[nodes1_pre.loc[0],nodes1_pre.loc[1],nodes1_next.loc[0],nodes1_next.loc[1]];for(var k=0;k<nodes2.length;k++){if(k+1>nodes2.length-1)break;var nodes2_pre=graph.entity(nodes2[k]),nodes2_next=graph.entity(nodes2[k+1]),pre_arr2=[nodes2_pre.loc[0],nodes2_pre.loc[1],nodes2_next.loc[0],nodes2_next.loc[1]];var loc=iD.util.lassExtend.SegmentIntersect(pre_arr1,pre_arr2);if(loc&&iD.util.onLine(pre_arr2,loc)){loc=iD.util.getBetweenPointLoc(nodes2_pre.loc,nodes2_next.loc,loc);locs.push(loc)}}}return locs};iD.util.linePlaneCross=function(K,R,C,T,pixel,plane_p,plane_n){let vw=iD.util.getPixelDirectionVector(K,R,C,T,pixel);let n1=matrix.subtraction(vw,C);let utmLonlat=iD.util.LLtoUTM_(plane_p[0],plane_p[1]);let X1=[utmLonlat.x,utmLonlat.y,plane_p[2]];let n2=plane_n;let t=(n2[0]*(X1[0]-C[0][0])+n2[1]*(X1[1]-C[1][0])+n2[2]*(X1[2]-C[2][0]))/(n2[0]*n1[0][0]+n2[1]*n1[1][0]+n2[2]*n1[2][0]);let x=C[0][0]+n1[0][0]*t;let y=C[1][0]+n1[1][0]*t;let z=C[2][0]+n1[2][0]*t;let lonlats=UTMtoLL(x,y,iD.AutoMatch.trackPointUTMZone);x=lonlats[0];y=lonlats[1];return[x,y,z]};iD.util.getPixelDirectionVector=function(K,R,C,T,pixel){let u0=K[0][2];let v0=K[1][2];let fx=K[0][0];let fy=K[1][1];let du=pixel[0]-u0;let dv=pixel[1]-v0;let r=Math.sqrt(du*du/(fx*fx)+dv*dv/(fy*fy)+1);let v1=du/fx/r;let v2=dv/fy/r;let v3=1/r;let vc=[[v1],[v2],[v3],[1]];var rt=matrix.addCols(R,T);rt[3]=[];rt[3].push(0);rt[3].push(0);rt[3].push(0);rt[3].push(1);let vw=matrix.multiply(matrix.inverse(rt),vc);vw.pop();return vw};iD.util.currentTrackPointDis=[];iD.util.getTrackPointsByDis=function(currentTrackPoint,trackPoints,dis){let arr=[];let track_point_nums=trackPoints.length;if(!currentTrackPoint.tags){return}let CC=currentTrackPoint.tags.C;let t_index=0,index=-1;trackPoints.filter(function(t){if(t.id==currentTrackPoint.id){index=t_index}t_index++});for(var i=index;i<track_point_nums;i++){let frame_index=i+1;if(1>frame_index||frame_index>track_point_nums-1){let track_point=trackPoints[frame_index-1];arr.push(track_point.loc);iD.util.currentTrackPointDis=arr;return}let track_point=trackPoints[frame_index];let xyz=track_point.tags.C;let X=[[xyz[0][0]],[xyz[1][0]],[xyz[2][0]],[1]];let distance=this.norm(X,CC);if(distance>dis){break}arr.push(track_point.loc)}arr.unshift(currentTrackPoint.loc);iD.util.currentTrackPointDis=arr};iD.util.distanceByLngLat=function(lnglat1,lnglat2){var c=lnglat1[1]*Math.PI/180;var d=lnglat2[1]*Math.PI/180;var a=c-d;var b=(lnglat1[0]-lnglat2[0])*Math.PI/180;var s=6378137*(2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(c)*Math.cos(d)*Math.pow(Math.sin(b/2),2))));return parseFloat(s.toFixed(2))};iD.util.distanceByPixel=function(fromPixel,toPixel){var x=Math.pow(toPixel[0]-fromPixel[0],2);var y=Math.pow(toPixel[1]-fromPixel[1],2);return Math.sqrt(x+y)};iD.util.distanceByLngLats=function(lnglat,lnglats){var disArr=[];let lnglat1=lnglat;for(let i=0;i<lnglats.length;i++){var lnglat2=lnglats[i];var c=lnglat1[1]*Math.PI/180;var d=lnglat2[1]*Math.PI/180;var a=c-d;var b=(lnglat1[0]-lnglat2[0])*Math.PI/180;var s=6378137*(2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(c)*Math.cos(d)*Math.pow(Math.sin(b/2),2))));disArr.push({dis:parseFloat(s.toFixed(2)),index:i})}disArr=_.sortBy(disArr,"dis");return disArr[0]};iD.util.getNearestNode=function(loc,nodes){var dis=0;entityNode=null;for(let i=0;i<nodes.length;i++){var node=nodes[i];let localDis=iD.util.distanceByLngLat(loc,node.loc);if(dis>localDis||0==dis){dis=localDis;entityNode=node}}return entityNode};iD.util.getNearestTracks=function(loc,tracks){var dis=0;_track=null;for(let i=0;i<tracks.length;i++){var track=tracks[i];let localDis=iD.util.distanceByLngLat(loc,track.node.loc);if(dis>localDis||0==dis){dis=localDis;_track=track}}return _track};iD.util.selectNode_Z=function(loc,range){var player=iD.picUtil.player,tracks=player.dataMgr.tracks,resNodes=[];function intersects(extent,nodes){let restArr=[];for(let i=0,len=nodes.length;i<len;i++){let node=nodes[i];if(iD.util.isInsideRect(extent,node.loc)){restArr.push(node)}}return restArr}for(let i=0;i<tracks.length;i++){let track=tracks[i],bounds=iD.util.getBounds(loc,range),allNodes=intersects(bounds,track.nodes).filter(function(entity){return entity&&entity.loc});if(allNodes.length){var obj={nodes:[]};obj.nodes=allNodes;obj.cameraHeight=track.cameraHeight;obj.trackId=track.traceId;resNodes.push(obj)}}return resNodes};iD.util.calculateClockDirection=function(points,isYAxixToDown){let i,j,k;let count=0;let z;let yTrans=isYAxixToDown?-1:1;if(null==points||3>points.length){return null}let n=points.length;for(i=0;i<n;i++){j=(i+1)%n;k=(i+2)%n;z=(points[j][0]-points[i][0])*(points[k][1]*yTrans-points[j][1]*yTrans);z-=(points[j][1]*yTrans-points[i][1]*yTrans)*(points[k][0]-points[j][0]);if(0>z){count--}else if(0<z){count++}}if(0<count){return true}else if(0>count){return false}else{return null}};iD.util.clickPosForTrackPoint=function(pos){let len=iD.util.currentTrackPointDis.length;let dis=-1;let trackPoint=null;let index=0;for(let i=0;i<len;i++){let d=iD.util.distanceByLngLat(iD.util.currentTrackPointDis[i],pos);if(-1==dis||dis>d){dis=d;index=i;trackPoint=iD.util.currentTrackPointDis[i]}}return trackPoint};iD.util.clickPosForTrackPoint2=function(point,pos,height,K){let len=iD.util.currentTrackPointDis.length;let dis=-1;let trackPoint=null;let index=0;for(let i=0;i<len;i++){let loc=iD.util.currentTrackPointDis[i].concat([]);loc[2]=loc[2]-height;let xy=this.trackPointToPicPixe(K,point,loc);let d=Math.abs(xy[1]-pos[1]);if(-1==dis||dis>d){dis=d;index=i;trackPoint=iD.util.currentTrackPointDis[i]}else{break}}return trackPoint};iD.util.nodeIsBreakPoint=function(node,graph){var breakPoint=true;var parentWays=graph.parentWays(node);if(!parentWays.length){return false}parentWays.forEach(function(way){if(way.first()!=node.id&&way.last()!=node.id){breakPoint=false}});return breakPoint};iD.util.calculatePlane=function(track_points,orglng,orglat,beginIndex,useUtm=false){let minLength=Infinity;let minLenIndex=0;let orgutmx,orgutmy;var plane;let utm=iD.util.LLtoUTM_(orglng,orglat);orgutmx=utm.x;orgutmy=utm.y;zoneo=utm.zone;for(let i=beginIndex,len=track_points.length;i<len-1;i++){let start=track_points[i];let end=track_points[i+1];let startUtm=iD.util.LLtoUTM_(start.loc[0],start.loc[1]);let endUtm=iD.util.LLtoUTM_(end.loc[0],end.loc[1]);let Line=[[startUtm.x,startUtm.y],[endUtm.x,endUtm.y]],PtA=[orgutmx,orgutmy];let length=this.pt2LineSegmentDist(Line,PtA);if(length.dis<minLength){minLength=length.dis;minLenIndex=i}}let startIndex=minLenIndex-3;let endIndex=minLenIndex+3;if(0>startIndex)startIndex=0;if(endIndex>=track_points.length)endIndex=track_points.length-1;if(useUtm){let start=track_points[startIndex];let end=track_points[endIndex];let startUtm=iD.util.LLtoUTM_(start.loc[0],start.loc[1]);let endUtm=iD.util.LLtoUTM_(end.loc[0],end.loc[1]);let PtB=new Array(2);let Line=[startUtm.x,startUtm.y,endUtm.x,endUtm.y],PtA=[orgutmx,orgutmy];this.pedal(Line,PtA,PtB);let drooputmx,drooputmy;drooputmx=PtB[0];drooputmy=PtB[1];let v1=[[orgutmx-drooputmx],[orgutmy-drooputmy],[0]];let v2=[[drooputmx],[drooputmy],[10]];let corsscheck=matrix.cross(v2,v1);plane=this.normalizedSqrt(corsscheck)}else{let drooplng,drooplat;let start=track_points[startIndex];let end=track_points[endIndex];let PtB=new Array(2);let Line=[start.loc[0],start.loc[1],end.loc[0],end.loc[1]],PtA=[orglng,orglat];this.pedal(Line,PtA,PtB);drooplng=PtB[0];drooplat=PtB[1];let v1=[[orglng-drooplng],[orglat-drooplat],[0]];let v2=[[drooplng],[drooplat],[0.1]];let corsscheck=matrix.cross(v2,v1);plane=this.normalizedSqrt(corsscheck)}if(0>plane[2]||1>plane[2]){plane[2]=0}if(1<plane[2]){plane[2]=1}return plane};iD.util.pedal=function(Line,PtA,PtB){let x1=Line[0],y1=Line[1],x2=Line[2],y2=Line[3];let x0=PtA[0],y0=PtA[1];if(x2==x1){PtB[0]=x1;PtB[1]=PtA[1]}else{let k=(y2-y1)/(x2-x1);let A=k;let B=-1;let C=y1-x1*k;let x=(B*B*x0-A*B*y0-A*C)/(A*A+B*B);let y=(-A*B*x0+A*A*y0-B*C)/(A*A+B*B);PtB[0]=x;PtB[1]=y}let dx=PtA[0]-PtB[0];let dy=PtA[1]-PtB[1];return dx*dx+dy*dy};iD.util.perpendicular=function(p,s,e){var r,x,y;r=this.relation(p,s,e);x=s[0]+r*(e[0]-s[0]);y=s[1]+r*(e[1]-s[1]);return[x,y]};iD.util.relation=function(p,s,e){return this.dotmultiply(p,e,s)/(this.dist(s,e)*this.dist(s,e))};iD.util.dotmultiply=function(p1,p2,p0){return(p1[0]-p0[0])*(p2[0]-p0[0])+(p1[1]-p0[1])*(p2[1]-p0[1])};iD.util.dist=function(p1,p2){return Math.sqrt((p1[0]-p2[0])*(p1[0]-p2[0])+(p1[1]-p2[1])*(p1[1]-p2[1]))};iD.util.DouglasPeucker={getProcessPoints:function(points,tolerance=3){if(!_.isArray(points)||!points.length){return[]}if(3>points.length)return points;var firstPoint=0,lastPoint=points.length-1;var pointIndexsToKeep=[];pointIndexsToKeep.push(firstPoint);pointIndexsToKeep.push(lastPoint);while(points[firstPoint]==points[lastPoint]){lastPoint--}this.reduce(points,firstPoint,lastPoint,tolerance,pointIndexsToKeep);var resultPoints=[];pointIndexsToKeep.sort(function(a,b){return a-b});for(var i=0;i<pointIndexsToKeep.length;i++){resultPoints.push(points[pointIndexsToKeep[i]])}return resultPoints},reduce:function(points,firstPoint,lastPoint,tolerance,pointIndexsToKeep){var maxDis=0,idxFarthest=0;for(var i=firstPoint,dis;i<lastPoint;i++){dis=this.perpendicularDistance(points[firstPoint],points[lastPoint],points[i]);if(dis>maxDis){maxDis=dis;idxFarthest=i}}if(maxDis>tolerance&&0!=idxFarthest){pointIndexsToKeep.push(idxFarthest);this.reduce(points,firstPoint,idxFarthest,tolerance,pointIndexsToKeep);this.reduce(points,idxFarthest,lastPoint,tolerance,pointIndexsToKeep)}},perpendicularDistance:function(beginPoint,endPoint,comparePoint){var area=Math.abs(0.5*(beginPoint[0]*endPoint[1]+endPoint[0]*comparePoint[1]+comparePoint[0]*beginPoint[1]-endPoint[0]*beginPoint[1]-comparePoint[0]*endPoint[1]-beginPoint[0]*comparePoint[1]));var bottom=Math.sqrt(Math.pow(beginPoint[0]-endPoint[0],2)+Math.pow(beginPoint[1]-endPoint[1],2));var height=2*(area/bottom);return height}};iD.util.lineClip=function(line,rect){let xmin=rect[0][0],ymin=rect[0][1],xmax=rect[1][0],ymax=rect[1][0];let points=[];var arr;var clieLine;for(let i=0,len=line.length-1;i<len;i++){arr=[line[i],line[i+1]];clieLine=this.cohenSutherlandLineClip(arr,xmin,ymin,xmax,ymax);if(clieLine){points.push(clieLine[0])}}return points};iD.util.cohenSutherlandLineClip=function(line,xmin,ymin,xmax,ymax){var x0=line[0][0],y0=line[0][1],x1=line[1][0],y1=line[1][1];const INSIDE=0;const LEFT=1;const RIGHT=2;const BOTTOM=4;const TOP=8;function computeOutCode(x,y){let code;code=INSIDE;if(x<xmin)code|=LEFT;else if(x>xmax)code|=RIGHT;if(y<ymin)code|=BOTTOM;else if(y>ymax)code|=TOP;return code}let outcode0=computeOutCode(x0,y0);let outcode1=computeOutCode(x1,y1);let accept=false;let x,y;let outcodeOut;while(true){if(!(outcode0|outcode1)){return[[x0,y0],[x1,y1]];break}else if(outcode0&outcode1){return null}else{outcodeOut=outcode0?outcode0:outcode1;if(outcodeOut&TOP){x=x0+(x1-x0)*(ymax-y0)/(y1-y0);y=ymax}else if(outcodeOut&BOTTOM){x=x0+(x1-x0)*(ymin-y0)/(y1-y0);y=ymin}else if(outcodeOut&RIGHT){y=y0+(y1-y0)*(xmax-x0)/(x1-x0);x=xmax}else if(outcodeOut&LEFT){y=y0+(y1-y0)*(xmin-x0)/(x1-x0);x=xmin}if(outcodeOut==outcode0){x0=x;y0=y;outcode0=computeOutCode(x0,y0)}else{x1=x;y1=y;outcode1=computeOutCode(x1,y1)}}}return[[x0,y0],[x1,y1]]};iD.util.goldenRatioColor=function(saturation,value){function _goldenRatioColor(saturation,value){var _goldenRatio=0.618033988749895;var _hue=Math.random();_hue+=_goldenRatio;_hue%=1;if("number"!==typeof saturation)saturation=0.5;if("number"!==typeof value)value=0.95;return[360*_hue,100*saturation,100*value]}function hsv2rgb(hsv){var h=hsv[0]/60;var s=hsv[1]/100;var v=hsv[2]/100;var hi=Math.floor(h)%6;var f=h-Math.floor(h);var p=255*v*(1-s);var q=255*v*(1-s*f);var t=255*v*(1-s*(1-f));v=255*v;switch(hi){case 0:return[v,t,p];case 1:return[q,v,p];case 2:return[p,v,t];case 3:return[p,q,v];case 4:return[t,p,v];case 5:return[v,p,q];}}function rgb2hex(r,g,b){return"#"+((256+r<<8|g)<<8|b).toString(16).slice(1)}let hsv=_goldenRatioColor(saturation,value);let color=hsv2rgb(hsv);return rgb2hex(color[0],color[1],color[2])};iD.util.compareColorSimilar=function(hex1,hex2){function rgb2hsv(rgb){var r=rgb[0],g=rgb[1],b=rgb[2],min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min,h,s,v;if(0===max)s=0;else s=1000*(delta/max)/10;if(max==min)h=0;else if(r==max)h=(g-b)/delta;else if(g==max)h=2+(b-r)/delta;else if(b==max)h=4+(r-g)/delta;h=Math.min(60*h,360);if(0>h)h+=360;v=1000*(max/255)/10;return[h,s,v]}function hex2rgb(a){a=0|"0x"+a.slice(1).replace(4<a.length?a:/./g,"$&$&");return[a>>16,255&a>>8,255&a]}let hsv1=rgb2hsv(hex2rgb(hex1)),hsv2=rgb2hsv(hex2rgb(hex2));let abs=Math.abs;let maxh=Math.max(hsv1[0],hsv2[0]),minh=Math.min(hsv1[0],hsv2[0]);if(345<=maxh&&15>=minh){maxh=360-maxh}let dh=abs(maxh-minh);let ds=abs(hsv1[1]-hsv2[1]);let dv=abs(hsv1[2]-hsv2[2]);let count=dh/10+ds/10+dv/10;let distance=2;let maxs=Math.max(hsv1[1],hsv2[1]),maxv=Math.max(hsv1[2],hsv2[2]);if(40>maxs){distance/=2}if(10>maxv){distance*=10}else if(30>maxv){distance*=3}else if(50>maxv){distance*=1.5}return count<distance};iD.util.randomColorList=function(){let colorList=["#FFFFCD","#FF0000","#FFFF00","#E3170D","#FF9912","#E3CF57","#FFD700","#FF6347","#FFC0CB","#FFE384","#B0171F","#FF8000","#FF00FF","#8B864E","#00FF00","#802A2A","#00FFFF","#C76114","#F4A460","#40E0D0","#D2B48C","#082E54","#BC8F8F","#228B22","#A0522D","#6B8E23","#0000FF","#03A89E","#DA70D6","#191970","#8A2BE2","#00C78C","#9933FA","#F0FFFF","#FCE6C9","#666666","#808A87","#CCCCCC","#808069","#000000"];let _index=-1;function index(){let nindex=++_index;if(nindex>colorList.length-1){nindex=_index=-1}return nindex}return{get:function(){let c=colorList[index()];return c},reset:function(){_index=-1}}};iD.util.roundNumber=function(num){num=+num;return 0.5+num<<0};iD.util.setLayerLabelField=function(layer){if(!layer.label){layer.label={display:false}}if(2==window._systemType||1==window._systemType){layer.label=layer.label||{};layer.label.displayMap={};layer.label.displayMap[iD.data.DataType.LAMPPOST]=true;layer.label.displayMap[iD.data.DataType.TRAFFICLIGHT]=true;layer.label.displayMap[iD.data.DataType.LIMITHEIGHT]=true}else{if(_.include([iD.data.DataType.LAMPPOST,iD.data.DataType.TRAFFICLIGHT,iD.data.DataType.LIMITHEIGHT],layer.models.datas[0])){layer.label.display=true}}};iD.util.getBetweenPointLoc=function(floc,tloc,loc){var diffValZ=tloc[2]-floc[2];var newDiffValZ=0;if(floc[0]==tloc[0]){newDiffValZ=diffValZ*Math.abs(floc[1]-loc[1])/Math.abs(floc[1]-tloc[1])}else{newDiffValZ=diffValZ*Math.abs(floc[0]-loc[0])/Math.abs(floc[0]-tloc[0])}var result=[loc[0],loc[1],floc[2]+newDiffValZ];var maxZ=_.max([tloc[2],floc[2]]),minZ=_.min([tloc[2],floc[2]]);if(result[2]>maxZ)result[2]=maxZ;if(result[2]<minZ)result[2]=minZ;return result};iD.util._Util={_cars:null,_2To16:function(v){return parseInt(v,2).toString(16).toUpperCase()},_16To2:function(v){return parseInt(v,16).toString(2)},_2To10:function(v){return parseInt(v,2).toString(10)},_10To2:function(v){return parseInt(v,10).toString(2)},_createHexadecimalBySelectedCars:function(ids){var temp=[];for(var i=0;32>i;i++){temp.push(0)}_(ids).each(function(id){temp[id]=1});return this._2To16(temp.reverse().join(""))},_getCarNamesByHexadecimal:function(v){var array=[],v=v&&this._16To2(v)||"";for(var i=0,l=v.length;i<l;i++){if(1===parseInt(v[i],10)){var obj=this.searchCar(l-1-i);if(obj){array.push(obj)}}}return array},searchCar:function(i){var obj;var cars=_.map(iD.ui.RoadRule.CarList.carOptions,function(item){return _.assign({},item,{name:item.label})});_(cars).each(function(item){if(item.id===i){obj=item;return false}});return obj},_getWeatherTypesByCode:function(v){var weathers=[];if(!v)return weathers;var arr=v.split("");for(var i=0;i<arr.length;i++){if("1"==arr[i]){if(0==i){weathers.push("sunny")}else if(1==i){weathers.push("rain")}else if(2==i){weathers.push("ice")}else if(3==i){weathers.push("fog")}else if(4==i){weathers.push("wind")}}}return weathers},_getWeatherNamesByCode:function(v){var weathers=this._getWeatherTypesByCode(v);return _.compact(_.map(weathers,this.searchWeather,this))},searchWeather:function(type){var obj;_(iD.ui.RoadRule.Weather.weatherOptions).each(function(d){if(d.name==type){obj=d;return false}});return obj}};iD.util.hasSameNode=function(wayA,wayB){for(var i=0;i<wayA.nodes.length;i++){var nodeId1=wayA.nodes[i];for(var j=0;j<wayB.nodes.length;j++){var nodeId2=wayB.nodes[j];if(nodeId1==nodeId2){return nodeId1}}}return false};iD.util.taskUpdateScene=function(context){var task=iD.Task.d;var sceneCode=task&&task.tags.sceneCode;var editParam=context.variable.edit;editParam.editDivider=true;editParam.editOther=true;if(!task||!sceneCode){context.event.change_scene();return}if(sceneCode==iD.data.sceneCode.HD_DATA_LANE){editParam.editDivider=true;editParam.editOther=false}else if(sceneCode==iD.data.sceneCode.HD_DATA_LO){editParam.editDivider=false;editParam.editOther=true}context.event.change_scene()};iD.util.isInitTrackPointByUrl=function(trackList){if(!iD.util.isLocateTrackPointUrl())return false;var trackIds=iD.url.getUrlParam("trackIds");trackIds=trackIds.split(",");var trackPointId=iD.url.getUrlParam("trackPointId");var taskId=iD.url.getUrlParam("taskID");if(!taskId||!iD.Task.d||iD.Task.d.task_id!=taskId)return false;var index=-1,trackObj;for(var track of trackList){if(track.trackId==trackIds[0]){index=_.pluck(track.nodes,"id").indexOf(trackPointId);trackObj=track}}if(-1==index)return false;return{track:trackObj,index:index}};iD.util.isLocateTrackPointUrl=function(){var trackIds=iD.url.getUrlParam("trackIds");if(!trackIds)return false;trackIds=trackIds.split(",");if(1<trackIds.length)return false;var trackPointId=iD.url.getUrlParam("trackPointId");if(!trackPointId)return false;var taskId=iD.url.getUrlParam("taskID");if(!taskId)return false;return true};iD.util.getModelNameByItem=function(collection,modelName){for(let i in collection){if(i==modelName){return true}}return false};iD.util.getSceneModel=function(sceneCode){if(!sceneCode&&iD.Task&&iD.Task.d){sceneCode=iD.Task.d.tags.sceneCode||""}return iD.data.sceneDataType[sceneCode]||[]};iD.util.modelSceneEditable=function(models,context){var sceneCode=iD.Task.d&&iD.Task.d.tags.sceneCode||"";var editVar=context.variable.edit;if(!sceneCode)return true;if(editVar.editDivider&&editVar.editOther)return true;if(!models)return false;if(!_.isArray(models)){models=[models]}var laneModels=iD.util.getSceneModel(iD.data.sceneCode.HD_DATA_LANE);var otherModels=iD.util.getSceneModel(iD.data.sceneCode.HD_DATA_LO);var noedit=false;var islane=0<_.intersection(laneModels,models).length,isother=0<_.intersection(otherModels,models).length;if(!editVar.editDivider){noedit=islane}else if(!editVar.editOther){noedit=isother}if(islane&&isother){noedit=false}return!noedit};iD.util.whichTransitionEndEvent=function(element,func,context){var t,transitions={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};var eventName;for(t in transitions){if(element.style[t]!==undefined){eventName=transitions[t];break}}function evtFun(){func&&func.call(context&&context||element);element.removeEventListener(eventName,arguments.callee,false)}if(eventName){element.removeEventListener(eventName,evtFun);element.addEventListener(eventName,evtFun)}};iD.util.saveCheckEntity=function(context){var wayList=[];var $dom=d3.select("#save-checklist-div");if(!$dom.size()){$dom=d3.select("body").append("div").attr("id","save-checklist-div");$dom.append("div").attr("class","save-check-list");$dom.append("div").attr("class","save-checklist-close").html("&times;")}var $list=$dom.select(".save-check-list");var $close=$dom.select(".save-checklist-close");var dataList=[];var DIVIDER_LENGTH_LIMIT=1000;function locateEntity(entity){if(!context.hasEntity(entity.id)){return}if(entity instanceof iD.Way){var node=context.entity(entity.nodes[0]);var map=context.map();if(map.zoom()<context.options.editableLevel){map.centerZoom(node.loc,context.options.editableLevel)}else{map.center(node.loc)}context.enter(iD.modes.Select(context,[entity.id],null,true).suppressMenu(false).newFeature(true))}}var saveTool={clear:function(){$list.html("");dataList.length=0},close:function(){this.clear();$dom.style("display","none")},show:function(){var self=this;var $itemList=$list.selectAll("div.list-item").data(dataList);var $items=$itemList.enter().append("div").attr("class","list-item");$items.append("div").attr("class","item-prefix").text(function(d){return(d.distance/1000).toFixed(2)+"km"});$items.append("div").attr("class","item-left").text(function(d){return"\u8F66\u9053\u7EBF: "+iD.Entity.id.toOSM(d.entity.id)});$items.append("button").attr("type","button").text(function(d){return"\u5B9A\u4F4D"}).on("click",function(d){locateEntity(d.entity)});$itemList.exit().remove();$close.on("click",function(){self.close()});$dom.style("display","block")},checkLimitDivider:function(ways){this.clear();let wayMap={};ways.forEach(function(way){if(wayMap[way.id])return;if(way.modelName!=iD.data.DataType.DIVIDER)return;var flag=iD.util.entityInPlyGon(way,context);if(!flag)return;var dis=0;for(let i=0;i<way.nodes.length-1;i++){let node1=context.entity(way.nodes[i]);let node2=context.entity(way.nodes[i+1]);dis+=iD.util.distanceByLngLat(node1.loc,node2.loc)||0;if(node2.id==_.last(way.nodes)&&dis>=DIVIDER_LENGTH_LIMIT){dataList.push({entity:way,distance:dis});wayMap[way.id]=true}}});return 0<dataList.length}};return saveTool};iD.util.getSpeed=function(point,allNodes,range=10,direction=1){if(!point||!_.isArray(allNodes))return 0;let distance=0,index=allNodes.indexOf(point),e,s=point;while(0<=index&&index<allNodes.length){index+=direction;e=allNodes[index];distance+=iD.geo.sphericalDistance(s.loc,e.loc);if(distance>=range){break}s=e}if(e){let sDate=new Date(point.tags.locTime),eDate=new Date(e.tags.locTime);let second=Math.abs(sDate-eDate)/1000;secondSpeed=distance/second}return(3.6*secondSpeed).toFixed(2)+"/h"};iD.util.getFeatureByBounds=function(bounds){var allEntities=editor.context.intersects(bounds)};iD.util.calculateBounds=function(path){var self=this;var bounds={southwest:[],northeast:[]};bounds["southwest"]=[path[0][0],path[0][1]];bounds["northeast"]=[path[0][0],path[0][1]];;var sw=bounds["southwest"];var ne=bounds["northeast"];for(var i=1,l=path.length;i<l;++i){sw[0]=Math.min(sw[0],path[i][0]);sw[1]=Math.min(sw[1],path[i][1]);ne[0]=Math.max(ne[0],path[i][0]);ne[1]=Math.max(ne[1],path[i][1])}return[bounds.southwest,bounds.northeast]};iD.util.tagChanged=function(base,change){if(!base||!change)return false;var bkeys=_.keys(base),ckeys=_.keys(change);if(!bkeys.length&&!ckeys.length)return false;if(bkeys.length<ckeys.length)return true;var cdiff=_.difference(ckeys,bkeys);if(cdiff.length)return true;var flag=false;for(var key in base){if(!base.hasOwnProperty(key)){continue}if(!change.hasOwnProperty(key)){continue}if(base[key]!=change[key]){flag=true;break}}return flag};;iD.util=iD.util||{};iD.util.Cbn=function(Roll,Pitch,Yaw){var r1=matrix.multiply(this.Rz(Yaw),this.Ry(Pitch));return matrix.multiply(r1,this.Rx(Roll))};iD.util.Rz=function(angle){let rad=Math.PI*angle/180;let R=[[Math.cos(rad),-Math.sin(rad),0],[Math.sin(rad),Math.cos(rad),0],[0,0,1]];return R};iD.util.Rx=function(angle){let rad=Math.PI*angle/180;let R=[[1,0,0],[0,Math.cos(rad),-Math.sin(rad)],[0,Math.sin(rad),Math.cos(rad)]];return R};iD.util.Ry=function(angle){let rad=Math.PI*angle/180;let R=[[Math.cos(rad),0,Math.sin(rad)],[0,1,0],[-Math.sin(rad),0,Math.cos(rad)]];return R};iD.util.pos2CameraRTC=function(pos,pos0,height){let B=pos.y;let L=pos.x;let H=height;let B0=pos0.y;let L0=pos0.x;let Roll=pos.roll;let Pitch=pos.pitch;let Azimuth=pos.azimuth;let utm=iD.util.LLtoUTM_(L,B);let X=utm.x,Y=utm.y,UTMZone=utm.zone;let ZoneNumber=UTMZone;let LongOrigin=6*(ZoneNumber-1)-180+3;let L0GK=LongOrigin;let R_i_c=[[0,0,1],[1,0,0],[0,1,0]];var R_b_n=this.Cbn(Roll,Pitch,Azimuth);var R_n_E=matrix.multiply(this.Rz(L),matrix.transpose(this.Ry(B+90)));var R_Ec_m=matrix.multiply(matrix.transpose(this.Rx(90-B0)),matrix.transpose(this.Rz(90+L0)));var R_m0_m=[[1,Math.PI*(L0-L0GK)/180*Math.sin(Math.PI*B/180),-Math.PI*(L0-L)/180*Math.cos(Math.PI*B/180)],[-Math.PI*(L0-L0GK)/180*Math.sin(Math.PI*B/180),1,Math.PI*(B-B0)/180],[Math.PI*(L0-L)/180*Math.cos(Math.PI*B/180),-Math.PI*(B-B0)/180,1]];var R_m_m0=matrix.transpose(R_m0_m);var R_E_Ec=matrix.identity(3);var R_c_b=matrix.identity(3);var t1=matrix.multiply(R_m_m0,R_Ec_m);var t2=matrix.multiply(t1,R_E_Ec);var t3=matrix.multiply(t2,R_n_E);var t4=matrix.multiply(t3,R_b_n);var t5=matrix.multiply(t4,R_c_b);var R_i_m0=matrix.multiply(t5,R_i_c);var R2=matrix.transpose(R_i_m0);R=R2;C=[[X],[Y],[H]];T=matrix.multiply(matrix.scalar(_.cloneDeep(R),-1),C);return{R,T,C,UTMZone}};iD.util.coordinates={length:function(p1,p2){return iD.util.norm(p1,p2)},xyz2Pixel:function(P,X){let _x=_.cloneDeep(X);matrix.homogeneous(_x);let x=matrix.multiply(P,_x);let x1=iD.util.hnormalized(x);return x1}};iD.util.processGroundPlaneFrame=function(planeFrame,K,points,tgpps){let start_frame_id=planeFrame.frameId;let max_frame_id=points.length-1;let min_y=1024;let max_y=2048;let max_x=2448;let max_distance=50;let prev_frame_id=-1;let prev_y=-1;let prev_x=-1;let current_y=-1;let current_x=-1;let current_frame_id=-1;var current_distance=10000;var prev_c0,prev_n,current_c0,current_n;let last_y=-1;let current_pos=points[start_frame_id-1].tags;let p=iD.util.KRt(K,current_pos.R,current_pos.T);let fids=_.pluck(tgpps,"frameId");for(let i=start_frame_id+1;i<=max_frame_id;i++){let pos=points[i-1].tags;let distance=iD.util.coordinates.length(pos.C,current_pos.C);let tgobj=tgpps[fids.indexOf(i)];if(!tgobj)continue;let tgpp=tgobj.groundHeights;if(1==tgpp.status){var pixel;let _c=[[tgpp.C[0]],[tgpp.C[1]],[tgpp.C[2]]];pixel=iD.util.coordinates.xyz2Pixel(p,_c);current_y=pixel[1];current_x=pixel[0];current_frame_id=i;current_distance=distance;current_c0=_c;current_n=[[tgpp.N[0]],[tgpp.N[1]],[tgpp.N[2]]];if(pixel[1]>=min_y&&pixel[1]<=max_y&&0<=pixel[0]&&pixel[0]<=max_x){if(-1!=prev_y){let delta_y=current_y-prev_y;let pos_distance=iD.util.coordinates.length(current_c0,prev_c0);let pos_direction=iD.util.normalizedSqrt(matrix.subtraction(current_c0,prev_c0));let dir_distance=iD.util.coordinates.length(current_n,prev_n);let dir_direction=iD.util.normalizedSqrt(matrix.subtraction(current_n,prev_n));if(0>delta_y){for(let y=prev_y;y>=current_y;y--){if(y>=min_y&&y<=max_y){let p_d=pos_distance*(y-prev_y)/delta_y;let d_d=dir_distance*(y-prev_y)/delta_y;let c0=matrix.addition(prev_c0,matrix.scalar([[pos_direction[0]],[pos_direction[1]],[pos_direction[2]]],p_d));let n=matrix.addition(prev_n,matrix.scalar([[dir_direction[0]],[dir_direction[1]],[dir_direction[2]]],d_d));let sgp={C0:c0,N:n,nearest_frame_id:2*y>delta_y?i:prev_frame_id};planeFrame.pix_y_planes.set(y,sgp);last_y=y}}}else{}}}if(0<current_y&&current_y<min_y||distance>max_distance){break}prev_y=parseInt(pixel[1]);prev_x=parseInt(pixel[0]);prev_frame_id=i;prev_c0=current_c0;prev_n=current_n}}if(prev_y>min_y&&current_y<min_y&&0<=current_x&&current_x<=max_x&&0<=prev_x&&prev_x<=max_x&&current_distance<max_distance){let delta_y=current_y-prev_y;if(0!=delta_y){let pos_distance=iD.util.coordinates.length(current_c0,prev_c0);let pos_direction=iD.util.normalizedSqrt(matrix.subtraction(current_c0,prev_c0));let dir_distance=iD.util.coordinates.length(current_n,prev_n);let dir_direction=iD.util.normalizedSqrt(matrix.subtraction(current_n,prev_n));for(let y=prev_y;y>=current_y;y--){if(y>=min_y&&y<=max_y){let c0=matrix.addition(prev_c0,matrix.scalar([[pos_direction[0]],[pos_direction[1]],[pos_direction[2]]],pos_distance*(y-prev_y)/delta_y));let n=matrix.addition(prev_n,matrix.scalar([[dir_direction[0]],[dir_direction[1]],[dir_direction[2]]],dir_distance*(y-prev_y)/delta_y));let sgp={C0:c0,N:n,nearest_frame_id:2*y>delta_y?current_frame_id:prev_frame_id};planeFrame.pix_y_planes.set(y,sgp);last_y=y}}}}planeFrame.min_pix_y=last_y};iD.util.SimpleGroundPlaneMeasurer=function(frame_id,pixel,find_it,points,K){function linePlaneCross(K,R,C,T,pixel,plane_p,plane_n){let vw=iD.util.getPixelDirectionVector(K,R,C,T,pixel);let n1=matrix.subtraction(vw,C);let X1=plane_p;let n2=plane_n;let t=(n2[0]*(X1[0]-C[0][0])+n2[1]*(X1[1]-C[1][0])+n2[2]*(X1[2]-C[2][0]))/(n2[0]*n1[0][0]+n2[1]*n1[1][0]+n2[2]*n1[2][0]);let x=C[0][0]+n1[0][0]*t;let y=C[1][0]+n1[1][0]*t;let z=C[2][0]+n1[2][0]*t;return[x,y,z]}if(!find_it)return false;let frame_nums=points.length;if(1<=frame_id&&frame_id<=frame_nums){let pos=points[frame_id-1];let y=pixel[1];if(y<find_it.min_pix_y||!find_it){return false}let find_plane_it=find_it.pix_y_planes.get(y);if(!find_plane_it){return false}keys=Array.from(find_it.pix_y_planes.keys()).sort(function(a,b){return a-b});if(find_plane_it!=find_it.pix_y_planes.get(_.last(keys))){let xyzUTM=linePlaneCross(K,pos.tags.R,pos.tags.C,pos.tags.T,pixel,find_plane_it.C0,find_plane_it.N);let latLng=UTMtoLL(xyzUTM[0],xyzUTM[1],iD.AutoMatch.trackPointUTMZone);let xyz={lng:latLng[0],lat:latLng[1],elevation:xyzUTM[2]};let select_frame_id=find_plane_it.nearest_frame_id;return xyz;return{xyzUTM,xyz,select_frame_id}}}return false};iD.util.updatePointT=function(p,C){p.tags.T=matrix.multiply(matrix.scalar(_.cloneDeep(p.tags.R),-1),C)};iD.util.SquareBezier=function(start_point,crt_point,end_point){var p_start=[0,0];var p_end=[];p_start=start_point;p_end=end_point;var p_crt1=crt_point;let getPoint=function(t){var _matrix1=[1,t,t*t];var _matrix2=[[1,0,0],[-2,2,0],[1,-2,1]];var _matrix3=[[p_start[0],p_start[1]],[p_crt1[0],p_crt1[1]],[p_end[0],p_end[1]]];var _matrix_tmp=[_matrix1[0]*_matrix2[0][0]+_matrix1[1]*_matrix2[1][0]+_matrix1[2]*_matrix2[2][0],_matrix1[0]*_matrix2[0][1]+_matrix1[1]*_matrix2[1][1]+_matrix1[2]*_matrix2[2][1],_matrix1[0]*_matrix2[0][2]+_matrix1[1]*_matrix2[1][2]+_matrix1[2]*_matrix2[2][2]];var _matrix_final=[_matrix_tmp[0]*_matrix3[0][0]+_matrix_tmp[1]*_matrix3[1][0]+_matrix_tmp[2]*_matrix3[2][0],_matrix_tmp[0]*_matrix3[0][1]+_matrix_tmp[1]*_matrix3[1][1]+_matrix_tmp[2]*_matrix3[2][1]];var _res_point=[_matrix_final[0],_matrix_final[1]];let z=iD.util.getBetweenPointLoc(start_point,end_point,_res_point);_res_point.push(z[2]);return _res_point};return getPoint};iD.util.getSquareBezier=function(_start_point,_end_point,_crt_point1){var _bezier=this.SquareBezier(_start_point,_crt_point1,_end_point);let locs=[];var _now_t=0.01;while(1>_now_t){sqrt_showing=false;locs.push(_bezier(_now_t));_now_t=_now_t+0.05}return locs};;iD.url=iD.url||{};var dataLayerIds=window.dataLayerIds=new Object;iD.url.getURL=function(){return{forward_intersection:"http://192.168.5.34:30430/service/frontintersect",kcs_edit:"http://192.168.5.34:33530/kcs-edit/",kd_auth_server:"http://192.168.5.34:33920/kd-auth-server/",kds_data:"http://192.168.5.34:33210/kds-data/",kds_meta:"http://192.168.5.34:33200/kds-meta/",kds_tag:"http://192.168.5.34:33240/kds-tag/",krs:"http://192.168.5.34:33100/krs/",kts:"http://192.168.5.34:33300/kts/",kus:"http://192.168.5.34:33400/",zed_measure:"http://192.168.5.34:30310/",measure:"http://192.168.5.34:9530/service/measure/",fusion:"http://192.168.5.34:33300/kts/task/serviceInfo",compareRecog:"http://192.168.5.34:37510/recog-contrast/index.html",track_image:null}};iD.url.getBGURL=function(){return{kd_map:"http://192.168.5.30:{switch:4002,4003,4004}/{z}/{x}/{y}.png",kd_picture:"https://ecn.t{switch:0,1,2,3}.tiles.virtualearth.net/tiles/a{u}.jpeg?g=587&mkt=en-gb&n=z",mapbox:"https://{switch:a,b,c,d}.tiles.mapbox.com/v4/digitalglobe.316c9a2e/{zoom}/{x}/{y}.png?access_token=pk.eyJ1IjoiZGlnaXRhbGdsb2JlIiwiYSI6ImNqOGRmNXltOTBucm0yd3BtY3E5czl6NmYifQ.qJJsPgCjyzMCm3YG3YWQBQ",google:"http://192.168.5.30:{switch:4006,4007,4008}/vt/lyrs=m@167000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}"}};iD.url.getUrlParam=function(key,url,toDecode){var json=iD.url.urlParamMap(url,toDecode);return json.search[key]||""};iD.url.urlParamMap=function(url,toDecode){url=url||window.location.href;var result={param:{},hash:{},search:{}};var rst=url.split(/(\?|#)/);if(-1<url.indexOf("?")){_fillMap(rst[2],"param");_fillMap(rst[4],"hash")}else if(-1<url.indexOf("#")){_fillMap(rst[2],"hash")}var searchParam=(rst[2]||"")+"&"+(rst[4]||"");_fillMap(searchParam,"search");function _fillMap(kvStr,type){if(!kvStr){return}var kvArr=kvStr.split("&");var dataObj=result[type];for(var i in kvArr){var item=kvArr[i].split("=");if(!item||2!=item.length){continue}if(null!=item[1]&&toDecode){item[1]=decodeURIComponent(item[1])}var oldVal=dataObj[item[0]];if(oldVal&&"string"===typeof oldVal){var narr=dataObj[item[0]]=[];narr.push(oldVal);narr.push(item[1])}else if(oldVal&&oldVal instanceof Array){oldVal.push(item[1])}else{dataObj[item[0]]=item[1]}}}return result};;(function(){iD.util.parse2SystypeParam()})();iD.queryUserId=1;iD.config={URL:iD.url.getURL(),BG_URL:iD.url.getBGURL(),layers:[],updateConfigUrl:function(urlObj){Object.assign(iD.config.URL,urlObj);var trackImg=iD.config.URL.track_image;trackImg="string"!==typeof trackImg?"":trackImg;if(""==trackImg.trim()){iD.config.URL.track_image=iD.config.URL.krs}},allLayerIds:[],taskBatch:[],batchDbCode:{},trackBatchMap:{},isOwnBatch:function(batch){if(!batch)return false;var flag=true;if(iD.Task.d.tags.compareBatch){flag=iD.Task.d.tags.compareBatch!=batch}if(!flag)return flag;if(iD.Task.d.tags.multiSourceBatchs){var batchs=iD.Task.d.tags.multiSourceBatchs.split(",");flag=-1==batchs.indexOf(batch)}return flag},getOwnBatchs:function(){var self=this;return self.taskBatch.filter(function(batch){return self.isOwnBatch(batch)})},isMultiBatchesMode:function(){var ownBatchs=this.getOwnBatchs();if(iD.util.urlParamHistory()){if(1<ownBatchs.length){return true}}else if(iD.User.isMultiBatchesRole()){return true}return false},getBboxUrl:function(batch){var task_id=iD.Task.d.task_id||"-1";var kvparam="";var ownBatchs=this.getOwnBatchs();if(this.isOwnBatch(batch)){if(this.isMultiBatchesMode()){kvparam="k=BATCH&v="+batch}}else if(batch){kvparam="k=BATCH&v="+batch}return iD.config.URL.kds_data+"data/task/"+iD.Task.taskId(batch)+"/"+iD.Task.dbCode(batch)+"/bbox?"+kvparam},createDataLayer:function(element,models,mainModel){let batch=element.batch?element.batch:"";var batchVal=batch.replace(/-/g,"_");var url=this.getBboxUrl(batchVal);let layer=new DataLayer({id:element.layerId,editable:element.editable,display:element.display,type:"line",defaultColor:element.defaultColor,useEditColor:element.useEditColor,tagReadOnly:element.tagReadOnly,models,url:url,label:{display:false},batch:batchVal});iD.util.setLayerLabelField(layer);return layer},resetDataLayer:function(){var self=this;let mainMode=iD.data.DataType.ROAD;let layers=[];iD.config.layers=[];editor.removeALLDataLayer();mainMode=iD.data.DataType.DIVIDER;var elements=iD.Static.layersInfo.getElements();if(elements){for(let e in elements){let element=elements[e];if(element.batch){var modelsconfig=self.getModelsConfig(element,mainMode);var layer=iD.config.createDataLayer(element,modelsconfig,mainMode);updateEditLock(layer);layers.push(layer)}else{var modelName=element.children[0];var modelsObj=self.getModelsData(element,element.children||[]);var layer=iD.config.createDataLayer(_.extend({},element,{layerId:modelName}),modelsObj,modelName);layers.push(layer)}};}function updateEditLock(layer){if(!iD.User.isLinearRole()){return}for(let modelName in layer.models.datas){if(!_.include([iD.data.DataType.DIVIDER,iD.data.DataType.DIVIDER_NODE,iD.data.DataType.R_DIVIDER_DREF],modelName)){layer.models.datas[modelName].editable=undefined;layer.models.datas[modelName].editlock=true}}}editor.addDataLayer(layers);editor.getDataLayers().forEach(l=>{let _modelEntitys={};for(let mname in l.models.datas){_modelEntitys[mname]=iD.ModelEntitys[mname]}l.modelEntity(_modelEntitys)})},getModelsConfig:function(element,type){let models={},context=editor.context,self=this;if(type==iD.data.DataType.DIVIDER){if(context.variable.edit.editDivider&&context.variable.edit.editOther){models=iD.Static.fusionModels}else if(context.variable.edit.editDivider){models=iD.data.sceneDataType.HD_DATA_LANE}else if(context.variable.edit.editOther){models=iD.data.sceneDataType.HD_DATA_LO}}return self.getModelsData(element,models)},getModelsData:function(element,modelNames){var result={datas:[]};_.each(modelNames,function(mname){result.datas[mname]={display:element.display==undefined?false:element.display,editable:element.editable==undefined?false:element.editable,editlock:false}});return result},loadTaskBatch:async function(task){var self=this;self.taskBatch=[];self.batchDbCode={};var url=iD.config.URL.kts+"task/batchInfos?taskId="+iD.Task.d.task_id;return new Promise((resolve,reject)=>{self._loadTrackBatch(()=>{d3.json(url).get((error,_data)=>{var res=_data&&_data.result||{};var taskBatch=self.taskBatch=_.compact(_.keys(res));if(iD.Task.d&&iD.Task.d.tags.auditBatch){taskBatch.length=0;taskBatch.push(iD.Task.d.tags.auditBatch)}for(let b of taskBatch){self.batchDbCode[b]=iD.Task.dbCode()}if(iD.Task.d.tags.compareBatch||iD.Task.d.tags.multiSourceBatchs){if(!taskBatch.length){taskBatch.push("")}if(iD.Task.d.tags.compareBatch){taskBatch.push(iD.Task.d.tags.compareBatch);self.batchDbCode[iD.Task.d.tags.compareBatch]=iD.Task.d.tags.compareDbCode}if(iD.Task.d.tags.multiSourceBatchs){var sbatchs=iD.Task.d.tags.multiSourceBatchs.split(",");var scodes=(iD.Task.d.tags.multiSourceDbCodes||"").split(",");taskBatch.push(...sbatchs);sbatchs.forEach(function(b,idx){self.batchDbCode[b]=scodes[idx]})}}resolve(_data)})})})},_loadTrackBatch:function(callback){var self=this;callback=callback||_.noop;self.trackBatchMap={};var url=iD.config.URL.kts+"task/getSourceBatches?task="+iD.Task.d.task_id;d3.json(url).get((error,_data)=>{var result=_data&&_data.result&&_data.result.recog||{};if(_.isEmpty(result)){callback([]);return}var map=self.trackBatchMap;for(let d of result){if(!d.trackIds||!d.batch)continue;let tracks=d.trackIds.split(",");for(let tid of tracks){if(!map[tid])map[tid]=[];if(!map[tid].includes(d.batch))map[tid].push(d.batch)}}callback()})},loadLayers:function(callback){var systemType=iD.util.urlParamSystemType()?1*iD.util.urlParamSystemType():"";var currentInstance="FRUIT";if(_isInstance||iD.User.isFusionRole()){currentInstance="FRUIT"}else if(4==window._systemType){currentInstance="sdEdit"}var errMsg=[];url=iD.config.URL.kds_meta+"meta/app/instance/current/"+currentInstance+"?callback={callback}";d3.jsonp(url,function(d){if(!d||"0"!=d.code||!d.result||!d.result.layers.length){Dialog.alert("\u6A21\u578B\u52A0\u8F7D\u5931\u8D25<br/>"+(d&&d.message||""));console.log("\u6A21\u578B\u52A0\u8F7D\u5931\u8D25",d&&d.message||"");window._instanceId=0;callback([]);return}window._instanceId=d.result.id;var promise1=new Promise(function(resolve){var url=iD.config.URL.kds_meta+"meta/app/instance/current/editcheck?callback={callback}";d3.jsonp(url,function(data){resolve(_parseLayers(data,iD.data.DataType.CHECK_TAG))})});var promise3=new Promise(function(resolve){var url=iD.config.URL.kds_meta+"meta/app/instance/current/analysistag?callback={callback}";d3.jsonp(url,function(data){resolve(_parseLayers(data,iD.data.DataType.ANALYSIS_TAG))})});var promise4=new Promise(function(resolve){var url=iD.config.URL.kds_meta+"meta/app/instance/current/questiontag?callback={callback}";d3.jsonp(url,function(data){resolve(_parseLayers(data,iD.data.DataType.QUESTION_TAG))})});Promise.all([promise1,promise3,promise4]).then(function(dataList){var allLayers=d.result.layers||[];allLayers.push(..._.flatten(dataList));var result=_createModelEntitys(allLayers);callback(result)})});function _parseLayers(data,modelName){var result=[];if(data&&"0"==data.code&&data.result&&data.result.layers){result=data.result.layers||[]}if(!result.length||!data||"0"!=data.code){var msg=(modelName||"")+" "+(data&&data.message||"\u521D\u59CB\u5316\u5931\u8D25");errMsg.push(msg)}return result}function _createModelEntitys(layers){layers=layers||[];let geoType;let modelEntity;let result=[];var isLineWorker=iD.User.isLineWorkRole();var isLineChecker=iD.User.isLineCheckRole();for(var i=0,len=layers.length;i<len;i++){var modelName=layers[i].model.modelName;if(iD.ModelEntitys[modelName]){continue}var fieldReadOnly=undefined;if(isLineWorker||isLineChecker){if(_.include([iD.data.DataType.DIVIDER,iD.data.DataType.DIVIDER_NODE],modelName)){fieldReadOnly=!isLineWorker}else if(_.include([iD.data.DataType.CHECK_TAG,iD.data.DataType.QUESTION_TAG],modelName)){}else{fieldReadOnly=true}}modelEntity=new iD.ModelEntity;geoType=layers[i].modelId;modelEntity.setGeoType(parseInt(geoType,10));modelEntity.type(layers[i].model.geoType);modelEntity.modelName(modelName);modelEntity.layerId(layers[i].id);let fields=layers[i].model.fields;result.push({layerId:layers[i].id,layerName:modelName,layerSn:modelName});dataLayerIds[modelName]=layers[i].id;for(let field_index=0,field_len=fields.length;field_index<field_len;field_index++){let fieldObj={};fieldObj.selectGroup={};let filed=fields[field_index];fieldObj.geoType=geoType;Object.assign(fieldObj,fields[field_index]);if("select"===fieldObj.fieldInput){fieldObj.fieldInput={};fieldObj.fieldInput.type="select";if(4==systemType&&modelName==iD.data.DataType.POI){if("POI_TYPE"==fieldObj.fieldName){fieldObj.fieldInput.type="mulselect"}}if(modelName==iD.data.DataType.OBJECT_PL||modelName==iD.data.DataType.OBJECT_PG||modelName==iD.data.DataType.OBJECT_PT||modelName==iD.data.DataType.ROAD_ATTRIBUTE){if("TYPE"==fieldObj.fieldName){fieldObj.fieldInput.type="selectgroup"}}let fvalues=[];let parentIds=[];let subType={};let fieldTypeValues=filed.fieldType.fieldTypeValues;for(let _valueObj of fieldTypeValues){fvalues.push({name:_valueObj.name,value:_valueObj.value,parentId:_valueObj.parentId,id:_valueObj.id})}fieldObj.fieldInput.values=fvalues}if(_.include(["OPERATOR","SDATE"],fieldObj.fieldName)){fieldObj.display="0"}if(modelName==iD.data.DataType.CHECK_TAG){if(_.include(["CREATEBY","EDITBY","CHECKBY"],fieldObj.fieldName)){fieldObj.readOnly="1"}}else if(_.include([iD.data.DataType.IMAGE_TAG,iD.data.DataType.ANALYSIS_TAG],modelName)){if(_.include(["MARKBY"],fieldObj.fieldName)){fieldObj.readOnly="1"}}else if(modelName==iD.data.DataType.MEASUREINFO){fieldObj.readOnly="1"}if(null!=fieldReadOnly){fieldObj.readOnly=fieldReadOnly?"1":fieldObj.readOnly}modelEntity.addField(fieldObj)}modelEntity.members(layers[i].model.members);iD.ModelEntitys[modelName]=modelEntity}return result}},getLayerId:function(layerSn){var layerId;for(var i=0;i<this.layers.length;i++){if(this.layers[i].layerSn&&this.layers[i].layerSn==layerSn){return this.layers[i].layerId};}return layerId},getLayer:function(layerId){for(var i=0;i<this.layers.length;i++){if(this.layers[i].layerId&&this.layers[i].layerId==layerId){return this.layers[i]};}return null},getLayerByName:function(layerName){var layer;for(var i=0;i<this.layers.length;i++){layer=this.layers[i];if(layer.layerSn&&layer.layerSn==layerName){return layer}else if("undefined"!=typeof layer.layerInfo){for(var j=0;j<layer.layerInfo.length;j++){if(layer.layerInfo[j].type&&layer.layerInfo[j].type==layerName){return layer.layerInfo[j]};}}}return null}};;;iD.util.SessionMutex=function(name){var mutex={},intervalID;function renew(){var expires=new Date;expires.setSeconds(expires.getSeconds()+5);document.cookie=name+"=1; expires="+expires.toUTCString()}mutex.lock=function(){if(intervalID)return true;var cookie=document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+name+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1");if(cookie)return false;renew();intervalID=window.setInterval(renew,4000);return true};mutex.unlock=function(){if(!intervalID)return;document.cookie=name+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT";clearInterval(intervalID);intervalID=null};mutex.locked=function(){return!!intervalID};return mutex};;;iD.util.lassExtend={SegmentIntersect:function(SegmentA,SegmentB){var d=(SegmentA[3]-SegmentA[1])*(SegmentB[2]-SegmentB[0])-(SegmentB[3]-SegmentB[1])*(SegmentA[2]-SegmentA[0]);if(0==d){return 3}var Tmp=[];Tmp[0]=((SegmentA[2]-SegmentA[0])*(SegmentB[2]-SegmentB[0])*(SegmentB[1]-SegmentA[1])+(SegmentA[3]-SegmentA[1])*(SegmentB[2]-SegmentB[0])*SegmentA[0]-(SegmentB[3]-SegmentB[1])*(SegmentA[2]-SegmentA[0])*SegmentB[0])/d;Tmp[1]=((SegmentA[3]-SegmentA[1])*(SegmentB[3]-SegmentB[1])*(SegmentB[0]-SegmentA[0])+(SegmentA[2]-SegmentA[0])*(SegmentB[3]-SegmentB[1])*SegmentA[1]-(SegmentB[2]-SegmentB[0])*(SegmentA[3]-SegmentA[1])*SegmentB[1])/-d;var f1=0>=(Tmp[0]-SegmentA[0])*(Tmp[0]-SegmentA[2]);var f2=0>=(Tmp[0]-SegmentB[0])*(Tmp[0]-SegmentB[2]);var f3=0>=(Tmp[1]-SegmentA[1])*(Tmp[1]-SegmentA[3]);var f4=0>=(Tmp[1]-SegmentB[1])*(Tmp[1]-SegmentB[3]);if(f1&&f2&&f3&&f4){return[Tmp[0],Tmp[1]]}else{return 0}},isPointInRect:function(point,ext){var x1=ext[0][0],y1=ext[0][1];var x2=ext[1][0],y2=ext[1][1];var Xmin=Math.min(x1,x2);var Xmax=Math.max(x1,x2);var Ymin=Math.min(y1,y2);var Ymax=Math.max(y1,y2);var sw={lng:Xmin,lat:Ymin};var ne={lng:Xmax,lat:Ymax};return point.lng>=sw.lng&&point.lng<=ne.lng&&point.lat>=sw.lat&&point.lat<=ne.lat},isLineInRect:function(ext,linecoord){var x1=ext[0][0],y1=ext[0][1];var x2=ext[1][0],y2=ext[1][1];var line1=[x1,y1,x2,y1];var line2=[x2,y1,x2,y2];var line3=[x2,y2,x1,y2];var line4=[x1,y2,x1,y1];var rectLines=[line1,line2,line3,line4];for(var i=0;i<rectLines.length;i++){var SegmentA=rectLines[i];var r=this.SegmentIntersect(SegmentA,linecoord);if(r){return r}}var point1=this.isPointInRect({lng:linecoord[0],lat:linecoord[1]},ext);var point2=this.isPointInRect({lng:linecoord[2],lat:linecoord[3]},ext);return point1||point2},getDistance:function(point1,point2){var EARTHRADIUS=6370996.81;function degreeToRad(degree){return Math.PI*degree/180}function _getRange(v,a,b){if(null!=a){v=Math.max(v,a)}if(null!=b){v=Math.min(v,b)}return v}function _getLoop(v,a,b){while(v>b){v-=b-a}while(v<a){v+=b-a}return v}point1.lon=_getLoop(point1.lon,-180,180);point1.lat=_getRange(point1.lat,-74,74);point2.lon=_getLoop(point2.lon,-180,180);point2.lat=_getRange(point2.lat,-74,74);var x1,x2,y1,y2;x1=degreeToRad(point1.lon);y1=degreeToRad(point1.lat);x2=degreeToRad(point2.lon);y2=degreeToRad(point2.lat);return EARTHRADIUS*Math.acos(Math.sin(y1)*Math.sin(y2)+Math.cos(y1)*Math.cos(y2)*Math.cos(x2-x1))}};;MapSheet={splitLine:function(xWays,graph,context){var editLayer=context.layers(xWays[0].layerId);var nodeDataType;if(editLayer&&editLayer.isRoad()){nodeDataType=iD.data.Constant.ROADNODE}else{nodeDataType=iD.data.Constant.HIGHWAY}if("roadcrossline"==xWays[0].tags.road_class){return graph}xWays.forEach(function(way){if(!way.tags.mesh){graph=context.MeshDataStore.setWayMeshId(way,graph)}});var createLine=function(graph,pWay,loc){var xNewNode1=graph.extendNode(pWay,loc,{});xNewNode1.modelName=nodeDataType;graph=graph.replace(xNewNode1);pWay=pWay.addNode(xNewNode1.id,pWay.nodes.length-1);graph=graph.replace(pWay);var nodeIndex=pWay.nodes.indexOf(xNewNode1.id);var newNodeIds=pWay.nodes.slice(0,nodeIndex);var newWay=iD.Way();newWay.layerId=pWay.layerId;newWay=newWay.mergeTags(pWay.tags);graph=graph.replace(newWay);_.uniq(newNodeIds).forEach(function(id){if(id!=xNewNode1.id){pWay=pWay.removeNode(id);graph=graph.replace(pWay)}});newWay=graph.entity(newWay.id);_.uniq(newNodeIds).forEach(function(id){newWay=newWay.addNode(id);graph=graph.replace(newWay)});newWay=newWay.addNode(xNewNode1.id);graph=graph.replace(newWay);newWay=graph.entity(newWay.id);var newWayFirstNode=graph.entity(newWay.first());var newWayLastNode=graph.entity(newWay.last());var lon=iD.util.lassExtend.getDistance({lon:newWayFirstNode.loc[0],lat:newWayFirstNode.loc[1]},{lon:newWayLastNode.loc[0],lat:newWayLastNode.loc[1]});if(0.5>lon){_.uniq(newWay.nodes).forEach(function(id){var xNodez=graph.entity(id);graph=graph.remove(xNodez)});graph=graph.remove(newWay)}graph=context.MeshDataStore.setWayMeshId(pWay,graph);graph=context.MeshDataStore.setWayMeshId(newWay,graph);return{way:pWay,graph:graph,newWay:newWay}};var sortPoints=function(points,flag){var temp;for(var i=0;i<points.length;i++){var point=points[i];var pointModel=point[0]+point[1];for(var j=0;j<points.length;j++){var point2=points[j];var pointModel2=point2[0]+point2[1];var boo=eval("pointModel "+("desc"==flag?"<":">")+" pointModel2");if(boo){temp=points[j];points[j]=points[i];points[i]=temp}}}return points};var getFocusPoints=function(rectSide,SegmentB){var focusPoint=[];for(var i=0;i<rectSide.length;i++){var side=rectSide[i];var loc=iD.util.lassExtend.SegmentIntersect(side,SegmentB);if(loc&&3!=loc&&loc.length){var hasFocusP=false;for(var p=0;p<focusPoint.length;p++){var focusPointP=focusPoint[p];var focusPointLoc=loc;if(-1!=focusPointP.join("#").indexOf(focusPointLoc.join("#"))){hasFocusP=true;break}}if(!hasFocusP){focusPoint.push(loc)}else{continue}}}return focusPoint};for(var ii=0;ii<xWays.length;ii++){var pWay=xWays[ii];var preNodeId=pWay.preLastNode();var lasNodeId=pWay.last();if(preNodeId&&lasNodeId){var preNode=graph.entity(preNodeId);var lastNode=graph.entity(lasNodeId);var preNodeLoc=preNode.loc;var lastNodeLoc=lastNode.loc;var sumPreNodeLoc=preNodeLoc[0]+preNodeLoc[1];var sumLastNodeLoc=lastNodeLoc[0]+lastNodeLoc[1];var order="asc";if(sumPreNodeLoc<sumLastNodeLoc){order="desc"}var rectSide=context.MeshDataStore.getRectCoords();var SegmentB=preNode.loc.concat(lastNode.loc);var focusPoint=[];focusPoint=getFocusPoints(rectSide,SegmentB);sortPoints(focusPoint,order);var tempPway=pWay;for(var n=0;n<focusPoint.length&&2>n;n++){var xloc=focusPoint[n];var cR=createLine(graph,tempPway,xloc);tempPway=cR.way;graph=cR.graph}}}return graph}};MapSheet={splitLine:function(xWays,graph,context,nEntities){return graph;var editLayer=context.layers(xWays[0].layerId);var nodeDataType;if(editLayer&&editLayer.isRoad()){nodeDataType=iD.data.Constant.ROADNODE}else{nodeDataType=iD.data.Constant.HIGHWAY}if("roadcrossline"==xWays[0].tags.road_class){return graph}var createLine=function(graph,pWay,loc){var xNewNode1=graph.extendNode(pWay,loc,{});xNewNode1.modelName=nodeDataType;graph=graph.replace(xNewNode1);pWay=pWay.addNode(xNewNode1.id,pWay.nodes.length-1);graph=graph.replace(pWay);var nodeIndex=pWay.nodes.indexOf(xNewNode1.id);var newNodeIds=pWay.nodes.slice(0,nodeIndex);var newWay=iD.Way();newWay.layerId=pWay.layerId;pWay.new_id_inherit&&(newWay.new_id_inherit=pWay.new_id_inherit);newWay=newWay.mergeTags(pWay.tags);graph=graph.replace(newWay);_.uniq(newNodeIds).forEach(function(id){if(id!=xNewNode1.id){pWay=pWay.removeNode(id);graph=graph.replace(pWay)}});newWay=graph.entity(newWay.id);_.uniq(newNodeIds).forEach(function(id){newWay=newWay.addNode(id);graph=graph.replace(newWay)});newWay=newWay.addNode(xNewNode1.id);graph=graph.replace(newWay);newWay=graph.entity(newWay.id);var newWayFirstNode=graph.entity(newWay.first());var newWayLastNode=graph.entity(newWay.last());var lon=iD.util.lassExtend.getDistance({lon:newWayFirstNode.loc[0],lat:newWayFirstNode.loc[1]},{lon:newWayLastNode.loc[0],lat:newWayLastNode.loc[1]});if(0.5>lon){_.uniq(newWay.nodes).forEach(function(id){var xNodez=graph.entity(id);graph=graph.remove(xNodez)});graph=graph.remove(newWay)}graph=context.MeshDataStore.setWayMeshId(pWay,graph);graph=context.MeshDataStore.setWayMeshId(newWay,graph);return{way:pWay,graph:graph,newWay:0.5>lon?undefined:newWay,xNewNode1:xNewNode1}};var createLineByFunc=function(graph,pWay,loc){var fNode=graph.entity(pWay.first());var tNode=graph.entity(pWay.last());var mesh1=MapSheet.getMeshCodeArr(fNode,context);var mesh2=MapSheet.getMeshCodeArr(tNode,context);var xNewNode1=graph.extendNode(pWay,loc,{});xNewNode1.modelName=nodeDataType;if(0<mesh1.length){xNewNode1=xNewNode1.mergeTags({mesh:mesh1[0]})}if(0<mesh2.length){xNewNode1=xNewNode1.mergeTags({mesh_2:mesh2[0]})}xNewNode1=xNewNode1.mergeTags({boundary:"20"});xNewNode1=xNewNode1.mergeTags({realnode:"0"});graph=graph.replace(xNewNode1);pWay=pWay.addNode(xNewNode1.id,pWay.nodes.length-1);var nodeIndex=pWay.nodes.indexOf(xNewNode1.id);var newNodeIds=pWay.nodes.slice(nodeIndex);var newWay=iD.Way({layerId:pWay.layerId,nodes:[],tags:pWay.tags});graph=graph.replace(newWay);var newWayId;var wayA=pWay.update({id:newWayId});_.uniq(newNodeIds).forEach(function(id){if(id!=xNewNode1.id){wayA=wayA.removeNode(id);graph=graph.replace(wayA)}});graph=graph.replace(wayA);newWay=graph.entity(newWay.id);_.uniq(newNodeIds).forEach(function(id){newWay=newWay.addNode(id);graph=graph.replace(newWay)});var isRoad=iD.Layers.getLayer(wayA.layerId).isRoad();if(isRoad&&!pWay.isNew()){wayA.new_id_inherit=iD.Entity.id.toOSM(pWay.id)+"-";newWay.new_id_inherit=iD.Entity.id.toOSM(pWay.id)+"-"}else if(isRoad&&pWay.new_id_inherit){wayA.new_id_inherit=pWay.new_id_inherit;newWay.new_id_inherit=pWay.new_id_inherit}wayA=iD.util.tagExtend.updateWayLengthTag(graph,wayA);newWay=iD.util.tagExtend.updateWayLengthTag(graph,newWay);graph=graph.replace(wayA);graph=graph.replace(newWay);var fNode=pWay.nodes[0];var tNode=pWay.nodes[pWay.nodes.length-1];var topoEntity=iD.TopoEntity();var crossNodeIdA=topoEntity.isInCrossNode(graph,fNode);var crossNodeIdB=topoEntity.isInCrossNode(graph,tNode);if(false!=crossNodeIdA&&crossNodeIdA==crossNodeIdB){graph=iD.actions.RoadCrossModify([crossNodeIdA,xNewNode1.id])(graph)}var newWayFirstNode=graph.entity(newWay.first());var newWayLastNode=graph.entity(newWay.last());var lon=iD.util.lassExtend.getDistance({lon:newWayFirstNode.loc[0],lat:newWayFirstNode.loc[1]},{lon:newWayLastNode.loc[0],lat:newWayLastNode.loc[1]});return{way:wayA,graph:graph,newWay:newWay,xNewNode1:xNewNode1}};var sortPoints=function(points,flag){var temp;for(var i=0;i<points.length;i++){var point=points[i];var pointModel=point[0]+point[1];for(var j=0;j<points.length;j++){var point2=points[j];var pointModel2=point2[0]+point2[1];var boo=eval("pointModel "+("desc"==flag?"<":">")+" pointModel2");if(boo){temp=points[j];points[j]=points[i];points[i]=temp}}}return points};for(var ii=0;ii<xWays.length;ii++){var pWay=xWays[ii];var preNodeId=pWay.preLastNode();var lasNodeId=pWay.last();if(preNodeId&&lasNodeId){var preNode=graph.entity(preNodeId);var lastNode=graph.entity(lasNodeId);var preNodeLoc=preNode.loc;var lastNodeLoc=lastNode.loc;var sumPreNodeLoc=preNodeLoc[0]+preNodeLoc[1];var sumLastNodeLoc=lastNodeLoc[0]+lastNodeLoc[1];var order="asc";if(sumPreNodeLoc<sumLastNodeLoc){order="desc"}var rectSide=context.MeshDataStore.getRectCoords();var SegmentB=preNode.loc.concat(lastNode.loc);var focusPoint=[];focusPoint=this.getFocusPoints(rectSide,SegmentB);sortPoints(focusPoint,order);var tempPway=pWay;if(preNode.tags.boundary&&"20"==preNode.tags.boundary||lastNode.tags.boundary&&"20"==lastNode.tags.boundary){nEntities.nWays.push(pWay);continue}var fNode=iD.util.tagExtend.updateNodeMeshTag(preNode,context);var tNode=iD.util.tagExtend.updateNodeMeshTag(lastNode,context);if(fNode.tags.boundary&&"20"==fNode.tags.boundary||tNode.tags.boundary&&"20"==tNode.tags.boundary){nEntities.nWays.push(pWay);continue}if(0==focusPoint.length){nEntities.nWays.push(pWay)}if(0<focusPoint.length){var xloc=focusPoint[0];var cR=createLineByFunc(graph,pWay,xloc);graph=cR.graph;nEntities.deleteWays.push(pWay)&&nEntities.nWays.push(cR.way);nEntities.nNodes.push(cR.xNewNode1);if(cR.newWay!=undefined){nEntities.nWays.push(cR.newWay)}}}}return graph},getFocusPoints:function(rectSide,SegmentB,context){var rectSide=rectSide||context.MeshDataStore.getRectCoords();var focusPoint=[];for(var i=0;i<rectSide.length;i++){var side=rectSide[i];var loc=iD.util.lassExtend.SegmentIntersect(side,SegmentB);if(loc&&3!=loc&&loc.length){var hasFocusP=false;for(var p=0;p<focusPoint.length;p++){var focusPointP=focusPoint[p];var focusPointLoc=loc;if(-1!=focusPointP.join("#").indexOf(focusPointLoc.join("#"))){hasFocusP=true;break}}if(!hasFocusP){focusPoint.push(loc)}else{continue}}}return focusPoint},isPointOnRectSide:function(point,context){var rectSide=context.MeshDataStore.getRectCoords();var focusPoint=[];for(var i=0;i<rectSide.length;i++){var side=rectSide[i];var res=iD.util.pt2LineDist([[side[0],side[1]],[side[2],side[3]]],point);var lon=iD.util.lassExtend.getDistance({lon:point[0],lat:point[1]},{lon:res.x,lat:res.y});if(0.5>lon)return true}return false},getMeshCode:function(node,context){if(!context.MeshDataStore.way||1>context.MeshDataStore.way.length){Dialog.alert("\u6570\u636E\u670D\u52A1(KDS)\u672A\u8FD4\u56DE\u56FE\u5E45\u7EBF");console.error("\u672A\u627E\u5230\u56FE\u5E45\u7EBF\u6570\u636E");return}var meshs=context.MeshDataStore.way;for(var i=0;i<meshs.length;i++){var polyarea=[];var flag=false;for(var j=0;j<meshs[i].nodes.length;j++){if(!context.graph().hasEntity(meshs[i].nodes[j])){console.info("\u672A\u627E\u5230\u56FE\u5E45\u7EBF\u5173\u8054\u7684\u8282\u70B9");flag=true;break}var entity=context.graph().entity(meshs[i].nodes[j]);polyarea.push(entity.loc)}if(flag){continue}if(iD.geo.pointInPolygon(node.loc,polyarea)){return meshs[i].tags.mesh}}console.error("\u672A\u627E\u5230\u5305\u542B\u8282\u70B9"+node.id+"\u56FE\u5E45\u6570\u636E");return},getMeshCodeArr:function(node,context){var meshsArr=[];if(!context.MeshDataStore.way||1>context.MeshDataStore.way.length){Dialog.alert("\u6570\u636E\u670D\u52A1(KDS)\u672A\u8FD4\u56DE\u56FE\u5E45\u7EBF");console.error("\u672A\u627E\u5230\u56FE\u5E45\u7EBF\u6570\u636E");return meshsArr}var meshs=context.MeshDataStore.way;for(var i=0;i<meshs.length;i++){var polyarea=[];var flag=false;for(var j=0;j<meshs[i].nodes.length;j++){if(!context.graph().hasEntity(meshs[i].nodes[j])){console.info("\u672A\u627E\u5230\u56FE\u5E45\u7EBF\u5173\u8054\u7684\u8282\u70B9");flag=true;break}var entity=context.graph().entity(meshs[i].nodes[j]);polyarea.push(entity)}if(flag){continue}var polygon={nodes:polyarea};if(iD.util.isPointInPolygon(node,polygon)){meshsArr.push(meshs[i].tags.mesh)}}if(0==meshsArr.length)console.error("\u672A\u627E\u5230\u5305\u542B\u8282\u70B9"+node.id+"\u56FE\u5E45\u6570\u636E");function unique(arr){var result=[],hash={};for(var i=0,elem;null!=(elem=arr[i]);i++){if(!hash[elem]){result.push(elem);hash[elem]=true}}return result}return unique(meshsArr)}};;iD.util.LineCalCulate=function(){var lineCalCulate={};lineCalCulate.getAngle=function(lngA,latA,lngB,latB){var A=transform(lngA,latA);var B=transform(lngB,latB);var dx=(B.RadLo-A.RadLo)*A.Ed;var dy=(B.RadLa-A.RadLa)*A.Ec;var angle=0;angle=180*Math.atan(Math.abs(dx/dy))/Math.PI;var dLo=B.Longitude-A.Longitude;var dLa=B.Latitude-A.Latitude;if(0<dLo&&0>=dLa){angle=90-angle+90}else if(0>=dLo&&0>dLa){angle=angle+180}else if(0>dLo&&0<=dLa){angle=90-angle+270}return angle};lineCalCulate.calculateVerticalP=function(lng,lat,distance,angle){var P=transform(lng,lat);var dx=1000*distance*Math.sin(angle/180*Math.PI);var dy=1000*distance*Math.cos(angle/180*Math.PI);var bjd=180*(dx/P.Ed+P.RadLo)/Math.PI;var bwd=180*(dy/P.Ec+P.RadLa)/Math.PI;return transform(bjd,bwd)};lineCalCulate.getPathInCircle=function(center,radius,sdgre,edgre,c){var PI=Math.PI,points=[],point=center;var d=radius/6378137;var lat1=PI/180*point[1];var lng1=PI/180*point[0];for(var a=sdgre;a<edgre;a+=c){var tc=PI/180*a;var y=Math.asin(Math.sin(lat1)*Math.cos(d)+Math.cos(lat1)*Math.sin(d)*Math.cos(tc));var dlng=Math.atan2(Math.sin(tc)*Math.sin(d)*Math.cos(lat1),Math.cos(d)-Math.sin(lat1)*Math.sin(y));var x=(lng1-dlng+PI)%(2*PI)-PI;var lnglat=[parseFloat(x*(180/PI)),parseFloat(y*(180/PI))];points.push(lnglat)}return points};lineCalCulate.getIntersectionPoint=function(projection,startA,endA,startB,endB,interPoint){var a=projection(startA);var b=projection(endA);var c=projection(startB);var d=projection(endB);var intersection=[0,0];var flag=0;if(0==Math.abs(b[1]-a[1])+Math.abs(b[0]-a[0])+Math.abs(d[1]-c[1])+Math.abs(d[0]-c[0])){if(0==c[0]-a[0]+(c[1]-a[1])){}else{}intersection=a;flag=0}if(0==Math.abs(b[1]-a[1])+Math.abs(b[0]-a[0])){if(0==(a[0]-d[0])*(c[1]-d[1])-(a[1]-d[1])*(c[0]-d[0])){}else{}intersection=a;flag=0}if(0==Math.abs(d[1]-c[1])+Math.abs(d[0]-c[0])){if(0==(d[0]-b[0])*(a[1]-b[1])-(d[1]-b[1])*(a[0]-b[0])){}else{}intersection=c;flag=0}if(0==(b[1]-a[1])*(c[0]-d[0])-(b[0]-a[0])*(c[1]-d[1])){intersection=c;flag=0}intersection[0]=((b[0]-a[0])*(c[0]-d[0])*(c[1]-a[1])-c[0]*(b[0]-a[0])*(c[1]-d[1])+a[0]*(b[1]-a[1])*(c[0]-d[0]))/((b[1]-a[1])*(c[0]-d[0])-(b[0]-a[0])*(c[1]-d[1]));intersection[1]=((b[1]-a[1])*(c[1]-d[1])*(c[0]-a[0])-c[1]*(b[1]-a[1])*(c[0]-d[0])+a[1]*(b[0]-a[0])*(c[1]-d[1]))/((b[0]-a[0])*(c[1]-d[1])-(b[1]-a[1])*(c[0]-d[0]));if(0>=(intersection[0]-a[0])*(intersection[0]-b[0])&&0>=(intersection[0]-c[0])*(intersection[0]-d[0])&&0>=(intersection[1]-a[1])*(intersection[1]-b[1])&&0>=(intersection[1]-c[1])*(intersection[1]-d[1])){flag=1}else{flag=-1}var point=projection.invert(intersection);interPoint[0]=point[0];interPoint[1]=point[1];return flag};var transform=function(lng,lat){var Rc=6378137;var Rj=6356725;var LoDeg=lng;var LoMin=60*(lng-LoDeg);var LoSec=3600*(lng-LoDeg-LoMin/60);var LaDeg=lat;var LaMin=60*(lat-LaDeg);var LaSec=3600*(lat-LaDeg-LaMin/60);var Longitude=lng;var Latitude=lat;var RadLo=lng*Math.PI/180;var RadLa=lat*Math.PI/180;var Ec=Rj+(Rc-Rj)*(90-Latitude)/90;var Ed=Ec*Math.cos(RadLa);var result={RadLo:RadLo,RadLa:RadLa,Ec:Ec,Ed:Ed,Longitude:Longitude,Latitude:Latitude};return result};lineCalCulate.getIntersectLoc=function(nodes1,nodes2,graph){var locs=[];var lineCal=iD.util.LineCalCulate();var interPoint=[0,0];for(var j=0;j<nodes1.length;j++){if(j+1>nodes1.length-1)break;var nodes1_pre=graph.entity(nodes1[j]),nodes1_next=graph.entity(nodes1[j+1]),pre_arr1=[nodes1_pre.loc[0],nodes1_pre.loc[1],nodes1_next.loc[0],nodes1_next.loc[1]];for(var k=0;k<nodes2.length;k++){if(k+1>nodes2.length-1)break;var nodes2_pre=graph.entity(nodes2[k]),nodes2_next=graph.entity(nodes2[k+1]),pre_arr2=[nodes2_pre.loc[0],nodes2_pre.loc[1],nodes2_next.loc[0],nodes2_next.loc[1]];var loc=iD.util.lassExtend.SegmentIntersect(pre_arr1,pre_arr2);if(loc&&loc.push){loc=iD.util.getBetweenPointLoc(nodes2_pre.loc,nodes2_next.loc,loc);locs.push(loc)}}}return locs};return lineCalCulate};;iD.util.roadHelper={wayEndNodes:function(way,nodeIds){function findSame(id){for(var i=0,r=nodeIds.length;i<r;i++){if(id==nodeIds[i]){return true}}return false}var ndId=way.nodes[0];if(!findSame(ndId)){nodeIds[nodeIds.length]=ndId}ndId=way.nodes[way.nodes.length-1];if(!findSame(ndId)){nodeIds[nodeIds.length]=ndId}},waysSameNode:function(way0,way1,nodeIds){var ndA0=way0.nodes[0];var ndA1=way0.nodes[way0.nodes.length-1];var ndB0=way1.nodes[0];var ndB1=way1.nodes[way1.nodes.length-1];if(ndA0==ndB0){nodeIds[nodeIds.length]=ndA0}else if(ndA0==ndB1){nodeIds[nodeIds.length]=ndA0}else if(ndA1==ndB0){nodeIds[nodeIds.length]=ndA1}else if(ndA1==ndB1){nodeIds[nodeIds.length]=ndA1}}};iD.util.RoadOffset=function(){var OFFSET_DIR={LEFT:0,RIGHT:1};var EPSILON={zero6:1.0e-6,zero8:1e-8,zero12:1e-12,zero15:1e-15,offset:0.0015};function Vector2(x,y){this.x=x?x:0;this.y=y?y:0}Vector2.prototype={constructor:Vector2,set:function(b){this.x=b.x;this.y=b.y;return this},setxy:function(x,y){this.x=x;this.y=y;return this},plus:function(b){this.x+=b.x;this.y+=b.y;return this},minus:function(b){this.x-=b.x;this.y-=b.y;return this},substract:function(b){return new Vector2(this.x-b.x,this.y-b.y)},multply:function(b){this.x*=b;this.y*=b;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSqr:function(){return this.x*this.x+this.y*this.y},dotProduct:function(b){return this.x*b.x+this.y*b.y},unit:function(){var dis=Math.sqrt(this.x*this.x+this.y*this.y);if(dis<EPSILON.zero12){this.x=0;this.y=0}else{var rev=1/dis;this.x*=rev;this.y*=rev}return dis},distance:function(b){var dir=new Vector2(this.x-b.x,this.y-b.y);return dir.length()},distanceSqr:function(b){var dir=new Vector2(this.x-b.x,this.y-b.y);return dir.lengthSqr()},angleTo:function(vec){var n=this.dotProduct(vec);var m=this.length()*vec.length();if(m<EPSILON.zero12){return 0}return Math.acos(n/m)},distanceToSeg:function(p0,p1,xevt){if(xevt){xevt.clear()}else{xevt=new PEvent}var dir=p1.substract(p0);var wir=this.substract(p0);var s=dir.x*dir.x+dir.y*dir.y;if(s<EPSILON.zero12){xevt.t=0;xevt.pt.set(p0);xevt.dis=wir.length();return xevt}else{var t=(dir.x*wir.x+dir.y*wir.y)/s;if(0>t){xevt.t=0;xevt.pt.set(p0);xevt.dis=wir.length()}else if(1<t){xevt.t=1;xevt.pt.set(p1);dir=this.substract(p1);xevt.dis=dir.length()}else{dir.multply(t);xevt.t=t;xevt.pt.set(p0).plus(dir);dir=this.substract(xevt.pt);xevt.dis=dir.length()}}return xevt},distanceToLine:function(p0,p1,xevt){if(xevt){xevt.clear()}else{xevt=new PEvent}var dir=p1.substract(p0);var wir=this.substract(p0);var s=dir.x*dir.x+dir.y*dir.y;if(s<EPSILON.zero12){xevt.t=0;xevt.pt.set(p0);xevt.dis=wir.length()}else{xevt.t=(dir.x*wir.x+dir.y*wir.y)/s;dir.multply(xevt.t);xevt.pt.set(p0).plus(dir);dir=this.substract(xevt.pt);xevt.dis=dir.length()}return xevt}};function Line(p0,p1){this.index=-1;this.xevt=0;this.from=new Vector2(p0?p0.x:0,p0?p0.y:0);this.to=new Vector2(p1?p1.x:0,p1?p1.y:0);;}Line.prototype={set:function(p0,p1){this.from.set(p0);this.to.set(p1);return this},clone:function(){var p=new Line(this.from,this.to);p.index=this.index;p.xevt=this.xevt;return p},getNormal:function(){var dir=this.to.substract(this.from);dir.unit();return new Vector2(-dir.y,dir.x)},pointAt:function(t){var dir=this.to.substract(this.from);dir.multply(t);return dir.plus(this.from)},subline:function(t0,t1){var sub=this.clone();sub.from=this.pointAt(t0);sub.to=this.pointAt(t1);return sub},length:function(){return this.from.distance(this.to)},lengthSqr:function(){return this.from.distanceSqr(this.to)},IsCoLine:function(pt){var xevt;xevt=this.to.distanceToLine(this.from,pt,xevt);if(9.99e-4>xevt.dis){return true}else{return false}},updateE:function(pt){this.to.set(pt)}};function PEvent(){this.t=0;this.pt=new Vector2;this.dis=1.0e+20}PEvent.prototype={constructor:PEvent,isValid:function(){return 1.0e+20>this.dis},clear:function(b){this.t=0;this.pt=new Vector2;this.dis=1.0e+20}};function X_Event(){this.index=-1;this.segA=-1;this.segA_t=0;this.segA_p=new Vector2;this.segB=-1;this.segB_t=0;this.segB_p=new Vector2;this.dsqr=1.0e+20}X_Event.prototype={constructor:X_Event,isValid:function(){return 1.0e+20>this.dsqr},clear:function(b){this.index=-1;this.segA=-1;this.segA_t=0;this.segB=-1;this.segB_t=0;this.dsqr=1.0e+20},clone:function(){var p=new X_Event;p.index=this.index;p.segA=this.segA;p.segA_t=this.segA_t;p.segA_p.set(this.segA_p);p.segB=this.segB;p.segB_t=this.segB_t;p.segB_p.set(this.segB_p);p.dsqr=this.dsqr;return p},swapAB:function(){var s=this.segA;this.segA=this.segB;this.segB=s;var t=this.segA_t;this.segA_t=this.segB_t;this.segB_t=t;var p=new Vector2;p.set(this.segA_p);this.segA_p.set(this.segB_p);this.segB_p.set(p)}};function compare_xevt(x1,x2){if(x1.segA<x2.segA)return-1;else if(x1.segA>x2.segA)return 1;else{if(x1.segA_t<x2.segA_t)return-1;else if(x1.segA_t>x2.segA_t)return 1;else return 0}}function lineLineDistance2d(line0_base,line0_p1,line1_base,line1_p1,st){var u=line0_base.substract(line1_base);var line0_direction=line0_p1.substract(line0_base);var line1_direction=line1_p1.substract(line1_base);var a=line0_direction.dotProduct(line0_direction);var b=line0_direction.dotProduct(line1_direction);var c=line1_direction.dotProduct(line1_direction);var d=line0_direction.dotProduct(u);var e=line1_direction.dotProduct(u);var f=u.dotProduct(u);var det=a*c-b*b;var s,t;if(det<EPSILON.zero12){s=0;if(b>c){t=d/b}else{t=e/c}st[0]=s;st[1]=t;return t*(c*t-2*e)+f}else{var invDet=1/det;s=(b*e-c*d)*invDet;t=(a*e-b*d)*invDet;st[0]=s;st[1]=t;return s*(a*s-2*b*t+2*d)+t*(c*t-2*e)+f;;}}function segSegDistance2d(seg0_base,seg0_point,seg1_base,seg1_point,evt){var s,t;var u,v,seg0_direction,seg1_direction;var a,b,c,d,e,det;var sNum,tNum,tDenom,sDenom;u=seg0_base.substract(seg1_base);seg0_direction=seg0_point.substract(seg0_base);seg1_direction=seg1_point.substract(seg1_base);a=seg0_direction.dotProduct(seg0_direction);b=seg0_direction.dotProduct(seg1_direction);c=seg1_direction.dotProduct(seg1_direction);d=seg0_direction.dotProduct(u);e=seg1_direction.dotProduct(u);det=a*c-b*b;if(det<EPSILON.zero12){if(a<EPSILON.zero12&&c<EPSILON.zero12){evt.segA_t=0;evt.segA_p.set(seg0_base);evt.segB_t=0;evt.segB_p.set(seg1_base);evt.dsqr=u.dotProduct(u);return evt}else if(a<EPSILON.zero12){evt.segA_t=0;evt.segA_p.set(seg0_base);if(0>=e){evt.segB_t=0;evt.segB_p.set(seg1_base);evt.dsqr=u.dotProduct(u)}else if(e>=c){evt.segB_t=1;evt.segB_p.set(seg1_point);v=seg0_base.substract(seg1_point);evt.dsqr=v.dotProduct(v)}else{t=e/c;evt.segB_t=t;seg1_direction.multply(t);evt.segB_p.set(seg1_base).plus(seg1_direction);evt.dsqr=u.dotProduct(u)-e*t}return evt}else if(c<EPSILON.zero12){evt.segB_t=0;evt.segB_p.set(seg1_base);if(0>=-d){evt.segA_t=0;evt.segA_p.set(seg0_base);evt.dsqr=u.dotProduct(u)}else if(-d>=a){evt.segA_t=1;evt.segA_p.set(seg0_point);v=seg1_base.substract(seg0_point);evt.dsqr=v.dotProduct(v)}else{s=-d/a;evt.segA_t=s;seg1_direction.multply(s);evt.segA_p.set(seg0_base).plus(seg1_direction);evt.dsqr=u.dotProduct(u)+d*s;;}return evt}else{sNum=0;tNum=e;tDenom=c;sDenom=det}}else{sNum=b*e-c*d;tNum=a*e-b*d}sDenom=det;if(0>sNum){sNum=0;tNum=e;tDenom=c}else if(sNum>det){sNum=det;tNum=e+b;tDenom=c}else{tDenom=det}if(0>tNum){tNum=0;if(0>-d){sNum=0}else if(-d>a){sNum=sDenom}else{sNum=-d;sDenom=a}}else if(tNum>tDenom){tNum=tDenom;if(0>-d+b){sNum=0}else if(-d+b>a){sNum=sDenom}else{sNum=-d+b;sDenom=a}}if(Math.abs(sDenom)<EPSILON.zero12)s=0;else s=sNum/sDenom;if(Math.abs(tDenom)<EPSILON.zero12)t=0;else t=tNum/tDenom;evt.segA_t=s;evt.segA_p.set(seg0_base).plus(seg0_direction.multply(s));evt.segB_t=t;evt.segB_p.set(seg1_base).plus(seg1_direction.multply(t));evt.dsqr=evt.segB_p.distanceSqr(evt.segA_p);return evt}function SubLines(idx0,idx1,lines){this.flag=0;this.xindex=[idx0,idx1];this.lines=lines}function Offset(){this.dir=OFFSET_DIR.LEFT;this.dist=1;this.distSqr=1;this.lines=[];this.offsets=[];this.result=[]}Offset.prototype={constructor:Offset,getOffset:function(index){return this.offsets[index]},firstRes:function(){if(0<this.result.length){return this.result[0]}return null},clear:function(){if(0<this.lines.length){delete this.lines;this.lines=[]}if(0<this.offsets.length){delete this.offsets;this.offsets=[]}if(0<this.result.length){for(var i=0;i<this.result.length;i++){delete this.result[i]}delete this.result;this.result=[]}},setDist:function(dis){if(0<dis){this.dir=OFFSET_DIR.LEFT;this.dist=dis;this.distSqr=(dis-EPSILON.offset)*(dis-EPSILON.offset)}else{this.dir=OFFSET_DIR.RIGHT;this.dist=-dis;this.distSqr=(dis+EPSILON.offset)*(dis+EPSILON.offset)}if(this.distSqr<EPSILON.zero8)return false;return true},setWay:function(graph,way,dis){if(!this.setDist(dis)){return[]}this.clear();var node;var prv_pt=new Vector2,nxt_pt=new Vector2,min_pt=new Vector2,max_pt=new Vector2;var count=way.nodes.length;var basepoint=[],scale=1.0e5;for(var i=0;i<count;i++){node=graph.entity(way.nodes[i]);if(0==i){basepoint[0]=node.loc[0];basepoint[1]=node.loc[1];prv_pt.setxy(0,0);min_pt.setxy(0,0);max_pt.setxy(0,0)}else{nxt_pt.setxy(scale*(node.loc[0]-basepoint[0]),scale*(node.loc[1]-basepoint[1]));if(prv_pt.distanceSqr(nxt_pt)>EPSILON.zero8){if(0<this.lines.length&&this.lines[this.lines.length-1].IsCoLine(nxt_pt)){this.lines[this.lines.length-1].updateE(nxt_pt)}else{var line=new Line(prv_pt,nxt_pt);line.index=this.lines.length;this.lines[this.lines.length]=line}prv_pt.set(nxt_pt);if(min_pt.x>nxt_pt.x)min_pt.x=nxt_pt.x;else if(max_pt.x<nxt_pt.x)max_pt.x=nxt_pt.x;if(min_pt.y>nxt_pt.y)min_pt.y=nxt_pt.y;else if(max_pt.y<nxt_pt.y)max_pt.y=nxt_pt.y}}}if(max_pt.x-min_pt.x>max_pt.y-min_pt.y){dis=iD.geo.metersToLat(dis)*scale}else{dis=iD.geo.metersToLon(dis,basepoint[1])*scale}if(!this.setDist(dis)){return[]}this.operate();return this.revTransform(basepoint,scale)},doOffset:function(shp,dis,scale){if(!this.setDist(dis)){return[]}if(scale==undefined){scale=1.0e5}var basepoint=[shp[0][0],shp[0][1]];var prv_pt=new Vector2(0,0),nxt_pt=new Vector2(0,0),count=shp.length;for(var i=1;i<count;i++){nxt_pt.setxy(scale*(shp[i][0]-basepoint[0]),scale*(shp[i][1]-basepoint[1]));if(prv_pt.distanceSqr(nxt_pt)>EPSILON.zero12){if(0<this.lines.length&&this.lines[this.lines.length-1].IsCoLine(nxt_pt)){this.lines[this.lines.length-1].updateE(nxt_pt)}else{var line=new Line(prv_pt,nxt_pt);line.index=this.lines.length;this.lines[this.lines.length]=line}prv_pt.set(nxt_pt)}}this.operate();return this.revTransform(basepoint,scale)},revTransform:function(basepoint,scale){var invscale=1/scale;var pline_cnt=this.result.length;for(var r=0;r<pline_cnt;r++){var pline=this.result[r];for(var i=0;i<pline.length;i++){pline[i][0]=pline[i][0]*invscale+basepoint[0];pline[i][1]=pline[i][1]*invscale+basepoint[1]}}return this.result},operate:function(){var count=this.lines.length;for(var i=0;i<count;i++){var line=this.lineOffset(this.lines[i]);this.offsets[this.offsets.length]=line}count=this.offsets.length;for(var i=0;i<count-1;i++){this.extendAndTrim(this.offsets[i],this.offsets[i+1])}var xevent=[];count=this.offsets.length;for(var i=0;i<count;i++){var line1=this.offsets[i];for(var j=i+1;j<count;j++){var line2=this.offsets[j];if(j==i+1&&line1.to.distanceSqr(line2.from)<EPSILON.zero12){continue}this.intersection(line1,line2,xevent)}}this.breakAtEvent(xevent);return this.result},lineOffset:function(seg){var line=seg.clone();var normal=seg.getNormal();if(this.dir==OFFSET_DIR.LEFT){normal.multply(this.dist)}else{normal.multply(-this.dist)}line.from.plus(normal);line.to.plus(normal);return line},extendAndTrim:function(line1,line2){var st=[];var dis=lineLineDistance2d(line1.from,line1.to,line2.from,line2.to,st);if(dis<EPSILON.zero8){if(0<st[0]&&1>st[1]){line1.to=line1.pointAt(st[0]);line2.from.set(line1.to)}}},intersection:function(line1,line2,x){var evt=new X_Event;segSegDistance2d(line1.from,line1.to,line2.from,line2.to,evt);if(evt.dsqr<EPSILON.zero12){evt.segA=line1.index;evt.segB=line2.index;x[x.length]=evt}else{}},breakAtEvent:function(x){if(1>x.length){var groups=[],index=-1;while(0<this.offsets.length){var sublines=this.extractOffset(this.offsets);if(!this.detectCollision(sublines)){var sub=new SubLines(index,index-1,sublines);groups.push(sub);index-=2}}this.formOffset(groups);return}var x_sort=[],xevt;var cnt=x.length;for(var i=0;i<cnt;i++){x[i].index=i;x_sort.push(x[i]);xevt=x[i].clone();xevt.swapAB();x_sort.push(xevt)}x_sort.sort(compare_xevt);var groups=[];var sublines=this.getSubLinesA(x_sort[0],0);if(!this.detectCollision(sublines)){var sub=new SubLines(-1,x_sort[0].index,sublines);groups.push(sub)}cnt=x_sort.length;for(var i=0;i<cnt-1;i++){sublines=this.getSubLinesB(x_sort[i],x_sort[i+1]);if(!this.detectCollision(sublines)){sub=new SubLines(x_sort[i].index,x_sort[i+1].index,sublines);groups.push(sub)}}sublines=this.getSubLinesA(x_sort[cnt-1],1);if(!this.detectCollision(sublines)){sub=new SubLines(x_sort[cnt-1].index,-2,sublines);groups.push(sub)}this.formOffset(groups)},formOffset:function(groups){while(0<groups.length){var lines=groups[0];var arr=this.toPolyline(lines.lines);groups.shift();if(lines.xindex[1]!=lines.xindex[0]){var x_index=lines.xindex[1];while(-1!=x_index){var psub=this.findStartIndex(groups,x_index);if(psub){x_index=psub.xindex[1];arr=this.appendLine(arr,psub.lines);this.groupRemoveAt(groups,psub)}else{break}}}this.result.push(arr)}},detectCollisionSeg:function(line){var seg,xevt=new X_Event;var cnt=this.lines.length;for(var i=0;i<cnt;i++){seg=this.lines[i];segSegDistance2d(line.from,line.to,seg.from,seg.to,xevt);if(xevt.dsqr<this.distSqr){return true}}return false},detectCollision:function(sublines){var cnt=sublines.length;if(0<cnt){for(var i=0;i<cnt;i++){if(this.detectCollisionSeg(sublines[i])){return true}}return false}return true},toPolyline:function(lines){var cnt=lines.length;if(0<cnt){var arr=[],pt;for(var i=0;i<cnt;i++){pt=lines[i].from;arr.push([pt.x,pt.y])}pt=lines[cnt-1].to;arr.push([pt.x,pt.y]);return arr}return null},appendLine:function(arr,lines){var cnt=lines.length;for(var i=0;i<cnt;i++){var pt=lines[i].to;arr.push([pt.x,pt.y])}return arr},getSubLinesA:function(evt,flag){var subline,off,arr=[];if(0==flag){for(var i=0;i<evt.segA;i++){off=this.getOffset(i);subline=off.clone();arr.push(subline)}off=this.getOffset(evt.segA);subline=off.subline(0,evt.segA_t);if(subline)arr.push(subline)}else{off=this.getOffset(evt.segA);subline=off.subline(evt.segA_t,1);if(subline)arr.push(subline);var cnt=this.offsets.length;for(var i=evt.segA+1;i<cnt;i++){off=this.getOffset(i);subline=off.clone();arr.push(subline)}}return arr},getSubLinesB:function(evt0,evt1){var subline,off,arr=[];if(evt0.segA==evt1.segA){off=this.getOffset(evt1.segA);subline=off.subline(evt0.segA_t,evt1.segA_t);if(subline){arr.push(subline)}}else if(evt0.segA<evt1.segA){off=this.getOffset(evt0.segA);subline=off.subline(evt0.segA_t,1);if(subline)arr.push(subline);for(var i=evt0.segA+1;i<evt1.segA;++i){off=this.getOffset(i);subline=off.clone();arr.push(subline)}off=this.getOffset(evt1.segA);subline=off.subline(0,evt1.segA_t);if(subline)arr.push(subline)}else{console.log("error form loop")}return arr},extractOffset:function(lines){var line,off,arr=[];line=lines.shift();arr.push(line);while(0<lines.length){off=lines[0];if(line.to.distanceSqr(off.from)<EPSILON.zero12){line=lines.shift();arr.push(line)}else{break}}return arr},findStartIndex:function(groups,x_index){for(var i=0;i<groups.length;i++){var lines=groups[i];if(lines.xindex[0]==x_index){return lines}}return null},groupRemoveAt:function(groups,sub){for(var i=0;i<groups.length;i++){var lines=groups[i];if(lines==sub){groups.splice(i,1);break}}}};function Approximate(){this.tol_chord=0.0001;this.tol_angle=0.0001;this.currdir=undefined;this.seeddir=undefined;this.p0=new Vector2;this.p1=new Vector2;this.q=new Vector2;this.xevt=new PEvent}Approximate.prototype={rarefying:function(shp,chord,angle){this.tol_chord="undefined"!=typeof chord?chord:0.000003;this.tol_angle="undefined"!=typeof angle?angle:12*Math.PI/180;shp=this.removeOverlap(shp);var cnt=shp.length;var from_i=0,to_i=1,end_i,seed_i,step=100;var id_arr=[from_i];while(to_i<cnt){end_i=to_i+step;if(end_i>cnt-1){end_i=cnt-1}seed_i=end_i;while(0<seed_i-to_i){if(this.isLinear(shp,from_i,seed_i)){to_i=seed_i}else{end_i=seed_i}seed_i=parseInt((to_i+end_i)/2);if(seed_i==to_i)break}id_arr[id_arr.length]=seed_i;this.currdir=this.getDir(this.currdir,shp[from_i],shp[seed_i]);from_i=seed_i;to_i=from_i+1}var res=[];cnt=id_arr.length;for(var i=0;i<cnt;i++){res.push(shp[id_arr[i]])}return res},isLinear:function(shp,from_i,to_i){this.p0.setxy(shp[from_i][0],shp[from_i][1]);this.p1.setxy(shp[to_i][0],shp[to_i][1]);for(var i=from_i+1;i<to_i;i++){this.q.setxy(shp[i][0],shp[i][1]);this.q.distanceToSeg(this.p0,this.p1,this.xevt);if(this.xevt.dis>this.tol_chord){return false}}if("undefined"!=typeof this.currdir){this.seeddir=this.getDir(this.seeddir,shp[from_i],shp[to_i]);var angle=this.currdir.angleTo(this.seeddir);if(angle>this.tol_angle){return false}}return true},getDir:function(dir,p0,p1){if("undefined"==typeof dir){dir=new Vector2}dir.setxy(p1[0]-p0[0],p1[1]-p0[1]);dir.unit();return dir},removeOverlap:function(shp){var index=shp.length-1,dis,dx,dy;while(0<index){dx=shp[index][0]-shp[index-1][0];dy=shp[index][1]-shp[index-1][1];dis=Math.sqrt(dx*dx+dy*dy);if(dis<EPSILON.zero8){shp.splice(index,1)}index--}return shp}};var rdoffset={};rdoffset.approximate=function(arr,chord,angle){var appr=new Approximate;return appr.rarefying(arr,chord,angle)};rdoffset.removeOverlap=function(coords){var appr=new Approximate;return appr.removeOverlap(coords)};rdoffset.roadOffset=function(graph,way,dist){var offset=new Offset;return offset.setWay(graph,way,dist)};rdoffset.plineOffset=function(pline,dist){var offset=new Offset;return offset.doOffset(pline,dist)};rdoffset.testOffset=function(){var shape=[[0,0],[10,0],[10,10],[0,10],[0,0]];var offset=new Offset;var res=offset.doOffset(shape,2,1)};return rdoffset};;iD.util.tagExtend={updateWayLengthTag:function(graph,way){function calcuTwoNodesDistance(nodeIdA,nodeIdB,graph){var nodeIdAEntity=graph.entity(nodeIdA),nodeIdBEntity=graph.entity(nodeIdB);var lon=iD.util.lassExtend.getDistance({lon:nodeIdAEntity.loc[0],lat:nodeIdAEntity.loc[1]},{lon:nodeIdBEntity.loc[0],lat:nodeIdBEntity.loc[1]});return lon}function hasAssistInfo(entity){var rels=graph.parentRelations(entity);var flag=false;if(entity.modelName!=iD.data.DataType.HIGHWAY){return flag}for(var i=0;i<rels.length;i++){if(rels[i].modelName==iD.data.DataType.NODECONN){var secRels=graph.parentRelations(rels[i]);secRels.forEach(function(relation){if(relation.modelName==iD.data.DataType.ASSISTINFO){flag=true}})}}return flag}var nodesArr=way.nodes;var i,length=0;if(1<nodesArr.length){for(i=0;i<nodesArr.length-1;i++){length+=calcuTwoNodesDistance(nodesArr[i],nodesArr[i+1],graph)}}if(5>length&&hasAssistInfo(way)){Dialog.alert("\u957F\u5EA6\u5C0F\u4E8E5\u7C73\u7684\u9053\u8DEF\u4E0D\u80FD\u5305\u542B\u95E8\u7981\u4FE1\u606F\uFF0C\u8BF7\u4FEE\u6539\uFF01")}return way},modelNameErro:function(entity){if(entity instanceof iD.Entity&&!_.include([iD.data.DataType.PLACENAME,iD.data.DataType.SEARCH_POINT,"roadcrossline"],entity._type||entity.modelName)){if(_.isUndefined(entity.modelName)||"undefined"==entity.modelName){Dialog.alert("\u5173\u7CFB\u4E2D\u5B58\u5728\u975E\u6CD5modelName"+entity.id+"\u8BF7\u8054\u7CFB\u7814\u53D1");return}}if(entity instanceof iD.Relation){let members=entity.members;for(let i=0;i<members.length;i++){if(_.isUndefined(members[i].modelName)||"undefined"==members[i].modelName){Dialog.alert("\u5173\u7CFB\u4E2D\u5B58\u5728\u975E\u6CD5modelName"+entity.id+"\u8BF7\u8054\u7CFB\u7814\u53D1");return}}}},updateTaskTag:function(entity,newTags){if(!iD.Task.d){return d}let tags=Object.assign({},entity.tags,newTags);let lay=iD.Layers.getLayer(entity.layerId);let modelEntity=iD.ModelEntitys[entity.modelName];let defaultField={};let username=iD.User.getInfo().username;modelEntity&&modelEntity.getFields(modelEntity.getGeoType()).forEach(function(d){defaultField[d.fieldName]=true});let task=iD.Task.d;if(task){tags.TASKID=task.task_id;tags.FLAG="2";if(lay&&lay.batch){tags.BATCH=lay.batch}if(defaultField.hasOwnProperty("OPERATOR")){tags.OPERATOR=username}if(defaultField.hasOwnProperty("SDATE")){tags.SDATE=new Date().getTime()}var isWorker=iD.User.isWorkRole();var isChecker=iD.User.isCheckRole();if(modelEntity&&modelEntity.modelName()==iD.data.DataType.CHECK_TAG){if(defaultField.hasOwnProperty("EDITBY")&&isWorker){tags.EDITBY=username}if(defaultField.hasOwnProperty("CHECKBY")&&isChecker){tags.CHECKBY=username}}}return tags},updateRoadNodeRealNodeTag:function(graph,entity){var parentWays=graph.parentWays(entity);var wayCounts=0;var tags={REALNODE:"1"};for(var i=0;i<parentWays.length;i++){if(parentWays[i].modelName==iD.data.DataType.ROAD)wayCounts++}return entity},updateRelationsTagsByRealNode:function(graph,entity){function updateDefaultTags(relation){var tags=relation.tags;var modelEntity=iD.Layers.getLayer(relation.layerId).modelEntity();if(modelEntity){var gtype=modelEntity.getGeoType();modelEntity.getFields(gtype).filter(function(d){if(tags.hasOwnProperty(d.fieldName)&&tags[d.fieldName]!=d.defaultValue){tags[d.fieldName]=d.defaultValue}})}return tags}if("-1"==entity.tags.realnode){var firstRels=graph.parentRelations(entity);firstRels.forEach(function(relation){if(relation.modelName==iD.data.DataType.NODEINFO){relation=relation.mergeTags({IMAGE_ID:"",LANEINFO:"",REAR_BMP:"",SIDE_BMP:""});graph=iD.actions.AddEntity(relation)(graph)}if(relation.modelName==iD.data.DataType.NODECONN){var secondeRels=graph.parentRelations(relation);secondeRels.forEach(function(secondRel){graph=iD.actions.DeleteRelation(secondRel.id)(graph)})}})}return graph},updateNodeMeshTag:function(entity,context){return entity;return entity;var meshsArr=MapSheet.getMeshCodeArr(entity,context);if(0==meshsArr.length){console.error("\u672A\u627E\u5230\u5305\u542B\u8282\u70B9"+entity.id+"\u56FE\u5E45\u6570\u636E")}else if(1==meshsArr.length){if(entity.tags.MESH!=meshsArr[0]){entity=entity.mergeTags({MESH:meshsArr[0]})}if("0"!=entity.tags.BOUNDARY){entity=entity.mergeTags({BOUNDARY:"0"})}}else{entity=entity.mergeTags({BOUNDARY:"20"})}return entity},updateVerifyTag:function(entity){return entity},updateAcceTagOfNMaat:function(graph,relation){var from_roadId=relation.memberByRole(iD.data.RoleType.FROAD_ID).id;var to_roadId=relation.memberByRole(iD.data.RoleType.TROAD_ID).id;var nodeId;if(relation.modelName==iD.data.DataType.NODECONN){nodeId=relation.memberByRole(iD.data.RoleType.ROAD_NODE_ID).id}else if(relation.modelName==iD.data.DataType.C_NODECONN){nodeId=relation.memberByRole(iD.data.RoleType.C_NODE_ID).id}var fRoad=graph.entity(from_roadId);var tRoad=graph.entity(to_roadId);var accessable="0";if(from_roadId==to_roadId){if("1"!=fRoad.tags.DIRECTION)accessable="1"}else{if("4"==fRoad.tags.DIRECTION||"4"==tRoad.tags.DIRECTION){accessable="1"}else if("3"==fRoad.tags.DIRECTION){if(fRoad.last()==nodeId){accessable="1"}else if(fRoad.first()==nodeId){if(!("1"==tRoad.tags.DIRECTION||tRoad.first()==nodeId&&"2"==tRoad.tags.DIRECTION||tRoad.last()==nodeId&&"3"==tRoad.tags.DIRECTION)){accessable="1"}}}else if("2"==fRoad.tags.DIRECTION){if(fRoad.last()==nodeId){if(!("1"==tRoad.tags.DIRECTION||tRoad.first()==nodeId&&"2"==tRoad.tags.DIRECTION||tRoad.last()==nodeId&&"3"==tRoad.tags.DIRECTION)){accessable="1"}}else if(fRoad.first()==nodeId){accessable="1"}}else if("1"==fRoad.tags.DIRECTION){if(!("1"==tRoad.tags.DIRECTION||tRoad.first()==nodeId&&"2"==tRoad.tags.DIRECTION||tRoad.last()==nodeId&&"3"==tRoad.tags.DIRECTION)){accessable="1"}}}relation=relation.mergeTags({ACCESSABLE:accessable});return relation},updateAcceTagOfCMaat:function(graph,relation){var accessable="1";if(this.crossMaatIsConnect(graph,relation)){accessable="0"}relation=relation.mergeTags({ACCESSABLE:accessable});return relation},crossMaatIsConnect:function(graph,relation){var nodeIsConnect=function(graph,startId,endId,nodeSet,refWayArr){nodeSet[startId]=1;if(startId==endId){return true}else{var flag=false;graph.parentWays(graph.entity(startId)).forEach(function(way){if(flag){return flag}if(!way.isOneRoadCrossWay()&&-1!=refWayArr.indexOf(way.id)){if(!nodeSet[way.first()]&&(way.tags.DIRECTION==iD.way.direction.twoway||way.tags.DIRECTION==iD.way.direction.reverse)){flag=nodeIsConnect(graph,way.first(),endId,nodeSet,refWayArr)}else if(!nodeSet[way.last()]&&(way.tags.DIRECTION==iD.way.direction.twoway||way.tags.DIRECTION==iD.way.direction.positive)){flag=nodeIsConnect(graph,way.last(),endId,nodeSet,refWayArr)}}});return flag}};var from_roadId=relation.memberByRole(iD.data.RoleType.FROAD_ID).id;var to_roadId=relation.memberByRole(iD.data.RoleType.TROAD_ID).id;var nodeId=relation.memberByRole(iD.data.RoleType.C_NODE_ID).id;var fRoad=graph.entity(from_roadId);var tRoad=graph.entity(to_roadId);var cNode=graph.entity(nodeId);var croassRelation=graph.parentRelations(cNode,iD.data.DataType.R_C_NODE_ROAD_NODE);if(fRoad.id==tRoad.id){if(fRoad.tags.DIRECTION==iD.way.direction.twoway){return true}else{return false}}var nodeIdArr=[];if(!croassRelation.length){return false}croassRelation[0].members.forEach(function(member){if(member.modelName!=iD.data.DataType.C_NODE){nodeIdArr.push(member.id)}});var innerWayIds=[];var allWays=[];nodeIdArr.forEach(function(nodeId){graph.parentWays(graph.entity(nodeId)).forEach(function(way){if(-1==allWays.indexOf(way)&&!way.isOneRoadCrossWay()){allWays.push(way)}})});allWays.forEach(function(way){if(-1!=nodeIdArr.indexOf(way.first())&&-1!=nodeIdArr.indexOf(way.last())){innerWayIds.push(way.id)}});innerWayIds.push(fRoad.id);innerWayIds.push(tRoad.id);var fNodeId=-1==nodeIdArr.indexOf(fRoad.first())?fRoad.first():fRoad.last();var tNodeId=-1==nodeIdArr.indexOf(tRoad.first())?tRoad.first():tRoad.last();if(fRoad.tags.DIRECTION==iD.way.direction.twowayforbid||tRoad.tags.DIRECTION==iD.way.direction.twowayforbid){return false}return nodeIsConnect(graph,fNodeId,tNodeId,{},innerWayIds)},addProIdTag:function(changes,context){var taskData=iD.Task.working;if("2"==taskData.task_classes){var createData=changes.created;var modifiedData=changes.modified;createData.forEach(function(entity){if(entity instanceof iD.Way){entity=entity.mergeTags({pro_id:taskData.basic_id});context.replace(iD.actions.AddEntity(entity))}})}},deleteNewWalkLinkTag:function(changes,context){var createData=changes.created;createData.forEach(function(entity){if(entity instanceof iD.Way){delete entity.tags.isnewwalklink;context.replace(iD.actions.AddEntity(entity))}})}};;iD.util.roadCrossExtend={isUnicomOfArr:function(nodesArr,context){function isUnicomBetweenTwoNodes(node1,node2,context){var flag=false;var parentWays1=context.graph().parentWays(node1);var parentWays2=context.graph().parentWays(node2);for(var i=0;i<parentWays1.length;i++){if(0<=parentWays2.indexOf(parentWays1[i])){flag=true;return flag}}return flag}for(var i=0;i<nodesArr.length;i++){var count=0;var node1=context.graph().entity(nodesArr[i]);for(var j=0;j<nodesArr.length;j++){var node2=context.graph().entity(nodesArr[j]);if(nodesArr[i]!=nodesArr[j]&&!isUnicomBetweenTwoNodes(node1,node2,context)){count++}}if(count==nodesArr.length-1)return false}return true},isUnicomBetweenTwoNodes:function(node1,node2,context){var flag=false;var parentWays1=context.graph().parentWays(node1);var parentWays2=context.graph().parentWays(node2);for(var i=0;i<parentWays1.length;i++){if(0<=parentWays2.indexOf(parentWays1[i])){flag=true;return flag}}return flag},unicomWaysBetweenTwoNodes:function(node1,node2,context){var ways=[];var parentWays1=context.graph().parentWays(node1);var parentWays2=context.graph().parentWays(node2);for(var i=0;i<parentWays1.length;i++){if(0<=parentWays2.indexOf(parentWays1[i])){ways.push(parentWays1[i])}}return ways},getNodesOutWayNum:function(nodeIdArr,graph){var outWays=[];var allWays=[];nodeIdArr.forEach(function(nodeId){graph.parentWays(graph.entity(nodeId)).forEach(function(way){if(-1==allWays.indexOf(way)&&!way.isOneRoadCrossWay()){allWays.push(way)}})});allWays.forEach(function(way){if(-1==nodeIdArr.indexOf(way.first())||-1==nodeIdArr.indexOf(way.last())){outWays.push(way)}});return outWays.length}};;iD.util.dataValidate={checkNodeAndWayValidate:function(all,context){var roadNodeArr=[],roadCrossArr=[],fakeNodeArr=[],wayArr=[];var walkEnterArr=[];var errMsg=[];var nodeSet={};for(var i=0;i<all.length;i++){if(all[i]instanceof iD.Node){if(all[i].isRoadNode()){roadNodeArr.push(all[i]);nodeSet[all[i].id]=1}else if(all[i].isWalkEnter()&&iD.util.justNodeInPlyGonx(all[i],context)){walkEnterArr.push(all[i])}if(all[i].isRoadCross()&&iD.util.justNodeInPlyGonx(all[i],context))roadCrossArr.push(all[i]);if(all[i].modelName==iD.data.DataType.HIGHWAY){fakeNodeArr.push(all[i]);nodeSet[all[i].id]=1}}else if(all[i]instanceof iD.Way&&all[i].modelName==iD.data.DataType.HIGHWAY){var flag=false;if(2>all[i].nodes.length){var str="\u8FD4\u56DE\u6570\u636E\u5728\u9053\u8DEF"+all[i].id+"\u4E0A\u7ED3\u70B9\u6570\u5C0F\u4E8E2\u4E2A";errMsg.push(str);break}for(var j=0;j<all[i].nodes.length;j++){if(!context.hasEntity(all[i].nodes[j])){var str="\u8FD4\u56DE\u6570\u636E\u5728\u9053\u8DEF"+all[i].id+"\u4E0A\u7F3A\u5C11\u8282\u70B9:"+all[i].nodes[j];errMsg.push(str);flag=true;break}}if(flag)break;var fNode=context.entity(all[i].first());var tNode=context.entity(all[i].last());if(!flag&&fNode.modelName!=iD.data.DataType.ROAD_NODE){var str="\u8FD4\u56DE\u6570\u636E\u5728\u9053\u8DEF"+all[i].id+"\u9996\u7ED3\u70B9\u7C7B\u578B\u9519\u8BEF";errMsg.push(str);break}if(!flag&&tNode.modelName!=iD.data.DataType.ROAD_NODE){var str="\u8FD4\u56DE\u6570\u636E\u5728\u9053\u8DEF"+all[i].id+"\u5C3E\u7ED3\u70B9\u7C7B\u578B\u9519\u8BEF";errMsg.push(str);break}if(!flag&&(iD.util.justNodeInPlyGonx(context.graph().entity(all[i].first()),context)||iD.util.justNodeInPlyGonx(context.graph().entity(all[i].first()),context)))wayArr.push(all[i])}else if(all[i]instanceof iD.Way&&all[i].modelName==iD.data.DataType.WALKLINK){var flag=false;if(2>all[i].nodes.length){var str="\u8FD4\u56DE\u6570\u636E\u5728\u6B65\u5BFC\u7EBF"+all[i].id+"\u4E0A\u7ED3\u70B9\u6570\u5C0F\u4E8E2\u4E2A";errMsg.push(str);break}for(var j=0;j<all[i].nodes.length;j++){if(!context.hasEntity(all[i].nodes[j])){var str="\u8FD4\u56DE\u6570\u636E\u5728\u6B65\u5BFC\u7EBF"+all[i].id+"\u4E0A\u7F3A\u5C11\u8282\u70B9:"+all[i].nodes[j];errMsg.push(str);flag=true;break}}if(flag)break;var fNode=context.entity(all[i].first());var tNode=context.entity(all[i].last());if(!flag&&fNode.modelName!=iD.data.DataType.WALKENTER){var str="\u8FD4\u56DE\u6570\u636E\u5728\u6B65\u5BFC\u7EBF"+all[i].id+"\u9996\u7ED3\u70B9\u7C7B\u578B\u9519\u8BEF";errMsg.push(str);break}if(!flag&&tNode.modelName!=iD.data.DataType.WALKENTER){var str="\u8FD4\u56DE\u6570\u636E\u5728\u6B65\u5BFC\u7EBF"+all[i].id+"\u5C3E\u7ED3\u70B9\u7C7B\u578B\u9519\u8BEF";errMsg.push(str);break}if(!flag&&(iD.util.justNodeInPlyGonx(context.graph().entity(all[i].first()),context)||iD.util.justNodeInPlyGonx(context.graph().entity(all[i].last()),context)))wayArr.push(all[i])}}return{errMsg:errMsg,roadNodeArr:roadNodeArr,roadCrossArr:roadCrossArr,wayArr:wayArr,walkEnterArr:walkEnterArr}},checkCrossAndWayValidate:function(wayArr,roadCrossArr,walkEnterArr,context){var errMsg=[];wayArr.forEach(function(entity){var str=iD.topo.check().mainCheck(context.graph(),entity,context);if(str!=undefined)errMsg.push(str)});roadCrossArr.forEach(function(entity){var str=iD.topo.check().mainCheck(context.graph(),entity,context);if(str!=undefined)errMsg.push(str)});walkEnterArr.forEach(function(entity){var str=iD.topo.check().mainCheck(context.graph(),entity,context);if(str!=undefined)errMsg.push(str)});return errMsg}};;iD.util.slopExtend={getDisBetPointAndWay:function(entity,way,graph){var nodesArr=way.nodes;var i,min=Infinity,distance;if(1<nodesArr.length){for(i=0;i<nodesArr.length-1;i++){var loc1=graph.entity(nodesArr[i]).loc;var loc2=graph.entity(nodesArr[i+1]).loc;distance=this.getDisBetPointAndSeg(entity.loc,loc1,loc2);if(distance<min){min=distance}}}return min},getDisBetPointAndSeg:function(loc,loc1,loc2){var distance=0;var P10=[loc[0]-loc1[0],loc[1]-loc1[1]],P12=[loc2[0]-loc1[0],loc2[1]-loc1[1]];var t=(P10[0]*P12[0]+P10[1]*P12[1])/(P12[0]*P12[0]+P12[1]*P12[1]);if(0<t&&1>t){var Pt=[loc1[0]+t*P12[0],loc1[1]+t*P12[1]];var Pt0=[Pt[0]-loc[0],Pt[1]-loc[1]];distance=Math.sqrt(Pt0[0]*Pt0[0]+Pt0[1]*Pt0[1])}else if(0>=t){distance=Math.sqrt(P10[0]*P10[0]+P10[1]*P10[1])}else if(1<=t){var P20=[loc[0]-loc2[0],loc[1]-loc2[1]];distance=Math.sqrt(P20[0]*P20[0]+P20[1]*P20[1])}return distance}};;iD.util.walkExtend=function(){var walkExtendCal={};walkExtendCal.getHighWaysWithFilterBBox=function(context,distance,node){loc=node.loc;var dis=0.00001*distance,highwaysArr=[];var loc1=[loc[0]-dis,loc[1]-dis];var loc2=[loc[0]+dis,loc[1]+dis];var bbox=[loc1,loc2];var all=context.intersects(bbox);all.forEach(function(entity){if(entity instanceof iD.Way&&entity.modelName==iD.data.DataType.HIGHWAY){if(!(dis<iD.util.slopExtend.getDisBetPointAndWay(node,entity,context.graph()))){highwaysArr.push(entity)}}});return highwaysArr};walkExtendCal.jointOperationForWEnters=function(context,wEnterAndRoadObj,way){for(var key in wEnterAndRoadObj){var oldway=wEnterAndRoadObj[key].oldway;if(oldway.id==way.id){var walkEnter=wEnterAndRoadObj[key].walkEnter;var fNode=wEnterAndRoadObj[key].fNode;var tNode=wEnterAndRoadObj[key].tNode;var ratio=wEnterAndRoadObj[key].ratio;var newfNode=context.entity(fNode.id);var newtNode=context.entity(tNode.id);if(!(fNode.loc==newfNode.loc&&tNode.loc==newtNode.loc)){var loc1=newfNode.loc,loc2=newtNode.loc,P12=[loc2[0]-loc1[0],loc2[1]-loc1[1]];var Pt=[loc1[0]+ratio*P12[0],loc1[1]+ratio*P12[1]];context.replace(iD.actions.MoveNode(walkEnter.id,Pt),"\u8054\u52A8\u6B65\u5BFC\u70B9")}}}};walkExtendCal.getWalkEntersWithFilterBBox=function(context,distance,wayA,wayB,graph){if(graph){var tmpGraph=graph}else{var tmpGraph=context.graph()}var nodes=wayA.nodes;var extend,maxLat=-Infinity,minLat=Infinity,maxLon=-Infinity,minLon=Infinity;nodes.forEach(function(nodeId){var node=tmpGraph.entity(nodeId);var loc=node.loc;if(loc[0]>maxLon){maxLon=loc[0]}if(loc[0]<minLon){minLon=loc[0]}if(loc[1]>maxLat){maxLat=loc[1]}if(loc[1]<minLat){minLat=loc[1]}});var dis=0.00001*parseInt(distance);extend=[[minLon-dis,minLat-dis],[maxLon+dis,maxLat+dis]];var all=context.intersects(extend);var walkEnterIDsArr=[];all.forEach(function(entity){if(entity instanceof iD.Node&&entity.modelName==iD.data.DataType.WALKENTER){var shortestDis=iD.util.slopExtend.getDisBetPointAndWay(entity,wayA,tmpGraph);if(shortestDis<distance)walkEnterIDsArr.push(entity.id)}});if(wayB&&0<walkEnterIDsArr.length){var relations=tmpGraph.parentRelations(wayB);relations.forEach(function(rel){if(rel.modelName==iD.data.DataType.RELWKETROAD){var nodeId=rel.memberByRole(iD.data.RoleType.WALKENTER).id;if(-1<walkEnterIDsArr.indexOf(nodeId)){walkEnterIDsArr.splice(walkEnterIDsArr.indexOf(nodeId),1)}}})}return walkEnterIDsArr};walkExtendCal.getObjForWEnterAndRoad=function(ways,graph){var wEnterAndRoadObj=new Object;ways.forEach(function(way){var relations=graph.parentRelations(way);relations.forEach(function(rel){if(rel.modelName==iD.data.DataType.RELWKETROAD){var walkEnterID=rel.memberByRole(iD.data.RoleType.WALKENTER).id;wEnterAndRoadObj[walkEnterID]=getObjForConnectWEnter(graph.entity(walkEnterID),way,graph)}})});return wEnterAndRoadObj};var getObjForConnectWEnter=function(entity,way,graph){var nodesArr=way.nodes;var i,min=Infinity,ratio,distance;var connectedWEnterObj=new Object;if(1<nodesArr.length){for(i=0;i<nodesArr.length-1;i++){var loc1=graph.entity(nodesArr[i]).loc;var loc2=graph.entity(nodesArr[i+1]).loc;distance=getDisBetPointAndSeg(entity.loc,loc1,loc2)[0];ratio=getDisBetPointAndSeg(entity.loc,loc1,loc2)[1];if(distance<min){min=distance;connectedWEnterObj={ratio:ratio,fNode:graph.entity(nodesArr[i]),tNode:graph.entity(nodesArr[i+1]),walkEnter:entity,oldway:way}}}}return connectedWEnterObj};var getDisBetPointAndSeg=function(loc,loc1,loc2){var distance=0;var P10=[loc[0]-loc1[0],loc[1]-loc1[1]],P12=[loc2[0]-loc1[0],loc2[1]-loc1[1]];var t=(P10[0]*P12[0]+P10[1]*P12[1])/(P12[0]*P12[0]+P12[1]*P12[1]);if(0<t&&1>t){var Pt=[loc1[0]+t*P12[0],loc1[1]+t*P12[1]];var Pt0=[Pt[0]-loc[0],Pt[1]-loc[1]];distance=Math.sqrt(Pt0[0]*Pt0[0]+Pt0[1]*Pt0[1])}else if(0>=t){distance=Math.sqrt(P10[0]*P10[0]+P10[1]*P10[1])}else if(1<=t){var P20=[loc[0]-loc2[0],loc[1]-loc2[1]];distance=Math.sqrt(P20[0]*P20[0]+P20[1]*P20[1])}return[distance,t]};return walkExtendCal};;window.XHRM_NUM=2;window.XHRM_WORKERS=[];window.XHRM_CALLBACKS={};for(var i=0;i<XHRM_NUM;i++){XHRM_WORKERS.push(makeWorker(i))}function makeWorker(i){var worker=new Worker("../../js/id/util/xhr_back.js");worker.onmessage=function(msg){var id=msg.data.id;XHRM_CALLBACKS[id]&&XHRM_CALLBACKS[id](msg.data.data);delete XHRM_CALLBACKS[id]};return worker}function Ajax(id){this.id=id}Ajax.prototype.abort=function(){delete XHRM_CALLBACKS[this.id]};function xhrMulti(url,option,callback){var id=Math.floor(Math.random()*XHRM_NUM);var _id=Math.random()+"";XHRM_CALLBACKS[_id]=callback;XHRM_WORKERS[id].postMessage({id:_id,url:url,option:option});return new Ajax(_id)};;iD.data.imagery=[];;iD.data.operations={"icon-operation-delete":[377,127],"icon-operation-cancelRelations":[377,127],"icon-operation-update_divider_node":[20,179],"icon-operation-cancelDividerJunction":[377,127],"icon-operation-circularize":[20,140],"icon-operation-straighten":[40,140],"icon-operation-split":[60,140],"icon-operation-dividerDREF":[1,179],"icon-operation-junction":[60,178],"icon-operation-road_divider":[60,140],"icon-operation-split-road":[180,140],"icon-operation-disconnect":[407,127],"icon-operation-reverse":[100,140],"icon-operation-move":[120,140],"icon-operation-merge":[140,140],"icon-operation-orthogonalize":[258,140],"icon-operation-rotate":[240,140],"icon-operation-simplify":[200,140],"icon-operation-clone":[200,140],"icon-operation-continue":[220,140],"icon-operation-traffic":[160,140],"icon-operation-copy":[610,0],"icon-operation-disabled-copy":[610,40],"icon-operation-paste":[503,155],"icon-operation-rawposition":[277,140],"icon-operation-intersect-road":[568,127],"icon-operation-topo_split":[535,127],"icon-operation-expand":[471,125],"icon-operation-disabled-copy":[504,127],"icon-operation-clone_tags-road":[504,127],"icon-operation-paste_tags-road":[503,155],"icon-operation-roadsmove":[505,127],"icon-operation-RoadCrossCreate":[728,127],"icon-operation-RoadCrossEdit":[728,127],"icon-operation-qc_tag":[377,152.5],"icon-operation-delete_slope":[408,151],"icon-operation-way_editor":[377,152.5],"icon-operation-line_info_modify":[535,157],"icon-operation-createdividerOPL":[200,141],"icon-operation-cancledividerOPL":[407,152],"icon-operation-auto_generate_way":[220,140],"icon-operation-createdividerOPG":[560,1],"icon-operation-cancledividerOPG":[407,152],"icon-operation-createdividerVirtualLane":[594,82],"icon-operation-createdividerVirtualLaneCircle":[594,82],"icon-operation-rectifyDeviationFeature":[594,82],"icon-operation-bridge-point":[728,126],"icon-operation-disabled-delete":[0,160],"icon-operation-disabled-cancelRelations":[0,160],"icon-operation-disabled-cancelDividerJunction":[0,160],"icon-operation-disabled-circularize":[20,160],"icon-operation-disabled-straighten":[40,140],"icon-operation-disabled-split":[60,160],"icon-operation-disabled-split-road":[180,140],"icon-operation-disabled-disconnect":[80,160],"icon-operation-disabled-reverse":[100,160],"icon-operation-disabled-move":[120,160],"icon-operation-disabled-merge":[140,160],"icon-operation-disabled-dividerDREF":[1,179],"icon-operation-disabled-junction":[60,178],"icon-operation-disabled-update_divider_node":[20,179],"icon-operation-disabled-road_divider":[60,160],"icon-operation-disabled-orthogonalize":[258,160],"icon-operation-disabled-rotate":[240,140],"icon-operation-disabled-simplify":[200,160],"icon-operation-disabled-continue":[220,160],"icon-operation-disabled-traffic":[160,160],"icon-operation-disabled-rawposition":[277,160],"icon-operation-disabled-createdividerOPL":[200,141],"icon-operation-disabled-cancledividerOPL":[407,152],"icon-operation-disabled-createdividerOPG":[560,1],"icon-operation-disabled-cancledividerOPG":[407,152],"icon-operation-disabled-createdividerVirtualLane":[594,82],"icon-operation-disabled-createdividerVirtualLaneCircle":[594,82],"icon-operation-disabled-rectifyDeviationFeature":[594,82],"icon-restriction-yes":[200,324],"icon-restriction-no":[203,334],"icon-restriction-only":[203,334],"icon-restriction-yes-u":[203,334],"icon-restriction-no-u":[203,334],"icon-restriction-only-u":[203,334]};;iD.data.roadSpecificationMap={roadclass:{41000:"\u9AD8\u901F\u516C\u8DEF",42000:"\u56FD\u9053",43000:"\u57CE\u5E02\u5FEB\u901F\u8DEF",44000:"\u4E3B\u8981\u9053\u8DEF",45000:"\u6B21\u8981\u9053\u8DEF",4700:"\u666E\u901A\u9053\u8DEF",51000:"\u7701\u9053",52000:"\u53BF\u9053",53000:"\u4E61\u516C\u8DEF",54000:"\u53BF\u4E61\u6751\u5185\u90E8\u9053\u8DEF",49:"\u5C0F\u8DEF"},limspeed:{0:"\u9AD8\u5FB7\u5B9E\u91C7\u6570\u636E",1:"G25\u6570\u636E",2:"G05\u6570\u636E\uFF082005\uFF09",3:"\u4E16\u535A\u56ED\u533A\u6570\u636E",4:"\u79FB\u52A8\u8F66e\u884C\u6570\u636E",5:"\u5F71\u50CF\u6570\u636E",6:"\u6846\u67B6\u6570\u636E",7:"API\u6570\u636E",8:"A02\u6570\u636E",9:"\u60C5\u62A5\u6570\u636E",10:"\u6D6E\u52A8\u8F66\u6570\u636E",11:"G05\u6570\u636E\uFF082011\uFF09",12:"IN-B\u6570\u636E",13:"IN-B-10\u6570\u636E",14:"\u8857\u666F\u9053\u8DEF",15:"\u4F17\u5305\u9053\u8DEF",16:"G05\u8DEF\u540D\uFF082011\uFF09",17:"\u4E09\u7EF4\u9AD8\u7CBE\u5EA6\u8DEF\u7F51",18:"HD\u8DEF\u540D",19:"\u540D\u79F0\u4F17\u5305"},formway:{"-1":"\u672A\u8BBE\u5B9A",1:"\u4E0A\u4E0B\u7EBF\u5206\u79BB\u9053\u8DEF\uFF08\u9AD8\u901F\u516C\u8DEF\uFF09",2:"\u4E0A\u4E0B\u7EBF\u5206\u79BB\u9053\uFF08\u975E\u9AD8\u901F\u516C\u8DEF\uFF09",3:"\u666E\u901A\u9053\u8DEF\uFF08\u9ED8\u8BA4\u503C\uFF09",4:"\u73AF\u5C9B\u9053\u8DEF",7:"\u505C\u8F66\u697C\u5185\u90E8\u9053\u8DEF",101:"\u5E73\u884C\u8DEF",102:"\u4E3B\u8FDE\u63A5\u8DEF",103:"\u5DE6\u3001\u53F3\u8F6C\u4E13\u7528\u9053\u8DEF",104:"\u4E3B\u8FDE\u63A5\u8DEF\u4E0A\u7684\u5DE6\u3001\u53F3\u8F6C\u4E13\u7528\u9053\u8DEF",11:"\u7279\u670D\u8DEF",12:"\u8FDB\u5165/\u9000\u51FA\u505C\u8F66\u573A\u7684\u9053\u8DEF",14:"\u5546\u4E1A\u6B65\u884C\u8857",15:"\u6B65\u9053",17:"\u7C7B\u73AF\u5C9B"},linktype:{0:"\u9053\u8DEF\uFF08\u9ED8\u8BA4\uFF09",1:"\u8F6E\u6E21\u822A\u7EBF",2:"\u96A7\u9053",3:"\u6865",4:"\u5730\u4E0B\u4EA4\u901A\u901A\u9053"},owner_ship:{0:"\u516C\u5171\u9053\u8DEF\uFF08\u9ED8\u8BA4\uFF09",1:"\u5185\u90E8\u9053\u8DEF",2:"\u79C1\u6709\u9053\u8DEF",3:"\u5730\u4E0B\u505C\u8F66\u573A\u9053\u8DEF",4:"\u7ACB\u4F53\u505C\u8F66\u573A\u9053\u8DEF",5:"\u5BA4\u5916\u505C\u8F66\u573A\u9053\u8DEF",6:"\u505C\u8F66\u697C\u4E00\u5C42\u9053\u8DEF"},fow:{"-1":"\u672A\u8BBE\u5B9A",1:"\u4E0A\u4E0B\u7EBF\u5206\u79BB\u9053\u8DEF\uFF08\u9AD8\u901F\u516C\u8DEF\uFF09",2:"\u4E0A\u4E0B\u7EBF\u5206\u79BB\u9053\uFF08\u975E\u9AD8\u901F\u516C\u8DEF\uFF09",3:"\u666E\u901A\u9053\u8DEF\uFF08\u9ED8\u8BA4\u503C\uFF09",4:"\u73AF\u5C9B\u9053\u8DEF",7:"\u505C\u8F66\u697C\u5185\u90E8\u9053\u8DEF",101:"\u5E73\u884C\u8DEF",102:"\u4E3B\u8FDE\u63A5\u8DEF",103:"\u5DE6\u3001\u53F3\u8F6C\u4E13\u7528\u9053\u8DEF",104:"\u4E3B\u8FDE\u63A5\u8DEF\u4E0A\u7684\u5DE6\u3001\u53F3\u8F6C\u4E13\u7528\u9053\u8DEF",11:"\u7279\u670D\u8DEF",12:"\u8FDB\u5165/\u9000\u51FA\u505C\u8F66\u573A\u7684\u9053\u8DEF",14:"\u5546\u4E1A\u6B65\u884C\u8857",15:"\u6B65\u9053",17:"\u7C7B\u73AF\u5C9B"},fc:{1:"\u9AD8\u901F\u516C\u8DEF",2:"\u56FD\u9053\u3001\u57CE\u5E02\u5FEB\u901F\u8DEF",3:"\u7701\u9053",4:"\u6B21\u8981\u9053\u8DEF",5:"\u4E3B\u8981\u9053\u8DEF\u3001\u53BF\u8DEF\u3001\u4E61\u516C\u8DEF",6:"\u666E\u901A\u9053\u8DEF\u3001\u53BF\u4E61\u6751\u5185\u90E8\u9053\u8DEF\u3001\u5C0F\u8DEF\u3001\u8F6E\u5ED3\u7EBF"},lc_1:{0:"\u666E\u901A\u9053\u8DEF\u3001\u53BF\u4E61\u6751\u5185\u90E8\u9053\u8DEF\u3001\u5C0F\u8DEF\u3001\u8F6E\u5ED3\u7EBF",1:"\u53BF\u9053\u3001\u4E61\u516C\u8DEF\u3001\u4E3B\u8981\u9053\u8DEF\u3001\u6B21\u8981\u9053\u8DEF",2:"\u7701\u9053",3:"",4:"\u9AD8\u901F\u516C\u8DEF\u3001\u56FD\u9053\u3001\u57CE\u5E02\u5FEB\u901F\u8DEF"},lc_2:{0:"\u666E\u901A\u9053\u8DEF\u3001\u53BF\u4E61\u6751\u5185\u90E8\u9053\u8DEF\u3001\u5C0F\u8DEF\u3001\u8F6E\u5ED3\u7EBF",1:"\u53BF\u9053\u3001\u4E61\u516C\u8DEF\u3001\u4E3B\u8981\u9053\u8DEF\u3001\u6B21\u8981\u9053\u8DEF",2:"\u7701\u9053",3:"",4:"\u9AD8\u901F\u516C\u8DEF\u3001\u56FD\u9053\u3001\u57CE\u5E02\u5FEB\u901F\u8DEF"},width:{"-1":"\u672A\u8C03\u67E5\uFF08\u9ED8\u8BA4\uFF09"}};;iD.data.locales=["af","sq","ar","ar-AA","hy","ast","bn","bs","bg-BG","ca","zh","zh-CN","zh-CN.GB2312","gan","zh-HK","zh-TW","yue","hr","cs","da","nl","en-GB","et","fi","fr","gl","de","el","hu","is","id","it","ja","kn","ko","ko-KR","lv","lt","no","nn","fa","pl","pt","pt-BR","ro-RO","ru","sc","sr","sr-RS","si","sk","sl","es","sv","tl","ta","te","tr","uk","vi"];;iD.data.Constant={C_NODE:"C_NODE",ROADNODE:"RoadNode",HIGHWAY:"Highway",LANUSE:"LandUse",ZLEVEL:"ZLevel",ROADRULE:"RoadRule",NODERULE:"NodeRule",SPEEDCAMERA:"SpeedCamera",CROSSRULE:"CrossRule",CROSSMAAT:"CrossMaat",NODEMAAT:"NodeMaat"};iD.data.RoleType={ROAD_ID:"ROAD_ID",FROAD_ID:"FROAD_ID",C_NODE_ID:"C_NODE_ID",ROAD_NODE_ID:"ROAD_NODE_ID",TROAD_ID:"TROAD_ID",NODECONN_ID:"NODECONN_ID",TURN_GUIDANCE_ID:"TURN_GUIDANCE_ID",C_NODECONN_ID:"C_NODECONN_ID",DIVIDER_ID:"DIVIDER_ID",OBJECT_PL_ID:"OBJECT_PL_ID",OBJECT_PG_ID:"OBJECT_PG_ID",JUNCTION_ID:"JUNCTION_ID",ROAD_ATTRIBUTE_ID:"ROAD_ATTRIBUTE_ID",DIVIDER_NODE_ID:"DIVIDER_NODE_ID",NODE:"node",OBJECT_PT_ID:"OBJECT_PT_ID",LIMITHEIGHT_ID:"LIMITHEIGHT_ID",BRIDGE_ID:"BRIDGE_ID",TRAFFICLIGHT_ID:"TRAFFICLIGHT_ID",BRIDGE_NODE_ID:"BRIDGE_NODE_ID",OBJECT_PL_NODE_ID:"OBJECT_PL_NODE_ID",OBJECT_PG_NODE_ID:"OBJECT_PG_NODE_ID",LAMPPOST_ID:"LAMPPOST_ID",TRAFFICSIGN_NODE_ID:"TRAFFICSIGN_NODE_ID",LANEA_ID:"LANEA_ID"};iD.data.GeoType={0:"relation",1:"area",2:"line",3:"area"};iD.data.GeomType={WAY:"way",RELATION:"relation",NODE:"node",MIDPOINT:"MIDPOINT"};iD.data.Model2Role={BRIDGE_NODE:"BRIDGE_POINT_ID",LIMITHEIGHT:"LIMITHEIGHT_ID",LAMPPOST:"LAMPPOST_ID",TRAFFICLIGHT:"TRAFFICLIGHT_ID",OBJECT_PG_NODE:"OBJECT_PG_POINT_ID",OBJECT_PL_NODE:"OBJECT_PL_POINT_ID",OBJECT_PT:"OBJECT_PT_ID",TRAFFICSIGN_NODE:"TRAFFICSIGN_POINT_ID",DIVIDER_NODE:"DIVIDER_NODE_ID",ROAD_ATTRIBUTE:"ROAD_ATTRIBUTE_ID"};iD.data.DataType={ROAD:"ROAD",C_NODE:"C_NODE",C_NODECONN:"C_NODECONN",ROAD_NODE:"ROAD_NODE",NODEINFO:"NODEINFO",ROAD_ATTRIBUTE:"ROAD_ATTRIBUTE",R_ROAD_DIVIDER:"R_ROAD_DIVIDER",R_ROAD_RA:"R_ROAD_RA",DIVIDER:"DIVIDER",NODECONN:"NODECONN",R_DIVIDER_JUNCTION:"R_DIVIDER_JUNCTION",JUNCTION:"JUNCTION",R_DIVIDER_DREF:"R_DIVIDER_DREF",R_DIVIDER_OPT:"R_DIVIDER_OPT",R_DIVIDER_OPL:"R_DIVIDER_OPL",R_DIVIDER_OPG:"R_DIVIDER_OPG",R_IDIVIDER_OPT:"R_IDIVIDER_OPT",R_ODIVIDER_OPT:"R_ODIVIDER_OPT",DIVIDER_NODE:"DIVIDER_NODE",LANDCOVERAREA:"LANDCOVERAREA",DIVIDER_ATTRIBUTE:"DIVIDER_ATTRIBUTE",LANE_ATTRIBUTE:"LANE_ATTRIBUTE",LANE_ATTRIBUTE_RESTRICTION:"LANE_ATTRIBUTE_RESTRICTION",POI:"POI",TEXT_MARK:"TEXT_MARK",HIGHWAY:"Highway",PLACENAME:"PlaceName",SEARCH_POINT:"SearchPoint",TRAFFICRULE:"TRAFFICRULE",C_TRAFFICRULE:"C_TRAFFICRULE",TURN_GUIDANCE:"TURN_GUIDANCE",TRAFFICSIGN:"TRAFFICSIGN",TRAFFICSIGN_NODE:"TRAFFICSIGN_NODE",OBJECT_PG:"OBJECT_PG",OBJECT_PG_NODE:"OBJECT_PG_NODE",OBJECT_PL:"OBJECT_PL",OBJECT_PL_NODE:"OBJECT_PL_NODE",OBJECT_PT:"OBJECT_PT",R_OPT_OPT:"R_OPT_OPT",R_OPT_OPG:"R_OPT_OPG",R_C_NODE_ROAD_NODE:"R_C_NODE_ROAD_NODE",FUSION_OBJECT_PG:"OBJECT_PG",FUSION_OBJECT_PG_NODE:"OBJECT_PG_NODE",FUSION_OBJECT_PL:"OBJECT_PL",FUSION_OBJECT_PL_NODE:"OBJECT_PL_NODE",FUSION_R_OPT_OPT:"R_OPT_OPT",LANEINFO:"LANEINFO",C_LANEINFO:"C_LANEINFO",C_NODEINFO:"C_NODEINFO",LIMITHEIGHT:"LIMITHEIGHT",R_DIVIDER_LH:"R_DIVIDER_LH",BRIDGE:"BRIDGE",BRIDGE_NODE:"BRIDGE_NODE",R_BRIDGE_LH:"R_BRIDGE_LH",TRAFFICLIGHT:"TRAFFICLIGHT",R_TRAFFICLIGHT_TREF:"R_TRAFFICLIGHT_TREF",R_DIVIDER_TL:"R_DIVIDER_TL",LAMPPOST:"LAMPPOST",R_LAMPPOST_LREF:"R_LAMPPOST_LREF",CHECK_TAG:"CHECK_TAG",IMAGE_TAG:"IMAGE_TAG",ANALYSIS_TAG:"ANALYSIS_TAG",QUESTION_TAG:"QUESTION_TAG",MEASUREINFO:"MEASUREINFO"};iD.data.RoadMerge={};iD.data.asRelations=[iD.data.Constant.C_NODE,iD.data.DataType.C_TRAFFICRULE,iD.data.DataType.TRAFFICRULE];iD.data.QCTAG={ROADINFOTAG:"1",CROSSINFOTAG:"2",MULTIINFOTAG:"3",QUESTIONTAG:"4",ADDTAG:"5",MINUSTAG:"6"};iD.data.sceneCode={HD_DATA_LANE:"HD_DATA_LANE",HD_DATA_LO:"HD_DATA_LO",HD_DATA:"HD_DATA"};iD.data.sceneDataType={[iD.data.sceneCode.HD_DATA_LANE]:["C_NODE","ROAD_NODE","R_C_NODE_ROAD_NODE","ROAD","C_NODECONN","NODECONN","C_TRAFFICRULE","TRAFFICRULE","TURN_GUIDANCE","C_NODEINFO","NODEINFO","C_LANEINFO","LANEINFO","ROAD_ATTRIBUTE","R_ROAD_RA","DIVIDER","R_ROAD_DIVIDER","R_DIVIDER_DREF","DIVIDER_NODE","DIVIDER_ATTRIBUTE","LANE_ATTRIBUTE","LANE_ATTRIBUTE_RESTRICTION","JUNCTION","R_DIVIDER_JUNCTION","MEASUREINFO","OBJECT_PG","OBJECT_PG_NODE","LIMITHEIGHT","BRIDGE","BRIDGE_NODE","R_BRIDGE_LH","R_DIVIDER_LH"],[iD.data.sceneCode.HD_DATA_LO]:["OBJECT_PG","R_DIVIDER_OPG","OBJECT_PL","R_DIVIDER_OPL","OBJECT_PT","R_DIVIDER_OPT","R_IDIVIDER_OPT","R_ODIVIDER_OPT","R_OPT_OPG","R_OPT_OPT","TRAFFICSIGN","OBJECT_PG_NODE","TRAFFICLIGHT","R_TRAFFICLIGHT_TREF","R_DIVIDER_TL","LAMPPOST","R_LAMPPOST_LREF","OBJECT_PL_NODE","TRAFFICSIGN_NODE","MEASUREINFO"],[iD.data.sceneCode.HD_DATA]:["C_NODE","ROAD_NODE","R_C_NODE_ROAD_NODE","ROAD","C_NODECONN","NODECONN","C_TRAFFICRULE","TRAFFICRULE","TURN_GUIDANCE","C_NODEINFO","NODEINFO","C_LANEINFO","LANEINFO","ROAD_ATTRIBUTE","R_ROAD_RA","DIVIDER","R_ROAD_DIVIDER","R_DIVIDER_DREF","DIVIDER_NODE","DIVIDER_ATTRIBUTE","LANE_ATTRIBUTE","LANE_ATTRIBUTE_RESTRICTION","OBJECT_PG","R_DIVIDER_OPG","OBJECT_PL","R_DIVIDER_OPL","OBJECT_PT","R_DIVIDER_OPT","R_IDIVIDER_OPT","R_ODIVIDER_OPT","R_OPT_OPG","R_OPT_OPT","JUNCTION","R_DIVIDER_JUNCTION","TRAFFICSIGN","OBJECT_PG_NODE","LIMITHEIGHT","R_DIVIDER_LH","TRAFFICLIGHT","R_TRAFFICLIGHT_TREF","R_DIVIDER_TL","BRIDGE","R_BRIDGE_LH","LAMPPOST","OBJECT_PL_NODE","BRIDGE_NODE","TRAFFICSIGN_NODE","MEASUREINFO","R_LAMPPOST_LREF"]};iD.data.RoadMerge.ignoreFields=["ID","FNODE_ID","TNODE_ID","VERIFIED","EDIT_OPER","VERIFYTIME","VERIFYUSER","CREATEUSER","CREATETIME","UPDATEUSER","UPDATETIME","ADF_ID"];iD.data.RoadMerge.compareFields={WalkLink:["NAME_CHN","WF_TYPE","ISTOLL","COVERED","LINK_TYPE","DIRECTION","SLOPE","BLOCK_TYPE","OWNERSHIP","ARULE_TIME","NAVITYPE"],ROAD:["ALIAS_CHN","FNAME_CHN","AVE_LANES","ROAD_CLASS","DIRECTION","FORM_WAY","WIDTH","LINK_TYPE","OWNER_SHIP","STATUS","FC","NAME_CHN","SOURCE_FLAG","ADAS"]};iD.refLayer={user_feed_back:"user_feed_back",key_projects_tag_point:"key_projects_tag_point",key_projects_tag_line:"key_projects_tag_line",key_projects_tag_polygon:"key_projects_tag_polygon"};iD.alert={};iD.alert.tip={operation_create_fake_node_in_crossnode:"\u5F53\u524D\u64CD\u4F5C\u5C06\u751F\u6210\u60AC\u6302\u70B9\uFF0C\u4E0D\u80FD\u88AB\u7EFC\u5408\uFF0C\u8BF7\u5148\u5220\u9664\u7EFC\u5408\u4EA4\u53C9\u70B9"};iD.tagIndex={t_user_feedback_pkb_tag:"t_user_feedback_pkb_tag",t_user_feedback_pkb_shp:"t_user_feedback_pkb_shp",t_pkb_shp:"t_pkb_shp",ref_tag:"ref_tag",t_pkb_tag:"t_pkb_tag"};iD.way={},iD.way.direction={twoway:"1",positive:"2",reverse:"3",twowayforbid:"4"};iD.AdasPassword={password:"ADAS"};iD.walkRoadFlag={WALKROAD:"WALKROAD",ROAD:"ROAD"};iD.labels=iD.labels||{};iD.labels._modelNameMapping={[iD.data.DataType.OBJECT_PT]:iD.data.DataType.OBJECT_PT,[iD.data.DataType.LAMPPOST]:iD.data.DataType.LAMPPOST,[iD.data.DataType.OBJECT_PT]:iD.data.DataType.OBJECT_PT,[iD.data.DataType.OBJECT_PG]:iD.data.DataType.OBJECT_PG,[iD.data.DataType.OBJECT_PL]:iD.data.DataType.OBJECT_PL,[iD.data.DataType.OBJECT_PL_NODE]:iD.data.DataType.OBJECT_PL_NODE};iD.labels.entityLabelNameMap={[iD.data.DataType.OBJECT_PT]:{TYPE:{2:{SUBTYPE:{4:"\u8DEF\u706F\u6746",12:"\u706F\u5934",13:"\u6746\u9876\u70B9",13:"\u63A7\u5236\u70B9"}},3:{SUBTYPE:{0:"\u8DEF\u724C"}}}},[iD.data.DataType.LAMPPOST]:{TYPE:{1:"\u706F\u6746",2:"\u706F\u5934"}},[iD.data.DataType.TRAFFICLIGHT]:"\u4EA4\u901A\u706F"};iD.labels.labelSourceName=function(modelName){var self=this,result="";modelName=self._modelNameMapping[modelName]||modelName;var tagMap=self.entityLabelNameMap[modelName];if(!tagMap){return result}if("string"===typeof tagMap){result=tagMap}var args=_.toArray(arguments);args=args.slice(1);let subMap=tagMap;for(let i in args){let kv=args[i];if(2!=kv.length||"string"!==typeof kv[0]){continue}let name=kv[0],value=kv[1];subMap=subMap[name];if(!subMap){break}subMap=subMap[value];if(subMap===undefined){break}else if("string"===typeof subMap){result=subMap}}return null==result?"":result};iD.labels.effectEntityFilter={_filterMap:{}};iD.labels.effectEntityFilter.get=function(modelName){return this._filterMap[modelName]};iD.labels.effectEntityFilter.set=function(modelName,filter){if(!(filter instanceof Function))return;this._filterMap[modelName]=function(entity){return Object.assign({name:"",value:""},filter(entity))}};iD.labels.effectEntityFilter.remove=function(modelName){delete this._filterMap[modelName]};iD.labels.effectEntityFilter.set(iD.data.DataType.ANALYSIS_TAG,function(entity){return{name:"id",value:iD.Entity.id.toOSM(entity.id)}});;;iD.store={};iD.store.url={layer:"",searchpoi:"http://apis.kd.com/gss/simple"};iD.store.qq={isLoad:false,url:"http://map.qq.com/api/js?v=2.exp&key=d84d6d83e0e51e481e50454ccbe8986b"};iD.store.layers={road:{id:"904",bboxSId:"2102",modelSId:"2801",saveId:"2105",name:"\u5BFC\u822A\u8DEF\u7F51\u56FE\u5C42",type:"road",editable:true,display:true,split:false,isProxy:false,filter:"",url:iD.store.url.layer,style:{},label:{fieldKey:"name_chn",display:true,fontSize:13,fill:"#000000"},showappendant:"1",geometry:"line",childSid:"2565",dataModelGeoType:{nodemaat:"6",crossmaat:"8",roadnode:"9",roadcross:"10",NodeRule:"11",CrossRule:"12"},enableBox:true,continues:true,origCoord:false,tagSet:true},line:{id:"921",bboxSId:"2102",modelSId:"2801",saveId:"2105",name:"\u7EBF\u56FE\u5C42",type:"line",editable:true,display:true,isProxy:false,filter:"",url:iD.store.url.layer,label:{fieldKey:"name",display:true,fontSize:13,fill:"#000000"},enableBox:true,continues:true,origCoord:false,tagSet:true},point:{id:"1076",bboxSId:"2102",modelSId:"2801",saveId:"2105",name:"\u70B9\u56FE\u5C42",type:"point",editable:true,isProxy:false,display:true,filter:"",url:iD.store.url.layer,label:{fieldKey:"name",display:true,fontSize:13,fill:"#000000"},enableBox:true,continues:true,origCoord:false,tagSet:true},hotSpot:{id:"1076",name:"\u70ED\u70B9\u56FE\u5C42",type:"hotspot",editable:true,isProxy:false,dataUrl:iD.store.url.layer,tileUrl:iD.store.url.layer},area:{id:"1077",bboxSId:"2102",modelSId:"2801",saveId:"2105",name:"\u9762\u56FE\u5C42",type:"area",editable:true,display:true,isProxy:false,isTF:false,filter:"",url:iD.store.url.layer,style:{"stroke-width":"6px","fill-opacity":0.6,stroke:"rgb(57, 238, 37)",fill:"rgb(27, 240, 231)"},label:{fieldKey:"name",display:true,fontSize:13,fill:"#000000"},enableBox:true,continues:true,origCoord:false,tagSet:true}};iD.store.imagery={overlayer:{name:"map overlayer name",type:"tms",description:"",url:"",zooms:[0,22],hotspot:false,id:"overlayer_id",visible:false,terms_url:"",terms_text:"",terms_html:"",isOverlay:true},imagery:{name:"Map aerial imagery",type:"map_type",description:"",url:"",zooms:[0,22],id:"map_id",visible:false}};iD.store.roadclass={41000:"motorway",42000:"country",43000:"trunk",44000:"secondary",45000:"tertiary",47000:"boundary",51000:"power",52000:"residential",53000:"natural",54000:"landuse",49:"service",roadcrossline:"roadcrossline",trafficway:"trafficway"};iD.store.dividerAttrColor={0:"color-0",1:"color-1",2:"color-2",3:"color-3",4:"color-4"};iD.store.dividerAttrType={0:"default",1:"solid",2:"dash",3:"solid",4:"dash"};iD.store.dividerAttrVirtual={0:"virtual-0",1:"virtual-1",2:"virtual-2",3:"virtual-3"};iD.store.markerstyle={fontStyle:{"font-size":"19","font-weight":"bold",fill:"red","font-family":"\u5FAE\u8F6F\u96C5\u9ED1"},rectStyle:{fill:"#267124",opacity:0.5,stroke:"#267124","stroke-width":2},arrowStyle:{fill:"#267124"}};;iD.data.presets.categories={"category-building":{geometry:"area",name:"Building",icon:"building",members:["building/house","building/apartments","building/commercial","building/industrial","building/residential","building"]},"category-golf":{geometry:"area",name:"Golf",icon:"golf",members:["golf/fairway","golf/green","golf/lateral_water_hazard","golf/rough","golf/bunker","golf/tee","golf/water_hazard"]},"category-landuse":{geometry:"area",name:"Land Use",icon:"land-use",members:["landuse/residential","landuse/industrial","landuse/commercial","landuse/retail","landuse/farm","landuse/farmyard","landuse/forest","landuse/meadow","landuse/cemetery","landuse/military"]},"category-path":{geometry:"line",name:"Path",icon:"category-path",members:["highway/footway","highway/cycleway","highway/bridleway","highway/path","highway/steps"]},"category-rail":{geometry:"line",name:"Rail",icon:"category-rail",members:["railway/rail","railway/subway","railway/tram","railway/monorail","railway/disused","railway/abandoned"]},"category-restriction":{geometry:"relation",name:"Restriction",icon:"restriction",members:["type/restriction/no_left_turn","type/restriction/no_right_turn","type/restriction/no_straight_on","type/restriction/no_u_turn","type/restriction/only_left_turn","type/restriction/only_right_turn","type/restriction/only_straight_on","type/restriction"]},"category-road":{geometry:"line",name:"Road",icon:"category-roads",members:["highway/residential","highway/motorway","highway/trunk","highway/primary","highway/secondary","highway/tertiary","highway/service","highway/motorway_link","highway/trunk_link","highway/primary_link","highway/secondary_link","highway/tertiary_link","highway/unclassified","highway/track","highway/road"]},"category-route":{geometry:"relation",name:"Route",icon:"route",members:["type/route/road","type/route/bicycle","type/route/foot","type/route/hiking","type/route/bus","type/route/train","type/route/tram","type/route/ferry","type/route/power","type/route/pipeline","type/route/detour","type/route_master","type/route"]},"category-water-area":{geometry:"area",name:"Water",icon:"water",members:["natural/water/lake","natural/water/pond","natural/water/reservoir","natural/water"]},"category-water-line":{geometry:"line",name:"Water",icon:"category-water",members:["waterway/river","waterway/stream","waterway/canal","waterway/ditch","waterway/drain"]}};;iD.data.presets.defaults={area:["category-landuse","category-building","category-water-area","leisure/park","amenity/hospital","amenity/place_of_worship","amenity/cafe","amenity/restaurant","area"],line:["category-road","category-rail","category-path","category-water-line","power/line","line"],point:["leisure/park","amenity/hospital","amenity/place_of_worship","amenity/cafe","amenity/restaurant","amenity/bar","amenity/bank","shop/supermarket","point"],vertex:["highway/crosswalk","railway/level_crossing","highway/traffic_signals","highway/turning_circle","highway/mini_roundabout","highway/motorway_junction","vertex"],relation:["category-route","category-restriction","type/boundary","type/multipolygon","relation"]};;iD.data.presets.fields={access:{keys:["access","foot","motor_vehicle","bicycle","horse"],reference:{key:"access"},type:"access",label:"Access",placeholder:"Unknown",strings:{types:{access:"General",foot:"Foot",motor_vehicle:"Motor Vehicles",bicycle:"Bicycles",horse:"Horses"},options:{yes:{title:"Allowed",description:"Access permitted by law; a right of way"},no:{title:"Prohibited",description:"Access not permitted to the general public"},permissive:{title:"Permissive",description:"Access permitted until such time as the owner revokes the permission"},private:{title:"Private",description:"Access permitted only with permission of the owner on an individual basis"},designated:{title:"Designated",description:"Access permitted according to signs or specific local laws"},destination:{title:"Destination",description:"Access permitted only to reach a destination"}}}},access_simple:{key:"access",type:"combo",label:"Access",placeholder:"yes",options:["permissive","private","customers","no"]},access_toilets:{key:"access",type:"combo",label:"Access",options:["public","permissive","private","customers"]},address:{type:"address",keys:["addr:housename","addr:housenumber","addr:street","addr:city","addr:postcode"],reference:{key:"addr"},icon:"address",universal:true,label:"Address",strings:{placeholders:{housename:"Housename",housenumber:"123",street:"Street",city:"City",postcode:"Postcode",place:"Place",hamlet:"Hamlet",suburb:"Suburb",subdistrict:"Subdistrict",district:"District",province:"Province",state:"State",country:"Country"}}},admin_level:{key:"admin_level",type:"number",label:"Admin Level"},aerialway:{key:"aerialway",type:"typeCombo",label:"Type"},"aerialway/access":{key:"aerialway:access",type:"combo",label:"Access",strings:{options:{entry:"Entry",exit:"Exit",both:"Both"}}},"aerialway/bubble":{key:"aerialway:bubble",type:"check",label:"Bubble"},"aerialway/capacity":{key:"aerialway:capacity",type:"number",label:"Capacity (per hour)",placeholder:"500, 2500, 5000..."},"aerialway/duration":{key:"aerialway:duration",type:"number",label:"Duration (minutes)",placeholder:"1, 2, 3..."},"aerialway/heating":{key:"aerialway:heating",type:"check",label:"Heated"},"aerialway/occupancy":{key:"aerialway:occupancy",type:"number",label:"Occupancy",placeholder:"2, 4, 8..."},"aerialway/summer/access":{key:"aerialway:summer:access",type:"combo",label:"Access (summer)",strings:{options:{entry:"Entry",exit:"Exit",both:"Both"}}},aeroway:{key:"aeroway",type:"typeCombo",label:"Type"},amenity:{key:"amenity",type:"typeCombo",label:"Type"},artist:{key:"artist_name",type:"text",label:"Artist"},artwork_type:{key:"artwork_type",type:"combo",label:"Type"},atm:{key:"atm",type:"check",label:"ATM"},backrest:{key:"backrest",type:"check",label:"Backrest"},barrier:{key:"barrier",type:"typeCombo",label:"Type"},bicycle_parking:{key:"bicycle_parking",type:"combo",label:"Type"},boundary:{key:"boundary",type:"combo",label:"Type"},building:{key:"building",type:"typeCombo",label:"Building"},building_area:{key:"building",type:"defaultcheck",default:"yes",geometry:"area",label:"Building"},capacity:{key:"capacity",type:"number",label:"Capacity",placeholder:"50, 100, 200..."},cardinal_direction:{key:"direction",type:"combo",label:"Direction",strings:{options:{N:"North",E:"East",S:"South",W:"West",NE:"Northeast",SE:"Southeast",SW:"Southwest",NW:"Northwest",NNE:"North-northeast",ENE:"East-northeast",ESE:"East-southeast",SSE:"South-southeast",SSW:"South-southwest",WSW:"West-southwest",WNW:"West-northwest",NNW:"North-northwest"}}},clock_direction:{key:"direction",type:"combo",label:"Direction",strings:{options:{clockwise:"Clockwise",anticlockwise:"Counterclockwise"}}},collection_times:{key:"collection_times",type:"text",label:"Collection Times"},construction:{key:"construction",type:"combo",label:"Type"},country:{key:"country",type:"combo",label:"Country"},covered:{key:"covered",type:"check",label:"Covered"},crop:{key:"crop",type:"combo",label:"Crop"},crossing:{key:"crossing",type:"combo",label:"Type"},cuisine:{key:"cuisine",type:"combo",label:"Cuisine"},denomination:{key:"denomination",type:"combo",label:"Denomination"},denotation:{key:"denotation",type:"combo",label:"Denotation"},description:{key:"description",type:"textarea",label:"Description"},electrified:{key:"electrified",type:"combo",label:"Electrification",placeholder:"Contact Line, Electrified Rail...",strings:{options:{contact_line:"Contact Line",rail:"Electrified Rail",yes:"Yes (unspecified)",no:"No"}}},elevation:{key:"ele",type:"number",icon:"elevation",universal:true,label:"Elevation"},emergency:{key:"emergency",type:"check",label:"Emergency"},entrance:{key:"entrance",type:"typeCombo",label:"Type"},except:{key:"except",type:"combo",label:"Exceptions"},fax:{key:"fax",type:"tel",label:"Fax",placeholder:"+31 42 123 4567"},fee:{key:"fee",type:"check",label:"Fee"},"fire_hydrant/type":{key:"fire_hydrant:type",type:"combo",label:"Type",strings:{options:{pillar:"Pillar/Aboveground",underground:"Underground",wall:"Wall",pond:"Pond"}}},fixme:{key:"fixme",type:"textarea",label:"Fix Me"},fuel:{key:"fuel",type:"combo",label:"Fuel"},"fuel/biodiesel":{key:"fuel:biodiesel",type:"check",label:"Sells Biodiesel"},"fuel/diesel":{key:"fuel:diesel",type:"check",label:"Sells Diesel"},"fuel/e10":{key:"fuel:e10",type:"check",label:"Sells E10"},"fuel/e85":{key:"fuel:e85",type:"check",label:"Sells E85"},"fuel/lpg":{key:"fuel:lpg",type:"check",label:"Sells Propane"},"fuel/octane_100":{key:"fuel:octane_100",type:"check",label:"Sells Racing Gasoline"},"fuel/octane_91":{key:"fuel:octane_91",type:"check",label:"Sells Regular Gasoline"},"fuel/octane_95":{key:"fuel:octane_95",type:"check",label:"Sells Midgrade Gasoline"},"fuel/octane_98":{key:"fuel:octane_98",type:"check",label:"Sells Premium Gasoline"},gauge:{key:"gauge",type:"combo",label:"Gauge"},"generator/method":{key:"generator:method",type:"combo",label:"Method"},"generator/source":{key:"generator:source",type:"combo",label:"Source"},"generator/type":{key:"generator:type",type:"combo",label:"Type"},golf_hole:{key:"ref",type:"text",label:"Reference",placeholder:"Hole number (1-18)"},handicap:{key:"handicap",type:"number",label:"Handicap",placeholder:"1-18"},highway:{key:"highway",type:"typeCombo",label:"Type"},historic:{key:"historic",type:"typeCombo",label:"Type"},hoops:{key:"hoops",type:"number",label:"Hoops",placeholder:"1, 2, 4..."},iata:{key:"iata",type:"text",label:"IATA"},icao:{key:"icao",type:"text",label:"ICAO"},incline:{key:"incline",type:"combo",label:"Incline"},information:{key:"information",type:"typeCombo",label:"Type"},internet_access:{key:"internet_access",type:"combo",label:"Internet Access",strings:{options:{yes:"Yes",no:"No",wlan:"Wifi",wired:"Wired",terminal:"Terminal"}}},lamp_type:{key:"lamp_type",type:"combo",label:"Type"},landuse:{key:"landuse",type:"typeCombo",label:"Type"},lanes:{key:"lanes",type:"number",label:"Lanes",placeholder:"1, 2, 3..."},layer:{key:"layer",type:"combo",label:"Layer"},leisure:{key:"leisure",type:"typeCombo",label:"Type"},length:{key:"length",type:"number",label:"Length (Meters)"},levels:{key:"building:levels",type:"number",label:"Levels",placeholder:"2, 4, 6..."},lit:{key:"lit",type:"check",label:"Lit"},location:{key:"location",type:"combo",label:"Location"},man_made:{key:"man_made",type:"typeCombo",label:"Type"},maxspeed:{key:"maxspeed",type:"maxspeed",label:"Speed Limit",placeholder:"40, 50, 60..."},"mtb/scale":{key:"mtb:scale",type:"combo",label:"Mountain Biking Difficulty",placeholder:"0, 1, 2, 3...",strings:{options:{0:"0: Solid gravel/packed earth, no obstacles, wide curves",1:"1: Some loose surface, small obstacles, wide curves",2:"2: Much loose surface, large obstacles, easy hairpins",3:"3: Slippery surface, large obstacles, tight hairpins",4:"4: Loose surface or boulders, dangerous hairpins",5:"5: Maximum difficulty, boulder fields, landslides",6:"6: Not rideable except by the very best mountain bikers"}}},"mtb/scale/imba":{key:"mtb:scale:imba",type:"combo",label:"IMBA Trail Difficulty",placeholder:"Easy, Medium, Difficult...",strings:{options:{0:"Easiest (white circle)",1:"Easy (green circle)",2:"Medium (blue square)",3:"Difficult (black diamond)",4:"Extremely Difficult (double black diamond)"}}},"mtb/scale/uphill":{key:"mtb:scale:uphill",type:"combo",label:"Mountain Biking Uphill Difficulty",placeholder:"0, 1, 2, 3...",strings:{options:{0:"0: Avg. incline <10%, gravel/packed earth, no obstacles",1:"1: Avg. incline <15%, gravel/packed earth, few small objects",2:"2: Avg. incline <20%, stable surface, fistsize rocks/roots",3:"3: Avg. incline <25%, variable surface, fistsize rocks/branches",4:"4: Avg. incline <30%, poor condition, big rocks/branches",5:"5: Very steep, bike generally needs to be pushed or carried"}}},name:{key:"name",type:"localized",label:"Name",placeholder:"Common name (if any)"},natural:{key:"natural",type:"typeCombo",label:"Natural"},network:{key:"network",type:"text",label:"Network"},note:{key:"note",type:"textarea",universal:true,icon:"note",label:"Note"},office:{key:"office",type:"typeCombo",label:"Type"},oneway:{key:"oneway",type:"check",label:"One Way",strings:{options:{undefined:"Assumed to be No",yes:"Yes",no:"No"}}},oneway_yes:{key:"oneway",type:"check",label:"One Way",strings:{options:{undefined:"Assumed to be Yes",yes:"Yes",no:"No"}}},opening_hours:{key:"opening_hours",type:"text",label:"Hours"},operator:{key:"operator",type:"text",label:"Operator"},par:{key:"par",type:"number",label:"Par",placeholder:"3, 4, 5..."},park_ride:{key:"park_ride",type:"check",label:"Park and Ride"},parking:{key:"parking",type:"combo",label:"Type",strings:{options:{surface:"Surface","multi-storey":"Multilevel",underground:"Underground",sheds:"Sheds",carports:"Carports",garage_boxes:"Garage Boxes",lane:"Roadside Lane"}}},phone:{key:"phone",type:"tel",icon:"telephone",universal:true,label:"Phone",placeholder:"+31 42 123 4567"},"piste/difficulty":{key:"piste:difficulty",type:"combo",label:"Difficulty",placeholder:"Easy, Intermediate, Advanced...",strings:{options:{novice:"Novice (instructional)",easy:"Easy (green circle)",intermediate:"Intermediate (blue square)",advanced:"Advanced (black diamond)",expert:"Expert (double black diamond)",freeride:"Freeride (off-piste)",extreme:"Extreme (climbing equipment required)"}}},"piste/grooming":{key:"piste:grooming",type:"combo",label:"Grooming",strings:{options:{classic:"Classic",mogul:"Mogul",backcountry:"Backcountry","classic+skating":"Classic and Skating",scooter:"Scooter/Snowmobile",skating:"Skating"}}},"piste/type":{key:"piste:type",type:"typeCombo",label:"Type",strings:{options:{downhill:"Downhill",nordic:"Nordic",skitour:"Skitour",sled:"Sled",hike:"Hike",sleigh:"Sleigh",ice_skate:"Ice Skate",snow_park:"Snow Park",playground:"Playground"}}},place:{key:"place",type:"typeCombo",label:"Type"},population:{key:"population",type:"text",label:"Population"},power:{key:"power",type:"typeCombo",label:"Type"},railway:{key:"railway",type:"typeCombo",label:"Type"},"recycling/cans":{key:"recycling:cans",type:"check",label:"Accepts Cans"},"recycling/clothes":{key:"recycling:clothes",type:"check",label:"Accepts Clothes"},"recycling/glass":{key:"recycling:glass",type:"check",label:"Accepts Glass"},"recycling/paper":{key:"recycling:paper",type:"check",label:"Accepts Paper"},ref:{key:"ref",type:"text",label:"Reference"},relation:{key:"type",type:"combo",label:"Type"},religion:{key:"religion",type:"combo",label:"Religion"},restriction:{key:"restriction",type:"combo",label:"Type"},restrictions:{type:"restrictions",geometry:"vertex",icon:"restrictions",reference:{rtype:"restriction"},label:"Turn Restrictions"},route:{key:"route",type:"combo",label:"Type"},route_master:{key:"route_master",type:"combo",label:"Type"},sac_scale:{key:"sac_scale",type:"combo",label:"Hiking Difficulty",placeholder:"Mountain Hiking, Alpine Hiking...",strings:{options:{hiking:"T1: Hiking",mountain_hiking:"T2: Mountain Hiking",demanding_mountain_hiking:"T3: Demanding Mountain Hiking",alpine_hiking:"T4: Alpine Hiking",demanding_alpine_hiking:"T5: Demanding Alpine Hiking",difficult_alpine_hiking:"T6: Difficult Alpine Hiking"}}},seasonal:{key:"seasonal",type:"check",label:"Seasonal"},service:{key:"service",type:"combo",label:"Type",options:["parking_aisle","driveway","alley","emergency_access","drive-through"]},shelter:{key:"shelter",type:"check",label:"Shelter"},shelter_type:{key:"shelter_type",type:"combo",label:"Type"},shop:{key:"shop",type:"typeCombo",label:"Type"},sloped_curb:{key:"sloped_curb",type:"combo",label:"Sloped Curb"},smoking:{key:"smoking",type:"combo",label:"Smoking",placeholder:"No, Separated, Yes...",strings:{options:{no:"No smoking anywhere",separated:"In smoking areas, not physically isolated",isolated:"In smoking areas, physically isolated",outside:"Allowed outside",yes:"Allowed everywhere",dedicated:"Dedicated to smokers (e.g. smokers' club)"}}},smoothness:{key:"smoothness",type:"combo",label:"Smoothness",placeholder:"Thin Rollers, Wheels, Off-Road...",strings:{options:{excellent:"Thin Rollers: rollerblade, skateboard",good:"Thin Wheels: racing bike",intermediate:"Wheels: city bike, wheelchair, scooter",bad:"Robust Wheels: trekking bike, car, rickshaw",very_bad:"High Clearance: light duty off-road vehicle",horrible:"Off-Road: heavy duty off-road vehicle",very_horrible:"Specialized off-road: tractor, ATV",impassible:"Impassible / No wheeled vehicle"}}},social_facility_for:{key:"social_facility:for",type:"radio",label:"People served",placeholder:"Homeless, Disabled, Child, etc",options:["abused","child","disabled","diseased","drug_addicted","homeless","juvenile","mental_health","migrant","orphan","senior","underprivileged","unemployed","victim"]},source:{key:"source",type:"text",icon:"source",universal:true,label:"Source"},sport:{key:"sport",type:"combo",label:"Sport"},sport_ice:{key:"sport",type:"combo",label:"Sport",options:["skating","hockey","multi","curling","ice_stock"]},structure:{type:"radio",keys:["bridge","tunnel","embankment","cutting","ford"],label:"Structure",placeholder:"Unknown",strings:{options:{bridge:"Bridge",tunnel:"Tunnel",embankment:"Embankment",cutting:"Cutting",ford:"Ford"}}},studio_type:{key:"type",type:"combo",label:"Type",options:["audio","video"]},supervised:{key:"supervised",type:"check",label:"Supervised"},surface:{key:"surface",type:"combo",label:"Surface"},tactile_paving:{key:"tactile_paving",type:"check",label:"Tactile Paving"},"toilets/disposal":{key:"toilets:disposal",type:"combo",label:"Disposal",strings:{options:{flush:"Flush",pitlatrine:"Pit/Latrine",chemical:"Chemical",bucket:"Bucket"}}},tourism:{key:"tourism",type:"typeCombo",label:"Type"},towertype:{key:"tower:type",type:"combo",label:"Tower type"},tracktype:{key:"tracktype",type:"combo",label:"Track Type",placeholder:"Solid, Mostly Solid, Soft...",strings:{options:{grade1:"Solid: paved or heavily compacted hardcore surface",grade2:"Mostly Solid: gravel/rock with some soft material mixed in",grade3:"Even mixture of hard and soft materials",grade4:"Mostly Soft: soil/sand/grass with some hard material mixed in",grade5:"Soft: soil/sand/grass"}}},trail_visibility:{key:"trail_visibility",type:"combo",label:"Trail Visibility",placeholder:"Excellent, Good, Bad...",strings:{options:{excellent:"Excellent: unambiguous path or markers everywhere",good:"Good: markers visible, sometimes require searching",intermediate:"Intermediate: few markers, path mostly visible",bad:"Bad: no markers, path sometimes invisible/pathless",horrible:"Horrible: often pathless, some orientation skills required",no:"No: pathless, excellent orientation skills required"}}},tree_type:{key:"type",type:"combo",label:"Type",options:["broad_leaved","conifer","palm"]},trees:{key:"trees",type:"combo",label:"Trees"},tunnel:{key:"tunnel",type:"combo",label:"Tunnel"},vending:{key:"vending",type:"combo",label:"Type of Goods"},water:{key:"water",type:"combo",label:"Type"},waterway:{key:"waterway",type:"typeCombo",label:"Type"},website:{key:"website",type:"url",icon:"website",placeholder:"http://example.com/",universal:true,label:"Website"},wetland:{key:"wetland",type:"combo",label:"Type"},wheelchair:{key:"wheelchair",type:"radio",options:["yes","limited","no"],icon:"wheelchair",universal:true,label:"Wheelchair Access"},width:{key:"width",type:"number",label:"Width (Meters)"},wikipedia:{key:"wikipedia",type:"wikipedia",icon:"wikipedia",universal:true,label:"Wikipedia"},wood:{key:"wood",type:"combo",label:"Type"}};;iD.data.presets.presets={address:{fields:["address"],geometry:["point"],tags:{"addr:housenumber":"*"},addTags:{},removeTags:{},matchScore:0.2,name:"Address"},aerialway:{fields:["aerialway"],geometry:["point","vertex","line"],tags:{aerialway:"*"},terms:["ski lift","funifor","funitel"],name:"Aerialway"},"aerialway/cable_car":{geometry:["line"],terms:["tramway","ropeway"],fields:["aerialway/occupancy","aerialway/capacity","aerialway/duration","aerialway/heating"],tags:{aerialway:"cable_car"},name:"Cable Car"},"aerialway/chair_lift":{geometry:["line"],fields:["aerialway/occupancy","aerialway/capacity","aerialway/duration","aerialway/bubble","aerialway/heating"],tags:{aerialway:"chair_lift"},name:"Chair Lift"},"aerialway/gondola":{geometry:["line"],fields:["aerialway/occupancy","aerialway/capacity","aerialway/duration","aerialway/bubble","aerialway/heating"],tags:{aerialway:"gondola"},name:"Gondola"},"aerialway/magic_carpet":{geometry:["line"],fields:["aerialway/capacity","aerialway/duration","aerialway/heating"],tags:{aerialway:"magic_carpet"},name:"Magic Carpet Lift"},"aerialway/platter":{geometry:["line"],terms:["button lift","poma lift"],fields:["aerialway/capacity","aerialway/duration"],tags:{aerialway:"platter"},name:"Platter Lift"},"aerialway/pylon":{geometry:["point","vertex"],fields:["ref"],tags:{aerialway:"pylon"},name:"Aerialway Pylon"},"aerialway/rope_tow":{geometry:["line"],terms:["handle tow","bugel lift"],fields:["aerialway/capacity","aerialway/duration"],tags:{aerialway:"rope_tow"},name:"Rope Tow Lift"},"aerialway/station":{geometry:["point","vertex"],fields:["aerialway/access","aerialway/summer/access","elevation"],tags:{aerialway:"station"},name:"Aerialway Station"},"aerialway/t-bar":{geometry:["line"],fields:["aerialway/capacity","aerialway/duration"],tags:{aerialway:"t-bar"},name:"T-bar Lift"},aeroway:{icon:"airport",fields:["aeroway"],geometry:["point","vertex","line","area"],tags:{aeroway:"*"},name:"Aeroway"},"aeroway/aerodrome":{icon:"airport",geometry:["point","area"],terms:["airplane","airport","aerodrome"],fields:["ref","iata","icao","operator"],tags:{aeroway:"aerodrome"},name:"Airport"},"aeroway/apron":{icon:"airport",geometry:["area"],terms:["ramp"],fields:["ref","surface"],tags:{aeroway:"apron"},name:"Apron"},"aeroway/gate":{icon:"airport",geometry:["point"],fields:["ref"],tags:{aeroway:"gate"},name:"Airport gate"},"aeroway/hangar":{geometry:["area"],fields:["building_area"],tags:{aeroway:"hangar"},name:"Hangar"},"aeroway/helipad":{icon:"heliport",geometry:["point","area"],terms:["helicopter","helipad","heliport"],tags:{aeroway:"helipad"},name:"Helipad"},"aeroway/runway":{geometry:["line","area"],terms:["landing strip"],fields:["ref","surface","length","width"],tags:{aeroway:"runway"},name:"Runway"},"aeroway/taxiway":{geometry:["line"],fields:["ref","surface"],tags:{aeroway:"taxiway"},name:"Taxiway"},"aeroway/terminal":{geometry:["point","area"],terms:["airport","aerodrome"],fields:["operator","building_area"],tags:{aeroway:"terminal"},name:"Airport terminal"},amenity:{fields:["amenity"],geometry:["point","vertex","area"],tags:{amenity:"*"},name:"Amenity"},"amenity/arts_centre":{name:"Arts Center",geometry:["point","area"],terms:["arts","arts centre"],tags:{amenity:"arts_centre"},icon:"theatre",fields:["building_area","address"]},"amenity/atm":{icon:"bank",fields:["operator"],geometry:["point","vertex"],tags:{amenity:"atm"},name:"ATM"},"amenity/bank":{icon:"bank",fields:["atm","building_area","address","opening_hours"],geometry:["point","vertex","area"],terms:["coffer","countinghouse","credit union","depository","exchequer","fund","hoard","investment firm","repository","reserve","reservoir","safe","savings","stock","stockpile","store","storehouse","thrift","treasury","trust company","vault"],tags:{amenity:"bank"},name:"Bank"},"amenity/bar":{icon:"bar",fields:["building_area","address","opening_hours","smoking"],geometry:["point","vertex","area"],tags:{amenity:"bar"},terms:[],name:"Bar"},"amenity/bbq":{geometry:["point"],tags:{amenity:"bbq"},fields:["covered","fuel"],terms:["barbecue","bbq","grill"],name:"Barbecue/Grill"},"amenity/bench":{geometry:["point","vertex","line"],tags:{amenity:"bench"},fields:["backrest"],name:"Bench"},"amenity/bicycle_parking":{icon:"bicycle",fields:["bicycle_parking","capacity","operator","covered","access_simple"],geometry:["point","vertex","area"],tags:{amenity:"bicycle_parking"},name:"Bicycle Parking"},"amenity/bicycle_rental":{icon:"bicycle",fields:["capacity","network","operator"],geometry:["point","vertex","area"],tags:{amenity:"bicycle_rental"},name:"Bicycle Rental"},"amenity/boat_rental":{geometry:["point","area"],tags:{amenity:"boat_rental"},fields:["operator"],name:"Boat Rental"},"amenity/bus_station":{geometry:["point","area"],tags:{amenity:"bus_station"},fields:["operator"],name:"Bus Station"},"amenity/cafe":{icon:"cafe",fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],geometry:["point","vertex","area"],terms:["coffee","tea","coffee shop"],tags:{amenity:"cafe"},name:"Cafe"},"amenity/car_rental":{icon:"car",geometry:["point","area"],tags:{amenity:"car_rental"},fields:["operator"],name:"Car Rental"},"amenity/car_sharing":{icon:"car",geometry:["point","area"],tags:{amenity:"car_sharing"},fields:["operator","capacity"],name:"Car Sharing"},"amenity/car_wash":{icon:"car",geometry:["point","area"],tags:{amenity:"car_wash"},fields:["building_area"],name:"Car Wash"},"amenity/charging_station":{icon:"car",geometry:["point","area"],tags:{amenity:"charging_station"},fields:["operator"],terms:["EV","Electric Vehicle","Supercharger"],name:"Charging Station"},"amenity/childcare":{icon:"school",fields:["building_area","address"],geometry:["point","vertex","area"],terms:["nursery","orphanage","playgroup"],tags:{amenity:"childcare"},name:"Childcare"},"amenity/cinema":{icon:"cinema",fields:["building_area","address"],geometry:["point","vertex","area"],terms:["big screen","bijou","cine","drive-in","film","flicks","motion pictures","movie house","movie theater","moving pictures","nabes","photoplay","picture show","pictures","playhouse","show","silver screen"],tags:{amenity:"cinema"},name:"Cinema"},"amenity/clinic":{name:"Clinic",geometry:["point","area"],terms:["clinic","medical clinic"],tags:{amenity:"clinic"},icon:"hospital",fields:["building_area","address","opening_hours"]},"amenity/clock":{geometry:["point","vertex"],tags:{amenity:"clock"},name:"Clock"},"amenity/college":{icon:"college",fields:["operator","address"],geometry:["point","area"],tags:{amenity:"college"},terms:[],name:"College"},"amenity/compressed_air":{icon:"car",geometry:["point","area"],tags:{amenity:"compressed_air"},name:"Compressed Air"},"amenity/courthouse":{fields:["operator","building_area","address"],geometry:["point","vertex","area"],tags:{amenity:"courthouse"},name:"Courthouse"},"amenity/dentist":{name:"Dentist",geometry:["point","area"],terms:["dentist","dentist's office"],tags:{amenity:"dentist"},icon:"hospital",fields:["building_area","address","opening_hours"]},"amenity/doctor":{name:"Doctor",geometry:["point","area"],terms:["doctor","doctor's office"],tags:{amenity:"doctors"},icon:"hospital",fields:["building_area","address","opening_hours"]},"amenity/dojo":{icon:"pitch",geometry:["point","area"],terms:["martial arts","dojo","dojang"],tags:{amenity:"dojo"},fields:["address","sport"],name:"Dojo / Martial Arts Academy"},"amenity/drinking_water":{icon:"water",geometry:["point"],tags:{amenity:"drinking_water"},terms:["water fountain","potable water"],name:"Drinking Water"},"amenity/embassy":{geometry:["area","point"],tags:{amenity:"embassy"},fields:["country","building_area"],icon:"embassy",name:"Embassy"},"amenity/fast_food":{icon:"fast-food",fields:["cuisine","building_area","address","opening_hours","smoking"],geometry:["point","vertex","area"],tags:{amenity:"fast_food"},terms:[],name:"Fast Food"},"amenity/fire_station":{icon:"fire-station",fields:["operator","building_area","address"],geometry:["point","vertex","area"],tags:{amenity:"fire_station"},terms:[],name:"Fire Station"},"amenity/fountain":{geometry:["point","area"],tags:{amenity:"fountain"},name:"Fountain"},"amenity/fuel":{icon:"fuel",fields:["operator","address","building_area"],geometry:["point","vertex","area"],terms:["petrol","fuel","propane","diesel","lng","cng","biodiesel"],tags:{amenity:"fuel"},name:"Gas Station"},"amenity/grave_yard":{icon:"cemetery",fields:["religion","denomination"],geometry:["point","vertex","area"],tags:{amenity:"grave_yard"},name:"Graveyard"},"amenity/hospital":{icon:"hospital",fields:["emergency","address"],geometry:["point","vertex","area"],terms:["clinic","emergency room","health service","hospice","infirmary","institution","nursing home","rest home","sanatorium","sanitarium","sick bay","surgery","ward"],tags:{amenity:"hospital"},name:"Hospital Grounds"},"amenity/kindergarten":{icon:"school",fields:["address"],geometry:["point","vertex","area"],terms:["nursery","preschool"],tags:{amenity:"kindergarten"},name:"Kindergarten Grounds"},"amenity/library":{icon:"library",fields:["operator","building_area","address"],geometry:["point","vertex","area"],tags:{amenity:"library"},terms:[],name:"Library"},"amenity/marketplace":{geometry:["point","vertex","area"],tags:{amenity:"marketplace"},fields:["building_area"],name:"Marketplace"},"amenity/nightclub":{icon:"bar",fields:["building_area","address","opening_hours","smoking"],geometry:["point","vertex","area"],tags:{amenity:"nightclub"},terms:["disco*","night club","dancing","dance club"],name:"Nightclub"},"amenity/parking":{icon:"parking",fields:["parking","capacity","fee","access_simple","supervised","park_ride","address"],geometry:["point","vertex","area"],tags:{amenity:"parking"},terms:[],name:"Car Parking"},"amenity/parking_entrance":{icon:"entrance",geometry:["vertex"],tags:{amenity:"parking_entrance"},fields:["access_simple","ref"],name:"Parking Garage Entrance/Exit"},"amenity/pharmacy":{icon:"pharmacy",fields:["operator","building_area","address","opening_hours"],geometry:["point","vertex","area"],tags:{amenity:"pharmacy"},terms:[],name:"Pharmacy"},"amenity/place_of_worship":{icon:"place-of-worship",fields:["religion","denomination","building_area","address"],geometry:["point","vertex","area"],terms:["abbey","basilica","bethel","cathedral","chancel","chantry","chapel","church","fold","house of God","house of prayer","house of worship","minster","mission","mosque","oratory","parish","sacellum","sanctuary","shrine","synagogue","tabernacle","temple"],tags:{amenity:"place_of_worship"},name:"Place of Worship"},"amenity/place_of_worship/buddhist":{icon:"place-of-worship",fields:["denomination","building_area","address"],geometry:["point","vertex","area"],terms:["stupa","vihara","monastery","temple","pagoda","zendo","dojo"],tags:{amenity:"place_of_worship",religion:"buddhist"},name:"Buddhist Temple"},"amenity/place_of_worship/christian":{icon:"religious-christian",fields:["denomination","building_area","address"],geometry:["point","vertex","area"],terms:["christian","abbey","basilica","bethel","cathedral","chancel","chantry","chapel","church","fold","house of God","house of prayer","house of worship","minster","mission","oratory","parish","sacellum","sanctuary","shrine","tabernacle","temple"],tags:{amenity:"place_of_worship",religion:"christian"},name:"Church"},"amenity/place_of_worship/jewish":{icon:"religious-jewish",fields:["denomination","building_area","address"],geometry:["point","vertex","area"],terms:["jewish","synagogue"],tags:{amenity:"place_of_worship",religion:"jewish"},name:"Synagogue"},"amenity/place_of_worship/muslim":{icon:"religious-muslim",fields:["denomination","building_area","address"],geometry:["point","vertex","area"],terms:["muslim","mosque"],tags:{amenity:"place_of_worship",religion:"muslim"},name:"Mosque"},"amenity/police":{icon:"police",fields:["operator","building_area","address"],geometry:["point","vertex","area"],terms:["badge","bear","blue","bluecoat","bobby","boy scout","bull","constable","constabulary","cop","copper","corps","county mounty","detective","fed","flatfoot","force","fuzz","gendarme","gumshoe","heat","law","law enforcement","man","narc","officers","patrolman","police"],tags:{amenity:"police"},name:"Police"},"amenity/post_box":{icon:"post",fields:["operator","collection_times"],geometry:["point","vertex"],tags:{amenity:"post_box"},terms:["letter drop","letterbox","mail drop","mailbox","pillar box","postbox"],name:"Mailbox"},"amenity/post_office":{icon:"post",fields:["operator","collection_times","building_area"],geometry:["point","vertex","area"],tags:{amenity:"post_office"},name:"Post Office"},"amenity/pub":{icon:"beer",fields:["building_area","address","opening_hours","smoking"],geometry:["point","vertex","area"],tags:{amenity:"pub"},terms:[],name:"Pub"},"amenity/ranger_station":{fields:["building_area","opening_hours","operator","phone"],geometry:["point","area"],terms:["visitor center","visitor centre","permit center","permit centre","backcountry office","warden office","warden center"],tags:{amenity:"ranger_station"},name:"Ranger Station"},"amenity/recycling":{icon:"recycling",fields:["recycling/cans","recycling/glass","recycling/paper","recycling/clothes"],geometry:["point","vertex","area"],terms:[],tags:{amenity:"recycling"},name:"Recycling"},"amenity/restaurant":{icon:"restaurant",fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],geometry:["point","vertex","area"],terms:["bar","cafeteria","caf\xE9","canteen","chophouse","coffee shop","diner","dining room","dive*","doughtnut shop","drive-in","eatery","eating house","eating place","fast-food place","fish and chips","greasy spoon","grill","hamburger stand","hashery","hideaway","hotdog stand","inn","joint*","luncheonette","lunchroom","night club","outlet*","pizzeria","saloon","soda fountain","watering hole"],tags:{amenity:"restaurant"},name:"Restaurant"},"amenity/school":{icon:"school",fields:["operator","address"],geometry:["point","vertex","area"],terms:["academy","alma mater","blackboard","college","department","discipline","establishment","faculty","hall","halls of ivy","institute","institution","jail*","schoolhouse","seminary","university"],tags:{amenity:"school"},name:"School Grounds"},"amenity/shelter":{fields:["shelter_type"],geometry:["point","vertex","area"],tags:{amenity:"shelter"},terms:["lean-to"],name:"Shelter"},"amenity/social_facility":{name:"Social Facility",geometry:["point","area"],terms:[],tags:{amenity:"social_facility"},fields:["social_facility_for","address","phone","opening_hours","wheelchair","operator"]},"amenity/social_facility/food_bank":{name:"Food Bank",geometry:["point","area"],terms:[],tags:{amenity:"social_facility",social_facility:"food_bank"},fields:["social_facility_for","address","phone","opening_hours","wheelchair","operator"]},"amenity/social_facility/group_home":{name:"Group Home",geometry:["point","area"],terms:["elderly","old","senior living"],tags:{amenity:"social_facility",social_facility:"group_home",social_facility_for:"senior"},fields:["social_facility_for","address","phone","opening_hours","wheelchair","operator"]},"amenity/social_facility/homeless_shelter":{name:"Homeless Shelter",geometry:["point","area"],terms:["houseless","unhoused","displaced"],tags:{amenity:"social_facility",social_facility:"shelter","social_facility:for":"homeless"},fields:["social_facility_for","address","phone","opening_hours","wheelchair","operator"]},"amenity/studio":{name:"Studio",geometry:["point","area"],terms:["recording studio","studio","radio","radio studio","television","television studio"],tags:{amenity:"studio"},icon:"music",fields:["building_area","studio_type","address"]},"amenity/swimming_pool":{geometry:["point","vertex","area"],tags:{amenity:"swimming_pool"},icon:"swimming",searchable:false,name:"Swimming Pool"},"amenity/taxi":{fields:["operator","capacity"],geometry:["point","vertex","area"],terms:["cab"],tags:{amenity:"taxi"},name:"Taxi Stand"},"amenity/telephone":{icon:"telephone",geometry:["point","vertex"],tags:{amenity:"telephone"},terms:["phone"],name:"Telephone"},"amenity/theatre":{icon:"theatre",fields:["operator","building_area","address"],geometry:["point","vertex","area"],terms:["theatre","performance","play","musical"],tags:{amenity:"theatre"},name:"Theater"},"amenity/toilets":{fields:["toilets/disposal","operator","building_area","access_toilets"],geometry:["point","vertex","area"],terms:["bathroom","restroom","outhouse","privy","head","lavatory","latrine","water closet","WC","W.C."],tags:{amenity:"toilets"},icon:"toilets",name:"Toilets"},"amenity/townhall":{icon:"town-hall",fields:["building_area","address"],geometry:["point","vertex","area"],terms:["village hall","city government","courthouse","municipal building","municipal center","municipal centre"],tags:{amenity:"townhall"},name:"Town Hall"},"amenity/university":{icon:"college",fields:["operator","address"],geometry:["point","vertex","area"],tags:{amenity:"university"},terms:["college"],name:"University"},"amenity/vending_machine":{fields:["vending","operator"],geometry:["point"],tags:{amenity:"vending_machine"},name:"Vending Machine"},"amenity/veterinary":{fields:[],geometry:["point","area"],terms:["pet clinic","veterinarian","animal hospital","pet doctor"],tags:{amenity:"veterinary"},name:"Veterinary"},"amenity/waste_basket":{icon:"waste-basket",geometry:["point","vertex"],tags:{amenity:"waste_basket"},terms:["rubbish bin","litter bin","trash can","garbage can"],name:"Waste Basket"},area:{name:"Area",tags:{area:"yes"},geometry:["area"],matchScore:0.1},barrier:{geometry:["point","vertex","line","area"],tags:{barrier:"*"},fields:["barrier"],name:"Barrier"},"barrier/block":{fields:["access"],geometry:["point","vertex"],tags:{barrier:"block"},name:"Block"},"barrier/bollard":{fields:["access"],geometry:["point","vertex","line"],tags:{barrier:"bollard"},name:"Bollard"},"barrier/cattle_grid":{geometry:["vertex"],tags:{barrier:"cattle_grid"},name:"Cattle Grid"},"barrier/city_wall":{geometry:["line","area"],tags:{barrier:"city_wall"},name:"City Wall"},"barrier/cycle_barrier":{fields:["access"],geometry:["vertex"],tags:{barrier:"cycle_barrier"},name:"Cycle Barrier"},"barrier/ditch":{geometry:["line","area"],tags:{barrier:"ditch"},name:"Ditch"},"barrier/entrance":{icon:"entrance",geometry:["vertex"],tags:{barrier:"entrance"},name:"Entrance",searchable:false},"barrier/fence":{geometry:["line"],tags:{barrier:"fence"},name:"Fence"},"barrier/gate":{fields:["access"],geometry:["point","vertex","line"],tags:{barrier:"gate"},name:"Gate"},"barrier/hedge":{geometry:["line","area"],tags:{barrier:"hedge"},name:"Hedge"},"barrier/kissing_gate":{fields:["access"],geometry:["vertex"],tags:{barrier:"kissing_gate"},name:"Kissing Gate"},"barrier/lift_gate":{fields:["access"],geometry:["point","vertex"],tags:{barrier:"lift_gate"},name:"Lift Gate"},"barrier/retaining_wall":{geometry:["line","area"],tags:{barrier:"retaining_wall"},name:"Retaining Wall"},"barrier/stile":{fields:["access"],geometry:["point","vertex"],tags:{barrier:"stile"},name:"Stile"},"barrier/toll_booth":{fields:["access"],geometry:["vertex"],tags:{barrier:"toll_booth"},name:"Toll Booth"},"barrier/wall":{geometry:["line","area"],tags:{barrier:"wall"},name:"Wall"},"boundary/administrative":{name:"Administrative Boundary",geometry:["line"],tags:{boundary:"administrative"},fields:["admin_level"]},building:{icon:"building",fields:["building","levels","address"],geometry:["area"],tags:{building:"*"},terms:[],name:"Building"},"building/apartments":{icon:"commercial",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"apartments"},name:"Apartments"},"building/barn":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"barn"},name:"Barn"},"building/bunker":{fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"bunker"},name:"Bunker",searchable:false},"building/cabin":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"cabin"},name:"Cabin"},"building/cathedral":{icon:"place-of-worship",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"cathedral"},name:"Cathedral"},"building/chapel":{icon:"place-of-worship",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"chapel"},name:"Chapel"},"building/church":{icon:"place-of-worship",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"church"},name:"Church"},"building/commercial":{icon:"commercial",fields:["address","smoking"],geometry:["point","vertex","area"],tags:{building:"commercial"},name:"Commercial Building"},"building/construction":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"construction"},name:"Building Under Construction"},"building/detached":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"detached"},name:"Detached Home"},"building/dormitory":{icon:"building",fields:["address","levels","smoking"],geometry:["point","vertex","area"],tags:{building:"dormitory"},name:"Dormitory"},"building/entrance":{icon:"entrance",geometry:["vertex"],tags:{building:"entrance"},name:"Entrance/Exit",searchable:false},"building/garage":{fields:["capacity"],geometry:["point","vertex","area"],tags:{building:"garage"},name:"Garage",icon:"warehouse"},"building/garages":{icon:"warehouse",fields:["capacity"],geometry:["point","vertex","area"],tags:{building:"garages"},name:"Garages"},"building/greenhouse":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"greenhouse"},name:"Greenhouse"},"building/hospital":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"hospital"},name:"Hospital Building"},"building/hotel":{icon:"building",fields:["address","levels","smoking"],geometry:["point","vertex","area"],tags:{building:"hotel"},name:"Hotel Building"},"building/house":{icon:"building",fields:["address","levels"],geometry:["point","area"],tags:{building:"house"},name:"House"},"building/hut":{geometry:["point","vertex","area"],tags:{building:"hut"},name:"Hut"},"building/industrial":{icon:"industrial",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"industrial"},name:"Industrial Building"},"building/public":{icon:"building",fields:["address","levels","smoking"],geometry:["point","vertex","area"],tags:{building:"public"},name:"Public Building"},"building/residential":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"residential"},name:"Residential Building"},"building/retail":{icon:"building",fields:["address","levels","smoking"],geometry:["point","vertex","area"],tags:{building:"retail"},name:"Retail Building"},"building/roof":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"roof"},name:"Roof"},"building/school":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"school"},name:"School Building"},"building/shed":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"shed"},name:"Shed"},"building/stable":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"stable"},name:"Stable"},"building/static_caravan":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"static_caravan"},name:"Static Mobile Home"},"building/terrace":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"terrace"},name:"Row Houses"},"building/train_station":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"train_station"},name:"Train Station",searchable:false},"building/university":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"university"},name:"University Building"},"building/warehouse":{icon:"building",fields:["address","levels"],geometry:["point","vertex","area"],tags:{building:"warehouse"},name:"Warehouse"},"craft/basket_maker":{name:"Basket Maker",geometry:["point","area"],terms:["basket","basketry","basket maker","basket weaver"],tags:{craft:"basket_maker"},icon:"art-gallery",fields:["building_area","address","operator","opening_hours"]},"craft/beekeeper":{name:"Beekeeper",geometry:["point","area"],terms:["bees","beekeeper","bee box"],tags:{craft:"beekeeper"},icon:"farm",fields:["building_area","address","operator","opening_hours"]},"craft/blacksmith":{name:"Blacksmith",geometry:["point","area"],terms:["blacksmith"],tags:{craft:"blacksmith"},icon:"farm",fields:["building_area","address","operator","opening_hours"]},"craft/boatbuilder":{name:"Boat Builder",geometry:["point","area"],terms:["boat builder"],tags:{craft:"boatbuilder"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/bookbinder":{name:"Bookbinder",geometry:["point","area"],terms:["bookbinder","book repair"],tags:{craft:"bookbinder"},icon:"library",fields:["building_area","address","operator","opening_hours"]},"craft/brewery":{name:"Brewery",geometry:["point","area"],terms:["brewery"],tags:{craft:"brewery"},icon:"beer",fields:["building_area","address","operator","opening_hours"]},"craft/carpenter":{name:"Carpenter",geometry:["point","area"],terms:["carpenter","woodworker"],tags:{craft:"carpenter"},icon:"logging",fields:["building_area","address","operator","opening_hours"]},"craft/carpet_layer":{name:"Carpet Layer",geometry:["point","area"],terms:["carpet layer"],tags:{craft:"carpet_layer"},icon:"square",fields:["building_area","address","operator","opening_hours"]},"craft/caterer":{name:"Caterer",geometry:["point","area"],terms:["Caterer","Catering"],tags:{craft:"caterer"},icon:"bakery",fields:["cuisine","building_area","address","operator","opening_hours"]},"craft/clockmaker":{name:"Clockmaker",geometry:["point","area"],terms:["clock","clockmaker","clock repair"],tags:{craft:"clockmaker"},icon:"circle-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/confectionary":{name:"Confectionary",geometry:["point","area"],terms:["confectionary","sweets","candy"],tags:{craft:"confectionary"},icon:"bakery",fields:["building_area","address","operator","opening_hours"]},"craft/dressmaker":{name:"Dressmaker",geometry:["point","area"],terms:["dress","dressmaker"],tags:{craft:"dressmaker"},icon:"clothing-store",fields:["building_area","address","operator","opening_hours"]},"craft/electrician":{name:"Electrician",geometry:["point","area"],terms:["electrician"],tags:{craft:"electrician"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/gardener":{name:"Gardener",geometry:["point","area"],terms:["gardener","landscaper","grounds keeper"],tags:{craft:"gardener"},icon:"garden",fields:["building_area","address","operator","opening_hours"]},"craft/glaziery":{name:"Glaziery",geometry:["point","area"],terms:["glass","glass foundry","stained-glass","window"],tags:{craft:"glaziery"},icon:"fire-station",fields:["building_area","address","operator","opening_hours"]},"craft/handicraft":{name:"Handicraft",geometry:["point","area"],terms:["handicraft"],tags:{craft:"handicraft"},icon:"art-gallery",fields:["building_area","address","operator","opening_hours"]},"craft/hvac":{name:"HVAC",geometry:["point","area"],terms:["heating","ventilating","air-conditioning","air conditioning"],tags:{craft:"hvac"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/insulator":{name:"Insulator",geometry:["point","area"],terms:["insulation","insulator"],tags:{craft:"insulation"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/jeweler":{name:"Jeweler",geometry:["point","area"],terms:["jeweler","gem","diamond"],tags:{craft:"jeweler"},icon:"marker-stroked",searchable:false,fields:["building_area","address","operator","opening_hours"]},"craft/key_cutter":{name:"Key Cutter",geometry:["point","area"],terms:["key","key cutter"],tags:{craft:"key_cutter"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/locksmith":{name:"Locksmith",geometry:["point","area"],terms:["locksmith","lock"],tags:{craft:"locksmith"},icon:"marker-stroked",searchable:false,fields:["building_area","address","operator","opening_hours"]},"craft/metal_construction":{name:"Metal Construction",geometry:["point","area"],terms:["metal construction"],tags:{craft:"metal_construction"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/optician":{name:"Optician",geometry:["point","area"],terms:["glasses","optician"],tags:{craft:"optician"},icon:"marker-stroked",searchable:false,fields:["building_area","address","operator","opening_hours"]},"craft/painter":{name:"Painter",geometry:["point","area"],terms:["painter"],tags:{craft:"painter"},icon:"art-gallery",fields:["building_area","address","operator","opening_hours"]},"craft/photographer":{name:"Photographer",geometry:["point","area"],terms:["photographer"],tags:{craft:"photographer"},icon:"camera",fields:["building_area","address","operator","opening_hours"]},"craft/photographic_laboratory":{name:"Photographic Laboratory",geometry:["point","area"],terms:["photographic laboratory","film developer"],tags:{craft:"photographic_laboratory"},icon:"camera",fields:["building_area","address","operator","opening_hours"]},"craft/plasterer":{name:"Plasterer",geometry:["point","area"],terms:["plasterer"],tags:{craft:"plasterer"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/plumber":{name:"Plumber",geometry:["point","area"],terms:["pumber"],tags:{craft:"plumber"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/pottery":{name:"Pottery",geometry:["point","area"],terms:["pottery","potter"],tags:{craft:"pottery"},icon:"art-gallery",fields:["building_area","address","operator","opening_hours"]},"craft/rigger":{name:"Rigger",geometry:["point","area"],terms:["rigger"],tags:{craft:"rigger"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/roofer":{name:"Roofer",geometry:["point","area"],terms:["roofer"],tags:{craft:"roofer"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/saddler":{name:"Saddler",geometry:["point","area"],terms:["saddler"],tags:{craft:"saddler"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/sailmaker":{name:"Sailmaker",geometry:["point","area"],terms:["sailmaker"],tags:{craft:"sailmaker"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/sawmill":{name:"Sawmill",geometry:["point","area"],terms:["sawmill","lumber"],tags:{craft:"sawmill"},icon:"park",fields:["building_area","address","operator","opening_hours"]},"craft/scaffolder":{name:"Scaffolder",geometry:["point","area"],terms:["scaffolder"],tags:{craft:"scaffolder"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/sculpter":{name:"Sculpter",geometry:["point","area"],terms:["sculpter"],tags:{craft:"sculpter"},icon:"art-gallery",fields:["building_area","address","operator","opening_hours"]},"craft/shoemaker":{name:"Shoemaker",geometry:["point","area"],terms:["shoe repair","shoemaker"],tags:{craft:"shoemaker"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/stonemason":{name:"Stonemason",geometry:["point","area"],terms:["stonemason","masonry"],tags:{craft:"stonemason"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/sweep":{name:"Chimney Sweep",geometry:["point","area"],terms:["sweep","chimney sweep"],tags:{craft:"sweep"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/tailor":{name:"Tailor",geometry:["point","area"],terms:["tailor","clothes"],tags:{craft:"tailor"},icon:"clothing-store",fields:["building_area","address","operator","opening_hours"],searchable:false},"craft/tiler":{name:"Tiler",geometry:["point","area"],terms:["tiler"],tags:{craft:"tiler"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/tinsmith":{name:"Tinsmith",geometry:["point","area"],terms:["tinsmith"],tags:{craft:"tinsmith"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/upholsterer":{name:"Upholsterer",geometry:["point","area"],terms:["upholsterer"],tags:{craft:"upholsterer"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/watchmaker":{name:"Watchmaker",geometry:["point","area"],terms:["watch","watchmaker","watch repair"],tags:{craft:"watchmaker"},icon:"circle-stroked",fields:["building_area","address","operator","opening_hours"]},"craft/window_construction":{name:"Window Construction",geometry:["point","area"],terms:["window","window maker","window construction"],tags:{craft:"window_construction"},icon:"marker-stroked",fields:["building_area","address","operator","opening_hours"]},embankment:{geometry:["line"],tags:{embankment:"yes"},name:"Embankment",matchScore:0.2},"emergency/ambulance_station":{fields:["operator"],geometry:["area","point","vertex"],tags:{emergency:"ambulance_station"},name:"Ambulance Station"},"emergency/fire_hydrant":{fields:["fire_hydrant/type"],geometry:["point","vertex"],tags:{emergency:"fire_hydrant"},name:"Fire Hydrant"},"emergency/phone":{icon:"emergency-telephone",fields:["operator"],geometry:["point","vertex"],tags:{emergency:"phone"},name:"Emergency Phone"},entrance:{icon:"entrance",geometry:["vertex"],tags:{entrance:"*"},fields:["entrance","access_simple","address"],name:"Entrance/Exit"},"footway/crossing":{fields:["crossing","access","surface","sloped_curb","tactile_paving"],geometry:["line"],tags:{highway:"footway",footway:"crossing"},terms:[],name:"Crossing"},"footway/crosswalk":{fields:["crossing","access","surface","sloped_curb","tactile_paving"],geometry:["line"],tags:{highway:"footway",footway:"crossing",crossing:"zebra"},terms:["crosswalk","zebra crossing"],name:"Crosswalk"},"footway/sidewalk":{fields:["surface","lit","width","structure","access"],geometry:["line"],tags:{highway:"footway",footway:"sidewalk"},terms:[],name:"Sidewalk"},ford:{geometry:["vertex"],tags:{ford:"yes"},name:"Ford"},"golf/bunker":{icon:"golf",geometry:["area"],tags:{golf:"bunker",natural:"sand"},terms:["hazard","bunker"],name:"Sand Trap"},"golf/fairway":{icon:"golf",geometry:["area"],tags:{golf:"fairway",landuse:"grass"},name:"Fairway"},"golf/green":{icon:"golf",geometry:["area"],tags:{golf:"green",landuse:"grass",leisure:"pitch",sport:"golf"},terms:["putting green"],name:"Putting Green"},"golf/hole":{icon:"golf",fields:["golf_hole","par","handicap"],geometry:["line"],tags:{golf:"hole"},name:"Golf Hole"},"golf/lateral_water_hazard":{icon:"golf",geometry:["line","area"],tags:{golf:"lateral_water_hazard",natural:"water"},name:"Lateral Water Hazard"},"golf/rough":{icon:"golf",geometry:["area"],tags:{golf:"rough",landuse:"grass"},name:"Rough"},"golf/tee":{icon:"golf",geometry:["area"],tags:{golf:"tee",landuse:"grass"},terms:["teeing ground"],name:"Tee Box"},"golf/water_hazard":{icon:"golf",geometry:["line","area"],tags:{golf:"water_hazard",natural:"water"},name:"Water Hazard"},highway:{fields:["highway"],geometry:["point","vertex","line","area"],tags:{highway:"*"},name:"Highway"},"highway/bridleway":{fields:["surface","width","structure","access"],icon:"highway-bridleway",geometry:["line"],tags:{highway:"bridleway"},terms:["bridleway","equestrian trail","horse riding path","bridle road","horse trail"],name:"Bridle Path"},"highway/bus_stop":{icon:"bus",fields:["operator","shelter"],geometry:["point","vertex"],tags:{highway:"bus_stop"},terms:[],name:"Bus Stop"},"highway/crossing":{fields:["crossing","sloped_curb","tactile_paving"],geometry:["vertex"],tags:{highway:"crossing"},terms:[],name:"Crossing"},"highway/crosswalk":{fields:["crossing","sloped_curb","tactile_paving"],geometry:["vertex"],tags:{highway:"crossing",crossing:"zebra"},terms:["crosswalk","zebra crossing"],name:"Crosswalk"},"highway/cycleway":{icon:"highway-cycleway",fields:["surface","lit","width","oneway","structure","access"],geometry:["line"],tags:{highway:"cycleway"},terms:[],name:"Cycle Path"},"highway/footway":{icon:"highway-footway",fields:["surface","lit","width","structure","access"],geometry:["line","area"],terms:["beaten path","boulevard","clearing","course","cut*","drag*","footpath","highway","lane","line","orbit","passage","pathway","rail","rails","road","roadway","route","street","thoroughfare","trackway","trail","trajectory","walk"],tags:{highway:"footway"},name:"Foot Path"},"highway/living_street":{icon:"highway-living-street",fields:["oneway","maxspeed","structure","access","surface"],geometry:["line"],tags:{highway:"living_street"},name:"Living Street"},"highway/mini_roundabout":{geometry:["vertex"],tags:{highway:"mini_roundabout"},fields:["clock_direction"],name:"Mini-Roundabout"},"highway/motorway":{icon:"highway-motorway",fields:["oneway_yes","maxspeed","structure","access","lanes","surface","ref"],geometry:["line"],tags:{highway:"motorway"},terms:[],name:"Motorway"},"highway/motorway_junction":{geometry:["vertex"],tags:{highway:"motorway_junction"},fields:["ref"],name:"Motorway Junction / Exit"},"highway/motorway_link":{icon:"highway-motorway-link",fields:["oneway_yes","maxspeed","structure","access","surface","ref"],geometry:["line"],tags:{highway:"motorway_link"},terms:["ramp","on ramp","off ramp"],name:"Motorway Link"},"highway/path":{icon:"highway-path",fields:["surface","width","structure","access","incline","sac_scale","trail_visibility","mtb/scale","mtb/scale/uphill","mtb/scale/imba","ref"],geometry:["line"],tags:{highway:"path"},terms:[],name:"Path"},"highway/pedestrian":{fields:["surface","lit","width","oneway","structure","access"],geometry:["line","area"],tags:{highway:"pedestrian"},terms:[],name:"Pedestrian"},"highway/primary":{icon:"highway-primary",fields:["oneway","maxspeed","structure","access","lanes","surface","ref"],geometry:["line"],tags:{highway:"primary"},terms:[],name:"Primary Road"},"highway/primary_link":{icon:"highway-primary-link",fields:["oneway","maxspeed","structure","access","surface","ref"],geometry:["line"],tags:{highway:"primary_link"},terms:["ramp","on ramp","off ramp"],name:"Primary Link"},"highway/residential":{icon:"highway-residential",fields:["oneway","maxspeed","structure","access","surface"],geometry:["line"],tags:{highway:"residential"},terms:[],name:"Residential Road"},"highway/rest_area":{geometry:["point","vertex","area"],tags:{highway:"rest_area"},terms:["rest stop","turnout","lay-by"],name:"Rest Area"},"highway/road":{icon:"highway-road",fields:["oneway","maxspeed","structure","access","surface"],geometry:["line"],tags:{highway:"road"},terms:[],name:"Unknown Road"},"highway/secondary":{icon:"highway-secondary",fields:["oneway","maxspeed","structure","access","lanes","surface","ref"],geometry:["line"],tags:{highway:"secondary"},terms:[],name:"Secondary Road"},"highway/secondary_link":{icon:"highway-secondary-link",fields:["oneway","maxspeed","structure","access","surface","ref"],geometry:["line"],tags:{highway:"secondary_link"},terms:["ramp","on ramp","off ramp"],name:"Secondary Link"},"highway/service":{icon:"highway-service",fields:["service","oneway","maxspeed","structure","access","surface"],geometry:["line"],tags:{highway:"service"},terms:[],name:"Service Road"},"highway/service/alley":{icon:"highway-service",fields:["oneway","access","surface"],geometry:["line"],tags:{highway:"service",service:"alley"},name:"Alley"},"highway/service/drive-through":{icon:"highway-service",fields:["oneway","access","surface"],geometry:["line"],tags:{highway:"service",service:"drive-through"},name:"Drive-Through"},"highway/service/driveway":{icon:"highway-service",fields:["oneway","access","surface"],geometry:["line"],tags:{highway:"service",service:"driveway"},name:"Driveway"},"highway/service/emergency_access":{icon:"highway-service",fields:["oneway","access","surface"],geometry:["line"],tags:{highway:"service",service:"emergency_access"},name:"Emergency Access"},"highway/service/parking_aisle":{icon:"highway-service",fields:["oneway","access","surface"],geometry:["line"],tags:{highway:"service",service:"parking_aisle"},name:"Parking Aisle"},"highway/services":{geometry:["point","vertex","area"],tags:{highway:"services"},terms:["services","travel plaza","service station"],name:"Service Area"},"highway/steps":{fields:["surface","lit","width","access"],icon:"highway-steps",geometry:["line"],tags:{highway:"steps"},terms:["stairs","staircase"],name:"Steps"},"highway/stop":{geometry:["vertex"],tags:{highway:"stop"},terms:["stop sign"],name:"Stop Sign"},"highway/street_lamp":{geometry:["point","vertex"],tags:{highway:"street_lamp"},fields:["lamp_type","ref"],terms:["streetlight","street light","lamp","light","gaslight"],name:"Street Lamp"},"highway/tertiary":{icon:"highway-tertiary",fields:["oneway","maxspeed","structure","access","lanes","surface","ref"],geometry:["line"],tags:{highway:"tertiary"},terms:[],name:"Tertiary Road"},"highway/tertiary_link":{icon:"highway-tertiary-link",fields:["oneway","maxspeed","structure","access","surface","ref"],geometry:["line"],tags:{highway:"tertiary_link"},terms:["ramp","on ramp","off ramp"],name:"Tertiary Link"},"highway/track":{icon:"highway-track",fields:["surface","width","structure","access","incline","tracktype","smoothness","mtb/scale","mtb/scale/uphill","mtb/scale/imba"],geometry:["line"],tags:{highway:"track"},terms:[],name:"Track"},"highway/traffic_signals":{geometry:["vertex"],tags:{highway:"traffic_signals"},terms:["light","stoplight","traffic light"],name:"Traffic Signals"},"highway/trunk":{icon:"highway-trunk",fields:["oneway","maxspeed","structure","access","lanes","surface","ref"],geometry:["line"],tags:{highway:"trunk"},terms:[],name:"Trunk Road"},"highway/trunk_link":{icon:"highway-trunk-link",fields:["oneway","maxspeed","structure","access","surface","ref"],geometry:["line"],tags:{highway:"trunk_link"},terms:["ramp","on ramp","off ramp"],name:"Trunk Link"},"highway/turning_circle":{icon:"circle",geometry:["vertex"],tags:{highway:"turning_circle"},terms:[],name:"Turning Circle"},"highway/unclassified":{icon:"highway-unclassified",fields:["oneway","maxspeed","structure","access","surface"],geometry:["line"],tags:{highway:"unclassified"},terms:[],name:"Unclassified Road"},historic:{fields:["historic"],geometry:["point","vertex","area"],tags:{historic:"*"},name:"Historic Site"},"historic/archaeological_site":{geometry:["point","vertex","area"],tags:{historic:"archaeological_site"},name:"Archaeological Site"},"historic/boundary_stone":{geometry:["point","vertex"],tags:{historic:"boundary_stone"},name:"Boundary Stone"},"historic/castle":{geometry:["point","vertex","area"],tags:{historic:"castle"},name:"Castle"},"historic/memorial":{icon:"monument",geometry:["point","vertex","area"],tags:{historic:"memorial"},name:"Memorial"},"historic/monument":{icon:"monument",geometry:["point","vertex","area"],tags:{historic:"monument"},name:"Monument"},"historic/ruins":{geometry:["point","vertex","area"],tags:{historic:"ruins"},name:"Ruins"},"historic/wayside_cross":{geometry:["point","vertex","area"],tags:{historic:"wayside_cross"},name:"Wayside Cross"},"historic/wayside_shrine":{geometry:["point","vertex","area"],tags:{historic:"wayside_shrine"},name:"Wayside Shrine"},landuse:{fields:["landuse"],geometry:["point","vertex","area"],tags:{landuse:"*"},name:"Landuse"},"landuse/allotments":{geometry:["point","area"],tags:{landuse:"allotments"},terms:[],name:"Allotments"},"landuse/basin":{geometry:["point","area"],tags:{landuse:"basin"},terms:[],name:"Basin"},"landuse/cemetery":{icon:"cemetery",fields:["religion","denomination"],geometry:["point","vertex","area"],tags:{landuse:"cemetery"},terms:[],name:"Cemetery"},"landuse/churchyard":{fields:["religion","denomination"],geometry:["area"],tags:{landuse:"churchyard"},terms:[],name:"Churchyard"},"landuse/commercial":{icon:"commercial",geometry:["point","area"],tags:{landuse:"commercial"},terms:[],name:"Commercial"},"landuse/construction":{fields:["construction","operator"],geometry:["point","area"],tags:{landuse:"construction"},terms:[],name:"Construction"},"landuse/farm":{fields:["crop"],geometry:["point","area"],tags:{landuse:"farm"},terms:[],name:"Farm",icon:"farm"},"landuse/farmland":{fields:["crop"],geometry:["point","area"],tags:{landuse:"farmland"},terms:[],name:"Farmland",icon:"farm",searchable:false},"landuse/farmyard":{fields:["crop"],geometry:["point","area"],tags:{landuse:"farmyard"},terms:[],name:"Farmyard",icon:"farm"},"landuse/forest":{fields:["wood"],icon:"park2",geometry:["point","area"],tags:{landuse:"forest"},terms:[],name:"Forest"},"landuse/grass":{geometry:["point","area"],tags:{landuse:"grass"},terms:[],name:"Grass"},"landuse/industrial":{icon:"industrial",geometry:["point","area"],tags:{landuse:"industrial"},terms:[],name:"Industrial"},"landuse/landfill":{geometry:["area"],tags:{landuse:"landfill"},terms:["dump"],name:"Landfill"},"landuse/meadow":{geometry:["point","area"],tags:{landuse:"meadow"},terms:[],name:"Meadow"},"landuse/military":{geometry:["area"],tags:{landuse:"military"},terms:[],name:"Military"},"landuse/orchard":{fields:["trees"],geometry:["point","area"],tags:{landuse:"orchard"},terms:[],name:"Orchard",icon:"park2"},"landuse/quarry":{geometry:["point","area"],tags:{landuse:"quarry"},terms:[],name:"Quarry"},"landuse/residential":{icon:"building",geometry:["point","area"],tags:{landuse:"residential"},terms:[],name:"Residential"},"landuse/retail":{icon:"shop",geometry:["point","area"],tags:{landuse:"retail"},name:"Retail"},"landuse/vineyard":{geometry:["point","area"],tags:{landuse:"vineyard"},terms:[],name:"Vineyard"},leisure:{fields:["leisure"],geometry:["point","vertex","area"],tags:{leisure:"*"},name:"Leisure"},"leisure/common":{geometry:["point","area"],terms:["open space"],tags:{leisure:"common"},name:"Common"},"leisure/dog_park":{geometry:["point","area"],terms:[],tags:{leisure:"dog_park"},name:"Dog Park",icon:"dog-park"},"leisure/firepit":{geometry:["point","area"],tags:{leisure:"firepit"},terms:["fireplace","campfire"],name:"Firepit"},"leisure/garden":{icon:"garden",geometry:["point","vertex","area"],tags:{leisure:"garden"},name:"Garden"},"leisure/golf_course":{icon:"golf",fields:["operator","address"],geometry:["point","area"],tags:{leisure:"golf_course"},terms:["links"],name:"Golf Course"},"leisure/ice_rink":{icon:"pitch",fields:["building_area","seasonal","sport_ice"],geometry:["point","area"],terms:["hockey","skating","curling"],tags:{leisure:"ice_rink"},name:"Ice Rink"},"leisure/marina":{icon:"harbor",geometry:["point","vertex","area"],tags:{leisure:"marina"},name:"Marina"},"leisure/park":{icon:"park",geometry:["point","area"],terms:["esplanade","estate","forest","garden","grass","green","grounds","lawn","lot","meadow","parkland","place","playground","plaza","pleasure garden","recreation area","square","tract","village green","woodland"],tags:{leisure:"park"},name:"Park"},"leisure/picnic_table":{geometry:["point"],tags:{leisure:"picnic_table"},terms:["bench","table"],name:"Picnic Table"},"leisure/pitch":{icon:"pitch",fields:["sport","surface","lit"],geometry:["point","area"],tags:{leisure:"pitch"},terms:[],name:"Sport Pitch"},"leisure/pitch/american_football":{icon:"america-football",fields:["surface","lit"],geometry:["point","area"],tags:{leisure:"pitch",sport:"american_football"},terms:[],name:"American Football Field"},"leisure/pitch/baseball":{icon:"baseball",fields:["lit"],geometry:["point","area"],tags:{leisure:"pitch",sport:"baseball"},terms:[],name:"Baseball Diamond"},"leisure/pitch/basketball":{icon:"basketball",fields:["surface","hoops","lit"],geometry:["point","area"],tags:{leisure:"pitch",sport:"basketball"},terms:[],name:"Basketball Court"},"leisure/pitch/skateboard":{icon:"pitch",fields:["surface","lit"],geometry:["point","area"],tags:{leisure:"pitch",sport:"skateboard"},terms:[],name:"Skate Park"},"leisure/pitch/soccer":{icon:"soccer",fields:["surface","lit"],geometry:["point","area"],tags:{leisure:"pitch",sport:"soccer"},terms:[],name:"Soccer Field"},"leisure/pitch/tennis":{icon:"tennis",fields:["surface","lit"],geometry:["point","area"],tags:{leisure:"pitch",sport:"tennis"},terms:[],name:"Tennis Court"},"leisure/pitch/volleyball":{icon:"pitch",fields:["surface","lit"],geometry:["point","area"],tags:{leisure:"pitch",sport:"volleyball"},terms:[],name:"Volleyball Court"},"leisure/playground":{icon:"playground",geometry:["point","area"],tags:{leisure:"playground"},name:"Playground",terms:["jungle gym","play area"]},"leisure/slipway":{geometry:["point","line"],tags:{leisure:"slipway"},name:"Slipway"},"leisure/sports_center":{icon:"pitch",geometry:["point","area"],tags:{leisure:"sports_centre"},terms:["gym"],fields:["sport"],name:"Sports Center / Gym"},"leisure/stadium":{icon:"pitch",geometry:["point","area"],tags:{leisure:"stadium"},fields:["sport"],name:"Stadium"},"leisure/swimming_pool":{fields:["access_simple"],geometry:["point","vertex","area"],tags:{leisure:"swimming_pool"},icon:"swimming",name:"Swimming Pool"},"leisure/track":{icon:"pitch",fields:["surface","lit","width"],geometry:["point","line","area"],tags:{leisure:"track"},name:"Race Track"},line:{name:"Line",tags:{},geometry:["line"],matchScore:0.1},man_made:{fields:["man_made"],geometry:["point","vertex","line","area"],tags:{man_made:"*"},name:"Man Made"},"man_made/breakwater":{geometry:["line","area"],tags:{man_made:"breakwater"},name:"Breakwater"},"man_made/cutline":{geometry:["line"],tags:{man_made:"cutline"},name:"Cut line"},"man_made/embankment":{geometry:["line"],tags:{man_made:"embankment"},name:"Embankment",searchable:false},"man_made/flagpole":{geometry:["point"],tags:{man_made:"flagpole"},name:"Flagpole",icon:"embassy"},"man_made/lighthouse":{geometry:["point","area"],tags:{man_made:"lighthouse"},name:"Lighthouse",icon:"lighthouse"},"man_made/observation":{geometry:["point","area"],terms:["lookout tower","fire tower"],tags:{man_made:"tower","tower:type":"observation"},name:"Observation Tower"},"man_made/pier":{geometry:["line","area"],tags:{man_made:"pier"},name:"Pier"},"man_made/pipeline":{geometry:["line"],tags:{man_made:"pipeline"},fields:["location","operator"],name:"Pipeline",icon:"pipeline"},"man_made/survey_point":{icon:"monument",geometry:["point","vertex"],tags:{man_made:"survey_point"},fields:["ref"],name:"Survey Point"},"man_made/tower":{geometry:["point","area"],tags:{man_made:"tower"},fields:["towertype"],name:"Tower"},"man_made/wastewater_plant":{icon:"water",geometry:["point","area"],tags:{man_made:"wastewater_plant"},name:"Wastewater Plant",terms:["sewage works","sewage treatment plant","water treatment plant","reclamation plant"]},"man_made/water_tower":{icon:"water",geometry:["point","area"],tags:{man_made:"water_tower"},name:"Water Tower"},"man_made/water_well":{geometry:["point","area"],tags:{man_made:"water_well"},name:"Water well"},"man_made/water_works":{icon:"water",geometry:["point","area"],tags:{man_made:"water_works"},name:"Water Works"},"military/airfield":{geometry:["point","vertex","area"],tags:{military:"airfield"},terms:[],name:"Airfield",icon:"airfield"},"military/barracks":{geometry:["point","vertex","area"],tags:{military:"barracks"},terms:[],name:"Barracks"},"military/bunker":{geometry:["point","vertex","area"],tags:{military:"bunker"},terms:[],name:"Bunker"},"military/range":{geometry:["point","vertex","area"],tags:{military:"range"},terms:[],name:"Military Range"},natural:{fields:["natural"],geometry:["point","vertex","area"],tags:{natural:"*"},name:"Natural"},"natural/bay":{geometry:["point","area"],terms:[],tags:{natural:"bay"},name:"Bay"},"natural/beach":{fields:["surface"],geometry:["point","area"],terms:[],tags:{natural:"beach"},name:"Beach"},"natural/cliff":{geometry:["point","vertex","line","area"],terms:[],tags:{natural:"cliff"},name:"Cliff"},"natural/coastline":{geometry:["line"],terms:["shore"],tags:{natural:"coastline"},name:"Coastline"},"natural/fell":{geometry:["area"],terms:[],tags:{natural:"fell"},name:"Fell"},"natural/glacier":{geometry:["area"],terms:[],tags:{natural:"glacier"},name:"Glacier"},"natural/grassland":{geometry:["point","area"],terms:[],tags:{natural:"grassland"},name:"Grassland"},"natural/heath":{geometry:["area"],terms:[],tags:{natural:"heath"},name:"Heath"},"natural/peak":{icon:"triangle",fields:["elevation"],geometry:["point","vertex"],tags:{natural:"peak"},terms:["acme","aiguille","alp","climax","crest","crown","hill","mount","mountain","pinnacle","summit","tip","top"],name:"Peak"},"natural/scree":{geometry:["area"],tags:{natural:"scree"},terms:["loose rocks"],name:"Scree"},"natural/scrub":{geometry:["area"],tags:{natural:"scrub"},terms:[],name:"Scrub"},"natural/spring":{geometry:["point","vertex"],terms:[],tags:{natural:"spring"},name:"Spring"},"natural/tree":{fields:["tree_type","denotation"],icon:"park",geometry:["point","vertex"],terms:[],tags:{natural:"tree"},name:"Tree"},"natural/water":{fields:["water"],geometry:["area"],tags:{natural:"water"},icon:"water",name:"Water"},"natural/water/lake":{geometry:["area"],tags:{natural:"water",water:"lake"},terms:["lakelet","loch","mere"],icon:"water",name:"Lake"},"natural/water/pond":{geometry:["area"],tags:{natural:"water",water:"pond"},terms:["lakelet","millpond","tarn","pool","mere"],icon:"water",name:"Pond"},"natural/water/reservoir":{geometry:["area"],tags:{natural:"water",water:"reservoir"},icon:"water",name:"Reservoir"},"natural/wetland":{icon:"wetland",fields:["wetland"],geometry:["point","area"],tags:{natural:"wetland"},terms:[],name:"Wetland"},"natural/wood":{fields:["wood"],icon:"park2",geometry:["point","area"],tags:{natural:"wood"},terms:[],name:"Wood"},office:{icon:"commercial",fields:["office","address","opening_hours","smoking"],geometry:["point","vertex","area"],tags:{office:"*"},terms:[],name:"Office"},"office/accountant":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"accountant"},terms:[],name:"Accountant"},"office/administrative":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"administrative"},terms:[],name:"Administrative Office"},"office/architect":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"architect"},terms:[],name:"Architect"},"office/company":{icon:"commercial",fields:["address","opening_hours","smoking"],geometry:["point","vertex","area"],tags:{office:"company"},terms:[],name:"Company Office"},"office/educational_institution":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"educational_institution"},terms:[],name:"Educational Institution"},"office/employment_agency":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"employment_agency"},terms:[],name:"Employment Agency"},"office/estate_agent":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"estate_agent"},terms:[],name:"Real Estate Office"},"office/financial":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"financial"},terms:[],name:"Financial Office"},"office/government":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"government"},terms:[],name:"Government Office"},"office/insurance":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"insurance"},terms:[],name:"Insurance Office"},"office/it":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"it"},terms:[],name:"IT Office"},"office/lawyer":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"lawyer"},terms:[],name:"Law Office"},"office/newspaper":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"newspaper"},terms:[],name:"Newspaper"},"office/ngo":{icon:"commercial",fields:["address","opening_hours","smoking"],geometry:["point","vertex","area"],tags:{office:"ngo"},terms:[],name:"NGO Office"},"office/physician":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"physician"},terms:[],name:"Physician"},"office/political_party":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"political_party"},terms:[],name:"Political Party"},"office/research":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"research"},terms:[],name:"Research Office"},"office/telecommunication":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"telecommunication"},terms:[],name:"Telecom Office"},"office/therapist":{icon:"commercial",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"therapist"},terms:[],name:"Therapist"},"office/travel_agent":{icon:"suitcase",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{office:"travel_agent"},terms:[],name:"Travel Agency",searchable:false},piste:{icon:"skiing",fields:["piste/type","piste/difficulty","piste/grooming","oneway","lit"],geometry:["point","line","area"],terms:["ski","sled","sleigh","snowboard","nordic","downhill","snowmobile"],tags:{"piste:type":"*"},name:"Piste/Ski Trail"},place:{fields:["place"],geometry:["point","vertex","area"],tags:{place:"*"},name:"Place"},"place/city":{icon:"city",fields:["population"],geometry:["point","area"],tags:{place:"city"},name:"City"},"place/hamlet":{icon:"triangle-stroked",fields:["population"],geometry:["point","area"],tags:{place:"hamlet"},name:"Hamlet"},"place/island":{geometry:["point","area"],terms:["archipelago","atoll","bar","cay","isle","islet","key","reef"],tags:{place:"island"},name:"Island"},"place/isolated_dwelling":{geometry:["point","area"],tags:{place:"isolated_dwelling"},name:"Isolated Dwelling"},"place/locality":{icon:"marker",fields:["population"],geometry:["point","area"],tags:{place:"locality"},name:"Locality"},"place/neighbourhood":{icon:"triangle-stroked",fields:["population"],geometry:["point","area"],tags:{place:"neighbourhood"},terms:["neighbourhood"],name:"Neighborhood"},"place/suburb":{icon:"triangle-stroked",fields:["population"],geometry:["point","area"],tags:{place:"suburb"},terms:["Boro","Quarter"],name:"Borough"},"place/town":{icon:"town",fields:["population"],geometry:["point","area"],tags:{place:"town"},name:"Town"},"place/village":{icon:"village",fields:["population"],geometry:["point","area"],tags:{place:"village"},name:"Village"},point:{name:"Point",tags:{},geometry:["point"],matchScore:0.1},power:{geometry:["point","vertex","line","area"],tags:{power:"*"},fields:["power"],name:"Power"},"power/generator":{name:"Power Generator",geometry:["point","vertex","area"],tags:{power:"generator"},fields:["generator/source","generator/method","generator/type"]},"power/line":{geometry:["line"],tags:{power:"line"},name:"Power Line",icon:"power-line"},"power/minor_line":{geometry:["line"],tags:{power:"minor_line"},name:"Minor Power Line",icon:"power-line"},"power/pole":{geometry:["vertex"],tags:{power:"pole"},name:"Power Pole"},"power/sub_station":{fields:["operator","building"],geometry:["point","area"],tags:{power:"sub_station"},name:"Substation"},"power/tower":{geometry:["vertex"],tags:{power:"tower"},name:"High-Voltage Tower"},"power/transformer":{geometry:["point","vertex","area"],tags:{power:"transformer"},name:"Transformer"},"public_transport/platform":{fields:["ref","operator","network","shelter"],geometry:["point","vertex","line","area"],tags:{public_transport:"platform"},name:"Platform"},"public_transport/stop_position":{icon:"bus",fields:["ref","operator","network"],geometry:["vertex"],tags:{public_transport:"stop_position"},name:"Stop Position"},railway:{fields:["railway"],geometry:["point","vertex","line","area"],tags:{railway:"*"},name:"Railway"},"railway/abandoned":{icon:"railway-abandoned",geometry:["line"],tags:{railway:"abandoned"},fields:["structure"],terms:[],name:"Abandoned Railway"},"railway/disused":{icon:"railway-disused",geometry:["line"],tags:{railway:"disused"},fields:["structure"],terms:[],name:"Disused Railway"},"railway/funicular":{geometry:["line"],terms:["venicular","cliff railway","cable car","cable railway","funicular railway"],fields:["structure","gauge"],tags:{railway:"funicular"},icon:"railway-rail",name:"Funicular"},"railway/halt":{icon:"rail",geometry:["point","vertex"],tags:{railway:"halt"},name:"Railway Halt",terms:["break","interrupt","rest","wait","interruption"]},"railway/level_crossing":{icon:"cross",geometry:["vertex"],tags:{railway:"level_crossing"},terms:["crossing","railroad crossing","railway crossing","grade crossing","road through railroad","train crossing"],name:"Level Crossing"},"railway/monorail":{icon:"railway-monorail",geometry:["line"],tags:{railway:"monorail"},fields:["structure","electrified"],terms:[],name:"Monorail"},"railway/narrow_gauge":{icon:"railway-rail",geometry:["line"],tags:{railway:"narrow_gauge"},fields:["structure","gauge","electrified"],terms:["narrow gauge railway","narrow gauge railroad"],name:"Narrow Gauge Rail"},"railway/platform":{geometry:["point","vertex","line","area"],tags:{railway:"platform"},name:"Railway Platform"},"railway/rail":{icon:"railway-rail",geometry:["line"],tags:{railway:"rail"},fields:["structure","gauge","electrified"],terms:[],name:"Rail"},"railway/station":{icon:"rail",fields:["building_area"],geometry:["point","vertex","area"],tags:{railway:"station"},terms:["train station","station"],name:"Railway Station"},"railway/subway":{icon:"railway-subway",fields:["structure","gauge","electrified"],geometry:["line"],tags:{railway:"subway"},terms:[],name:"Subway"},"railway/subway_entrance":{icon:"rail-metro",geometry:["point"],tags:{railway:"subway_entrance"},terms:[],name:"Subway Entrance"},"railway/tram":{icon:"railway-light-rail",geometry:["line"],tags:{railway:"tram"},fields:["structure","gauge","electrified"],terms:["streetcar"],name:"Tram"},relation:{name:"Relation",icon:"relation",tags:{},geometry:["relation"],fields:["relation"]},"route/ferry":{icon:"ferry",geometry:["line"],tags:{route:"ferry"},name:"Ferry Route"},shop:{icon:"shop",fields:["shop","address","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"*"},terms:[],name:"Shop"},"shop/alcohol":{icon:"alcohol-shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"alcohol"},terms:["alcohol"],name:"Liquor Store"},"shop/art":{icon:"art-gallery",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],terms:["art store","art gallery"],tags:{shop:"art"},name:"Art Shop"},"shop/bakery":{icon:"bakery",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"bakery"},name:"Bakery"},"shop/beauty":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],terms:["nail spa","spa","salon","tanning"],tags:{shop:"beauty"},name:"Beauty Shop"},"shop/beverages":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"beverages"},name:"Beverage Store"},"shop/bicycle":{icon:"bicycle",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"bicycle"},name:"Bicycle Shop"},"shop/bookmaker":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"bookmaker"},name:"Bookmaker"},"shop/books":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"books"},name:"Bookstore"},"shop/boutique":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"boutique"},name:"Boutique"},"shop/butcher":{icon:"slaughterhouse",fields:["building_area","opening_hours"],geometry:["point","vertex","area"],terms:[],tags:{shop:"butcher"},name:"Butcher"},"shop/car":{icon:"car",fields:["address","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"car"},name:"Car Dealership"},"shop/car_parts":{icon:"car",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"car_parts"},name:"Car Parts Store"},"shop/car_repair":{icon:"car",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"car_repair"},name:"Car Repair Shop"},"shop/chemist":{icon:"chemist",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"chemist"},name:"Chemist"},"shop/clothes":{icon:"clothing-store",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"clothes"},name:"Clothing Store"},"shop/computer":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"computer"},name:"Computer Store"},"shop/confectionery":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"confectionery"},name:"Confectionery"},"shop/convenience":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"convenience"},name:"Convenience Store"},"shop/deli":{icon:"restaurant",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"deli"},name:"Deli"},"shop/department_store":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"department_store"},name:"Department Store"},"shop/doityourself":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"doityourself"},name:"DIY Store"},"shop/dry_cleaning":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"dry_cleaning"},name:"Dry Cleaners"},"shop/electronics":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"electronics"},name:"Electronics Store"},"shop/farm":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"farm"},terms:["farm shop","farm stand"],name:"Produce Stand"},"shop/fishmonger":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"fishmonger"},name:"Fishmonger",searchable:false},"shop/florist":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"florist"},name:"Florist"},"shop/funeral_directors":{icon:"cemetery",fields:["address","building_area","religion","denomination"],geometry:["point","vertex","area"],tags:{shop:"funeral_directors"},terms:["undertaker","funeral parlour","funeral parlor","memorial home"],name:"Funeral Home"},"shop/furniture":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"furniture"},name:"Furniture Store"},"shop/garden_centre":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],terms:["garden centre"],tags:{shop:"garden_centre"},name:"Garden Center"},"shop/gift":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"gift"},name:"Gift Shop"},"shop/greengrocer":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"greengrocer"},name:"Greengrocer"},"shop/hairdresser":{icon:"hairdresser",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"hairdresser"},name:"Hairdresser"},"shop/hardware":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"hardware"},name:"Hardware Store"},"shop/hifi":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"hifi"},name:"Hifi Store"},"shop/jewelry":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"jewelry"},name:"Jeweler"},"shop/kiosk":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"kiosk"},name:"Kiosk"},"shop/laundry":{icon:"laundry",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"laundry"},name:"Laundry"},"shop/locksmith":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],terms:["keys"],tags:{shop:"locksmith"},name:"Locksmith"},"shop/lottery":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"lottery"},name:"Lottery Shop"},"shop/mall":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"mall"},name:"Mall"},"shop/mobile_phone":{icon:"mobilephone",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"mobile_phone"},name:"Mobile Phone Store"},"shop/motorcycle":{icon:"scooter",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"motorcycle"},name:"Motorcycle Dealership"},"shop/music":{icon:"music",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"music"},name:"Music Store"},"shop/newsagent":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"newsagent"},name:"Newsagent"},"shop/optician":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"optician"},name:"Optician"},"shop/outdoor":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"outdoor"},name:"Outdoor Store"},"shop/pet":{icon:"dog-park",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"pet"},name:"Pet Store"},"shop/photo":{icon:"camera",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"photo"},name:"Photography Store"},"shop/seafood":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"seafood"},terms:["fishmonger"],name:"Seafood Shop"},"shop/shoes":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"shoes"},name:"Shoe Store"},"shop/sports":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"sports"},name:"Sporting Goods Store"},"shop/stationery":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"stationery"},name:"Stationery Store"},"shop/supermarket":{icon:"grocery",fields:["operator","building_area","address"],geometry:["point","vertex","area"],terms:["bazaar","boutique","chain","co-op","cut-rate store","discount store","five-and-dime","flea market","galleria","grocery store","mall","mart","outlet","outlet store","shop","shopping center","shopping centre","shopping plaza","stand","store","supermarket","thrift shop"],tags:{shop:"supermarket"},name:"Supermarket"},"shop/tailor":{name:"Tailor",geometry:["point","area"],terms:["tailor","clothes"],tags:{shop:"tailor"},icon:"clothing-store",fields:["building_area","address","operator","opening_hours"]},"shop/toys":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"toys"},name:"Toy Store"},"shop/travel_agency":{icon:"suitcase",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"travel_agency"},name:"Travel Agency"},"shop/tyres":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"tyres"},name:"Tire Store"},"shop/vacant":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"vacant"},name:"Vacant Shop"},"shop/variety_store":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"variety_store"},name:"Variety Store"},"shop/video":{icon:"shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"video"},name:"Video Store"},"shop/wine":{icon:"alcohol-shop",fields:["address","building_area","opening_hours"],geometry:["point","vertex","area"],tags:{shop:"wine"},terms:["winery"],name:"Wine Shop"},tourism:{fields:["tourism"],geometry:["point","vertex","area"],tags:{tourism:"*"},name:"Tourism"},"tourism/alpine_hut":{icon:"lodging",fields:["operator","address"],geometry:["point","vertex","area"],tags:{tourism:"alpine_hut"},name:"Alpine Hut"},"tourism/artwork":{fields:["artwork_type","artist"],icon:"art-gallery",geometry:["point","vertex","area"],tags:{tourism:"artwork"},terms:["mural","sculpture","statue"],name:"Artwork"},"tourism/attraction":{icon:"monument",fields:["operator","address"],geometry:["point","vertex","area"],tags:{tourism:"attraction"},name:"Tourist Attraction"},"tourism/camp_site":{icon:"campsite",fields:["operator","address","smoking"],geometry:["point","vertex","area"],terms:["camping"],tags:{tourism:"camp_site"},name:"Camp Site"},"tourism/caravan_site":{fields:["operator","address","smoking"],geometry:["point","vertex","area"],tags:{tourism:"caravan_site"},name:"RV Park"},"tourism/chalet":{icon:"lodging",fields:["operator","building_area","address","smoking"],geometry:["point","vertex","area"],tags:{tourism:"chalet"},name:"Chalet"},"tourism/guest_house":{icon:"lodging",fields:["operator","address","smoking"],geometry:["point","vertex","area"],tags:{tourism:"guest_house"},terms:["B&B","Bed & Breakfast","Bed and Breakfast"],name:"Guest House"},"tourism/hostel":{icon:"lodging",fields:["operator","building_area","address","smoking"],geometry:["point","vertex","area"],tags:{tourism:"hostel"},name:"Hostel"},"tourism/hotel":{icon:"lodging",fields:["operator","building_area","address","smoking"],geometry:["point","vertex","area"],terms:[],tags:{tourism:"hotel"},name:"Hotel"},"tourism/information":{fields:["information","building_area","address","operator"],geometry:["point","vertex","area"],tags:{tourism:"information"},name:"Information"},"tourism/motel":{icon:"lodging",fields:["operator","building_area","address","smoking"],geometry:["point","vertex","area"],tags:{tourism:"motel"},name:"Motel"},"tourism/museum":{icon:"museum",fields:["operator","building_area","address"],geometry:["point","vertex","area"],terms:["exhibition","exhibits archive","foundation","gallery","hall","institution","library","menagerie","repository","salon","storehouse","treasury","vault"],tags:{tourism:"museum"},name:"Museum"},"tourism/picnic_site":{icon:"park",fields:["operator","address","smoking"],geometry:["point","vertex","area"],terms:[],tags:{tourism:"picnic_site"},name:"Picnic Site"},"tourism/theme_park":{fields:["operator","address"],geometry:["point","vertex","area"],tags:{tourism:"theme_park"},name:"Theme Park"},"tourism/viewpoint":{geometry:["point","vertex"],tags:{tourism:"viewpoint"},name:"Viewpoint"},"tourism/zoo":{icon:"zoo",fields:["operator","address"],geometry:["point","vertex","area"],tags:{tourism:"zoo"},name:"Zoo"},"type/boundary":{geometry:["relation"],tags:{type:"boundary"},name:"Boundary",icon:"boundary",fields:["boundary"]},"type/boundary/administrative":{name:"Administrative Boundary",geometry:["relation"],tags:{type:"boundary",boundary:"administrative"},fields:["admin_level"],icon:"boundary"},"type/multipolygon":{geometry:["area","relation"],tags:{type:"multipolygon"},removeTags:{},name:"Multipolygon",icon:"multipolygon",searchable:false,matchScore:0.1},"type/restriction":{geometry:["relation"],tags:{type:"restriction"},name:"Restriction",icon:"restriction",fields:["restriction","except"]},"type/restriction/no_left_turn":{name:"No Left Turn",geometry:["relation"],tags:{type:"restriction",restriction:"no_left_turn"},fields:["except"],icon:"restriction-no-left-turn"},"type/restriction/no_right_turn":{name:"No Right Turn",geometry:["relation"],tags:{type:"restriction",restriction:"no_right_turn"},fields:["except"],icon:"restriction-no-right-turn"},"type/restriction/no_straight_on":{name:"No Straight On",geometry:["relation"],tags:{type:"restriction",restriction:"no_straight_on"},fields:["except"],icon:"restriction-no-straight-on"},"type/restriction/no_u_turn":{name:"No U-turn",geometry:["relation"],tags:{type:"restriction",restriction:"no_u_turn"},fields:["except"],icon:"restriction-no-u-turn"},"type/restriction/only_left_turn":{name:"Left Turn Only",geometry:["relation"],tags:{type:"restriction",restriction:"only_left_turn"},fields:["except"],icon:"restriction-only-left-turn"},"type/restriction/only_right_turn":{name:"Right Turn Only",geometry:["relation"],tags:{type:"restriction",restriction:"only_right_turn"},fields:["except"],icon:"restriction-only-right-turn"},"type/restriction/only_straight_on":{name:"No Turns",geometry:["relation"],tags:{type:"restriction",restriction:"only_straight_on"},fields:["except"],icon:"restriction-only-straight-on"},"type/route":{geometry:["relation"],tags:{type:"route"},name:"Route",icon:"route",fields:["route","ref"]},"type/route/bicycle":{geometry:["relation"],tags:{type:"route",route:"bicycle"},name:"Cycle Route",icon:"route-bicycle",fields:["ref","network"]},"type/route/bus":{geometry:["relation"],tags:{type:"route",route:"bus"},name:"Bus Route",icon:"route-bus",fields:["ref","operator","network"]},"type/route/detour":{geometry:["relation"],tags:{type:"route",route:"detour"},name:"Detour Route",icon:"route-detour",fields:["ref"]},"type/route/ferry":{geometry:["relation"],tags:{type:"route",route:"ferry"},name:"Ferry Route",icon:"route-ferry",fields:["ref","operator","network"]},"type/route/foot":{geometry:["relation"],tags:{type:"route",route:"foot"},name:"Foot Route",icon:"route-foot",fields:["ref","operator","network"]},"type/route/hiking":{geometry:["relation"],tags:{type:"route",route:"hiking"},name:"Hiking Route",icon:"route-foot",fields:["ref","operator","network"]},"type/route/pipeline":{geometry:["relation"],tags:{type:"route",route:"pipeline"},name:"Pipeline Route",icon:"route-pipeline",fields:["ref","operator"]},"type/route/power":{geometry:["relation"],tags:{type:"route",route:"power"},name:"Power Route",icon:"route-power",fields:["ref","operator"]},"type/route/road":{geometry:["relation"],tags:{type:"route",route:"road"},name:"Road Route",icon:"route-road",fields:["ref"]},"type/route/train":{geometry:["relation"],tags:{type:"route",route:"train"},name:"Train Route",icon:"route-train",fields:["ref","operator"]},"type/route/tram":{geometry:["relation"],tags:{type:"route",route:"tram"},name:"Tram Route",icon:"route-tram",fields:["ref","operator"]},"type/route_master":{geometry:["relation"],tags:{type:"route_master"},name:"Route Master",icon:"route-master",fields:["route_master","ref","operator","network"]},vertex:{name:"Other",tags:{},geometry:["vertex"],matchScore:0.1},waterway:{fields:["waterway"],geometry:["point","vertex","line","area"],tags:{waterway:"*"},name:"Waterway"},"waterway/canal":{icon:"waterway-canal",fields:["width"],geometry:["line"],tags:{waterway:"canal"},name:"Canal"},"waterway/dam":{icon:"dam",geometry:["point","vertex","line","area"],tags:{waterway:"dam"},name:"Dam"},"waterway/ditch":{icon:"waterway-ditch",fields:["tunnel"],geometry:["line"],tags:{waterway:"ditch"},name:"Ditch"},"waterway/drain":{icon:"waterway-stream",fields:["tunnel"],geometry:["line"],tags:{waterway:"drain"},name:"Drain"},"waterway/river":{icon:"waterway-river",fields:["tunnel","width"],geometry:["line"],terms:["beck","branch","brook","course","creek","estuary","rill","rivulet","run","runnel","stream","tributary","watercourse"],tags:{waterway:"river"},name:"River"},"waterway/riverbank":{icon:"water",geometry:["area"],tags:{waterway:"riverbank"},name:"Riverbank"},"waterway/stream":{icon:"waterway-stream",fields:["tunnel","width"],geometry:["line"],terms:["beck","branch","brook","burn","course","creek","current","drift","flood","flow","freshet","race","rill","rindle","rivulet","run","runnel","rush","spate","spritz","surge","tide","torrent","tributary","watercourse"],tags:{waterway:"stream"},name:"Stream"},"waterway/weir":{icon:"dam",geometry:["vertex","line"],tags:{waterway:"weir"},name:"Weir"},"amenity/fuel/76":{tags:{name:"76",amenity:"fuel"},name:"76",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Neste":{tags:{name:"Neste",amenity:"fuel"},name:"Neste",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/BP":{tags:{name:"BP",amenity:"fuel"},name:"BP",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Shell":{tags:{name:"Shell",amenity:"fuel"},name:"Shell",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Agip":{tags:{name:"Agip",amenity:"fuel"},name:"Agip",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Migrol":{tags:{name:"Migrol",amenity:"fuel"},name:"Migrol",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Avia":{tags:{name:"Avia",amenity:"fuel"},name:"Avia",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Texaco":{tags:{name:"Texaco",amenity:"fuel"},name:"Texaco",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Total":{tags:{name:"Total",amenity:"fuel"},name:"Total",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Statoil":{tags:{name:"Statoil",amenity:"fuel"},name:"Statoil",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Esso":{tags:{name:"Esso",amenity:"fuel"},name:"Esso",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Jet":{tags:{name:"Jet",amenity:"fuel"},name:"Jet",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Avanti":{tags:{name:"Avanti",amenity:"fuel"},name:"Avanti",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/OMV":{tags:{name:"OMV",amenity:"fuel"},name:"OMV",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Aral":{tags:{name:"Aral",amenity:"fuel"},name:"Aral",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/JET":{tags:{name:"JET",amenity:"fuel"},name:"JET",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/United":{tags:{name:"United",amenity:"fuel"},name:"United",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Mobil":{tags:{name:"Mobil",amenity:"fuel"},name:"Mobil",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Caltex":{tags:{name:"Caltex",amenity:"fuel"},name:"Caltex",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Sunoco":{tags:{name:"Sunoco",amenity:"fuel"},name:"Sunoco",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Q8":{tags:{name:"Q8",amenity:"fuel"},name:"Q8",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ARAL":{tags:{name:"ARAL",amenity:"fuel"},name:"ARAL",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/CEPSA":{tags:{name:"CEPSA",amenity:"fuel"},name:"CEPSA",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/BFT":{tags:{name:"BFT",amenity:"fuel"},name:"BFT",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Petron":{tags:{name:"Petron",amenity:"fuel"},name:"Petron",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Total Access":{tags:{name:"Total Access",amenity:"fuel"},name:"Total Access",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Elf":{tags:{name:"Elf",amenity:"fuel"},name:"Elf",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Station Service E. Leclerc":{tags:{name:"Station Service E. Leclerc",amenity:"fuel"},name:"Station Service E. Leclerc",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Shell Express":{tags:{name:"Shell Express",amenity:"fuel"},name:"Shell Express",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Hess":{tags:{name:"Hess",amenity:"fuel"},name:"Hess",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Flying V":{tags:{name:"Flying V",amenity:"fuel"},name:"Flying V",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/bft":{tags:{name:"bft",amenity:"fuel"},name:"bft",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Gulf":{tags:{name:"Gulf",amenity:"fuel"},name:"Gulf",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/PTT":{tags:{name:"PTT",amenity:"fuel"},name:"PTT",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/St1":{tags:{name:"St1",amenity:"fuel"},name:"St1",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Teboil":{tags:{name:"Teboil",amenity:"fuel"},name:"Teboil",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/HEM":{tags:{name:"HEM",amenity:"fuel"},name:"HEM",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/GALP":{tags:{name:"GALP",amenity:"fuel"},name:"GALP",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/OK":{tags:{name:"OK",amenity:"fuel"},name:"OK",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ÖMV":{tags:{name:"\xD6MV",amenity:"fuel"},name:"\xD6MV",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Tinq":{tags:{name:"Tinq",amenity:"fuel"},name:"Tinq",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/OKQ8":{tags:{name:"OKQ8",amenity:"fuel"},name:"OKQ8",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Repsol":{tags:{name:"Repsol",amenity:"fuel"},name:"Repsol",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Westfalen":{tags:{name:"Westfalen",amenity:"fuel"},name:"Westfalen",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Esso Express":{tags:{name:"Esso Express",amenity:"fuel"},name:"Esso Express",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Tamoil":{tags:{name:"Tamoil",amenity:"fuel"},name:"Tamoil",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Engen":{tags:{name:"Engen",amenity:"fuel"},name:"Engen",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Sasol":{tags:{name:"Sasol",amenity:"fuel"},name:"Sasol",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Topaz":{tags:{name:"Topaz",amenity:"fuel"},name:"Topaz",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/LPG":{tags:{name:"LPG",amenity:"fuel"},name:"LPG",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Orlen":{tags:{name:"Orlen",amenity:"fuel"},name:"Orlen",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Oilibya":{tags:{name:"Oilibya",amenity:"fuel"},name:"Oilibya",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Tango":{tags:{name:"Tango",amenity:"fuel"},name:"Tango",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Star":{tags:{name:"Star",amenity:"fuel"},name:"Star",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Петрол":{tags:{name:"\u041F\u0435\u0442\u0440\u043E\u043B",amenity:"fuel"},name:"\u041F\u0435\u0442\u0440\u043E\u043B",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Cepsa":{tags:{name:"Cepsa",amenity:"fuel"},name:"Cepsa",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/OIL!":{tags:{name:"OIL!",amenity:"fuel"},name:"OIL!",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Ultramar":{tags:{name:"Ultramar",amenity:"fuel"},name:"Ultramar",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Irving":{tags:{name:"Irving",amenity:"fuel"},name:"Irving",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Lukoil":{tags:{name:"Lukoil",amenity:"fuel"},name:"Lukoil",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Petro-Canada":{tags:{name:"Petro-Canada",amenity:"fuel"},name:"Petro-Canada",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Agrola":{tags:{name:"Agrola",amenity:"fuel"},name:"Agrola",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Husky":{tags:{name:"Husky",amenity:"fuel"},name:"Husky",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Slovnaft":{tags:{name:"Slovnaft",amenity:"fuel"},name:"Slovnaft",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Sheetz":{tags:{name:"Sheetz",amenity:"fuel"},name:"Sheetz",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Mol":{tags:{name:"Mol",amenity:"fuel"},name:"Mol",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Petronas":{tags:{name:"Petronas",amenity:"fuel"},name:"Petronas",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Газпромнефть":{tags:{name:"\u0413\u0430\u0437\u043F\u0440\u043E\u043C\u043D\u0435\u0444\u0442\u044C",amenity:"fuel"},name:"\u0413\u0430\u0437\u043F\u0440\u043E\u043C\u043D\u0435\u0444\u0442\u044C",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Лукойл":{tags:{name:"\u041B\u0443\u043A\u043E\u0439\u043B",amenity:"fuel"},name:"\u041B\u0443\u043A\u043E\u0439\u043B",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Elan":{tags:{name:"Elan",amenity:"fuel"},name:"Elan",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Роснефть":{tags:{name:"\u0420\u043E\u0441\u043D\u0435\u0444\u0442\u044C",amenity:"fuel"},name:"\u0420\u043E\u0441\u043D\u0435\u0444\u0442\u044C",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Turmöl":{tags:{name:"Turm\xF6l",amenity:"fuel"},name:"Turm\xF6l",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Neste A24":{tags:{name:"Neste A24",amenity:"fuel"},name:"Neste A24",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Marathon":{tags:{name:"Marathon",amenity:"fuel"},name:"Marathon",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Valero":{tags:{name:"Valero",amenity:"fuel"},name:"Valero",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Eni":{tags:{name:"Eni",amenity:"fuel"},name:"Eni",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Chevron":{tags:{name:"Chevron",amenity:"fuel"},name:"Chevron",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ТНК":{tags:{name:"\u0422\u041D\u041A",amenity:"fuel"},name:"\u0422\u041D\u041A",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/REPSOL":{tags:{name:"REPSOL",amenity:"fuel"},name:"REPSOL",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/MOL":{tags:{name:"MOL",amenity:"fuel"},name:"MOL",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Bliska":{tags:{name:"Bliska",amenity:"fuel"},name:"Bliska",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Api":{tags:{name:"Api",amenity:"fuel"},name:"Api",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Arco":{tags:{name:"Arco",amenity:"fuel"},name:"Arco",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Pemex":{tags:{name:"Pemex",amenity:"fuel"},name:"Pemex",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Exxon":{tags:{name:"Exxon",amenity:"fuel"},name:"Exxon",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Coles Express":{tags:{name:"Coles Express",amenity:"fuel"},name:"Coles Express",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Petrom":{tags:{name:"Petrom",amenity:"fuel"},name:"Petrom",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/PETRONOR":{tags:{name:"PETRONOR",amenity:"fuel"},name:"PETRONOR",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Rompetrol":{tags:{name:"Rompetrol",amenity:"fuel"},name:"Rompetrol",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Lotos":{tags:{name:"Lotos",amenity:"fuel"},name:"Lotos",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ОМВ":{tags:{name:"\u041E\u041C\u0412",amenity:"fuel"},name:"\u041E\u041C\u0412",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/BR":{tags:{name:"BR",amenity:"fuel"},name:"BR",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Copec":{tags:{name:"Copec",amenity:"fuel"},name:"Copec",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Petrobras":{tags:{name:"Petrobras",amenity:"fuel"},name:"Petrobras",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Liberty":{tags:{name:"Liberty",amenity:"fuel"},name:"Liberty",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/IP":{tags:{name:"IP",amenity:"fuel"},name:"IP",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Erg":{tags:{name:"Erg",amenity:"fuel"},name:"Erg",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Eneos":{tags:{name:"Eneos",amenity:"fuel"},name:"Eneos",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Citgo":{tags:{name:"Citgo",amenity:"fuel"},name:"Citgo",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Metano":{tags:{name:"Metano",amenity:"fuel"},name:"Metano",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Сургутнефтегаз":{tags:{name:"\u0421\u0443\u0440\u0433\u0443\u0442\u043D\u0435\u0444\u0442\u0435\u0433\u0430\u0437",amenity:"fuel"},name:"\u0421\u0443\u0440\u0433\u0443\u0442\u043D\u0435\u0444\u0442\u0435\u0433\u0430\u0437",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/EKO":{tags:{name:"EKO",amenity:"fuel"},name:"EKO",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Eko":{tags:{name:"Eko",amenity:"fuel"},name:"Eko",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Indipend.":{tags:{name:"Indipend.",amenity:"fuel"},name:"Indipend.",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/IES":{tags:{name:"IES",amenity:"fuel"},name:"IES",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/TotalErg":{tags:{name:"TotalErg",amenity:"fuel"},name:"TotalErg",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Cenex":{tags:{name:"Cenex",amenity:"fuel"},name:"Cenex",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ПТК":{tags:{name:"\u041F\u0422\u041A",amenity:"fuel"},name:"\u041F\u0422\u041A",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/HP":{tags:{name:"HP",amenity:"fuel"},name:"HP",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Phillips 66":{tags:{name:"Phillips 66",amenity:"fuel"},name:"Phillips 66",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/CARREFOUR":{tags:{name:"CARREFOUR",amenity:"fuel"},name:"CARREFOUR",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ERG":{tags:{name:"ERG",amenity:"fuel"},name:"ERG",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Speedway":{tags:{name:"Speedway",amenity:"fuel"},name:"Speedway",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Benzina":{tags:{name:"Benzina",amenity:"fuel"},name:"Benzina",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Татнефть":{tags:{name:"\u0422\u0430\u0442\u043D\u0435\u0444\u0442\u044C",amenity:"fuel"},name:"\u0422\u0430\u0442\u043D\u0435\u0444\u0442\u044C",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Terpel":{tags:{name:"Terpel",amenity:"fuel"},name:"Terpel",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/WOG":{tags:{name:"WOG",amenity:"fuel"},name:"WOG",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Seaoil":{tags:{name:"Seaoil",amenity:"fuel"},name:"Seaoil",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/АЗС":{tags:{name:"\u0410\u0417\u0421",amenity:"fuel"},name:"\u0410\u0417\u0421",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Kwik Trip":{tags:{name:"Kwik Trip",amenity:"fuel"},name:"Kwik Trip",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Pertamina":{tags:{name:"Pertamina",amenity:"fuel"},name:"Pertamina",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/COSMO":{tags:{name:"COSMO",amenity:"fuel"},name:"COSMO",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Z":{tags:{name:"Z",amenity:"fuel"},name:"Z",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Indian Oil":{tags:{name:"Indian Oil",amenity:"fuel"},name:"Indian Oil",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/АГЗС":{tags:{name:"\u0410\u0413\u0417\u0421",amenity:"fuel"},name:"\u0410\u0413\u0417\u0421",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/INA":{tags:{name:"INA",amenity:"fuel"},name:"INA",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/JOMO":{tags:{name:"JOMO",amenity:"fuel"},name:"JOMO",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Holiday":{tags:{name:"Holiday",amenity:"fuel"},name:"Holiday",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/YPF":{tags:{name:"YPF",amenity:"fuel"},name:"YPF",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/IDEMITSU":{tags:{name:"IDEMITSU",amenity:"fuel"},name:"IDEMITSU",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ENEOS":{tags:{name:"ENEOS",amenity:"fuel"},name:"ENEOS",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Stacja paliw":{tags:{name:"Stacja paliw",amenity:"fuel"},name:"Stacja paliw",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Bharat Petroleum":{tags:{name:"Bharat Petroleum",amenity:"fuel"},name:"Bharat Petroleum",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/CAMPSA":{tags:{name:"CAMPSA",amenity:"fuel"},name:"CAMPSA",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Casey's General Store":{tags:{name:"Casey's General Store",amenity:"fuel"},name:"Casey's General Store",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Башнефть":{tags:{name:"\u0411\u0430\u0448\u043D\u0435\u0444\u0442\u044C",amenity:"fuel"},name:"\u0411\u0430\u0448\u043D\u0435\u0444\u0442\u044C",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Kangaroo":{tags:{name:"Kangaroo",amenity:"fuel"},name:"Kangaroo",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/コスモ石油 (COSMO)":{tags:{name:"\u30B3\u30B9\u30E2\u77F3\u6CB9 (COSMO)",amenity:"fuel"},name:"\u30B3\u30B9\u30E2\u77F3\u6CB9 (COSMO)",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/MEROIL":{tags:{name:"MEROIL",amenity:"fuel"},name:"MEROIL",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/1-2-3":{tags:{name:"1-2-3",amenity:"fuel"},name:"1-2-3",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/出光":{tags:{name:"\u51FA\u5149","name:en":"IDEMITSU",amenity:"fuel"},name:"\u51FA\u5149",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/НК Альянс":{tags:{name:"\u041D\u041A \u0410\u043B\u044C\u044F\u043D\u0441",amenity:"fuel"},name:"\u041D\u041A \u0410\u043B\u044C\u044F\u043D\u0441",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Sinclair":{tags:{name:"Sinclair",amenity:"fuel"},name:"Sinclair",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Conoco":{tags:{name:"Conoco",amenity:"fuel"},name:"Conoco",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/SPBU":{tags:{name:"SPBU",amenity:"fuel"},name:"SPBU",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Макпетрол":{tags:{name:"\u041C\u0430\u043A\u043F\u0435\u0442\u0440\u043E\u043B",amenity:"fuel"},name:"\u041C\u0430\u043A\u043F\u0435\u0442\u0440\u043E\u043B",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Posto Ipiranga":{tags:{name:"Posto Ipiranga",amenity:"fuel"},name:"Posto Ipiranga",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Posto Shell":{tags:{name:"Posto Shell",amenity:"fuel"},name:"Posto Shell",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Phoenix":{tags:{name:"Phoenix",amenity:"fuel"},name:"Phoenix",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Ipiranga":{tags:{name:"Ipiranga",amenity:"fuel"},name:"Ipiranga",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/OKKO":{tags:{name:"OKKO",amenity:"fuel"},name:"OKKO",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ОККО":{tags:{name:"\u041E\u041A\u041A\u041E",amenity:"fuel"},name:"\u041E\u041A\u041A\u041E",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/บางจาก":{tags:{name:"\u0E1A\u0E32\u0E07\u0E08\u0E32\u0E01",amenity:"fuel"},name:"\u0E1A\u0E32\u0E07\u0E08\u0E32\u0E01",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/QuikTrip":{tags:{name:"QuikTrip",amenity:"fuel"},name:"QuikTrip",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Posto BR":{tags:{name:"Posto BR",amenity:"fuel"},name:"Posto BR",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ป ต ท":{tags:{name:"\u0E1B \u0E15 \u0E17",amenity:"fuel"},name:"\u0E1B \u0E15 \u0E17",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ปตท":{tags:{name:"\u0E1B\u0E15\u0E17",amenity:"fuel"},name:"\u0E1B\u0E15\u0E17",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/ANP":{tags:{name:"ANP",amenity:"fuel"},name:"ANP",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Kum & Go":{tags:{name:"Kum & Go",amenity:"fuel"},name:"Kum & Go",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Petrolimex":{tags:{name:"Petrolimex",amenity:"fuel"},name:"Petrolimex",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Sokimex":{tags:{name:"Sokimex",amenity:"fuel"},name:"Sokimex",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Tela":{tags:{name:"Tela",amenity:"fuel"},name:"Tela",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Posto":{tags:{name:"Posto",amenity:"fuel"},name:"Posto",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Укрнафта":{tags:{name:"\u0423\u043A\u0440\u043D\u0430\u0444\u0442\u0430",amenity:"fuel"},name:"\u0423\u043A\u0440\u043D\u0430\u0444\u0442\u0430",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Татнефтепродукт":{tags:{name:"\u0422\u0430\u0442\u043D\u0435\u0444\u0442\u0435\u043F\u0440\u043E\u0434\u0443\u043A\u0442",amenity:"fuel"},name:"\u0422\u0430\u0442\u043D\u0435\u0444\u0442\u0435\u043F\u0440\u043E\u0434\u0443\u043A\u0442",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Afriquia":{tags:{name:"Afriquia",amenity:"fuel"},name:"Afriquia",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/Murphy USA":{tags:{name:"Murphy USA",amenity:"fuel"},name:"Murphy USA",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/昭和シェル (Showa-shell)":{tags:{name:"\u662D\u548C\u30B7\u30A7\u30EB (Showa-shell)",amenity:"fuel"},name:"\u662D\u548C\u30B7\u30A7\u30EB (Showa-shell)",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/エネオス":{tags:{name:"\u30A8\u30CD\u30AA\u30B9",amenity:"fuel"},name:"\u30A8\u30CD\u30AA\u30B9",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/fuel/CNG":{tags:{name:"CNG",amenity:"fuel"},name:"CNG",icon:"fuel",geometry:["point","vertex","area"],fields:["operator","address","building_area"],suggestion:true},"amenity/pub/Kings Arms":{tags:{name:"Kings Arms",amenity:"pub"},name:"Kings Arms",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Ship":{tags:{name:"The Ship",amenity:"pub"},name:"The Ship",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The White Horse":{tags:{name:"The White Horse",amenity:"pub"},name:"The White Horse",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The White Hart":{tags:{name:"The White Hart",amenity:"pub"},name:"The White Hart",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Royal Oak":{tags:{name:"Royal Oak",amenity:"pub"},name:"Royal Oak",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Red Lion":{tags:{name:"The Red Lion",amenity:"pub"},name:"The Red Lion",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Kings Arms":{tags:{name:"The Kings Arms",amenity:"pub"},name:"The Kings Arms",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Star":{tags:{name:"The Star",amenity:"pub"},name:"The Star",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Anchor":{tags:{name:"The Anchor",amenity:"pub"},name:"The Anchor",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Cross Keys":{tags:{name:"The Cross Keys",amenity:"pub"},name:"The Cross Keys",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Wheatsheaf":{tags:{name:"The Wheatsheaf",amenity:"pub"},name:"The Wheatsheaf",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Crown Inn":{tags:{name:"The Crown Inn",amenity:"pub"},name:"The Crown Inn",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Kings Head":{tags:{name:"The Kings Head",amenity:"pub"},name:"The Kings Head",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Castle":{tags:{name:"The Castle",amenity:"pub"},name:"The Castle",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Railway":{tags:{name:"The Railway",amenity:"pub"},name:"The Railway",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The White Lion":{tags:{name:"The White Lion",amenity:"pub"},name:"The White Lion",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Bell":{tags:{name:"The Bell",amenity:"pub"},name:"The Bell",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Bull":{tags:{name:"The Bull",amenity:"pub"},name:"The Bull",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Plough":{tags:{name:"The Plough",amenity:"pub"},name:"The Plough",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The George":{tags:{name:"The George",amenity:"pub"},name:"The George",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Royal Oak":{tags:{name:"The Royal Oak",amenity:"pub"},name:"The Royal Oak",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Fox":{tags:{name:"The Fox",amenity:"pub"},name:"The Fox",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Prince of Wales":{tags:{name:"Prince of Wales",amenity:"pub"},name:"Prince of Wales",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Rising Sun":{tags:{name:"The Rising Sun",amenity:"pub"},name:"The Rising Sun",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Prince of Wales":{tags:{name:"The Prince of Wales",amenity:"pub"},name:"The Prince of Wales",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Crown":{tags:{name:"The Crown",amenity:"pub"},name:"The Crown",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Chequers":{tags:{name:"The Chequers",amenity:"pub"},name:"The Chequers",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Swan":{tags:{name:"The Swan",amenity:"pub"},name:"The Swan",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Rose and Crown":{tags:{name:"Rose and Crown",amenity:"pub"},name:"Rose and Crown",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Victoria":{tags:{name:"The Victoria",amenity:"pub"},name:"The Victoria",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/New Inn":{tags:{name:"New Inn",amenity:"pub"},name:"New Inn",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Royal Hotel":{tags:{name:"Royal Hotel",amenity:"pub"},name:"Royal Hotel",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Red Lion":{tags:{name:"Red Lion",amenity:"pub"},name:"Red Lion",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Cross Keys":{tags:{name:"Cross Keys",amenity:"pub"},name:"Cross Keys",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Greyhound":{tags:{name:"The Greyhound",amenity:"pub"},name:"The Greyhound",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Black Horse":{tags:{name:"The Black Horse",amenity:"pub"},name:"The Black Horse",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The New Inn":{tags:{name:"The New Inn",amenity:"pub"},name:"The New Inn",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Kings Head":{tags:{name:"Kings Head",amenity:"pub"},name:"Kings Head",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Albion":{tags:{name:"The Albion",amenity:"pub"},name:"The Albion",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Angel":{tags:{name:"The Angel",amenity:"pub"},name:"The Angel",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Queens Head":{tags:{name:"The Queens Head",amenity:"pub"},name:"The Queens Head",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/The Ship Inn":{tags:{name:"The Ship Inn",amenity:"pub"},name:"The Ship Inn",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Rose & Crown":{tags:{name:"Rose & Crown",amenity:"pub"},name:"Rose & Crown",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Queens Head":{tags:{name:"Queens Head",amenity:"pub"},name:"Queens Head",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/pub/Irish Pub":{tags:{name:"Irish Pub",amenity:"pub"},name:"Irish Pub",icon:"beer",geometry:["point","vertex","area"],fields:["building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Quick":{tags:{name:"Quick",amenity:"fast_food"},name:"Quick",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/McDonald's":{tags:{name:"McDonald's",cuisine:"burger",amenity:"fast_food"},name:"McDonald's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Subway":{tags:{name:"Subway",cuisine:"sandwich",amenity:"fast_food"},name:"Subway",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Burger King":{tags:{name:"Burger King",cuisine:"burger",amenity:"fast_food"},name:"Burger King",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Ali Baba":{tags:{name:"Ali Baba",amenity:"fast_food"},name:"Ali Baba",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Hungry Jacks":{tags:{name:"Hungry Jacks",cuisine:"burger",amenity:"fast_food"},name:"Hungry Jacks",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Red Rooster":{tags:{name:"Red Rooster",amenity:"fast_food"},name:"Red Rooster",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/KFC":{tags:{name:"KFC",cuisine:"chicken",amenity:"fast_food"},name:"KFC",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Domino's Pizza":{tags:{name:"Domino's Pizza",cuisine:"pizza",amenity:"fast_food"},name:"Domino's Pizza",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Chowking":{tags:{name:"Chowking",amenity:"fast_food"},name:"Chowking",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Jollibee":{tags:{name:"Jollibee",amenity:"fast_food"},name:"Jollibee",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Hesburger":{tags:{name:"Hesburger",amenity:"fast_food"},name:"Hesburger",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/肯德基":{tags:{name:"\u80AF\u5FB7\u57FA",amenity:"fast_food"},name:"\u80AF\u5FB7\u57FA",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Wendy's":{tags:{name:"Wendy's",cuisine:"burger",amenity:"fast_food"},name:"Wendy's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Tim Hortons":{tags:{name:"Tim Hortons",amenity:"fast_food"},name:"Tim Hortons",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Steers":{tags:{name:"Steers",amenity:"fast_food"},name:"Steers",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Hardee's":{tags:{name:"Hardee's",cuisine:"burger",amenity:"fast_food"},name:"Hardee's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Arby's":{tags:{name:"Arby's",amenity:"fast_food"},name:"Arby's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/A&W":{tags:{name:"A&W",amenity:"fast_food"},name:"A&W",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Dairy Queen":{tags:{name:"Dairy Queen",amenity:"fast_food"},name:"Dairy Queen",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Hallo Pizza":{tags:{name:"Hallo Pizza",amenity:"fast_food"},name:"Hallo Pizza",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Fish & Chips":{tags:{name:"Fish & Chips",amenity:"fast_food"},name:"Fish & Chips",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Harvey's":{tags:{name:"Harvey's",amenity:"fast_food"},name:"Harvey's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/麥當勞":{tags:{name:"\u9EA5\u7576\u52DE",amenity:"fast_food"},name:"\u9EA5\u7576\u52DE",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Pizza Pizza":{tags:{name:"Pizza Pizza",amenity:"fast_food"},name:"Pizza Pizza",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Kotipizza":{tags:{name:"Kotipizza",amenity:"fast_food"},name:"Kotipizza",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Jack in the Box":{tags:{name:"Jack in the Box",cuisine:"burger",amenity:"fast_food"},name:"Jack in the Box",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Istanbul":{tags:{name:"Istanbul",amenity:"fast_food"},name:"Istanbul",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Kochlöffel":{tags:{name:"Kochl\xF6ffel",amenity:"fast_food"},name:"Kochl\xF6ffel",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Döner":{tags:{name:"D\xF6ner",amenity:"fast_food"},name:"D\xF6ner",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Telepizza":{tags:{name:"Telepizza",amenity:"fast_food"},name:"Telepizza",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Sibylla":{tags:{name:"Sibylla",amenity:"fast_food"},name:"Sibylla",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Carl's Jr.":{tags:{name:"Carl's Jr.",cuisine:"burger",amenity:"fast_food"},name:"Carl's Jr.",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Quiznos":{tags:{name:"Quiznos",cuisine:"sandwich",amenity:"fast_food"},name:"Quiznos",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Wimpy":{tags:{name:"Wimpy",amenity:"fast_food"},name:"Wimpy",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Sonic":{tags:{name:"Sonic",cuisine:"burger",amenity:"fast_food"},name:"Sonic",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Taco Bell":{tags:{name:"Taco Bell",amenity:"fast_food"},name:"Taco Bell",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Pizza Nova":{tags:{name:"Pizza Nova",amenity:"fast_food"},name:"Pizza Nova",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Papa John's":{tags:{name:"Papa John's",cuisine:"pizza",amenity:"fast_food"},name:"Papa John's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Nordsee":{tags:{name:"Nordsee",amenity:"fast_food"},name:"Nordsee",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Mr. Sub":{tags:{name:"Mr. Sub",amenity:"fast_food"},name:"Mr. Sub",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Kebab":{tags:{name:"Kebab",amenity:"fast_food"},name:"Kebab",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Макдоналдс":{tags:{name:"\u041C\u0430\u043A\u0434\u043E\u043D\u0430\u043B\u0434\u0441","name:en":"McDonald's",amenity:"fast_food"},name:"\u041C\u0430\u043A\u0434\u043E\u043D\u0430\u043B\u0434\u0441",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Asia Imbiss":{tags:{name:"Asia Imbiss",amenity:"fast_food"},name:"Asia Imbiss",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Imbiss":{tags:{name:"Imbiss",amenity:"fast_food"},name:"Imbiss",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Chipotle":{tags:{name:"Chipotle",cuisine:"mexican",amenity:"fast_food"},name:"Chipotle",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/マクドナルド":{tags:{name:"\u30DE\u30AF\u30C9\u30CA\u30EB\u30C9","name:en":"McDonald's",cuisine:"burger",amenity:"fast_food"},name:"\u30DE\u30AF\u30C9\u30CA\u30EB\u30C9",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/In-N-Out Burger":{tags:{name:"In-N-Out Burger",amenity:"fast_food"},name:"In-N-Out Burger",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Jimmy John's":{tags:{name:"Jimmy John's",amenity:"fast_food"},name:"Jimmy John's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Jamba Juice":{tags:{name:"Jamba Juice",amenity:"fast_food"},name:"Jamba Juice",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Робин Сдобин":{tags:{name:"\u0420\u043E\u0431\u0438\u043D \u0421\u0434\u043E\u0431\u0438\u043D",amenity:"fast_food"},name:"\u0420\u043E\u0431\u0438\u043D \u0421\u0434\u043E\u0431\u0438\u043D",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Baskin Robbins":{tags:{name:"Baskin Robbins",amenity:"fast_food"},name:"Baskin Robbins",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/ケンタッキーフライドチキン":{tags:{name:"\u30B1\u30F3\u30BF\u30C3\u30AD\u30FC\u30D5\u30E9\u30A4\u30C9\u30C1\u30AD\u30F3","name:en":"KFC",cuisine:"chicken",amenity:"fast_food"},name:"\u30B1\u30F3\u30BF\u30C3\u30AD\u30FC\u30D5\u30E9\u30A4\u30C9\u30C1\u30AD\u30F3",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/吉野家":{tags:{name:"\u5409\u91CE\u5BB6",amenity:"fast_food"},name:"\u5409\u91CE\u5BB6",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Taco Time":{tags:{name:"Taco Time",amenity:"fast_food"},name:"Taco Time",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/松屋":{tags:{name:"\u677E\u5C4B","name:en":"Matsuya",amenity:"fast_food"},name:"\u677E\u5C4B",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Little Caesars":{tags:{name:"Little Caesars",amenity:"fast_food"},name:"Little Caesars",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/El Pollo Loco":{tags:{name:"El Pollo Loco",amenity:"fast_food"},name:"El Pollo Loco",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Del Taco":{tags:{name:"Del Taco",amenity:"fast_food"},name:"Del Taco",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/White Castle":{tags:{name:"White Castle",amenity:"fast_food"},name:"White Castle",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Boston Market":{tags:{name:"Boston Market",amenity:"fast_food"},name:"Boston Market",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Chick-fil-A":{tags:{name:"Chick-fil-A",cuisine:"chicken",amenity:"fast_food"},name:"Chick-fil-A",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Panda Express":{tags:{name:"Panda Express",amenity:"fast_food"},name:"Panda Express",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Whataburger":{tags:{name:"Whataburger",amenity:"fast_food"},name:"Whataburger",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Taco John's":{tags:{name:"Taco John's",amenity:"fast_food"},name:"Taco John's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Теремок":{tags:{name:"\u0422\u0435\u0440\u0435\u043C\u043E\u043A",amenity:"fast_food"},name:"\u0422\u0435\u0440\u0435\u043C\u043E\u043A",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Culver's":{tags:{name:"Culver's",amenity:"fast_food"},name:"Culver's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Five Guys":{tags:{name:"Five Guys",amenity:"fast_food"},name:"Five Guys",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Church's Chicken":{tags:{name:"Church's Chicken",amenity:"fast_food"},name:"Church's Chicken",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Popeye's":{tags:{name:"Popeye's",cuisine:"chicken",amenity:"fast_food"},name:"Popeye's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Long John Silver's":{tags:{name:"Long John Silver's",amenity:"fast_food"},name:"Long John Silver's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Pollo Campero":{tags:{name:"Pollo Campero",amenity:"fast_food"},name:"Pollo Campero",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Zaxby's":{tags:{name:"Zaxby's",amenity:"fast_food"},name:"Zaxby's",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/すき家":{tags:{name:"\u3059\u304D\u5BB6","name:en":"SUKIYA",amenity:"fast_food"},name:"\u3059\u304D\u5BB6",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/モスバーガー":{tags:{name:"\u30E2\u30B9\u30D0\u30FC\u30AC\u30FC","name:en":"MOS BURGER",amenity:"fast_food"},name:"\u30E2\u30B9\u30D0\u30FC\u30AC\u30FC",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/Русский Аппетит":{tags:{name:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439 \u0410\u043F\u043F\u0435\u0442\u0438\u0442",amenity:"fast_food"},name:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439 \u0410\u043F\u043F\u0435\u0442\u0438\u0442",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/fast_food/なか卯":{tags:{name:"\u306A\u304B\u536F",amenity:"fast_food"},name:"\u306A\u304B\u536F",icon:"fast-food",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/restaurant/Pizza Hut":{tags:{name:"Pizza Hut",amenity:"restaurant"},name:"Pizza Hut",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Little Chef":{tags:{name:"Little Chef",amenity:"restaurant"},name:"Little Chef",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Adler":{tags:{name:"Adler",amenity:"restaurant"},name:"Adler",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Zur Krone":{tags:{name:"Zur Krone",amenity:"restaurant"},name:"Zur Krone",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Deutsches Haus":{tags:{name:"Deutsches Haus",amenity:"restaurant"},name:"Deutsches Haus",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Krone":{tags:{name:"Krone",amenity:"restaurant"},name:"Krone",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Akropolis":{tags:{name:"Akropolis",amenity:"restaurant"},name:"Akropolis",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Schützenhaus":{tags:{name:"Sch\xFCtzenhaus",amenity:"restaurant"},name:"Sch\xFCtzenhaus",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Kreuz":{tags:{name:"Kreuz",amenity:"restaurant"},name:"Kreuz",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Waldschänke":{tags:{name:"Waldsch\xE4nke",amenity:"restaurant"},name:"Waldsch\xE4nke",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/La Piazza":{tags:{name:"La Piazza",amenity:"restaurant"},name:"La Piazza",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Lamm":{tags:{name:"Lamm",amenity:"restaurant"},name:"Lamm",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Zur Sonne":{tags:{name:"Zur Sonne",amenity:"restaurant"},name:"Zur Sonne",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Zur Linde":{tags:{name:"Zur Linde",amenity:"restaurant"},name:"Zur Linde",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Poseidon":{tags:{name:"Poseidon",amenity:"restaurant"},name:"Poseidon",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Shanghai":{tags:{name:"Shanghai",amenity:"restaurant"},name:"Shanghai",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Red Lobster":{tags:{name:"Red Lobster",amenity:"restaurant"},name:"Red Lobster",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Zum Löwen":{tags:{name:"Zum L\xF6wen",amenity:"restaurant"},name:"Zum L\xF6wen",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Swiss Chalet":{tags:{name:"Swiss Chalet",amenity:"restaurant"},name:"Swiss Chalet",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Olympia":{tags:{name:"Olympia",amenity:"restaurant"},name:"Olympia",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Wagamama":{tags:{name:"Wagamama",amenity:"restaurant"},name:"Wagamama",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Frankie & Benny's":{tags:{name:"Frankie & Benny's",amenity:"restaurant"},name:"Frankie & Benny's",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Hooters":{tags:{name:"Hooters",amenity:"restaurant"},name:"Hooters",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Sternen":{tags:{name:"Sternen",amenity:"restaurant"},name:"Sternen",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Hirschen":{tags:{name:"Hirschen",amenity:"restaurant"},name:"Hirschen",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Denny's":{tags:{name:"Denny's",amenity:"restaurant"},name:"Denny's",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Athen":{tags:{name:"Athen",amenity:"restaurant"},name:"Athen",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Sonne":{tags:{name:"Sonne",amenity:"restaurant"},name:"Sonne",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Hirsch":{tags:{name:"Hirsch",amenity:"restaurant"},name:"Hirsch",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Ratskeller":{tags:{name:"Ratskeller",amenity:"restaurant"},name:"Ratskeller",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/La Cantina":{tags:{name:"La Cantina",amenity:"restaurant"},name:"La Cantina",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Gasthaus Krone":{tags:{name:"Gasthaus Krone",amenity:"restaurant"},name:"Gasthaus Krone",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/El Greco":{tags:{name:"El Greco",amenity:"restaurant"},name:"El Greco",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Gasthof zur Post":{tags:{name:"Gasthof zur Post",amenity:"restaurant"},name:"Gasthof zur Post",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Nando's":{tags:{name:"Nando's",amenity:"restaurant"},name:"Nando's",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Löwen":{tags:{name:"L\xF6wen",amenity:"restaurant"},name:"L\xF6wen",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/La Pataterie":{tags:{name:"La Pataterie",amenity:"restaurant"},name:"La Pataterie",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Bella Napoli":{tags:{name:"Bella Napoli",amenity:"restaurant"},name:"Bella Napoli",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Pizza Express":{tags:{name:"Pizza Express",amenity:"restaurant"},name:"Pizza Express",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Mandarin":{tags:{name:"Mandarin",amenity:"restaurant"},name:"Mandarin",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Hong Kong":{tags:{name:"Hong Kong",amenity:"restaurant"},name:"Hong Kong",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Zizzi":{tags:{name:"Zizzi",amenity:"restaurant"},name:"Zizzi",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Cracker Barrel":{tags:{name:"Cracker Barrel",amenity:"restaurant"},name:"Cracker Barrel",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Rhodos":{tags:{name:"Rhodos",amenity:"restaurant"},name:"Rhodos",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Lindenhof":{tags:{name:"Lindenhof",amenity:"restaurant"},name:"Lindenhof",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Milano":{tags:{name:"Milano",amenity:"restaurant"},name:"Milano",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Dolce Vita":{tags:{name:"Dolce Vita",amenity:"restaurant"},name:"Dolce Vita",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Kirchenwirt":{tags:{name:"Kirchenwirt",amenity:"restaurant"},name:"Kirchenwirt",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Kantine":{tags:{name:"Kantine",amenity:"restaurant"},name:"Kantine",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Ochsen":{tags:{name:"Ochsen",amenity:"restaurant"},name:"Ochsen",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Spur":{tags:{name:"Spur",amenity:"restaurant"},name:"Spur",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Mykonos":{tags:{name:"Mykonos",amenity:"restaurant"},name:"Mykonos",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Lotus":{tags:{name:"Lotus",amenity:"restaurant"},name:"Lotus",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Applebee's":{tags:{name:"Applebee's",amenity:"restaurant"},name:"Applebee's",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Flunch":{tags:{name:"Flunch",amenity:"restaurant"},name:"Flunch",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Zur Post":{tags:{name:"Zur Post",amenity:"restaurant"},name:"Zur Post",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/China Town":{tags:{name:"China Town",amenity:"restaurant"},name:"China Town",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/La Dolce Vita":{tags:{name:"La Dolce Vita",amenity:"restaurant"},name:"La Dolce Vita",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Waffle House":{tags:{name:"Waffle House",amenity:"restaurant"},name:"Waffle House",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Delphi":{tags:{name:"Delphi",amenity:"restaurant"},name:"Delphi",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Linde":{tags:{name:"Linde",amenity:"restaurant"},name:"Linde",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Outback Steakhouse":{tags:{name:"Outback Steakhouse",amenity:"restaurant"},name:"Outback Steakhouse",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Dionysos":{tags:{name:"Dionysos",amenity:"restaurant"},name:"Dionysos",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Kelsey's":{tags:{name:"Kelsey's",amenity:"restaurant"},name:"Kelsey's",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Boston Pizza":{tags:{name:"Boston Pizza",amenity:"restaurant"},name:"Boston Pizza",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Bella Italia":{tags:{name:"Bella Italia",amenity:"restaurant"},name:"Bella Italia",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Sizzler":{tags:{name:"Sizzler",amenity:"restaurant"},name:"Sizzler",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Grüner Baum":{tags:{name:"Gr\xFCner Baum",amenity:"restaurant"},name:"Gr\xFCner Baum",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Taj Mahal":{tags:{name:"Taj Mahal",amenity:"restaurant"},name:"Taj Mahal",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Rössli":{tags:{name:"R\xF6ssli",amenity:"restaurant"},name:"R\xF6ssli",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Traube":{tags:{name:"Traube",amenity:"restaurant"},name:"Traube",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Adria":{tags:{name:"Adria",amenity:"restaurant"},name:"Adria",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Red Robin":{tags:{name:"Red Robin",amenity:"restaurant"},name:"Red Robin",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Roma":{tags:{name:"Roma",amenity:"restaurant"},name:"Roma",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/San Marco":{tags:{name:"San Marco",amenity:"restaurant"},name:"San Marco",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Hellas":{tags:{name:"Hellas",amenity:"restaurant"},name:"Hellas",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/La Perla":{tags:{name:"La Perla",amenity:"restaurant"},name:"La Perla",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Vips":{tags:{name:"Vips",amenity:"restaurant"},name:"Vips",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Panera Bread":{tags:{name:"Panera Bread",amenity:"restaurant"},name:"Panera Bread",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Da Vinci":{tags:{name:"Da Vinci",amenity:"restaurant"},name:"Da Vinci",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Hippopotamus":{tags:{name:"Hippopotamus",amenity:"restaurant"},name:"Hippopotamus",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Prezzo":{tags:{name:"Prezzo",amenity:"restaurant"},name:"Prezzo",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Courtepaille":{tags:{name:"Courtepaille",amenity:"restaurant"},name:"Courtepaille",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Hard Rock Cafe":{tags:{name:"Hard Rock Cafe",amenity:"restaurant"},name:"Hard Rock Cafe",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Panorama":{tags:{name:"Panorama",amenity:"restaurant"},name:"Panorama",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/デニーズ":{tags:{name:"\u30C7\u30CB\u30FC\u30BA",amenity:"restaurant"},name:"\u30C7\u30CB\u30FC\u30BA",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Sportheim":{tags:{name:"Sportheim",amenity:"restaurant"},name:"Sportheim",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/餃子の王将":{tags:{name:"\u9903\u5B50\u306E\u738B\u5C06",amenity:"restaurant"},name:"\u9903\u5B50\u306E\u738B\u5C06",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Bären":{tags:{name:"B\xE4ren",amenity:"restaurant"},name:"B\xE4ren",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Alte Post":{tags:{name:"Alte Post",amenity:"restaurant"},name:"Alte Post",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Pizzeria Roma":{tags:{name:"Pizzeria Roma",amenity:"restaurant"},name:"Pizzeria Roma",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/China Garden":{tags:{name:"China Garden",amenity:"restaurant"},name:"China Garden",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Vapiano":{tags:{name:"Vapiano",amenity:"restaurant"},name:"Vapiano",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Mamma Mia":{tags:{name:"Mamma Mia",amenity:"restaurant"},name:"Mamma Mia",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Schwarzer Adler":{tags:{name:"Schwarzer Adler",amenity:"restaurant"},name:"Schwarzer Adler",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/IHOP":{tags:{name:"IHOP",amenity:"restaurant"},name:"IHOP",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Chili's":{tags:{name:"Chili's",amenity:"restaurant"},name:"Chili's",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Asia":{tags:{name:"Asia",amenity:"restaurant"},name:"Asia",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Olive Garden":{tags:{name:"Olive Garden",amenity:"restaurant"},name:"Olive Garden",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/TGI Friday's":{tags:{name:"TGI Friday's",amenity:"restaurant"},name:"TGI Friday's",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Friendly's":{tags:{name:"Friendly's",amenity:"restaurant"},name:"Friendly's",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Buffalo Grill":{tags:{name:"Buffalo Grill",amenity:"restaurant"},name:"Buffalo Grill",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Texas Roadhouse":{tags:{name:"Texas Roadhouse",amenity:"restaurant"},name:"Texas Roadhouse",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/ガスト":{tags:{name:"\u30AC\u30B9\u30C8","name:en":"Gusto",amenity:"restaurant"},name:"\u30AC\u30B9\u30C8",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Sakura":{tags:{name:"Sakura",amenity:"restaurant"},name:"Sakura",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Mensa":{tags:{name:"Mensa",amenity:"restaurant"},name:"Mensa",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/The Keg":{tags:{name:"The Keg",amenity:"restaurant"},name:"The Keg",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/サイゼリヤ":{tags:{name:"\u30B5\u30A4\u30BC\u30EA\u30E4",amenity:"restaurant"},name:"\u30B5\u30A4\u30BC\u30EA\u30E4",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/La Strada":{tags:{name:"La Strada",amenity:"restaurant"},name:"La Strada",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Village Inn":{tags:{name:"Village Inn",amenity:"restaurant"},name:"Village Inn",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Buffalo Wild Wings":{tags:{name:"Buffalo Wild Wings",amenity:"restaurant"},name:"Buffalo Wild Wings",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Peking":{tags:{name:"Peking",amenity:"restaurant"},name:"Peking",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Round Table Pizza":{tags:{name:"Round Table Pizza",amenity:"restaurant"},name:"Round Table Pizza",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/California Pizza Kitchen":{tags:{name:"California Pizza Kitchen",amenity:"restaurant"},name:"California Pizza Kitchen",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Якитория":{tags:{name:"\u042F\u043A\u0438\u0442\u043E\u0440\u0438\u044F",amenity:"restaurant"},name:"\u042F\u043A\u0438\u0442\u043E\u0440\u0438\u044F",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Golden Corral":{tags:{name:"Golden Corral",amenity:"restaurant"},name:"Golden Corral",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Perkins":{tags:{name:"Perkins",amenity:"restaurant"},name:"Perkins",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Ruby Tuesday":{tags:{name:"Ruby Tuesday",amenity:"restaurant"},name:"Ruby Tuesday",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Shari's":{tags:{name:"Shari's",amenity:"restaurant"},name:"Shari's",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Bob Evans":{tags:{name:"Bob Evans",amenity:"restaurant"},name:"Bob Evans",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/바다횟집 (Bada Fish Restaurant)":{tags:{name:"\uBC14\uB2E4\uD69F\uC9D1 (Bada Fish Restaurant)",amenity:"restaurant"},name:"\uBC14\uB2E4\uD69F\uC9D1 (Bada Fish Restaurant)",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Mang Inasal":{tags:{name:"Mang Inasal",amenity:"restaurant"},name:"Mang Inasal",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Евразия":{tags:{name:"\u0415\u0432\u0440\u0430\u0437\u0438\u044F",amenity:"restaurant"},name:"\u0415\u0432\u0440\u0430\u0437\u0438\u044F",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/ジョナサン":{tags:{name:"\u30B8\u30E7\u30CA\u30B5\u30F3",amenity:"restaurant"},name:"\u30B8\u30E7\u30CA\u30B5\u30F3",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/restaurant/Longhorn Steakhouse":{tags:{name:"Longhorn Steakhouse",amenity:"restaurant"},name:"Longhorn Steakhouse",icon:"restaurant",geometry:["point","vertex","area"],fields:["cuisine","building_area","address","opening_hours","capacity","smoking"],suggestion:true},"amenity/bank/Chase":{tags:{name:"Chase",amenity:"bank"},name:"Chase",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Commonwealth Bank":{tags:{name:"Commonwealth Bank",amenity:"bank"},name:"Commonwealth Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Citibank":{tags:{name:"Citibank",amenity:"bank"},name:"Citibank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/HSBC":{tags:{name:"HSBC",amenity:"bank"},name:"HSBC",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Barclays":{tags:{name:"Barclays",amenity:"bank"},name:"Barclays",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Westpac":{tags:{name:"Westpac",amenity:"bank"},name:"Westpac",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/NAB":{tags:{name:"NAB",amenity:"bank"},name:"NAB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ANZ":{tags:{name:"ANZ",amenity:"bank"},name:"ANZ",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Lloyds Bank":{tags:{name:"Lloyds Bank",amenity:"bank"},name:"Lloyds Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Landbank":{tags:{name:"Landbank",amenity:"bank"},name:"Landbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Sparkasse":{tags:{name:"Sparkasse",amenity:"bank"},name:"Sparkasse",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/UCPB":{tags:{name:"UCPB",amenity:"bank"},name:"UCPB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/PNB":{tags:{name:"PNB",amenity:"bank"},name:"PNB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Metrobank":{tags:{name:"Metrobank",amenity:"bank"},name:"Metrobank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BDO":{tags:{name:"BDO",amenity:"bank"},name:"BDO",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Volksbank":{tags:{name:"Volksbank",amenity:"bank"},name:"Volksbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BPI":{tags:{name:"BPI",amenity:"bank"},name:"BPI",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Postbank":{tags:{name:"Postbank",amenity:"bank"},name:"Postbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/NatWest":{tags:{name:"NatWest",amenity:"bank"},name:"NatWest",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Raiffeisenbank":{tags:{name:"Raiffeisenbank",amenity:"bank"},name:"Raiffeisenbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Yorkshire Bank":{tags:{name:"Yorkshire Bank",amenity:"bank"},name:"Yorkshire Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ABSA":{tags:{name:"ABSA",amenity:"bank"},name:"ABSA",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Standard Bank":{tags:{name:"Standard Bank",amenity:"bank"},name:"Standard Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/FNB":{tags:{name:"FNB",amenity:"bank"},name:"FNB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Deutsche Bank":{tags:{name:"Deutsche Bank",amenity:"bank"},name:"Deutsche Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/SEB":{tags:{name:"SEB",amenity:"bank"},name:"SEB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Commerzbank":{tags:{name:"Commerzbank",amenity:"bank"},name:"Commerzbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Targobank":{tags:{name:"Targobank",amenity:"bank"},name:"Targobank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ABN AMRO":{tags:{name:"ABN AMRO",amenity:"bank"},name:"ABN AMRO",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Handelsbanken":{tags:{name:"Handelsbanken",amenity:"bank"},name:"Handelsbanken",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Swedbank":{tags:{name:"Swedbank",amenity:"bank"},name:"Swedbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Kreissparkasse":{tags:{name:"Kreissparkasse",amenity:"bank"},name:"Kreissparkasse",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/UniCredit Bank":{tags:{name:"UniCredit Bank",amenity:"bank"},name:"UniCredit Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Monte dei Paschi di Siena":{tags:{name:"Monte dei Paschi di Siena",amenity:"bank"},name:"Monte dei Paschi di Siena",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Caja Rural":{tags:{name:"Caja Rural",amenity:"bank"},name:"Caja Rural",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Dresdner Bank":{tags:{name:"Dresdner Bank",amenity:"bank"},name:"Dresdner Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Sparda-Bank":{tags:{name:"Sparda-Bank",amenity:"bank"},name:"Sparda-Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/VÚB":{tags:{name:"V\xDAB",amenity:"bank"},name:"V\xDAB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Slovenská sporiteľňa":{tags:{name:"Slovensk\xE1 sporite\u013E\u0148a",amenity:"bank"},name:"Slovensk\xE1 sporite\u013E\u0148a",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bank of Montreal":{tags:{name:"Bank of Montreal",amenity:"bank"},name:"Bank of Montreal",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/KBC":{tags:{name:"KBC",amenity:"bank"},name:"KBC",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Royal Bank of Scotland":{tags:{name:"Royal Bank of Scotland",amenity:"bank"},name:"Royal Bank of Scotland",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/TSB":{tags:{name:"TSB",amenity:"bank"},name:"TSB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/US Bank":{tags:{name:"US Bank",amenity:"bank"},name:"US Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/HypoVereinsbank":{tags:{name:"HypoVereinsbank",amenity:"bank"},name:"HypoVereinsbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bank Austria":{tags:{name:"Bank Austria",amenity:"bank"},name:"Bank Austria",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ING":{tags:{name:"ING",amenity:"bank"},name:"ING",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Erste Bank":{tags:{name:"Erste Bank",amenity:"bank"},name:"Erste Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/CIBC":{tags:{name:"CIBC",amenity:"bank"},name:"CIBC",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Scotiabank":{tags:{name:"Scotiabank",amenity:"bank"},name:"Scotiabank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Caisse d'Épargne":{tags:{name:"Caisse d'\xC9pargne",amenity:"bank"},name:"Caisse d'\xC9pargne",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Santander":{tags:{name:"Santander",amenity:"bank"},name:"Santander",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bank of Scotland":{tags:{name:"Bank of Scotland",amenity:"bank"},name:"Bank of Scotland",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/TD Canada Trust":{tags:{name:"TD Canada Trust",amenity:"bank"},name:"TD Canada Trust",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BMO":{tags:{name:"BMO",amenity:"bank"},name:"BMO",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Danske Bank":{tags:{name:"Danske Bank",amenity:"bank"},name:"Danske Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/OTP":{tags:{name:"OTP",amenity:"bank"},name:"OTP",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Crédit Agricole":{tags:{name:"Cr\xE9dit Agricole",amenity:"bank"},name:"Cr\xE9dit Agricole",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/LCL":{tags:{name:"LCL",amenity:"bank"},name:"LCL",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/VR-Bank":{tags:{name:"VR-Bank",amenity:"bank"},name:"VR-Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ČSOB":{tags:{name:"\u010CSOB",amenity:"bank"},name:"\u010CSOB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Česká spořitelna":{tags:{name:"\u010Cesk\xE1 spo\u0159itelna",amenity:"bank"},name:"\u010Cesk\xE1 spo\u0159itelna",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BNP":{tags:{name:"BNP",amenity:"bank"},name:"BNP",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Royal Bank":{tags:{name:"Royal Bank",amenity:"bank"},name:"Royal Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Nationwide":{tags:{name:"Nationwide",amenity:"bank"},name:"Nationwide",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Halifax":{tags:{name:"Halifax",amenity:"bank"},name:"Halifax",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BAWAG PSK":{tags:{name:"BAWAG PSK",amenity:"bank"},name:"BAWAG PSK",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/National Bank":{tags:{name:"National Bank",amenity:"bank"},name:"National Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Nedbank":{tags:{name:"Nedbank",amenity:"bank"},name:"Nedbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/First National Bank":{tags:{name:"First National Bank",amenity:"bank"},name:"First National Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Nordea":{tags:{name:"Nordea",amenity:"bank"},name:"Nordea",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Rabobank":{tags:{name:"Rabobank",amenity:"bank"},name:"Rabobank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Sparkasse KölnBonn":{tags:{name:"Sparkasse K\xF6lnBonn",amenity:"bank"},name:"Sparkasse K\xF6lnBonn",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Tatra banka":{tags:{name:"Tatra banka",amenity:"bank"},name:"Tatra banka",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Berliner Sparkasse":{tags:{name:"Berliner Sparkasse",amenity:"bank"},name:"Berliner Sparkasse",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Berliner Volksbank":{tags:{name:"Berliner Volksbank",amenity:"bank"},name:"Berliner Volksbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Wells Fargo":{tags:{name:"Wells Fargo",amenity:"bank"},name:"Wells Fargo",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Credit Suisse":{tags:{name:"Credit Suisse",amenity:"bank"},name:"Credit Suisse",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Société Générale":{tags:{name:"Soci\xE9t\xE9 G\xE9n\xE9rale",amenity:"bank"},name:"Soci\xE9t\xE9 G\xE9n\xE9rale",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Osuuspankki":{tags:{name:"Osuuspankki",amenity:"bank"},name:"Osuuspankki",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Sparkasse Aachen":{tags:{name:"Sparkasse Aachen",amenity:"bank"},name:"Sparkasse Aachen",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Hamburger Sparkasse":{tags:{name:"Hamburger Sparkasse",amenity:"bank"},name:"Hamburger Sparkasse",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Cassa di Risparmio del Veneto":{tags:{name:"Cassa di Risparmio del Veneto",amenity:"bank"},name:"Cassa di Risparmio del Veneto",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BNP Paribas":{tags:{name:"BNP Paribas",amenity:"bank"},name:"BNP Paribas",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banque Populaire":{tags:{name:"Banque Populaire",amenity:"bank"},name:"Banque Populaire",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BNP Paribas Fortis":{tags:{name:"BNP Paribas Fortis",amenity:"bank"},name:"BNP Paribas Fortis",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco Popular":{tags:{name:"Banco Popular",amenity:"bank"},name:"Banco Popular",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bancaja":{tags:{name:"Bancaja",amenity:"bank"},name:"Bancaja",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banesto":{tags:{name:"Banesto",amenity:"bank"},name:"Banesto",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/La Caixa":{tags:{name:"La Caixa",amenity:"bank"},name:"La Caixa",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Santander Consumer Bank":{tags:{name:"Santander Consumer Bank",amenity:"bank"},name:"Santander Consumer Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BRD":{tags:{name:"BRD",amenity:"bank"},name:"BRD",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BCR":{tags:{name:"BCR",amenity:"bank"},name:"BCR",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banca Transilvania":{tags:{name:"Banca Transilvania",amenity:"bank"},name:"Banca Transilvania",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BW-Bank":{tags:{name:"BW-Bank",amenity:"bank"},name:"BW-Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Komerční banka":{tags:{name:"Komer\u010Dn\xED banka",amenity:"bank"},name:"Komer\u010Dn\xED banka",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco Pastor":{tags:{name:"Banco Pastor",amenity:"bank"},name:"Banco Pastor",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Stadtsparkasse":{tags:{name:"Stadtsparkasse",amenity:"bank"},name:"Stadtsparkasse",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Ulster Bank":{tags:{name:"Ulster Bank",amenity:"bank"},name:"Ulster Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Sberbank":{tags:{name:"Sberbank",amenity:"bank"},name:"Sberbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/CIC":{tags:{name:"CIC",amenity:"bank"},name:"CIC",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bancpost":{tags:{name:"Bancpost",amenity:"bank"},name:"Bancpost",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Caja Madrid":{tags:{name:"Caja Madrid",amenity:"bank"},name:"Caja Madrid",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Maybank":{tags:{name:"Maybank",amenity:"bank"},name:"Maybank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/中国银行":{tags:{name:"\u4E2D\u56FD\u94F6\u884C",amenity:"bank"},name:"\u4E2D\u56FD\u94F6\u884C",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Unicredit Banca":{tags:{name:"Unicredit Banca",amenity:"bank"},name:"Unicredit Banca",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Crédit Mutuel":{tags:{name:"Cr\xE9dit Mutuel",amenity:"bank"},name:"Cr\xE9dit Mutuel",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BBVA":{tags:{name:"BBVA",amenity:"bank"},name:"BBVA",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Intesa San Paolo":{tags:{name:"Intesa San Paolo",amenity:"bank"},name:"Intesa San Paolo",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/TD Bank":{tags:{name:"TD Bank",amenity:"bank"},name:"TD Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Belfius":{tags:{name:"Belfius",amenity:"bank"},name:"Belfius",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bank of America":{tags:{name:"Bank of America",amenity:"bank"},name:"Bank of America",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/RBC":{tags:{name:"RBC",amenity:"bank"},name:"RBC",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Alpha Bank":{tags:{name:"Alpha Bank",amenity:"bank"},name:"Alpha Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Сбербанк":{tags:{name:"\u0421\u0431\u0435\u0440\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u0421\u0431\u0435\u0440\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Россельхозбанк":{tags:{name:"\u0420\u043E\u0441\u0441\u0435\u043B\u044C\u0445\u043E\u0437\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u0420\u043E\u0441\u0441\u0435\u043B\u044C\u0445\u043E\u0437\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Crédit du Nord":{tags:{name:"Cr\xE9dit du Nord",amenity:"bank"},name:"Cr\xE9dit du Nord",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BancoEstado":{tags:{name:"BancoEstado",amenity:"bank"},name:"BancoEstado",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Millennium Bank":{tags:{name:"Millennium Bank",amenity:"bank"},name:"Millennium Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/State Bank of India":{tags:{name:"State Bank of India",amenity:"bank"},name:"State Bank of India",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Беларусбанк":{tags:{name:"\u0411\u0435\u043B\u0430\u0440\u0443\u0441\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u0411\u0435\u043B\u0430\u0440\u0443\u0441\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ING Bank Śląski":{tags:{name:"ING Bank \u015Al\u0105ski",amenity:"bank"},name:"ING Bank \u015Al\u0105ski",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Caixa Geral de Depósitos":{tags:{name:"Caixa Geral de Dep\xF3sitos",amenity:"bank"},name:"Caixa Geral de Dep\xF3sitos",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Kreissparkasse Köln":{tags:{name:"Kreissparkasse K\xF6ln",amenity:"bank"},name:"Kreissparkasse K\xF6ln",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco BCI":{tags:{name:"Banco BCI",amenity:"bank"},name:"Banco BCI",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco de Chile":{tags:{name:"Banco de Chile",amenity:"bank"},name:"Banco de Chile",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ВТБ24":{tags:{name:"\u0412\u0422\u041124",amenity:"bank"},name:"\u0412\u0422\u041124",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/UBS":{tags:{name:"UBS",amenity:"bank"},name:"UBS",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/PKO BP":{tags:{name:"PKO BP",amenity:"bank"},name:"PKO BP",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Chinabank":{tags:{name:"Chinabank",amenity:"bank"},name:"Chinabank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/PSBank":{tags:{name:"PSBank",amenity:"bank"},name:"PSBank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Union Bank":{tags:{name:"Union Bank",amenity:"bank"},name:"Union Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/China Bank":{tags:{name:"China Bank",amenity:"bank"},name:"China Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/RCBC":{tags:{name:"RCBC",amenity:"bank"},name:"RCBC",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Unicaja":{tags:{name:"Unicaja",amenity:"bank"},name:"Unicaja",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BBK":{tags:{name:"BBK",amenity:"bank"},name:"BBK",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Ibercaja":{tags:{name:"Ibercaja",amenity:"bank"},name:"Ibercaja",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/RBS":{tags:{name:"RBS",amenity:"bank"},name:"RBS",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Commercial Bank of Ceylon PLC":{tags:{name:"Commercial Bank of Ceylon PLC",amenity:"bank"},name:"Commercial Bank of Ceylon PLC",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bank of Ireland":{tags:{name:"Bank of Ireland",amenity:"bank"},name:"Bank of Ireland",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BNL":{tags:{name:"BNL",amenity:"bank"},name:"BNL",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco Santander":{tags:{name:"Banco Santander",amenity:"bank"},name:"Banco Santander",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco Itaú":{tags:{name:"Banco Ita\xFA",amenity:"bank"},name:"Banco Ita\xFA",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/AIB":{tags:{name:"AIB",amenity:"bank"},name:"AIB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BZ WBK":{tags:{name:"BZ WBK",amenity:"bank"},name:"BZ WBK",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco do Brasil":{tags:{name:"Banco do Brasil",amenity:"bank"},name:"Banco do Brasil",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Caixa Econômica Federal":{tags:{name:"Caixa Econ\xF4mica Federal",amenity:"bank"},name:"Caixa Econ\xF4mica Federal",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Fifth Third Bank":{tags:{name:"Fifth Third Bank",amenity:"bank"},name:"Fifth Third Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banca Popolare di Vicenza":{tags:{name:"Banca Popolare di Vicenza",amenity:"bank"},name:"Banca Popolare di Vicenza",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Wachovia":{tags:{name:"Wachovia",amenity:"bank"},name:"Wachovia",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/OLB":{tags:{name:"OLB",amenity:"bank"},name:"OLB",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/みずほ銀行":{tags:{name:"\u307F\u305A\u307B\u9280\u884C",amenity:"bank"},name:"\u307F\u305A\u307B\u9280\u884C",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BES":{tags:{name:"BES",amenity:"bank"},name:"BES",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ICICI Bank":{tags:{name:"ICICI Bank",amenity:"bank"},name:"ICICI Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/HDFC Bank":{tags:{name:"HDFC Bank",amenity:"bank"},name:"HDFC Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/La Banque Postale":{tags:{name:"La Banque Postale",amenity:"bank"},name:"La Banque Postale",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Pekao SA":{tags:{name:"Pekao SA",amenity:"bank"},name:"Pekao SA",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Oberbank":{tags:{name:"Oberbank",amenity:"bank"},name:"Oberbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bradesco":{tags:{name:"Bradesco",amenity:"bank"},name:"Bradesco",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Oldenburgische Landesbank":{tags:{name:"Oldenburgische Landesbank",amenity:"bank"},name:"Oldenburgische Landesbank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bendigo Bank":{tags:{name:"Bendigo Bank",amenity:"bank"},name:"Bendigo Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Argenta":{tags:{name:"Argenta",amenity:"bank"},name:"Argenta",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/AXA":{tags:{name:"AXA",amenity:"bank"},name:"AXA",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Axis Bank":{tags:{name:"Axis Bank",amenity:"bank"},name:"Axis Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco Nación":{tags:{name:"Banco Naci\xF3n",amenity:"bank"},name:"Banco Naci\xF3n",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/GE Money Bank":{tags:{name:"GE Money Bank",amenity:"bank"},name:"GE Money Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Альфа-Банк":{tags:{name:"\u0410\u043B\u044C\u0444\u0430-\u0411\u0430\u043D\u043A",amenity:"bank"},name:"\u0410\u043B\u044C\u0444\u0430-\u0411\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Белагропромбанк":{tags:{name:"\u0411\u0435\u043B\u0430\u0433\u0440\u043E\u043F\u0440\u043E\u043C\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u0411\u0435\u043B\u0430\u0433\u0440\u043E\u043F\u0440\u043E\u043C\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Caja Círculo":{tags:{name:"Caja C\xEDrculo",amenity:"bank"},name:"Caja C\xEDrculo",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco Galicia":{tags:{name:"Banco Galicia",amenity:"bank"},name:"Banco Galicia",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Eurobank":{tags:{name:"Eurobank",amenity:"bank"},name:"Eurobank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banca Intesa":{tags:{name:"Banca Intesa",amenity:"bank"},name:"Banca Intesa",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Canara Bank":{tags:{name:"Canara Bank",amenity:"bank"},name:"Canara Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Cajamar":{tags:{name:"Cajamar",amenity:"bank"},name:"Cajamar",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banamex":{tags:{name:"Banamex",amenity:"bank"},name:"Banamex",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Crédit Mutuel de Bretagne":{tags:{name:"Cr\xE9dit Mutuel de Bretagne",amenity:"bank"},name:"Cr\xE9dit Mutuel de Bretagne",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Davivienda":{tags:{name:"Davivienda",amenity:"bank"},name:"Davivienda",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bank Spółdzielczy":{tags:{name:"Bank Sp\xF3\u0142dzielczy",amenity:"bank"},name:"Bank Sp\xF3\u0142dzielczy",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Credit Agricole":{tags:{name:"Credit Agricole",amenity:"bank"},name:"Credit Agricole",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bankinter":{tags:{name:"Bankinter",amenity:"bank"},name:"Bankinter",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banque Nationale":{tags:{name:"Banque Nationale",amenity:"bank"},name:"Banque Nationale",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bank of the West":{tags:{name:"Bank of the West",amenity:"bank"},name:"Bank of the West",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Key Bank":{tags:{name:"Key Bank",amenity:"bank"},name:"Key Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Western Union":{tags:{name:"Western Union",amenity:"bank"},name:"Western Union",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Citizens Bank":{tags:{name:"Citizens Bank",amenity:"bank"},name:"Citizens Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ПриватБанк":{tags:{name:"\u041F\u0440\u0438\u0432\u0430\u0442\u0411\u0430\u043D\u043A",amenity:"bank"},name:"\u041F\u0440\u0438\u0432\u0430\u0442\u0411\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Security Bank":{tags:{name:"Security Bank",amenity:"bank"},name:"Security Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Millenium Bank":{tags:{name:"Millenium Bank",amenity:"bank"},name:"Millenium Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bankia":{tags:{name:"Bankia",amenity:"bank"},name:"Bankia",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/三菱東京UFJ銀行":{tags:{name:"\u4E09\u83F1\u6771\u4EACUFJ\u9280\u884C",amenity:"bank"},name:"\u4E09\u83F1\u6771\u4EACUFJ\u9280\u884C",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Caixa":{tags:{name:"Caixa",amenity:"bank"},name:"Caixa",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco de Costa Rica":{tags:{name:"Banco de Costa Rica",amenity:"bank"},name:"Banco de Costa Rica",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/SunTrust Bank":{tags:{name:"SunTrust Bank",amenity:"bank"},name:"SunTrust Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Itaú":{tags:{name:"Ita\xFA",amenity:"bank"},name:"Ita\xFA",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/PBZ":{tags:{name:"PBZ",amenity:"bank"},name:"PBZ",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/中国工商银行":{tags:{name:"\u4E2D\u56FD\u5DE5\u5546\u94F6\u884C",amenity:"bank"},name:"\u4E2D\u56FD\u5DE5\u5546\u94F6\u884C",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bancolombia":{tags:{name:"Bancolombia",amenity:"bank"},name:"Bancolombia",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Райффайзен Банк Аваль":{tags:{name:"\u0420\u0430\u0439\u0444\u0444\u0430\u0439\u0437\u0435\u043D \u0411\u0430\u043D\u043A \u0410\u0432\u0430\u043B\u044C",amenity:"bank"},name:"\u0420\u0430\u0439\u0444\u0444\u0430\u0439\u0437\u0435\u043D \u0411\u0430\u043D\u043A \u0410\u0432\u0430\u043B\u044C",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bancomer":{tags:{name:"Bancomer",amenity:"bank"},name:"Bancomer",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banorte":{tags:{name:"Banorte",amenity:"bank"},name:"Banorte",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Alior Bank":{tags:{name:"Alior Bank",amenity:"bank"},name:"Alior Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BOC":{tags:{name:"BOC",amenity:"bank"},name:"BOC",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Банк Москвы":{tags:{name:"\u0411\u0430\u043D\u043A \u041C\u043E\u0441\u043A\u0432\u044B",amenity:"bank"},name:"\u0411\u0430\u043D\u043A \u041C\u043E\u0441\u043A\u0432\u044B",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ВТБ":{tags:{name:"\u0412\u0422\u0411",amenity:"bank"},name:"\u0412\u0422\u0411",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Getin Bank":{tags:{name:"Getin Bank",amenity:"bank"},name:"Getin Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Caja Duero":{tags:{name:"Caja Duero",amenity:"bank"},name:"Caja Duero",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Regions Bank":{tags:{name:"Regions Bank",amenity:"bank"},name:"Regions Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Росбанк":{tags:{name:"\u0420\u043E\u0441\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u0420\u043E\u0441\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco Estado":{tags:{name:"Banco Estado",amenity:"bank"},name:"Banco Estado",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BCI":{tags:{name:"BCI",amenity:"bank"},name:"BCI",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/SunTrust":{tags:{name:"SunTrust",amenity:"bank"},name:"SunTrust",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/PNC Bank":{tags:{name:"PNC Bank",amenity:"bank"},name:"PNC Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/신한은행":{tags:{name:"\uC2E0\uD55C\uC740\uD589","name:en":"Sinhan Bank",amenity:"bank"},name:"\uC2E0\uD55C\uC740\uD589",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/우리은행":{tags:{name:"\uC6B0\uB9AC\uC740\uD589","name:en":"Uri Bank",amenity:"bank"},name:"\uC6B0\uB9AC\uC740\uD589",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/국민은행":{tags:{name:"\uAD6D\uBBFC\uC740\uD589","name:en":"Gungmin Bank",amenity:"bank"},name:"\uAD6D\uBBFC\uC740\uD589",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/중소기업은행":{tags:{name:"\uC911\uC18C\uAE30\uC5C5\uC740\uD589","name:en":"Industrial Bank of Korea",amenity:"bank"},name:"\uC911\uC18C\uAE30\uC5C5\uC740\uD589",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/광주은행":{tags:{name:"\uAD11\uC8FC\uC740\uD589","name:en":"Gwangju Bank",amenity:"bank"},name:"\uAD11\uC8FC\uC740\uD589",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Газпромбанк":{tags:{name:"\u0413\u0430\u0437\u043F\u0440\u043E\u043C\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u0413\u0430\u0437\u043F\u0440\u043E\u043C\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/M&T Bank":{tags:{name:"M&T Bank",amenity:"bank"},name:"M&T Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Caja de Burgos":{tags:{name:"Caja de Burgos",amenity:"bank"},name:"Caja de Burgos",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Santander Totta":{tags:{name:"Santander Totta",amenity:"bank"},name:"Santander Totta",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/УкрСиббанк":{tags:{name:"\u0423\u043A\u0440\u0421\u0438\u0431\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u0423\u043A\u0440\u0421\u0438\u0431\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Ощадбанк":{tags:{name:"\u041E\u0449\u0430\u0434\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u041E\u0449\u0430\u0434\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Уралсиб":{tags:{name:"\u0423\u0440\u0430\u043B\u0441\u0438\u0431",amenity:"bank"},name:"\u0423\u0440\u0430\u043B\u0441\u0438\u0431",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/りそな銀行":{tags:{name:"\u308A\u305D\u306A\u9280\u884C","name:en":"Mizuho Bank",amenity:"bank"},name:"\u308A\u305D\u306A\u9280\u884C",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Ecobank":{tags:{name:"Ecobank",amenity:"bank"},name:"Ecobank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Cajero Automatico Bancared":{tags:{name:"Cajero Automatico Bancared",amenity:"bank"},name:"Cajero Automatico Bancared",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Промсвязьбанк":{tags:{name:"\u041F\u0440\u043E\u043C\u0441\u0432\u044F\u0437\u044C\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u041F\u0440\u043E\u043C\u0441\u0432\u044F\u0437\u044C\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/三井住友銀行":{tags:{name:"\u4E09\u4E95\u4F4F\u53CB\u9280\u884C",amenity:"bank"},name:"\u4E09\u4E95\u4F4F\u53CB\u9280\u884C",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco Provincia":{tags:{name:"Banco Provincia",amenity:"bank"},name:"Banco Provincia",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/BB&T":{tags:{name:"BB&T",amenity:"bank"},name:"BB&T",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Возрождение":{tags:{name:"\u0412\u043E\u0437\u0440\u043E\u0436\u0434\u0435\u043D\u0438\u0435",amenity:"bank"},name:"\u0412\u043E\u0437\u0440\u043E\u0436\u0434\u0435\u043D\u0438\u0435",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Capital One":{tags:{name:"Capital One",amenity:"bank"},name:"Capital One",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/横浜銀行":{tags:{name:"\u6A2A\u6D5C\u9280\u884C",amenity:"bank"},name:"\u6A2A\u6D5C\u9280\u884C",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bank Mandiri":{tags:{name:"Bank Mandiri",amenity:"bank"},name:"Bank Mandiri",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco de la Nación":{tags:{name:"Banco de la Naci\xF3n",amenity:"bank"},name:"Banco de la Naci\xF3n",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco G&T Continental":{tags:{name:"Banco G&T Continental",amenity:"bank"},name:"Banco G&T Continental",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Peoples Bank":{tags:{name:"Peoples Bank",amenity:"bank"},name:"Peoples Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/工商银行":{tags:{name:"\u5DE5\u5546\u94F6\u884C",amenity:"bank"},name:"\u5DE5\u5546\u94F6\u884C",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Совкомбанк":{tags:{name:"\u0421\u043E\u0432\u043A\u043E\u043C\u0431\u0430\u043D\u043A",amenity:"bank"},name:"\u0421\u043E\u0432\u043A\u043E\u043C\u0431\u0430\u043D\u043A",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Provincial":{tags:{name:"Provincial",amenity:"bank"},name:"Provincial",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco de Desarrollo Banrural":{tags:{name:"Banco de Desarrollo Banrural",amenity:"bank"},name:"Banco de Desarrollo Banrural",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banco Bradesco":{tags:{name:"Banco Bradesco",amenity:"bank"},name:"Banco Bradesco",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bicentenario":{tags:{name:"Bicentenario",amenity:"bank"},name:"Bicentenario",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/ლიბერთი ბანკი":{tags:{name:"\u10DA\u10D8\u10D1\u10D4\u10E0\u10D7\u10D8 \u10D1\u10D0\u10DC\u10D9\u10D8","name:en":"Liberty Bank",amenity:"bank"},name:"\u10DA\u10D8\u10D1\u10D4\u10E0\u10D7\u10D8 \u10D1\u10D0\u10DC\u10D9\u10D8",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Banesco":{tags:{name:"Banesco",amenity:"bank"},name:"Banesco",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Mercantil":{tags:{name:"Mercantil",amenity:"bank"},name:"Mercantil",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Bank BRI":{tags:{name:"Bank BRI",amenity:"bank"},name:"Bank BRI",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/Del Tesoro":{tags:{name:"Del Tesoro",amenity:"bank"},name:"Del Tesoro",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/하나은행":{tags:{name:"\uD558\uB098\uC740\uD589",amenity:"bank"},name:"\uD558\uB098\uC740\uD589",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/CityCommerce Bank":{tags:{name:"CityCommerce Bank",amenity:"bank"},name:"CityCommerce Bank",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/bank/De Venezuela":{tags:{name:"De Venezuela",amenity:"bank"},name:"De Venezuela",icon:"bank",geometry:["point","vertex","area"],fields:["atm","building_area","address","opening_hours"],suggestion:true},"amenity/car_rental/Europcar":{tags:{name:"Europcar",amenity:"car_rental"},name:"Europcar",icon:"car",geometry:["point","area"],fields:["operator"],suggestion:true},"amenity/car_rental/Budget":{tags:{name:"Budget",amenity:"car_rental"},name:"Budget",icon:"car",geometry:["point","area"],fields:["operator"],suggestion:true},"amenity/car_rental/Sixt":{tags:{name:"Sixt",amenity:"car_rental"},name:"Sixt",icon:"car",geometry:["point","area"],fields:["operator"],suggestion:true},"amenity/car_rental/Avis":{tags:{name:"Avis",amenity:"car_rental"},name:"Avis",icon:"car",geometry:["point","area"],fields:["operator"],suggestion:true},"amenity/car_rental/Hertz":{tags:{name:"Hertz",amenity:"car_rental"},name:"Hertz",icon:"car",geometry:["point","area"],fields:["operator"],suggestion:true},"amenity/car_rental/Enterprise":{tags:{name:"Enterprise",amenity:"car_rental"},name:"Enterprise",icon:"car",geometry:["point","area"],fields:["operator"],suggestion:true},"amenity/car_rental/stadtmobil CarSharing-Station":{tags:{name:"stadtmobil CarSharing-Station",amenity:"car_rental"},name:"stadtmobil CarSharing-Station",icon:"car",geometry:["point","area"],fields:["operator"],suggestion:true},"amenity/pharmacy/Rowlands Pharmacy":{tags:{name:"Rowlands Pharmacy",amenity:"pharmacy"},name:"Rowlands Pharmacy",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Boots":{tags:{name:"Boots",amenity:"pharmacy"},name:"Boots",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Marien-Apotheke":{tags:{name:"Marien-Apotheke",amenity:"pharmacy"},name:"Marien-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Mercury Drug":{tags:{name:"Mercury Drug",amenity:"pharmacy"},name:"Mercury Drug",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Löwen-Apotheke":{tags:{name:"L\xF6wen-Apotheke",amenity:"pharmacy"},name:"L\xF6wen-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Superdrug":{tags:{name:"Superdrug",amenity:"pharmacy"},name:"Superdrug",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Sonnen-Apotheke":{tags:{name:"Sonnen-Apotheke",amenity:"pharmacy"},name:"Sonnen-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Rathaus-Apotheke":{tags:{name:"Rathaus-Apotheke",amenity:"pharmacy"},name:"Rathaus-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Engel-Apotheke":{tags:{name:"Engel-Apotheke",amenity:"pharmacy"},name:"Engel-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Hirsch-Apotheke":{tags:{name:"Hirsch-Apotheke",amenity:"pharmacy"},name:"Hirsch-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Stern-Apotheke":{tags:{name:"Stern-Apotheke",amenity:"pharmacy"},name:"Stern-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Lloyds Pharmacy":{tags:{name:"Lloyds Pharmacy",amenity:"pharmacy"},name:"Lloyds Pharmacy",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Rosen-Apotheke":{tags:{name:"Rosen-Apotheke",amenity:"pharmacy"},name:"Rosen-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Stadt-Apotheke":{tags:{name:"Stadt-Apotheke",amenity:"pharmacy"},name:"Stadt-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Markt-Apotheke":{tags:{name:"Markt-Apotheke",amenity:"pharmacy"},name:"Markt-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Аптека":{tags:{name:"\u0410\u043F\u0442\u0435\u043A\u0430",amenity:"pharmacy"},name:"\u0410\u043F\u0442\u0435\u043A\u0430",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Pharmasave":{tags:{name:"Pharmasave",amenity:"pharmacy"},name:"Pharmasave",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Brunnen-Apotheke":{tags:{name:"Brunnen-Apotheke",amenity:"pharmacy"},name:"Brunnen-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Shoppers Drug Mart":{tags:{name:"Shoppers Drug Mart",amenity:"pharmacy"},name:"Shoppers Drug Mart",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Apotheke am Markt":{tags:{name:"Apotheke am Markt",amenity:"pharmacy"},name:"Apotheke am Markt",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Alte Apotheke":{tags:{name:"Alte Apotheke",amenity:"pharmacy"},name:"Alte Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Neue Apotheke":{tags:{name:"Neue Apotheke",amenity:"pharmacy"},name:"Neue Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Gintarinė vaistinė":{tags:{name:"Gintarin\u0117 vaistin\u0117",amenity:"pharmacy"},name:"Gintarin\u0117 vaistin\u0117",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Rats-Apotheke":{tags:{name:"Rats-Apotheke",amenity:"pharmacy"},name:"Rats-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Adler Apotheke":{tags:{name:"Adler Apotheke",amenity:"pharmacy"},name:"Adler Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Pharmacie Centrale":{tags:{name:"Pharmacie Centrale",amenity:"pharmacy"},name:"Pharmacie Centrale",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Walgreens":{tags:{name:"Walgreens",amenity:"pharmacy"},name:"Walgreens",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Rite Aid":{tags:{name:"Rite Aid",amenity:"pharmacy"},name:"Rite Aid",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Apotheke":{tags:{name:"Apotheke",amenity:"pharmacy"},name:"Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Linden-Apotheke":{tags:{name:"Linden-Apotheke",amenity:"pharmacy"},name:"Linden-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Bahnhof-Apotheke":{tags:{name:"Bahnhof-Apotheke",amenity:"pharmacy"},name:"Bahnhof-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Burg-Apotheke":{tags:{name:"Burg-Apotheke",amenity:"pharmacy"},name:"Burg-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Jean Coutu":{tags:{name:"Jean Coutu",amenity:"pharmacy"},name:"Jean Coutu",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Pharmaprix":{tags:{name:"Pharmaprix",amenity:"pharmacy"},name:"Pharmaprix",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Farmacias Ahumada":{tags:{name:"Farmacias Ahumada",amenity:"pharmacy"},name:"Farmacias Ahumada",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Farmacia Comunale":{tags:{name:"Farmacia Comunale",amenity:"pharmacy"},name:"Farmacia Comunale",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Farmacias Cruz Verde":{tags:{name:"Farmacias Cruz Verde",amenity:"pharmacy"},name:"Farmacias Cruz Verde",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Cruz Verde":{tags:{name:"Cruz Verde",amenity:"pharmacy"},name:"Cruz Verde",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Hubertus Apotheke":{tags:{name:"Hubertus Apotheke",amenity:"pharmacy"},name:"Hubertus Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/CVS":{tags:{name:"CVS",amenity:"pharmacy"},name:"CVS",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Farmacias SalcoBrand":{tags:{name:"Farmacias SalcoBrand",amenity:"pharmacy"},name:"Farmacias SalcoBrand",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Фармация":{tags:{name:"\u0424\u0430\u0440\u043C\u0430\u0446\u0438\u044F",amenity:"pharmacy"},name:"\u0424\u0430\u0440\u043C\u0430\u0446\u0438\u044F",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Bären-Apotheke":{tags:{name:"B\xE4ren-Apotheke",amenity:"pharmacy"},name:"B\xE4ren-Apotheke",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Clicks":{tags:{name:"Clicks",amenity:"pharmacy"},name:"Clicks",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/セイジョー":{tags:{name:"\u30BB\u30A4\u30B8\u30E7\u30FC",amenity:"pharmacy"},name:"\u30BB\u30A4\u30B8\u30E7\u30FC",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/マツモトキヨシ":{tags:{name:"\u30DE\u30C4\u30E2\u30C8\u30AD\u30E8\u30B7",amenity:"pharmacy"},name:"\u30DE\u30C4\u30E2\u30C8\u30AD\u30E8\u30B7",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Dr. Max":{tags:{name:"Dr. Max",amenity:"pharmacy"},name:"Dr. Max",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Вита":{tags:{name:"\u0412\u0438\u0442\u0430",amenity:"pharmacy"},name:"\u0412\u0438\u0442\u0430",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/サンドラッグ":{tags:{name:"\u30B5\u30F3\u30C9\u30E9\u30C3\u30B0",amenity:"pharmacy"},name:"\u30B5\u30F3\u30C9\u30E9\u30C3\u30B0",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Apteka":{tags:{name:"Apteka",amenity:"pharmacy"},name:"Apteka",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Первая помощь":{tags:{name:"\u041F\u0435\u0440\u0432\u0430\u044F \u043F\u043E\u043C\u043E\u0449\u044C",amenity:"pharmacy"},name:"\u041F\u0435\u0440\u0432\u0430\u044F \u043F\u043E\u043C\u043E\u0449\u044C",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Ригла":{tags:{name:"\u0420\u0438\u0433\u043B\u0430",amenity:"pharmacy"},name:"\u0420\u0438\u0433\u043B\u0430",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Имплозия":{tags:{name:"\u0418\u043C\u043F\u043B\u043E\u0437\u0438\u044F",amenity:"pharmacy"},name:"\u0418\u043C\u043F\u043B\u043E\u0437\u0438\u044F",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Kinney Drugs":{tags:{name:"Kinney Drugs",amenity:"pharmacy"},name:"Kinney Drugs",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Классика":{tags:{name:"\u041A\u043B\u0430\u0441\u0441\u0438\u043A\u0430",amenity:"pharmacy"},name:"\u041A\u043B\u0430\u0441\u0441\u0438\u043A\u0430",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Ljekarna":{tags:{name:"Ljekarna",amenity:"pharmacy"},name:"Ljekarna",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/SalcoBrand":{tags:{name:"SalcoBrand",amenity:"pharmacy"},name:"SalcoBrand",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Аптека 36,6":{tags:{name:"\u0410\u043F\u0442\u0435\u043A\u0430 36,6",amenity:"pharmacy"},name:"\u0410\u043F\u0442\u0435\u043A\u0430 36,6",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Фармакор":{tags:{name:"\u0424\u0430\u0440\u043C\u0430\u043A\u043E\u0440",amenity:"pharmacy"},name:"\u0424\u0430\u0440\u043C\u0430\u043A\u043E\u0440",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/スギ薬局":{tags:{name:"\u30B9\u30AE\u85AC\u5C40",amenity:"pharmacy"},name:"\u30B9\u30AE\u85AC\u5C40",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Аптечный пункт":{tags:{name:"\u0410\u043F\u0442\u0435\u0447\u043D\u044B\u0439 \u043F\u0443\u043D\u043A\u0442",amenity:"pharmacy"},name:"\u0410\u043F\u0442\u0435\u0447\u043D\u044B\u0439 \u043F\u0443\u043D\u043A\u0442",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Невис":{tags:{name:"\u041D\u0435\u0432\u0438\u0441",amenity:"pharmacy"},name:"\u041D\u0435\u0432\u0438\u0441",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/トモズ (Tomod's)":{tags:{name:"\u30C8\u30E2\u30BA (Tomod's)",amenity:"pharmacy"},name:"\u30C8\u30E2\u30BA (Tomod's)",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Eurovaistinė":{tags:{name:"Eurovaistin\u0117",amenity:"pharmacy"},name:"Eurovaistin\u0117",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Farmacity":{tags:{name:"Farmacity",amenity:"pharmacy"},name:"Farmacity",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/аптека":{tags:{name:"\u0430\u043F\u0442\u0435\u043A\u0430",amenity:"pharmacy"},name:"\u0430\u043F\u0442\u0435\u043A\u0430",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/The Generics Pharmacy":{tags:{name:"The Generics Pharmacy",amenity:"pharmacy"},name:"The Generics Pharmacy",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Farmatodo":{tags:{name:"Farmatodo",amenity:"pharmacy"},name:"Farmatodo",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Duane Reade":{tags:{name:"Duane Reade",amenity:"pharmacy"},name:"Duane Reade",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Фармленд":{tags:{name:"\u0424\u0430\u0440\u043C\u043B\u0435\u043D\u0434",amenity:"pharmacy"},name:"\u0424\u0430\u0440\u043C\u043B\u0435\u043D\u0434",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/ドラッグてらしま (Drug Terashima)":{tags:{name:"\u30C9\u30E9\u30C3\u30B0\u3066\u3089\u3057\u307E (Drug Terashima)",amenity:"pharmacy"},name:"\u30C9\u30E9\u30C3\u30B0\u3066\u3089\u3057\u307E (Drug Terashima)",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Арніка":{tags:{name:"\u0410\u0440\u043D\u0456\u043A\u0430",amenity:"pharmacy"},name:"\u0410\u0440\u043D\u0456\u043A\u0430",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/ავერსი (Aversi)":{tags:{name:"\u10D0\u10D5\u10D4\u10E0\u10E1\u10D8 (Aversi)",amenity:"pharmacy"},name:"\u10D0\u10D5\u10D4\u10E0\u10E1\u10D8 (Aversi)",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/pharmacy/Farmahorro":{tags:{name:"Farmahorro",amenity:"pharmacy"},name:"Farmahorro",icon:"pharmacy",geometry:["point","vertex","area"],fields:["operator","building_area","address","opening_hours"],suggestion:true},"amenity/cafe/Starbucks":{tags:{name:"Starbucks",cuisine:"coffee_shop",amenity:"cafe"},name:"Starbucks",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Cafeteria":{tags:{name:"Cafeteria",amenity:"cafe"},name:"Cafeteria",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Costa":{tags:{name:"Costa",amenity:"cafe"},name:"Costa",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Caffè Nero":{tags:{name:"Caff\xE8 Nero",amenity:"cafe"},name:"Caff\xE8 Nero",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Кафе":{tags:{name:"\u041A\u0430\u0444\u0435",amenity:"cafe"},name:"\u041A\u0430\u0444\u0435",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Café Central":{tags:{name:"Caf\xE9 Central",amenity:"cafe"},name:"Caf\xE9 Central",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Second Cup":{tags:{name:"Second Cup",amenity:"cafe"},name:"Second Cup",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Eisdiele":{tags:{name:"Eisdiele",amenity:"cafe"},name:"Eisdiele",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Dunkin Donuts":{tags:{name:"Dunkin Donuts",cuisine:"donut",amenity:"cafe"},name:"Dunkin Donuts",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Espresso House":{tags:{name:"Espresso House",amenity:"cafe"},name:"Espresso House",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Segafredo":{tags:{name:"Segafredo",amenity:"cafe"},name:"Segafredo",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Coffee Time":{tags:{name:"Coffee Time",amenity:"cafe"},name:"Coffee Time",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Cafe Coffee Day":{tags:{name:"Cafe Coffee Day",amenity:"cafe"},name:"Cafe Coffee Day",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Eiscafe Venezia":{tags:{name:"Eiscafe Venezia",amenity:"cafe"},name:"Eiscafe Venezia",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/スターバックス":{tags:{name:"\u30B9\u30BF\u30FC\u30D0\u30C3\u30AF\u30B9","name:en":"Starbucks",amenity:"cafe"},name:"\u30B9\u30BF\u30FC\u30D0\u30C3\u30AF\u30B9",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Шоколадница":{tags:{name:"\u0428\u043E\u043A\u043E\u043B\u0430\u0434\u043D\u0438\u0446\u0430",amenity:"cafe"},name:"\u0428\u043E\u043A\u043E\u043B\u0430\u0434\u043D\u0438\u0446\u0430",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Pret A Manger":{tags:{name:"Pret A Manger",amenity:"cafe"},name:"Pret A Manger",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Столовая":{tags:{name:"\u0421\u0442\u043E\u043B\u043E\u0432\u0430\u044F",amenity:"cafe"},name:"\u0421\u0442\u043E\u043B\u043E\u0432\u0430\u044F",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/ドトール":{tags:{name:"\u30C9\u30C8\u30FC\u30EB","name:en":"DOUTOR",amenity:"cafe"},name:"\u30C9\u30C8\u30FC\u30EB",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Tchibo":{tags:{name:"Tchibo",amenity:"cafe"},name:"Tchibo",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Кофе Хауз":{tags:{name:"\u041A\u043E\u0444\u0435 \u0425\u0430\u0443\u0437",amenity:"cafe"},name:"\u041A\u043E\u0444\u0435 \u0425\u0430\u0443\u0437",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Caribou Coffee":{tags:{name:"Caribou Coffee",amenity:"cafe"},name:"Caribou Coffee",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Уют":{tags:{name:"\u0423\u044E\u0442",amenity:"cafe"},name:"\u0423\u044E\u0442",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Шашлычная":{tags:{name:"\u0428\u0430\u0448\u043B\u044B\u0447\u043D\u0430\u044F",amenity:"cafe"},name:"\u0428\u0430\u0448\u043B\u044B\u0447\u043D\u0430\u044F",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/คาเฟ่ อเมซอน":{tags:{name:"\u0E04\u0E32\u0E40\u0E1F\u0E48 \u0E2D\u0E40\u0E21\u0E0B\u0E2D\u0E19",amenity:"cafe"},name:"\u0E04\u0E32\u0E40\u0E1F\u0E48 \u0E2D\u0E40\u0E21\u0E0B\u0E2D\u0E19",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Traveler's Coffee":{tags:{name:"Traveler's Coffee",amenity:"cafe"},name:"Traveler's Coffee",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/カフェ・ド・クリエ":{tags:{name:"\u30AB\u30D5\u30A7\u30FB\u30C9\u30FB\u30AF\u30EA\u30A8","name:en":"Cafe de CRIE",amenity:"cafe"},name:"\u30AB\u30D5\u30A7\u30FB\u30C9\u30FB\u30AF\u30EA\u30A8",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"amenity/cafe/Cafe Amazon":{tags:{name:"Cafe Amazon",amenity:"cafe"},name:"Cafe Amazon",icon:"cafe",geometry:["point","vertex","area"],fields:["cuisine","internet_access","building_area","address","opening_hours","smoking"],suggestion:true},"shop/supermarket/Budgens":{tags:{name:"Budgens",shop:"supermarket"},name:"Budgens",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Morrisons":{tags:{name:"Morrisons",shop:"supermarket"},name:"Morrisons",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Interspar":{tags:{name:"Interspar",shop:"supermarket"},name:"Interspar",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Merkur":{tags:{name:"Merkur",shop:"supermarket"},name:"Merkur",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Sainsbury's":{tags:{name:"Sainsbury's",shop:"supermarket"},name:"Sainsbury's",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Lidl":{tags:{name:"Lidl",shop:"supermarket"},name:"Lidl",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/EDEKA":{tags:{name:"EDEKA",shop:"supermarket"},name:"EDEKA",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Coles":{tags:{name:"Coles",shop:"supermarket"},name:"Coles",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Iceland":{tags:{name:"Iceland",shop:"supermarket"},name:"Iceland",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Coop":{tags:{name:"Coop",shop:"supermarket"},name:"Coop",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Tesco":{tags:{name:"Tesco",shop:"supermarket"},name:"Tesco",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Woolworths":{tags:{name:"Woolworths",shop:"supermarket"},name:"Woolworths",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Zielpunkt":{tags:{name:"Zielpunkt",shop:"supermarket"},name:"Zielpunkt",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Nahkauf":{tags:{name:"Nahkauf",shop:"supermarket"},name:"Nahkauf",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Billa":{tags:{name:"Billa",shop:"supermarket"},name:"Billa",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Kaufland":{tags:{name:"Kaufland",shop:"supermarket"},name:"Kaufland",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Plus":{tags:{name:"Plus",shop:"supermarket"},name:"Plus",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/ALDI":{tags:{name:"ALDI",shop:"supermarket"},name:"ALDI",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Checkers":{tags:{name:"Checkers",shop:"supermarket"},name:"Checkers",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Tesco Metro":{tags:{name:"Tesco Metro",shop:"supermarket"},name:"Tesco Metro",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/NP":{tags:{name:"NP",shop:"supermarket"},name:"NP",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Penny":{tags:{name:"Penny",shop:"supermarket"},name:"Penny",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Norma":{tags:{name:"Norma",shop:"supermarket"},name:"Norma",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Asda":{tags:{name:"Asda",shop:"supermarket"},name:"Asda",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Netto":{tags:{name:"Netto",shop:"supermarket"},name:"Netto",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/REWE":{tags:{name:"REWE",shop:"supermarket"},name:"REWE",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Rewe":{tags:{name:"Rewe",shop:"supermarket"},name:"Rewe",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Aldi Süd":{tags:{name:"Aldi S\xFCd",shop:"supermarket"},name:"Aldi S\xFCd",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Real":{tags:{name:"Real",shop:"supermarket"},name:"Real",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/King Soopers":{tags:{name:"King Soopers",shop:"supermarket"},name:"King Soopers",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Kiwi":{tags:{name:"Kiwi",shop:"supermarket"},name:"Kiwi",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Edeka":{tags:{name:"Edeka",shop:"supermarket"},name:"Edeka",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Pick n Pay":{tags:{name:"Pick n Pay",shop:"supermarket"},name:"Pick n Pay",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/ICA":{tags:{name:"ICA",shop:"supermarket"},name:"ICA",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Tengelmann":{tags:{name:"Tengelmann",shop:"supermarket"},name:"Tengelmann",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Carrefour":{tags:{name:"Carrefour",shop:"supermarket"},name:"Carrefour",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Waitrose":{tags:{name:"Waitrose",shop:"supermarket"},name:"Waitrose",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Spar":{tags:{name:"Spar",shop:"supermarket"},name:"Spar",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Hofer":{tags:{name:"Hofer",shop:"supermarket"},name:"Hofer",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/M-Preis":{tags:{name:"M-Preis",shop:"supermarket"},name:"M-Preis",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/LIDL":{tags:{name:"LIDL",shop:"supermarket"},name:"LIDL",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/tegut":{tags:{name:"tegut",shop:"supermarket"},name:"tegut",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Sainsbury's Local":{tags:{name:"Sainsbury's Local",shop:"supermarket"},name:"Sainsbury's Local",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/E-Center":{tags:{name:"E-Center",shop:"supermarket"},name:"E-Center",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Aldi Nord":{tags:{name:"Aldi Nord",shop:"supermarket"},name:"Aldi Nord",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/nahkauf":{tags:{name:"nahkauf",shop:"supermarket"},name:"nahkauf",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Meijer":{tags:{name:"Meijer",shop:"supermarket"},name:"Meijer",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Safeway":{tags:{name:"Safeway",shop:"supermarket"},name:"Safeway",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Costco":{tags:{name:"Costco",shop:"supermarket"},name:"Costco",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Albert":{tags:{name:"Albert",shop:"supermarket"},name:"Albert",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Jumbo":{tags:{name:"Jumbo",shop:"supermarket"},name:"Jumbo",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Shoprite":{tags:{name:"Shoprite",shop:"supermarket"},name:"Shoprite",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/MPreis":{tags:{name:"MPreis",shop:"supermarket"},name:"MPreis",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Penny Market":{tags:{name:"Penny Market",shop:"supermarket"},name:"Penny Market",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Tesco Extra":{tags:{name:"Tesco Extra",shop:"supermarket"},name:"Tesco Extra",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Albert Heijn":{tags:{name:"Albert Heijn",shop:"supermarket"},name:"Albert Heijn",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/IGA":{tags:{name:"IGA",shop:"supermarket"},name:"IGA",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Super U":{tags:{name:"Super U",shop:"supermarket"},name:"Super U",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Metro":{tags:{name:"Metro",shop:"supermarket"},name:"Metro",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Neukauf":{tags:{name:"Neukauf",shop:"supermarket"},name:"Neukauf",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Migros":{tags:{name:"Migros",shop:"supermarket"},name:"Migros",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Marktkauf":{tags:{name:"Marktkauf",shop:"supermarket"},name:"Marktkauf",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Delikatesy Centrum":{tags:{name:"Delikatesy Centrum",shop:"supermarket"},name:"Delikatesy Centrum",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/C1000":{tags:{name:"C1000",shop:"supermarket"},name:"C1000",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Hoogvliet":{tags:{name:"Hoogvliet",shop:"supermarket"},name:"Hoogvliet",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/COOP":{tags:{name:"COOP",shop:"supermarket"},name:"COOP",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Food Basics":{tags:{name:"Food Basics",shop:"supermarket"},name:"Food Basics",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Casino":{tags:{name:"Casino",shop:"supermarket"},name:"Casino",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Penny Markt":{tags:{name:"Penny Markt",shop:"supermarket"},name:"Penny Markt",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Giant":{tags:{name:"Giant",shop:"supermarket"},name:"Giant",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Rema 1000":{tags:{name:"Rema 1000",shop:"supermarket"},name:"Rema 1000",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Kaufpark":{tags:{name:"Kaufpark",shop:"supermarket"},name:"Kaufpark",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/ALDI SÜD":{tags:{name:"ALDI S\xDCD",shop:"supermarket"},name:"ALDI S\xDCD",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Simply Market":{tags:{name:"Simply Market",shop:"supermarket"},name:"Simply Market",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Konzum":{tags:{name:"Konzum",shop:"supermarket"},name:"Konzum",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Carrefour Express":{tags:{name:"Carrefour Express",shop:"supermarket"},name:"Carrefour Express",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Eurospar":{tags:{name:"Eurospar",shop:"supermarket"},name:"Eurospar",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Mercator":{tags:{name:"Mercator",shop:"supermarket"},name:"Mercator",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Famila":{tags:{name:"Famila",shop:"supermarket"},name:"Famila",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Hemköp":{tags:{name:"Hemk\xF6p",shop:"supermarket"},name:"Hemk\xF6p",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/real,-":{tags:{name:"real,-",shop:"supermarket"},name:"real,-",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Markant":{tags:{name:"Markant",shop:"supermarket"},name:"Markant",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Volg":{tags:{name:"Volg",shop:"supermarket"},name:"Volg",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Leader Price":{tags:{name:"Leader Price",shop:"supermarket"},name:"Leader Price",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Treff 3000":{tags:{name:"Treff 3000",shop:"supermarket"},name:"Treff 3000",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/SuperBrugsen":{tags:{name:"SuperBrugsen",shop:"supermarket"},name:"SuperBrugsen",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Kaiser's":{tags:{name:"Kaiser's",shop:"supermarket"},name:"Kaiser's",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/K+K":{tags:{name:"K+K",shop:"supermarket"},name:"K+K",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Unimarkt":{tags:{name:"Unimarkt",shop:"supermarket"},name:"Unimarkt",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Carrefour City":{tags:{name:"Carrefour City",shop:"supermarket"},name:"Carrefour City",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Sobeys":{tags:{name:"Sobeys",shop:"supermarket"},name:"Sobeys",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/S-Market":{tags:{name:"S-Market",shop:"supermarket"},name:"S-Market",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Combi":{tags:{name:"Combi",shop:"supermarket"},name:"Combi",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Denner":{tags:{name:"Denner",shop:"supermarket"},name:"Denner",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Konsum":{tags:{name:"Konsum",shop:"supermarket"},name:"Konsum",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Franprix":{tags:{name:"Franprix",shop:"supermarket"},name:"Franprix",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Monoprix":{tags:{name:"Monoprix",shop:"supermarket"},name:"Monoprix",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Diska":{tags:{name:"Diska",shop:"supermarket"},name:"Diska",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/PENNY":{tags:{name:"PENNY",shop:"supermarket"},name:"PENNY",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Dia":{tags:{name:"Dia",shop:"supermarket"},name:"Dia",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Giant Eagle":{tags:{name:"Giant Eagle",shop:"supermarket"},name:"Giant Eagle",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/NORMA":{tags:{name:"NORMA",shop:"supermarket"},name:"NORMA",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/AD Delhaize":{tags:{name:"AD Delhaize",shop:"supermarket"},name:"AD Delhaize",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Auchan":{tags:{name:"Auchan",shop:"supermarket"},name:"Auchan",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Mercadona":{tags:{name:"Mercadona",shop:"supermarket"},name:"Mercadona",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Consum":{tags:{name:"Consum",shop:"supermarket"},name:"Consum",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Carrefour Market":{tags:{name:"Carrefour Market",shop:"supermarket"},name:"Carrefour Market",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Whole Foods":{tags:{name:"Whole Foods",shop:"supermarket"},name:"Whole Foods",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Pam":{tags:{name:"Pam",shop:"supermarket"},name:"Pam",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/sky":{tags:{name:"sky",shop:"supermarket"},name:"sky",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Despar":{tags:{name:"Despar",shop:"supermarket"},name:"Despar",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Eroski":{tags:{name:"Eroski",shop:"supermarket"},name:"Eroski",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Maxi":{tags:{name:"Maxi",shop:"supermarket"},name:"Maxi",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Colruyt":{tags:{name:"Colruyt",shop:"supermarket"},name:"Colruyt",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/The Co-operative":{tags:{name:"The Co-operative",shop:"supermarket"},name:"The Co-operative",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Intermarché":{tags:{name:"Intermarch\xE9",shop:"supermarket"},name:"Intermarch\xE9",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Delhaize":{tags:{name:"Delhaize",shop:"supermarket"},name:"Delhaize",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/CBA":{tags:{name:"CBA",shop:"supermarket"},name:"CBA",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Shopi":{tags:{name:"Shopi",shop:"supermarket"},name:"Shopi",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Walmart":{tags:{name:"Walmart",shop:"supermarket"},name:"Walmart",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Kroger":{tags:{name:"Kroger",shop:"supermarket"},name:"Kroger",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Albertsons":{tags:{name:"Albertsons",shop:"supermarket"},name:"Albertsons",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Trader Joe's":{tags:{name:"Trader Joe's",shop:"supermarket"},name:"Trader Joe's",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Feneberg":{tags:{name:"Feneberg",shop:"supermarket"},name:"Feneberg",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/denn's Biomarkt":{tags:{name:"denn's Biomarkt",shop:"supermarket"},name:"denn's Biomarkt",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Kvickly":{tags:{name:"Kvickly",shop:"supermarket"},name:"Kvickly",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Makro":{tags:{name:"Makro",shop:"supermarket"},name:"Makro",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Dico":{tags:{name:"Dico",shop:"supermarket"},name:"Dico",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Nah & Frisch":{tags:{name:"Nah & Frisch",shop:"supermarket"},name:"Nah & Frisch",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Champion":{tags:{name:"Champion",shop:"supermarket"},name:"Champion",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/ICA Supermarket":{tags:{name:"ICA Supermarket",shop:"supermarket"},name:"ICA Supermarket",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Fakta":{tags:{name:"Fakta",shop:"supermarket"},name:"Fakta",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Магнит":{tags:{name:"\u041C\u0430\u0433\u043D\u0438\u0442",shop:"supermarket"},name:"\u041C\u0430\u0433\u043D\u0438\u0442",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Caprabo":{tags:{name:"Caprabo",shop:"supermarket"},name:"Caprabo",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Famiglia Cooperativa":{tags:{name:"Famiglia Cooperativa",shop:"supermarket"},name:"Famiglia Cooperativa",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Народная 7Я семьЯ":{tags:{name:"\u041D\u0430\u0440\u043E\u0434\u043D\u0430\u044F 7\u042F \u0441\u0435\u043C\u044C\u042F",shop:"supermarket"},name:"\u041D\u0430\u0440\u043E\u0434\u043D\u0430\u044F 7\u042F \u0441\u0435\u043C\u044C\u042F",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Esselunga":{tags:{name:"Esselunga",shop:"supermarket"},name:"Esselunga",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Maxima":{tags:{name:"Maxima",shop:"supermarket"},name:"Maxima",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Wasgau":{tags:{name:"Wasgau",shop:"supermarket"},name:"Wasgau",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Pingo Doce":{tags:{name:"Pingo Doce",shop:"supermarket"},name:"Pingo Doce",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Match":{tags:{name:"Match",shop:"supermarket"},name:"Match",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Profi":{tags:{name:"Profi",shop:"supermarket"},name:"Profi",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Lider":{tags:{name:"Lider",shop:"supermarket"},name:"Lider",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Unimarc":{tags:{name:"Unimarc",shop:"supermarket"},name:"Unimarc",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Co-operative Food":{tags:{name:"Co-operative Food",shop:"supermarket"},name:"Co-operative Food",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Santa Isabel":{tags:{name:"Santa Isabel",shop:"supermarket"},name:"Santa Isabel",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Седьмой континент":{tags:{name:"\u0421\u0435\u0434\u044C\u043C\u043E\u0439 \u043A\u043E\u043D\u0442\u0438\u043D\u0435\u043D\u0442",shop:"supermarket"},name:"\u0421\u0435\u0434\u044C\u043C\u043E\u0439 \u043A\u043E\u043D\u0442\u0438\u043D\u0435\u043D\u0442",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/HIT":{tags:{name:"HIT",shop:"supermarket"},name:"HIT",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Rimi":{tags:{name:"Rimi",shop:"supermarket"},name:"Rimi",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Conad":{tags:{name:"Conad",shop:"supermarket"},name:"Conad",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Фуршет":{tags:{name:"\u0424\u0443\u0440\u0448\u0435\u0442",shop:"supermarket"},name:"\u0424\u0443\u0440\u0448\u0435\u0442",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Willys":{tags:{name:"Willys",shop:"supermarket"},name:"Willys",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Farmfoods":{tags:{name:"Farmfoods",shop:"supermarket"},name:"Farmfoods",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/U Express":{tags:{name:"U Express",shop:"supermarket"},name:"U Express",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Фора":{tags:{name:"\u0424\u043E\u0440\u0430",shop:"supermarket"},name:"\u0424\u043E\u0440\u0430",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Dunnes Stores":{tags:{name:"Dunnes Stores",shop:"supermarket"},name:"Dunnes Stores",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Сільпо":{tags:{name:"\u0421\u0456\u043B\u044C\u043F\u043E",shop:"supermarket"},name:"\u0421\u0456\u043B\u044C\u043F\u043E",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/マルエツ":{tags:{name:"\u30DE\u30EB\u30A8\u30C4",shop:"supermarket"},name:"\u30DE\u30EB\u30A8\u30C4",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Piggly Wiggly":{tags:{name:"Piggly Wiggly",shop:"supermarket"},name:"Piggly Wiggly",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Crai":{tags:{name:"Crai",shop:"supermarket"},name:"Crai",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/El Árbol":{tags:{name:"El \xC1rbol",shop:"supermarket"},name:"El \xC1rbol",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Centre Commercial E. Leclerc":{tags:{name:"Centre Commercial E. Leclerc",shop:"supermarket"},name:"Centre Commercial E. Leclerc",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Foodland":{tags:{name:"Foodland",shop:"supermarket"},name:"Foodland",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Super Brugsen":{tags:{name:"Super Brugsen",shop:"supermarket"},name:"Super Brugsen",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Дикси":{tags:{name:"\u0414\u0438\u043A\u0441\u0438",shop:"supermarket"},name:"\u0414\u0438\u043A\u0441\u0438",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Пятёрочка":{tags:{name:"\u041F\u044F\u0442\u0451\u0440\u043E\u0447\u043A\u0430",shop:"supermarket"},name:"\u041F\u044F\u0442\u0451\u0440\u043E\u0447\u043A\u0430",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Publix":{tags:{name:"Publix",shop:"supermarket"},name:"Publix",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Føtex":{tags:{name:"F\xF8tex",shop:"supermarket"},name:"F\xF8tex",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/coop":{tags:{name:"coop",shop:"supermarket"},name:"coop",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Coop Konsum":{tags:{name:"Coop Konsum",shop:"supermarket"},name:"Coop Konsum",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Carrefour Contact":{tags:{name:"Carrefour Contact",shop:"supermarket"},name:"Carrefour Contact",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/SPAR":{tags:{name:"SPAR",shop:"supermarket"},name:"SPAR",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/No Frills":{tags:{name:"No Frills",shop:"supermarket"},name:"No Frills",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Plodine":{tags:{name:"Plodine",shop:"supermarket"},name:"Plodine",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/ADEG":{tags:{name:"ADEG",shop:"supermarket"},name:"ADEG",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Minipreço":{tags:{name:"Minipre\xE7o",shop:"supermarket"},name:"Minipre\xE7o",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Biedronka":{tags:{name:"Biedronka",shop:"supermarket"},name:"Biedronka",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/The Co-operative Food":{tags:{name:"The Co-operative Food",shop:"supermarket"},name:"The Co-operative Food",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Eurospin":{tags:{name:"Eurospin",shop:"supermarket"},name:"Eurospin",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Семья":{tags:{name:"\u0421\u0435\u043C\u044C\u044F",shop:"supermarket"},name:"\u0421\u0435\u043C\u044C\u044F",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Gadis":{tags:{name:"Gadis",shop:"supermarket"},name:"Gadis",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Евроопт":{tags:{name:"\u0415\u0432\u0440\u043E\u043E\u043F\u0442",shop:"supermarket"},name:"\u0415\u0432\u0440\u043E\u043E\u043F\u0442",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Квартал":{tags:{name:"\u041A\u0432\u0430\u0440\u0442\u0430\u043B",shop:"supermarket"},name:"\u041A\u0432\u0430\u0440\u0442\u0430\u043B",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/New World":{tags:{name:"New World",shop:"supermarket"},name:"New World",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Countdown":{tags:{name:"Countdown",shop:"supermarket"},name:"Countdown",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Reliance Fresh":{tags:{name:"Reliance Fresh",shop:"supermarket"},name:"Reliance Fresh",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Stokrotka":{tags:{name:"Stokrotka",shop:"supermarket"},name:"Stokrotka",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Coop Jednota":{tags:{name:"Coop Jednota",shop:"supermarket"},name:"Coop Jednota",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Fred Meyer":{tags:{name:"Fred Meyer",shop:"supermarket"},name:"Fred Meyer",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Irma":{tags:{name:"Irma",shop:"supermarket"},name:"Irma",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Continente":{tags:{name:"Continente",shop:"supermarket"},name:"Continente",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Price Chopper":{tags:{name:"Price Chopper",shop:"supermarket"},name:"Price Chopper",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Game":{tags:{name:"Game",shop:"supermarket"},name:"Game",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Soriana":{tags:{name:"Soriana",shop:"supermarket"},name:"Soriana",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Alimerka":{tags:{name:"Alimerka",shop:"supermarket"},name:"Alimerka",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Piotr i Paweł":{tags:{name:"Piotr i Pawe\u0142",shop:"supermarket"},name:"Piotr i Pawe\u0142",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Перекресток":{tags:{name:"\u041F\u0435\u0440\u0435\u043A\u0440\u0435\u0441\u0442\u043E\u043A",shop:"supermarket"},name:"\u041F\u0435\u0440\u0435\u043A\u0440\u0435\u0441\u0442\u043E\u043A",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Maxima X":{tags:{name:"Maxima X",shop:"supermarket"},name:"Maxima X",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Карусель":{tags:{name:"\u041A\u0430\u0440\u0443\u0441\u0435\u043B\u044C",shop:"supermarket"},name:"\u041A\u0430\u0440\u0443\u0441\u0435\u043B\u044C",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/ALDI Nord":{tags:{name:"ALDI Nord",shop:"supermarket"},name:"ALDI Nord",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Condis":{tags:{name:"Condis",shop:"supermarket"},name:"Condis",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Sam's Club":{tags:{name:"Sam's Club",shop:"supermarket"},name:"Sam's Club",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Копейка":{tags:{name:"\u041A\u043E\u043F\u0435\u0439\u043A\u0430",shop:"supermarket"},name:"\u041A\u043E\u043F\u0435\u0439\u043A\u0430",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Géant Casino":{tags:{name:"G\xE9ant Casino",shop:"supermarket"},name:"G\xE9ant Casino",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/ASDA":{tags:{name:"ASDA",shop:"supermarket"},name:"ASDA",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Intermarche":{tags:{name:"Intermarche",shop:"supermarket"},name:"Intermarche",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Stop & Shop":{tags:{name:"Stop & Shop",shop:"supermarket"},name:"Stop & Shop",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Food Lion":{tags:{name:"Food Lion",shop:"supermarket"},name:"Food Lion",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Harris Teeter":{tags:{name:"Harris Teeter",shop:"supermarket"},name:"Harris Teeter",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Foodworks":{tags:{name:"Foodworks",shop:"supermarket"},name:"Foodworks",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Polo Market":{tags:{name:"Polo Market",shop:"supermarket"},name:"Polo Market",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Лента":{tags:{name:"\u041B\u0435\u043D\u0442\u0430",shop:"supermarket"},name:"\u041B\u0435\u043D\u0442\u0430",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/西友 (SEIYU)":{tags:{name:"\u897F\u53CB (SEIYU)",shop:"supermarket"},name:"\u897F\u53CB (SEIYU)",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/H-E-B":{tags:{name:"H-E-B",shop:"supermarket"},name:"H-E-B",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Атак":{tags:{name:"\u0410\u0442\u0430\u043A",shop:"supermarket"},name:"\u0410\u0442\u0430\u043A",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Полушка":{tags:{name:"\u041F\u043E\u043B\u0443\u0448\u043A\u0430",shop:"supermarket"},name:"\u041F\u043E\u043B\u0443\u0448\u043A\u0430",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Extra":{tags:{name:"Extra",shop:"supermarket"},name:"Extra",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Sigma":{tags:{name:"Sigma",shop:"supermarket"},name:"Sigma",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/АТБ":{tags:{name:"\u0410\u0422\u0411",shop:"supermarket"},name:"\u0410\u0422\u0411",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Bodega Aurrera":{tags:{name:"Bodega Aurrera",shop:"supermarket"},name:"Bodega Aurrera",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Tesco Lotus":{tags:{name:"Tesco Lotus",shop:"supermarket"},name:"Tesco Lotus",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Мария-Ра":{tags:{name:"\u041C\u0430\u0440\u0438\u044F-\u0420\u0430",shop:"supermarket"},name:"\u041C\u0430\u0440\u0438\u044F-\u0420\u0430",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Магнолия":{tags:{name:"\u041C\u0430\u0433\u043D\u043E\u043B\u0438\u044F",shop:"supermarket"},name:"\u041C\u0430\u0433\u043D\u043E\u043B\u0438\u044F",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Монетка":{tags:{name:"\u041C\u043E\u043D\u0435\u0442\u043A\u0430",shop:"supermarket"},name:"\u041C\u043E\u043D\u0435\u0442\u043A\u0430",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Hy-Vee":{tags:{name:"Hy-Vee",shop:"supermarket"},name:"Hy-Vee",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Walmart Supercenter":{tags:{name:"Walmart Supercenter",shop:"supermarket"},name:"Walmart Supercenter",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Hannaford":{tags:{name:"Hannaford",shop:"supermarket"},name:"Hannaford",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Wegmans":{tags:{name:"Wegmans",shop:"supermarket"},name:"Wegmans",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/業務スーパー":{tags:{name:"\u696D\u52D9\u30B9\u30FC\u30D1\u30FC",shop:"supermarket"},name:"\u696D\u52D9\u30B9\u30FC\u30D1\u30FC",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Norfa XL":{tags:{name:"Norfa XL",shop:"supermarket"},name:"Norfa XL",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/ヨークマート (YorkMart)":{tags:{name:"\u30E8\u30FC\u30AF\u30DE\u30FC\u30C8 (YorkMart)",shop:"supermarket"},name:"\u30E8\u30FC\u30AF\u30DE\u30FC\u30C8 (YorkMart)",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/supermarket/Leclerc Drive":{tags:{name:"Leclerc Drive",shop:"supermarket"},name:"Leclerc Drive",icon:"grocery",geometry:["point","vertex","area"],fields:["operator","building_area","address"],suggestion:true},"shop/electronics/Media Markt":{tags:{name:"Media Markt",shop:"electronics"},name:"Media Markt",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Maplin":{tags:{name:"Maplin",shop:"electronics"},name:"Maplin",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Best Buy":{tags:{name:"Best Buy",shop:"electronics"},name:"Best Buy",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Future Shop":{tags:{name:"Future Shop",shop:"electronics"},name:"Future Shop",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Saturn":{tags:{name:"Saturn",shop:"electronics"},name:"Saturn",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Currys":{tags:{name:"Currys",shop:"electronics"},name:"Currys",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Radio Shack":{tags:{name:"Radio Shack",shop:"electronics"},name:"Radio Shack",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Euronics":{tags:{name:"Euronics",shop:"electronics"},name:"Euronics",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Expert":{tags:{name:"Expert",shop:"electronics"},name:"Expert",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Эльдорадо":{tags:{name:"\u042D\u043B\u044C\u0434\u043E\u0440\u0430\u0434\u043E",shop:"electronics"},name:"\u042D\u043B\u044C\u0434\u043E\u0440\u0430\u0434\u043E",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/Darty":{tags:{name:"Darty",shop:"electronics"},name:"Darty",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/М.Видео":{tags:{name:"\u041C.\u0412\u0438\u0434\u0435\u043E",shop:"electronics"},name:"\u041C.\u0412\u0438\u0434\u0435\u043E",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/electronics/ヤマダ電機":{tags:{name:"\u30E4\u30DE\u30C0\u96FB\u6A5F",shop:"electronics"},name:"\u30E4\u30DE\u30C0\u96FB\u6A5F",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/McColl's":{tags:{name:"McColl's",shop:"convenience"},name:"McColl's",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Tesco Express":{tags:{name:"Tesco Express",shop:"convenience"},name:"Tesco Express",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/One Stop":{tags:{name:"One Stop",shop:"convenience"},name:"One Stop",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Londis":{tags:{name:"Londis",shop:"convenience"},name:"Londis",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/7-Eleven":{tags:{name:"7-Eleven",shop:"convenience"},name:"7-Eleven",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Sale":{tags:{name:"Sale",shop:"convenience"},name:"Sale",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Siwa":{tags:{name:"Siwa",shop:"convenience"},name:"Siwa",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/COOP Jednota":{tags:{name:"COOP Jednota",shop:"convenience"},name:"COOP Jednota",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Mac's":{tags:{name:"Mac's",shop:"convenience"},name:"Mac's",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Alepa":{tags:{name:"Alepa",shop:"convenience"},name:"Alepa",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Hasty Market":{tags:{name:"Hasty Market",shop:"convenience"},name:"Hasty Market",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/K-Market":{tags:{name:"K-Market",shop:"convenience"},name:"K-Market",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Costcutter":{tags:{name:"Costcutter",shop:"convenience"},name:"Costcutter",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Valintatalo":{tags:{name:"Valintatalo",shop:"convenience"},name:"Valintatalo",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Circle K":{tags:{name:"Circle K",shop:"convenience"},name:"Circle K",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/セブンイレブン":{tags:{name:"\u30BB\u30D6\u30F3\u30A4\u30EC\u30D6\u30F3","name:en":"7-Eleven",shop:"convenience"},name:"\u30BB\u30D6\u30F3\u30A4\u30EC\u30D6\u30F3",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/ローソン":{tags:{name:"\u30ED\u30FC\u30BD\u30F3","name:en":"LAWSON",shop:"convenience"},name:"\u30ED\u30FC\u30BD\u30F3",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Petit Casino":{tags:{name:"Petit Casino",shop:"convenience"},name:"Petit Casino",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Mace":{tags:{name:"Mace",shop:"convenience"},name:"Mace",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Mini Market":{tags:{name:"Mini Market",shop:"convenience"},name:"Mini Market",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Nisa Local":{tags:{name:"Nisa Local",shop:"convenience"},name:"Nisa Local",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Dorfladen":{tags:{name:"Dorfladen",shop:"convenience"},name:"Dorfladen",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Продукты":{tags:{name:"\u041F\u0440\u043E\u0434\u0443\u043A\u0442\u044B",shop:"convenience"},name:"\u041F\u0440\u043E\u0434\u0443\u043A\u0442\u044B",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Mini Stop":{tags:{name:"Mini Stop",shop:"convenience"},name:"Mini Stop",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/LAWSON":{tags:{name:"LAWSON",shop:"convenience"},name:"LAWSON",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/デイリーヤマザキ":{tags:{name:"\u30C7\u30A4\u30EA\u30FC\u30E4\u30DE\u30B6\u30AD",shop:"convenience"},name:"\u30C7\u30A4\u30EA\u30FC\u30E4\u30DE\u30B6\u30AD",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Надежда":{tags:{name:"\u041D\u0430\u0434\u0435\u0436\u0434\u0430",shop:"convenience"},name:"\u041D\u0430\u0434\u0435\u0436\u0434\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Nisa":{tags:{name:"Nisa",shop:"convenience"},name:"Nisa",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Premier":{tags:{name:"Premier",shop:"convenience"},name:"Premier",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/ABC":{tags:{name:"ABC",shop:"convenience"},name:"ABC",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/ミニストップ":{tags:{name:"\u30DF\u30CB\u30B9\u30C8\u30C3\u30D7","name:en":"MINISTOP",shop:"convenience"},name:"\u30DF\u30CB\u30B9\u30C8\u30C3\u30D7",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/サンクス":{tags:{name:"\u30B5\u30F3\u30AF\u30B9","name:en":"sunkus",shop:"convenience"},name:"\u30B5\u30F3\u30AF\u30B9",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/スリーエフ":{tags:{name:"\u30B9\u30EA\u30FC\u30A8\u30D5",shop:"convenience"},name:"\u30B9\u30EA\u30FC\u30A8\u30D5",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/8 à Huit":{tags:{name:"8 \xE0 Huit",shop:"convenience"},name:"8 \xE0 Huit",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Żabka":{tags:{name:"\u017Babka",shop:"convenience"},name:"\u017Babka",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Almacen":{tags:{name:"Almacen",shop:"convenience"},name:"Almacen",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Vival":{tags:{name:"Vival",shop:"convenience"},name:"Vival",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/FamilyMart":{tags:{name:"FamilyMart",shop:"convenience"},name:"FamilyMart",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/ファミリーマート":{tags:{name:"\u30D5\u30A1\u30DF\u30EA\u30FC\u30DE\u30FC\u30C8","name:en":"FamilyMart",shop:"convenience"},name:"\u30D5\u30A1\u30DF\u30EA\u30FC\u30DE\u30FC\u30C8",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Sunkus":{tags:{name:"Sunkus",shop:"convenience"},name:"Sunkus",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/セブンイレブン(Seven-Eleven)":{tags:{name:"\u30BB\u30D6\u30F3\u30A4\u30EC\u30D6\u30F3(Seven-Eleven)",shop:"convenience"},name:"\u30BB\u30D6\u30F3\u30A4\u30EC\u30D6\u30F3(Seven-Eleven)",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Jednota":{tags:{name:"Jednota",shop:"convenience"},name:"Jednota",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Магазин":{tags:{name:"\u041C\u0430\u0433\u0430\u0437\u0438\u043D",shop:"convenience"},name:"\u041C\u0430\u0433\u0430\u0437\u0438\u043D",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Гастроном":{tags:{name:"\u0413\u0430\u0441\u0442\u0440\u043E\u043D\u043E\u043C",shop:"convenience"},name:"\u0413\u0430\u0441\u0442\u0440\u043E\u043D\u043E\u043C",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Sklep spożywczy":{tags:{name:"Sklep spo\u017Cywczy",shop:"convenience"},name:"Sklep spo\u017Cywczy",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Centra":{tags:{name:"Centra",shop:"convenience"},name:"Centra",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/サークルK":{tags:{name:"\u30B5\u30FC\u30AF\u30EBK","name:en":"Circle K",shop:"convenience"},name:"\u30B5\u30FC\u30AF\u30EBK",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Wawa":{tags:{name:"Wawa",shop:"convenience"},name:"Wawa",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Proxi":{tags:{name:"Proxi",shop:"convenience"},name:"Proxi",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Универсам":{tags:{name:"\u0423\u043D\u0438\u0432\u0435\u0440\u0441\u0430\u043C",shop:"convenience"},name:"\u0423\u043D\u0438\u0432\u0435\u0440\u0441\u0430\u043C",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Groszek":{tags:{name:"Groszek",shop:"convenience"},name:"Groszek",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Select":{tags:{name:"Select",shop:"convenience"},name:"Select",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Večerka":{tags:{name:"Ve\u010Derka",shop:"convenience"},name:"Ve\u010Derka",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Potraviny":{tags:{name:"Potraviny",shop:"convenience"},name:"Potraviny",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Смак":{tags:{name:"\u0421\u043C\u0430\u043A",shop:"convenience"},name:"\u0421\u043C\u0430\u043A",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Эконом":{tags:{name:"\u042D\u043A\u043E\u043D\u043E\u043C",shop:"convenience"},name:"\u042D\u043A\u043E\u043D\u043E\u043C",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Березка":{tags:{name:"\u0411\u0435\u0440\u0435\u0437\u043A\u0430",shop:"convenience"},name:"\u0411\u0435\u0440\u0435\u0437\u043A\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Społem":{tags:{name:"Spo\u0142em",shop:"convenience"},name:"Spo\u0142em",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Cumberland Farms":{tags:{name:"Cumberland Farms",shop:"convenience"},name:"Cumberland Farms",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Tesco Lotus Express":{tags:{name:"Tesco Lotus Express",shop:"convenience"},name:"Tesco Lotus Express",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Kiosk":{tags:{name:"Kiosk",shop:"convenience"},name:"Kiosk",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/24 часа":{tags:{name:"24 \u0447\u0430\u0441\u0430",shop:"convenience"},name:"24 \u0447\u0430\u0441\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Минимаркет":{tags:{name:"\u041C\u0438\u043D\u0438\u043C\u0430\u0440\u043A\u0435\u0442",shop:"convenience"},name:"\u041C\u0438\u043D\u0438\u043C\u0430\u0440\u043A\u0435\u0442",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Oxxo":{tags:{name:"Oxxo",shop:"convenience"},name:"Oxxo",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/abc":{tags:{name:"abc",shop:"convenience"},name:"abc",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/7/11":{tags:{name:"7/11",shop:"convenience"},name:"7/11",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Stewart's":{tags:{name:"Stewart's",shop:"convenience"},name:"Stewart's",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Продукти":{tags:{name:"\u041F\u0440\u043E\u0434\u0443\u043A\u0442\u0438",shop:"convenience"},name:"\u041F\u0440\u043E\u0434\u0443\u043A\u0442\u0438",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/ローソンストア100 (LAWSON STORE 100)":{tags:{name:"\u30ED\u30FC\u30BD\u30F3\u30B9\u30C8\u30A2100 (LAWSON STORE 100)",shop:"convenience"},name:"\u30ED\u30FC\u30BD\u30F3\u30B9\u30C8\u30A2100 (LAWSON STORE 100)",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Радуга":{tags:{name:"\u0420\u0430\u0434\u0443\u0433\u0430",shop:"convenience"},name:"\u0420\u0430\u0434\u0443\u0433\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/ローソンストア100":{tags:{name:"\u30ED\u30FC\u30BD\u30F3\u30B9\u30C8\u30A2100",shop:"convenience"},name:"\u30ED\u30FC\u30BD\u30F3\u30B9\u30C8\u30A2100",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/เซเว่นอีเลฟเว่น":{tags:{name:"\u0E40\u0E0B\u0E40\u0E27\u0E48\u0E19\u0E2D\u0E35\u0E40\u0E25\u0E1F\u0E40\u0E27\u0E48\u0E19",shop:"convenience"},name:"\u0E40\u0E0B\u0E40\u0E27\u0E48\u0E19\u0E2D\u0E35\u0E40\u0E25\u0E1F\u0E40\u0E27\u0E48\u0E19",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Spożywczy":{tags:{name:"Spo\u017Cywczy",shop:"convenience"},name:"Spo\u017Cywczy",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Фортуна":{tags:{name:"\u0424\u043E\u0440\u0442\u0443\u043D\u0430",shop:"convenience"},name:"\u0424\u043E\u0440\u0442\u0443\u043D\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Picard":{tags:{name:"Picard",shop:"convenience"},name:"Picard",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Four Square":{tags:{name:"Four Square",shop:"convenience"},name:"Four Square",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Визит":{tags:{name:"\u0412\u0438\u0437\u0438\u0442",shop:"convenience"},name:"\u0412\u0438\u0437\u0438\u0442",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Авоська":{tags:{name:"\u0410\u0432\u043E\u0441\u044C\u043A\u0430",shop:"convenience"},name:"\u0410\u0432\u043E\u0441\u044C\u043A\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Dollar General":{tags:{name:"Dollar General",shop:"convenience"},name:"Dollar General",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Studenac":{tags:{name:"Studenac",shop:"convenience"},name:"Studenac",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Central Convenience Store":{tags:{name:"Central Convenience Store",shop:"convenience"},name:"Central Convenience Store",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/продукты":{tags:{name:"\u043F\u0440\u043E\u0434\u0443\u043A\u0442\u044B",shop:"convenience"},name:"\u043F\u0440\u043E\u0434\u0443\u043A\u0442\u044B",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Кулинария":{tags:{name:"\u041A\u0443\u043B\u0438\u043D\u0430\u0440\u0438\u044F",shop:"convenience"},name:"\u041A\u0443\u043B\u0438\u043D\u0430\u0440\u0438\u044F",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/全家":{tags:{name:"\u5168\u5BB6",shop:"convenience"},name:"\u5168\u5BB6",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Мечта":{tags:{name:"\u041C\u0435\u0447\u0442\u0430",shop:"convenience"},name:"\u041C\u0435\u0447\u0442\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Epicerie":{tags:{name:"Epicerie",shop:"convenience"},name:"Epicerie",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Кировский":{tags:{name:"\u041A\u0438\u0440\u043E\u0432\u0441\u043A\u0438\u0439",shop:"convenience"},name:"\u041A\u0438\u0440\u043E\u0432\u0441\u043A\u0438\u0439",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Food Mart":{tags:{name:"Food Mart",shop:"convenience"},name:"Food Mart",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Delikatesy":{tags:{name:"Delikatesy",shop:"convenience"},name:"Delikatesy",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/ポプラ":{tags:{name:"\u30DD\u30D7\u30E9",shop:"convenience"},name:"\u30DD\u30D7\u30E9",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Lewiatan":{tags:{name:"Lewiatan",shop:"convenience"},name:"Lewiatan",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Продуктовый магазин":{tags:{name:"\u041F\u0440\u043E\u0434\u0443\u043A\u0442\u043E\u0432\u044B\u0439 \u043C\u0430\u0433\u0430\u0437\u0438\u043D",shop:"convenience"},name:"\u041F\u0440\u043E\u0434\u0443\u043A\u0442\u043E\u0432\u044B\u0439 \u043C\u0430\u0433\u0430\u0437\u0438\u043D",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Продуктовый":{tags:{name:"\u041F\u0440\u043E\u0434\u0443\u043A\u0442\u043E\u0432\u044B\u0439",shop:"convenience"},name:"\u041F\u0440\u043E\u0434\u0443\u043A\u0442\u043E\u0432\u044B\u0439",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/セイコーマート (Seicomart)":{tags:{name:"\u30BB\u30A4\u30B3\u30FC\u30DE\u30FC\u30C8 (Seicomart)",shop:"convenience"},name:"\u30BB\u30A4\u30B3\u30FC\u30DE\u30FC\u30C8 (Seicomart)",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Виктория":{tags:{name:"\u0412\u0438\u043A\u0442\u043E\u0440\u0438\u044F",shop:"convenience"},name:"\u0412\u0438\u043A\u0442\u043E\u0440\u0438\u044F",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Весна":{tags:{name:"\u0412\u0435\u0441\u043D\u0430",shop:"convenience"},name:"\u0412\u0435\u0441\u043D\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Mini Market Non-Stop":{tags:{name:"Mini Market Non-Stop",shop:"convenience"},name:"Mini Market Non-Stop",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Копеечка":{tags:{name:"\u041A\u043E\u043F\u0435\u0435\u0447\u043A\u0430",shop:"convenience"},name:"\u041A\u043E\u043F\u0435\u0435\u0447\u043A\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Royal Farms":{tags:{name:"Royal Farms",shop:"convenience"},name:"Royal Farms",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Alfamart":{tags:{name:"Alfamart",shop:"convenience"},name:"Alfamart",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Indomaret":{tags:{name:"Indomaret",shop:"convenience"},name:"Indomaret",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/магазин":{tags:{name:"\u043C\u0430\u0433\u0430\u0437\u0438\u043D",shop:"convenience"},name:"\u043C\u0430\u0433\u0430\u0437\u0438\u043D",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/全家便利商店":{tags:{name:"\u5168\u5BB6\u4FBF\u5229\u5546\u5E97",shop:"convenience"},name:"\u5168\u5BB6\u4FBF\u5229\u5546\u5E97",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Boutique":{tags:{name:"Boutique",shop:"convenience"},name:"Boutique",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/მარკეტი (Market)":{tags:{name:"\u10DB\u10D0\u10E0\u10D9\u10D4\u10E2\u10D8 (Market)",shop:"convenience"},name:"\u10DB\u10D0\u10E0\u10D9\u10D4\u10E2\u10D8 (Market)",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/convenience/Stores":{tags:{name:"Stores",shop:"convenience"},name:"Stores",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/dm":{tags:{name:"dm",shop:"chemist"},name:"dm",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/Müller":{tags:{name:"M\xFCller",shop:"chemist"},name:"M\xFCller",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/Schlecker":{tags:{name:"Schlecker",shop:"chemist"},name:"Schlecker",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/Etos":{tags:{name:"Etos",shop:"chemist"},name:"Etos",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/Bipa":{tags:{name:"Bipa",shop:"chemist"},name:"Bipa",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/Rossmann":{tags:{name:"Rossmann",shop:"chemist"},name:"Rossmann",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/DM Drogeriemarkt":{tags:{name:"DM Drogeriemarkt",shop:"chemist"},name:"DM Drogeriemarkt",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/Ihr Platz":{tags:{name:"Ihr Platz",shop:"chemist"},name:"Ihr Platz",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/Douglas":{tags:{name:"Douglas",shop:"chemist"},name:"Douglas",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/chemist/Kruidvat":{tags:{name:"Kruidvat",shop:"chemist"},name:"Kruidvat",icon:"chemist",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Kwik Fit":{tags:{name:"Kwik Fit",shop:"car_repair"},name:"Kwik Fit",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/ATU":{tags:{name:"ATU",shop:"car_repair"},name:"ATU",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Kwik-Fit":{tags:{name:"Kwik-Fit",shop:"car_repair"},name:"Kwik-Fit",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Midas":{tags:{name:"Midas",shop:"car_repair"},name:"Midas",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Feu Vert":{tags:{name:"Feu Vert",shop:"car_repair"},name:"Feu Vert",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Norauto":{tags:{name:"Norauto",shop:"car_repair"},name:"Norauto",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Speedy":{tags:{name:"Speedy",shop:"car_repair"},name:"Speedy",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Pit Stop":{tags:{name:"Pit Stop",shop:"car_repair"},name:"Pit Stop",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Jiffy Lube":{tags:{name:"Jiffy Lube",shop:"car_repair"},name:"Jiffy Lube",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Шиномонтаж":{tags:{name:"\u0428\u0438\u043D\u043E\u043C\u043E\u043D\u0442\u0430\u0436",shop:"car_repair"},name:"\u0428\u0438\u043D\u043E\u043C\u043E\u043D\u0442\u0430\u0436",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/СТО":{tags:{name:"\u0421\u0422\u041E",shop:"car_repair"},name:"\u0421\u0422\u041E",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/O'Reilly Auto Parts":{tags:{name:"O'Reilly Auto Parts",shop:"car_repair"},name:"O'Reilly Auto Parts",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Carglass":{tags:{name:"Carglass",shop:"car_repair"},name:"Carglass",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/шиномонтаж":{tags:{name:"\u0448\u0438\u043D\u043E\u043C\u043E\u043D\u0442\u0430\u0436",shop:"car_repair"},name:"\u0448\u0438\u043D\u043E\u043C\u043E\u043D\u0442\u0430\u0436",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Euromaster":{tags:{name:"Euromaster",shop:"car_repair"},name:"Euromaster",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Firestone":{tags:{name:"Firestone",shop:"car_repair"},name:"Firestone",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/AutoZone":{tags:{name:"AutoZone",shop:"car_repair"},name:"AutoZone",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Автосервис":{tags:{name:"\u0410\u0432\u0442\u043E\u0441\u0435\u0440\u0432\u0438\u0441",shop:"car_repair"},name:"\u0410\u0432\u0442\u043E\u0441\u0435\u0440\u0432\u0438\u0441",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Advance Auto Parts":{tags:{name:"Advance Auto Parts",shop:"car_repair"},name:"Advance Auto Parts",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car_repair/Roady":{tags:{name:"Roady",shop:"car_repair"},name:"Roady",icon:"car",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/furniture/IKEA":{tags:{name:"IKEA",shop:"furniture"},name:"IKEA",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/furniture/Jysk":{tags:{name:"Jysk",shop:"furniture"},name:"Jysk",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/furniture/Roller":{tags:{name:"Roller",shop:"furniture"},name:"Roller",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/furniture/Dänisches Bettenlager":{tags:{name:"D\xE4nisches Bettenlager",shop:"furniture"},name:"D\xE4nisches Bettenlager",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/furniture/Conforama":{tags:{name:"Conforama",shop:"furniture"},name:"Conforama",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/furniture/Matratzen Concord":{tags:{name:"Matratzen Concord",shop:"furniture"},name:"Matratzen Concord",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/furniture/Мебель":{tags:{name:"\u041C\u0435\u0431\u0435\u043B\u044C",shop:"furniture"},name:"\u041C\u0435\u0431\u0435\u043B\u044C",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/furniture/But":{tags:{name:"But",shop:"furniture"},name:"But",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Hornbach":{tags:{name:"Hornbach",shop:"doityourself"},name:"Hornbach",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/B&Q":{tags:{name:"B&Q",shop:"doityourself"},name:"B&Q",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Hubo":{tags:{name:"Hubo",shop:"doityourself"},name:"Hubo",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Mr Bricolage":{tags:{name:"Mr Bricolage",shop:"doityourself"},name:"Mr Bricolage",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Gamma":{tags:{name:"Gamma",shop:"doityourself"},name:"Gamma",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/OBI":{tags:{name:"OBI",shop:"doityourself"},name:"OBI",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Lowes":{tags:{name:"Lowes",shop:"doityourself"},name:"Lowes",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Wickes":{tags:{name:"Wickes",shop:"doityourself"},name:"Wickes",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Hagebau":{tags:{name:"Hagebau",shop:"doityourself"},name:"Hagebau",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Max Bahr":{tags:{name:"Max Bahr",shop:"doityourself"},name:"Max Bahr",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Castorama":{tags:{name:"Castorama",shop:"doityourself"},name:"Castorama",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Rona":{tags:{name:"Rona",shop:"doityourself"},name:"Rona",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Home Depot":{tags:{name:"Home Depot",shop:"doityourself"},name:"Home Depot",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Toom Baumarkt":{tags:{name:"Toom Baumarkt",shop:"doityourself"},name:"Toom Baumarkt",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Homebase":{tags:{name:"Homebase",shop:"doityourself"},name:"Homebase",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Baumax":{tags:{name:"Baumax",shop:"doityourself"},name:"Baumax",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Lagerhaus":{tags:{name:"Lagerhaus",shop:"doityourself"},name:"Lagerhaus",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Bauhaus":{tags:{name:"Bauhaus",shop:"doityourself"},name:"Bauhaus",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Canadian Tire":{tags:{name:"Canadian Tire",shop:"doityourself"},name:"Canadian Tire",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Leroy Merlin":{tags:{name:"Leroy Merlin",shop:"doityourself"},name:"Leroy Merlin",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Hellweg":{tags:{name:"Hellweg",shop:"doityourself"},name:"Hellweg",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Brico":{tags:{name:"Brico",shop:"doityourself"},name:"Brico",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Bricomarché":{tags:{name:"Bricomarch\xE9",shop:"doityourself"},name:"Bricomarch\xE9",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Toom":{tags:{name:"Toom",shop:"doityourself"},name:"Toom",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Hagebaumarkt":{tags:{name:"Hagebaumarkt",shop:"doityourself"},name:"Hagebaumarkt",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Praktiker":{tags:{name:"Praktiker",shop:"doityourself"},name:"Praktiker",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Menards":{tags:{name:"Menards",shop:"doityourself"},name:"Menards",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Weldom":{tags:{name:"Weldom",shop:"doityourself"},name:"Weldom",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Bunnings Warehouse":{tags:{name:"Bunnings Warehouse",shop:"doityourself"},name:"Bunnings Warehouse",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Ace Hardware":{tags:{name:"Ace Hardware",shop:"doityourself"},name:"Ace Hardware",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Home Hardware":{tags:{name:"Home Hardware",shop:"doityourself"},name:"Home Hardware",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Стройматериалы":{tags:{name:"\u0421\u0442\u0440\u043E\u0439\u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B",shop:"doityourself"},name:"\u0421\u0442\u0440\u043E\u0439\u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Bricorama":{tags:{name:"Bricorama",shop:"doityourself"},name:"Bricorama",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/doityourself/Point P":{tags:{name:"Point P",shop:"doityourself"},name:"Point P",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/stationery/Staples":{tags:{name:"Staples",shop:"stationery"},name:"Staples",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/stationery/McPaper":{tags:{name:"McPaper",shop:"stationery"},name:"McPaper",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/stationery/Office Depot":{tags:{name:"Office Depot",shop:"stationery"},name:"Office Depot",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/stationery/Канцтовары":{tags:{name:"\u041A\u0430\u043D\u0446\u0442\u043E\u0432\u0430\u0440\u044B",shop:"stationery"},name:"\u041A\u0430\u043D\u0446\u0442\u043E\u0432\u0430\u0440\u044B",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/car/Skoda":{tags:{name:"Skoda",shop:"car"},name:"Skoda",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/BMW":{tags:{name:"BMW",shop:"car"},name:"BMW",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Citroen":{tags:{name:"Citroen",shop:"car"},name:"Citroen",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Renault":{tags:{name:"Renault",shop:"car"},name:"Renault",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Mercedes-Benz":{tags:{name:"Mercedes-Benz",shop:"car"},name:"Mercedes-Benz",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Volvo":{tags:{name:"Volvo",shop:"car"},name:"Volvo",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Ford":{tags:{name:"Ford",shop:"car"},name:"Ford",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Volkswagen":{tags:{name:"Volkswagen",shop:"car"},name:"Volkswagen",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Mazda":{tags:{name:"Mazda",shop:"car"},name:"Mazda",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Mitsubishi":{tags:{name:"Mitsubishi",shop:"car"},name:"Mitsubishi",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Fiat":{tags:{name:"Fiat",shop:"car"},name:"Fiat",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Автозапчасти":{tags:{name:"\u0410\u0432\u0442\u043E\u0437\u0430\u043F\u0447\u0430\u0441\u0442\u0438",shop:"car"},name:"\u0410\u0432\u0442\u043E\u0437\u0430\u043F\u0447\u0430\u0441\u0442\u0438",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Opel":{tags:{name:"Opel",shop:"car"},name:"Opel",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Audi":{tags:{name:"Audi",shop:"car"},name:"Audi",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Toyota":{tags:{name:"Toyota",shop:"car"},name:"Toyota",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Nissan":{tags:{name:"Nissan",shop:"car"},name:"Nissan",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Suzuki":{tags:{name:"Suzuki",shop:"car"},name:"Suzuki",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Honda":{tags:{name:"Honda",shop:"car"},name:"Honda",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Peugeot":{tags:{name:"Peugeot",shop:"car"},name:"Peugeot",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Hyundai":{tags:{name:"Hyundai",shop:"car"},name:"Hyundai",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Subaru":{tags:{name:"Subaru",shop:"car"},name:"Subaru",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Chevrolet":{tags:{name:"Chevrolet",shop:"car"},name:"Chevrolet",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/car/Автомагазин":{tags:{name:"\u0410\u0432\u0442\u043E\u043C\u0430\u0433\u0430\u0437\u0438\u043D",shop:"car"},name:"\u0410\u0432\u0442\u043E\u043C\u0430\u0433\u0430\u0437\u0438\u043D",icon:"car",geometry:["point","vertex","area"],fields:["address","opening_hours"],suggestion:true},"shop/clothes/Matalan":{tags:{name:"Matalan",shop:"clothes"},name:"Matalan",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/KiK":{tags:{name:"KiK",shop:"clothes"},name:"KiK",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/H&M":{tags:{name:"H&M",shop:"clothes"},name:"H&M",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Urban Outfitters":{tags:{name:"Urban Outfitters",shop:"clothes"},name:"Urban Outfitters",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Vögele":{tags:{name:"V\xF6gele",shop:"clothes"},name:"V\xF6gele",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Zeeman":{tags:{name:"Zeeman",shop:"clothes"},name:"Zeeman",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Takko":{tags:{name:"Takko",shop:"clothes"},name:"Takko",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/C&A":{tags:{name:"C&A",shop:"clothes"},name:"C&A",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Zara":{tags:{name:"Zara",shop:"clothes"},name:"Zara",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Vero Moda":{tags:{name:"Vero Moda",shop:"clothes"},name:"Vero Moda",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/NKD":{tags:{name:"NKD",shop:"clothes"},name:"NKD",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Ernsting's family":{tags:{name:"Ernsting's family",shop:"clothes"},name:"Ernsting's family",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Winners":{tags:{name:"Winners",shop:"clothes"},name:"Winners",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/River Island":{tags:{name:"River Island",shop:"clothes"},name:"River Island",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Next":{tags:{name:"Next",shop:"clothes"},name:"Next",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Gap":{tags:{name:"Gap",shop:"clothes"},name:"Gap",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Adidas":{tags:{name:"Adidas",shop:"clothes"},name:"Adidas",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Mr Price":{tags:{name:"Mr Price",shop:"clothes"},name:"Mr Price",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Pep":{tags:{name:"Pep",shop:"clothes"},name:"Pep",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Edgars":{tags:{name:"Edgars",shop:"clothes"},name:"Edgars",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Ackermans":{tags:{name:"Ackermans",shop:"clothes"},name:"Ackermans",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Truworths":{tags:{name:"Truworths",shop:"clothes"},name:"Truworths",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Ross":{tags:{name:"Ross",shop:"clothes"},name:"Ross",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Burton":{tags:{name:"Burton",shop:"clothes"},name:"Burton",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Dorothy Perkins":{tags:{name:"Dorothy Perkins",shop:"clothes"},name:"Dorothy Perkins",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Lindex":{tags:{name:"Lindex",shop:"clothes"},name:"Lindex",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/s.Oliver":{tags:{name:"s.Oliver",shop:"clothes"},name:"s.Oliver",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Cecil":{tags:{name:"Cecil",shop:"clothes"},name:"Cecil",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Dress Barn":{tags:{name:"Dress Barn",shop:"clothes"},name:"Dress Barn",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Old Navy":{tags:{name:"Old Navy",shop:"clothes"},name:"Old Navy",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Jack & Jones":{tags:{name:"Jack & Jones",shop:"clothes"},name:"Jack & Jones",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Pimkie":{tags:{name:"Pimkie",shop:"clothes"},name:"Pimkie",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Esprit":{tags:{name:"Esprit",shop:"clothes"},name:"Esprit",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Primark":{tags:{name:"Primark",shop:"clothes"},name:"Primark",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Bonita":{tags:{name:"Bonita",shop:"clothes"},name:"Bonita",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Mexx":{tags:{name:"Mexx",shop:"clothes"},name:"Mexx",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Gerry Weber":{tags:{name:"Gerry Weber",shop:"clothes"},name:"Gerry Weber",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Tally Weijl":{tags:{name:"Tally Weijl",shop:"clothes"},name:"Tally Weijl",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Mango":{tags:{name:"Mango",shop:"clothes"},name:"Mango",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/TK Maxx":{tags:{name:"TK Maxx",shop:"clothes"},name:"TK Maxx",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Benetton":{tags:{name:"Benetton",shop:"clothes"},name:"Benetton",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Ulla Popken":{tags:{name:"Ulla Popken",shop:"clothes"},name:"Ulla Popken",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/AWG":{tags:{name:"AWG",shop:"clothes"},name:"AWG",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Tommy Hilfiger":{tags:{name:"Tommy Hilfiger",shop:"clothes"},name:"Tommy Hilfiger",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/New Yorker":{tags:{name:"New Yorker",shop:"clothes"},name:"New Yorker",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Orsay":{tags:{name:"Orsay",shop:"clothes"},name:"Orsay",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Jeans Fritz":{tags:{name:"Jeans Fritz",shop:"clothes"},name:"Jeans Fritz",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Charles Vögele":{tags:{name:"Charles V\xF6gele",shop:"clothes"},name:"Charles V\xF6gele",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/New Look":{tags:{name:"New Look",shop:"clothes"},name:"New Look",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Lacoste":{tags:{name:"Lacoste",shop:"clothes"},name:"Lacoste",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Etam":{tags:{name:"Etam",shop:"clothes"},name:"Etam",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Kiabi":{tags:{name:"Kiabi",shop:"clothes"},name:"Kiabi",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Jack Wolfskin":{tags:{name:"Jack Wolfskin",shop:"clothes"},name:"Jack Wolfskin",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/American Apparel":{tags:{name:"American Apparel",shop:"clothes"},name:"American Apparel",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Men's Wearhouse":{tags:{name:"Men's Wearhouse",shop:"clothes"},name:"Men's Wearhouse",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Intimissimi":{tags:{name:"Intimissimi",shop:"clothes"},name:"Intimissimi",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/United Colors of Benetton":{tags:{name:"United Colors of Benetton",shop:"clothes"},name:"United Colors of Benetton",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Jules":{tags:{name:"Jules",shop:"clothes"},name:"Jules",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Second Hand":{tags:{name:"Second Hand",shop:"clothes"},name:"Second Hand",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/AOKI":{tags:{name:"AOKI",shop:"clothes"},name:"AOKI",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Calzedonia":{tags:{name:"Calzedonia",shop:"clothes"},name:"Calzedonia",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/洋服の青山":{tags:{name:"\u6D0B\u670D\u306E\u9752\u5C71",shop:"clothes"},name:"\u6D0B\u670D\u306E\u9752\u5C71",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Levi's":{tags:{name:"Levi's",shop:"clothes"},name:"Levi's",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Celio":{tags:{name:"Celio",shop:"clothes"},name:"Celio",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/TJ Maxx":{tags:{name:"TJ Maxx",shop:"clothes"},name:"TJ Maxx",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Promod":{tags:{name:"Promod",shop:"clothes"},name:"Promod",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Street One":{tags:{name:"Street One",shop:"clothes"},name:"Street One",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/ユニクロ":{tags:{name:"\u30E6\u30CB\u30AF\u30ED",shop:"clothes"},name:"\u30E6\u30CB\u30AF\u30ED",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Banana Republic":{tags:{name:"Banana Republic",shop:"clothes"},name:"Banana Republic",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Одежда":{tags:{name:"\u041E\u0434\u0435\u0436\u0434\u0430",shop:"clothes"},name:"\u041E\u0434\u0435\u0436\u0434\u0430",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Marshalls":{tags:{name:"Marshalls",shop:"clothes"},name:"Marshalls",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/La Halle":{tags:{name:"La Halle",shop:"clothes"},name:"La Halle",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/Peacocks":{tags:{name:"Peacocks",shop:"clothes"},name:"Peacocks",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/clothes/しまむら":{tags:{name:"\u3057\u307E\u3080\u3089",shop:"clothes"},name:"\u3057\u307E\u3080\u3089",icon:"clothing-store",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/books/Bruna":{tags:{name:"Bruna",shop:"books"},name:"Bruna",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/books/Waterstones":{tags:{name:"Waterstones",shop:"books"},name:"Waterstones",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/books/Libro":{tags:{name:"Libro",shop:"books"},name:"Libro",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/books/Barnes & Noble":{tags:{name:"Barnes & Noble",shop:"books"},name:"Barnes & Noble",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/books/Weltbild":{tags:{name:"Weltbild",shop:"books"},name:"Weltbild",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/books/Thalia":{tags:{name:"Thalia",shop:"books"},name:"Thalia",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/books/Книги":{tags:{name:"\u041A\u043D\u0438\u0433\u0438",shop:"books"},name:"\u041A\u043D\u0438\u0433\u0438",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Debenhams":{tags:{name:"Debenhams",shop:"department_store"},name:"Debenhams",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Karstadt":{tags:{name:"Karstadt",shop:"department_store"},name:"Karstadt",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Kmart":{tags:{name:"Kmart",shop:"department_store"},name:"Kmart",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Target":{tags:{name:"Target",shop:"department_store"},name:"Target",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Galeria Kaufhof":{tags:{name:"Galeria Kaufhof",shop:"department_store"},name:"Galeria Kaufhof",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Marks & Spencer":{tags:{name:"Marks & Spencer",shop:"department_store"},name:"Marks & Spencer",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Big W":{tags:{name:"Big W",shop:"department_store"},name:"Big W",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Woolworth":{tags:{name:"Woolworth",shop:"department_store"},name:"Woolworth",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Универмаг":{tags:{name:"\u0423\u043D\u0438\u0432\u0435\u0440\u043C\u0430\u0433",shop:"department_store"},name:"\u0423\u043D\u0438\u0432\u0435\u0440\u043C\u0430\u0433",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Sears":{tags:{name:"Sears",shop:"department_store"},name:"Sears",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Kohl's":{tags:{name:"Kohl's",shop:"department_store"},name:"Kohl's",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/Macy's":{tags:{name:"Macy's",shop:"department_store"},name:"Macy's",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/department_store/JCPenney":{tags:{name:"JCPenney",shop:"department_store"},name:"JCPenney",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/Alko":{tags:{name:"Alko",shop:"alcohol"},name:"Alko",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/The Beer Store":{tags:{name:"The Beer Store",shop:"alcohol"},name:"The Beer Store",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/Systembolaget":{tags:{name:"Systembolaget",shop:"alcohol"},name:"Systembolaget",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/LCBO":{tags:{name:"LCBO",shop:"alcohol"},name:"LCBO",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/Ароматный мир":{tags:{name:"\u0410\u0440\u043E\u043C\u0430\u0442\u043D\u044B\u0439 \u043C\u0438\u0440",shop:"alcohol"},name:"\u0410\u0440\u043E\u043C\u0430\u0442\u043D\u044B\u0439 \u043C\u0438\u0440",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/Bargain Booze":{tags:{name:"Bargain Booze",shop:"alcohol"},name:"Bargain Booze",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/Nicolas":{tags:{name:"Nicolas",shop:"alcohol"},name:"Nicolas",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/BWS":{tags:{name:"BWS",shop:"alcohol"},name:"BWS",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/Botilleria":{tags:{name:"Botilleria",shop:"alcohol"},name:"Botilleria",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/SAQ":{tags:{name:"SAQ",shop:"alcohol"},name:"SAQ",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/Gall & Gall":{tags:{name:"Gall & Gall",shop:"alcohol"},name:"Gall & Gall",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/alcohol/Живое пиво":{tags:{name:"\u0416\u0438\u0432\u043E\u0435 \u043F\u0438\u0432\u043E",shop:"alcohol"},name:"\u0416\u0438\u0432\u043E\u0435 \u043F\u0438\u0432\u043E",icon:"alcohol-shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Kamps":{tags:{name:"Kamps",shop:"bakery"},name:"Kamps",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Banette":{tags:{name:"Banette",shop:"bakery"},name:"Banette",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Bäckerei Schmidt":{tags:{name:"B\xE4ckerei Schmidt",shop:"bakery"},name:"B\xE4ckerei Schmidt",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Anker":{tags:{name:"Anker",shop:"bakery"},name:"Anker",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Hofpfisterei":{tags:{name:"Hofpfisterei",shop:"bakery"},name:"Hofpfisterei",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Greggs":{tags:{name:"Greggs",shop:"bakery"},name:"Greggs",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Oebel":{tags:{name:"Oebel",shop:"bakery"},name:"Oebel",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Boulangerie":{tags:{name:"Boulangerie",shop:"bakery"},name:"Boulangerie",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Stadtbäckerei":{tags:{name:"Stadtb\xE4ckerei",shop:"bakery"},name:"Stadtb\xE4ckerei",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Steinecke":{tags:{name:"Steinecke",shop:"bakery"},name:"Steinecke",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Ihle":{tags:{name:"Ihle",shop:"bakery"},name:"Ihle",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Goldilocks":{tags:{name:"Goldilocks",shop:"bakery"},name:"Goldilocks",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Dat Backhus":{tags:{name:"Dat Backhus",shop:"bakery"},name:"Dat Backhus",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/K&U":{tags:{name:"K&U",shop:"bakery"},name:"K&U",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Der Beck":{tags:{name:"Der Beck",shop:"bakery"},name:"Der Beck",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Thürmann":{tags:{name:"Th\xFCrmann",shop:"bakery"},name:"Th\xFCrmann",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Backwerk":{tags:{name:"Backwerk",shop:"bakery"},name:"Backwerk",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Bäcker":{tags:{name:"B\xE4cker",shop:"bakery"},name:"B\xE4cker",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Schäfer's":{tags:{name:"Sch\xE4fer's",shop:"bakery"},name:"Sch\xE4fer's",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Panaderia":{tags:{name:"Panaderia",shop:"bakery"},name:"Panaderia",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Goeken backen":{tags:{name:"Goeken backen",shop:"bakery"},name:"Goeken backen",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Stadtbäckerei Junge":{tags:{name:"Stadtb\xE4ckerei Junge",shop:"bakery"},name:"Stadtb\xE4ckerei Junge",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Boulangerie Patisserie":{tags:{name:"Boulangerie Patisserie",shop:"bakery"},name:"Boulangerie Patisserie",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Paul":{tags:{name:"Paul",shop:"bakery"},name:"Paul",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Хлеб":{tags:{name:"\u0425\u043B\u0435\u0431",shop:"bakery"},name:"\u0425\u043B\u0435\u0431",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Piekarnia":{tags:{name:"Piekarnia",shop:"bakery"},name:"Piekarnia",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Пекарня":{tags:{name:"\u041F\u0435\u043A\u0430\u0440\u043D\u044F",shop:"bakery"},name:"\u041F\u0435\u043A\u0430\u0440\u043D\u044F",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/bakery/Кулиничи":{tags:{name:"\u041A\u0443\u043B\u0438\u043D\u0438\u0447\u0438",shop:"bakery"},name:"\u041A\u0443\u043B\u0438\u043D\u0438\u0447\u0438",icon:"bakery",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/sports/Sports Direct":{tags:{name:"Sports Direct",shop:"sports"},name:"Sports Direct",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/sports/Decathlon":{tags:{name:"Decathlon",shop:"sports"},name:"Decathlon",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/sports/Intersport":{tags:{name:"Intersport",shop:"sports"},name:"Intersport",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/sports/Sports Authority":{tags:{name:"Sports Authority",shop:"sports"},name:"Sports Authority",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/sports/Спортмастер":{tags:{name:"\u0421\u043F\u043E\u0440\u0442\u043C\u0430\u0441\u0442\u0435\u0440",shop:"sports"},name:"\u0421\u043F\u043E\u0440\u0442\u043C\u0430\u0441\u0442\u0435\u0440",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/sports/Sport 2000":{tags:{name:"Sport 2000",shop:"sports"},name:"Sport 2000",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/sports/Dick's Sporting Goods":{tags:{name:"Dick's Sporting Goods",shop:"sports"},name:"Dick's Sporting Goods",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/variety_store/Tedi":{tags:{name:"Tedi",shop:"variety_store"},name:"Tedi",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/variety_store/Dollarama":{tags:{name:"Dollarama",shop:"variety_store"},name:"Dollarama",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/variety_store/Family Dollar":{tags:{name:"Family Dollar",shop:"variety_store"},name:"Family Dollar",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/variety_store/Dollar Tree":{tags:{name:"Dollar Tree",shop:"variety_store"},name:"Dollar Tree",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/pet/Fressnapf":{tags:{name:"Fressnapf",shop:"pet"},name:"Fressnapf",icon:"dog-park",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/pet/PetSmart":{tags:{name:"PetSmart",shop:"pet"},name:"PetSmart",icon:"dog-park",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/pet/Das Futterhaus":{tags:{name:"Das Futterhaus",shop:"pet"},name:"Das Futterhaus",icon:"dog-park",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/pet/Pets at Home":{tags:{name:"Pets at Home",shop:"pet"},name:"Pets at Home",icon:"dog-park",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/pet/Petco":{tags:{name:"Petco",shop:"pet"},name:"Petco",icon:"dog-park",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/pet/Зоомагазин":{tags:{name:"\u0417\u043E\u043E\u043C\u0430\u0433\u0430\u0437\u0438\u043D",shop:"pet"},name:"\u0417\u043E\u043E\u043C\u0430\u0433\u0430\u0437\u0438\u043D",icon:"dog-park",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Deichmann":{tags:{name:"Deichmann",shop:"shoes"},name:"Deichmann",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Reno":{tags:{name:"Reno",shop:"shoes"},name:"Reno",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Ecco":{tags:{name:"Ecco",shop:"shoes"},name:"Ecco",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Clarks":{tags:{name:"Clarks",shop:"shoes"},name:"Clarks",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/La Halle aux Chaussures":{tags:{name:"La Halle aux Chaussures",shop:"shoes"},name:"La Halle aux Chaussures",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Brantano":{tags:{name:"Brantano",shop:"shoes"},name:"Brantano",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Geox":{tags:{name:"Geox",shop:"shoes"},name:"Geox",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Salamander":{tags:{name:"Salamander",shop:"shoes"},name:"Salamander",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Обувь":{tags:{name:"\u041E\u0431\u0443\u0432\u044C",shop:"shoes"},name:"\u041E\u0431\u0443\u0432\u044C",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Payless Shoe Source":{tags:{name:"Payless Shoe Source",shop:"shoes"},name:"Payless Shoe Source",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Famous Footwear":{tags:{name:"Famous Footwear",shop:"shoes"},name:"Famous Footwear",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Quick Schuh":{tags:{name:"Quick Schuh",shop:"shoes"},name:"Quick Schuh",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Shoe Zone":{tags:{name:"Shoe Zone",shop:"shoes"},name:"Shoe Zone",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Foot Locker":{tags:{name:"Foot Locker",shop:"shoes"},name:"Foot Locker",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/Bata":{tags:{name:"Bata",shop:"shoes"},name:"Bata",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/shoes/ЦентрОбувь":{tags:{name:"\u0426\u0435\u043D\u0442\u0440\u041E\u0431\u0443\u0432\u044C",shop:"shoes"},name:"\u0426\u0435\u043D\u0442\u0440\u041E\u0431\u0443\u0432\u044C",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/toys/La Grande Récré":{tags:{name:"La Grande R\xE9cr\xE9",shop:"toys"},name:"La Grande R\xE9cr\xE9",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/toys/Toys R Us":{tags:{name:"Toys R Us",shop:"toys"},name:"Toys R Us",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/toys/Intertoys":{tags:{name:"Intertoys",shop:"toys"},name:"Intertoys",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/toys/Детский мир":{tags:{name:"\u0414\u0435\u0442\u0441\u043A\u0438\u0439 \u043C\u0438\u0440",shop:"toys"},name:"\u0414\u0435\u0442\u0441\u043A\u0438\u0439 \u043C\u0438\u0440",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/toys/Игрушки":{tags:{name:"\u0418\u0433\u0440\u0443\u0448\u043A\u0438",shop:"toys"},name:"\u0418\u0433\u0440\u0443\u0448\u043A\u0438",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/travel_agency/Flight Centre":{tags:{name:"Flight Centre",shop:"travel_agency"},name:"Flight Centre",icon:"suitcase",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/travel_agency/Thomas Cook":{tags:{name:"Thomas Cook",shop:"travel_agency"},name:"Thomas Cook",icon:"suitcase",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/jewelry/Bijou Brigitte":{tags:{name:"Bijou Brigitte",shop:"jewelry"},name:"Bijou Brigitte",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/jewelry/Christ":{tags:{name:"Christ",shop:"jewelry"},name:"Christ",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/jewelry/Swarovski":{tags:{name:"Swarovski",shop:"jewelry"},name:"Swarovski",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/optician/Fielmann":{tags:{name:"Fielmann",shop:"optician"},name:"Fielmann",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/optician/Apollo Optik":{tags:{name:"Apollo Optik",shop:"optician"},name:"Apollo Optik",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/optician/Vision Express":{tags:{name:"Vision Express",shop:"optician"},name:"Vision Express",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/optician/Оптика":{tags:{name:"\u041E\u043F\u0442\u0438\u043A\u0430",shop:"optician"},name:"\u041E\u043F\u0442\u0438\u043A\u0430",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/optician/Optic 2000":{tags:{name:"Optic 2000",shop:"optician"},name:"Optic 2000",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/optician/Alain Afflelou":{tags:{name:"Alain Afflelou",shop:"optician"},name:"Alain Afflelou",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/optician/Specsavers":{tags:{name:"Specsavers",shop:"optician"},name:"Specsavers",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/optician/Krys":{tags:{name:"Krys",shop:"optician"},name:"Krys",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/optician/Atol":{tags:{name:"Atol",shop:"optician"},name:"Atol",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/video/Blockbuster":{tags:{name:"Blockbuster",shop:"video"},name:"Blockbuster",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/video/World of Video":{tags:{name:"World of Video",shop:"video"},name:"World of Video",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Билайн":{tags:{name:"\u0411\u0438\u043B\u0430\u0439\u043D",shop:"mobile_phone"},name:"\u0411\u0438\u043B\u0430\u0439\u043D",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/ソフトバンクショップ (SoftBank shop)":{tags:{name:"\u30BD\u30D5\u30C8\u30D0\u30F3\u30AF\u30B7\u30E7\u30C3\u30D7 (SoftBank shop)",shop:"mobile_phone"},name:"\u30BD\u30D5\u30C8\u30D0\u30F3\u30AF\u30B7\u30E7\u30C3\u30D7 (SoftBank shop)",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Vodafone":{tags:{name:"Vodafone",shop:"mobile_phone"},name:"Vodafone",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/O2":{tags:{name:"O2",shop:"mobile_phone"},name:"O2",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Carphone Warehouse":{tags:{name:"Carphone Warehouse",shop:"mobile_phone"},name:"Carphone Warehouse",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Orange":{tags:{name:"Orange",shop:"mobile_phone"},name:"Orange",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Verizon Wireless":{tags:{name:"Verizon Wireless",shop:"mobile_phone"},name:"Verizon Wireless",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Sprint":{tags:{name:"Sprint",shop:"mobile_phone"},name:"Sprint",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/T-Mobile":{tags:{name:"T-Mobile",shop:"mobile_phone"},name:"T-Mobile",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/МТС":{tags:{name:"\u041C\u0422\u0421",shop:"mobile_phone"},name:"\u041C\u0422\u0421",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Евросеть":{tags:{name:"\u0415\u0432\u0440\u043E\u0441\u0435\u0442\u044C",shop:"mobile_phone"},name:"\u0415\u0432\u0440\u043E\u0441\u0435\u0442\u044C",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Bell":{tags:{name:"Bell",shop:"mobile_phone"},name:"Bell",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/The Phone House":{tags:{name:"The Phone House",shop:"mobile_phone"},name:"The Phone House",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/SFR":{tags:{name:"SFR",shop:"mobile_phone"},name:"SFR",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Связной":{tags:{name:"\u0421\u0432\u044F\u0437\u043D\u043E\u0439",shop:"mobile_phone"},name:"\u0421\u0432\u044F\u0437\u043D\u043E\u0439",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Мегафон":{tags:{name:"\u041C\u0435\u0433\u0430\u0444\u043E\u043D",shop:"mobile_phone"},name:"\u041C\u0435\u0433\u0430\u0444\u043E\u043D",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/AT&T":{tags:{name:"AT&T",shop:"mobile_phone"},name:"AT&T",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/ドコモショップ (docomo shop)":{tags:{name:"\u30C9\u30B3\u30E2\u30B7\u30E7\u30C3\u30D7 (docomo shop)",shop:"mobile_phone"},name:"\u30C9\u30B3\u30E2\u30B7\u30E7\u30C3\u30D7 (docomo shop)",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/au":{tags:{name:"au",shop:"mobile_phone"},name:"au",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Movistar":{tags:{name:"Movistar",shop:"mobile_phone"},name:"Movistar",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/mobile_phone/Bitė":{tags:{name:"Bit\u0117",shop:"mobile_phone"},name:"Bit\u0117",icon:"mobilephone",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/computer/PC World":{tags:{name:"PC World",shop:"computer"},name:"PC World",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/computer/DNS":{tags:{name:"DNS",shop:"computer"},name:"DNS",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hairdresser/Klier":{tags:{name:"Klier",shop:"hairdresser"},name:"Klier",icon:"hairdresser",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hairdresser/Supercuts":{tags:{name:"Supercuts",shop:"hairdresser"},name:"Supercuts",icon:"hairdresser",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hairdresser/Hairkiller":{tags:{name:"Hairkiller",shop:"hairdresser"},name:"Hairkiller",icon:"hairdresser",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hairdresser/Great Clips":{tags:{name:"Great Clips",shop:"hairdresser"},name:"Great Clips",icon:"hairdresser",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hairdresser/Парикмахерская":{tags:{name:"\u041F\u0430\u0440\u0438\u043A\u043C\u0430\u0445\u0435\u0440\u0441\u043A\u0430\u044F",shop:"hairdresser"},name:"\u041F\u0430\u0440\u0438\u043A\u043C\u0430\u0445\u0435\u0440\u0441\u043A\u0430\u044F",icon:"hairdresser",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hairdresser/Стиль":{tags:{name:"\u0421\u0442\u0438\u043B\u044C",shop:"hairdresser"},name:"\u0421\u0442\u0438\u043B\u044C",icon:"hairdresser",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hairdresser/Fryzjer":{tags:{name:"Fryzjer",shop:"hairdresser"},name:"Fryzjer",icon:"hairdresser",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hairdresser/Franck Provost":{tags:{name:"Franck Provost",shop:"hairdresser"},name:"Franck Provost",icon:"hairdresser",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hairdresser/Салон красоты":{tags:{name:"\u0421\u0430\u043B\u043E\u043D \u043A\u0440\u0430\u0441\u043E\u0442\u044B",shop:"hairdresser"},name:"\u0421\u0430\u043B\u043E\u043D \u043A\u0440\u0430\u0441\u043E\u0442\u044B",icon:"hairdresser",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hardware/1000 мелочей":{tags:{name:"1000 \u043C\u0435\u043B\u043E\u0447\u0435\u0439",shop:"hardware"},name:"1000 \u043C\u0435\u043B\u043E\u0447\u0435\u0439",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/hardware/Хозтовары":{tags:{name:"\u0425\u043E\u0437\u0442\u043E\u0432\u0430\u0440\u044B",shop:"hardware"},name:"\u0425\u043E\u0437\u0442\u043E\u0432\u0430\u0440\u044B",icon:"shop",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true},"shop/motorcycle/Yamaha":{tags:{name:"Yamaha",shop:"motorcycle"},name:"Yamaha",icon:"scooter",geometry:["point","vertex","area"],fields:["address","building_area","opening_hours"],suggestion:true}};;iD.data.en={modes:{add_area:{title:"Area",description:"Add parks, buildings, lakes or other areas to the map.",tail:"Click on the map to start drawing an area, like a park, lake, or building."},add_line:{title:"Line",description:"Add highways, streets, pedestrian paths, canals or other lines to the map.",tail:"Click on the map to start drawing a road, path, or route."},add_point:{title:"Point",description:"Add restaurants, monuments, postal boxes or other points to the map.",tail:"Click on the map to add a point."},browse:{title:"Browse",description:"Pan and zoom the map."},draw_area:{tail:"Click to add nodes to your area. Click the first node to finish the area."},draw_line:{tail:"Click to add more nodes to the line. Click on other lines to connect to them, and double-click to end the line."}},operations:{add:{annotation:{point:"Added a point.",vertex:"Added a node to a way.",relation:"Added a relation."}},start:{annotation:{line:"Started a line.",area:"Started an area."}},continue:{key:"A",title:"Continue",description:"Continue this line.",not_eligible:"No line can be continued here.",multiple:"Several lines can be continued here. To choose a line, press the Shift key and click on it to select it.",annotation:{line:"Continued a line.",area:"Continued an area."}},cancel_draw:{annotation:"Canceled drawing."},change_role:{annotation:"Changed the role of a relation member."},change_tags:{annotation:"Changed tags."},circularize:{title:"Circularize",description:{line:"Make this line circular.",area:"Make this area circular."},key:"O",annotation:{line:"Made a line circular.",area:"Made an area circular."},not_closed:"This can't be made circular because it's not a loop.",too_large:"This can't be made circular because not enough of it is currently visible."},orthogonalize:{title:"Square",description:{line:"Square the corners of this line.",area:"Square the corners of this area."},key:"S",annotation:{line:"Squared the corners of a line.",area:"Squared the corners of an area."},not_squarish:"This can't be made square because it is not squarish.",too_large:"This can't be made square because not enough of it is currently visible."},straighten:{title:"Straighten",description:"Straighten this line.",key:"S",annotation:"Straightened a line.",too_bendy:"This can't be straightened because it bends too much."},delete:{title:"Delete",description:"Remove this from the map.",annotation:{point:"Deleted a point.",vertex:"Deleted a node from a way.",line:"Deleted a line.",area:"Deleted an area.",relation:"Deleted a relation.",multiple:"Deleted {n} objects."},incomplete_relation:"This feature can't be deleted because it hasn't been fully downloaded."},add_member:{annotation:"Added a member to a relation."},delete_member:{annotation:"Removed a member from a relation."},connect:{annotation:{point:"Connected a way to a point.",vertex:"Connected a way to another.",line:"Connected a way to a line.",area:"Connected a way to an area."}},clone:{title:"Clone",description:"Clone",key:"",annotation:"Clone lines/areas/points."},disconnect:{title:"Disconnect",description:"Disconnect these lines/areas from each other.",key:"D",annotation:"Disconnected lines/areas.",not_connected:"There aren't enough lines/areas here to disconnect."},merge:{title:"Merge",description:"Merge these lines.",key:"C",annotation:"Merged {n} lines.",not_eligible:"These features can't be merged.",not_adjacent:"These lines can't be merged because they aren't connected.",restriction:"These lines can't be merged because at least one is a member of a \"{relation}\" relation.",incomplete_relation:"These features can't be merged because at least one hasn't been fully downloaded."},move:{title:"Move",description:"Move this to a different location.",key:"M",annotation:{point:"Moved a point.",vertex:"Moved a node in a way.",line:"Moved a line.",area:"Moved an area.",multiple:"Moved multiple objects."},incomplete_relation:"This feature can't be moved because it hasn't been fully downloaded.",too_large:"This can't be moved because not enough of it is currently visible."},rotate:{title:"Rotate",description:"Rotate this object around its center point.",key:"R",annotation:{line:"Rotated a line.",area:"Rotated an area."},too_large:"This can't be rotated because not enough of it is currently visible."},reverse:{title:"Reverse",description:"Make this line go in the opposite direction.",key:"V",annotation:"Reversed a line."},split:{title:"Split",description:{line:"Split this line into two at this node.",area:"Split the boundary of this area into two.",multiple:"Split the lines/area boundaries at this node into two."},key:"X",annotation:{line:"Split a line.",area:"Split an area boundary.",multiple:"Split {n} lines/area boundaries."},not_eligible:"Lines can't be split at their beginning or end.",multiple_ways:"There are too many lines here to split."},restriction:{help:{select:"Click to select a road segment.",toggle:"Click to toggle turn restrictions.",toggle_on:"Click to add a \"{restriction}\" restriction.",toggle_off:"Click to remove the \"{restriction}\" restriction."},annotation:{create:"Added a turn restriction",delete:"Deleted a turn restriction"}}},pagination:{first:"First",pre:"Pre",next:"Next",last:"Last",total:"Total"},undo:{tooltip:"Undo: {action}",nothing:"Nothing to undo."},redo:{tooltip:"Redo: {action}",nothing:"Nothing to redo."},tooltip_keyhint:"Shortcut:",browser_notice:"This editor is supported in Firefox, Chrome, Safari, Opera, and Internet Explorer 9 and above. Please upgrade your browser or use Potlatch 2 to edit the map.",translate:{translate:"Translate",localized_translation_label:"Multilingual name",localized_translation_language:"Choose language",localized_translation_name:"Name"},zoom_in_edit:"Zoom in to Edit",logout:"logout",loading_auth:"Connecting to OpenStreetMap...",report_a_bug:"report a bug",status:{error:"Unable to connect to API.",offline:"The API is offline. Please try editing later.",readonly:"The API is read-only. You will need to wait to save your changes."},commit:{title:"Save Changes",description_placeholder:"Brief description of your contributions",message_label:"Commit message",upload_explanation:"The changes you upload will be visible on all maps that use OpenStreetMap data.",upload_explanation_with_user:"The changes you upload as {user} will be visible on all maps that use OpenStreetMap data.",save:"Save",cancel:"Cancel",warnings:"Warnings",modified:"Modified",deleted:"Deleted",created:"Created"},contributors:{list:"Edits by {users}",truncated_list:"Edits by {users} and {count} others"},geocoder:{search:"Search worldwide...",no_results_visible:"No results in visible map area",no_results_worldwide:"No results found"},geolocate:{title:"Show My Location"},inspector:{no_documentation_combination:"There is no documentation available for this tag combination",no_documentation_key:"There is no documentation available for this key",show_more:"Show More",view_on_osm:"View on openstreetmap.org",all_tags:"All tags",all_members:"All members",all_relations:"All relations",new_relation:"New relation...",role:"Role",choose:"Select feature type",results:"{n} results for {search}",reference:"View on OpenStreetMap Wiki",back_tooltip:"Change feature",remove:"Remove",search:"Search",multiselect:"Selected items",unknown:"Unknown",incomplete:"<not downloaded>",feature_list:"Search features",edit:"Edit feature",check:{yes:"Yes",no:"No"},none:"None",node:"Node",way:"Way",relation:"Relation",location:"Location",readonly_title:"ReadOnly",input_placeholder_error:"error",data_list_tab_name:"Data List",style_setting_tab_name:"Style Setting"},background:{title:"Background",description:"Background settings",percent_brightness:"{opacity}% brightness",none:"None",custom:"Custom",custom_button:"Edit custom background",custom_prompt:"Enter a tile URL template. Valid tokens are {z}, {x}, {y} for Z/X/Y scheme and {u} for quadtile scheme.",fix_misalignment:"Fix alignment",reset:"reset"},restore:{heading:"You have unsaved changes",description:"Do you wish to restore unsaved changes from a previous editing session?",restore:"Restore",reset:"Reset"},save:{title:"Save",help:"Save changes to OpenStreetMap, making them visible to other users.",no_changes:"No changes to save.",error:"An error occurred while trying to save",uploading:"Uploading changes to OpenStreetMap.",unsaved_changes:"You have unsaved changes"},success:{edited_osm:"Edited OSM!",just_edited:"You just edited OpenStreetMap!",view_on_osm:"View on OSM",facebook:"Share on Facebook",twitter:"Share on Twitter",google:"Share on Google+",help_html:"Your changes should appear in the \"Standard\" layer in a few minutes. Other layers, and certain features, may take longer\n(<a href='https://help.openstreetmap.org/questions/4705/why-havent-my-changes-appeared-on-the-map' target='_blank'>details</a>).\n"},confirm:{okay:"Okay"},splash:{welcome:"Welcome to the iD OpenStreetMap editor",text:"iD is a friendly but powerful tool for contributing to the world's best free world map. This is version {version}. For more information see {website} and report bugs at {github}.",walkthrough:"Start the Walkthrough",start:"Edit Now"},source_switch:{live:"live",lose_changes:"You have unsaved changes. Switching the map server will discard them. Are you sure you want to switch servers?",dev:"dev"},tag_reference:{description:"Description",on_wiki:"{tag} on wiki.osm.org",used_with:"used with {type}"},validations:{untagged_point:"Untagged point",untagged_line:"Untagged line",untagged_area:"Untagged area",many_deletions:"You're deleting {n} objects. Are you sure you want to do this? This will delete them from the map that everyone else sees on openstreetmap.org.",tag_suggests_area:"The tag {tag} suggests line should be area, but it is not an area",untagged_point_tooltip:"Select a feature type that describes what this point is.",untagged_line_tooltip:"Select a feature type that describes what this line is.",untagged_area_tooltip:"Select a feature type that describes what this area is.",deprecated_tags:"Deprecated tags: {tags}"},zoom:{in:"Zoom In",out:"Zoom Out"},cannot_zoom:"Cannot zoom out further in current mode.",gpx:{local_layer:"Local GPX file",drag_drop:"Drag and drop a .gpx file on the page, or click the button to the right to browse",zoom:"Zoom to GPX track",browse:"Browse for a .gpx file"},help:{title:"Help",help:"# Help\n\nThis is an editor for [OpenStreetMap](http://www.openstreetmap.org/), the\nfree and editable map of the world. You can use it to add and update\ndata in your area, making an open-source and open-data map of the world\nbetter for everyone.\n\nEdits that you make on this map will be visible to everyone who uses\nOpenStreetMap. In order to make an edit, you'll need a\n[free OpenStreetMap account](https://www.openstreetmap.org/user/new).\n\nThe [iD editor](http://ideditor.com/) is a collaborative project with [source\ncode available on GitHub](https://github.com/openstreetmap/iD).\n",editing_saving:"# Editing & Saving\n\nThis editor is designed to work primarily online, and you're accessing\nit through a website right now.\n\n### Selecting Features\n\nTo select a map feature, like a road or point of interest, click\non it on the map. This will highlight the selected feature, open a panel with\ndetails about it, and show a menu of things you can do with the feature.\n\nTo select multiple features, hold down the 'Shift' key. Then either click\non the features you want to select, or drag on the map to draw a rectangle.\nThis will draw a box and select all the points within it.\n\n### Saving Edits\n\nWhen you make changes like editing roads, buildings, and places, these are\nstored locally until you save them to the server. Don't worry if you make\na mistake - you can undo changes by clicking the undo button, and redo\nchanges by clicking the redo button.\n\nClick 'Save' to finish a group of edits - for instance, if you've completed\nan area of town and would like to start on a new area. You'll have a chance\nto review what you've done, and the editor supplies helpful suggestions\nand warnings if something doesn't seem right about the changes.\n\nIf everything looks good, you can enter a short comment explaining the change\nyou made, and click 'Save' again to post the changes\nto [OpenStreetMap.org](http://www.openstreetmap.org/), where they are visible\nto all other users and available for others to build and improve upon.\n\nIf you can't finish your edits in one sitting, you can leave the editor\nwindow and come back (on the same browser and computer), and the\neditor application will offer to restore your work.\n",roads:"# Roads\n\nYou can create, fix, and delete roads with this editor. Roads can be all\nkinds: paths, highways, trails, cycleways, and more - any often-crossed\nsegment should be mappable.\n\n### Selecting\n\nClick on a road to select it. An outline should become visible, along\nwith a small tools menu on the map and a sidebar showing more information\nabout the road.\n\n### Modifying\n\nOften you'll see roads that aren't aligned to the imagery behind them\nor to a GPS track. You can adjust these roads so they are in the correct\nplace.\n\nFirst click on the road you want to change. This will highlight it and show\ncontrol points along it that you can drag to better locations. If\nyou want to add new control points for more detail, double-click a part\nof the road without a node, and one will be added.\n\nIf the road connects to another road, but doesn't properly connect on\nthe map, you can drag one of its control points onto the other road in\norder to join them. Having roads connect is important for the map\nand essential for providing driving directions.\n\nYou can also click the 'Move' tool or press the `M` shortcut key to move the entire road at\none time, and then click again to save that movement.\n\n### Deleting\n\nIf a road is entirely incorrect - you can see that it doesn't exist in satellite\nimagery and ideally have confirmed locally that it's not present - you can delete\nit, which removes it from the map. Be cautious when deleting features -\nlike any other edit, the results are seen by everyone and satellite imagery\nis often out of date, so the road could simply be newly built.\n\nYou can delete a road by clicking on it to select it, then clicking the\ntrash can icon or pressing the 'Delete' key.\n\n### Creating\n\nFound somewhere there should be a road but there isn't? Click the 'Line'\nicon in the top-left of the editor or press the shortcut key `2` to start drawing\na line.\n\nClick on the start of the road on the map to start drawing. If the road\nbranches off from an existing road, start by clicking on the place where they connect.\n\nThen click on points along the road so that it follows the right path, according\nto satellite imagery or GPS. If the road you are drawing crosses another road, connect\nit by clicking on the intersection point. When you're done drawing, double-click\nor press 'Return' or 'Enter' on your keyboard.\n",gps:"# GPS\n\nGPS data is the most trusted source of data for OpenStreetMap. This editor\nsupports local traces - `.gpx` files on your local computer. You can collect\nthis kind of GPS trace with a number of smartphone applications as well as\npersonal GPS hardware.\n\nFor information on how to perform a GPS survey, read\n[Surveying with a GPS](http://learnosm.org/en/beginner/using-gps/).\n\nTo use a GPX track for mapping, drag and drop the GPX file onto the map\neditor. If it's recognized, it will be added to the map as a bright green\nline. Click on the 'Background Settings' menu on the right side to enable,\ndisable, or zoom to this new GPX-powered layer.\n\nThe GPX track isn't directly uploaded to OpenStreetMap - the best way to\nuse it is to draw on the map, using it as a guide for the new features that\nyou add, and also to [upload it to OpenStreetMap](http://www.openstreetmap.org/trace/create)\nfor other users to use.\n",imagery:"# Imagery\n\nAerial imagery is an important resource for mapping. A combination of\nairplane flyovers, satellite views, and freely-compiled sources are available\nin the editor under the 'Background Settings' menu on the right.\n\nBy default a [Bing Maps](http://www.bing.com/maps/) satellite layer is\npresented in the editor, but as you pan and zoom the map to new geographical\nareas, new sources will become available. Some countries, like the United\nStates, France, and Denmark have very high-quality imagery available for some areas.\n\nImagery is sometimes offset from the map data because of a mistake on the\nimagery provider's side. If you see a lot of roads shifted from the background,\ndon't immediately move them all to match the background. Instead you can adjust\nthe imagery so that it matches the existing data by clicking 'Fix alignment' at\nthe bottom of the Background Settings UI.\n",addresses:"# Addresses\n\nAddresses are some of the most useful information for the map.\n\nAlthough addresses are often represented as parts of streets, in OpenStreetMap\nthey're recorded as attributes of buildings and places along streets.\n\nYou can add address information to places mapped as building outlines\nas well as those mapped as single points. The optimal source of address\ndata is from an on-the-ground survey or personal knowledge - as with any\nother feature, copying from commercial sources like Google Maps is strictly\nforbidden.\n",inspector:"# Using the Inspector\n\nThe inspector is the section on the left side of the page that allows you to\nedit the details of the selected feature.\n\n### Selecting a Feature Type\n\nAfter you add a point, line, or area, you can choose what type of feature it\nis, like whether it's a highway or residential road, supermarket or cafe.\nThe inspector will display buttons for common feature types, and you can\nfind others by typing what you're looking for in the search box.\n\nClick the 'i' in the bottom-right-hand corner of a feature type button to\nlearn more about it. Click a button to choose that type.\n\n### Using Forms and Editing Tags\n\nAfter you choose a feature type, or when you select a feature that already\nhas a type assigned, the inspector will display fields with details about\nthe feature like its name and address.\n\nBelow the fields you see, you can click icons to add other details,\nlike [Wikipedia](http://www.wikipedia.org/) information, wheelchair\naccess, and more.\n\nAt the bottom of the inspector, click 'Additional tags' to add arbitrary\nother tags to the element. [Taginfo](http://taginfo.openstreetmap.org/) is a\ngreat resource for learn more about popular tag combinations.\n\nChanges you make in the inspector are automatically applied to the map.\nYou can undo them at any time by clicking the 'Undo' button.\n",buildings:"# Buildings\n\nOpenStreetMap is the world's largest database of buildings. You can create\nand improve this database.\n\n### Selecting\n\nYou can select a building by clicking on its border. This will highlight the\nbuilding and open a small tools menu and a sidebar showing more information\nabout the building.\n\n### Modifying\n\nSometimes buildings are incorrectly placed or have incorrect tags.\n\nTo move an entire building, select it, then click the 'Move' tool. Move your\nmouse to shift the building, and click when it's correctly placed.\n\nTo fix the specific shape of a building, click and drag the nodes that form\nits border into better places.\n\n### Creating\n\nOne of the main questions around adding buildings to the map is that\nOpenStreetMap records buildings both as shapes and points. The rule of thumb\nis to _map a building as a shape whenever possible_, and map companies, homes,\namenities, and other things that operate out of buildings as points placed\nwithin the building shape.\n\nStart drawing a building as a shape by clicking the 'Area' button in the top\nleft of the interface, and end it either by pressing 'Return' on your keyboard\nor clicking on the first node drawn to close the shape.\n\n### Deleting\n\nIf a building is entirely incorrect - you can see that it doesn't exist in satellite\nimagery and ideally have confirmed locally that it's not present - you can delete\nit, which removes it from the map. Be cautious when deleting features -\nlike any other edit, the results are seen by everyone and satellite imagery\nis often out of date, so the building could simply be newly built.\n\nYou can delete a building by clicking on it to select it, then clicking the\ntrash can icon or pressing the 'Delete' key.\n",relations:"# Relations\n\nA relation is a special type of feature in OpenStreetMap that groups together\nother features. For example, two common types of relations are *route relations*,\nwhich group together sections of road that belong to a specific freeway or\nhighway, and *multipolygons*, which group together several lines that define\na complex area (one with several pieces or holes in it like a donut).\n\nThe group of features in a relation are called *members*. In the sidebar, you can\nsee which relations a feature is a member of, and click on a relation there\nto select the it. When the relation is selected, you can see all of its\nmembers listed in the sidebar and highlighted on the map.\n\nFor the most part, iD will take care of maintaining relations automatically\nwhile you edit. The main thing you should be aware of is that if you delete a\nsection of road to redraw it more accurately, you should make sure that the\nnew section is a member of the same relations as the original.\n\n## Editing Relations\n\nIf you want to edit relations, here are the basics.\n\nTo add a feature to a relation, select the feature, click the \"+\" button in the\n\"All relations\" section of the sidebar, and select or type the name of the relation.\n\nTo create a new relation, select the first feature that should be a member,\nclick the \"+\" button in the \"All relations\" section, and select \"New relation...\".\n\nTo remove a feature from a relation, select the feature and click the trash\nbutton next to the relation you want to remove it from.\n\nYou can create multipolygons with holes using the \"Merge\" tool. Draw two areas (inner\nand outer), hold the Shift key and click on each of them to select them both, and then\nclick the \"Merge\" (+) button.\n"},intro:{navigation:{title:"Navigation",drag:"The main map area shows OpenStreetMap data on top of a background. You can navigate by dragging and scrolling, just like any web map. **Drag the map!**",select:"Map features are represented three ways: using points, lines or areas. All features can be selected by clicking on them. **Click on the point to select it.**",header:"The header shows us the feature type.",pane:"When a feature is selected, the feature editor is displayed. The header shows us the feature type and the main pane shows the feature's attributes, such as its name and address. **Close the feature editor with the close button in the top right.**"},points:{title:"Points",add:"Points can be used to represent features such as shops, restaurants and monuments. They mark a specific location, and describe what's there. **Click the Point button to add a new point.**",place:"The point can be placed by clicking on the map. **Place the point on top of the building.**",search:"There are many different features that can be represented by points. The point you just added is a Cafe. **Search for '{name}'**",choose:"**Choose Cafe from the list.**",describe:"The point is now marked as a cafe. Using the feature editor, we can add more information about the feature. **Add a name**",close:"The feature editor can be closed by clicking on the close button. **Close the feature editor**",reselect:"Often points will already exist, but have mistakes or be incomplete. We can edit existing points. **Select the point you just created.**",fixname:"**Change the name and close the feature editor.**",reselect_delete:"All features on the map can be deleted. **Click on the point you created.**",delete:"The menu around the point contains operations that can be performed on it, including delete. **Delete the point.**"},areas:{title:"Areas",add:"Areas are a more detailed way to represent features. They provide information on the boundaries of the feature. Areas can be used for most feature types points can be used for, and are often preferred. **Click the Area button to add a new area.**",corner:"Areas are drawn by placing nodes that mark the boundary of the area. **Place the starting node on one of the corners of the playground.**",place:"Draw the area by placing more nodes. Finish the area by clicking on the starting node. **Draw an area for the playground.**",search:"**Search for '{name}'.**",choose:"**Choose Playground from the list.**",describe:"**Add a name, and close the feature editor**"},lines:{title:"Lines",add:"Lines are used to represent features such as roads, railroads and rivers. **Click the Line button to add a new line.**",start:"**Start the line by clicking on the end of the road.**",intersect:"Click to add more nodes to the line. You can drag the map while drawing if necessary. Roads, and many other types of lines, are part of a larger network. It is important for these lines to be connected properly in order for routing applications to work. **Click on Flower Street, to create an intersection connecting the two lines.**",finish:"Lines can be finished by clicking on the last node again. **Finish drawing the road.**",road:"**Select Road from the list**",residential:"There are different types of roads, the most common of which is Residential. **Choose the Residential road type**",describe:"**Name the road and close the feature editor.**",restart:"The road needs to intersect Flower Street.",wrong_preset:"You didn't select the Residential road type. **Click here to choose again**"},startediting:{title:"Start Editing",help:"More documentation and this walkthrough are available here.",save:"Don't forget to regularly save your changes!",start:"Start mapping!"}},presets:{categories:{"category-building":{name:"Building"},"category-golf":{name:"Golf"},"category-landuse":{name:"Land Use"},"category-path":{name:"Path"},"category-rail":{name:"Rail"},"category-restriction":{name:"Restriction"},"category-road":{name:"Road"},"category-route":{name:"Route"},"category-water-area":{name:"Water"},"category-water-line":{name:"Water"}},fields:{access:{label:"Access",placeholder:"Unknown",types:{access:"General",foot:"Foot",motor_vehicle:"Motor Vehicles",bicycle:"Bicycles",horse:"Horses"},options:{yes:{title:"Allowed",description:"Access permitted by law; a right of way"},no:{title:"Prohibited",description:"Access not permitted to the general public"},permissive:{title:"Permissive",description:"Access permitted until such time as the owner revokes the permission"},private:{title:"Private",description:"Access permitted only with permission of the owner on an individual basis"},designated:{title:"Designated",description:"Access permitted according to signs or specific local laws"},destination:{title:"Destination",description:"Access permitted only to reach a destination"}}},access_simple:{label:"Access",placeholder:"yes"},access_toilets:{label:"Access"},address:{label:"Address",placeholders:{housename:"Housename",housenumber:"123",street:"Street",city:"City",postcode:"Postcode",place:"Place",hamlet:"Hamlet",suburb:"Suburb",subdistrict:"Subdistrict",district:"District",province:"Province",state:"State",country:"Country"}},admin_level:{label:"Admin Level"},aerialway:{label:"Type"},"aerialway/access":{label:"Access",options:{entry:"Entry",exit:"Exit",both:"Both"}},"aerialway/bubble":{label:"Bubble"},"aerialway/capacity":{label:"Capacity (per hour)",placeholder:"500, 2500, 5000..."},"aerialway/duration":{label:"Duration (minutes)",placeholder:"1, 2, 3..."},"aerialway/heating":{label:"Heated"},"aerialway/occupancy":{label:"Occupancy",placeholder:"2, 4, 8..."},"aerialway/summer/access":{label:"Access (summer)",options:{entry:"Entry",exit:"Exit",both:"Both"}},aeroway:{label:"Type"},amenity:{label:"Type"},artist:{label:"Artist"},artwork_type:{label:"Type"},atm:{label:"ATM"},backrest:{label:"Backrest"},barrier:{label:"Type"},bicycle_parking:{label:"Type"},boundary:{label:"Type"},building:{label:"Building"},building_area:{label:"Building"},capacity:{label:"Capacity",placeholder:"50, 100, 200..."},cardinal_direction:{label:"Direction",options:{N:"North",E:"East",S:"South",W:"West",NE:"Northeast",SE:"Southeast",SW:"Southwest",NW:"Northwest",NNE:"North-northeast",ENE:"East-northeast",ESE:"East-southeast",SSE:"South-southeast",SSW:"South-southwest",WSW:"West-southwest",WNW:"West-northwest",NNW:"North-northwest"}},clock_direction:{label:"Direction",options:{clockwise:"Clockwise",anticlockwise:"Counterclockwise"}},collection_times:{label:"Collection Times"},construction:{label:"Type"},country:{label:"Country"},covered:{label:"Covered"},crop:{label:"Crop"},crossing:{label:"Type"},cuisine:{label:"Cuisine"},denomination:{label:"Denomination"},denotation:{label:"Denotation"},description:{label:"Description"},electrified:{label:"Electrification",placeholder:"Contact Line, Electrified Rail...",options:{contact_line:"Contact Line",rail:"Electrified Rail",yes:"Yes (unspecified)",no:"No"}},elevation:{label:"Elevation"},emergency:{label:"Emergency"},entrance:{label:"Type"},except:{label:"Exceptions"},fax:{label:"Fax",placeholder:"+31 42 123 4567"},fee:{label:"Fee"},"fire_hydrant/type":{label:"Type",options:{pillar:"Pillar/Aboveground",underground:"Underground",wall:"Wall",pond:"Pond"}},fixme:{label:"Fix Me"},fuel:{label:"Fuel"},"fuel/biodiesel":{label:"Sells Biodiesel"},"fuel/diesel":{label:"Sells Diesel"},"fuel/e10":{label:"Sells E10"},"fuel/e85":{label:"Sells E85"},"fuel/lpg":{label:"Sells Propane"},"fuel/octane_100":{label:"Sells Racing Gasoline"},"fuel/octane_91":{label:"Sells Regular Gasoline"},"fuel/octane_95":{label:"Sells Midgrade Gasoline"},"fuel/octane_98":{label:"Sells Premium Gasoline"},gauge:{label:"Gauge"},"generator/method":{label:"Method"},"generator/source":{label:"Source"},"generator/type":{label:"Type"},golf_hole:{label:"Reference",placeholder:"Hole number (1-18)"},handicap:{label:"Handicap",placeholder:"1-18"},highway:{label:"Type"},historic:{label:"Type"},hoops:{label:"Hoops",placeholder:"1, 2, 4..."},iata:{label:"IATA"},icao:{label:"ICAO"},incline:{label:"Incline"},information:{label:"Type"},internet_access:{label:"Internet Access",options:{yes:"Yes",no:"No",wlan:"Wifi",wired:"Wired",terminal:"Terminal"}},lamp_type:{label:"Type"},landuse:{label:"Type"},lanes:{label:"Lanes",placeholder:"1, 2, 3..."},layer:{label:"Layer"},leisure:{label:"Type"},length:{label:"Length (Meters)"},levels:{label:"Levels",placeholder:"2, 4, 6..."},lit:{label:"Lit"},location:{label:"Location"},man_made:{label:"Type"},maxspeed:{label:"Speed Limit",placeholder:"40, 50, 60..."},"mtb/scale":{label:"Mountain Biking Difficulty",placeholder:"0, 1, 2, 3...",options:{0:"0: Solid gravel/packed earth, no obstacles, wide curves",1:"1: Some loose surface, small obstacles, wide curves",2:"2: Much loose surface, large obstacles, easy hairpins",3:"3: Slippery surface, large obstacles, tight hairpins",4:"4: Loose surface or boulders, dangerous hairpins",5:"5: Maximum difficulty, boulder fields, landslides",6:"6: Not rideable except by the very best mountain bikers"}},"mtb/scale/imba":{label:"IMBA Trail Difficulty",placeholder:"Easy, Medium, Difficult...",options:{0:"Easiest (white circle)",1:"Easy (green circle)",2:"Medium (blue square)",3:"Difficult (black diamond)",4:"Extremely Difficult (double black diamond)"}},"mtb/scale/uphill":{label:"Mountain Biking Uphill Difficulty",placeholder:"0, 1, 2, 3...",options:{0:"0: Avg. incline <10%, gravel/packed earth, no obstacles",1:"1: Avg. incline <15%, gravel/packed earth, few small objects",2:"2: Avg. incline <20%, stable surface, fistsize rocks/roots",3:"3: Avg. incline <25%, variable surface, fistsize rocks/branches",4:"4: Avg. incline <30%, poor condition, big rocks/branches",5:"5: Very steep, bike generally needs to be pushed or carried"}},name:{label:"Name",placeholder:"Common name (if any)"},natural:{label:"Natural"},network:{label:"Network"},note:{label:"Note"},office:{label:"Type"},oneway:{label:"One Way",options:{undefined:"Assumed to be No",yes:"Yes",no:"No"}},oneway_yes:{label:"One Way",options:{undefined:"Assumed to be Yes",yes:"Yes",no:"No"}},opening_hours:{label:"Hours"},operator:{label:"Operator"},par:{label:"Par",placeholder:"3, 4, 5..."},park_ride:{label:"Park and Ride"},parking:{label:"Type",options:{surface:"Surface","multi-storey":"Multilevel",underground:"Underground",sheds:"Sheds",carports:"Carports",garage_boxes:"Garage Boxes",lane:"Roadside Lane"}},phone:{label:"Phone",placeholder:"+31 42 123 4567"},"piste/difficulty":{label:"Difficulty",placeholder:"Easy, Intermediate, Advanced...",options:{novice:"Novice (instructional)",easy:"Easy (green circle)",intermediate:"Intermediate (blue square)",advanced:"Advanced (black diamond)",expert:"Expert (double black diamond)",freeride:"Freeride (off-piste)",extreme:"Extreme (climbing equipment required)"}},"piste/grooming":{label:"Grooming",options:{classic:"Classic",mogul:"Mogul",backcountry:"Backcountry","classic+skating":"Classic and Skating",scooter:"Scooter/Snowmobile",skating:"Skating"}},"piste/type":{label:"Type",options:{downhill:"Downhill",nordic:"Nordic",skitour:"Skitour",sled:"Sled",hike:"Hike",sleigh:"Sleigh",ice_skate:"Ice Skate",snow_park:"Snow Park",playground:"Playground"}},place:{label:"Type"},population:{label:"Population"},power:{label:"Type"},railway:{label:"Type"},"recycling/cans":{label:"Accepts Cans"},"recycling/clothes":{label:"Accepts Clothes"},"recycling/glass":{label:"Accepts Glass"},"recycling/paper":{label:"Accepts Paper"},ref:{label:"Reference"},relation:{label:"Type"},religion:{label:"Religion"},restriction:{label:"Type"},restrictions:{label:"Turn Restrictions"},route:{label:"Type"},route_master:{label:"Type"},sac_scale:{label:"Hiking Difficulty",placeholder:"Mountain Hiking, Alpine Hiking...",options:{hiking:"T1: Hiking",mountain_hiking:"T2: Mountain Hiking",demanding_mountain_hiking:"T3: Demanding Mountain Hiking",alpine_hiking:"T4: Alpine Hiking",demanding_alpine_hiking:"T5: Demanding Alpine Hiking",difficult_alpine_hiking:"T6: Difficult Alpine Hiking"}},seasonal:{label:"Seasonal"},service:{label:"Type"},shelter:{label:"Shelter"},shelter_type:{label:"Type"},shop:{label:"Type"},sloped_curb:{label:"Sloped Curb"},smoking:{label:"Smoking",placeholder:"No, Separated, Yes...",options:{no:"No smoking anywhere",separated:"In smoking areas, not physically isolated",isolated:"In smoking areas, physically isolated",outside:"Allowed outside",yes:"Allowed everywhere",dedicated:"Dedicated to smokers (e.g. smokers' club)"}},smoothness:{label:"Smoothness",placeholder:"Thin Rollers, Wheels, Off-Road...",options:{excellent:"Thin Rollers: rollerblade, skateboard",good:"Thin Wheels: racing bike",intermediate:"Wheels: city bike, wheelchair, scooter",bad:"Robust Wheels: trekking bike, car, rickshaw",very_bad:"High Clearance: light duty off-road vehicle",horrible:"Off-Road: heavy duty off-road vehicle",very_horrible:"Specialized off-road: tractor, ATV",impassible:"Impassible / No wheeled vehicle"}},social_facility_for:{label:"People served",placeholder:"Homeless, Disabled, Child, etc"},source:{label:"Source"},sport:{label:"Sport"},sport_ice:{label:"Sport"},structure:{label:"Structure",placeholder:"Unknown",options:{bridge:"Bridge",tunnel:"Tunnel",embankment:"Embankment",cutting:"Cutting",ford:"Ford"}},studio_type:{label:"Type"},supervised:{label:"Supervised"},surface:{label:"Surface"},tactile_paving:{label:"Tactile Paving"},"toilets/disposal":{label:"Disposal",options:{flush:"Flush",pitlatrine:"Pit/Latrine",chemical:"Chemical",bucket:"Bucket"}},tourism:{label:"Type"},towertype:{label:"Tower type"},tracktype:{label:"Track Type",placeholder:"Solid, Mostly Solid, Soft...",options:{grade1:"Solid: paved or heavily compacted hardcore surface",grade2:"Mostly Solid: gravel/rock with some soft material mixed in",grade3:"Even mixture of hard and soft materials",grade4:"Mostly Soft: soil/sand/grass with some hard material mixed in",grade5:"Soft: soil/sand/grass"}},trail_visibility:{label:"Trail Visibility",placeholder:"Excellent, Good, Bad...",options:{excellent:"Excellent: unambiguous path or markers everywhere",good:"Good: markers visible, sometimes require searching",intermediate:"Intermediate: few markers, path mostly visible",bad:"Bad: no markers, path sometimes invisible/pathless",horrible:"Horrible: often pathless, some orientation skills required",no:"No: pathless, excellent orientation skills required"}},tree_type:{label:"Type"},trees:{label:"Trees"},tunnel:{label:"Tunnel"},vending:{label:"Type of Goods"},water:{label:"Type"},waterway:{label:"Type"},website:{label:"Website",placeholder:"http://example.com/"},wetland:{label:"Type"},wheelchair:{label:"Wheelchair Access"},width:{label:"Width (Meters)"},wikipedia:{label:"Wikipedia"},wood:{label:"Type"}},presets:{address:{name:"Address",terms:""},aerialway:{name:"Aerialway",terms:"ski lift,funifor,funitel"},"aerialway/cable_car":{name:"Cable Car",terms:"tramway,ropeway"},"aerialway/chair_lift":{name:"Chair Lift",terms:""},"aerialway/gondola":{name:"Gondola",terms:""},"aerialway/magic_carpet":{name:"Magic Carpet Lift",terms:""},"aerialway/platter":{name:"Platter Lift",terms:"button lift,poma lift"},"aerialway/pylon":{name:"Aerialway Pylon",terms:""},"aerialway/rope_tow":{name:"Rope Tow Lift",terms:"handle tow,bugel lift"},"aerialway/station":{name:"Aerialway Station",terms:""},"aerialway/t-bar":{name:"T-bar Lift",terms:""},aeroway:{name:"Aeroway",terms:""},"aeroway/aerodrome":{name:"Airport",terms:"airplane,airport,aerodrome"},"aeroway/apron":{name:"Apron",terms:"ramp"},"aeroway/gate":{name:"Airport gate",terms:""},"aeroway/hangar":{name:"Hangar",terms:""},"aeroway/helipad":{name:"Helipad",terms:"helicopter,helipad,heliport"},"aeroway/runway":{name:"Runway",terms:"landing strip"},"aeroway/taxiway":{name:"Taxiway",terms:""},"aeroway/terminal":{name:"Airport terminal",terms:"airport,aerodrome"},amenity:{name:"Amenity",terms:""},"amenity/arts_centre":{name:"Arts Center",terms:"arts,arts centre"},"amenity/atm":{name:"ATM",terms:""},"amenity/bank":{name:"Bank",terms:"coffer,countinghouse,credit union,depository,exchequer,fund,hoard,investment firm,repository,reserve,reservoir,safe,savings,stock,stockpile,store,storehouse,thrift,treasury,trust company,vault"},"amenity/bar":{name:"Bar",terms:""},"amenity/bbq":{name:"Barbecue/Grill",terms:"barbecue,bbq,grill"},"amenity/bench":{name:"Bench",terms:""},"amenity/bicycle_parking":{name:"Bicycle Parking",terms:""},"amenity/bicycle_rental":{name:"Bicycle Rental",terms:""},"amenity/boat_rental":{name:"Boat Rental",terms:""},"amenity/bus_station":{name:"Bus Station",terms:""},"amenity/cafe":{name:"Cafe",terms:"coffee,tea,coffee shop"},"amenity/car_rental":{name:"Car Rental",terms:""},"amenity/car_sharing":{name:"Car Sharing",terms:""},"amenity/car_wash":{name:"Car Wash",terms:""},"amenity/charging_station":{name:"Charging Station",terms:"EV,Electric Vehicle,Supercharger"},"amenity/childcare":{name:"Childcare",terms:"nursery,orphanage,playgroup"},"amenity/cinema":{name:"Cinema",terms:"big screen,bijou,cine,drive-in,film,flicks,motion pictures,movie house,movie theater,moving pictures,nabes,photoplay,picture show,pictures,playhouse,show,silver screen"},"amenity/clinic":{name:"Clinic",terms:"clinic,medical clinic"},"amenity/clock":{name:"Clock",terms:""},"amenity/college":{name:"College",terms:""},"amenity/compressed_air":{name:"Compressed Air",terms:""},"amenity/courthouse":{name:"Courthouse",terms:""},"amenity/dentist":{name:"Dentist",terms:"dentist,dentist's office"},"amenity/doctor":{name:"Doctor",terms:"doctor,doctor's office"},"amenity/dojo":{name:"Dojo / Martial Arts Academy",terms:"martial arts,dojo,dojang"},"amenity/drinking_water":{name:"Drinking Water",terms:"water fountain,potable water"},"amenity/embassy":{name:"Embassy",terms:""},"amenity/fast_food":{name:"Fast Food",terms:""},"amenity/fire_station":{name:"Fire Station",terms:""},"amenity/fountain":{name:"Fountain",terms:""},"amenity/fuel":{name:"Gas Station",terms:"petrol,fuel,propane,diesel,lng,cng,biodiesel"},"amenity/grave_yard":{name:"Graveyard",terms:""},"amenity/hospital":{name:"Hospital Grounds",terms:"clinic,emergency room,health service,hospice,infirmary,institution,nursing home,rest home,sanatorium,sanitarium,sick bay,surgery,ward"},"amenity/kindergarten":{name:"Kindergarten Grounds",terms:"nursery,preschool"},"amenity/library":{name:"Library",terms:""},"amenity/marketplace":{name:"Marketplace",terms:""},"amenity/nightclub":{name:"Nightclub",terms:"disco*,night club,dancing,dance club"},"amenity/parking":{name:"Car Parking",terms:""},"amenity/parking_entrance":{name:"Parking Garage Entrance/Exit",terms:""},"amenity/pharmacy":{name:"Pharmacy",terms:""},"amenity/place_of_worship":{name:"Place of Worship",terms:"abbey,basilica,bethel,cathedral,chancel,chantry,chapel,church,fold,house of God,house of prayer,house of worship,minster,mission,mosque,oratory,parish,sacellum,sanctuary,shrine,synagogue,tabernacle,temple"},"amenity/place_of_worship/buddhist":{name:"Buddhist Temple",terms:"stupa,vihara,monastery,temple,pagoda,zendo,dojo"},"amenity/place_of_worship/christian":{name:"Church",terms:"christian,abbey,basilica,bethel,cathedral,chancel,chantry,chapel,church,fold,house of God,house of prayer,house of worship,minster,mission,oratory,parish,sacellum,sanctuary,shrine,tabernacle,temple"},"amenity/place_of_worship/jewish":{name:"Synagogue",terms:"jewish,synagogue"},"amenity/place_of_worship/muslim":{name:"Mosque",terms:"muslim,mosque"},"amenity/police":{name:"Police",terms:"badge,bear,blue,bluecoat,bobby,boy scout,bull,constable,constabulary,cop,copper,corps,county mounty,detective,fed,flatfoot,force,fuzz,gendarme,gumshoe,heat,law,law enforcement,man,narc,officers,patrolman,police"},"amenity/post_box":{name:"Mailbox",terms:"letter drop,letterbox,mail drop,mailbox,pillar box,postbox"},"amenity/post_office":{name:"Post Office",terms:""},"amenity/pub":{name:"Pub",terms:""},"amenity/ranger_station":{name:"Ranger Station",terms:"visitor center,visitor centre,permit center,permit centre,backcountry office,warden office,warden center"},"amenity/recycling":{name:"Recycling",terms:""},"amenity/restaurant":{name:"Restaurant",terms:"bar,cafeteria,caf\xE9,canteen,chophouse,coffee shop,diner,dining room,dive*,doughtnut shop,drive-in,eatery,eating house,eating place,fast-food place,fish and chips,greasy spoon,grill,hamburger stand,hashery,hideaway,hotdog stand,inn,joint*,luncheonette,lunchroom,night club,outlet*,pizzeria,saloon,soda fountain,watering hole"},"amenity/school":{name:"School Grounds",terms:"academy,alma mater,blackboard,college,department,discipline,establishment,faculty,hall,halls of ivy,institute,institution,jail*,schoolhouse,seminary,university"},"amenity/shelter":{name:"Shelter",terms:"lean-to"},"amenity/social_facility":{name:"Social Facility",terms:""},"amenity/social_facility/food_bank":{name:"Food Bank",terms:""},"amenity/social_facility/group_home":{name:"Group Home",terms:"elderly,old,senior living"},"amenity/social_facility/homeless_shelter":{name:"Homeless Shelter",terms:"houseless,unhoused,displaced"},"amenity/studio":{name:"Studio",terms:"recording studio,studio,radio,radio studio,television,television studio"},"amenity/swimming_pool":{name:"Swimming Pool",terms:""},"amenity/taxi":{name:"Taxi Stand",terms:"cab"},"amenity/telephone":{name:"Telephone",terms:"phone"},"amenity/theatre":{name:"Theater",terms:"theatre,performance,play,musical"},"amenity/toilets":{name:"Toilets",terms:"bathroom,restroom,outhouse,privy,head,lavatory,latrine,water closet,WC,W.C."},"amenity/townhall":{name:"Town Hall",terms:"village hall,city government,courthouse,municipal building,municipal center,municipal centre"},"amenity/university":{name:"University",terms:"college"},"amenity/vending_machine":{name:"Vending Machine",terms:""},"amenity/veterinary":{name:"Veterinary",terms:"pet clinic,veterinarian,animal hospital,pet doctor"},"amenity/waste_basket":{name:"Waste Basket",terms:"rubbish bin,litter bin,trash can,garbage can"},area:{name:"Area",terms:""},barrier:{name:"Barrier",terms:""},"barrier/block":{name:"Block",terms:""},"barrier/bollard":{name:"Bollard",terms:""},"barrier/cattle_grid":{name:"Cattle Grid",terms:""},"barrier/city_wall":{name:"City Wall",terms:""},"barrier/cycle_barrier":{name:"Cycle Barrier",terms:""},"barrier/ditch":{name:"Ditch",terms:""},"barrier/entrance":{name:"Entrance",terms:""},"barrier/fence":{name:"Fence",terms:""},"barrier/gate":{name:"Gate",terms:""},"barrier/hedge":{name:"Hedge",terms:""},"barrier/kissing_gate":{name:"Kissing Gate",terms:""},"barrier/lift_gate":{name:"Lift Gate",terms:""},"barrier/retaining_wall":{name:"Retaining Wall",terms:""},"barrier/stile":{name:"Stile",terms:""},"barrier/toll_booth":{name:"Toll Booth",terms:""},"barrier/wall":{name:"Wall",terms:""},"boundary/administrative":{name:"Administrative Boundary",terms:""},building:{name:"Building",terms:""},"building/apartments":{name:"Apartments",terms:""},"building/barn":{name:"Barn",terms:""},"building/bunker":{name:"Bunker",terms:""},"building/cabin":{name:"Cabin",terms:""},"building/cathedral":{name:"Cathedral",terms:""},"building/chapel":{name:"Chapel",terms:""},"building/church":{name:"Church",terms:""},"building/commercial":{name:"Commercial Building",terms:""},"building/construction":{name:"Building Under Construction",terms:""},"building/detached":{name:"Detached Home",terms:""},"building/dormitory":{name:"Dormitory",terms:""},"building/entrance":{name:"Entrance/Exit",terms:""},"building/garage":{name:"Garage",terms:""},"building/garages":{name:"Garages",terms:""},"building/greenhouse":{name:"Greenhouse",terms:""},"building/hospital":{name:"Hospital Building",terms:""},"building/hotel":{name:"Hotel Building",terms:""},"building/house":{name:"House",terms:""},"building/hut":{name:"Hut",terms:""},"building/industrial":{name:"Industrial Building",terms:""},"building/public":{name:"Public Building",terms:""},"building/residential":{name:"Residential Building",terms:""},"building/retail":{name:"Retail Building",terms:""},"building/roof":{name:"Roof",terms:""},"building/school":{name:"School Building",terms:""},"building/shed":{name:"Shed",terms:""},"building/stable":{name:"Stable",terms:""},"building/static_caravan":{name:"Static Mobile Home",terms:""},"building/terrace":{name:"Row Houses",terms:""},"building/train_station":{name:"Train Station",terms:""},"building/university":{name:"University Building",terms:""},"building/warehouse":{name:"Warehouse",terms:""},"craft/basket_maker":{name:"Basket Maker",terms:"basket,basketry,basket maker,basket weaver"},"craft/beekeeper":{name:"Beekeeper",terms:"bees,beekeeper,bee box"},"craft/blacksmith":{name:"Blacksmith",terms:"blacksmith"},"craft/boatbuilder":{name:"Boat Builder",terms:"boat builder"},"craft/bookbinder":{name:"Bookbinder",terms:"bookbinder,book repair"},"craft/brewery":{name:"Brewery",terms:"brewery"},"craft/carpenter":{name:"Carpenter",terms:"carpenter,woodworker"},"craft/carpet_layer":{name:"Carpet Layer",terms:"carpet layer"},"craft/caterer":{name:"Caterer",terms:"Caterer,Catering"},"craft/clockmaker":{name:"Clockmaker",terms:"clock,clockmaker,clock repair"},"craft/confectionary":{name:"Confectionary",terms:"confectionary,sweets,candy"},"craft/dressmaker":{name:"Dressmaker",terms:"dress,dressmaker"},"craft/electrician":{name:"Electrician",terms:"electrician"},"craft/gardener":{name:"Gardener",terms:"gardener,landscaper,grounds keeper"},"craft/glaziery":{name:"Glaziery",terms:"glass,glass foundry,stained-glass,window"},"craft/handicraft":{name:"Handicraft",terms:"handicraft"},"craft/hvac":{name:"HVAC",terms:"heating,ventilating,air-conditioning,air conditioning"},"craft/insulator":{name:"Insulator",terms:"insulation,insulator"},"craft/jeweler":{name:"Jeweler",terms:"jeweler,gem,diamond"},"craft/key_cutter":{name:"Key Cutter",terms:"key,key cutter"},"craft/locksmith":{name:"Locksmith",terms:"locksmith,lock"},"craft/metal_construction":{name:"Metal Construction",terms:"metal construction"},"craft/optician":{name:"Optician",terms:"glasses,optician"},"craft/painter":{name:"Painter",terms:"painter"},"craft/photographer":{name:"Photographer",terms:"photographer"},"craft/photographic_laboratory":{name:"Photographic Laboratory",terms:"photographic laboratory,film developer"},"craft/plasterer":{name:"Plasterer",terms:"plasterer"},"craft/plumber":{name:"Plumber",terms:"pumber"},"craft/pottery":{name:"Pottery",terms:"pottery,potter"},"craft/rigger":{name:"Rigger",terms:"rigger"},"craft/roofer":{name:"Roofer",terms:"roofer"},"craft/saddler":{name:"Saddler",terms:"saddler"},"craft/sailmaker":{name:"Sailmaker",terms:"sailmaker"},"craft/sawmill":{name:"Sawmill",terms:"sawmill,lumber"},"craft/scaffolder":{name:"Scaffolder",terms:"scaffolder"},"craft/sculpter":{name:"Sculpter",terms:"sculpter"},"craft/shoemaker":{name:"Shoemaker",terms:"shoe repair,shoemaker"},"craft/stonemason":{name:"Stonemason",terms:"stonemason,masonry"},"craft/sweep":{name:"Chimney Sweep",terms:"sweep,chimney sweep"},"craft/tailor":{name:"Tailor",terms:"tailor,clothes"},"craft/tiler":{name:"Tiler",terms:"tiler"},"craft/tinsmith":{name:"Tinsmith",terms:"tinsmith"},"craft/upholsterer":{name:"Upholsterer",terms:"upholsterer"},"craft/watchmaker":{name:"Watchmaker",terms:"watch,watchmaker,watch repair"},"craft/window_construction":{name:"Window Construction",terms:"window,window maker,window construction"},embankment:{name:"Embankment",terms:""},"emergency/ambulance_station":{name:"Ambulance Station",terms:""},"emergency/fire_hydrant":{name:"Fire Hydrant",terms:""},"emergency/phone":{name:"Emergency Phone",terms:""},entrance:{name:"Entrance/Exit",terms:""},"footway/crossing":{name:"Crossing",terms:""},"footway/crosswalk":{name:"Crosswalk",terms:"crosswalk,zebra crossing"},"footway/sidewalk":{name:"Sidewalk",terms:""},ford:{name:"Ford",terms:""},"golf/bunker":{name:"Sand Trap",terms:"hazard,bunker"},"golf/fairway":{name:"Fairway",terms:""},"golf/green":{name:"Putting Green",terms:"putting green"},"golf/hole":{name:"Golf Hole",terms:""},"golf/lateral_water_hazard":{name:"Lateral Water Hazard",terms:""},"golf/rough":{name:"Rough",terms:""},"golf/tee":{name:"Tee Box",terms:"teeing ground"},"golf/water_hazard":{name:"Water Hazard",terms:""},highway:{name:"Highway",terms:""},"highway/bridleway":{name:"Bridle Path",terms:"bridleway,equestrian trail,horse riding path,bridle road,horse trail"},"highway/bus_stop":{name:"Bus Stop",terms:""},"highway/crossing":{name:"Crossing",terms:""},"highway/crosswalk":{name:"Crosswalk",terms:"crosswalk,zebra crossing"},"highway/cycleway":{name:"Cycle Path",terms:""},"highway/footway":{name:"Foot Path",terms:"beaten path,boulevard,clearing,course,cut*,drag*,footpath,highway,lane,line,orbit,passage,pathway,rail,rails,road,roadway,route,street,thoroughfare,trackway,trail,trajectory,walk"},"highway/living_street":{name:"Living Street",terms:""},"highway/mini_roundabout":{name:"Mini-Roundabout",terms:""},"highway/motorway":{name:"Motorway",terms:""},"highway/motorway_junction":{name:"Motorway Junction / Exit",terms:""},"highway/motorway_link":{name:"Motorway Link",terms:"ramp,on ramp,off ramp"},"highway/path":{name:"Path",terms:""},"highway/pedestrian":{name:"Pedestrian",terms:""},"highway/primary":{name:"Primary Road",terms:""},"highway/primary_link":{name:"Primary Link",terms:"ramp,on ramp,off ramp"},"highway/residential":{name:"Residential Road",terms:""},"highway/rest_area":{name:"Rest Area",terms:"rest stop,turnout,lay-by"},"highway/road":{name:"Unknown Road",terms:""},"highway/secondary":{name:"Secondary Road",terms:""},"highway/secondary_link":{name:"Secondary Link",terms:"ramp,on ramp,off ramp"},"highway/service":{name:"Service Road",terms:""},"highway/service/alley":{name:"Alley",terms:""},"highway/service/drive-through":{name:"Drive-Through",terms:""},"highway/service/driveway":{name:"Driveway",terms:""},"highway/service/emergency_access":{name:"Emergency Access",terms:""},"highway/service/parking_aisle":{name:"Parking Aisle",terms:""},"highway/services":{name:"Service Area",terms:"services,travel plaza,service station"},"highway/steps":{name:"Steps",terms:"stairs,staircase"},"highway/stop":{name:"Stop Sign",terms:"stop sign"},"highway/street_lamp":{name:"Street Lamp",terms:"streetlight,street light,lamp,light,gaslight"},"highway/tertiary":{name:"Tertiary Road",terms:""},"highway/tertiary_link":{name:"Tertiary Link",terms:"ramp,on ramp,off ramp"},"highway/track":{name:"Track",terms:""},"highway/traffic_signals":{name:"Traffic Signals",terms:"light,stoplight,traffic light"},"highway/trunk":{name:"Trunk Road",terms:""},"highway/trunk_link":{name:"Trunk Link",terms:"ramp,on ramp,off ramp"},"highway/turning_circle":{name:"Turning Circle",terms:""},"highway/unclassified":{name:"Unclassified Road",terms:""},historic:{name:"Historic Site",terms:""},"historic/archaeological_site":{name:"Archaeological Site",terms:""},"historic/boundary_stone":{name:"Boundary Stone",terms:""},"historic/castle":{name:"Castle",terms:""},"historic/memorial":{name:"Memorial",terms:""},"historic/monument":{name:"Monument",terms:""},"historic/ruins":{name:"Ruins",terms:""},"historic/wayside_cross":{name:"Wayside Cross",terms:""},"historic/wayside_shrine":{name:"Wayside Shrine",terms:""},landuse:{name:"Landuse",terms:""},"landuse/allotments":{name:"Allotments",terms:""},"landuse/basin":{name:"Basin",terms:""},"landuse/cemetery":{name:"Cemetery",terms:""},"landuse/churchyard":{name:"Churchyard",terms:""},"landuse/commercial":{name:"Commercial",terms:""},"landuse/construction":{name:"Construction",terms:""},"landuse/farm":{name:"Farm",terms:""},"landuse/farmland":{name:"Farmland",terms:""},"landuse/farmyard":{name:"Farmyard",terms:""},"landuse/forest":{name:"Forest",terms:""},"landuse/grass":{name:"Grass",terms:""},"landuse/industrial":{name:"Industrial",terms:""},"landuse/landfill":{name:"Landfill",terms:"dump"},"landuse/meadow":{name:"Meadow",terms:""},"landuse/military":{name:"Military",terms:""},"landuse/orchard":{name:"Orchard",terms:""},"landuse/quarry":{name:"Quarry",terms:""},"landuse/residential":{name:"Residential",terms:""},"landuse/retail":{name:"Retail",terms:""},"landuse/vineyard":{name:"Vineyard",terms:""},leisure:{name:"Leisure",terms:""},"leisure/common":{name:"Common",terms:"open space"},"leisure/dog_park":{name:"Dog Park",terms:""},"leisure/firepit":{name:"Firepit",terms:"fireplace,campfire"},"leisure/garden":{name:"Garden",terms:""},"leisure/golf_course":{name:"Golf Course",terms:"links"},"leisure/ice_rink":{name:"Ice Rink",terms:"hockey,skating,curling"},"leisure/marina":{name:"Marina",terms:""},"leisure/park":{name:"Park",terms:"esplanade,estate,forest,garden,grass,green,grounds,lawn,lot,meadow,parkland,place,playground,plaza,pleasure garden,recreation area,square,tract,village green,woodland"},"leisure/picnic_table":{name:"Picnic Table",terms:"bench,table"},"leisure/pitch":{name:"Sport Pitch",terms:""},"leisure/pitch/american_football":{name:"American Football Field",terms:""},"leisure/pitch/baseball":{name:"Baseball Diamond",terms:""},"leisure/pitch/basketball":{name:"Basketball Court",terms:""},"leisure/pitch/skateboard":{name:"Skate Park",terms:""},"leisure/pitch/soccer":{name:"Soccer Field",terms:""},"leisure/pitch/tennis":{name:"Tennis Court",terms:""},"leisure/pitch/volleyball":{name:"Volleyball Court",terms:""},"leisure/playground":{name:"Playground",terms:"jungle gym,play area"},"leisure/slipway":{name:"Slipway",terms:""},"leisure/sports_center":{name:"Sports Center / Gym",terms:"gym"},"leisure/stadium":{name:"Stadium",terms:""},"leisure/swimming_pool":{name:"Swimming Pool",terms:""},"leisure/track":{name:"Race Track",terms:""},line:{name:"Line",terms:""},man_made:{name:"Man Made",terms:""},"man_made/breakwater":{name:"Breakwater",terms:""},"man_made/cutline":{name:"Cut line",terms:""},"man_made/embankment":{name:"Embankment",terms:""},"man_made/flagpole":{name:"Flagpole",terms:""},"man_made/lighthouse":{name:"Lighthouse",terms:""},"man_made/observation":{name:"Observation Tower",terms:"lookout tower,fire tower"},"man_made/pier":{name:"Pier",terms:""},"man_made/pipeline":{name:"Pipeline",terms:""},"man_made/survey_point":{name:"Survey Point",terms:""},"man_made/tower":{name:"Tower",terms:""},"man_made/wastewater_plant":{name:"Wastewater Plant",terms:"sewage works,sewage treatment plant,water treatment plant,reclamation plant"},"man_made/water_tower":{name:"Water Tower",terms:""},"man_made/water_well":{name:"Water well",terms:""},"man_made/water_works":{name:"Water Works",terms:""},"military/airfield":{name:"Airfield",terms:""},"military/barracks":{name:"Barracks",terms:""},"military/bunker":{name:"Bunker",terms:""},"military/range":{name:"Military Range",terms:""},natural:{name:"Natural",terms:""},"natural/bay":{name:"Bay",terms:""},"natural/beach":{name:"Beach",terms:""},"natural/cliff":{name:"Cliff",terms:""},"natural/coastline":{name:"Coastline",terms:"shore"},"natural/fell":{name:"Fell",terms:""},"natural/glacier":{name:"Glacier",terms:""},"natural/grassland":{name:"Grassland",terms:""},"natural/heath":{name:"Heath",terms:""},"natural/peak":{name:"Peak",terms:"acme,aiguille,alp,climax,crest,crown,hill,mount,mountain,pinnacle,summit,tip,top"},"natural/scree":{name:"Scree",terms:"loose rocks"},"natural/scrub":{name:"Scrub",terms:""},"natural/spring":{name:"Spring",terms:""},"natural/tree":{name:"Tree",terms:""},"natural/water":{name:"Water",terms:""},"natural/water/lake":{name:"Lake",terms:"lakelet,loch,mere"},"natural/water/pond":{name:"Pond",terms:"lakelet,millpond,tarn,pool,mere"},"natural/water/reservoir":{name:"Reservoir",terms:""},"natural/wetland":{name:"Wetland",terms:""},"natural/wood":{name:"Wood",terms:""},office:{name:"Office",terms:""},"office/accountant":{name:"Accountant",terms:""},"office/administrative":{name:"Administrative Office",terms:""},"office/architect":{name:"Architect",terms:""},"office/company":{name:"Company Office",terms:""},"office/educational_institution":{name:"Educational Institution",terms:""},"office/employment_agency":{name:"Employment Agency",terms:""},"office/estate_agent":{name:"Real Estate Office",terms:""},"office/financial":{name:"Financial Office",terms:""},"office/government":{name:"Government Office",terms:""},"office/insurance":{name:"Insurance Office",terms:""},"office/it":{name:"IT Office",terms:""},"office/lawyer":{name:"Law Office",terms:""},"office/newspaper":{name:"Newspaper",terms:""},"office/ngo":{name:"NGO Office",terms:""},"office/physician":{name:"Physician",terms:""},"office/political_party":{name:"Political Party",terms:""},"office/research":{name:"Research Office",terms:""},"office/telecommunication":{name:"Telecom Office",terms:""},"office/therapist":{name:"Therapist",terms:""},"office/travel_agent":{name:"Travel Agency",terms:""},piste:{name:"Piste/Ski Trail",terms:"ski,sled,sleigh,snowboard,nordic,downhill,snowmobile"},place:{name:"Place",terms:""},"place/city":{name:"City",terms:""},"place/hamlet":{name:"Hamlet",terms:""},"place/island":{name:"Island",terms:"archipelago,atoll,bar,cay,isle,islet,key,reef"},"place/isolated_dwelling":{name:"Isolated Dwelling",terms:""},"place/locality":{name:"Locality",terms:""},"place/neighbourhood":{name:"Neighborhood",terms:"neighbourhood"},"place/suburb":{name:"Borough",terms:"Boro,Quarter"},"place/town":{name:"Town",terms:""},"place/village":{name:"Village",terms:""},point:{name:"Point",terms:""},power:{name:"Power",terms:""},"power/generator":{name:"Power Generator",terms:""},"power/line":{name:"Power Line",terms:""},"power/minor_line":{name:"Minor Power Line",terms:""},"power/pole":{name:"Power Pole",terms:""},"power/sub_station":{name:"Substation",terms:""},"power/tower":{name:"High-Voltage Tower",terms:""},"power/transformer":{name:"Transformer",terms:""},"public_transport/platform":{name:"Platform",terms:""},"public_transport/stop_position":{name:"Stop Position",terms:""},railway:{name:"Railway",terms:""},"railway/abandoned":{name:"Abandoned Railway",terms:""},"railway/disused":{name:"Disused Railway",terms:""},"railway/funicular":{name:"Funicular",terms:"venicular,cliff railway,cable car,cable railway,funicular railway"},"railway/halt":{name:"Railway Halt",terms:"break,interrupt,rest,wait,interruption"},"railway/level_crossing":{name:"Level Crossing",terms:"crossing,railroad crossing,railway crossing,grade crossing,road through railroad,train crossing"},"railway/monorail":{name:"Monorail",terms:""},"railway/narrow_gauge":{name:"Narrow Gauge Rail",terms:"narrow gauge railway,narrow gauge railroad"},"railway/platform":{name:"Railway Platform",terms:""},"railway/rail":{name:"Rail",terms:""},"railway/station":{name:"Railway Station",terms:"train station,station"},"railway/subway":{name:"Subway",terms:""},"railway/subway_entrance":{name:"Subway Entrance",terms:""},"railway/tram":{name:"Tram",terms:"streetcar"},relation:{name:"Relation",terms:""},"route/ferry":{name:"Ferry Route",terms:""},shop:{name:"Shop",terms:""},"shop/alcohol":{name:"Liquor Store",terms:"alcohol"},"shop/art":{name:"Art Shop",terms:"art store,art gallery"},"shop/bakery":{name:"Bakery",terms:""},"shop/beauty":{name:"Beauty Shop",terms:"nail spa,spa,salon,tanning"},"shop/beverages":{name:"Beverage Store",terms:""},"shop/bicycle":{name:"Bicycle Shop",terms:""},"shop/bookmaker":{name:"Bookmaker",terms:""},"shop/books":{name:"Bookstore",terms:""},"shop/boutique":{name:"Boutique",terms:""},"shop/butcher":{name:"Butcher",terms:""},"shop/car":{name:"Car Dealership",terms:""},"shop/car_parts":{name:"Car Parts Store",terms:""},"shop/car_repair":{name:"Car Repair Shop",terms:""},"shop/chemist":{name:"Chemist",terms:""},"shop/clothes":{name:"Clothing Store",terms:""},"shop/computer":{name:"Computer Store",terms:""},"shop/confectionery":{name:"Confectionery",terms:""},"shop/convenience":{name:"Convenience Store",terms:""},"shop/deli":{name:"Deli",terms:""},"shop/department_store":{name:"Department Store",terms:""},"shop/doityourself":{name:"DIY Store",terms:""},"shop/dry_cleaning":{name:"Dry Cleaners",terms:""},"shop/electronics":{name:"Electronics Store",terms:""},"shop/farm":{name:"Produce Stand",terms:"farm shop,farm stand"},"shop/fishmonger":{name:"Fishmonger",terms:""},"shop/florist":{name:"Florist",terms:""},"shop/funeral_directors":{name:"Funeral Home",terms:"undertaker,funeral parlour,funeral parlor,memorial home"},"shop/furniture":{name:"Furniture Store",terms:""},"shop/garden_centre":{name:"Garden Center",terms:"garden centre"},"shop/gift":{name:"Gift Shop",terms:""},"shop/greengrocer":{name:"Greengrocer",terms:""},"shop/hairdresser":{name:"Hairdresser",terms:""},"shop/hardware":{name:"Hardware Store",terms:""},"shop/hifi":{name:"Hifi Store",terms:""},"shop/jewelry":{name:"Jeweler",terms:""},"shop/kiosk":{name:"Kiosk",terms:""},"shop/laundry":{name:"Laundry",terms:""},"shop/locksmith":{name:"Locksmith",terms:"keys"},"shop/lottery":{name:"Lottery Shop",terms:""},"shop/mall":{name:"Mall",terms:""},"shop/mobile_phone":{name:"Mobile Phone Store",terms:""},"shop/motorcycle":{name:"Motorcycle Dealership",terms:""},"shop/music":{name:"Music Store",terms:""},"shop/newsagent":{name:"Newsagent",terms:""},"shop/optician":{name:"Optician",terms:""},"shop/outdoor":{name:"Outdoor Store",terms:""},"shop/pet":{name:"Pet Store",terms:""},"shop/photo":{name:"Photography Store",terms:""},"shop/seafood":{name:"Seafood Shop",terms:"fishmonger"},"shop/shoes":{name:"Shoe Store",terms:""},"shop/sports":{name:"Sporting Goods Store",terms:""},"shop/stationery":{name:"Stationery Store",terms:""},"shop/supermarket":{name:"Supermarket",terms:"bazaar,boutique,chain,co-op,cut-rate store,discount store,five-and-dime,flea market,galleria,grocery store,mall,mart,outlet,outlet store,shop,shopping center,shopping centre,shopping plaza,stand,store,supermarket,thrift shop"},"shop/tailor":{name:"Tailor",terms:"tailor,clothes"},"shop/toys":{name:"Toy Store",terms:""},"shop/travel_agency":{name:"Travel Agency",terms:""},"shop/tyres":{name:"Tire Store",terms:""},"shop/vacant":{name:"Vacant Shop",terms:""},"shop/variety_store":{name:"Variety Store",terms:""},"shop/video":{name:"Video Store",terms:""},"shop/wine":{name:"Wine Shop",terms:"winery"},tourism:{name:"Tourism",terms:""},"tourism/alpine_hut":{name:"Alpine Hut",terms:""},"tourism/artwork":{name:"Artwork",terms:"mural,sculpture,statue"},"tourism/attraction":{name:"Tourist Attraction",terms:""},"tourism/camp_site":{name:"Camp Site",terms:"camping"},"tourism/caravan_site":{name:"RV Park",terms:""},"tourism/chalet":{name:"Chalet",terms:""},"tourism/guest_house":{name:"Guest House",terms:"B&B,Bed & Breakfast,Bed and Breakfast"},"tourism/hostel":{name:"Hostel",terms:""},"tourism/hotel":{name:"Hotel",terms:""},"tourism/information":{name:"Information",terms:""},"tourism/motel":{name:"Motel",terms:""},"tourism/museum":{name:"Museum",terms:"exhibition,exhibits archive,foundation,gallery,hall,institution,library,menagerie,repository,salon,storehouse,treasury,vault"},"tourism/picnic_site":{name:"Picnic Site",terms:""},"tourism/theme_park":{name:"Theme Park",terms:""},"tourism/viewpoint":{name:"Viewpoint",terms:""},"tourism/zoo":{name:"Zoo",terms:""},"type/boundary":{name:"Boundary",terms:""},"type/boundary/administrative":{name:"Administrative Boundary",terms:""},"type/multipolygon":{name:"Multipolygon",terms:""},"type/restriction":{name:"Restriction",terms:""},"type/restriction/no_left_turn":{name:"No Left Turn",terms:""},"type/restriction/no_right_turn":{name:"No Right Turn",terms:""},"type/restriction/no_straight_on":{name:"No Straight On",terms:""},"type/restriction/no_u_turn":{name:"No U-turn",terms:""},"type/restriction/only_left_turn":{name:"Left Turn Only",terms:""},"type/restriction/only_right_turn":{name:"Right Turn Only",terms:""},"type/restriction/only_straight_on":{name:"No Turns",terms:""},"type/route":{name:"Route",terms:""},"type/route/bicycle":{name:"Cycle Route",terms:""},"type/route/bus":{name:"Bus Route",terms:""},"type/route/detour":{name:"Detour Route",terms:""},"type/route/ferry":{name:"Ferry Route",terms:""},"type/route/foot":{name:"Foot Route",terms:""},"type/route/hiking":{name:"Hiking Route",terms:""},"type/route/pipeline":{name:"Pipeline Route",terms:""},"type/route/power":{name:"Power Route",terms:""},"type/route/road":{name:"Road Route",terms:""},"type/route/train":{name:"Train Route",terms:""},"type/route/tram":{name:"Tram Route",terms:""},"type/route_master":{name:"Route Master",terms:""},vertex:{name:"Other",terms:""},waterway:{name:"Waterway",terms:""},"waterway/canal":{name:"Canal",terms:""},"waterway/dam":{name:"Dam",terms:""},"waterway/ditch":{name:"Ditch",terms:""},"waterway/drain":{name:"Drain",terms:""},"waterway/river":{name:"River",terms:"beck,branch,brook,course,creek,estuary,rill,rivulet,run,runnel,stream,tributary,watercourse"},"waterway/riverbank":{name:"Riverbank",terms:""},"waterway/stream":{name:"Stream",terms:"beck,branch,brook,burn,course,creek,current,drift,flood,flow,freshet,race,rill,rindle,rivulet,run,runnel,rush,spate,spritz,surge,tide,torrent,tributary,watercourse"},"waterway/weir":{name:"Weir",terms:""}}}};;iD.data.zh_cn={modes:{add_area:{title:"\u533A\u57DF",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u9762\u72B6\u533A\u57DF\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u5F00\u59CB\u7ED8\u5236\u533A\u57DF\u3002"},add_board_area:{title:"\u6307\u793A\u724C\u533A\u57DF",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u9762\u72B6\u533A\u57DF\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u5F00\u59CB\u7ED8\u5236\u533A\u57DF\u3002"},add_land_cover_area:{title:"\u80CC\u666F",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u9762\u72B6\u80CC\u666F\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u5F00\u59CB\u7ED8\u5236\u533A\u57DF\u3002"},add_line:{title:"\u7EBF",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u7EBF\u6BB5\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u5F00\u59CB\u7ED8\u5236\u7EBF\u3002"},add_point:{title:"POI",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u70B9\u72B6\u5730\u7269\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u6DFB\u52A0\u4E00\u4E2APOI\u3002"},add_text_mark:{title:"\u6807\u6CE8",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u70B9\u72B6\u5730\u7269\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u6DFB\u52A0\u4E00\u4E2A\u6807\u6CE8\u3002"},add_poi:{title:"\u70B9",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u70B9\u72B6\u5730\u7269\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u6DFB\u52A0\u4E00\u4E2A\u70B9\u3002"},browse:{title:"\u6D4F\u89C8",description:"\u79FB\u52A8\u548C\u7F29\u653E\u5730\u56FE\u3002"},draw_area:{tail:"\u70B9\u51FB\u4E3A\u8FD9\u4E2A\u9762\u6DFB\u52A0\u66F4\u591A\u9876\u70B9\uFF0C\u53CC\u51FB\u5B8C\u6210\u8BE5\u9762\u7684\u7ED8\u5236\u3002"},draw_land_cover_area:{tail:"\u70B9\u51FB\u4E3A\u8FD9\u4E2A\u80CC\u666F\u6DFB\u52A0\u66F4\u591A\u9876\u70B9\uFF0C\u53CC\u51FB\u5B8C\u6210\u8BE5\u9762\u7684\u7ED8\u5236\u3002"},draw_board_area:{tail:"\u70B9\u51FB\u4E3A\u8FD9\u4E2A\u6307\u793A\u724C\u533A\u57DF\uFF0C\u53CC\u51FB\u5B8C\u6210\u8BE5\u9762\u7684\u7ED8\u5236\u3002"},draw_line:{tail:"\u70B9\u51FB\u4E3A\u8FD9\u6761\u7EBF\u6DFB\u52A0\u66F4\u591A\u8282\u70B9\uFF0C\u53CC\u51FB\u5B8C\u6210\u8FD9\u6761\u7EBF\u7684\u7ED8\u5236\u3002"},draw_divider:{tail:"\u70B9\u51FB\u4E3A\u8FD9\u6761\u5206\u5272\u7EBF\u6DFB\u52A0\u66F4\u591A\u8282\u70B9\uFF0C\u53CC\u51FB\u5B8C\u6210\u8FD9\u6761\u8F66\u9053\u5206\u5272\u7EBF\u7684\u7ED8\u5236\u3002"},draw_fusion_divider:{tail:"\u70B9\u51FB\u4E3A\u8FD9\u6761\u5206\u5272\u7EBF\u6DFB\u52A0\u66F4\u591A\u8282\u70B9\uFF0C\u53CC\u51FB\u5B8C\u6210\u8FD9\u6761\u8F66\u9053\u5206\u5272\u7EBF\u7684\u7ED8\u5236\u3002"},add_road:{title:"\u5BFC\u822A\u8DEF\u7F51",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u9053\u8DEF\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u5F00\u59CB\u7ED8\u5236\u7EBF\u3002"},add_divider:{title:"\u8F66\u9053\u5206\u5272\u7EBF",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u8F66\u9053\u5206\u5272\u7EBF\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u5F00\u59CB\u7ED8\u5236\u7EBF\u3002"},cut_divider:{title:"\u9053\u8DEF\u6253\u65AD",description:"\u7ED8\u5236\u7EBF\u5E76\u6253\u65AD\u9053\u8DEF\u3002",tail:"\u7ED8\u5236\u7EBF\u5E76\u6253\u65AD\u9053\u8DEF\u3002"},add_fusion_divider:{title:"\u8F66\u9053\u5206\u5272\u7EBF",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u8F66\u9053\u5206\u5272\u7EBF\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5355\u51FB\u5F00\u59CB\u7ED8\u5236\u7EBF\u3002"},add_roadcross:{title:"\u590D\u6742\u8DEF\u53E3",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u7EFC\u5408\u4EA4\u53C9\u70B9\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u7EFC\u5408\u4EA4\u53C9\u70B9\u3002"},add_speedcamera:{title:"\u7535\u5B50\u773C",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u7535\u5B50\u773C\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u7535\u5B50\u773C\u3002"},add_zlevel:{title:"Zlevel",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0Zlevel\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0Zlevel\u3002"},"disconnect-road":{title:"\u6253\u65AD\u9053\u8DEF",description:"\u5728\u5730\u56FE\u4E0A\u6253\u65AD\u9053\u8DEF\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6253\u65AD\u9053\u8DEF\u3002"},topo_split:{key:"T",title:"\u9053\u8DEF\u62D3\u6251\u7EF4\u62A4",description:"\u5728\u5730\u56FE\u4E0A\u9053\u8DEF\u62D3\u6251\u7EF4\u62A4\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u9053\u8DEF\u62D3\u6251\u7EF4\u62A4"},toolbar_distance:{title:"\u70B9\u51FB\u56FE\u9762\u5F00\u59CB\u6D4B\u8DDD\uFF0C\u53CC\u51FB\u7ED3\u675F",description:"\u70B9\u51FB\u56FE\u9762\u5F00\u59CB\u6D4B\u8DDD\uFF0C\u53CC\u51FB\u7ED3\u675F",tail:"\u70B9\u51FB\u56FE\u9762\u5F00\u59CB\u6D4B\u8DDD\uFF0C\u53CC\u51FB\u7ED3\u675F"},add_island:{title:"\u6DFB\u52A0\u73AF\u5C9B",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u73AF\u5C9B\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u73AF\u5C9B\u3002"},add_walk_area:{title:"\u6DFB\u52A0\u6B65\u5BFC\u9762",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u6B65\u5BFC\u9762\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u6B65\u5BFC\u9762\u3002"},add_walkroad:{title:"\u6B65\u5BFC\u6570\u636E",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u6B65\u5BFC\u7EBF\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u6B65\u5BFC\u7EBF\u3002"},qc_roadinfotag:{title:"\u9053\u8DEF\u4FE1\u606F\u9519\u8BEF\u6807",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u9053\u8DEF\u4FE1\u606F\u9519\u8BEF\u6807\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u9053\u8DEF\u4FE1\u606F\u9519\u8BEF\u6807\u3002"},qc_crossinfotag:{title:"\u8DEF\u53E3\u4FE1\u606F\u9519\u8BEF\u6807",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u8DEF\u53E3\u4FE1\u606F\u9519\u8BEF\u6807\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u8DEF\u53E3\u4FE1\u606F\u9519\u8BEF\u6807\u3002"},qc_multiinfotag:{title:"\u7EFC\u5408\u4FE1\u606F\u9519\u8BEF\u6807",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u7EFC\u5408\u4FE1\u606F\u9519\u8BEF\u6807\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u7EFC\u5408\u4FE1\u606F\u9519\u8BEF\u6807\u3002"},qc_questiontag:{title:"\u4E0D\u786E\u5B9A\u6027\u9519\u8BEF\u6807",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u4E0D\u786E\u5B9A\u6027\u9519\u8BEF\u6807\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u4E0D\u786E\u5B9A\u6027\u9519\u8BEF\u6807\u3002"},qc_addtag:{title:"\u589E\u8DEF\u6807",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u589E\u8DEF\u6807\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u589E\u8DEF\u6807\u3002"},qc_minustag:{title:"\u51CF\u8DEF\u6807",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u51CF\u8DEF\u6807\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u51CF\u8DEF\u6807\u3002"},qc_righttag:{title:"\u6B63\u786E\u6807",description:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u6B63\u786E\u6807\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u6DFB\u52A0\u6B63\u786E\u6807\u3002"},add_placename:{annotation:"\u9053\u8DEF\u8BBE\u65BD",title:"\u9053\u8DEF\u8BBE\u65BD",description:"\u5728\u9053\u8DEF\u4E0A\u6DFB\u52A0\u9053\u8DEF\u8BBE\u65BD\u3002",tail:"\u5728\u9053\u8DEF\u4E0A\u6DFB\u52A0\u9053\u8DEF\u8BBE\u65BD\u3002"},add_road_attribute:{annotation:"\u9053\u8DEF\u53D8\u5316\u70B9\u4FE1\u606F",title:"\u9053\u8DEF\u53D8\u5316\u70B9\u4FE1\u606F",description:"\u5728\u9053\u8DEF\u4E0A\u6DFB\u52A0\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9\u3002",tail:"\u5728\u9053\u8DEF\u4E0A\u6DFB\u52A0\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9\u3002"},add_junction:{annotation:"\u590D\u6742\u8DEF\u53E3",title:"\u590D\u6742\u8DEF\u53E3",description:"\u5728\u9053\u8DEF\u4E0A\u6DFB\u52A0\u590D\u6742\u8DEF\u53E3\u3002",tail:"\u5728\u9053\u8DEF\u4E0A\u6DFB\u52A0\u590D\u6742\u8DEF\u53E3\u3002"}},operations:{add:{annotation:{point:"\u6DFB\u52A0\u70B9\u3002",vertex:"\u6DFB\u52A0\u8282\u70B9\u5230\u8DEF\u5F84\u3002",relation:"\u6DFB\u52A0\u5173\u7CFB",roadcrossline:"\u666E\u901A\u8DEF\u53E3\u4E0E\u590D\u6742\u8DEF\u53E3\u5EFA\u7ACB\u5173\u8054\u5173\u7CFB"}},start:{annotation:{line:"\u5F00\u59CB\u7ED8\u5236\u7EBF\u3002",area:"\u5F00\u59CB\u7ED8\u5236\u533A\u57DF\u3002"}},continue:{key:"A",title:"\u7EE7\u7EED",description:"\u7EE7\u7EED\u7ED8\u5236\u8FD9\u6761\u7EBF\u3002",not_eligible:"\u8FD9\u91CC\u6CA1\u6709\u7EBF\u53EF\u4EE5\u5728\u7EE7\u7EED\u3002",multiple:"\u53EF\u4EE5\u9009\u62E9\u591A\u6761\u7EBF\u3002\u8981\u589E\u52A0\u9009\u62E9\u4E00\u6761\u76F4\u7EBF\uFF0C\u6309\u4F4FShift\u952E\u5E76\u5355\u51FB\u4EE5\u9009\u4E2D\u5B83\u3002",annotation:{line:"\u7EE7\u7EED\u7ED8\u5236\u7EBF\u3002",area:"\u7EE7\u7EED\u7ED8\u5236\u533A\u57DF\u3002"}},cancel_draw:{annotation:"\u53D6\u6D88\u7ED8\u5236\u3002"},change_role:{annotation:"\u5DF2\u66F4\u6539\u5173\u7CFB\u6210\u5458\u7684\u89D2\u8272\u3002"},change_tags:{annotation:"\u66F4\u6539\u6807\u7B7E\u3002"},change_members:{annotation:"\u66F4\u6539\u7535\u5B50\u773C\u5173\u8054\u9053\u8DEF\u3002"},circularize:{title:"\u73AF\u5F62\u5316",description:{line:"\u73AF\u5F62\u5316\u8BE5\u7EBF\u3002",area:"\u73AF\u5F62\u5316\u8BE5\u533A\u57DF\u3002"},key:"O",annotation:{line:"\u73AF\u5F62\u5316\u7EBF\u3002",area:"\u73AF\u5F62\u5316\u533A\u57DF\u3002"},not_closed:"\u5B83\u4E0D\u662F\u95ED\u5408\u7684\u73AF\u5F62\uFF0C\u65E0\u6CD5\u5706\u5F62\u5316\u3002",too_large:"\u56E0\u4E3A\u53EF\u89C1\u90E8\u5206\u4E0D\u8DB3\uFF0C\u4E0D\u80FD\u53D8\u6210\u5706\u5F62\u3002"},orthogonalize:{title:"\u76F4\u89D2\u5316",description:{line:"\u5C06\u8FD9\u6761\u7EBF\u4E0A\u7684\u5F2F\u89D2\u8F6C\u5316\u6210\u76F4\u89D2\u3002",area:"\u5C06\u8FD9\u4E2A\u533A\u57DF\u4E0A\u7684\u5F2F\u89D2\u8F6C\u5316\u6210\u76F4\u89D2\u3002"},key:"S",annotation:{line:"\u62C9\u76F4\u7EBF\u4E0A\u89D2\u7684\u8FB9\u3002",area:"\u5DF2\u5C06\u533A\u57DF\u7684\u5F2F\u89D2\u6362\u6210\u76F4\u89D2\u3002"},not_squarish:"\u56E0\u4E3A\u5B83\u4E0D\u662F\u8FD1\u4F3C\u65B9\u5F62\u7684\uFF0C\u8FD9\u4E0D\u80FD\u88AB\u76F4\u89D2\u5316\u3002",too_large:"\u56E0\u4E3A\u53EF\u89C1\u90E8\u5206\u4E0D\u8DB3\uFF0C\u4E0D\u80FD\u53D8\u6210\u65B9\u5F62\u3002"},straighten:{title:"\u62C9\u76F4",description:"\u628A\u8FD9\u4E00\u6761\u7EBF\u62C9\u76F4\u3002",key:"S",annotation:"\u5DF2\u62C9\u76F4\u4E86\u4E00\u6761\u7EBF\u3002",too_bendy:"\u56E0\u4E3A\u5B83\u5F2F\u66F2\u592A\u591A\uFF0C\u4E0D\u80FD\u62C9\u76F4\u3002"},delete:{title:"\u5220\u9664",description:"\u5C06\u5176\u4ECE\u5730\u56FE\u4E0A\u5220\u9664\u3002",annotation:{point:"\u5220\u9664\u70B9\u3002",vertex:"\u5220\u9664\u8DEF\u5F84\u4E0A\u7684\u8282\u70B9\u3002",line:"\u5220\u9664\u7EBF\u3002",area:"\u5220\u9664\u533A\u57DF\u3002",relation:"\u5220\u9664\u5173\u7CFB\u3002",multiple:"\u5220\u9664{n}\u4E2A\u5BF9\u8C61\u3002"},multi_type:"\u591A\u7C7B\u8981\u7D20\u7C7B\u578B\u4E0D\u80FD\u5220\u9664\u3002",incomplete_relation:"\u6B64\u5185\u5BB9\u6682\u672A\u4E0B\u8F7D\u5B8C\u6210\u65E0\u6CD5\u5220\u9664\u3002"},delete_slope:{title:"\u5220\u9664\u5761\u6BB5",description:"\u5220\u9664\u9053\u8DEF\u5173\u8054\u7684\u5761\u5EA6\u4FE1\u606F\u3002",annotation:"\u5220\u9664\u9053\u8DEF\u5761\u5EA6\u4FE1\u606F",incomplete_relation:"\u6B64\u5185\u5BB9\u6682\u672A\u4E0B\u8F7D\u5B8C\u6210\u65E0\u6CD5\u5220\u9664\u3002"},way_editor:{title:"\u7F16\u8F91",description:"\u5F00\u542F\u8DEF\u6BB5\u7F16\u8F91\u6A21\u5F0F\u3002",annotation:"\u5F00\u542F\u8DEF\u6BB5\u7F16\u8F91\u6A21\u5F0F"},add_member:{annotation:"\u589E\u52A0\u5173\u7CFB\u4E2D\u7684\u6210\u5458\u3002"},delete_member:{annotation:"\u5220\u9664\u5173\u7CFB\u4E2D\u7684\u6210\u5458\u3002"},connect:{annotation:{point:"\u8FDE\u63A5\u6761\u8DEF\u5F84\u5230\u70B9\u3002",vertex:"\u8FDE\u63A5\u4E24\u6761\u8DEF\u5F84\u3002",line:"\u8FDE\u63A5\u8DEF\u5F84\u5230\u7EBF\u3002",area:"\u8FDE\u63A5\u6761\u8DEF\u5F84\u5230\u533A\u57DF\u3002"}},clone:{"title-way":"\u5728\u5E73\u884C\u65B9\u5411\u4E0A\u65B0\u589E\u7EBF","description-way":"\u5728\u5E73\u884C\u65B9\u5411\u4E0A\u65B0\u589E\u7EBF","key-way":"","annotation-way":"\u5728\u5E73\u884C\u65B9\u5411\u4E0A\u65B0\u589E\u7EBF","title-road":"\u5728\u5E73\u884C\u65B9\u5411\u4E0A\u65B0\u589E\u4E00\u6761\u9053\u8DEF","description-road":"\u5728\u5E73\u884C\u65B9\u5411\u4E0A\u65B0\u589E\u4E00\u6761\u9053\u8DEF","key-road":"","annotation-road":"\u5728\u5E73\u884C\u65B9\u5411\u4E0A\u65B0\u589E\u4E00\u6761\u9053\u8DEF"},expand:{"title-way":"\u6269\u7EBF","description-way":"\u6269\u8DEF","key-way":"","annotation-way":"\u6269\u7EBF","title-road":"\u6269\u8DEF","description-road":"\u6269\u8DEF","key-road":"","annotation-road":"\u6269\u8DEF"},topo_split:{key:"T","title-way":"\u62D3\u6251\u5206\u79BB","description-way":"\u62D3\u6251\u5206\u79BB","key-way":"","annotation-way":"\u62D3\u6251\u5206\u79BB","title-road":"\u62D3\u6251\u5206\u79BB","description-road":"\u62D3\u6251\u5206\u79BB","key-road":"","annotation-road":"\u62D3\u6251\u5206\u79BB"},line_info_modify:{key:"L",title:"\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u8F91",description:"\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u8F91",annotation:"\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u8F91",not_eligible:"\u5173\u8054\u9053\u8DEF\u672A\u8BBE\u7F6E\u884C\u9A76\u65B9\u5411\u3002"},copy:{title:"\u590D\u5236\u7EBF\u5230\u5BFC\u822A\u8DEF\u7F51",description:"\u590D\u5236\u7EBF\u5230\u5BFC\u822A\u8DEF\u7F51",key:"",annotation:"\u590D\u5236\u7EBF\u5230\u5BFC\u822A\u8DEF\u7F51"},disconnect:{title:"\u65AD\u5F00\u8FDE\u63A5",description:"\u6253\u65AD\u9053\u8DEF",key:"B",annotation:{Highway:"\u6253\u65AD\u9053\u8DEF\u3002",WalkLink:"\u6253\u65AD\u6B65\u5BFC\u7EBF\u3002",Others:"\u6253\u65AD"},not_connected:"\u6B64\u5904\u6CA1\u6709\u53EF\u65AD\u5F00\u7684\u7EBF\u3002"},merge:{title:"\u5408\u5E76",description:"\u5408\u5E76\u8FD9\u4E9B\u7EBF\u3002",key:"H",annotation:"\u5408\u5E76\u4E86 {n} \u6761\u7EBF\u3002",not_eligible:"\u8FD9\u4E9B\u7279\u5F81\u4E0D\u53EF\u4EE5\u5408\u5E76\u3002",not_adjacent:"\u9996\u5C3E\u4E0D\u76F8\u63A5\u7684\u7EBF\u4E0D\u53EF\u5408\u5E76\u3002",restriction:"\u8FD9\u4E9B\u7EBF\u6BB5\u4E0D\u80FD\u5408\u5E76\uFF0C\u56E0\u4E3A\u5176\u4E2D\u6700\u5C11\u6709\u4E00\u6761\u7EBF\u6BB5\u662F\"{relation}\"\u5173\u7CFB\u7684\u6210\u5458\u3002",incomplete_relation:"\u6B64\u8981\u7D20\u6682\u672A\u4E0B\u8F7D\u5B8C\u6210\uFF0C\u65E0\u6CD5\u5408\u5E76\u3002"},"merge-road":{title:"\u5408\u5E76",description:"\u5408\u5E76\u9053\u8DEF\u3002",key:"H",annotation:"\u5408\u5E76\u4E86 {n} \u6761\u9053\u8DEF\u3002",not_eligible:"\u8FD9\u4E9B\u7279\u5F81\u4E0D\u53EF\u4EE5\u5408\u5E76\u3002",not_adjacent:"\u9996\u5C3E\u4E0D\u76F8\u63A5\u7684\u9053\u8DEF\u4E0D\u53EF\u5408\u5E76\u3002",restriction:"\u8FD9\u4E9B\u9053\u8DEF\u6BB5\u4E0D\u80FD\u5408\u5E76\uFF0C\u56E0\u4E3A\u5176\u4E2D\u6700\u5C11\u6709\u4E00\u6761\u9053\u8DEF\u6BB5\u662F\"{relation}\"\u5173\u7CFB\u7684\u6210\u5458\u3002",incomplete_relation:"\u6B64\u8981\u7D20\u6682\u672A\u4E0B\u8F7D\u5B8C\u6210\uFF0C\u65E0\u6CD5\u5408\u5E76\u3002"},move:{title:"\u79FB\u52A8",description:"\u5E73\u79FB\u9053\u8DEF\u3002",key:"Y",annotation:{point:"\u5E73\u79FB\u70B9\u3002",vertex:"\u79FB\u52A8\u4E86\u8DEF\u5F84\u4E2D\u7684\u4E00\u4E2A\u8282\u70B9\u3002",line:"\u5E73\u79FB\u9053\u8DEF\u3002",area:"\u79FB\u52A8\u533A\u57DF\u3002",multiple:"\u79FB\u52A8\u591A\u4E2A\u5BF9\u8C61\u3002",relation:""},incomplete_relation:"\u8BE5\u7279\u5F81\u8FD8\u6CA1\u6709\u4E0B\u8F7D\u5B8C\u6574\uFF0C\u65E0\u6CD5\u79FB\u52A8\u3002"},rotate:{title:"\u65CB\u8F6C",description:"\u7ED5\u8FD9\u4E2A\u5BF9\u8C61\u7684\u4E2D\u5FC3\u70B9\u65CB\u8F6C\u3002",key:"R",annotation:{line:"\u65CB\u8F6C\u7EBF\u3002",area:"\u65CB\u8F6C\u533A\u57DF\u3002"},too_large:"\u56E0\u4E3A\u53EF\u89C1\u90E8\u5206\u4E0D\u8DB3\uFF0C\u4E0D\u80FD\u65CB\u8F6C\u3002"},reverse:{title:"\u53CD\u8F6C",description:"\u4F7F\u8FD9\u6761\u7EBF\u7684\u65B9\u5411\u53CD\u8F6C\u3002",key:"V",annotation:"\u53CD\u8F6C\u4E86\u4E00\u6761\u7EBF\u3002"},split:{title:"\u5206\u5272",description:{road:"\u5728\u6B64\u8282\u70B9\u5C06\u9053\u8DEF\u4E00\u5206\u4E3A\u4E8C\u3002",line:"\u5728\u6B64\u8282\u70B9\u5C06\u7EBF\u4E00\u5206\u4E3A\u4E8C\u3002",area:"\u5C06\u8FD9\u4E2A\u9762\u7684\u8FB9\u754C\u4E00\u5206\u4E3A\u4E8C\u3002",multiple:"\u5728\u8FD9\u4E00\u8282\u70B9\u5C06\u9053\u8DEF/\u7EBF/\u9762\u7684\u8FB9\u754C\u4E00\u5206\u4E3A\u4E8C\u3002"},key:"X",annotation:{road:"\u5207\u5272\u4E00\u6761\u9053\u8DEF\u3002",line:"\u5207\u5272\u4E00\u6761\u7EBF\u3002",area:"\u5206\u5272\u4E00\u533A\u57DF\u7684\u8FB9\u754C\u3002",multiple:"\u5206\u5272{n}\u7684\u9879\u9053\u8DEF/\u7EBF\u6BB5/\u533A\u57DF\u7684\u8FB9\u754C\u3002"},not_eligible:"\u4E0D\u80FD\u5728\u7EBF\u7684\u9996\u5C3E\u5904\u8FDB\u884C\u5206\u5272\u3002",not_eligible_road:"\u4E0D\u80FD\u5728\u9053\u8DEF\u7684\u9996\u5C3E\u5904\u8FDB\u884C\u5206\u5272\u3002",multiple_ways:"\u592A\u591A\u7EBF\u6BB5\uFF0C\u672A\u80FD\u8FDB\u884C\u5206\u5272\u3002"},dividerSeparation:{title:"\u5165\u53E3/\u51FA\u53E3\u8F66\u9053\u751F\u6210\u5206\u9694\u7EBF\u8D77\u7EC8\u70B9",description:"\u5165\u53E3/\u51FA\u53E3\u8F66\u9053\u751F\u6210\u5206\u9694\u7EBF\u8D77\u7EC8\u70B9"},dividerDREF:{title:"dividerDREF",description:{line:"\u751F\u6210\u8F66\u9053\u5206\u9694\u7EBF\u5206\u7EC4\u3002"},key:"X",annotation:{line:"\u751F\u6210\u8F66\u9053\u5206\u9694\u7EBF\u5206\u7EC4\u3002"},not_eligible:"\u5FC5\u987B\u6709\u53C2\u8003\u7EBF\u624D\u80FD\u751F\u6210\u8F66\u9053\u5206\u9694\u7EBF\u5206\u7EC4\u5173\u7CFB\u3002",not_divider:"\u5FC5\u987B\u6709\u53C2\u8003\u7EBF\u4EE5\u5916\u7684\u8F66\u9053\u5206\u9694\u7EBF\u624D\u80FD\u751F\u6210\u5206\u7EC4\u5173\u7CFB\u3002",not_more_eligible:"\u53C2\u8003\u7EBF\u6570\u91CF\u5927\u4E8E\u4E00\u6761\uFF0C\u4E0D\u80FD\u751F\u6210\u5206\u7EC4\u5173\u7CFB\u3002",exist_relation:"\u5DF2\u5B58\u5728\u8F66\u9053\u5206\u9694\u7EBF\u5206\u7EC4\u5173\u7CFB\u3002",exist_node:"\u9009\u62E9\u4E2D\u5B58\u5728\u70B9\u6570\u636E\uFF0C\u4E0D\u53EF\u751F\u6210\u8F66\u9053\u5206\u9694\u7EBF\u5206\u7EC4\u3002",exist_othermodel:"\u9009\u62E9\u4E2D\u5B58\u5728\u8F66\u9053\u7EBF\u4EE5\u5916\u7684\u6570\u636E\uFF0C\u4E0D\u53EF\u751F\u6210\u8F66\u9053\u5206\u9694\u7EBF\u5206\u7EC4\u3002"},createdividerVirtualLane:{title:"createdividerVirtualLane",description:{line:"\u692D\u5706\u8DEF\u53E3\u865A\u62DF\u8F66\u9053\u7EBF\u534A\u81EA\u52A8\u751F\u6210\u3002"},key:"X",annotation:{line:"\u692D\u5706\u8DEF\u53E3\u865A\u62DF\u8F66\u9053\u7EBF\u534A\u81EA\u52A8\u751F\u6210\u3002"},not_eligible:"\u5FC5\u987B\u6709\u4E24\u4E2A\u8F66\u9053\u7EBF\u8282\u70B9\u624D\u80FD\u751F\u6210\u3002",not_node:"\u8F66\u9053\u7EBF\u7684\u8282\u70B9\u5FC5\u987B\u662F\u8D77\u70B9\u3001\u7EC8\u70B9\u3002",exist_node:"\u5DF2\u5B58\u5728\u8F66\u9053\u7EBF\u8282\u70B9\u865A\u62DF\u8F66\u9053\u7EBF\u3002"},createdividerVirtualLaneCircle:{title:"createdividerVirtualLaneCircle",description:{line:"\u4E8C\u6B21\u66F2\u7EBF\u751F\u6210\u865A\u62DF\u8F66\u9053\u7EBF\u3002"},key:"X",annotation:{line:"\u5185\u5207\u5706\u8DEF\u53E3\u865A\u62DF\u8F66\u9053\u7EBF\u534A\u81EA\u52A8\u751F\u6210\u3002"},not_eligible:"\u5FC5\u987B\u6709\u4E24\u4E2A\u8F66\u9053\u7EBF\u8282\u70B9\u624D\u80FD\u751F\u6210\u3002",not_node:"\u8F66\u9053\u7EBF\u7684\u8282\u70B9\u5FC5\u987B\u662F\u8D77\u70B9\u3001\u7EC8\u70B9\u3002",exist_node:"\u5DF2\u5B58\u5728\u8F66\u9053\u7EBF\u8282\u70B9\u865A\u62DF\u8F66\u9053\u7EBF\u3002"},createdividerOPL:{title:"createdividerOPL",description:{line:"\u5173\u8054\u9053\u8DEF\u5206\u9694\u7EBF/\u7EBF\u5BF9\u8C61\u3002"},key:"X",annotation:{line:"\u5173\u8054\u9053\u8DEF\u5206\u9694\u7EBF/\u7EBF\u5BF9\u8C61\u3002"},not_eligible:"\u5FC5\u987B\u6709\u53C2\u8003\u7EBF\u624D\u80FD\u5173\u8054\u3002",exist_relation:"\u5DF2\u5B58\u5728\u5206\u5272\u7EBF/\u7EBF\u5BF9\u8C61\u5173\u8054\u5173\u7CFB\u3002",exist_node:"\u9009\u62E9\u4E2D\u5B58\u5728\u70B9\u6570\u636E\uFF0C\u4E0D\u53EF\u5173\u8054\u9053\u8DEF\u5206\u5272\u7EBF/\u7EBF\u5BF9\u8C61\u3002"},cancledividerOPL:{title:"cancledividerOPL",description:{line:"\u5220\u9664\u9053\u8DEF\u5206\u9694\u7EBF/\u7EBF\u5BF9\u8C61\u5173\u7CFB\u3002"},key:"X",annotation:{line:"\u5220\u9664\u9053\u8DEF\u5206\u9694\u7EBF/\u7EBF\u5BF9\u8C61\u5173\u7CFB\u3002"},not_eligible:"\u8BE5\u5143\u7D20\u65E0\u9053\u8DEF\u5206\u9694\u7EBF\u5173\u8054\u5173\u7CFB\u3002"},createdividerOPG:{title:"createdividerOPG",description:{line:"\u5173\u8054\u9053\u8DEF\u5206\u9694\u7EBF/\u9762\u5BF9\u8C61\u3002"},key:"X",annotation:{line:"\u5173\u8054\u9053\u8DEF\u5206\u9694\u7EBF/\u9762\u5BF9\u8C61\u3002"},not_eligible:"\u5FC5\u987B\u6709\u53C2\u8003\u7EBF\u624D\u80FD\u5173\u8054\u3002",exist_relation:"\u5DF2\u5B58\u5728\u5206\u5272\u7EBF/\u9762\u5BF9\u8C61\u5173\u8054\u5173\u7CFB\u3002",exist_node:"\u9009\u62E9\u4E2D\u5B58\u5728\u70B9\u6570\u636E\uFF0C\u4E0D\u53EF\u5173\u8054\u9053\u8DEF\u5206\u5272\u7EBF/\u9762\u5BF9\u8C61\u3002"},cancledividerOPG:{title:"cancledividerOPG",description:{line:"\u5220\u9664\u9053\u8DEF\u5206\u9694\u7EBF/\u9762\u5BF9\u8C61\u5173\u7CFB\u3002"},key:"X",annotation:{line:"\u5220\u9664\u9053\u8DEF\u5206\u9694\u7EBF/\u9762\u5BF9\u8C61\u5173\u7CFB\u3002"},not_eligible:"\u8BE5\u5143\u7D20\u65E0\u9053\u8DEF\u5206\u9694\u7EBF\u5173\u8054\u5173\u7CFB\u3002"},junction:{title:"jnuction",description:"\u5173\u8054\u8F66\u9053\u5206\u9694\u7EBF/\u590D\u6742\u8DEF\u53E3\u3002",key:"X",annotation:"\u751F\u6210\u8F66\u9053\u5206\u9694\u7EBF/\u590D\u6742\u8DEF\u53E3\u5173\u7CFB\u3002",not_eligible:"\u5FC5\u987B\u6709\u8F66\u9053\u5206\u9694\u7EBF\u624D\u80FD\u751F\u6210\u8F66\u9053\u5206\u9694\u7EBF/\u590D\u6742\u8DEF\u53E3\u3002",not_eligible_jnuction:"\u5FC5\u987B\u53EA\u80FD\u6709\u4E00\u4E2A\u590D\u6742\u8DEF\u53E3\u624D\u80FD\u751F\u6210\u8F66\u9053\u5206\u9694\u7EBF/\u590D\u6742\u8DEF\u53E3\u5173\u7CFB\u3002",not_eligible_R_jnuction:"\u53EA\u80FD\u751F\u6210\u4E00\u4E2A\u590D\u6742\u8DEF\u53E3\u624D\u80FD\u751F\u6210\u8F66\u9053\u5206\u9694\u7EBF/\u590D\u6742\u8DEF\u53E3\u5173\u7CFB\u3002"},road_divider:{title:"road_divider",description:{line:"\u751F\u6210\u5173\u8054\u9053\u8DEF/\u9053\u8DEF\u5206\u9694\u7EBF\u5173\u7CFB\u3002"},key:"X",annotation:{line:"\u751F\u6210\u5173\u8054\u9053\u8DEF/\u9053\u8DEF\u5206\u9694\u7EBF\u5173\u7CFB\u3002"},not_eligible:"\u53EA\u80FD\u6709\u4E00\u6761\u9053\u8DEF\u624D\u80FD\u751F\u6210\u5173\u7CFB\u3002",not_eligible_divider:"\u5FC5\u987B\u6709\u4E00\u6761\u8F66\u9053\u7EBF\u4E3A\u53C2\u8003\u7EBF\u624D\u80FD\u751F\u6210\u5173\u7CFB\u3002",not_eligible_length:"\u5FC5\u987B\u6709\u4E00\u6761\u8F66\u9053\u7EBF\uFF08\u4E14\u4E3A\u53C2\u8003\u7EBF\uFF09\u624D\u80FD\u751F\u6210\u5173\u7CFB\u3002",exist_node:"\u9009\u62E9\u4E2D\u5B58\u5728\u70B9\u6570\u636E\uFF0C\u4E0D\u53EF\u751F\u6210\u9053\u8DEF/\u9053\u8DEF\u5206\u9694\u7EBF\u5173\u7CFB",exist_relation:"\u5DF2\u5B58\u5728\u5173\u8054\u9053\u8DEF/\u9053\u8DEF\u5206\u9694\u7EBF\u5173\u7CFB\u3002"},update_divider_node:{title:"update_divider_node",description:"\u66F4\u65B0\u8F66\u9053\u5206\u9694\u865A\u7EBF\u9996\u5C3E\u8282\u70B9\u5C5E\u6027\u3002",key:"X",annotation:"\u66F4\u65B0\u8F66\u9053\u5206\u9694\u865A\u7EBF\u9996\u5C3E\u8282\u70B9\u5C5E\u6027\u3002",not_divider:"\u5FC5\u987B\u6709\u5206\u9694\u7EBF\u7C7B\u578B\u4E3A\u865A\u7EBF\u624D\u80FD\u751F\u6210\u5173\u7CFB\u3002"},cancelRelations:{title:"cancelRelations",description:{line:"\u5220\u9664\u5173\u8054\u5173\u7CFB\u3002"},key:"X",annotation:{line:"\u5220\u9664\u9053\u8DEF/\u9053\u8DEF\u5206\u9694\u7EBF\u5173\u7CFB\u3002"},not_eligible:"\u8BE5\u5143\u7D20\u65E0\u5BF9\u5E94\u5173\u8054\u5173\u7CFB\u3002"},cancelDividerJunction:{title:"cancelDividerJunction",description:{line:"\u5220\u9664\u8F66\u9053\u5206\u9694\u7EBF/\u590D\u6742\u8DEF\u53E3\u5173\u8054\u5173\u7CFB\u3002"},key:"X",annotation:{line:"\u5220\u9664\u8F66\u9053\u5206\u9694\u7EBF/\u590D\u6742\u8DEF\u53E3\u5173\u8054\u5173\u7CFB\u3002"},not_eligible:"\u8BE5\u5143\u7D20\u65E0\u8F66\u9053\u5206\u9694\u7EBF/\u590D\u6742\u8DEF\u53E3\u5173\u8054\u5173\u7CFB\u3002"},restriction:{help:{select:"\u5355\u51FB\u4EE5\u9009\u4E2D\u4E00\u6761\u8DEF\u3002",toggle:"\u70B9\u51FB\u5207\u6362\u8F6C\u5411\u9650\u5236\u3002",toggle_on:"\u5355\u51FB\u4EE5\u6DFB\u52A0\u4E00\u4E2A\"{restriction}\"\u9650\u5236\u3002",toggle_off:"\u5355\u51FB\u4EE5\u5220\u9664\u4E00\u4E2A\"{restriction}\"\u9650\u5236\u3002",delete:"\u5220\u9664\u5173\u7CFB"},annotation:{create:"\u589E\u52A0\u4E00\u4E2A\u8F6C\u5411\u9650\u5236",delete:"\u5220\u9664\u4E00\u4E2A\u8F6C\u5411\u9650\u5236"}},DIVIDER_ATTRIBUTErelation:{help:{select:"\u70B9\u51FB\u663E\u793ADA\u3002",toggle:"\u70B9\u51FB\u663E\u793ADA",toggle_on:"\u5355\u51FB\u4EE5\u6DFB\u52A0\u4E00\u4E2A\"{restriction}\"\u9650\u5236\u3002",toggle_off:"\u5355\u51FB\u4EE5\u5220\u9664\u4E00\u4E2A\"{restriction}\"\u9650\u5236\u3002"},annotation:{create:"\u589E\u52A0\u4E00\u4E2A\u8F6C\u5411\u9650\u5236",delete:"\u5220\u9664\u4E00\u4E2A\u8F6C\u5411\u9650\u5236"}},LANE_ATTRIBUTErelation:{help:{select:"\u70B9\u51FB\u663E\u793ALA",toggle:"\u70B9\u51FB\u663E\u793ALA",toggle_on:"\u5355\u51FB\u4EE5\u6DFB\u52A0\u4E00\u4E2A\"{restriction}\"\u9650\u5236\u3002",toggle_off:"\u5355\u51FB\u4EE5\u5220\u9664\u4E00\u4E2A\"{restriction}\"\u9650\u5236\u3002"},annotation:{create:"\u589E\u52A0\u4E00\u4E2A\u8F6C\u5411\u9650\u5236",delete:"\u5220\u9664\u4E00\u4E2A\u8F6C\u5411\u9650\u5236"}},traffic:{title:"\u4EA4\u901A\u89C4\u5219",description:"\u4EA4\u901A\u89C4\u5219\u3002",key:"E",annotation:"\u663E\u793A\u4EA4\u901A\u89C4\u5219\u3002"},transportation:{add:{title:"\u6DFB\u52A0\u4EA4\u901A\u65B0\u5173\u7CFB",description:"\u6DFB\u52A0\u4EA4\u901A\u65B0\u5173\u7CFB"},delete:{title:"\u5220\u9664\u4EA4\u901A\u5173\u7CFB",description:"\u5220\u9664\u4EA4\u901A\u5173\u7CFB"}},rawposition:{key:"\u65E0",title:"\u663E\u793A\u539F\u59CB\u4F4D\u7F6E",description:"\u663E\u793A\u539F\u59CB\u4F4D\u7F6E"},intersect:{key:"B",title:"\u76F8\u4EA4\u6253\u65AD",description:{road:"\u76F8\u4EA4\u6253\u65AD"},annotation:{road:"\u76F8\u4EA4\u6253\u65AD"}},roadsmove:{key:"\u65E0",title:"\u590D\u5236\u9053\u8DEF\u5E76\u79FB\u52A8",description:{road:"\u590D\u5236\u9053\u8DEF\u5E76\u79FB\u52A8"},annotation:{road:"\u590D\u5236\u9053\u8DEF\u5E76\u79FB\u52A8"}},clone_tags:{key:"C",title:"\u590D\u5236\u9053\u8DEF\u5C5E\u6027",description:{road:"\u590D\u5236\u9053\u8DEF\u5C5E\u6027"},annotation:{road:"\u590D\u5236\u9053\u8DEF\u5C5E\u6027"}},paste_tags:{key:"V",title:"\u7C98\u8D34\u9053\u8DEF\u5C5E\u6027",description:{road:"\u7C98\u8D34\u9053\u8DEF\u5C5E\u6027"},annotation:{road:"\u7C98\u8D34\u9053\u8DEF\u5C5E\u6027"}},road_cross_create:{title:"\u521B\u5EFA\u7EFC\u5408\u4EA4\u53C9\u70B9",description:"\u521B\u5EFA\u7EFC\u5408\u4EA4\u53C9\u70B9\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u521B\u5EFA\u7EFC\u5408\u4EA4\u53C9\u70B9\u3002"},copy_pole_lamp:{title:"\u590D\u5236\u706F\u6746\u4E0E\u706F\u5934\u7684\u4F4D\u7F6E\u5173\u7CFB",description:"\u590D\u5236\u706F\u6746\u4E0E\u706F\u5934\u7684\u4F4D\u7F6E\u5173\u7CFB\u3002",tail:"\u590D\u5236\u706F\u6746\u4E0E\u706F\u5934\u7684\u4F4D\u7F6E\u5173\u7CFB\u3002",noRelation:"\u6CA1\u6709\u5EFA\u7ACB\u706F\u6746\u4E0E\u706F\u5934\u7684\u5173\u7CFB\u3002",noTopPole:"\u5173\u7CFB\u6210\u5458\u4E2D\u6CA1\u6709\u6746\u9876\u90E8\u7C7B\u578B\u3002"},paste_pole_lamp:{title:"\u9ECF\u8D34\u5DF2\u590D\u5236\u7684\u706F\u5934",description:"\u9ECF\u8D34\u5DF2\u590D\u5236\u7684\u706F\u5934\u3002",tail:"\u9ECF\u8D34\u5DF2\u590D\u5236\u7684\u706F\u5934\u3002"},road_ra_create:{title:"\u5EFA\u7ACB \u9053\u8DEF/\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9 \u5173\u7CFB\u3002",description:"\u5EFA\u7ACB \u9053\u8DEF/\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9 \u5173\u7CFB\u3002",tail:"\u5EFA\u7ACB \u9053\u8DEF/\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9 \u5173\u7CFB\u3002"},opt_opt_create:{title:"\u521B\u5EFA\u706F\u6746\u5173\u7CFB",description:"\u521B\u5EFA\u706F\u6746\u5173\u7CFB\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u521B\u5EFA\u706F\u6746\u5173\u7CFB\u3002"},opt_opt_delete:{title:"\u5220\u9664\u706F\u6746\u5173\u7CFB",description:"\u5220\u9664\u706F\u6746\u5173\u7CFB\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5220\u9664\u706F\u6746\u5173\u7CFB\u3002"},auto_generate_way:{title:"\u81EA\u52A8\u751F\u6210\u7EBF",description:"\u81EA\u52A8\u751F\u6210\u7EBF\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u751F\u6210\u7EBF\u3002"},lamppost_lref_create:{title:"\u521B\u5EFA \u706F\u6746/\u706F\u5934 \u5173\u7CFB",description:"\u521B\u5EFA \u706F\u6746/\u706F\u5934 \u5173\u7CFB\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u521B\u5EFA \u706F\u6746/\u706F\u5934 \u5173\u7CFB\u3002"},lamppost_lref_delete:{title:"\u5220\u9664 \u706F\u6746/\u706F\u5934 \u5173\u7CFB",description:"\u5220\u9664 \u706F\u6746/\u706F\u5934 \u5173\u7CFB\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u5220\u9664 \u706F\u6746/\u706F\u5934 \u5173\u7CFB\u3002"},road_cross_edit:{title:"\u7EFC\u5408\u4EA4\u53C9\u70B9\u7F16\u8F91",description:"\u7F16\u8F91\u7EFC\u5408\u4EA4\u53C9\u70B9\u3002",tail:"\u5728\u5730\u56FE\u4E0A\u7F16\u8F91\u7EFC\u5408\u4EA4\u53C9\u70B9\u3002"},qc_tag:{key:"\u65E0",title:"\u54C1\u63A7\u6807\u7B7E\u95EE\u9898\u63CF\u8FF0",description:"\u54C1\u63A7\u6807\u7B7E\u95EE\u9898\u63CF\u8FF0\u3002",tail:"\u54C1\u63A7\u6807\u7B7E\u95EE\u9898\u63CF\u8FF0\u3002"},bridge_point:{title:"\u521B\u5EFA\u6865\u7684\u9AD8\u7A0B\u70B9",description:"\u521B\u5EFA\u6865\u7684\u9AD8\u7A0B\u70B9\u3002",tail:"\u521B\u5EFA\u6865\u7684\u9AD8\u7A0B\u70B9\u3002"},trafficLightTREF:{title:"\u751F\u6210\u4EA4\u901A\u706F\u7EC4\u3002",description:"\u751F\u6210\u4EA4\u901A\u706F\u7EC4\u3002",tail:"\u751F\u6210\u4EA4\u901A\u706F\u7EC4\u3002",delete_relation:"\u5220\u9664\u4EA4\u901A\u706F\u7EC4\u5173\u7CFB\u3002"},dividerTrafficLightTREF:{title:"\u521B\u5EFA \u4EA4\u901A\u706F\u7EC4/\u53C2\u8003\u7EBF \u5173\u8054\u5173\u7CFB\u3002",description:"\u521B\u5EFA \u4EA4\u901A\u706F\u7EC4/\u53C2\u8003\u7EBF \u5173\u8054\u5173\u7CFB\u3002",tail:"\u521B\u5EFA \u4EA4\u901A\u706F\u7EC4/\u53C2\u8003\u7EBF \u5173\u8054\u5173\u7CFB\u3002",delete_relation:"\u5220\u9664 \u4EA4\u901A\u706F\u7EC4/\u53C2\u8003\u7EBF \u5173\u8054\u5173\u7CFB\u3002"},checkTag:{title:"\u6DFB\u52A0\u8D28\u68C0\u6807\u8BB0\u70B9\u3002",description:"\u6DFB\u52A0\u8D28\u68C0\u6807\u8BB0\u70B9\u3002",tail:"\u6DFB\u52A0\u8D28\u68C0\u6807\u8BB0\u70B9\u3002",no_auth_move:"\u65E0\u6743\u9650\u79FB\u52A8\u8D28\u68C0\u6807\u8BB0\u70B9\u3002"},rectifyDeviationFeature:{title:"\u6839\u636E\u63A7\u5236\u70B9\u7EA0\u504F\u8981\u7D20\u3002",description:"\u6839\u636E\u63A7\u5236\u70B9\u7EA0\u504F\u8981\u7D20\u3002",annotation:{line:"\u6839\u636E\u63A7\u5236\u70B9\u7EA0\u504F\u8981\u7D20\u3002"},key:"X",tail:"\u6839\u636E\u63A7\u5236\u70B9\u7EA0\u504F\u8981\u7D20\u3002",not_eligible:"\u65E0\u8981\u7D20/\u63A7\u5236\u70B9\u3002"}},task_bounds:{outside:"\u5DF2\u8D85\u51FA\u5BF9\u8C61\u8FB9\u754C\uFF01"},pagination:{first:"\u9996\u9875",pre:"\u4E0A\u4E00\u9875",next:"\u4E0B\u4E00\u9875",last:"\u672B\u9875",total:"\u5171"},undo:{tooltip:"\u64A4\u9500\uFF1A{action}",nothing:"\u6CA1\u6709\u4E1C\u897F\u53EF\u4EE5\u64A4\u9500\u3002"},redo:{tooltip:"\u91CD\u505A\uFF1A{action}",nothing:"\u6CA1\u6709\u4E1C\u897F\u53EF\u4EE5\u91CD\u505A\u3002"},addroad:{tooltip:"\u7ED8\u5236\u5BFC\u822A\u7EBF"},addcrossing:{tooltip:"\u6DFB\u52A0\u590D\u6742\u8DEF\u53E3"},tooltip_keyhint:"\u5FEB\u6377\u952E\uFF1A",browser_notice:"\u672C\u7F16\u8F91\u5668\u4EC5\u88AB Firefox\u3001Chrome\u3001Safari\u3001Opera \u548C Internet Explorer 9 \u4EE5\u4E0A\u6240\u652F\u6301\u3002\u8BF7\u5347\u7EA7\u60A8\u7684\u6D4F\u89C8\u5668\u6216\u4F7F\u7528 Potlatch 2 \u6765\u7F16\u8F91\u5730\u56FE\u3002",translate:{translate:"\u7FFB\u8BD1",localized_translation_label:"\u591A\u8BED\u8A00\u540D\u79F0",localized_translation_language:"\u9009\u62E9\u8BED\u8A00",localized_translation_name:"\u540D\u79F0"},zoom_in_edit:"\u653E\u5927\u5730\u56FE\u4EE5\u7F16\u8F91",logout:"\u9000\u51FA",loading_auth:"\u6B63\u5728\u8FDE\u63A5OpenStreetMap...",report_a_bug:"\u62A5\u544A\u6F0F\u6D1E",status:{error:"\u65E0\u6CD5\u8FDE\u63A5\u5230 API\u3002",offline:"API \u5DF2\u4E0B\u7EBF\uFF0C\u8BF7\u7A0D\u540E\u518D\u5C1D\u8BD5\u7F16\u8F91\u3002",readonly:"API \u76EE\u524D\u5904\u4E8E\u53EA\u8BFB\u72B6\u6001\uFF0C\u60A8\u9700\u8981\u7B49\u5019\u4E00\u6BB5\u65F6\u95F4\u624D\u80FD\u4FDD\u5B58\u60A8\u7684\u66F4\u6539\u3002"},commit:{title:"\u4FDD\u5B58\u53D8\u66F4",description_placeholder:"\u7B80\u5355\u8BF4\u660E\u4F60\u7684\u8D21\u732E\u3002",message_label:"\u63D0\u4EA4\u4FE1\u606F",upload_explanation:"\u4F60\u7684\u4FEE\u6539\u5C06\u4F1A\u5728\u6240\u6709\u4F7F\u7528OpenStreetMap\u7684\u6570\u636E\u7684\u5730\u56FE\u4E0A\u770B\u5F97\u89C1\u3002",upload_explanation_with_user:"{user}\uFF0C\u4F60\u7684\u4FEE\u6539\u5C06\u4F1A\u5728\u6240\u6709\u4F7F\u7528OpenStreetMap\u6570\u636E\u7684\u5730\u56FE\u4E0A\u5C55\u73B0\u3002",save:"\u4FDD\u5B58",cancel:"\u53D6\u6D88",warnings:"\u8B66\u544A",modified:"\u5DF2\u66F4\u6539",deleted:"\u5DF2\u5220\u9664",created:"\u5DF2\u521B\u5EFA"},contributors:{list:"{users}\u7F16\u8F91",truncated_list:"{users}\u53CA\u53E6\u5916{count}\u4EBA\u7F16\u8F91"},geocoder:{search:"\u5728\u5168\u7403\u641C\u7D22...",no_results_visible:"\u5728\u53EF\u89C1\u5730\u56FE\u533A\u57DF\u6CA1\u6709\u7ED3\u679C",no_results_worldwide:"\u6CA1\u6709\u627E\u5230\u7ED3\u679C"},geolocate:{title:"\u5B9A\u4F4D\u5230\u5F53\u524D\u4EFB\u52A1"},zoom_level:{title:"\u5F53\u524D\u7F29\u653E\u7EA7\u522B"},inspector:{lm_road:"\u5BFC\u822A\u8DEF\u7F51\u56FE\u5C42",lm_line:"\u7EBF\u56FE\u5C42",lm_area:"\u9762\u56FE\u5C42",lm_point:"\u70B9\u56FE\u5C42",lm_setbutton:"\u8BBE\u7F6E",lm_sublayerbutton:"\u5B50\u56FE\u5C42",no_documentation_combination:"\u8FD9\u4E2A\u6807\u7B7E\u7EC4\u5408\u6CA1\u6709\u53EF\u7528\u7684\u8BF4\u660E",no_documentation_key:"\u8FD9\u4E2A\u952E\u503C\u6CA1\u6709\u53EF\u7528\u7684\u8BF4\u660E",show_more:"\u663E\u793A\u66F4\u591A",view_on_osm:"\u5728openstreetmap.org\u4E2D\u67E5\u770B",all_tags:"\u6240\u6709\u6807\u7B7E",all_members:"\u6240\u6709\u6210\u5458",all_relations:"\u6240\u6709\u5173\u7CFB",new_relation:"\u65B0\u5173\u7CFB...",role:"\u89D2\u8272",choose:"\u9009\u62E9\u6807\u8BB0\u5185\u5BB9\u79CD\u7C7B\u3002",results:"{search}\u6709{n}\u4E2A\u7ED3\u679C\u3002",reference:"\u5728OpenStreetMap Wiki\u4E2D\u67E5\u770B",back_tooltip:"\u53D8\u66F4\u7279\u5F81",remove:"\u5220\u9664",search:"\u8F93\u5165\u540E\u8BF7\u6309\u56DE\u8F66\u952E\u67E5\u8BE2",multiselect:"\u9009\u62E9\u9879\u76EE",unknown:"\u672A\u77E5",incomplete:"<\u672A\u6709\u4E0B\u8F7D>",feature_list:"\u8BBE\u7F6E",layermanager_title:"\u56FE\u5C42\u7BA1\u7406",edit:"\u5C5E\u6027\u7F16\u8F91",none:"\u7A7A",node:"\u8282\u70B9",way:"\u8DEF\u5F84",relation:"\u5173\u7CFB",location:"\u4F4D\u7F6E",readonly_title:"\u53EA\u8BFB\u5C5E\u6027",input_placeholder_error:"\u8F93\u5165\u503C\u7684\u683C\u5F0F\u9519\u8BEF",data_list_tab_name:"\u6570\u636E\u5217\u8868",style_setting_tab_name:"\u6837\u5F0F\u8BBE\u7F6E"},background:{title:"\u80CC\u666F",description:"\u80CC\u666F\u8BBE\u7F6E",percent_brightness:"{opacity}%\u4E0D\u900F\u660E\u5EA6",none:"\u7A7A",custom:"\u81EA\u5B9A\u4E49",custom_button:"\u7F16\u8F91\u81EA\u5B9A\u4E49\u80CC\u666F",custom_prompt:"\u8F93\u5165\u74E6\u7247\u6A21\u677F\u3002Z/X/Y\u65B9\u6848\u7684\u6709\u6548\u6807\u8BB0\u662F{z}\uFF0C{x}\uFF0C{y}\uFF0Cquadtile\u65B9\u6848\u7684\u6709\u6548\u6807\u8BB0\u662F{u}\u3002",fix_misalignment:"\u4FEE\u590D\u5BF9\u9F50",reset:"\u91CD\u7F6E"},restore:{heading:"\u60A8\u6709\u672A\u4FDD\u5B58\u7684\u66F4\u6539",description:"\u60A8\u5728\u4E0A\u4E00\u6B21\u7F16\u8F91\u65F6\u4ECD\u6709\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\uFF0C\u4F60\u60F3\u6062\u590D\u8FD9\u4E9B\u4FEE\u6539\u5417\uFF1F",restore:"\u6062\u590D",reset:"\u91CD\u7F6E"},save:{title:"\u4FDD\u5B58",help:"\u4FDD\u5B58\u6539\u53D8\u81F3\u670D\u52A1\u5668\u3002",no_changes:"\u6CA1\u6709\u5F85\u4FDD\u5B58\u53D8\u66F4\u3002",error:"\u5C1D\u8BD5\u4FDD\u5B58\u65F6\u51FA\u9519\u3002",uploading:"\u6B63\u5728\u4FDD\u5B58\u6570\u636E\u81F3\u670D\u52A1\u5668...",save_sure:"\u4F60\u786E\u5B9A\u8981\u4FDD\u5B58\u64CD\u4F5C\u5417\uFF1F",save_sure2:"\u5B58\u5728\u672A\u4FDD\u5B58\u6570\u636E\uFF0C\u662F\u5426\u4FDD\u5B58\uFF1F",clear_sure:"\u5B58\u5728\u672A\u4FDD\u5B58\u6570\u636E\uFF0C\u662F\u5426\u6E05\u7A7A\uFF1F",unsaved_changes:"\u4F60\u6709\u672A\u4FDD\u5B58\u53D8\u66F4"},success:{edited_osm:"\u7F16\u8F91\u4E86 OSM\uFF01",just_edited:"\u60A8\u521A\u521A\u7F16\u8F91\u4E86 OpenStreetMap\uFF01",view_on_osm:"\u5728 OSM \u4E0A\u67E5\u770B",facebook:"\u5206\u4EAB\u5230Facebook",twitter:"\u5206\u4EAB\u5230 Twitter",google:"\u5206\u4EAB\u5230 Google+",help_html:"\u4F60\u7684\u66F4\u65B0\u5E94\u8BE5\u5728\u51E0\u5206\u949F\u540E\u51FA\u73B0\u5728\u201C\u6807\u51C6\u201D\u56FE\u5C42\u4E0A\u3002\u5176\u4ED6\u56FE\u5C42\u548C\u67D0\u4E9B\u529F\u80FD\uFF0C\u53EF\u80FD\u9700\u8981\u66F4\u957F\u7684\u65F6\u95F4\n(<a href='https://help.openstreetmap.org/questions/4705/why-havent-my-changes-appeared-on-the-map' target='_blank'>\u8BE6\u60C5</a>).\n"},confirm:{okay:"\u786E\u5B9A"},splash:{welcome:"\u6B22\u8FCE\u4F7F\u7528OpenStreetMap iD\u7F16\u8F91\u5668",text:"ID\u7F16\u8F91\u5668\u662F\u4E00\u4E2A\u65E2\u6613\u7528\u800C\u53C8\u529F\u80FD\u5F3A\u5927\u7684\u5DE5\u5177\uFF0C\u4EE5\u52A9\u60A8\u7F16\u8F91\u4E16\u754C\u4E0A\u6700\u597D\u7684\u81EA\u7531\u4E16\u754C\u5730\u56FE\u3002\u8FD9\u662F{version}\u7248\u672C\u3002\u6B32\u77E5\u8BE6\u60C5\uFF0C\u8BF7\u6D4F\u89C8{website}\u53CA\u5728{github}\u62A5\u544A\u7A0B\u5E8F\u9519\u8BEF\u3002\u201C",walkthrough:"\u5F00\u59CB\u6F14\u7EC3",start:"\u73B0\u5728\u7F16\u8F91"},source_switch:{live:"\u5B9E\u51B5\u6A21\u5F0F",lose_changes:"\u60A8\u6709\u5C1A\u672A\u4FDD\u5B58\u7684\u7F16\u8F91\uFF0C\u5207\u6362\u5730\u56FE\u670D\u52A1\u5668\u4F1A\u5931\u53BB\u8FD9\u4E9B\u7F16\u8F91\u3002\u60A8\u662F\u5426\u786E\u5B9A\u8981\u5207\u6362\u670D\u52A1\u5668\uFF1F",dev:"\u5F00\u53D1\u6A21\u5F0F"},tag_reference:{description:"\u8BF4\u660E",on_wiki:"wiki.osm.org\u4E0A\u7684{tag}",used_with:"\u4F7F\u7528 {type}"},validations:{untagged_point:"\u672A\u6807\u8BB0\u7684\u70B9",untagged_line:"\u672A\u6807\u8BB0\u7684\u7EBF",untagged_area:"\u672A\u6807\u8BB0\u7684\u533A\u57DF",many_deletions:"\u60A8\u6B63\u5728\u5220\u9664 {n} \u4E2A\u5BF9\u8C61\uFF0C\u60A8\u786E\u5B9A\u8981\u8FD9\u4E48\u505A\u5417\uFF1F\u8FD9\u5C06\u4F1A\u628A\u5B83\u4EEC\u4ECE\u5927\u5BB6\u6240\u89C1\u7684 openstreetmap.org \u5730\u56FE\u4E0A\u5220\u9664\u3002",tag_suggests_area:"\u6807\u7B7E{tag}\u8868\u660E\u7EBF\u5E94\u8BE5\u4E3A\u533A\u57DF\uFF0C\u4F46\u5B83\u4E0D\u662F\u533A\u57DF",deprecated_tags:"\u5F03\u7528\u6807\u7B7E\uFF1A{tags}"},zoom:{in:"\u653E\u5927",out:"\u7F29\u5C0F"},cannot_zoom:"\u5728\u6B64\u6A21\u5F0F\u4E0B\u4E0D\u80FD\u518D\u7F29\u5C0F",gpx:{local_layer:"\u672C\u5730GPX\u6587\u4EF6",drag_drop:"\u62D6\u653EGPX\u6587\u4EF6\u5230\u9875\u9762\u4E0A\uFF0C\u6216\u6309\u4E00\u4E0B\u6D4F\u89C8\u6309\u94AE\uFF0C",zoom:"\u7F29\u653E\u5230GPX\u8F68\u8FF9",browse:"\u6D4F\u89C8GPX\u6587\u4EF6"},help:{title:"\u5E2E\u52A9",help:"# \u5E2E\u52A9\n\n\u8FD9\u662F\u514D\u8D39\u53EF\u7F16\u8F91\u7684\u4E16\u754C\u5730\u56FE [OpenStreetMap](http://www.openstreetmap.org/) \u7684\u7F16\u8F91\u5668\u3002\u60A8\u53EF\u4EE5\u4F7F\u7528\u5B83\u6765\u6DFB\u52A0\u548C\u66F4\u65B0\u60A8\u7684\u533A\u57DF\u7684\u6570\u636E\uFF0C\u5411\u6240\u6709\u4EBA\u8D21\u732E\u66F4\u597D\u7684\u5F00\u653E\u6E90\u4EE3\u7801\u3001\u5F00\u653E\u6570\u636E\u7684\u4E16\u754C\u5730\u56FE\u3002\n\n\u4F7F\u7528 OpenStreetMap \u7684\u6240\u6709\u4EBA\u90FD\u80FD\u770B\u5230\u60A8\u5728\u6B64\u5730\u56FE\u4E0A\u7684\u7F16\u8F91\u3002\u8981\u5F00\u59CB\u7F16\u8F91\uFF0C\u60A8\u9700\u8981\u4E00\u4E2A[\u514D\u8D39\u7684 OpenStreetMap \u5E10\u53F7](https://www.openstreetmap.org/user/new)\u3002\n\n[iD \u7F16\u8F91\u5668](http://ideditor.com/)\u662F\u4E00\u4E2A\u534F\u540C\u9879\u76EE\uFF0C[\u6E90\u4EE3\u7801\u53EF\u5728 GitHub \u83B7\u53D6](https://github.com/openstreetmap/iD)\u3002\n",editing_saving:"# \u7F16\u8F91\u548C\u4FDD\u5B58\n\n\u672C\u7F16\u8F91\u5668\u4E3A\u5728\u7EBF\u4F7F\u7528\u8BBE\u8BA1\uFF0C\u60A8\u5148\u5728\u4E5F\u662F\u901A\u8FC7\u4E00\u4E2A\u7F51\u7AD9\u8BBF\u95EE\u5B83\u7684\u3002\n\n### \u9009\u62E9\u7279\u5F81\n\n\u5728\u5730\u56FE\u4E0A\u70B9\u51FB\u53EF\u4EE5\u9009\u62E9\u4E00\u4E2A\u5730\u56FE\u7279\u5F81\uFF0C\u6BD4\u5982\u9053\u8DEF\u6216\u666F\u70B9\uFF0C\u5E76\u4F7F\u5F97\u6240\u9009\u7684\u7279\u5F81\u9AD8\u4EAE\u663E\u793A\u3001\u6253\u5F00\u5305\u542B\u5B83\u8BE6\u60C5\u7684\u9762\u677F\u3001\u4EE5\u53CA\u663E\u793A\u4E00\u4E2A\u5305\u542B\u60A8\u53EF\u4EE5\u5BF9\u8FD9\u4E2A\u7279\u5F81\u6240\u505A\u64CD\u4F5C\u7684\u83DC\u5355\u3002\n\n\u6309\u4F4F Shift \u952E\u5E76\u70B9\u51FB\u60A8\u60F3\u9009\u62E9\u7684\u7279\u5F81\u6216\u5728\u5730\u56FE\u4E0A\u62D6\u62FD\u65B9\u6846\u53EF\u4EE5\u9009\u62E9\u591A\u4E2A\u7279\u5F81\u3002\n\n### \u4FDD\u5B58\u7F16\u8F91\n\n\u5F53\u60A8\u505A\u4E86\u6BD4\u5982\u7F16\u8F91\u9053\u8DEF\u3001\u5EFA\u7B51\u7269\u6216\u5730\u70B9\u7684\u66F4\u6539\u540E\uFF0C\u8FD9\u4E9B\u66F4\u6539\u5728\u60A8\u5C06\u5B83\u4EEC\u4FDD\u5B58\u5230\u670D\u52A1\u5668\u4E4B\u524D\u90FD\u53EA\u4F1A\u4FDD\u5B58\u5728\u672C\u5730\u3002\u4E0D\u8981\u62C5\u5FC3\u72AF\u9519\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB\u64A4\u9500\u6216\u91CD\u505A\u6309\u94AE\u64A4\u9500\u6216\u91CD\u505A\u66F4\u6539\u3002\n\n\u70B9\u51FB\u300C\u4FDD\u5B58\u300D\u6309\u94AE\u7ED3\u675F\u4E00\u7EC4\u7F16\u8F91\uFF0C\u6BD4\u65B9\u8BF4\uFF0C\u5F53\u60A8\u5B8C\u6210\u4E86\u57CE\u9547\u4E00\u4E2A\u533A\u57DF\u5E76\u60F3\u8981\u5F00\u59CB\u4E00\u4E2A\u65B0\u533A\u57DF\u3002\u60A8\u4F1A\u6709\u4E00\u6B21\u68C0\u67E5\u60A8\u6240\u505A\u7684\u66F4\u6539\u7684\u673A\u4F1A\uFF0C\u6B64\u65F6\u7F16\u8F91\u5668\u4F1A\u63D0\u4F9B\u4E00\u4E9B\u6709\u5E2E\u52A9\u7684\u5EFA\u8BAE\u5E76\u5BF9\u770B\u8D77\u6765\u6709\u95EE\u9898\u7684\u66F4\u6539\u4F5C\u51FA\u8B66\u544A\u3002\n\n\u5982\u679C\u4E00\u5207\u6B63\u5E38\uFF0C\u60A8\u53EF\u4EE5\u8F93\u5165\u4E00\u6BB5\u7B80\u77ED\u7684\u6587\u5B57\u8BF4\u660E\u60A8\u6240\u505A\u7684\u66F4\u6539\uFF0C\u5E76\u518D\u6B21\u70B9\u51FB\u300C\u4FDD\u5B58\u300D\u5C06\u66F4\u6539\u63D0\u4EA4\u5230 [OpenStreetMap.org](http://www.openstreetmap.org/)\uFF0C\u8BA9\u6240\u6709\u7528\u6237\u90FD\u53EF\u4EE5\u6D4F\u89C8\u6216\u7EE7\u7EED\u6539\u8FDB\u3002\n\n\u5982\u679C\u60A8\u4E0D\u80FD\u4E00\u6B21\u5B8C\u6210\u60A8\u7684\u7F16\u8F91\uFF0C\u60A8\u53EF\u4EE5\u79BB\u5F00\u7F16\u8F91\u5668\u7A97\u53E3\uFF0C\u5E76\u968F\u65F6\u56DE\u6765(\u540C\u4E00\u53F0\u7535\u8111\uFF0C\u540C\u4E00\u4E2A\u6D4F\u89C8\u5668)\u7EE7\u7EED\u7F16\u8F91\u3002\u7F16\u8F91\u5668\u4F1A\u4E3A\u60A8\u4FDD\u7559\u4E0A\u4E00\u6B21\u7684\u72B6\u6001\u3002\n",roads:"# \u9053\u8DEF\n\n\u60A8\u53EF\u4EE5\u5229\u7528\u8FD9\u4E2A\u7F16\u8F91\u5668\u521B\u5EFA\uFF0C\u4FEE\u590D\uFF0C\u53CA\u5220\u9664\u9053\u8DEF\u3002\u9053\u8DEF\u53EF\u4EE5\u6709\u5F88\u591A\u79CD\uFF1A\u8DEF\u5F84\uFF0C\u516C\u8DEF\uFF0C\u90CA\u6E38\u5F84\uFF0C\u5355\u8F66\u5F84\uFF0C\u548C\u66F4\u591A\uFF0D \u4EFB\u4F55\u7ECF\u5E38\u4F7F\u7528\u7684\u8DEF\u6BB5\u90FD\u53EF\u5236\u56FE\u3002\n\n### \u9009\u62E9\u9053\u8DEF\n\n\u70B9\u51FB\u56FE\u4E0A\u7684\u9053\u8DEF\u4EE5\u9009\u62E9\u8BE5\u9053\u8DEF\u3002\u9053\u8DEF\u7684\u8F6E\u5ED3\u4F1A\u4EE5\u9AD8\u4EAE\u5EA6\u663E\u793A\uFF0C\u800C\u540C\u65F6\u5730\u56FE\u4E0A\u4F1A\u51FA\u73B0\u5C0F\u5DE5\u5177\u9009\u5355\uFF0C\u65C1\u8FB9\u4EA6\u4F1A\u5F39\u51FA\u9762\u677F\uFF0C\u663E\u793A\u6709\u5173\u8BE5\u9053\u8DEF\u7684\u4FE1\u606F\u3002\n\n### \u7F16\u8F91\u9053\u8DEF\n\n\u60A8\u6216\u4F1A\u7ECF\u5E38\u6CE8\u610F\u5230\uFF0C\u9053\u8DEF\u5E76\u975E\u5BF9\u9F50\u5728\u80CC\u666F\u4E2D\u663E\u793A\u7684\u536B\u661F\u56FE\u50CF\u6216GPS\u8F68\u8FF9\u3002\u60A8\u53EF\u4EE5\u8C03\u6574\u8FD9\u4E9B\u9053\u8DEF\uFF0C\u8BA9\u4ED6\u4EEC\u4F4D\u4E8E\u6B63\u786E\u7684\u4F4D\u7F6E\u3002\n\n\u9996\u5148\uFF0C\u70B9\u51FB\u60A8\u60F3\u7F16\u8F91\u7684\u9053\u8DEF\u3002\u8FD9\u4F1A\u5C06\u9053\u8DEF\u4EE5\u9AD8\u4EAE\u5EA6\u663E\u793A\uFF0C\u5E76\u663E\u793A\u6CBF\u7740\u8FD9\u9053\u8DEF\u7684\u8282\u70B9\uFF0C\u4F60\u53EF\u4EE5\u62D6\u66F3\u8FD9\u4E9B\u8282\u70B9\u5230\u66F4\u597D\u7684\u4F4D\u7F6E\u3002\u5982\u679C\u60A8\u60F3\u589E\u52A0\u7EC6\u8282\uFF0C\u53EF\u4EE5\u4E3A\u9053\u8DEF\u6DFB\u52A0\u65B0\u7684\u8282\u70B9\uFF0C\u70B9\u51FB\u4E24\u4E0B\u9053\u8DEF\u4E0A\u6CA1\u6709\u8282\u70B9\u7684\u90E8\u5206\uFF0C\u4FBF\u53EF\u5728\u8BE5\u5904\u5897\u52A0\u8282\u70B9\u3002\n\n\u5982\u679C\u9053\u8DEF\u8FDE\u63A5\u5230\u53E6\u4E00\u6761\u9053\u8DEF\uFF0C\u4F46\u5728\u5730\u56FE\u4E0A\u5E76\u672A\u59A5\u5584\u8FDE\u63A5\uFF0C\u4F60\u53EF\u4EE5\u62D6\u66F3\u9053\u8DEF\u7684\u5176\u4E2D\u4E00\u4E2A\u8282\u70B9\u5230\u53E6\u4E00\u6761\u9053\u8DEF\u4E0A\uFF0C\u4EE5\u8FDE\u63A5\u4E24\u6761\u9053\u8DEF\u3002\u8FDE\u63A5\u597D\u9053\u8DEF\uFF0C\u5BF9\u5730\u56FE\u975E\u5E38\u91CD\u8981\uFF0C\u7279\u522B\u662F\u5BF9\u63D0\u4F9B\u9A7E\u9A76\u6307\u793A\u7684\u5E94\u7528\u7A0B\u5E8F\u800C\u8A00\uFF0C\u662F\u5FC5\u8981\u7684\u3002\n\n\u60A8\u4E5F\u53EF\u4EE5\u70B9\u51FB'\u79FB\u52A8'\u5DE5\u5177\u6216\u6309`M`\u5FEB\u901F\u952E\uFF0C\u6765\u79FB\u52A8\u6574\u6761\u9053\u8DEF\uFF0C\u7136\u540E\u70B9\u51FB\u4E00\u4E0B\u4EE5\u5B8C\u6210\u79FB\u52A8\u7684\u52A8\u4F5C\u3002\n\n### \u5220\u9664\u9053\u8DEF\n\n\u5982\u679C\u4E00\u6761\u9053\u8DEF\u5B8C\u5168\u4E0D\u6B63\u786E\uFF0D \u60A8\u770B\u5230\u5B83\u5728\u536B\u661F\u56FE\u50CF\u4E0A\u4E0D\u5B58\u5728\uFF0C\u5E76\u6700\u597D\u5B9E\u5730\u8BC1\u5B9E\u5B83\u6839\u672C\u4E0D\u5B58\u5728\uFF0D \u60A8\u53EF\u4EE5\u5C06\u9053\u8DEF\u5220\u9664\uFF0C\u8FD9\u4F1A\u4ECE\u5730\u56FE\u4E2D\u5C06\u4E4B\u79FB\u9664\u3002\u5220\u9664\u7269\u4EF6\u65F6\u52A1\u5FC5\u8981\u5C0F\u5FC3\uFF0D \u50CF\u4EFB\u4F55\u5176\u4ED6\u7684\u7F16\u8F91\uFF0C\u7ED3\u679C\u4F1A\u88AB\u5927\u5BB6\u770B\u89C1\uFF0C\u800C\u536B\u661F\u56FE\u50CF\u5F80\u5F80\u4F1A\u8FC7\u65F6\uFF0C\u56E0\u6B64\u8BE5\u9053\u8DEF\u6216\u8BB8\u53EA\u662F\u65B0\u5EFA\u7684\u3002\n\n\u8981\u5220\u9664\u9053\u8DEF\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB\u5B83\u4EE5\u9009\u62E9\uFF0C\u7136\u540E\u70B9\u51FB\u5783\u573E\u6876\u56FE\u6807\uFF0C\u6216\u6309'Delete' \u952E\u3002\n\n### \u7ED8\u5236\u65B0\u9053\u8DEF\n\n\u53D1\u73B0\u67D0\u5904\u5E94\u6709\u4E00\u6761\u9053\u8DEF\uFF0C\u4F46\u5730\u56FE\u4E0A\u6CA1\u6709\uFF1F\u70B9\u51FB\u7F16\u8F91\u5668\u5DE6\u4E0A\u65B9\u7684'\u7EBF'\u56FE\u6807\uFF0C\u6216\u6309\u4E0B`2`\u5FEB\u901F\u952E\uFF0C\u4EE5\u5F00\u59CB\u7ED8\u5236\u7EBF\u6BB5\u3002\n\n\u5728\u5730\u56FE\u4E0A\u70B9\u51FB\u9053\u8DEF\u7684\u5F00\u7AEF\uFF0C\u4EE5\u5F00\u59CB\u7ED8\u5236\u9053\u8DEF\u3002\u5982\u679C\u9053\u8DEF\u4ECE\u4E00\u6761\u73B0\u6709\u7684\u9053\u8DEF\u5206\u652F\u51FA\u6765\uFF0C\u5E94\u70B9\u51FB\u4E24\u8005\u8FDE\u63A5\u7684\u5730\u65B9\uFF0C\u4EE5\u5F00\u59CB\u7ED8\u5236\u3002\n\n\u7136\u540E\u70B9\u51FB\u6CBF\u7740\u9053\u8DEF\u7684\u70B9\uFF0C\u4EE5\u6839\u636E\u536B\u661F\u5F71\u50CF\u6216GPS\u8F68\u8FF9\uFF0C\u6B63\u786E\u5730\u7ED8\u5236\u9053\u8DEF\u3002\u5982\u679C\u60A8\u7ED8\u5236\u7684\u9053\u8DEF\u5982\u679C\u4E0E\u53E6\u4E00\u6761\u9053\u8DEF\u4EA4\u6C47\uFF0C\u8BF7\u70B9\u51FB\u76F8\u4EA4\u70B9\u4EE5\u5C06\u5B83\u4EEC\u8FDE\u63A5\u8D77\u6765\u3002\u5F53\u60A8\u5B8C\u6210\u7ED8\u5236\u540E\uFF0C\u53EF\u70B9\u51FB\u4E24\u4E0B\u6216\u6309\u952E\u76D8\u4E0A\u7684'Return' \u6216'Enter' \u952E\u3002\n",gps:"# GPS\n\nGPS \u6570\u636E\u662F OpenStreetMap \u4E2D\u6700\u53EF\u4FE1\u7684\u4FE1\u606F\u3002\u672C\u7F16\u8F91\u5668\n\u652F\u6301\u4F60\u7535\u8111\u4E2D\u7684\u672C\u5730\u8DEF\u7EBF\u6570\u636E - `.gpx`\u3002\u4F60\u53EF\u4EE5\u901A\u8FC7\u67D0\u4E9B\n\u667A\u80FD\u624B\u673A\u4E2D\u7684\u5E94\u7528\u7A0B\u5E8F\u6216\u4E2A\u4EBA GPS \u8BBE\u5907\u6536\u96C6\u6B64\u7C7B\u578B\u7684 GPS \n\u8DEF\u7EBF\u6570\u636E\u3002\n\n\u5173\u4E8E\u5982\u4F55\u8FDB\u884C GPS \u6D4B\u91CF\u7684\u4FE1\u606F\u8BF7\u53C2\u9605[\u4F7F\u7528 GPS \u6D4B\u91CF\u4FE1\u606F](http://learnosm.org/en/beginner/using-gps/)\u3002\n\n\u8981\u4F7F\u7528 GPX \u8DEF\u7EBF\u7ED8\u5236\u5730\u56FE\uFF0C\u62D6\u52A8 GPX \u6587\u4EF6\u81F3\u5730\u56FE\u7F16\u8F91\u5668\u4E2D\u3002\n\u5982\u679C\u88AB\u8BC6\u522B\u5230\u4E86\uFF0C\u4F1A\u53D8\u6210\u4EAE\u7EFF\u8272\u7684\u7EBF\u3002\u70B9\u51FB\u53F3\u4FA7\u7684\u201C\u80CC\u666F\u8BBE\u7F6E\u201D\n\u83DC\u5355\u6765\u5F00\u542F\u3001\u5173\u95ED\u3001\u6216\u8005\u7F29\u653E\u8FD9\u4E2A\u65B0\u7684GPX\u56FE\u5C42\u3002\n\nGPX \u8DEF\u7EBF\u6570\u636E\u4E0D\u4F1A\u88AB\u76F4\u63A5\u4E0A\u4F20\u5230 OpenStreetMap \u4E2D\u3002\u4F7F\u7528\n\u5B83\u7684\u6700\u597D\u7684\u65B9\u5F0F\u662F\u4EE5\u5B83\u4E3A\u53C2\u7167\u7ED8\u5236\u51FA\u4F60\u9700\u8981\u6DFB\u52A0\u7684\u7279\u5F81\u3002\u4F60\u53EF\n\u4EE5\u53EF\u4EE5[\u4E0A\u4F20\u5230 OpenStreetMap ](http://www.openstreetmap.org/trace/create)\n\u4EE5\u4FBF\u5176\u4ED6\u7528\u5904\u3002\n",imagery:"# \u5F71\u50CF\n\n\u822A\u62CD\u5F71\u50CF\u662F\u7ED8\u5236\u5730\u56FE\u7684\u4E00\u4E2A\u91CD\u8981\u8D44\u6E90\u3002\u7F16\u8F91\u5668\u53F3\u4FA7\u300C\u80CC\u666F\u8BBE\u7F6E\u300D\u83DC\u5355\u91CC\u63D0\u4F9B\u4E86\u4E00\u7EC4\u98DE\u673A\u822A\u62CD\u3001\u536B\u661F\u5F71\u50CF\u53CA\u81EA\u7531\u7F16\u8BD1\u7684\u6765\u6E90\u3002\n\n\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u7F16\u8F91\u5668\u663E\u793A\u7684\u662F[\u5FC5\u5E94\u5730\u56FE](http://www.bing.com/maps/)\u7684\u536B\u661F\u56FE\u5C42\uFF0C\u4F46\u5F53\u60A8\u79FB\u52A8\u6216\u7F29\u653E\u5730\u56FE\u5230\u4E00\u4E2A\u65B0\u7684\u5730\u7406\u533A\u57DF\u4F1A\u5F97\u5230\u65B0\u7684\u6765\u6E90\u3002\u4E00\u4E9B\u56FD\u5BB6\uFF0C\u6BD4\u5982\u7F8E\u56FD\u3001\u6CD5\u56FD\u548C\u4E39\u9EA6\uFF0C\u4F1A\u5728\u4E00\u4E9B\u533A\u57DF\u63D0\u4F9B\u975E\u5E38\u9AD8\u8D28\u91CF\u7684\u5F71\u50CF\u3002\n\n\u5F71\u50CF\u6709\u65F6\u4F1A\u56E0\u4E3A\u5F71\u50CF\u63D0\u4F9B\u5546\u7684\u9519\u8BEF\u548C\u5730\u56FE\u6570\u636E\u5B58\u5728\u504F\u79FB\u3002\u5982\u679C\u60A8\u770B\u5230\u8BB8\u591A\u9053\u8DEF\u504F\u79BB\u80CC\u666F\uFF0C\u8BF7\u4E0D\u8981\u7ACB\u523B\u79FB\u52A8\u5B83\u4EEC\u6765\u5339\u914D\u80CC\u666F\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB\u80CC\u666F\u8BBE\u7F6E\u754C\u9762\u5E95\u90E8\u7684\u300C\u4FEE\u590D\u5BF9\u9F50\u300D\u6765\u8C03\u6574\u5F71\u50CF\u4EE5\u4F7F\u5B83\u548C\u5DF2\u6709\u6570\u636E\u543B\u5408\u3002\n",addresses:"# \u5730\u5740\n\n\u5730\u5740\u662F\u5730\u56FE\u4E0A\u7684\u6700\u6709\u7528\u7684\u4E00\u4E9B\u4FE1\u606F\u3002\n\nOpenStreetMap\u901A\u8FC7\u6CBF\u8857\u4F4D\u7F6E\u8BB0\u5F55\u5EFA\u7B51\u548C\u573A\u6240\u7684\u5730\u5740\uFF0C\u5730\u5740\u901A\u5E38\u8868\u793A\u4E3A\u8857\u9053\u7684\u4E00\u90E8\u5206\u3002\n\n\u60A8\u53EF\u4EE5\u6DFB\u52A0\u5730\u5740\u4FE1\u606F\u6620\u5C04\u4E3A\u5EFA\u7B51\u8F6E\u5ED3\u7684\u5730\u65B9\u4EE5\u53CA\u90A3\u4E9B\u6620\u5C04\u4E3A\u5355\u4E2A\u70B9\u3002\u5730\u5740\u7684\u6700\u4F73\u6765\u6E90\u6570\u636E\u662F\u6765\u81EA\u4E8E\u5B9E\u5730\u8C03\u67E5\u6216\u4E2A\u4EBA\u7684\u77E5\u8BC6\u4E0E\u4EFB\u4F55\u5176\u4ED6\u529F\u80FD\uFF0C\u4ECE\u8C37\u6B4C\u5730\u56FE\u5546\u4E1A\u6765\u6E90\u7684\u590D\u5236\u662F\u4E25\u683C\u7981\u6B62\u7684\u3002\n",inspector:"# \u4F7F\u7528\u68C0\u67E5\u5668\n\n\u68C0\u67E5\u5668\u4F4D\u4E8E\u9875\u9762\u5DE6\u4FA7\uFF0C\u53EF\u4EE5\u7528\u6765\u7F16\u8F91\u6240\u9009\u7279\u5F81\u7684\u8BE6\u60C5\u3002\n\n### \u9009\u62E9\u7279\u5F81\u7C7B\u578B\n\n\u5F53\u60A8\u6DFB\u52A0\u4E86\u4E00\u4E2A\u70B9\u3001\u7EBF\u6216\u533A\u57DF\u540E\uFF0C\u60A8\u53EF\u4EE5\u9009\u62E9\u5B83\u7279\u5F81\u7C7B\u578B\uFF0C\u6BD4\u5982\u5B83\u662F\u9AD8\u901F\u516C\u8DEF\u8FD8\u662F\u5C0F\u533A\u9053\u8DEF\u3001\u8D85\u5E02\u8FD8\u662F\u5496\u5561\u5385\u3002\u68C0\u67E5\u5668\u4F1A\u663E\u793A\u57FA\u672C\u7279\u5F81\u7C7B\u578B\u7684\u6309\u94AE\uFF0C\u60A8\u4E5F\u53EF\u4EE5\u5728\u641C\u7D22\u6846\u4E2D\u8F93\u5165\u5176\u5B83\u60A8\u8981\u5BFB\u627E\u7684\u7C7B\u578B\u3002\n\n\u70B9\u51FB\u7279\u5F81\u7C7B\u578B\u53F3\u4E0B\u89D2\u7684\u300Ci\u300D\u53EF\u4EE5\u4E86\u89E3\u8FD9\u4E2A\u7C7B\u578B\u7684\u4E00\u4E9B\u4FE1\u606F\uFF0C\u70B9\u51FB\u6309\u94AE\u9009\u4E2D\u8FD9\u4E2A\u7C7B\u578B\u3002\n\n### \u4F7F\u7528\u8868\u5355\u548C\u7F16\u8F91\u6807\u7B7E\n\n\u5F53\u4F60\u9009\u4E2D\u4E00\u4E2A\u7279\u5F81\u7C7B\u578B\uFF0C\u6216\u5F53\u4F60\u9009\u4E2D\u4E86\u4E00\u4E2A\u5DF2\u7ECF\u6307\u5B9A\u4E86\u7C7B\u578B\u7684\u7279\u5F81\u540E\uFF0C\u68C0\u67E5\u5668\u4F1A\u663E\u793A\u8FD9\u4E2A\u7279\u5F81\u7684\u540D\u79F0\u3001\u5730\u5740\u7B49\u5B57\u6BB5\u548C\u8BE6\u60C5\u3002\n\n\u5728\u60A8\u770B\u5230\u7684\u5B57\u6BB5\u4E0B\u9762\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB\u56FE\u6807\u6765\u6DFB\u52A0\u5176\u5B83\u8BE6\u60C5\uFF0C\u6BD4\u5982[\u7EF4\u57FA\u767E\u79D1](http://www.wikipedia.org/)\u4FE1\u606F\u3001\u65E0\u969C\u788D\u60C5\u51B5\u7B49\u3002\n\n\u5728\u68C0\u67E5\u5668\u7684\u5E95\u90E8\uFF0C\u70B9\u51FB\u300C\u9644\u52A0\u6807\u7B7E\u300D\u53EF\u4EE5\u5411\u5143\u7D20\u6DFB\u52A0\u5176\u5B83\u4EFB\u610F\u6807\u7B7E\u3002\u60A8\u53EF\u4EE5\u4ECE [Taginfo](http://taginfo.openstreetmap.org/) \u4E86\u89E3\u66F4\u591A\u5E38\u7528\u6807\u7B7E\u7EC4\u5408\u7684\u4FE1\u606F\u3002\n\n\u60A8\u5728\u68C0\u67E5\u5668\u4E2D\u6240\u505A\u7684\u66F4\u6539\u5C06\u4F1A\u81EA\u52A8\u5E94\u7528\u5230\u5730\u56FE\u4E0A\u3002\u60A8\u53EF\u4EE5\u968F\u65F6\u70B9\u51FB\u300C\u64A4\u9500\u300D\u6309\u94AE\u64A4\u6389\u66F4\u6539\u3002\n",buildings:"# \u5EFA\u7B51\u7269\n\nOpenStreetMap \u662F\u4E16\u754C\u4E0A\u6700\u5927\u7684\u5EFA\u7B51\u7269\u7684\u6570\u636E\u5E93\u3002\u60A8\u53EF\u4EE5\u5EFA\u7ACB\u548C\u6539\u5584\u8FD9\u4E2A\u6570\u636E\u5E93\u3002\n\n### \u9009\u62E9\u5EFA\u7B51\u7269\n\n\u60A8\u53EF\u4EE5\u70B9\u51FB\u5EFA\u7B51\u7269\u7684\u8FB9\u754C\uFF0C\u4EE5\u9009\u62E9\u8BE5\u5EFA\u7B51\u7269\u3002\u8BE5\u5EFA\u7B51\u7269\u5C06\u4EE5\u9AD8\u4EAE\u5EA6\u663E\u793A\uFF0C\u5E76\u4F1A\u5F00\u542F\u5C0F\u5DE5\u5177\u9009\u5355\uFF0C\u548C\u5728\u53F3\u8FB9\u663E\u793A\u6709\u5173\u5EFA\u7B51\u7269\u66F4\u591A\u8D44\u6599\u7684\u9762\u677F\u3002\n\n### \u4FEE\u6539\u5EFA\u7B51\u7269\n\n\u6709\u65F6\u5019\uFF0C\u5EFA\u7B51\u7269\u7684\u4F4D\u7F6E\u6216\u5176\u6807\u7B7E\u6216\u8BB8\u4F1A\u4E0D\u6B63\u786E\u3002\n\n\u8981\u79FB\u52A8\u6574\u4E2A\u5EFA\u7B51\u7269\u7684\u4F4D\u7F6E\uFF0C\u5148\u9009\u62E9\u8BE5\u5EFA\u7B51\u7269\uFF0C\u7136\u540E\u70B9\u51FB'\u79FB\u52A8'\u5DE5\u5177\u3002\u79FB\u52A8\u60A8\u7684\u6ED1\u9F20\u4EE5\u79FB\u52A8\u7B51\u7269\uFF0C\u5728\u79FB\u5230\u6B63\u786E\u4F4D\u7F6E\u4E0A\u70B9\u51FB\u4E00\u4E0B\u3002\n\n\u8981\u66F4\u6B63\u5EFA\u7B51\u7269\u7684\u5F62\u72B6\uFF0C\u70B9\u51FB\u5E76\u62D6\u66F3\u5EFA\u7B51\u7269\u8F6E\u5ED3\u7684\u8282\u70B9\uFF0C\u4EE5\u79FB\u5230\u66F4\u4F73\u7684\u4F4D\u7F6E\u3002\n\n### \u7ED8\u5236\u65B0\u5EFA\u7B51\u7269\n\n\u4E3A\u5730\u56FE\u6DFB\u52A0\u5EFA\u7B51\u7269\u7684\u4E3B\u8981\u95EE\u9898\u4E4B\u4E00\uFF0C\u662FOpenStreetMap \u53EF\u4EE5\u7528\u8F6E\u5ED3\u6216\u70B9\u7684\u5F62\u5F0F\uFF0C\u8BB0\u5F55\u5EFA\u7B51\u7269\u3002\u4E00\u822C\u6765\u8BF4\uFF0C\u5E94_\u5C3D\u53EF\u80FD\u4EE5\u533A\u57DF\u8BB0\u5F55\u5EFA\u7B51\u7269\u7684\u8F6E\u5ED3_\uFF0C\u5E76\u4EE5\u7F6E\u4E8E\u5EFA\u7B51\u8F6E\u5ED3\u5185\u7684\u70B9\uFF0C\u8BB0\u5F55\u5EFA\u7B51\u7269\u4E2D\u7684\u516C\u53F8\u3001\u4F4F\u5B85\u3001\u8BBE\u65BD\u53CA\u5176\u4ED6\u4E1C\u897F\u3002\n\n\u8981\u5F00\u59CB\u7ED8\u5236\u5EFA\u7B51\u7269\uFF0C\u5148\u5355\u51FB\u5DE6\u4E0A\u65B9\u7684'\u533A\u57DF'\u6309\u94AE\uFF0C\u6700\u540E\u5219\u6309\u952E\u76D8\u4E0A\u7684'Return'\u952E\u6216\u70B9\u51FB\u6240\u7ED8\u7684\u7B2C\u4E00\u4E2A\u8282\u70B9\uFF0C\u5B8C\u6210\u8F6E\u5ED3\u7684\u7ED8\u5236\u3002\n\n### \u5220\u9664\u5EFA\u7B51\u7269\n\n\u5982\u679C\u4E00\u9879\u5EFA\u7B51\u7269\u5B8C\u5168\u4E0D\u6B63\u786E\uFF0D \u60A8\u770B\u5230\u5B83\u5728\u536B\u661F\u56FE\u50CF\u4E0A\u4E0D\u5B58\u5728\uFF0C\u5E76\u6700\u597D\u5B9E\u5730\u8BC1\u5B9E\u5B83\u6839\u672C\u4E0D\u5B58\u5728\uFF0D \u60A8\u53EF\u4EE5\u5C06\u5EFA\u7B51\u7269\u5220\u9664\uFF0C\u8FD9\u4F1A\u4ECE\u5730\u56FE\u4E2D\u5C06\u4E4B\u79FB\u9664\u3002\u5220\u9664\u7269\u4EF6\u65F6\u52A1\u5FC5\u8981\u5C0F\u5FC3\uFF0D \u50CF\u4EFB\u4F55\u5176\u4ED6\u7684\u7F16\u8F91\uFF0C\u7ED3\u679C\u4F1A\u88AB\u5927\u5BB6\u770B\u89C1\uFF0C\u800C\u536B\u661F\u56FE\u50CF\u5F80\u5F80\u4F1A\u8FC7\u65F6\uFF0C\u56E0\u6B64\u8BE5\u5EFA\u7B51\u7269\u6216\u8BB8\u53EA\u662F\u65B0\u5EFA\u7684\u3002\n\n\u8981\u5220\u9664\u5EFA\u7B51\u7269\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB\u5B83\u4EE5\u9009\u62E9\uFF0C\u7136\u540E\u70B9\u51FB\u5783\u573E\u6876\u56FE\u6807\uFF0C\u6216\u6309'Delete' \u952E\u3002\n",relations:"# \u5173\u7CFB\n\n\u5173\u7CFB\u662F OpenStreetMap \u4E2D\u7528\u4E8E\u7EC4\u5408\u5176\u5B83\u7279\u5F81\u7684\u7279\u6B8A\u7279\u5F81\u7C7B\u578B\u3002\u6BD4\u5982\uFF0C\u4E24\u4E2A\u57FA\u672C\u5173\u7CFB\u7C7B\u578B*\u8DEF\u5F84\u5173\u7CFB*\u548C*\u590D\u5408\u591A\u8FB9\u5F62*\uFF0C\u5B83\u4EEC\u5206\u522B\u7528\u4E8E\u7EC4\u5408\u540C\u4E00\u6761\u516C\u8DEF\u6216\u9AD8\u901F\u516C\u8DEF\u7684\u4E0D\u540C\u90E8\u5206\u548C\u4E00\u4E2A\u590D\u6742\u533A\u57DF(\u5206\u6210\u591A\u5757\u6216\u50CF\u6CB9\u70B8\u5708\u997C\u4E00\u6837\u4E2D\u95F4\u6709\u4E2A\u6D1E)\u7684\u591A\u6761\u7EBF\u6761\u3002\n\n\u5173\u7CFB\u4E2D\u5305\u542B\u7684\u7279\u5F81\u79F0\u4E3A*\u6210\u5458*\u3002\u5728\u4FA7\u8FB9\u680F\u4E2D\uFF0C\u60A8\u53EF\u4EE5\u770B\u5230\u6210\u5458\u6240\u5C5E\u7684\u5173\u7CFB\uFF0C\u5E76\u70B9\u51FB\u9009\u4E2D\u5B83\u3002\u9009\u4E2D\u67D0\u4E2A\u5173\u7CFB\u540E\uFF0C\u60A8\u5C31\u80FD\u770B\u5230\u5B83\u7684\u6240\u6709\u6210\u5458\u5728\u4FA7\u8FB9\u680F\u88AB\u5168\u90E8\u5217\u51FA\u5E76\u5728\u5730\u56FE\u4E0A\u88AB\u9AD8\u4EAE\u663E\u793A\u3002\n\n\u5728\u5927\u591A\u6570\u65F6\u5019\uFF0CiD \u4F1A\u5728\u60A8\u7F16\u8F91\u7684\u65F6\u5019\u81EA\u52A8\u5904\u7406\u5173\u7CFB\u3002\u60A8\u4E3B\u8981\u6CE8\u610F\u7684\u662F\u5F53\u60A8\u5220\u9664\u9053\u8DEF\u7684\u67D0\u4E2A\u90E8\u5206\u5E76\u91CD\u7ED8\u5B83\u65F6\uFF0C\u8BF7\u786E\u4FDD\u65B0\u7684\u90E8\u5206\u8FD8\u662F\u539F\u6765\u7684\u5173\u7CFB\u4E2D\u7684\u4E00\u5458\u3002\n\n## \u7F16\u8F91\u5173\u7CFB\n\n\u5982\u679C\u60A8\u60F3\u8981\u7F16\u8F91\u5173\u7CFB\uFF0C\u8FD9\u91CC\u662F\u4E00\u4E9B\u57FA\u672C\u6280\u5DE7\u3002\n\n\u8981\u5411\u5173\u7CFB\u4E2D\u6DFB\u52A0\u7279\u5F81\uFF0C\u9009\u62E9\u8BE5\u7279\u5F81\uFF0C\u70B9\u51FB\u4FA7\u8FB9\u680F\u300C\u6240\u6709\u5173\u7CFB\u300D\u4E2D\u7684\u300C+\u300D\u6309\u94AE\uFF0C\u5E76\u9009\u62E9\u6216\u8F93\u5165\u5173\u7CFB\u7684\u540D\u79F0\u3002\n\n\u8981\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u5173\u7CFB\uFF0C\u9009\u4E2D\u8981\u4F5C\u4E3A\u6210\u5458\u7684\u7B2C\u4E00\u4E2A\u7279\u5F81\uFF0C\u70B9\u51FB\u300C\u6240\u6709\u5173\u7CFB\u300D\u4E2D\u7684\u300C+\u300D\u6309\u94AE\uFF0C\u5E76\u9009\u62E9\u300C\u65B0\u5EFA\u5173\u7CFB...\u300D\u3002\n\n\u8981\u4ECE\u4E00\u4E2A\u5173\u7CFB\u4E2D\u79FB\u9664\u7279\u5F81\uFF0C\u9009\u62E9\u7279\u5F81\u5E76\u70B9\u51FB\u60A8\u8981\u4ECE\u4E2D\u79FB\u9664\u7684\u5173\u7CFB\u65C1\u8FB9\u7684\u5783\u573E\u7BB1\u6309\u94AE\u3002\n\n\u60A8\u53EF\u4EE5\u4F7F\u7528\u300C\u5408\u5E76\u300D\u5DE5\u5177\u521B\u5EFA\u6709\u6D1E\u7684\u590D\u5408\u591A\u8FB9\u5F62\u3002\u7ED8\u5236\u4E24\u4E2A\u533A\u57DF(\u5185\u90E8\u548C\u5916\u90E8)\uFF0C\u6309\u4F4F Shift \u952E\u5E76\u70B9\u51FB\u5404\u4E2A\u591A\u8FB9\u5F62\u6765\u9009\u4E2D\u5B83\u4EEC\uFF0C\u7136\u540E\u7535\u673A\u300C\u5408\u5E76\u300D(+)\u6309\u94AE\u3002\n"},intro:{navigation:{title:"\u5BFC\u822A",drag:"\u4E3B\u5730\u56FE\u533A\u57DF\u5728\u80CC\u666F\u4E0A\u5C55\u793A\u4E86 OpenStreetMap \u6570\u636E\u3002\u60A8\u53EF\u4EE5\u50CF\u5728\u5176\u5B83\u7F51\u7EDC\u5730\u56FE\u4E00\u6837\u901A\u8FC7\u62D6\u52A8\u548C\u6EDA\u52A8\u6765\u79FB\u52A8\u3002**\u62D6\u52A8\u5730\u56FE\uFF01**",select:"\u5730\u56FE\u7279\u5F81\u6709\u4E09\u79CD\u8868\u793A\u65B9\u6CD5\uFF1A\u70B9\u3001\u7EBF\u6216\u533A\u57DF\u3002\u6240\u6709\u7279\u5F81\u90FD\u53EF\u4EE5\u901A\u8FC7\u70B9\u51FB\u9009\u62E9\u3002**\u5355\u51FB\u8BE5\u70B9\u6765\u9009\u5B9A\u5B83\u3002**",header:"\u4E0A\u65B9\u663E\u793A\u7279\u5F81\u7C7B\u578B",pane:"\u5F53\u9009\u5B9A\u4E00\u4E2A\u7279\u5F81\u65F6\uFF0C\u4F1A\u51FA\u73B0\u7279\u5F81\u7F16\u8F91\u5668\u3002\u62AC\u5934\u5C55\u793A\u7279\u5F81\u7C7B\u578B\uFF0C\u4E3B\u7A97\u683C\u5C55\u793A\u7279\u5F81\u7684\u5C5E\u6027\uFF0C\u5982\u540D\u79F0\u548C\u5730\u5740\u3002**\u5355\u51FB\u7279\u5F81\u7F16\u8F91\u5668\u53F3\u4E0A\u89D2\u7684\u5173\u95ED\u6309\u94AE\uFF0C\u5173\u95ED\u7279\u5F81\u7F16\u8F91\u5668\u3002**"},points:{title:"\u70B9",add:"\u70B9\u53EF\u4EE5\u7528\u4E8E\u4EE3\u8868\u8BF8\u5982\u5546\u5E97\u3001\u9910\u9986\u548C\u5386\u53F2\u9057\u8FF9\u7684\u7279\u5F81\u3002\u5B83\u4EEC\u6807\u8BB0\u4E00\u4E2A\u7279\u5B9A\u7684\u5730\u70B9\uFF0C\u5E76\u8BF4\u660E\u8BE5\u5730\u70B9\u662F\u4EC0\u4E48\u3002**\u5355\u51FB\u201C\u70B9\u201D\u6309\u94AE\u6DFB\u52A0\u65B0\u70B9\u3002**",place:"\u5728\u5730\u56FE\u4E0A\u70B9\u51FB\uFF0C\u53EF\u4EE5\u5730\u56FE\u4E0A\u65B0\u589E\u7684\u4E00\u70B9\u3002 **\u5C06\u8BE5\u70B9\u653E\u5230\u5EFA\u7B51\u7269\u4E0A\u65B9**",search:"\u5F88\u591A\u4E0D\u540C\u7684\u7269\u4F53\u53EF\u4EE5\u7528\u70B9\u6765\u4EE3\u8868\u3002\u60A8\u521A\u521A\u65B0\u589E\u52A0\u7684\u70B9\u662F\u4E00\u95F4\u5496\u5561\u5385\u3002**\u641C\u7D22'{name}'**",choose:"**\u5728\u5217\u8868\u4E2D\u9009\u62E9\u5496\u5561\u9986\u3002**",describe:"\u8FD9\u4E2A\u70B9\u5DF2\u7ECF\u6807\u8BB0\u4E3A\u5496\u5561\u9986\u4E86\u3002\u4F7F\u7528\u7279\u5F81\u7F16\u8F91\u5668\uFF0C\u6211\u4EEC\u53EF\u4EE5\u6DFB\u52A0\u66F4\u591A\u5173\u4E8E\u7279\u5F81\u7684\u4FE1\u606F\u3002**\u6DFB\u52A0\u540D\u79F0**",close:"\u7279\u5F81\u7F16\u8F91\u5668\u53EF\u4EE5\u901A\u8FC7\u5355\u51FB\u5173\u95ED\u6309\u94AE\u6765\u5173\u95ED\u3002**\u5173\u95ED\u7279\u5F81\u7F16\u8F91\u5668**",reselect:"\u5F88\u591A\u65F6\u5019\uFF0C\u6240\u9700\u7684\u70B9\u5DF2\u7ECF\u5B58\u5728\uFF0C\u4F46\u6709\u9519\u8BEF\u6216\u4E0D\u5B8C\u6574\u3002\u6211\u4EEC\u53EF\u4EE5\u7F16\u8F91\u73B0\u6709\u7684\u70B9\u3002 **\u9009\u62E9\u60A8\u521A\u521B\u5EFA\u7684\u70B9**",fixname:"**\u66F4\u6539\u540D\u79F0\uFF0C\u5173\u95ED\u7279\u5F81\u7F16\u8F91\u5668\u3002**",reselect_delete:"\u5730\u56FE\u4E0A\u7684\u6240\u6709\u7279\u5F81\u90FD\u53EF\u4EE5\u5220\u9664\u3002**\u5355\u51FB\u4F60\u521B\u5EFA\u7684\u70B9\u3002**",delete:"\u5728\u70B9\u5468\u56F4\u7684\u83DC\u5355\u5305\u542B\u5728\u8BE5\u70B9\u53EF\u6267\u884C\u7684\u64CD\u4F5C\uFF0C\u5305\u62EC\u5220\u9664\u3002**\u5220\u9664\u70B9\u3002**"},areas:{title:"\u533A\u57DF",add:"\u533A\u57DF\u80FD\u8F83\u8BE6\u7EC6\u5730\u4EE3\u8868\u7269\u4EF6\uFF0C\u63D0\u4F9B\u8BE5\u7269\u4EF6\u7684\u8FB9\u754C\u8D44\u6599\u3002\u5927\u90E8\u4EFD\u4EE5\u70B9\u53EF\u4EE5\u4EE3\u8868\u7684\u7269\u4EF6\u7C7B\u522B\uFF0C\u90FD\u53EF\u4EE5\u7528\u533A\u57DF\u4EE3\u8868\uFF0C\u800C\u540E\u8005\u5F80\u5F80\u66F4\u4E3A\u9002\u5408\u3002 **\u70B9\u51FB\u300C\u533A\u57DF\u300D\u6309\u94AE\uFF0C\u4EE5\u65B0\u589E\u4E00\u4E2A\u533A\u57DF**",corner:"\u901A\u8FC7\u5C06\u8282\u70B9\u653E\u5230\u9762\u7684\u8FB9\u754C\u4E0A\uFF0C\u53EF\u7ED8\u5236\u9762\u3002 **\u5C06\u8D77\u59CB\u8282\u70B9\u7F6E\u4E8E\u6E38\u4E50\u573A\u7684\u5176\u4E2D\u4E00\u89D2**",place:"\u653E\u7F6E\u66F4\u591A\u8282\u70B9\u53EF\u7ED8\u5236\u533A\u57DF\u3002\u70B9\u51FB\u5F00\u59CB\u8282\u70B9\u5373\u53EF\u5B8C\u6210\u7ED8\u5236\u3002**\u5728\u6C99\u76D2\u7ED8\u5236\u4E00\u4E2A\u533A\u57DF\u3002**",search:"**\u641C\u7D22'{name}'\u3002**",choose:"**\u5728\u5217\u8868\u4E2D\u9009\u62E9\u513F\u7AE5\u6E38\u4E50\u573A\u3002**",describe:"**\u6DFB\u52A0\u540D\u79F0\uFF0C\u5173\u95ED\u7279\u5F81\u7F16\u8F91\u5668**"},lines:{title:"\u7EBF",add:"\u7EBF\u7528\u4E8E\u4EE3\u8868\u8BF8\u5982\u9053\u8DEF\u3001\u94C1\u8DEF\u548C\u6CB3\u6D41\u7684\u7279\u5F81\u3002**\u5355\u51FB\u201C\u7EBF\u201D\u6309\u94AE\u6DFB\u52A0\u65B0\u7EBF\u3002**",start:"**\u70B9\u51FB\u9053\u8DEF\u672B\u7AEF\uFF0C\u4EE5\u5F00\u59CB\u7ED8\u5236\u7EBF\u6BB5\u3002 **",intersect:"\u70B9\u51FB\u5411\u7EBF\u6DFB\u52A0\u66F4\u591A\u8282\u70B9\u3002\u5FC5\u8981\u65F6\u60A8\u53EF\u4EE5\u5728\u7ED8\u5236\u65F6\u62D6\u52A8\u5730\u56FE\u3002\u9053\u8DEF\u548C\u8BB8\u591A\u5176\u5B83\u7C7B\u578B\u7684\u7EBF\u90FD\u662F\u4E00\u4E2A\u66F4\u5927\u7684\u7F51\u7EDC\u7684\u7EC4\u6210\u90E8\u5206\uFF0C\u56E0\u6B64\u6B63\u786E\u8FDE\u63A5\u8FD9\u4E9B\u7EBF\u4EE5\u4FBF\u5BFC\u822A\u5E94\u7528\u4F7F\u7528\u662F\u5341\u5206\u91CD\u8981\u7684\u3002**\u70B9\u51FB Flower Street \u521B\u5EFA\u8FDE\u63A5\u4E24\u6761\u7EBF\u7684\u4EA4\u53C9\u70B9\u3002**",finish:"\u518D\u6B21\u70B9\u51FB\u6700\u540E\u4E00\u4E2A\u8282\u70B9\u53EF\u7ED3\u675F\u7ED8\u5236\u7EBF\u3002**\u5B8C\u6210\u9053\u8DEF\u7684\u7ED8\u5236\u3002**",road:"**\u5728\u5217\u8868\u4E2D\u9009\u62E9\u9053\u8DEF**",residential:"\u9053\u8DEF\u6709\u4E0D\u540C\u79CD\u7C7B\uFF0C\u6700\u5E38\u89C1\u7684\u4E3A\u4F4F\u5B85\u533A\u9053\u8DEF\u3002 **\u9009\u62E9\u4F4F\u5B85\u533A\u9053\u8DEF**",describe:"**\u7ED9\u9053\u8DEF\u547D\u540D\uFF0C\u5173\u95ED\u7279\u5F81\u7F16\u8F91\u5668\u3002**",restart:"\u9053\u8DEF\u9700\u8981\u82B1\u8857\u76F8\u4EA4\u3002",wrong_preset:"\u4F60\u6CA1\u6709\u9009\u62E9\u4F4F\u5B85\u9053\u8DEF\u7C7B\u578B\u3002 **\u70B9\u51FB\u8FD9\u91CC\u91CD\u65B0\u9009\u62E9**"},startediting:{title:"\u5F00\u59CB\u7F16\u8F91",help:"\u5728\u8FD9\u91CC\u6709\u66F4\u591A\u4F7F\u7528\u8BF4\u660E\uFF0C\u8FD8\u53EF\u4EE5\u91CD\u6E29\u7B80\u4ECB",save:"\u4E0D\u8981\u5FD8\u4E86\u5B9A\u671F\u4FDD\u5B58\u4F60\u7684\u4FEE\u6539\uFF01",start:"\u5F00\u59CB\u7ED8\u5236\u5730\u56FE\uFF01"}},presets:{categories:{"category-building":{name:"\u5EFA\u7B51\u7269"},"category-golf":{name:"\u9AD8\u5C14\u592B\u7403"},"category-landuse":{name:"\u571F\u5730\u4F7F\u7528"},"category-path":{name:"\u5C0F\u5F84"},"category-rail":{name:"\u94C1\u8F68"},"category-restriction":{name:"\u9650\u5236"},"category-road":{name:"\u9053\u8DEF"},"category-route":{name:"\u7EBF\u8DEF"},"category-water-area":{name:"\u6C34"},"category-water-line":{name:"\u6C34"}},fields:{access:{label:"\u901A\u884C\u9650\u5236",placeholder:"\u672A\u77E5",types:{access:"\u666E\u901A",foot:"\u6B65\u884C",motor_vehicle:"\u6C7D\u8F66",bicycle:"\u81EA\u884C\u8F66",horse:"\u9A6C\u5339"},options:{yes:{title:"\u5141\u8BB8\u7684",description:"\u6309\u6CD5\u5F8B\u53CA\u8DEF\u6743\uFF0C\u6709\u6743\u4F7F\u7528"},no:{title:"\u7981\u6B62\u7684",description:"\u7981\u6B62\u4E00\u822C\u516C\u4F17\u8FDB\u5165"},permissive:{title:"\u83B7\u8BB8\u53EF\u8FDB\u5165",description:"\u5BB9\u8BB8\u8FDB\u5165\uFF0C\u76F4\u81F3\u62E5\u6709\u8005\u6487\u56DE\u8BB8\u53EF"},private:{title:"\u79C1\u4EBA",description:"\u987B\u62E5\u6709\u8005\u4E2A\u522B\u6279\u51C6\uFF0C\u65B9\u53EF\u8FDB\u5165"},designated:{title:"\u7279\u5B9A\u7684",description:"\u53EA\u9650\u6807\u5FD7\u6307\u5B9A\u6216\u7279\u5B9A\u672C\u5730\u6CD5\u5F8B\u5BB9\u8BB8\u4EBA\u58EB\u8FDB\u5165"},destination:{title:"\u76EE\u7684\u5730",description:"\u53EA\u9650\u524D\u5F80\u76EE\u7684\u5730\u4EBA\u58EB\u8FDB\u5165"}}},access_simple:{label:"\u901A\u884C\u9650\u5236"},address:{label:"\u5730\u5740",placeholders:{street:"\u8857\u9053",city:"\u57CE\u5E02",postcode:"\u90AE\u653F\u7F16\u7801",suburb:"\u5730\u533A",district:"\u884C\u653F\u533A",province:"\u884C\u653F\u7701",state:"\u884C\u653F\u5DDE",country:"\u56FD\u5BB6"}},admin_level:{label:"\u884C\u653F\u7EA7\u522B"},aerialway:{label:"\u7C7B\u578B"},"aerialway/access":{label:"\u901A\u884C\u9650\u5236"},"aerialway/capacity":{label:"\u5BB9\u91CF(\u6BCF\u5C0F\u65F6)",placeholder:"500, 2500, 5000..."},"aerialway/duration":{label:"\u6301\u7EED\u65F6\u95F4(\u5206\u949F)",placeholder:"1, 2, 3..."},"aerialway/occupancy":{placeholder:"2, 4, 8..."},aeroway:{label:"\u7C7B\u578B"},amenity:{label:"\u7C7B\u578B"},artist:{label:"\u827A\u4EBA"},artwork_type:{label:"\u7C7B\u578B"},atm:{label:"\u81EA\u52A8\u63D0\u6B3E\u673A\uFF08ATM\uFF09"},backrest:{label:"\u957F\u6905"},barrier:{label:"\u7C7B\u578B"},bicycle_parking:{label:"\u7C7B\u578B"},boundary:{label:"\u7C7B\u578B"},building:{label:"\u5EFA\u7B51\u7269"},building_area:{label:"\u5EFA\u7B51\u7269"},capacity:{label:"\u5BB9\u91CF",placeholder:"50, 100, 200..."},cardinal_direction:{label:"\u65B9\u5411"},clock_direction:{label:"\u65B9\u5411",options:{clockwise:"\u987A\u65F6\u9488",anticlockwise:"\u9006\u65F6\u9488"}},collection_times:{label:"\u6536\u96C6\u65F6\u95F4"},construction:{label:"\u7C7B\u578B"},country:{label:"\u56FD\u5BB6"},covered:{label:"\u8986\u76D6"},crossing:{label:"\u7C7B\u578B"},cuisine:{label:"\u83DC\u80B4"},denomination:{label:"\u6559\u6D3E"},denotation:{label:"\u610F\u601D"},description:{label:"\u8BF4\u660E"},electrified:{label:"\u7535\u6C14\u5316"},elevation:{label:"\u6D77\u62D4"},emergency:{label:"\u6025\u8BCA\u5BA4"},entrance:{label:"\u7C7B\u578B"},except:{label:"\u5F02\u5E38"},fax:{label:"\u4F20\u771F",placeholder:"+31 42 123 4567"},fee:{label:"\u8D39\u7528"},"fire_hydrant/type":{label:"\u7C7B\u578B"},fixme:{label:"\u4FEE\u590D\u6211"},fuel:{label:"\u6CB9\u7AD9"},"fuel/biodiesel":{label:"\u9500\u552E\u751F\u7269\u67F4\u6CB9"},"fuel/diesel":{label:"\u9500\u552E\u67F4\u6CB9"},"fuel/e10":{label:"\u9500\u552EE10"},"fuel/e85":{label:"\u9500\u552EE85"},"fuel/lpg":{label:"\u9500\u552E\u4E19\u70F7"},"fuel/octane_100":{label:"\u9500\u552E\u8D5B\u8F66\u6C7D\u6CB9"},"fuel/octane_91":{label:"\u9500\u552E\u666E\u901A\u6C7D\u6CB9"},"fuel/octane_95":{label:"\u9500\u552E\u4E2D\u7B49\u6C7D\u6CB9"},"fuel/octane_98":{label:"\u9500\u552E\u9AD8\u7EA7\u6C7D\u6CB9"},gauge:{label:"\u8F68\u8DDD"},"generator/method":{label:"\u6A21\u5F0F"},"generator/source":{label:"\u6765\u6E90"},"generator/type":{label:"\u7C7B\u578B"},golf_hole:{label:"\u53C2\u8003",placeholder:"\u7403\u6D1E\u7F16\u53F7\uFF081-18\uFF09"},handicap:{label:"\u624B\u5DE5\u5E97",placeholder:"1-18"},highway:{label:"\u7C7B\u578B"},historic:{label:"\u7C7B\u578B"},hoops:{placeholder:"1, 2, 4..."},iata:{label:"\u56FD\u9645\u822A\u7A7A\u8FD0\u8F93\u534F\u4F1AIATA"},icao:{label:"\u56FD\u9645\u6C11\u822A\u7EC4\u7EC7ICAO"},incline:{label:"\u659C\u5EA6"},information:{label:"\u7C7B\u578B"},internet_access:{label:"\u4E92\u8054\u7F51\u63A5\u5165",options:{wlan:"Wi-Fi",wired:"\u6709\u7EBF\u7F51\u7EDC",terminal:"\u7EC8\u7AEF"}},landuse:{label:"\u7C7B\u578B"},lanes:{label:"\u8F66\u9053",placeholder:"1, 2, 3..."},layer:{label:"\u56FE\u5C42"},leisure:{label:"\u7C7B\u578B"},length:{label:"\u9AD8\u5EA6(\u7C73)"},levels:{label:"\u5C42\u6B21",placeholder:"2, 4, 6..."},lit:{label:"\u6709\u706F"},location:{label:"\u4F4D\u7F6E"},man_made:{label:"\u7C7B\u578B"},maxspeed:{label:"\u901F\u5EA6\u9650\u5236",placeholder:"40, 50, 60..."},name:{label:"\u540D\u79F0",placeholder:"\u5E38\u7528\u540D\u79F0\uFF08\u5982\u679C\u6709\uFF09"},natural:{label:"\u81EA\u7136"},network:{label:"\u7F51\u7EDC"},note:{label:"\u5907\u6CE8"},office:{label:"\u7C7B\u578B"},oneway:{label:"\u5355\u884C\u7EBF",options:{undefined:"\u5047\u5B9A\u4E3A\u5426"}},oneway_yes:{label:"\u5355\u884C\u7EBF",options:{undefined:"\u5047\u5B9A\u4E3A\u662F"}},opening_hours:{label:"\u5F00\u653E\u65F6\u95F4"},operator:{label:"\u7ECF\u8425\u8005"},par:{placeholder:"3, 4, 5..."},park_ride:{label:"\u505C\u8F66\u6362\u4E58"},parking:{label:"\u7C7B\u578B"},phone:{label:"\u7535\u8BDD",placeholder:"+31 42 123 4567"},"piste/difficulty":{label:"\u56F0\u96BE"},"piste/type":{label:"\u7C7B\u578B"},place:{label:"\u7C7B\u578B"},population:{label:"\u4EBA\u53E3"},power:{label:"\u7C7B\u578B"},railway:{label:"\u7C7B\u578B"},"recycling/cans":{label:"\u63A5\u53D7\u94DD\u7BA1\u56DE\u6536"},"recycling/clothes":{label:"\u63A5\u53D7\u8863\u7269\u56DE\u6536"},"recycling/glass":{label:"\u63A5\u53D7\u73BB\u7483\u56DE\u6536"},"recycling/paper":{label:"\u63A5\u53D7\u7EB8\u5F20\u56DE\u6536"},ref:{label:"\u53C2\u8003"},relation:{label:"\u7C7B\u578B"},religion:{label:"\u5B97\u6559"},restriction:{label:"\u7C7B\u578B"},restrictions:{label:"\u8F6C\u5411\u9650\u5236"},route:{label:"\u7C7B\u578B"},route_master:{label:"\u7C7B\u578B"},seasonal:{label:"\u5177\u5907\u5B63\u8282\u6027"},service:{label:"\u7C7B\u578B"},shelter:{label:"\u907F\u96BE\u6240"},shelter_type:{label:"\u7C7B\u578B"},shop:{label:"\u7C7B\u578B"},smoking:{label:"\u5438\u70DF"},social_facility_for:{placeholder:"\u65E0\u5BB6\u53EF\u5F52\u8005\uFF0C\u6B8B\u75BE\u4EBA\uFF0C\u513F\u7AE5\u7B49"},source:{label:"\u6765\u6E90"},sport:{label:"\u8FD0\u52A8"},sport_ice:{label:"\u4F53\u80B2"},structure:{label:"\u7ED3\u6784",placeholder:"\u672A\u77E5\u79CD\u7C7B",options:{bridge:"\u6865",tunnel:"\u96A7\u9053",embankment:"\u5824\u5CB8",cutting:"\u5F00\u51FF"}},studio_type:{label:"\u7C7B\u578B"},supervised:{label:"\u76D1\u7763"},surface:{label:"\u8868\u9762"},"toilets/disposal":{label:"\u5E9F\u5F03"},tourism:{label:"\u7C7B\u578B"},towertype:{label:"\u5854\u578B"},trail_visibility:{label:"\u8DEF\u5F84\u53EF\u89C1\u5EA6"},tree_type:{label:"\u7C7B\u578B"},trees:{label:"\u6811\u6797"},tunnel:{label:"\u96A7\u9053"},vending:{label:"\u5546\u54C1\u7C7B\u578B"},water:{label:"\u7C7B\u578B"},waterway:{label:"\u7C7B\u578B"},website:{label:"\u7F51\u7AD9",placeholder:"http://example.com/"},wetland:{label:"\u7C7B\u578B"},wheelchair:{label:"\u8F6E\u6905\u901A\u9053"},width:{label:"\u5BBD\u5EA6(\u7C73)"},wikipedia:{label:"\u7EF4\u57FA\u767E\u79D1"},wood:{label:"\u7C7B\u578B"}},presets:{address:{name:"\u5730\u5740",terms:"\u5730\u5740,\u5740"},aerialway:{name:"\u7F06\u8F66\u7EBF\u8DEF",terms:"\u7F06\u8F66\u7EBF\u8DEF"},"aerialway/cable_car":{name:"\u7F06\u8F66"},"aerialway/chair_lift":{name:"\u767B\u5C71\u540A\u6905"},"aerialway/pylon":{name:"\u7F06\u8F66\u5854",terms:"\u7F06\u8F66\u5854"},"aerialway/station":{name:"\u7F06\u8F66\u7AD9",terms:"\u7F06\u8F66\u7AD9"},aeroway:{name:"\u673A\u573A\u8DEF\u5F84",terms:"\u673A\u573A"},"aeroway/aerodrome":{name:"\u673A\u573A",terms:"\u673A\u573A,\u98DE\u673A\u573A,\u98DE\u673A"},"aeroway/apron":{name:"\u505C\u673A\u576A",terms:"\u505C\u673A\u576A"},"aeroway/gate":{name:"\u673A\u573A\u767B\u673A\u53E3",terms:"\u673A\u573A\u95F8\u53E3"},"aeroway/hangar":{name:"\u98DE\u673A\u5E93",terms:"\u673A\u5E93"},"aeroway/helipad":{name:"\u76F4\u5347\u673A\u573A",terms:"\u76F4\u5347\u673A\u573A,\u76F4\u5347\u673A\u576A"},"aeroway/runway":{name:"\u8DD1\u9053",terms:"\u8DD1\u9053"},"aeroway/taxiway":{name:"\u6ED1\u884C\u9053",terms:"\u6ED1\u884C\u9053"},"aeroway/terminal":{name:"\u673A\u573A\u822A\u7AD9\u697C",terms:"\u673A\u573A\u822A\u7AD9\u697C,\u673A\u573A\u5927\u697C,\u673A\u573A\u5BA2\u8FD0\u5927\u697C"},amenity:{name:"\u4FBF\u5229\u8BBE\u65BD",terms:"\u4FBF\u5229\u8BBE\u65BD"},"amenity/arts_centre":{name:"\u7F8E\u672F\u9986",terms:"\u7F8E\u672F\u9986,\u827A\u672F\u9986,\u7F8E\u672F\u4E2D\u5FC3,\u827A\u672F\u4E2D\u5FC3"},"amenity/atm":{name:"ATM",terms:"ATM,\u63D0\u6B3E\u673A,\u81EA\u52A8\u63D0\u6B3E\u673A"},"amenity/bank":{name:"\u94F6\u884C",terms:"\u94F6\u884C"},"amenity/bar":{name:"\u9152\u5427",terms:"\u9152\u5427"},"amenity/bbq":{name:"\u70E7\u70E4\u8BBE\u65BD"},"amenity/bench":{name:"\u957F\u6905",terms:"\u957F\u6905,\u957F\u51F3"},"amenity/bicycle_parking":{name:"\u81EA\u884C\u8F66\u505C\u8F66\u5904",terms:"\u81EA\u884C\u8F66\u505C\u653E\u5904,\u5355\u8F66\u505C\u653E\u5904,\u5355\u8F66,\u5355\u8F66\u505C\u8F66\u5904,\u505C\u8F66,\u505C\u653E,\u81EA\u884C\u8F66"},"amenity/bicycle_rental":{name:"\u81EA\u884C\u8F66\u51FA\u79DF\u70B9",terms:"\u81EA\u884C\u8F66\u79DF\u8D41\u5904,\u5355\u8F66,\u51FA\u79DF,\u79DF\u8D41,\u81EA\u884C\u8F66"},"amenity/boat_rental":{name:"\u8239\u8236\u79DF\u8D41\u5904",terms:"\u8239\u8236\u79DF\u8D41\u5904"},"amenity/cafe":{name:"\u5496\u5561\u9986",terms:"\u5496\u5561\u5385,\u8336\u5EA7,\u5C0F\u9910\u9986,\u5496\u5561,\u5C0F\u9910\u5385"},"amenity/car_rental":{name:"\u6C7D\u8F66\u79DF\u8D41",terms:"\u6C7D\u8F66\u79DF\u8D41\u5904,\u79DF\u8F66\u5E97,\u6C7D\u8F66\u79DF\u8D41,\u79DF\u8D41,\u51FA\u79DF,\u79DF"},"amenity/car_sharing":{name:"\u6C7D\u8F66\u5171\u4EAB",terms:"\u6C7D\u8F66\u5171\u4EAB"},"amenity/car_wash":{name:"\u6D17\u8F66",terms:"\u6D17\u8F66\u5E97,\u6D17\u8F66"},"amenity/charging_station":{name:"\u5145\u7535\u7AD9",terms:"\u5145\u7535\u7AD9"},"amenity/childcare":{name:"\u6258\u513F\u6240",terms:"\u6258\u513F\u6240"},"amenity/cinema":{name:"\u7535\u5F71\u9662",terms:"\u7535\u5F71\u9662,\u7535\u5F71,\u620F\u9662"},"amenity/clinic":{name:"\u8BCA\u6240",terms:"\u8BCA\u6240,\u95E8\u8BCA,\u533B\u52A1\u6240"},"amenity/clock":{name:"\u65F6\u949F",terms:"\u65F6\u949F,\u949F\u8868,\u949F"},"amenity/college":{name:"\u5B66\u9662",terms:"\u5B66\u9662,\u4E66\u9662,\u4E13\u79D1\u5B66\u9662"},"amenity/compressed_air":{name:"\u538B\u7F29\u7A7A\u6C14"},"amenity/courthouse":{name:"\u6CD5\u9662",terms:"\u6CD5\u9662,\u6CD5\u5EAD"},"amenity/dentist":{name:"\u7259\u79D1",terms:"\u7259\u533B,\u7259"},"amenity/doctor":{name:"\u533B\u751F\u529E\u516C\u5BA4",terms:"\u533B\u751F"},"amenity/dojo":{name:"Dojo /\u6B66\u672F\u5B66\u9662",terms:"Dojo /\u6B66\u672F\u5B66\u9662"},"amenity/drinking_water":{name:"\u996E\u6C34\u5904",terms:"\u996E\u6C34\u5904,\u996E\u6C34\u5904,\u996E\u6C34"},"amenity/embassy":{name:"\u4F7F\u9986",terms:"\u4F7F\u9986,\u5927\u4F7F\u9986,\u9886\u4E8B\u9986"},"amenity/fast_food":{name:"\u5FEB\u9910\u5E97",terms:"\u5FEB\u9910\u5E97"},"amenity/fire_station":{name:"\u6D88\u9632\u7AD9",terms:"\u6D88\u9632\u7AD9,\u6D88\u8D39\u5C40"},"amenity/fountain":{name:"\u55B7\u6CC9",terms:"\u55B7\u6CC9,\u55B7\u6C34\u6C60,\u6C34\u666F"},"amenity/fuel":{name:"\u52A0\u6CB9\u7AD9",terms:"\u52A0\u6CB9\u7AD9,\u52A0\u6C14\u7AD9,\u6CB9\u7AD9"},"amenity/grave_yard":{name:"\u5893\u5730",terms:"\u5893\u5730,\u575F\u5730"},"amenity/hospital":{name:"\u533B\u9662"},"amenity/kindergarten":{name:"\u5E7C\u513F\u56ED"},"amenity/library":{name:"\u56FE\u4E66\u9986",terms:"\u56FE\u4E66\u9986"},"amenity/marketplace":{name:"\u5E02\u573A",terms:"\u5E02\u573A,\u83DC\u5E02\u573A"},"amenity/nightclub":{name:"\u591C\u603B\u4F1A",terms:"\u591C\u5E97,\u591C\u603B\u4F1A"},"amenity/parking":{name:"\u505C\u8F66\u573A",terms:"\u505C\u8F66"},"amenity/parking_entrance":{name:"\u505C\u8F66\u573A\u5165\u53E3/\u51FA\u53E3"},"amenity/pharmacy":{name:"\u836F\u5E97",terms:"\u836F\u623F,\u836F\u5E97"},"amenity/place_of_worship":{name:"\u793C\u62DC\u573A\u6240",terms:"\u793C\u62DC\u573A\u6240,\u5B97\u6559\u793C\u62DC\u5904"},"amenity/place_of_worship/buddhist":{name:"\u5BFA",terms:"\u5BFA\u5E99,\u4F5B\u5802,\u548C\u5C1A\u5BFA,\u5C3C\u59D1\u5EB5"},"amenity/place_of_worship/christian":{name:"\u6559\u5802",terms:"\u6559\u5802"},"amenity/place_of_worship/jewish":{name:"\u72B9\u592A\u6559\u5802",terms:"\u72B9\u592A\u6559\u5802,\u72B9\u592A\u5BFA"},"amenity/place_of_worship/muslim":{name:"\u6E05\u771F\u5BFA",terms:"\u6E05\u771F\u5BFA,\u56DE\u6559\u5BFA"},"amenity/police":{name:"\u8B66\u5BDF\u5C40",terms:"\u8B66\u5BDF\u5C40,\u8B66\u5C40,\u8B66\u7F72,\u6D3E\u51FA\u6240"},"amenity/post_box":{name:"\u4FE1\u7BB1",terms:"\u90AE\u7BB1,\u90AE\u7B52"},"amenity/post_office":{name:"\u90AE\u5C40",terms:"\u90AE\u5C40,\u90AE\u653F\u5C40"},"amenity/pub":{name:"\u9152\u9986",terms:"\u9152\u9986"},"amenity/ranger_station":{name:"\u91CE\u90CA\u8BBF\u5BA2\u5904",terms:"\u91CE\u90CA\u8BBF\u5BA2\u5904"},"amenity/recycling":{name:"\u8D44\u6E90\u56DE\u6536\u8BBE\u65BD",terms:"\u56DE\u6536,\u5FAA\u73AF\u5229\u7528,\u518D\u9020"},"amenity/restaurant":{name:"\u9910\u9986",terms:"\u9910\u9986,\u9910\u5385,\u996D\u5E97,\u9152\u697C,\u9152\u5BB6,\u8336\u697C,\u7F8E\u98DF"},"amenity/school":{name:"\u5B66\u6821"},"amenity/shelter":{name:"\u4EAD",terms:"\u68DA,\u68DA\u5C4B"},"amenity/social_facility":{name:"\u793E\u4F1A\u670D\u52A1\u8BBE\u65BD"},"amenity/social_facility/food_bank":{name:"\u98DF\u54C1\u94F6\u884C"},"amenity/social_facility/homeless_shelter":{name:"\u6D41\u6D6A\u8005\u5E87\u62A4\u7AD9"},"amenity/studio":{name:"\u5DE5\u4F5C\u5BA4",terms:"\u5DE5\u4F5C\u5BA4"},"amenity/swimming_pool":{name:"\u6E38\u6CF3\u6C60",terms:"\u6E38\u6CF3\u6C60,\u6CF3\u6C60"},"amenity/taxi":{name:"\u51FA\u79DF\u8F66\u7AD9",terms:"\u51FA\u79DF\u8F66\u7AD9,\u7684\u58EB\u7AD9,\u8BA1\u7A0B\u8F66\u7AD9"},"amenity/telephone":{name:"\u7535\u8BDD",terms:"\u7535\u8BDD"},"amenity/theatre":{name:"\u5267\u9662",terms:"\u5267\u9662,\u5267\u573A,\u620F\u9662"},"amenity/toilets":{name:"\u5395\u6240",terms:"\u5395\u6240,\u516C\u5395,\u6D17\u624B\u95F4"},"amenity/townhall":{name:"\u5E02\u653F\u5E9C",terms:"\u5E02\u653F\u5E9C,\u5E02\u653F\u5385,\u5927\u4F1A\u5802"},"amenity/university":{name:"\u5927\u5B66",terms:"\u5927\u5B66"},"amenity/vending_machine":{name:"\u552E\u5356\u673A",terms:"\u552E\u5356\u673A"},"amenity/veterinary":{name:"\u517D\u533B",terms:"\u517D\u533B"},"amenity/waste_basket":{name:"\u5783\u573E\u6876",terms:"\u5783\u573E\u7BB1,\u5783\u573E\u6876"},area:{name:"\u533A\u57DF",terms:"\u533A\u57DF"},barrier:{name:"\u5C4F\u969C",terms:"\u5C4F\u969C,\u963B\u6321"},"barrier/block":{name:"\u8DEF\u969C",terms:"\u8DEF\u969C,\u969C\u788D\u7269"},"barrier/bollard":{name:"\u62A4\u67F1",terms:"\u62A4\u67F1"},"barrier/cattle_grid":{name:"\u5BB6\u755C\u6805\u680F",terms:"\u5BB6\u755C\u6805\u680F"},"barrier/city_wall":{name:"\u57CE\u5899",terms:"\u57CE\u5899"},"barrier/cycle_barrier":{name:"\u81EA\u884C\u8F66\u8DEF\u969C",terms:"\u81EA\u884C\u8F66,\u5355\u8F66,\u8DEF\u969C"},"barrier/ditch":{name:"\u6C9F",terms:"\u6C9F"},"barrier/entrance":{name:"\u5165\u53E3",terms:"\u5165\u53E3"},"barrier/fence":{name:"\u7BF1\u7B06",terms:"\u7BF1\u7B06"},"barrier/gate":{name:"\u95E8",terms:"\u95E8"},"barrier/hedge":{name:"\u6811\u7BF1",terms:"\u6811\u7BF1"},"barrier/kissing_gate":{name:"\u5355\u4EBA\u8F6C\u95E8",terms:"\u5355\u4EBA\u8F6C\u95E8"},"barrier/lift_gate":{name:"\u9053\u95F8",terms:"\u9053\u95F8,\u6321\u8F66\u5668"},"barrier/retaining_wall":{name:"\u6321\u571F\u5899",terms:"\u6321\u571F\u5899"},"barrier/stile":{name:"\u8DE8\u8D8A\u56F4\u680F\u7684\u53F0\u9636",terms:"\u68AF\u6883"},"barrier/toll_booth":{name:"\u6536\u8D39\u7AD9",terms:"\u6536\u8D39\u7AD9"},"barrier/wall":{name:"\u5899",terms:"\u6536\u8D39\u7AD9"},"boundary/administrative":{name:"\u884C\u653F\u533A\u57DF\u754C\u7EBF",terms:"\u884C\u653F\u533A\u57DF\u754C\u7EBF"},building:{name:"\u5EFA\u7B51\u7269",terms:"\u5EFA\u7B51\u7269\uFF0C\u5C4B\u5B87"},"building/apartments":{name:"\u516C\u5BD3",terms:"\u516C\u5BD3"},"building/cathedral":{name:"\u4E3B\u6559\u5EA7\u5802",terms:"\u6559\u5802,\u5927\u6559\u5802"},"building/church":{name:"\u6559\u5802",terms:"\u793C\u62DC\u5802"},"building/commercial":{name:"\u5546\u4E1A\u5EFA\u7B51\u7269",terms:"\u5546\u4E1A\u5EFA\u7B51\u7269"},"building/construction":{name:"\u5728\u5EFA\u5EFA\u7B51"},"building/detached":{name:"\u8FDE\u4F53\u5C4B"},"building/dormitory":{name:"\u5BBF\u820D"},"building/entrance":{name:"\u5165\u53E3/\u51FA\u53E3",terms:"\u5165\u53E3/\u51FA\u53E3,\u51FA\u5165\u53E3"},"building/garage":{name:"\u8F66\u5E93",terms:"\u8F66\u5E93"},"building/garages":{name:"\u8F66\u5E93"},"building/greenhouse":{name:"\u6E29\u5BA4"},"building/hospital":{name:"\u533B\u9662\u5927\u697C"},"building/hotel":{name:"\u9152\u5E97\u5927\u697C"},"building/house":{name:"\u623F\u5C4B",terms:"\u623F\u5C4B"},"building/hut":{name:"\u68DA\u5C4B",terms:"\u68DA\u5C4B"},"building/industrial":{name:"\u5DE5\u4E1A\u5EFA\u7B51\u7269",terms:"\u5DE5\u4E1A\u5EFA\u7B51\u7269"},"building/public":{name:"\u516C\u5171\u5EFA\u7B51"},"building/residential":{name:"\u4F4F\u5B85\u5EFA\u7B51\u7269",terms:"\u4F4F\u5B85\u5EFA\u7B51\u7269"},"building/retail":{name:"\u5546\u4E1A\u5EFA\u7B51"},"building/roof":{name:"\u697C\u9876",terms:"\u697C\u9876,\u623F\u9876"},"building/school":{name:"\u5B66\u6821\u5EFA\u7B51",terms:"\u6821\u820D,\u5B66\u6821\u5EFA\u7B51"},"building/train_station":{name:"\u706B\u8F66\u7AD9",terms:"\u706B\u8F66\u7AD9"},"building/university":{name:"\u5927\u5B66\u5EFA\u7B51",terms:"\u5927\u5B66\u5EFA\u7B51"},"building/warehouse":{name:"\u4ED3\u5E93",terms:"\u4ED3\u5E93,\u8D27\u6808"},"craft/beekeeper":{name:"\u517B\u8702\u4EBA"},"craft/blacksmith":{name:"\u94C1\u5320"},"craft/boatbuilder":{name:"\u5236\u8239"},"craft/bookbinder":{name:"\u88C5\u8BA2\u5DE5\u4EBA",terms:"\u4E66\u7C4D\u9489\u88C5\u5458,\u88C5\u8BA2\u5546,\u88C5\u8BA2\u5DE5,\u9489\u4E66\u5320"},"craft/brewery":{name:"\u917F\u9152\u5382",terms:"\u9152\u5382,\u917F\u9152\u5382,\u9152\u574A"},"craft/clockmaker":{name:"\u949F\u8868\u5320"},"craft/electrician":{name:"\u7535\u5DE5"},"craft/gardener":{name:"\u56ED\u827A\u5DE5"},"craft/handicraft":{name:"\u624B\u5DE5\u5320"},"craft/jeweler":{name:"\u73E0\u5B9D\u5E97"},"craft/key_cutter":{name:"\u5207\u5272\u94A5\u5319\uFF08\u914D\u5319\uFF09"},"craft/optician":{name:"\u773C\u955C\u5E97"},"craft/photographer":{name:"\u7167\u76F8\u5E97"},"craft/photographic_laboratory":{name:"\u7167\u7247\u51B2\u6D17\u5E97"},"craft/plumber":{name:"\u7BA1\u9053\u5DE5"},"craft/pottery":{name:"\u9676\u5668\u573A",terms:"\u9676\u5668\u573A"},"craft/sawmill":{name:"\u952F\u6728\u5382",terms:"\u952F\u6728\u5382"},"craft/shoemaker":{name:"\u5236\u978B\u5E97"},"craft/tailor":{name:"\u88C1\u7F1D",terms:"\u88C1\u7F1D"},"craft/tinsmith":{name:"\u9521\u5236\u54C1\u624B\u5DE5\u5E97"},"craft/upholsterer":{name:"\u5BA4\u5185\u88C5\u6F62",terms:"\u5BA4\u5185\u88C5\u6F62,\u5BA4\u5185\u8BBE\u8BA1,\u5BA4\u5185\u88C5\u9970"},"craft/watchmaker":{name:"\u5236\u8868\u5546",terms:"\u949F\u8868\u5236\u4F5C,\u5236\u8868\u5546,\u949F\u8868\u5320"},"craft/window_construction":{name:"\u7A97\u6237\u4FEE\u7406\u5E97"},embankment:{name:"\u5824\u575D",terms:"\u5824,\u5824\u575D,\u5824\u5CB8"},"emergency/ambulance_station":{name:"\u6551\u62A4\u7AD9",terms:"\u6551\u62A4\u7AD9"},"emergency/fire_hydrant":{name:"\u6D88\u9632\u6813",terms:"\u6D88\u9632\u6813"},"emergency/phone":{name:"\u7D27\u6025\u7535\u8BDD",terms:"\u7D27\u6025\u7535\u8BDD"},entrance:{name:"\u5165\u53E3/\u51FA\u53E3",terms:"\u5165\u53E3/\u51FA\u53E3,\u51FA\u5165\u53E3"},"footway/crossing":{name:"\u8DEF\u53E3",terms:"\u8DEF\u53E3"},"footway/crosswalk":{name:"\u4EBA\u884C\u6A2A\u9053",terms:"\u4EBA\u884C\u6A2A\u9053"},"footway/sidewalk":{name:"\u4EBA\u884C\u9053",terms:"\u4EBA\u884C\u9053,\u4FBF\u9053,\u8D70\u9053"},"golf/fairway":{name:"\u9AD8\u5C14\u592B\u7403\u9053",terms:"\u7403\u9053,\u9AD8\u5C14\u592B\u7403\u9053"},"golf/green":{name:"\u9AD8\u5C14\u592B\u7403\u6D1E\u8349\u576A\u533A",terms:"\u7403\u6D1E\u8349\u576A\u533A,\u9AD8\u5C14\u592B\u7403\u6D1E\u8349\u576A\u533A"},"golf/hole":{name:"\u9AD8\u5C14\u592B\u7403\u6D1E"},"golf/tee":{name:"\u5F00\u7403\u533A",terms:"\u5F00\u7403\u533A,\u53D1\u7403\u53F0"},"golf/water_hazard":{name:"\u969C\u788D\u6C34\u6C60"},highway:{name:"\u9053\u8DEF",terms:"\u516C\u8DEF"},"highway/bridleway":{name:"\u9A6C\u9053",terms:"\u9A6C\u9053"},"highway/bus_stop":{name:"\u516C\u4EA4\u8F66\u7AD9",terms:"\u516C\u4EA4\u8F66\u7AD9,\u5DF4\u58EB\u7AD9"},"highway/crossing":{name:"\u8DEF\u53E3",terms:"\u8DEF\u53E3"},"highway/crosswalk":{name:"\u4EBA\u884C\u6A2A\u9053",terms:"\u4EBA\u884C\u6A2A\u9053"},"highway/cycleway":{name:"\u81EA\u884C\u8F66\u9053",terms:"\u81EA\u884C\u8F66,\u5355\u8F66"},"highway/footway":{name:"\u4EBA\u884C\u9053",terms:"\u6B65\u884C\u5F84"},"highway/living_street":{name:"\u751F\u6D3B\u8857",terms:"\u5C45\u4F4F\u8857\u9053"},"highway/mini_roundabout":{name:"\u5C0F\u578B\u73AF\u5C9B",terms:"\u5C0F\u578B\u73AF\u5C9B"},"highway/motorway":{name:"\u9AD8\u901F\u516C\u8DEF",terms:"\u9AD8\u901F\u516C\u8DEF"},"highway/motorway_junction":{name:"\u9AD8\u901F\u516C\u8DEF\u4EA4\u754C\u5904/\u51FA\u53E3",terms:"\u9AD8\u901F\u516C\u8DEF\u4EA4\u754C\u5904/\u51FA\u53E3,\u5165\u53E3/\u51FA\u53E3,\u51FA\u5165\u53E3"},"highway/motorway_link":{name:"\u9AD8\u901F\u516C\u8DEF\u531D\u9053",terms:"\u9AD8\u901F\u516C\u8DEF\u531D\u9053"},"highway/path":{name:"\u5C0F\u9053",terms:"\u8DEF\u5F84"},"highway/pedestrian":{name:"\u6B65\u884C\u8857",terms:"\u884C\u4EBA\u4E13\u7528\u8DEF"},"highway/primary":{name:"\u4E3B\u8981\u9053\u8DEF",terms:"\u4E3B\u8981\u9053\u8DEF"},"highway/primary_link":{name:"\u4E3B\u8981\u9053\u8DEF\u531D\u9053",terms:"\u4E3B\u8981\u9053\u8DEF\u531D\u9053"},"highway/residential":{name:"\u4F4F\u5B85\u533A\u9053\u8DEF",terms:"\u4F4F\u5B85\u533A\u9053\u8DEF"},"highway/rest_area":{name:"\u4F11\u606F\u533A",terms:"\u4F11\u606F\u533A"},"highway/road":{name:"\u672A\u77E5\u79CD\u7C7B\u9053\u8DEF",terms:"\u672A\u77E5\u79CD\u7C7B\u9053\u8DEF"},"highway/secondary":{name:"\u6B21\u8981\u9053\u8DEF",terms:"\u6B21\u8981\u9053\u8DEF"},"highway/secondary_link":{name:"\u6B21\u8981\u9053\u8DEF\u531D\u9053",terms:"\u6B21\u8981\u9053\u8DEF\u531D\u9053"},"highway/service":{name:"\u8F85\u52A9\u9053\u8DEF",terms:"\u8F85\u52A9\u9053\u8DEF"},"highway/service/alley":{name:"\u80E1\u540C",terms:"\u80E1\u540C,\u5DF7"},"highway/service/drive-through":{name:"\u514D\u4E0B\u8F66",terms:"\u514D\u4E0B\u8F66,\u514D\u4E0B\u8F66\u9910\u9986,\u514D\u4E0B\u8F66\u94F6\u884C"},"highway/service/driveway":{name:"\u8F66\u9053",terms:"\u8F66\u9053"},"highway/service/emergency_access":{name:"\u7D27\u6025\u6C42\u6551\u70B9",terms:"\u7D27\u6025\u6C42\u6551,\u7D27\u6025,\u7D27\u6025\u7535\u8BDD"},"highway/service/parking_aisle":{name:"\u505C\u8F66\u573A\u901A\u9053",terms:"\u505C\u8F66\u573A\u901A\u9053"},"highway/services":{name:"\u670D\u52A1\u533A",terms:"\u670D\u52A1\u533A"},"highway/steps":{name:"\u697C\u68AF",terms:"\u697C\u68AF,\u53F0\u9636"},"highway/stop":{name:"\u505C\u8F66\u6807\u5FD7",terms:"\u505C\u8F66\u6807\u5FD7"},"highway/street_lamp":{name:"\u8857\u706F"},"highway/tertiary":{name:"\u4E09\u7EA7\u9053\u8DEF",terms:"\u4E09\u7EA7\u9053\u8DEF"},"highway/tertiary_link":{name:"\u4E09\u7EA7\u9053\u8DEF\u531D\u9053",terms:"\u4E09\u7EA7\u9053\u8DEF\u531D\u9053"},"highway/track":{name:"\u5C0F\u8DEF",terms:"\u672A\u94FA\u8BBE\u8DEF\u9762\u7684\u8F66\u5F84"},"highway/traffic_signals":{name:"\u4EA4\u901A\u4FE1\u53F7\u706F",terms:"\u7EA2\u7EFF\u706F"},"highway/trunk":{name:"\u5E72\u9053",terms:"\u5E72\u7EBF\u9053\u8DEF"},"highway/trunk_link":{name:"\u5E72\u7EBF\u9053\u8DEF\u531D\u9053",terms:"\u5E72\u7EBF\u9053\u8DEF\u531D\u9053"},"highway/turning_circle":{name:"\u73AF\u5C9B",terms:"\u73AF\u5C9B"},"highway/unclassified":{name:"\u672A\u5206\u7EA7\u7684\u9053\u8DEF",terms:"\u672A\u5206\u7EA7\u7684\u9053\u8DEF"},historic:{name:"\u5386\u53F2\u9057\u8FF9",terms:"\u5386\u53F2\u9057\u8FF9,\u53F2\u8FF9"},"historic/archaeological_site":{name:"\u9057\u5740",terms:"\u8003\u53E4\u9057\u5740"},"historic/boundary_stone":{name:"\u754C\u7891",terms:"\u754C\u6869"},"historic/castle":{name:"\u57CE\u5821",terms:"\u57CE\u5821"},"historic/memorial":{name:"\u7EAA\u5FF5\u7891",terms:"\u7EAA\u5FF5"},"historic/monument":{name:"\u7EAA\u5FF5\u7891",terms:"\u7EAA\u5FF5\u7891,\u53E4\u8FF9"},"historic/ruins":{name:"\u9057\u8FF9",terms:"\u5E9F\u589F"},"historic/wayside_cross":{name:"\u8DEF\u65C1\u5341\u5B57\u67B6",terms:"\u8DEF\u8FB9\u5341\u5B57\u67B6"},"historic/wayside_shrine":{name:"\u8DEF\u65C1\u795E\u9F9B",terms:"\u8DEF\u8FB9\u795E\u793E"},landuse:{name:"\u571F\u5730\u7528\u9014",terms:"\u571F\u5730\u7528\u9014"},"landuse/allotments":{name:"\u83DC\u5730",terms:"\u83DC\u5730,\u793E\u533A\u82B1\u56ED"},"landuse/basin":{name:"\u6C34\u6C60",terms:"\u6C34\u6C60"},"landuse/cemetery":{name:"\u5893\u5730",terms:"\u5893\u5730"},"landuse/churchyard":{name:"\u5893\u5730",terms:"\u5893\u5730"},"landuse/commercial":{name:"\u5546\u4E1A\u533A",terms:"\u5546\u4E1A\u533A"},"landuse/construction":{name:"\u5EFA\u7B51\u7269",terms:"\u5EFA\u7B51\u7269"},"landuse/farm":{name:"\u519C\u573A",terms:"\u519C\u573A"},"landuse/farmland":{name:"\u519C\u7530",terms:"\u8015\u5730,\u7530\u5730,\u9972\u517B\u573A"},"landuse/farmyard":{name:"\u519C\u5E84",terms:"\u519C\u5E84"},"landuse/forest":{name:"\u68EE\u6797",terms:"\u68EE\u6797"},"landuse/grass":{name:"\u8349\u5730",terms:"\u8349\u5730"},"landuse/industrial":{name:"\u5DE5\u4E1A\u533A",terms:"\u5DE5\u4E1A\u533A"},"landuse/landfill":{name:"\u5783\u573E\u586B\u57CB\u533A"},"landuse/meadow":{name:"\u8349\u5730",terms:"\u7267\u573A"},"landuse/military":{name:"\u519B\u4E8B",terms:"\u519B\u4E8B,\u519B\u961F,\u519B\u4E8B\u533A"},"landuse/orchard":{name:"\u679C\u56ED",terms:"\u679C\u56ED"},"landuse/quarry":{name:"\u77FF\u573A",terms:"\u77FF\u573A"},"landuse/residential":{name:"\u4F4F\u5B85\u533A",terms:"\u4F4F\u5B85\u533A"},"landuse/retail":{name:"\u96F6\u552E",terms:"\u96F6\u552E"},"landuse/vineyard":{name:"\u8461\u8404\u56ED",terms:"\u8461\u8404\u56ED,\u9152\u5E84"},leisure:{name:"\u4F11\u95F2\u573A\u6240",terms:"\u4F11\u95F2\u573A\u6240"},"leisure/common":{name:"\u516C\u5171\u7528\u5730",terms:"\u516C\u5171\u7528\u5730"},"leisure/dog_park":{name:"\u72D7\u516C\u56ED",terms:"\u72D7\u516C\u56ED"},"leisure/firepit":{name:"\u706B\u7089"},"leisure/garden":{name:"\u82B1\u56ED",terms:"\u82B1\u56ED"},"leisure/golf_course":{name:"\u9AD8\u5C14\u592B\u7403\u573A",terms:"\u9AD8\u5C14\u592B\u7403\u573A"},"leisure/ice_rink":{name:"\u6ED1\u51B0\u573A",terms:"\u6ED1\u51B0,\u6ED1\u51B0\u573A"},"leisure/marina":{name:"\u7801\u5934",terms:"\u7801\u5934"},"leisure/park":{name:"\u516C\u56ED",terms:"\u516C\u56ED"},"leisure/picnic_table":{name:"\u91CE\u9910\u684C"},"leisure/pitch":{name:"\u4F53\u80B2\u573A",terms:"\u8FD0\u52A8\u573A,\u8FD0\u52A8\u573A\u6240"},"leisure/pitch/american_football":{name:"\u7F8E\u5F0F\u8DB3\u7403\u573A",terms:"\u7F8E\u5F0F\u8DB3\u7403\u573A"},"leisure/pitch/baseball":{name:"\u68D2\u7403\u573A",terms:"\u68D2\u7403\u573A"},"leisure/pitch/basketball":{name:"\u7BEE\u7403\u573A",terms:"\u7BEE\u7403\u573A"},"leisure/pitch/skateboard":{name:"\u6ED1\u677F\u573A",terms:"\u6ED1\u677F\u573A"},"leisure/pitch/soccer":{name:"\u8DB3\u7403\u573A",terms:"\u8DB3\u7403\u573A"},"leisure/pitch/tennis":{name:"\u7F51\u7403\u573A",terms:"\u7F51\u7403\u573A"},"leisure/pitch/volleyball":{name:"\u6392\u7403\u573A",terms:"\u6392\u7403\u573A"},"leisure/playground":{name:"\u513F\u7AE5\u6E38\u4E50\u573A",terms:"\u6E38\u4E50\u573A"},"leisure/slipway":{name:"\u8239\u53F0",terms:"\u8239\u53F0"},"leisure/sports_center":{name:"\u4F53\u80B2\u4E2D\u5FC3/\u5065\u8EAB\u4E2D\u5FC3",terms:"\u4F53\u80B2\u4E2D\u5FC3,\u5065\u8EAB\u4E2D\u5FC3"},"leisure/stadium":{name:"\u4F53\u80B2\u573A",terms:"\u4F53\u80B2,\u4F53\u80B2\u573A"},"leisure/swimming_pool":{name:"\u6E38\u6CF3\u6C60",terms:"\u6E38\u6CF3\u6C60"},"leisure/track":{name:"\u8D5B\u8F66\u8DD1\u9053",terms:"\u8D5B\u8F66\u8DD1\u9053"},line:{name:"\u7EBF",terms:"\u7EBF"},man_made:{name:"\u4EBA\u9020\u7269",terms:"\u4EBA\u9020\u7269"},"man_made/breakwater":{name:"\u9632\u6CE2\u5824",terms:"\u9632\u6CE2\u5824"},"man_made/cutline":{name:"\u5206\u754C\u7EBF",terms:"\u5206\u754C\u7EBF"},"man_made/embankment":{name:"\u5824\u5CB8",terms:"\u5824,\u5824\u575D,\u5824\u5CB8"},"man_made/flagpole":{name:"\u65D7\u6746",terms:"\u65D7\u7AFF"},"man_made/lighthouse":{name:"\u706F\u5854",terms:"\u706F\u5854"},"man_made/observation":{name:"\u77AD\u671B\u5854",terms:"\u77AD\u671B\u5854"},"man_made/pier":{name:"\u7801\u5934",terms:"\u7801\u5934"},"man_made/pipeline":{name:"\u7BA1\u9053",terms:"\u7BA1\u9053"},"man_made/survey_point":{name:"\u6D4B\u91CF\u70B9",terms:"\u6D4B\u91CF\u70B9"},"man_made/tower":{name:"\u5854",terms:"\u5854"},"man_made/wastewater_plant":{name:"\u6C61\u6C34\u5904\u7406\u5382",terms:"\u6C61\u6C34\u5904\u7406\u5382"},"man_made/water_tower":{name:"\u6C34\u5854",terms:"\u6C34\u5854"},"man_made/water_well":{name:"\u6C34\u4E95",terms:"\u6C34\u4E95"},"man_made/water_works":{name:"\u4F9B\u6C34\u5382",terms:"\u4F9B\u6C34\u5382"},"military/airfield":{name:"\u519B\u7528\u673A\u573A",terms:"\u673A\u573A,\u98DE\u673A\u573A"},"military/barracks":{name:"\u519B\u8425",terms:"\u519B\u8425,\u5175\u8425,\u8425\u623F"},"military/bunker":{name:"\u5730\u5821",terms:"\u5730\u5821,\u6697\u5821"},"military/range":{name:"\u519B\u4E8B\u9776\u573A",terms:"\u9776\u573A,\u5C04\u51FB\u573A,\u519B\u4E8B\u5C04\u51FB\u573A"},natural:{name:"\u81EA\u7136",terms:"\u81EA\u7136"},"natural/bay":{name:"\u6D77\u6E7E",terms:"\u6D77\u6E7E"},"natural/beach":{name:"\u6D77\u6EE9",terms:"\u6D77\u6EE9"},"natural/cliff":{name:"\u5CED\u58C1",terms:"\u60AC\u5D16"},"natural/coastline":{name:"\u6D77\u5CB8\u7EBF",terms:"\u6D77\u5CB8\u7EBF"},"natural/fell":{name:"\u9AD8\u539F\u8352\u539F",terms:"\u9AD8\u539F\u8352\u539F"},"natural/glacier":{name:"\u51B0\u5DDD",terms:"\u51B0\u5DDD"},"natural/grassland":{name:"\u8349\u539F",terms:"\u8349\u539F"},"natural/heath":{name:"\u8352\u91CE",terms:"\u8352\u91CE"},"natural/peak":{name:"\u5C71\u5CF0",terms:"\u5C71\u5CF0"},"natural/scree":{name:"\u788E\u77F3\u5761",terms:"\u788E\u77F3\u5761"},"natural/scrub":{name:"\u704C\u6728\u4E1B",terms:"\u704C\u6728\u4E1B"},"natural/spring":{name:"\u6CC9\u6C34",terms:"\u6CC9\u6C34"},"natural/tree":{name:"\u6811",terms:"\u6811"},"natural/water":{name:"\u6C34",terms:"\u6C34"},"natural/water/lake":{name:"\u6E56\u6CCA",terms:"\u6E56\u6CCA"},"natural/water/pond":{name:"\u6C60\u5858",terms:"\u6C60\u5858"},"natural/water/reservoir":{name:"\u6C34\u5E93",terms:"\u6C34\u5E93"},"natural/wetland":{name:"\u6E7F\u5730",terms:"\u6E7F\u5730"},"natural/wood":{name:"\u6811\u6797",terms:"\u6811\u6797"},office:{name:"\u5199\u5B57\u697C",terms:"\u529E\u516C\u5BA4,\u5199\u5B57\u697C"},"office/accountant":{name:"\u4F1A\u8BA1\u5E08\u697C",terms:"\u4F1A\u8BA1\u5E08\u697C"},"office/administrative":{name:"\u884C\u653F\u697C",terms:"\u884C\u653F\u697C"},"office/architect":{name:"\u5EFA\u7B51\u5E08\u697C",terms:"\u5EFA\u7B51\u5E08\u697C"},"office/company":{name:"\u516C\u53F8",terms:"\u516C\u53F8"},"office/educational_institution":{name:"\u6559\u80B2\u673A\u6784",terms:"\u6559\u80B2\u673A\u6784"},"office/employment_agency":{name:"\u5C31\u4E1A\u673A\u6784",terms:"\u5C31\u4E1A\u673A\u6784"},"office/estate_agent":{name:"\u5730\u4EA7\u4EE3\u7406",terms:"\u5730\u4EA7\u4EE3\u7406"},"office/financial":{name:"\u8D22\u52A1\u90E8\u5199\u5B57\u697C",terms:"\u8D22\u52A1\u90E8\u5199\u5B57\u697C"},"office/government":{name:"\u653F\u5E9C\u697C",terms:"\u653F\u5E9C\u697C"},"office/insurance":{name:"\u4FDD\u9669\u516C\u53F8",terms:"\u4FDD\u9669\u516C\u53F8"},"office/it":{name:"IT\u516C\u53F8",terms:"IT\u516C\u53F8"},"office/lawyer":{name:"\u5F8B\u5E08\u4E8B\u52A1\u6240",terms:"\u5F8B\u5E08\u4E8B\u52A1\u6240"},"office/newspaper":{name:"\u62A5\u793E",terms:"\u62A5\u793E,\u901A\u8BAF\u793E"},"office/ngo":{name:"\u975E\u653F\u5E9C\u7EC4\u7EC7",terms:"\u975E\u653F\u5E9C\u7EC4\u7EC7"},"office/physician":{name:"\u533B\u751F",terms:"\u533B\u751F"},"office/political_party":{name:"\u653F\u515A",terms:"\u653F\u515A"},"office/research":{name:"\u7814\u7A76\u6240",terms:"\u7814\u7A76\u6240"},"office/telecommunication":{name:"\u7535\u4FE1\u529E\u516C\u5BA4",terms:"\u7535\u4FE1\u516C\u53F8"},"office/therapist":{name:"\u533B\u7597\u5E08",terms:"\u533B\u7597\u5E08"},"office/travel_agent":{name:"\u65C5\u884C\u793E",terms:"\u65C5\u884C\u793E"},place:{name:"\u5730\u70B9",terms:"\u5730\u70B9"},"place/city":{name:"\u57CE\u5E02",terms:"\u57CE\u5E02"},"place/hamlet":{name:"\u6751\u5E84",terms:"\u6751\u5E84"},"place/island":{name:"\u5C9B\u5C7F",terms:"\u5C9B\u5C7F"},"place/isolated_dwelling":{name:"\u5B64\u7ACB\u5C45\u6240",terms:"\u5B64\u7ACB\u5C45\u6240"},"place/locality":{name:"\u5730\u65B9",terms:"\u5730\u65B9,\u5730\u70B9"},"place/neighbourhood":{name:"\u8857\u574A",terms:"\u793E\u533A,\u8857\u574A"},"place/town":{name:"\u57CE\u9547",terms:"\u57CE\u9547"},"place/village":{name:"\u6751\u5E84",terms:"\u6751\u5E84"},point:{name:"\u70B9",terms:"\u70B9"},power:{name:"\u7535\u529B",terms:"\u53D1\u7535\u5382"},"power/generator":{name:"\u53D1\u7535\u673A",terms:"\u53D1\u7535\u673A"},"power/line":{name:"\u4F9B\u7535\u7EBF",terms:"\u4F9B\u7535\u7EBF"},"power/minor_line":{name:"\u5C0F\u4F9B\u7535\u7EBF",terms:"\u5C0F\u4F9B\u7535\u7EBF"},"power/pole":{name:"\u7535\u7EBF\u6746",terms:"\u7535\u7EBF\u6746"},"power/sub_station":{name:"\u53D8\u7535\u7AD9",terms:"\u53D8\u7535\u7AD9"},"power/tower":{name:"\u9AD8\u538B\u7535\u5854",terms:"\u9AD8\u538B\u7535\u5854"},"power/transformer":{name:"\u53D8\u7535\u7AD9",terms:"\u53D8\u7535\u6240"},"public_transport/platform":{name:"\u7AD9\u53F0",terms:"\u5E73\u53F0,\u6708\u53F0"},"public_transport/stop_position":{name:"\u505C\u8F66\u5904",terms:"\u505C\u6B62\u4F4D\u7F6E"},railway:{name:"\u94C1\u8DEF",terms:"\u94C1\u8DEF"},"railway/abandoned":{name:"\u5DF2\u62C6\u9664\u94C1\u8DEF",terms:"\u5E9F\u5F03\u7684\u94C1\u8DEF"},"railway/disused":{name:"\u5E9F\u5F03\u94C1\u8DEF",terms:"\u5E9F\u5F03\u7684\u94C1\u8DEF"},"railway/funicular":{name:"\u7F06\u8F66",terms:"\u7F06\u8F66"},"railway/halt":{name:"\u5C0F\u706B\u8F66\u7AD9",terms:"\u5C0F\u706B\u8F66\u7AD9"},"railway/level_crossing":{name:"\u5E73\u4EA4\u9053\u53E3",terms:"\u5E73\u4EA4\u9053\u53E3"},"railway/monorail":{name:"\u5355\u8F68\u94C1\u8DEF",terms:"\u5355\u8F68\u94C1\u8DEF"},"railway/narrow_gauge":{name:"\u7A84\u8F68\u94C1\u8DEF",terms:"\u7A84\u8F68\u94C1\u8DEF,\u94C1\u8DEF"},"railway/platform":{name:"\u7AD9\u53F0",terms:"\u7AD9\u53F0"},"railway/rail":{name:"\u94C1\u8F68",terms:"\u94C1\u8F68"},"railway/station":{name:"\u706B\u8F66\u7AD9",terms:"\u706B\u8F66\u7AD9"},"railway/subway":{name:"\u5730\u94C1",terms:"\u5730\u94C1"},"railway/subway_entrance":{name:"\u5730\u94C1\u5165\u53E3",terms:"\u5730\u94C1\u53E3"},"railway/tram":{name:"\u7535\u8F66",terms:"\u7535\u8F66"},relation:{name:"\u5173\u7CFB",terms:"\u5173\u7CFB"},"route/ferry":{name:"\u822A\u7EBF",terms:"\u822A\u7EBF"},shop:{name:"\u5546\u5E97",terms:"\u5546\u5E97"},"shop/alcohol":{name:"\u9152\u6C34\u5E97",terms:"\u9152\u5E84"},"shop/art":{name:"\u827A\u672F\u5E97"},"shop/bakery":{name:"\u9762\u5305\u5E97",terms:"\u9762\u5305\u5E97"},"shop/beauty":{name:"\u7F8E\u5BB9\u5E97",terms:"\u7F8E\u5BB9\u9662"},"shop/beverages":{name:"\u996E\u6599\u5E97",terms:"\u996E\u54C1\u5E97"},"shop/bicycle":{name:"\u81EA\u884C\u8F66\u5E97",terms:"\u81EA\u884C\u8F66,\u5355\u8F66"},"shop/books":{name:"\u4E66\u5E97",terms:"\u4E66\u5E97"},"shop/boutique":{name:"\u7CBE\u54C1\u5E97",terms:"\u7CBE\u54C1\u5E97"},"shop/butcher":{name:"\u8089\u5E97",terms:"\u8089\u94FA"},"shop/car":{name:"\u6C7D\u8F66\u5E97",terms:"\u8F66\u884C"},"shop/car_parts":{name:"\u6C7D\u8F66\u96F6\u90E8\u4EF6\u5546\u5E97",terms:"\u6C7D\u8F66\u914D\u4EF6\u5E97"},"shop/car_repair":{name:"\u6C7D\u8F66\u4FEE\u7406\u5E97",terms:"\u6C7D\u8F66\u4FEE\u7406\u5E97"},"shop/chemist":{name:"\u65E5\u5316\u7528\u54C1\u5E97",terms:"\u836F\u623F"},"shop/clothes":{name:"\u670D\u88C5\u5E97",terms:"\u670D\u88C5\u5E97"},"shop/computer":{name:"\u7535\u8111\u5E97",terms:"\u7535\u8111\u5E97"},"shop/confectionery":{name:"\u7CD6\u679C\u5E97",terms:"\u751C\u70B9\u5E97"},"shop/convenience":{name:"\u4FBF\u5229\u5E97",terms:"\u4FBF\u5229\u5E97"},"shop/deli":{name:"\u719F\u98DF\u5E97",terms:"\u719F\u98DF\u5E97"},"shop/department_store":{name:"\u767E\u8D27\u5546\u573A",terms:"\u767E\u8D27\u5E97"},"shop/doityourself":{name:"DIY\u5E97",terms:"DIY\u5546\u5E97"},"shop/dry_cleaning":{name:"\u5E72\u6D17\u5E97",terms:"\u5E72\u6D17\u5E97"},"shop/electronics":{name:"\u7535\u5668\u5E97",terms:"\u7535\u5668\u5E97"},"shop/farm":{name:"\u519C\u573A",terms:"\u519C\u573A"},"shop/fishmonger":{name:"\u6D77\u4EA7\u5E97",terms:"\u6D77\u4EA7\u5E97"},"shop/florist":{name:"\u82B1\u5E97",terms:"\u82B1\u5E97"},"shop/funeral_directors":{name:"\u5893\u56ED"},"shop/furniture":{name:"\u5BB6\u5177\u5E97",terms:"\u5BB6\u5177\u5E97"},"shop/garden_centre":{name:"\u56ED\u827A\u54C1\u5E97",terms:"\u82B1\u5E97"},"shop/gift":{name:"\u793C\u54C1\u5E97",terms:"\u793C\u54C1\u5E97"},"shop/greengrocer":{name:"\u679C\u852C\u5E97",terms:"\u679C\u852C\u5E97"},"shop/hairdresser":{name:"\u7406\u53D1\u5E97",terms:"\u7406\u53D1\u5E97"},"shop/hardware":{name:"\u4E94\u91D1\u5E97",terms:"\u4E94\u91D1\u5E97"},"shop/hifi":{name:"\u97F3\u54CD\u5E97",terms:"\u97F3\u54CD\u5E97"},"shop/jewelry":{name:"\u73E0\u5B9D\u5E97",terms:"\u73E0\u5B9D\u5E97"},"shop/kiosk":{name:"\u62A5\u520A\u4EAD",terms:"\u62A5\u520A\u4EAD"},"shop/laundry":{name:"\u6D17\u8863\u5E97",terms:"\u6D17\u8863\u5E97"},"shop/locksmith":{name:"\u9501\u5320\u94FA",terms:"\u9501\u5320\u94FA"},"shop/lottery":{name:"\u5F69\u7968\u5E97"},"shop/mall":{name:"\u5546\u573A",terms:"\u5546\u573A"},"shop/mobile_phone":{name:"\u624B\u673A\u5E97",terms:"\u624B\u673A\u5E97"},"shop/motorcycle":{name:"\u6469\u6258\u8F66\u5E97",terms:"\u6469\u6258\u8F66\u884C,\u6469\u6258\u8F66"},"shop/music":{name:"\u97F3\u4E50\u5E97",terms:"\u97F3\u4E50\u5E97"},"shop/newsagent":{name:"\u62A5\u644A",terms:"\u62A5\u644A"},"shop/optician":{name:"\u773C\u955C\u5E97",terms:"\u773C\u955C\u5E97"},"shop/outdoor":{name:"\u6237\u5916\u7528\u54C1\u5E97",terms:"\u6237\u5916\u7528\u54C1\u5E97"},"shop/pet":{name:"\u5BA0\u7269\u5E97",terms:"\u5BA0\u7269\u5E97"},"shop/photo":{name:"\u7167\u76F8\u9986",terms:"\u7167\u76F8\u9986"},"shop/seafood":{name:"\u6D77\u9C9C\u5E97"},"shop/shoes":{name:"\u978B\u5E97",terms:"\u978B\u5E97"},"shop/sports":{name:"\u4F53\u80B2\u7528\u54C1\u5E97",terms:"\u4F53\u80B2,\u4F53\u80B2\u7528\u54C1\u5E97"},"shop/stationery":{name:"\u6587\u5177\u5E97",terms:"\u6587\u5177\u5E97"},"shop/supermarket":{name:"\u8D85\u5E02",terms:"\u8D85\u7EA7\u5E02\u573A"},"shop/toys":{name:"\u73A9\u5177\u5E97",terms:"\u73A9\u5177\u5E97"},"shop/travel_agency":{name:"\u65C5\u884C\u793E",terms:"\u65C5\u884C\u793E"},"shop/tyres":{name:"\u8F6E\u80CE\u5E97",terms:"\u8F6E\u80CE\u5E97"},"shop/vacant":{name:"\u7A7A\u7F6E\u94FA\u4F4D",terms:"\u7A7A\u7F6E\u94FA\u4F4D"},"shop/variety_store":{name:"\u6742\u8D27\u5E97",terms:"\u6742\u8D27\u5E97"},"shop/video":{name:"\u5F71\u50CF\u5E97",terms:"\u5F71\u50CF\u5E97"},"shop/wine":{name:"\u9152\u5E97",terms:"\u9152\u5E97,\u9152\u697C,\u9152\u574A"},tourism:{name:"\u65C5\u884C",terms:"\u65C5\u884C"},"tourism/alpine_hut":{name:"\u9AD8\u5C71\u5C0F\u5C4B",terms:"\u9AD8\u5C71\u5C0F\u5C4B"},"tourism/artwork":{name:"\u827A\u672F\u54C1",terms:"\u827A\u672F\u54C1"},"tourism/attraction":{name:"\u65C5\u6E38\u540D\u80DC",terms:"\u65C5\u6E38\u540D\u80DC"},"tourism/camp_site":{name:"\u5BBF\u8425\u5730",terms:"\u9732\u8425\u533A"},"tourism/caravan_site":{name:"\u623F\u8F66\u8425\u5730",terms:"\u623F\u8F66\u8425\u5730"},"tourism/chalet":{name:"\u6728\u5C4B",terms:"\u6728\u5C4B"},"tourism/guest_house":{name:"\u65C5\u9986",terms:"\u5BBE\u9986"},"tourism/hostel":{name:"\u62DB\u5F85\u6240",terms:"\u62DB\u5F85\u6240"},"tourism/hotel":{name:"\u9152\u5E97",terms:"\u9152\u5E97"},"tourism/information":{name:"\u4FE1\u606F",terms:"\u95EE\u8BAF\u5904,\u95EE\u8BE2\u5904,\u4FE1\u606F\u4E2D\u5FC3,\u6E38\u5BA2\u4E2D\u5FC3"},"tourism/motel":{name:"\u6C7D\u8F66\u65C5\u9986",terms:"\u6C7D\u8F66\u65C5\u9986"},"tourism/museum":{name:"\u535A\u7269\u9986",terms:"\u535A\u7269\u9986"},"tourism/picnic_site":{name:"\u91CE\u9910\u5730",terms:"\u90CA\u6E38\u5730\u70B9"},"tourism/theme_park":{name:"\u4E3B\u9898\u516C\u56ED",terms:"\u4E3B\u9898\u516C\u56ED"},"tourism/viewpoint":{name:"\u89C2\u666F\u70B9",terms:"\u666F\u70B9"},"tourism/zoo":{name:"\u52A8\u7269\u56ED",terms:"\u52A8\u7269\u56ED"},"type/boundary":{name:"\u8FB9\u754C",terms:"\u8FB9\u754C"},"type/boundary/administrative":{name:"\u884C\u653F\u533A\u8FB9\u754C",terms:"\u884C\u653F\u8FB9\u754C"},"type/multipolygon":{name:"\u591A\u4E2A\u9762",terms:"\u4E2A\u591A\u9762"},"type/restriction":{name:"\u9650\u5236",terms:"\u9650\u5236"},"type/restriction/no_left_turn":{name:"\u7981\u6B62\u5DE6\u8F6C\u5F2F",terms:"\u7981\u6B62\u5DE6\u8F6C\u5F2F"},"type/restriction/no_right_turn":{name:"\u7981\u6B62\u53F3\u8F6C\u5F2F",terms:"\u7981\u6B62\u53F3\u8F6C\u5F2F"},"type/restriction/no_straight_on":{name:"\u7981\u6B62\u76F4\u884C",terms:"\u7981\u6B62\u76F4\u884C"},"type/restriction/no_u_turn":{name:"\u7981\u6B62\u6389\u5934",terms:"\u7981\u6B62\u6389\u5934"},"type/restriction/only_left_turn":{name:"\u53EA\u5DE6\u8F6C",terms:"\u53EA\u5DE6\u8F6C"},"type/restriction/only_right_turn":{name:"\u53EA\u53F3\u8F6C",terms:"\u53EA\u53F3\u8F6C"},"type/restriction/only_straight_on":{name:"\u7981\u6B62\u8F6C\u5411",terms:"\u7981\u6B62\u8F6C\u5411"},"type/route":{name:"\u7EBF\u8DEF",terms:"\u8DEF\u7EBF,\u8DEF\u5F84"},"type/route/bicycle":{name:"\u81EA\u884C\u8F66\u7EBF\u8DEF",terms:"\u5355\u8F66\u7EBF\u8DEF,\u81EA\u884C\u8F66,\u5355\u8F66,\u8DEF\u7EBF,\u7EBF\u8DEF"},"type/route/bus":{name:"\u516C\u5171\u6C7D\u8F66\u7EBF\u8DEF",terms:"\u516C\u4EA4\u7EBF\u8DEF,\u8DEF\u7EBF,\u7EBF\u8DEF,\u516C\u4EA4\u8DEF\u7EBF,\u516C\u5171\u6C7D\u8F66\u8DEF\u7EBF"},"type/route/detour":{name:"\u7ED5\u884C\u7EBF\u8DEF",terms:"\u8FC2\u56DE\u7EBF\u8DEF,\u7ED5\u9053\u7EBF\u8DEF,\u7ED5\u8DEF\u7EBF\u8DEF,\u8DEF\u7EBF,\u7EBF\u8DEF"},"type/route/ferry":{name:"\u6E21\u8F6E\u822A\u7EBF",terms:"\u6E21\u8F6E\u822A\u7EBF"},"type/route/foot":{name:"\u6B65\u884C\u7EBF\u8DEF",terms:"\u6B65\u884C\u8DEF\u7EBF,\u8DEF\u7EBF,\u7EBF\u8DEF"},"type/route/hiking":{name:"\u5F92\u6B65\u7EBF\u8DEF",terms:"\u8FDC\u8DB3\u7EBF\u8DEF,\u8DEF\u7EBF,\u7EBF\u8DEF,\u5F92\u6B65,\u8FDC\u8DB3,\u8FDC\u8DB3\u8DEF\u7EBF,\u5F92\u6B65\u8DEF\u7EBF"},"type/route/pipeline":{name:"\u7BA1\u9053\u7EBF\u8DEF",terms:"\u7BA1\u9053\u8DEF\u7EBF,\u7BA1\u7EBF,\u8DEF\u7EBF,\u7EBF\u8DEF"},"type/route/power":{name:"\u7535\u529B\u7EBF\u8DEF",terms:"\u4F9B\u7535\u8DEF\u7EBF,\u7535\u529B\u8DEF\u7EBF,\u4F9B\u7535\u7EBF\u8DEF,\u8DEF\u7EBF,\u7EBF\u8DEF"},"type/route/road":{name:"\u9A7E\u9A76\u7EBF\u8DEF",terms:"\u884C\u8F66\u8DEF\u7EBF,\u884C\u8F66\u7EBF\u8DEF,\u9A7E\u9A76\u8DEF\u7EBF,\u8DEF\u7EBF,\u7EBF\u8DEF"},"type/route/train":{name:"\u5217\u8F66\u7EBF\u8DEF",terms:"\u5217\u8F66\u8DEF\u7EBF,\u706B\u8F66,\u94C1\u8DEF,\u8DEF\u7EBF,\u7EBF\u8DEF"},"type/route/tram":{name:"\u7535\u8F66\u7EBF\u8DEF",terms:"\u7535\u8F66\u8DEF\u7EBF,\u8DEF\u7EBF,\u7EBF\u8DEF"},"type/route_master":{name:"\u7EBF\u8DEF\u4E3B\u7EBF",terms:"\u7EBF\u8DEF\u5E72\u7EBF,\u4E3B\u7EBF,\u5E72\u7EBF,\u7EBF\u8DEF,\u8DEF\u7EBF"},vertex:{name:"\u5176\u5B83",terms:"\u5176\u5B83"},waterway:{name:"\u822A\u9053",terms:"\u822A\u9053"},"waterway/canal":{name:"\u8FD0\u6CB3",terms:"\u8FD0\u6CB3"},"waterway/dam":{name:"\u6C34\u575D",terms:"\u6C34\u575D"},"waterway/ditch":{name:"\u6C9F",terms:"\u6C9F\u6E20"},"waterway/drain":{name:"\u6E20",terms:"\u4E0B\u6C34\u9053"},"waterway/river":{name:"\u6CB3\u6D41",terms:"\u6CB3\u6D41"},"waterway/riverbank":{name:"\u6CB3\u5824",terms:"\u6CB3\u5824"},"waterway/stream":{name:"\u6EAA\u6D41",terms:"\u6EAA\u6D41"},"waterway/weir":{name:"\u5830",terms:"\u5824\u575D"}}},effects:{dividerDref:{title:"\u9053\u8DEF\u53C2\u8003\u7EBF\u7EC4",description:"\u6309\u9053\u8DEF\u53C2\u8003\u7EBF\u7EC4\u7279\u6548\u663E\u793A",tail:"\u6309\u9053\u8DEF\u53C2\u8003\u7EBF\u7EC4\u7279\u6548\u663E\u793A\u3002"},taskDistinction:{title:"\u4EFB\u52A1\u533A\u5206",description:"\u6309\u4EFB\u52A1\u533A\u5206\u663E\u793A\u7279\u6548",tail:"\u6309\u4EFB\u52A1\u533A\u5206\u663E\u793A\u7279\u6548\u3002"},dividerArea:{title:"\u9053\u8DEF\u8F66\u9053\u533A\u57DF",description:"\u6309\u9053\u8DEF\u65B9\u5411\u663E\u793A\u8F66\u9053\u533A\u57DF",tail:"\u6309\u9053\u8DEF\u65B9\u5411\u663E\u793A\u8F66\u9053\u533A\u57DF\u3002"},dividerDrefMemberArea:{title:"\u8F66\u9053\u7EC4\u5185\u8F66\u9053\u7EBF\u8FDE\u7EED\u7F16\u53F7\u533A\u57DF",description:"\u8F66\u9053\u7EC4\u5185\u8F66\u9053\u7EBF\u8FDE\u7EED\u7F16\u53F7\u533A\u57DF",tail:"\u8F66\u9053\u7EC4\u5185\u8F66\u9053\u7EBF\u8FDE\u7EED\u7F16\u53F7\u533A\u57DF\u3002"},wayDirection:{title:"\u663E\u793A\u7EBF\u65B9\u5411",description:"\u663E\u793A\u7EBF\u65B9\u5411",tail:"\u663E\u793A\u7EBF\u65B9\u5411\u3002"},labelField:{title:"\u663E\u793A\u6587\u672C\u63CF\u8FF0",description:"\u663E\u793A\u6587\u672C\u63CF\u8FF0",tail:"\u663E\u793A\u6587\u672C\u63CF\u8FF0\u3002"},breakNodeHighlight:{title:"\u5F3A\u5236\u6253\u65AD\u70B9",description:"\u5F3A\u5236\u6253\u65AD\u70B9\u7279\u6548",tail:"\u5F3A\u5236\u6253\u65AD\u70B9\u7279\u6548\u3002"},laneHighlight:{title:"\u8F66\u9053\u5C5E\u6027\u53D8\u5316\u70B9",description:"\u8F66\u9053\u5C5E\u6027\u53D8\u5316\u70B9\u7279\u6548",tail:"\u8F66\u9053\u5C5E\u6027\u53D8\u5316\u70B9\u7279\u6548\u3002"},dividerAttrHighlight:{title:"\u8F66\u9053\u5206\u9694\u7EBF\u5C5E\u6027\u53D8\u5316\u70B9",description:"\u8F66\u9053\u5206\u9694\u7EBF\u5C5E\u6027\u53D8\u5316\u70B9\u7279\u6548",tail:"\u8F66\u9053\u5206\u9694\u7EBF\u5C5E\u6027\u53D8\u5316\u70B9\u7279\u6548\u3002"},roadHighlight:{title:"\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9",description:"\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9\u7279\u6548",tail:"\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9\u7279\u6548\u3002"},ownership:{title:"\u9053\u8DEF\u6240\u6709",description:"\u6309\u9053\u8DEF\u6240\u6709\u7279\u6548\u663E\u793A",tail:"\u6309\u9053\u8DEF\u6240\u6709\u7279\u6548\u663E\u793A\u3002"},status:{title:"\u9053\u8DEF\u72B6\u6001",description:"\u6309\u9053\u8DEF\u72B6\u6001\u7279\u6548\u663E\u793A",tail:"\u6309\u9053\u8DEF\u72B6\u6001\u7279\u6548\u663E\u793A\u3002"},linktype:{title:"\u9053\u8DEF\u7C7B\u578B",description:"\u6309\u9053\u8DEF\u7C7B\u578B\u7279\u6548\u663E\u793A",tail:"\u6309\u9053\u8DEF\u7C7B\u578B\u7279\u6548\u663E\u793A\u3002"},fc:{title:"\u529F\u80FD\u7B49\u7EA7",description:"\u6309FC\u7279\u6548\u663E\u793A",tail:"\u6309FC\u7279\u6548\u663E\u793A\u3002"},forbidinfo:{title:"\u95E8\u7981\u4FE1\u606F",description:"\u6309\u95E8\u7981\u7279\u6548\u663E\u793A",tail:"\u6309\u95E8\u7981\u7279\u6548\u663E\u793A\u3002"},limitline:{title:"\u9650\u884C\u4FE1\u606F",description:"\u6309\u9650\u884C\u7279\u6548\u663E\u793A",tail:"\u6309\u9650\u884C\u7279\u6548\u663E\u793A\u3002"},nodeID:{title:"\u529F\u80FD\u7B49\u7EA7",description:"\u6309\u8DEF\u53E3ID\u7279\u6548\u663E\u793A",tail:"\u6309\u8DEF\u53E3ID\u7279\u6548\u663E\u793A\u3002"},roadID:{title:"\u529F\u80FD\u7B49\u7EA7",description:"\u6309\u9053\u8DEFID\u7279\u6548\u663E\u793A",tail:"\u6309\u8DEF\u53E3ID\u7279\u6548\u663E\u793A\u3002"},navitype:{title:"\u901A\u884C\u72B6\u6001",description:"\u6309\u901A\u884C\u72B6\u6001\u7279\u6548\u663E\u793A",tail:"\u6309\u901A\u884C\u72B6\u6001\u7279\u6548\u663E\u793A\u3002"},walkFT:{title:"\u6B65\u5BFC\u7ED8\u5236\u65B9\u5411",description:"\u6309\u6B65\u5BFC\u7ED8\u5236\u65B9\u5411\u7279\u6548\u663E\u793A",tail:"\u6309\u6B65\u5BFC\u7ED8\u5236\u65B9\u5411\u7279\u6548\u663E\u793A\u3002"},shapepoint:{title:"\u4E0D\u663E\u793A\u5F62\u70B9\u6570\u636E",description:"\u4E0D\u663E\u793A\u5F62\u70B9\u6570\u636E",tail:"\u4E0D\u663E\u793A\u5F62\u70B9\u6570\u636E\u3002"}},permission:{layers_no_edit:"\u6CA1\u6709\u7F16\u8F91\u6743\u9650",trail_no_display:"\u6CA1\u6709\u8F68\u8FF9\u6743\u9650",checkedit_no_check:"\u6CA1\u6709\u67E5\u8BE2\u8D28\u68C0\u62A5\u8868\u7684\u6743\u9650",checkedit_no_handle:"\u6CA1\u6709\u5904\u7406\u8D28\u68C0\u7ED3\u679C\u7684\u6743\u9650",edit_no_save:"\u6CA1\u6709\u7F16\u8F91\u4FDD\u5B58\u6743\u9650",layers:{edit:"\u6CA1\u6709\u7F16\u8F91\u6743\u9650"},data:{save:"\u6CA1\u6709\u4FDD\u5B58\u6743\u9650"}}};;iD.geo={};iD.geo.roundCoords=function(c){return[Math.floor(c[0]),Math.floor(c[1])]};iD.geo.interp=function(p1,p2,t){return[p1[0]+(p2[0]-p1[0])*t,p1[1]+(p2[1]-p1[1])*t]};iD.geo.cross=function(o,a,b){return(a[0]-o[0])*(b[1]-o[1])-(a[1]-o[1])*(b[0]-o[0])};iD.geo.euclideanDistance=function(a,b){var x=a[0]-b[0],y=a[1]-b[1];return Math.sqrt(x*x+y*y)};iD.geo.latToMeters=function(dLat){return 110946.257617*dLat};iD.geo.lonToMeters=function(dLon,atLat){return 90<=Math.abs(atLat)?0:111319.490793*dLon*Math.abs(Math.cos(atLat*(Math.PI/180)))};iD.geo.metersToLat=function(m){return m/110946.257617};iD.geo.metersToLon=function(m,atLat){return 90<=Math.abs(atLat)?0:m/111319.490793/Math.abs(Math.cos(atLat*(Math.PI/180)))};iD.geo.sphericalDistance=function(a,b){var x=iD.geo.lonToMeters(a[0]-b[0],(a[1]+b[1])/2),y=iD.geo.latToMeters(a[1]-b[1]);return Math.sqrt(x*x+y*y)};iD.geo.edgeEqual=function(a,b){return a[0]===b[0]&&a[1]===b[1]||a[0]===b[1]&&a[1]===b[0]};iD.geo.angle=function(a,b,projection){a=projection(a.loc);b=projection(b.loc);return Math.atan2(b[1]-a[1],b[0]-a[0])};iD.geo.angleCoords=function(angle,size){var x,y;if(0>=angle){angle=360+angle}if(90>angle&&0<=angle){x=1*size*Math.abs(Math.sin(Math.PI/180*angle));y=-1*size*Math.abs(Math.cos(Math.PI/180*angle))}else if(180>angle&&90<=angle){x=1*size*Math.abs(Math.sin(Math.PI/180*angle));y=1*size*Math.abs(Math.cos(Math.PI/180*angle))}else if(270>angle&&180<=angle){x=-1*size*Math.abs(Math.sin(Math.PI/180*angle));y=1*size*Math.abs(Math.cos(Math.PI/180*angle))}else if(360>=angle&&270<=angle){x=-1*size*Math.abs(Math.sin(Math.PI/180*angle));y=-1*size*Math.abs(Math.cos(Math.PI/180*angle))}return[x,y]};iD.geo.chooseEdge=function(nodes,point,projection){var dist=iD.geo.euclideanDistance,points=nodes.map(function(n){return projection(n.loc)}),min=Infinity,idx,loc;function dot(p,q){return p[0]*q[0]+p[1]*q[1]}for(var i=0;i<points.length-1;i++){var o=points[i],s=[points[i+1][0]-o[0],points[i+1][1]-o[1]],v=[point[0]-o[0],point[1]-o[1]],proj=dot(v,s)/dot(s,s),p;if(0>proj){p=o}else if(1<proj){p=points[i+1]}else{p=[o[0]+proj*s[0],o[1]+proj*s[1]]}var d=dist(p,point);if(d<min){min=d;idx=i+1;loc=projection.invert(p)}}return{index:idx,distance:min,loc:loc}};iD.geo.lineIntersection=function(a,b){function subtractPoints(point1,point2){return[point1[0]-point2[0],point1[1]-point2[1]]}function crossProduct(point1,point2){return point1[0]*point2[1]-point1[1]*point2[0]}var p=[a[0][0],a[0][1]],p2=[a[1][0],a[1][1]],q=[b[0][0],b[0][1]],q2=[b[1][0],b[1][1]],r=subtractPoints(p2,p),s=subtractPoints(q2,q),uNumerator=crossProduct(subtractPoints(q,p),r),denominator=crossProduct(r,s);if(uNumerator&&denominator){var u=uNumerator/denominator,t=crossProduct(subtractPoints(q,p),s)/denominator;if(0<=t&&1>=t&&0<=u&&1>=u){return iD.geo.interp(p,p2,t)}}return null};iD.geo.pointInPolygon=function(point,polygon){var x=point[0],y=point[1],inside=false;for(var i=0,j=polygon.length-1;i<polygon.length;j=i++){var xi=polygon[i][0],yi=polygon[i][1];var xj=polygon[j][0],yj=polygon[j][1];var intersect=yi>y!==yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi;if(intersect)inside=!inside}return inside};iD.geo.polygonContainsPolygon=function(outer,inner){return _.every(inner,function(point){return iD.geo.pointInPolygon(point,outer)})};iD.geo.polygonIntersectsPolygon=function(outer,inner,checkSegments){function testSegments(outer,inner){for(var i=0;i<outer.length-1;i++){for(var j=0;j<inner.length-1;j++){var a=[outer[i],outer[i+1]],b=[inner[j],inner[j+1]];if(iD.geo.lineIntersection(a,b))return true}}return false}function testPoints(outer,inner){return _.some(inner,function(point){return iD.geo.pointInPolygon(point,outer)})}return testPoints(outer,inner)||!!checkSegments&&testSegments(outer,inner)};iD.geo.pathLength=function(path){var length=0,dx,dy;for(var i=0;i<path.length-1;i++){dx=path[i][0]-path[i+1][0];dy=path[i][1]-path[i+1][1];length+=Math.sqrt(dx*dx+dy*dy)}return length};;;iD.geo.Extent=function geoExtent(min,max){if(!(this instanceof iD.geo.Extent))return new iD.geo.Extent(min,max);if(min instanceof iD.geo.Extent){return min}else if(min&&2===min.length&&2===min[0].length&&2===min[1].length){this[0]=min[0];this[1]=min[1]}else{this[0]=min||[Infinity,Infinity];this[1]=max||min||[-Infinity,-Infinity]}};iD.geo.Extent.prototype=[[],[]];_.extend(iD.geo.Extent.prototype,{extend:function(obj){if(!(obj instanceof iD.geo.Extent))obj=new iD.geo.Extent(obj);return iD.geo.Extent([Math.min(obj[0][0],this[0][0]),Math.min(obj[0][1],this[0][1])],[Math.max(obj[1][0],this[1][0]),Math.max(obj[1][1],this[1][1])])},area:function(){return Math.abs((this[1][0]-this[0][0])*(this[1][1]-this[0][1]))},center:function(){return[(this[0][0]+this[1][0])/2,(this[0][1]+this[1][1])/2]},polygon:function(){return[[this[0][0],this[0][1]],[this[0][0],this[1][1]],[this[1][0],this[1][1]],[this[1][0],this[0][1]],[this[0][0],this[0][1]]]},intersects:function(obj){if(!(obj instanceof iD.geo.Extent))obj=new iD.geo.Extent(obj);return obj[0][0]<=this[1][0]&&obj[0][1]<=this[1][1]&&obj[1][0]>=this[0][0]&&obj[1][1]>=this[0][1]},intersection:function(obj){if(!this.intersects(obj))return new iD.geo.Extent;return new iD.geo.Extent([Math.max(obj[0][0],this[0][0]),Math.max(obj[0][1],this[0][1])],[Math.min(obj[1][0],this[1][0]),Math.min(obj[1][1],this[1][1])])},percentContainedIn:function(obj){if(!(obj instanceof iD.geo.Extent))obj=new iD.geo.Extent(obj);var a1=this.intersection(obj).area(),a2=this.area();if(a1===Infinity||a2===Infinity||0===a1||0===a2){return 0}else{return a1/a2}},bbox:function(){return{minX:this[0][0],minY:this[0][1],maxX:this[1][0],maxY:this[1][1]}},padByMeters:function(meters){var dLat=iD.geo.metersToLat(meters),dLon=iD.geo.metersToLon(meters,this.center()[1]);return iD.geo.Extent([this[0][0]-dLon,this[0][1]-dLat],[this[1][0]+dLon,this[1][1]+dLat])},toParam:function(){return[this[0][0],this[0][1],this[1][0],this[1][1]].join(",")}});;;iD.geo.Turn=function(turn){if(!(this instanceof iD.geo.Turn))return new iD.geo.Turn(turn);_.extend(this,turn)};iD.geo.Intersection=function(graph,vertexId){var vertex=graph.entity(vertexId),highways=[];graph.parentWays(vertex).forEach(function(way){if(way.isArea()||way.isDegenerate())return;if(way.affix(vertexId)){highways.push(way)}else{var idx=_.indexOf(way.nodes,vertex.id,1),wayA=iD.Way({id:way.id+"-a",modelName:way.modelName,tags:way.tags,nodes:way.nodes.slice(0,idx+1)}),wayB=iD.Way({id:way.id+"-b",modelName:way.modelName,tags:way.tags,nodes:way.nodes.slice(idx)});graph=graph.replace(wayA);graph=graph.replace(wayB);highways.push(wayA);highways.push(wayB)}});var intersection={highways:highways,graph:graph};intersection.turns=function(fromNodeID){if(!fromNodeID)return[];var way=_.find(highways,function(way){return way.contains(fromNodeID)});if(way.first()===vertex.id&&"yes"===way.tags.oneway)return[];if(way.last()===vertex.id&&"-1"===way.tags.oneway)return[];function withRestriction(turn){graph.parentRelations(graph.entity(turn.from.way)).forEach(function(relation){if("restriction"!==relation.tags.type)return;var f=relation.memberByRole("from"),t=relation.memberByRole("to"),v=relation.memberByRole("via");if(f&&f.id===turn.from.way&&v&&v.id===turn.via.node&&t&&t.id===turn.to.way){turn.restriction=relation.id}else if(/^only_/.test(relation.tags.restriction)&&f&&f.id===turn.from.way&&v&&v.id===turn.via.node&&t&&t.id!==turn.to.way){turn.restriction=relation.id;turn.indirect_restriction=true}});return iD.geo.Turn(turn)}var from={node:way.nodes[way.first()===vertex.id?1:way.nodes.length-2],way:way.id.split(/-(a|b)/)[0]},via={node:vertex.id},turns=[];highways.forEach(function(parent){if(parent===way)return;var index=parent.nodes.indexOf(vertex.id);if(parent.first()!==vertex.id&&"yes"!==parent.tags.oneway){turns.push(withRestriction({from:from,via:via,to:{node:parent.nodes[index-1],way:parent.id.split(/-(a|b)/)[0]}}))}if(parent.last()!==vertex.id&&"-1"!==parent.tags.oneway){turns.push(withRestriction({from:from,via:via,to:{node:parent.nodes[index+1],way:parent.id.split(/-(a|b)/)[0]}}))}});if("yes"!==way.tags.oneway&&"-1"!==way.tags.oneway){turns.push(withRestriction({from:from,via:via,to:from,u:true}))}return turns};return intersection};iD.geo.inferRestriction=function(from,via,to,projection){var angle=iD.geo.angle(via,from,projection)-iD.geo.angle(via,to,projection);angle=180*angle/Math.PI;while(0>angle)angle+=360;if(23>angle)return"no_u_turn";if(158>angle)return"no_right_turn";if(202>angle)return"no_straight_on";if(336>angle)return"no_left_turn";return"no_u_turn"};;;iD.geo.Maat=function(turn){if(!(this instanceof iD.geo.Maat))return new iD.geo.Maat(turn);_.extend(this,turn)};iD.geo.maatIntersection=function(graph,vertexId){var vertex=graph.entity(vertexId),highways=[];graph.parentWays(vertex).forEach(function(way){if(way.isArea()||way.isDegenerate())return;if(way.affix(vertexId)){highways.push(way)}});var intersection={highways:highways,graph:graph};intersection.turns=function(fromNodeID){if(!fromNodeID)return[];var way=_.find(highways,function(way){return way.contains(fromNodeID)});if(way.first()===vertex.id&&"yes"===way.tags.oneway)return[];if(way.last()===vertex.id&&"-1"===way.tags.oneway)return[];function withRestriction(turn){graph.parentRelations(graph.entity(turn.from.way)).forEach(function(relation){var f=relation.memberByRole(iD.data.RoleType.FROAD_ID),t=relation.memberByRole(iD.data.RoleType.TROAD_ID),v=relation.memberByRole(iD.data.RoleType.ROAD_NODE_ID);if(f&&f.id===turn.from.way&&v&&v.id===turn.via.node&&t&&t.id===turn.to.way){turn.restriction=relation.id}});return iD.geo.Maat(turn)}var from={node:way.nodes[way.first()===vertex.id?1:way.nodes.length-2],way:way.id.split(/-(a|b)/)[0]},via={node:vertex.id},turns=[];highways.forEach(function(parent){if(parent===way)return;var index=parent.nodes.indexOf(vertex.id);if(parent.first()!==vertex.id&&"yes"!==parent.tags.oneway){turns.push(withRestriction({from:from,via:via,to:{node:parent.nodes[index-1],way:parent.id.split(/-(a|b)/)[0]}}))}if(parent.last()!==vertex.id&&"-1"!==parent.tags.oneway){turns.push(withRestriction({from:from,via:via,to:{node:parent.nodes[index+1],way:parent.id.split(/-(a|b)/)[0]}}))}});turns.push(withRestriction({from:from,via:via,to:from,u:true}));return turns};return intersection};iD.geo.inferRestriction=function(from,via,to,projection){var angle=iD.geo.angle(via,from,projection)-iD.geo.angle(via,to,projection);angle=180*angle/Math.PI;while(0>angle)angle+=360;if(23>angle)return"no_u_turn";if(158>angle)return"no_right_turn";if(202>angle)return"no_straight_on";if(336>angle)return"no_left_turn";return"no_u_turn"};;;iD.geo.isSimpleMultipolygonOuterMember=function(entity,graph){if("way"!==entity.type)return false;var parents=graph.parentRelations(entity);if(1!==parents.length)return false;var parent=parents[0];if(!(parent.isMultipolygon&&parent.isMultipolygon())||1<Object.keys(parent.tags).length)return false;var members=parent.members,member;for(var i=0;i<members.length;i++){member=members[i];if(member.id===entity.id&&member.role&&"outer"!==member.role)return false;if(member.id!==entity.id&&(!member.role||"outer"===member.role))return false}return parent};iD.geo.simpleMultipolygonOuterMember=function(entity,graph){if("way"!==entity.type)return false;var parents=graph.parentRelations(entity);if(1!==parents.length)return false;var parent=parents[0];if(!(parent.isMultipolygon&&parent.isMultipolygon())||1<Object.keys(parent.tags).length)return false;var members=parent.members,member,outerMember;for(var i=0;i<members.length;i++){member=members[i];if(!member.role||"outer"===member.role){if(outerMember)return false;outerMember=member}}return outerMember&&graph.hasEntity(outerMember.id)};iD.geo.joinWays=function(array,graph){var joined=[],member,current,nodes,first,last,i,how,what;array=array.filter(function(member){return"way"===member.type&&graph.hasEntity(member.id)});function resolve(member){return graph.childNodes(graph.entity(member.id))}function reverse(member){return member.tags?iD.actions.Reverse(member.id)(graph).entity(member.id):member}while(array.length){member=array.shift();current=[member];current.nodes=nodes=resolve(member).slice();joined.push(current);while(array.length&&_.first(nodes)!==_.last(nodes)){first=_.first(nodes);last=_.last(nodes);for(i=0;i<array.length;i++){member=array[i];what=resolve(member);if(last===_.first(what)){how=nodes.push;what=what.slice(1);break}else if(last===_.last(what)){how=nodes.push;what=what.slice(0,-1).reverse();member=reverse(member);break}else if(first===_.last(what)){how=nodes.unshift;what=what.slice(0,-1);break}else if(first===_.first(what)){how=nodes.unshift;what=what.slice(1).reverse();member=reverse(member);break}else{what=how=null}}if(!what)break;how.apply(current,[member]);how.apply(nodes,what);array.splice(i,1)}}return joined};;;iD.geo.RawMercator=function(){var project=d3.geo.mercator.raw,k=512/Math.PI,x=0,y=0,clipExtent=[[0,0],[0,0]];function projection(point){point=project(point[0]*Math.PI/180,point[1]*Math.PI/180);return[point[0]*k+x,y-point[1]*k]}projection.projectionPixel=function(point){point=project(point[0]*Math.PI/180,point[1]*Math.PI/180);return[point[0]*k,point[1]*k]};projection.invert=function(point){point=project.invert((point[0]-x)/k,(y-point[1])/k);return point&&[180*point[0]/Math.PI,180*point[1]/Math.PI]};projection.scale=function(_){if(!arguments.length)return k;k=+_;return projection};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return projection};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;return projection};projection.stream=d3.geo.transform({point:function(x,y){x=projection([x,y]);this.stream.point(x[0],x[1])}}).stream;return projection};;;iD.Background=function(context){var dispatch=d3.dispatch("change"),layers=[];var container=null;function background(selection){container=selection;background.resetLayer()}background.resetLayer=function(){layers.sort(function(a,b){if(a.source().data().order>b.source().data().order){return 1}else if(a.source().data().order<b.source().data().order){return-1}else{return 0}});var overlays=container.selectAll(".overlay-layer").data(layers,function(d,i){return d.source().data().id});overlays.enter().insert("div",".layer-data").attr("class",function(d){return"layer-layer overlay-layer"+" overlay-layer-"+d.source().id}).attr("style",function(d){var oder=200+(d.source().data().order||1);let display=";display:";if(d.source().data().visible){display+="block"}else{display+="none"}return";z-index: "+(300<oder?299:oder)+display});overlays.each(function(layer){if(layer.source().data().visible){d3.select(this).call(layer)}});overlays.exit().remove()};background.layerVisible=function(id,vis){var result=false;container.selectAll(".overlay-layer").each(function(layer){if(layer.source().data().id==id){layer.source().data().visible=vis;if(vis){d3.select(this).style("display","block")}else{d3.select(this).style("display","none")}d3.select(this).call(layer);result=true;return false}});return result};background.layerSource=function(id,source){container.selectAll(".overlay-layer").each(function(layer){if(layer.source().data().id==id){_.extend(layer.source().data(),source);_.extend(layer.source(),source);d3.select(this).call(layer);return false}})};background.layerURL=function(id,url){container.selectAll(".overlay-layer").each(function(layer){if(layer.source().data().id==id){layer.source().data().url=url;d3.select(this).call(layer);return false}})};background.layerUpdate=function(id){container.selectAll(".overlay-layer").each(function(layer){if(layer.source().data().id==id){d3.select(this).call(layer);return false}})};background.layerzIndex=function(id,idx){container.selectAll(".overlay-layer").each(function(layer){if(layer.source().data().id==id){layer.source().data().zIndex=idx;return false}});background.resetLayer()};background.addLayer=function(source){if(!source){return false}var s;if("bing"===source.type){s=iD.BackgroundSource.Bing(source,dispatch)}else{s=iD.BackgroundSource(source)}var layer=iD.TileLayer(context).source(s).projection(context.projection).dimensions(context.map().dimensions());layers.push(layer);if(container){background.resetLayer()}};background.removeLayer=function(id){_.remove(layers,function(layer){if(layer.source().data().id==id)return true});if(container){background.resetLayer()}};background.dimensions=function(_){layers.forEach(function(layer){layer.dimensions(_)});background.resetLayer()};background.getOverlayLayers=function(id){var layer;for(var i=0;i<layers.length;i++){layer=layers[i];if(layer.source().data().id===id){return layer}}return false};background.getLayers=function(){return _.map(layers,function(d){return d.source().data()})};return d3.rebind(background,dispatch,"on")};;;iD.BackgroundSource=function(data){var source=_.clone(data),offset=[0,0],_data=data,name=source.name;source.zooms=data.zooms||[0,20];source.offset=function(_){if(!arguments.length)return offset;offset=_;return source};source.nudge=function(_,zoomlevel){offset[0]+=_[0]/Math.pow(2,zoomlevel);offset[1]+=_[1]/Math.pow(2,zoomlevel);return source};source.data=function(_){if(!arguments.length)return _data;_data=_;return source};source.name=function(){return name};source.imageryUsed=function(){return source.id||name};source.url=function(coord){return data.url.replace("{x}",coord[0]).replace("{y}",coord[1]).replace(/\{[t-]y\}/,Math.pow(2,coord[2])-coord[1]-1).replace(/\{z(oom)?\}/,coord[2]).replace(/\{switch:([^}]+)\}/,function(s,r){var subdomains=r.split(",");return subdomains[(coord[0]+coord[1])%subdomains.length]}).replace("{u}",function(){var u="";for(var zoom=coord[2];0<zoom;zoom--){var b=0;var mask=1<<zoom-1;if(0!==(coord[0]&mask))b++;if(0!==(coord[1]&mask))b+=2;u+=b.toString()}return u})};source.sphericalMercator=function(latlng,zoom){scale=256*Math.pow(2,zoom);var d=Math.PI/180,max=85.0511287798,lat=Math.max(Math.min(max,latlng[1]),-max),x=latlng[0]*d,y=lat*d;y=Math.log(Math.tan(Math.PI/4+y/2));return[6378137*x,6378137*y]};source.wmsurl=function(context,width,heigth){var extent=context.extent();var zoom=context.map().zoom();var lat=this.sphericalMercator(extent[0],zoom).toString();var lng=this.sphericalMercator(extent[1],zoom).toString();return data.url+lat+","+lng+"&WIDTH="+width+"&HEIGHT="+heigth};source.vmGetDateUrl=function(context,width,height){var extent=context.extent();var zoom=context.map().zoom();if("wms"==data.id){var lat=extent[0].toString();var lng=extent[1].toString();return data.wmsDateUrl+lat+","+lng+"&WIDTH="+width+"&HEIGHT="+height}else if("wms_r3"==data.id){var lon=context.map().center()[0];var lat=context.map().center()[1];return data.wmsDateUrl+"lon="+lon+"&lag="+lat}else{return""}};source.intersects=function(extent){extent=extent.polygon();return!data.polygon||data.polygon.some(function(polygon){return iD.geo.polygonIntersectsPolygon(polygon,extent)})};source.validZoom=function(z){return source.zooms[0]<=z&&source.zooms[1]>=z};source.isLocatorOverlay=function(){return"Locator Overlay"===name};source.copyrightNotices=function(){};return source};iD.BackgroundSource.Bing=function(data,dispatch){data.url=iD.config.BG_URL.kd_picture;var bing=iD.BackgroundSource(data),key="Arzdiw4nlOJzRwOz__qailc8NiR31Tt51dN2D7cm57NrnceZnCpgOkmJhNpGoppU",url="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/Aerial?include=ImageryProviders&key="+key+"&jsonp={callback}",providers=[];bing.copyrightNotices=function(zoom,extent){zoom=Math.min(zoom,21);return providers.filter(function(provider){return _.any(provider.areas,function(area){return extent.intersects(area.extent)&&area.zoom[0]<=zoom&&area.zoom[1]>=zoom})}).map(function(provider){return provider.attribution}).join(", ")};bing.logo="bing_maps.png";bing.terms_url="http://opengeodata.org/microsoft-imagery-details";return bing};iD.BackgroundSource.None=function(){var source=iD.BackgroundSource({id:"none",url:""});source.name=function(){return t("background.none")};source.imageryUsed=function(){return"None"};return source};iD.BackgroundSource.Custom=function(url){var source=iD.BackgroundSource({id:"custom",url:url});source.name=function(){return t("background.custom")};source.imageryUsed=function(){return"Custom ("+url+")"};return source};;;iD.GpxLayer=function(context){var projection,gj={},enable=true,svg;function render(selection){svg=selection.selectAll("svg").data([render]);svg.enter().append("svg");svg.style("display",enable?"block":"none");var paths=svg.selectAll("path").data([gj]);paths.enter().append("path").attr("class","gpx");var path=d3.geo.path().projection(projection);paths.attr("d",path);if("undefined"!==typeof gj.features){svg.selectAll("text").remove();svg.selectAll("path").data(gj.features).enter().append("text").attr("class","gpx").text(function(d){return d.properties.desc||d.properties.name}).attr("x",function(d){var centroid=path.centroid(d);return centroid[0]+5}).attr("y",function(d){var centroid=path.centroid(d);return centroid[1]})}}render.projection=function(_){if(!arguments.length)return projection;projection=_;return render};render.enable=function(_){if(!arguments.length)return enable;enable=_;return render};render.geojson=function(_){if(!arguments.length)return gj;gj=_;return render};render.dimensions=function(_){if(!arguments.length)return svg.dimensions();svg.dimensions(_);return render};render.id="layer-gpx";function over(){d3.event.stopPropagation();d3.event.preventDefault();d3.event.dataTransfer.dropEffect="copy"}d3.select("body").attr("dropzone","copy").on("drop.localgpx",function(){d3.event.stopPropagation();d3.event.preventDefault();if(!iD.detect().filedrop)return;context.background().gpxLayerFiles(d3.event.dataTransfer.files)}).on("dragenter.localgpx",over).on("dragexit.localgpx",over).on("dragover.localgpx",over);return render};;;iD.TileLayer=function(context){var tileSize=256,tile=d3.geo.tile(),projection,cache={},tileOrigin,z,transformProp=iD.util.prefixCSSProperty("Transform"),source=d3.functor(""),image;function tileSizeAtZoom(d,z){return Math.ceil(tileSize*Math.pow(2,z-d[2]))/tileSize}function atZoom(t,distance){var power=Math.pow(2,distance);return[Math.floor(t[0]*power),Math.floor(t[1]*power),t[2]+distance]}function lookUp(d){for(var up=-1;up>-d[2];up--){var tile=atZoom(d,up);if(false!==cache[source.url(tile)]){return tile}}}function uniqueBy(a,n){var o=[],seen={};for(var i=0;i<a.length;i++){if(seen[a[i][n]]===undefined){o.push(a[i]);seen[a[i][n]]=true}}return o}function addSource(d){d.push(source.url(d));return d}function background(selection){tile.scale(2*projection.scale()*Math.PI).translate(projection.translate());tileOrigin=[projection.scale()*Math.PI-projection.translate()[0],projection.scale()*Math.PI-projection.translate()[1]];z=Math.max(Math.log(2*projection.scale()*Math.PI)/Math.log(2)-8,0);if(!source.data().visible){return}if("wms"==source.type)wmsrender(selection);else render(selection)}function render(selection){var requests=[];if(source.validZoom(z)){tile().forEach(function(d){addSource(d);if(""===d[3])return;if("string"!==typeof d[3])return;requests.push(d);if(false===cache[d[3]]&&lookUp(d)){requests.push(addSource(lookUp(d)))}});requests=uniqueBy(requests,3).filter(function(r){return false!==cache[r[3]]})}var pixelOffset=[Math.round(source.offset()[0]*Math.pow(2,z)),Math.round(source.offset()[1]*Math.pow(2,z))];function load(d){cache[d[3]]=true;d3.select(this).on("error",null).on("load",null).classed("tile-loaded",true);render(selection)}function error(d){cache[d[3]]=false;d3.select(this).on("error",null).on("load",null).remove();render(selection)}function imageTransform(d){var _ts=tileSize*Math.pow(2,z-d[2]);var scale=tileSizeAtZoom(d,z);return"translate("+(Math.round(d[0]*_ts-tileOrigin[0])+pixelOffset[0])+"px,"+(Math.round(d[1]*_ts-tileOrigin[1])+pixelOffset[1])+"px)"+"scale("+scale+","+scale+")"}image=selection.selectAll("img").data(requests,function(d){return d[3]});image.exit().style(transformProp,imageTransform).classed("tile-removing",true).each(function(){var tile=d3.select(this);window.setTimeout(function(){if(tile.classed("tile-removing")){tile.remove()}},300)});image.enter().append("img").attr("class","tile").attr("src",function(d){return d[3]}).on("error",error).on("load",load);image.style(transformProp,imageTransform).classed("tile-removing",false)}function wmsrender(selection){var requests=[];var url=source.wmsurl(context,parseInt(d3.select("#map").style("width")),parseInt(d3.select("#map").style("height")));requests.push(url);function load(d){d3.select(this).on("error",null).on("load",null).classed("tile-loaded",true)}function error(d){d3.select(this).on("error",null).on("load",null).remove()}image=selection.selectAll("img").data(requests,function(d){return d});image.exit().classed("tile-removing",true).each(function(){var tile=d3.select(this);if(tile.classed("tile-removing")){tile.remove()}});image.enter().append("img").attr("class","tile").attr("src",function(d){return d}).on("error",error).on("load",load);image.classed("tile-removing",false);getWmsPhotoDate_delay()}var getWmsPhotoDate_delay=_.debounce(getWmsPhotoDate,100);function getWmsPhotoDate(){var wmsDateUrl=source.vmGetDateUrl(context,parseInt(d3.select("#map").style("width")),parseInt(d3.select("#map").style("height")));d3.xhr(wmsDateUrl).responseType("text").get(function(error,data){if(null!=error){if(console.error){console.warn("getWmsPhotoDate error:xhr.statusText="+error.statusText)}return}if("wms"!=source.type){return}var photodateArray=[];var dateObj={photodate:data.response};var photoDate=data.response;if("wms"==source.id&&""!=data.response){try{var resObj=JSON.parse(data.response);dateObj={photodate:resObj.date}}catch(e){}}photodateArray.push(dateObj);var selectPhotoDate=d3.select("#KDSEditor-footer").selectAll("#photoDate").data(photodateArray);selectPhotoDate.text(function(d,i){return"\u62CD\u6444\u65E5\u671F\uFF1A"+d.photodate});selectPhotoDate.enter().append("div").attr("id","photoDate").classed("photoDate",true).text(function(d,i){return"\u62CD\u6444\u65E5\u671F\uFF1A"+d.photodate});selectPhotoDate.exit().remove()})}background.projection=function(_){if(!arguments.length)return projection;projection=_;return background};background.dimensions=function(_){if(!arguments.length)return tile.size();tile.size(_);return background};background.source=function(_){if(!arguments.length)return source;source=_;cache={};tile.scaleExtent(source.zooms);return background};background.getTiles=function(){return tile()};background.getTilexy=function(tile){var reg=/\-?[0-9]+/g;var xy=[];image.each(function(d){if(tile[0]==d[0]&&tile[1]==d[1]&&tile[2]==d[2]){return xy=[Number(this.style.transform.match(reg)[0]),Number(this.style.transform.match(reg)[1])]}});return xy};return background};;;iD.Map=function(context){var dimensions=[1,1],dispatch=d3.dispatch("move","movestart","moveend","drawn","zoom","dragstart","draging","dragend","mousedown","mouseup"),projection=context.projection,roundedProjection=iD.svg.RoundProjection(projection),minzoom=0,max_zoom=256*Math.pow(2,20),min_zoom=256*Math.pow(2,1),zoom=d3.behavior.zoom().translate(projection.translate()).scale(2*projection.scale()*Math.PI).on("zoom",zoomPan),dblclickEnabled=false,transformStart,transformed=false,points=iD.svg.Points(roundedProjection,context),vertices=iD.svg.Vertices(roundedProjection,context),lines=iD.svg.Lines(projection,context),areas=iD.svg.Areas(projection),midpoints=iD.svg.Midpoints(roundedProjection,context),labels=iD.svg.Labels(projection,context),traffic=iD.svg.Traffic(roundedProjection,context),roadcross=iD.svg.RoadCross(roundedProjection,context),roadcrossline=iD.svg.RoadCrossLine(projection,context),placename=iD.svg.PlaceName(roundedProjection,context),searchpoint=iD.svg.SearchPoint(roundedProjection,context),effects=iD.svg.Effects(roundedProjection,context),supersurface,surface,surfaceCanvas,mouse,mousemove,editLevel=15;var pointlimit=33500;var checkTopTip=false;function map(selection){zoom.scaleExtent([map.min_zoom(),map.max_zoom()]);context.history().on("change.map",redraw);selection.call(zoom);supersurface=selection.append("div").attr("id","supersurface");supersurface.on("mouseup.tag",function(){if(context.mode()&&"browse"==context.mode().id){if(d3.event.target.__data__&&d3.event.target.__data__ instanceof iD.Entity){return}context.connection().searchPictureFeatureInfo(0,context.map().extent(),d3.event.offsetX,d3.event.offsetY,context.map().dimensions()[0],context.map().dimensions()[1],function(d,tagFlag){if(d&&0<d.length&&d[0]){}else{}})}});supersurface.call(context.background());surfaceCanvas=supersurface.append("div").attr("id","surfaceCanvas").attr("class","layer-layer").attr("style","z-index: 299;width:100%;height:100%");var dataLayer=supersurface.append("div").attr("class","layer-layer layer-data").attr("style","z-Index: 300");var startXY=null;map.surface=surface=dataLayer.append("svg").on("mousedown.zoom",function(){if(2===d3.event.button){d3.event.stopPropagation()}dispatch.movestart({});context.event.mousedown(d3.event);startXY=[d3.event.clientX,d3.event.clientY];dispatch.dragstart({});context.event.dragstart(d3.event)},true).on("mouseup.zoom",function(){if(!startXY)return;if(resetTransform())redraw();dispatch.moveend({});context.event.mouseup(d3.event);if(d3.event.clientX!=startXY[0]&&d3.event.clientY!=startXY[1]){dispatch.dragend({});context.event.dragend(d3.event)}startXY=null}).attr("id","surface").call(iD.svg.Surface(context));surface.on("mousemove.map",function(){mousemove=d3.event;mousemove.xy=context.map().mouseCoordinates();var pixel=context.projection.projectionPixel(mousemove.xy);var scale=2*context.projection.scale()*Math.PI;var tx=Math.floor((pixel[0]+scale/2)/256);var ty=Math.floor(-((pixel[1]-scale/2)/256));mousemove.tile=[tx,ty,map.zoom()];context.event.mousemove(mousemove);if(startXY&&mousemove.clientX!=startXY[0]&&mousemove.clientY!=startXY[1]){dispatch.draging({});context.event.draging(d3.event)}});surface.on("mouseover.vertices",function(){if(map.editable()&&!transformed){var hover=d3.event.target.__data__;surface.call(vertices.drawHover,context.graph(),hover,map.extent(),map.zoom());dispatch.drawn({full:false})}});surface.on("mouseout.vertices",function(){if(map.editable()&&!transformed){var hover=d3.event.relatedTarget&&d3.event.relatedTarget.__data__;surface.call(vertices.drawHover,context.graph(),hover,map.extent(),map.zoom());dispatch.drawn({full:false})}});context.on("enter.map",function(){if(map.editable()&&!transformed){var all=context.intersects(map.extent()),filter=d3.functor(true),graph=context.graph();layerDrawn(all);all=filterWrongDate(all,context);surface.call(vertices,graph,all,filter,map.extent(),map.zoom());surface.call(midpoints,graph,all,filter,map.trimmedExtent());dispatch.drawn({full:false});drawPoint(d3.functor(true));surface.call(pointPathLines,graph,all,d3.functor(true))}});context.event.on("changemap",function(){if(map.editable()&&!transformed){map.dimensions(selection.dimensions())}});context.ui().layermanager.on("change.map",function(layerInfo,flag){if("display"===flag){map.dimensions(selection.dimensions())}});map.dimensions(selection.dimensions())}function pxCenter(){return[dimensions[0]/2,dimensions[1]/2]}function layerDrawn(al){for(var p=0;p<al.length;p++){var type=al[p].modelName;if(_.include([iD.data.DataType.SEARCH_POINT,iD.data.DataType.PLACENAME],al[p]._type)){continue}var modelConfig=iD.Layers.getLayer(al[p].layerId,al[p].modelName);if(!modelConfig||!modelConfig.display){al.splice(p,1);p--}}}map.checkTopo=function(){var al=context.intersects(map.extent());if(0<al.length&&"road"==iD.Layers.getLayer().type){var checkFlag=false;for(var i=0;i<al.length;i++){var entity=al[i];if(entity instanceof iD.Node&&entity.isRoadNode()||entity instanceof iD.Node&&entity.isRoadCross()){if(iD.util.justNodeInPlyGonx(entity,context)){checkFlag=iD.topo.check().mainCheck(context.graph(),entity)}}else if(entity instanceof iD.Way&&entity.modelName==iD.data.DataType.HIGHWAY){if(iD.util.justNodeInPlyGonx(context.graph().entity(entity.first()),context)||iD.util.justNodeInPlyGonx(context.graph().entity(entity.first()),context)){checkFlag=iD.topo.check().mainCheck(context.graph(),entity)}}if(checkFlag){console.log("TOPO\u68C0\u67E5\u9519\u8BEF");if(!checkTopTip){checkTopTip=true;Dialog.alert("\u6570\u636E\u52A0\u8F7D\u4E0D\u5168,\u8BF7\u62D6\u52A8\u5C4F\u5E55\u52A0\u8F7D\u66F4\u591A\u6570\u636E\u540E\u4F5C\u4E1A!",function(){checkTopTip=false})}break}}}};function filterWrongDate(all,context){var errMsg=[];for(var i=0;i<all.length;i++){if(all[i]instanceof iD.Way&&"browse"===context.mode().id){var flag=false;if(2>all[i].nodes.length){var str="\u8FD4\u56DE\u6570\u636E\u5728\u9053\u8DEF"+all[i].id+"\u4E0A\u7ED3\u70B9\u6570\u5C0F\u4E8E2\u4E2A";console.warn("\u7ED3\u70B9\u5C0F\u4E8E2\u5220\u9664\u7684\u6570\u636E"+all[i].id);all.splice(i,1);i--;errMsg.push(str);continue}for(var j=0;j<all[i].nodes.length;j++){if(!context.hasEntity(all[i].nodes[j])){var str="\u8FD4\u56DE\u6570\u636E\u5728\u9053\u8DEF"+all[i].id+"\u4E0A\u7F3A\u5C11\u8282\u70B9:"+all[i].nodes[j];flag=true;console.warn("\u7F3A\u5C11\u7ED3\u70B9\u5220\u9664\u7684\u6570\u636E"+all[i].id);all.splice(i,1);i--;errMsg.push(str);break}}if(flag)continue}}return all}function drawVector(difference,extent){var filter,all,graph=context.graph();if(difference){var complete=difference.complete(map.extent());all=_.compact(_.values(complete));filter=function(d){return d.id in complete}}else if(extent){all=context.intersects(map.extent().intersection(extent));var set=d3.set(_.pluck(all,"id"));filter=function(d){return set.has(d.id)}}else{all=context.intersects(map.extent());filter=d3.functor(true)}layerDrawn(all);all=filterWrongDate(all,context);var otherLinesArr=AllButRoadCrossLine(all);var roadCrossLineArr=roadCrossLine(all);surface.call(vertices,graph,all,filter,map.extent(),map.zoom()).call(lines,graph,otherLinesArr,filter).call(roadcrossline,graph,roadCrossLineArr,filter).call(areas,graph,all,filter).call(midpoints,graph,all,filter,map.trimmedExtent());if(points.points(context.intersects(map.extent()),pointlimit).length>=pointlimit){surface.select(".layer-hit").selectAll("g.point").remove()}else{surface.call(points,points.points(all),filter)}drawPoint(all,filter);surface.call(labels,graph,all,filter,dimensions,!difference&&!extent);dispatch.drawn({full:true,difference:difference});drawOverlayers();surface.call(pointPathLines,graph,all,d3.functor(true))}function roadCrossLine(all){var roadCrossLinesArr=[];all.forEach(function(entity){if(entity._type&&"roadcrossline"==entity._type){roadCrossLinesArr.push(entity)}});return roadCrossLinesArr}function AllButRoadCrossLine(all){var allButRoadCrossLinesArr=[];all.forEach(function(entity){if(!entity._type||"roadcrossline"!==entity._type){allButRoadCrossLinesArr.push(entity)}});return allButRoadCrossLinesArr}var pointPathLines=iD.svg.PointPathLines(projection,context);function drawPoint(all,filter){var graph=context.graph();var data=all;if(traffic.traffic(data,pointlimit).length>=pointlimit){surface.select(".layer-hit").selectAll("g.point").remove()}else{surface.call(traffic,traffic.traffic(data),filter)}if(roadcross.roadcross(data,pointlimit).length>=pointlimit){surface.select(".layer-hit").selectAll("g.point").remove()}else{surface.call(roadcross,roadcross.roadcross(data),filter)}if(null!=d3.select("#effects-forbid-info")[0][0]&&true==d3.select("#effects-forbid-info").classed("active")){if(effects.effects(data,pointlimit).length>=pointlimit){surface.select(".layer-hit").selectAll("g.point").remove()}else{surface.call(effects,effects.effects(data),filter)}}else{surface.call(effects,[],filter)}if(placename.placename(data,pointlimit).length>=pointlimit){surface.select(".layer-hit").selectAll("g.point").remove()}else{surface.call(placename,placename.placename(data),filter)}if(searchpoint.searchpoint(data,pointlimit).length>=pointlimit){surface.select(".layer-hit").selectAll("g.point").remove()}else{surface.call(searchpoint,searchpoint.searchpoint(data),filter)}}function editOff(){var mode=context.mode();surface.selectAll(".layer *").remove();dispatch.drawn({full:true});if(!(mode&&"browse"===mode.id)){context.enter(iD.modes.Browse(context))}}function zoomPan(){if(d3.event&&"dblclick"===d3.event.sourceEvent.type){if(!dblclickEnabled){zoom.scale(2*projection.scale()*Math.PI).translate(projection.translate());return d3.event.sourceEvent.preventDefault()}}if(Math.log(d3.event.scale/Math.LN2-8)<minzoom+1){iD.ui.flash(context.container()).select(".KDSEditor-content").text(t("cannot_zoom"));return setZoom(16,true)}projection.translate(d3.event.translate).scale(d3.event.scale/(2*Math.PI));var scale=d3.event.scale/transformStart[0],tX=Math.round((d3.event.translate[0]/scale-transformStart[1][0])*scale),tY=Math.round((d3.event.translate[1]/scale-transformStart[1][1])*scale);transformed=true;iD.util.setTransform(supersurface,tX,tY,scale);queueRedraw();dispatch.move(map);setTimeout(function(){dispatch.zoom(map.zoom())},300);context.event.moveoverview();context.event.moveinfowindow()}function resetTransform(){if(!transformed)return false;iD.util.setTransform(supersurface,0,0);transformed=false;return true}function redraw(difference,extent){clearTimeout(timeoutId);if(!surface)return;if(resetTransform()){difference=extent=undefined}var zoom=String(~~map.zoom());if(surface&&surface.attr("data-zoom")!==zoom){surface.attr("data-zoom",zoom).classed("low-zoom",zoom<=map.editableLevel())}if(!difference&&supersurface){supersurface.call(context.background())}if(map.editable()){if(iD.Task&&iD.Task.d){context.connection().loadData(projection,dimensions);context.connection().loadCheckTagList(projection,dimensions);context.connection().loadImageTagList(projection,dimensions);context.connection().loadAnalysisTagList(projection,dimensions);context.connection().loadQuestionTagList(projection,dimensions)}drawVector(difference,extent)}else{editOff();transaction.resetGraphyInfo();drawTransactionOverlayers()}transformStart=[2*projection.scale()*Math.PI,projection.translate().slice()];context.event.moveinfowindow();context.storage("s_map_editor_center",map.center());context.storage("s_map_editor_zoom",map.zoom());return map}var timeoutId;function queueRedraw(){clearTimeout(timeoutId);timeoutId=setTimeout(function(){redraw()},300)}function pointLocation(p){var translate=projection.translate(),scale=2*projection.scale()*Math.PI;return[(p[0]-translate[0])/scale,(p[1]-translate[1])/scale]}function locationPoint(l){var translate=projection.translate(),scale=2*projection.scale()*Math.PI;return[l[0]*scale+translate[0],l[1]*scale+translate[1]]}map.redraw=redraw;map.mouse=function(){var e=mousemove||d3.event,s;while(s=e.sourceEvent)e=s;return mouse(e)};map.invert=function(xy){return projection.invert(xy)};map.mouseCoordinates=function(){return projection.invert(map.mouse())};map.dblclickEnable=function(_){if(!arguments.length)return dblclickEnabled;dblclickEnabled=_;return map};map.setZoom=function(v,force){setZoom(v,force)};function setZoom(_,force){if(_===map.zoom()&&!force)return false;var scale=256*Math.pow(2,_),center=pxCenter(),l=pointLocation(center);scale=Math.max(map.min_zoom(),Math.min(map.max_zoom(),scale));projection.scale(scale/(2*Math.PI));zoom.scale(scale);var t=projection.translate();l=locationPoint(l);t[0]+=center[0]-l[0];t[1]+=center[1]-l[1];projection.translate(t);zoom.translate(projection.translate());return true}function setCenter(_){var c=map.center();if(_[0]===c[0]&&_[1]===c[1])return false;var t=projection.translate(),pxC=pxCenter(),ll=projection(_);projection.translate([t[0]-ll[0]+pxC[0],t[1]-ll[1]+pxC[1]]);zoom.translate(projection.translate());return true}map.pan=function(d){var t=projection.translate();t[0]+=d[0];t[1]+=d[1];projection.translate(t);zoom.translate(projection.translate());dispatch.move(map);return redraw()};map.dimensions=function(_){if(!arguments.length)return dimensions;var center=map.center();dimensions=_;surface.dimensions(dimensions);context.background().dimensions(dimensions);projection.clipExtent([[0,0],dimensions]);mouse=iD.util.fastMouse(supersurface.node());setCenter(center);return redraw()};map.closeTabDimensions=function(_){if(!arguments.length)return dimensions;dimensions=_;surface.dimensions(dimensions);context.background().dimensions(dimensions);projection.clipExtent([[0,0],dimensions]);mouse=iD.util.fastMouse(supersurface.node());return redraw()};map.size=function(){return dimensions};map.zoomIn=function(){return map.zoom(Math.ceil(map.zoom()+1))};map.zoomOut=function(){return map.zoom(Math.floor(map.zoom()-1))};map.center=function(loc){if(!arguments.length){return projection.invert(pxCenter())}if(setCenter(loc)){dispatch.move(map)}return redraw()};map.zoom=function(z){if(!arguments.length){var zoom=Math.max(Math.log(2*projection.scale()*Math.PI)/Math.LN2-8,0);return parseInt(zoom,10)}var r;if(setZoom(z)){dispatch.move(map);dispatch.zoom(z);r=redraw()}return r};map.zoomTo=function(entity,zoomLimits){var extent=entity.extent(context.graph()),zoom=map.extentZoom(extent);zoomLimits=zoomLimits||[16,20];map.centerZoom(extent.center(),Math.min(Math.max(zoom,zoomLimits[0]),zoomLimits[1]))};map.centerZoom=function(loc,z){var centered=setCenter(loc),zoomed=setZoom(z);if(centered||zoomed){dispatch.move(map)}return redraw()};map.centerEase=function(loc){var from=map.center().slice(),t=0,stop;surface.one("mousedown.ease",function(){stop=true});d3.timer(function(){if(stop)return true;map.center(iD.geo.interp(from,loc,(t+=1)/10));return 10===t},20);return map};map.extent=function(_){if(!arguments.length){return new iD.geo.Extent(projection.invert([0,dimensions[1]]),projection.invert([dimensions[0],0]))}else{var extent=iD.geo.Extent(_);map.centerZoom(extent.center(),parseInt(map.extentZoom(extent)))}};map.trimmedExtent=function(){var headerY=60,footerY=30,pad=10;return new iD.geo.Extent(projection.invert([pad,dimensions[1]-footerY-pad]),projection.invert([dimensions[0]-pad,headerY+pad]))};map.extentZoom=function(_){var extent=iD.geo.Extent(_),tl=projection([extent[0][0],extent[1][1]]),br=projection([extent[1][0],extent[0][1]]);var hFactor=(br[0]-tl[0])/dimensions[0],vFactor=(br[1]-tl[1])/dimensions[1],hZoomDiff=Math.log(Math.abs(hFactor))/Math.LN2,vZoomDiff=Math.log(Math.abs(vFactor))/Math.LN2,hZoomDiff=hZoomDiff==Infinity||hZoomDiff==-Infinity?0:hZoomDiff,vZoomDiff=vZoomDiff==Infinity||vZoomDiff==-Infinity?0:vZoomDiff,newZoom=map.zoom()-Math.max(hZoomDiff,vZoomDiff);return newZoom};map.editable=function(){return map.zoom()>=editLevel};map.editableLevel=function(_){if(!arguments.length)return editLevel;editLevel=_;return map};map.minzoom=function(_){if(!arguments.length)return minzoom;minzoom=_;return map};map.max_zoom=function(_){if(!arguments.length)return max_zoom;max_zoom=256*Math.pow(2,_);return map};map.min_zoom=function(_){if(!arguments.length)return min_zoom;min_zoom=256*Math.pow(2,_);return map};map.lightEntity=function(ids){if(!ids)return;if(ids&&"string"===typeof ids){ids=[ids]}for(var i=0;i<ids.length;i++){if(context.hasEntity(ids[i])){context.enter(iD.modes.Select(context,ids).suppressMenu(true).newFeature(true))}else{context.loadEntity(ids[i],false)}}};map.lightEntities=function(layerid,ids){if(!ids||!layerid)return;if(ids&&"string"===typeof ids){ids=[ids]}ids.filter(function(d){return context.hasEntity(d)&&context.hasEntity(d).layerId==layerid});context.enter(iD.modes.Select(context,ids).suppressMenu(true).newFeature(true))};map.removeEntities=function(layerid,ids){if(!ids||!layerid)return;var cLayer=context.layers().getLayer(layerid);var entities,annotation;if(layerid!=cLayer.id){return}if(ids&&"string"===typeof ids){ids=[ids]}entities=ids.filter(function(n){return context.hasEntity(n)&&context.hasEntity(n).layerId==layerid});var action=iD.actions.DeleteMultiple(entities);if(1<entities.length){annotation=t("operations.delete.annotation.multiple",{n:entities.length})}else{var geometry=context.geometry(entities[0]);annotation=t("operations.delete.annotation."+geometry)}context.perform(action,annotation)};map.lightOverlays=function(overlays){if(!overlays)return;if(overlays&&"string"===typeof overlays){overlays=[overlays]}var selector="";for(var i=0;i<overlays.length;i++){if(i!=overlays.length-1)selector+="."+overlays[i]+", ";else selector+="."+overlays[i]}map._lightselector=selector;if(""==selector)surface&&surface.selectAll(".hover").classed("hover",false);else surface&&surface.selectAll(selector).classed("hover",true)};map.addOverlays=function(overlay,type){if(overlay instanceof iD.Icon)overlayers.icon.push(overlay);else if(overlay instanceof iD.Marker)overlayers.marker.push(overlay);else if(overlay instanceof iD.Polyline)overlayers.polyline.push(overlay);else if(overlay instanceof iD.Polygon)overlayers.polygon.push(overlay);else if(overlay instanceof iD.Circle)overlayers.circle.push(overlay);else if(overlay instanceof iD.TransPolygon)overlayers.transactions.push(overlay)};map.removeOverlays=function(overlay){var o=overlayers;if(overlay instanceof iD.Icon)o.icon=iD.util.arrayRemove(overlay,o.icon);else if(overlay instanceof iD.Marker)o.marker=iD.util.arrayRemove(overlay,o.marker);else if(overlay instanceof iD.Polyline)o.polyline=iD.util.arrayRemove(overlay,o.polyline);else if(overlay instanceof iD.Polygon)o.polygon=iD.util.arrayRemove(overlay,o.polygon);else if(overlay instanceof iD.Circle)o.circle=iD.util.arrayRemove(overlay,o.circle);else if(overlay instanceof iD.TransPolygon)o.transactions=iD.util.arrayRemove(overlay,o.transactions)};map.getOverlays=function(overlaysid){if(!overlaysid)return overlayers;if(overlaysid&&"string"===typeof overlaysid){overlaysid=[overlaysid]}var array=[];overlayers.marker.forEach(function(overlay){overlaysid.forEach(function(id){if(overlay.id==id||overlay==id)array.push(overlay)})});overlayers.polyline.forEach(function(overlay){overlaysid.forEach(function(id){if(overlay.id==id||overlay==id)array.push(overlay)})});overlayers.polygon.forEach(function(overlay){overlaysid.forEach(function(id){if(overlay.id==id||overlay==id)array.push(overlay)})});overlayers.icon.forEach(function(overlay){overlaysid.forEach(function(id){if(overlay.id==id||overlay==id)array.push(overlay)})});overlayers.circle.forEach(function(overlay){overlaysid.forEach(function(id){if(overlay.id==id||overlay==id)array.push(overlay)})});overlayers.transactions.forEach(function(overlay){overlaysid.forEach(function(id){if(overlay.id==id||overlay==id)array.push(overlay)})});return array};map.drawOverlayers=function(){drawOverlayers()};var marker=iD.svg.Marker(roundedProjection,context),markerIcon=iD.svg.MarkerIcon(roundedProjection,context),label=iD.svg.Label(roundedProjection,context),polygon=iD.svg.Polygon(projection,context),polyline=iD.svg.Polyline(projection,context),circle=iD.svg.Circle(roundedProjection,context),partRedraw=iD.svg.PartRedraw(projection,context),overlayersVertices=iD.svg.overlayers.Vertices(roundedProjection,context),transaction=iD.svg.TransactionAreas(projection,context);overlayers={marker:[],polyline:[],polygon:[],circle:[],icon:[],transactions:[]};map.updateOverlays=function(overlays){if(!overlays)return;if(overlays&&!overlays.length){overlays=[overlays]}for(var i=0;i<overlays.length;i++){if(overlays[i]instanceof iD.Icon)partRedraw.resetIcon(surface,overlays[i]);else if(overlays[i]instanceof iD.Marker)partRedraw.resetMarker(surface,overlays[i]);else if(overlays[i]instanceof iD.Polyline)partRedraw.resetPolyline(surface,overlays[i]);else if(overlays[i]instanceof iD.Polygon)partRedraw.resetPolygon(surface,overlays[i])}};function drawOverlayers(){if(!context.options.overlaysApply)return;if(surface){surface.call(marker,overlayers.marker,d3.functor(true));surface.call(markerIcon,overlayers.icon,d3.functor(true));surface.call(polygon,context.graph(),overlayers.polygon,d3.functor(true));surface.call(polyline,context.graph(),overlayers.polyline,d3.functor(true));surface.call(overlayersVertices,context.graph(),overlayers.polyline,d3.functor(true),map.extent(),map.zoom(),"polyline");surface.call(overlayersVertices,context.graph(),overlayers.polygon,d3.functor(true),map.extent(),map.zoom(),"polygon");surface.call(circle,overlayers.circle,d3.functor(true));surface.call(label,labelIcon(true),d3.functor(true),"polylabel");surface.call(label,labelIcon(false).concat(polygonlabel(false)),d3.functor(true),"polyicon");surface.call(label,polygonlabel(true),d3.functor(true),"polygonlabel");surface.call(transaction,context.graph(),overlayers.transactions,d3.functor(true))}}function drawTransactionOverlayers(){if(surface){surface.call(transaction,context.graph(),overlayers.transactions,d3.functor(true))}}function polygonlabel(clone){var data=[];for(var i in overlayers.polygon){var poly=overlayers.polygon[i];if(poly.distance){var node=clone?new Marker({loc:poly.first().loc}):poly.first();if(!clone){node.remove=true;node.parent=poly}if(poly.distance){node.distance=poly.getArea()}data.push(node)}}return data}function labelIcon(clone){var data=[];for(var i in overlayers.polyline){var poly=overlayers.polyline[i];if(poly.distance){var node=clone?new Marker({loc:poly.last().loc}):poly.last();if(!clone){node.remove=true;node.parent=poly}else node.distance=poly.distance;node.end=poly.last().end;if(clone||poly.last().end)data.push(node)}}return data}map.drawTansactionEntity=function(){var editArea=context.editArea();if(_.isEmpty(editArea)||!editArea){return}var _extent=context.map().extent(),min=_extent[0],max=_extent[1];var _expand=0.00003125;min[0]-=_expand,min[1]-=_expand;max[0]+=_expand,max[1]+=_expand;var p1=new Point({loc:min}),p2=new Point({loc:[min[0],max[1]]}),p3=new Point({loc:max}),p4=new Point({loc:[max[0],min[1]]});var nodes=[p1,p2,p3,p4,p1];let holes=[];let coordinates=editArea.coordinates[0];for(let i=0,len=coordinates.length;i<len;i++){holes.push(new Point({loc:coordinates[i]}))}transaction.resetGraphyInfo();var transPolygon=new TransPolygon({nodes:nodes,holes:[holes],onDraw:function(element,entity,classed){if("transpolygon"===entity.type)element.style({stroke:"#000",opacity:0.6,"stroke-width":2,"stroke-dasharray":"5, 5",fill:"#333333"})}});iD.Task.d.trans_id=transPolygon.id;map.addOverlays(transPolygon);map.drawOverlayers();if(iD.Task.d.bounds){this.extent(iD.geo.Extent(iD.Task.d.bounds));this.setZoom(20)}};map.contextResize=function(){};map.clickTransactionExtent=function(loc){var tran,tempObj=context.users;for(var tId in tempObj){if(-1<tId.indexOf("trans")){tran=tempObj[tId];for(var hIdx in tran.holes){if(iD.util.isPointInPolygon({loc:loc},{nodes:tran.holes[hIdx]}))return true}}}return false};map.hasTransformed=function(){return transformed};context.event.on("drawoverlayers.event",drawOverlayers);return d3.rebind(map,dispatch,"on")};;;iD.Overview=function(context){var dimensions=[1,1],dispatch=d3.dispatch("move","drawn"),projection=context.overview_projection,roundedProjection=iD.svg.RoundProjection(projection),minzoom=0,max_zoom=256*Math.pow(2,20),min_zoom=256*Math.pow(2,1),zoom=d3.behavior.zoom().translate(projection.translate()).scale(2*projection.scale()*Math.PI).on("zoom",zoomPan),dblclickEnabled=true,transformStart,transformed=false,supersurface,surface,mouse,mousemove,editLevel=13;var background;var locs=[],_extent=[],style={},size,__opt;var isDraw=false;function map(selection){zoom.scaleExtent([map.min_zoom(),map.max_zoom()]);selection.call(zoom);supersurface=selection.append("div").attr("id","overview-supersurface");supersurface.call(background);var dataLayer=supersurface.append("div").attr("class","overview-layer-layer overview-layer-data").attr("style","z-Index: 300");surface=map.surface=dataLayer.append("svg").on("mousedown.zoom",function(){if(2===d3.event.button){d3.event.stopPropagation()}},true).on("mouseup.zoom",function(){if(resetTransform())redraw()}).attr("id","overview-surface").call(iD.svg.OverviewSurface(context));surface.on("mousemove.overview",function(){mousemove=d3.event});map.dimensions(selection.dimensions());map.extent(_extent)}function pxCenter(){return[dimensions[0]/2,dimensions[1]/2]}function drawVector(data){var iUrl=context.imagePath("overview_point.png");_.forEach(data,function(loc){var icon=new Icon({loc:loc,url:style?style.url?style.url:iUrl:iUrl,width:size?size[0]:8,height:size?size[1]:8});map.addOverlays(icon)});if(__opt.bound)drawPolygon()}function drawPolygon(){var min=_extent[0],max=_extent[1];var p1=new Point({loc:min}),p2=new Point({loc:[min[0],max[1]]}),p3=new Point({loc:max}),p4=new Point({loc:[max[0],min[1]]});var nodes=[p1,p2,p3,p4,p1];function style(element,entity,classed){if("polygon"===entity.type){element.style({stroke:"#333333",opacity:1,"stroke-width":1,"stroke-dasharray":"5, 5"})}}var polygon=new Polygon({nodes:nodes,onDraw:style});map.addOverlays(polygon)}function zoomPan(){var dType=d3.event&&d3.event.sourceEvent.type;if("dblclick"===dType||"mousemove"===dType||"wheel"===dType)return;if(Math.log(d3.event.scale/Math.LN2-8)<minzoom+1)return setZoom(16,true);projection.translate(d3.event.translate).scale(d3.event.scale/(2*Math.PI));var scale=d3.event.scale/transformStart[0],tX=Math.round((d3.event.translate[0]/scale-transformStart[1][0])*scale),tY=Math.round((d3.event.translate[1]/scale-transformStart[1][1])*scale);transformed=true;iD.util.setTransform(supersurface,tX,tY,scale);queueRedraw()}function resetTransform(){if(!transformed)return false;iD.util.setTransform(supersurface,0,0);transformed=false;return true}function redraw(difference,extent){if(!surface)return;clearTimeout(timeoutId);if(resetTransform()){difference=extent=undefined}var zoom=String(~~map.zoom());if(surface.attr("data-zoom")!==zoom){surface.attr("data-zoom",zoom).classed("low-zoom",zoom<=map.editableLevel())}if(!difference){supersurface.call(background)}if(!isDraw){drawVector(locs);isDraw=true}drawOverlayers();transformStart=[2*projection.scale()*Math.PI,projection.translate().slice()];return map}var timeoutId;function queueRedraw(){clearTimeout(timeoutId);timeoutId=setTimeout(function(){redraw()},300)}function pointLocation(p){var translate=projection.translate(),scale=2*projection.scale()*Math.PI;return[(p[0]-translate[0])/scale,(p[1]-translate[1])/scale]}function locationPoint(l){var translate=projection.translate(),scale=2*projection.scale()*Math.PI;return[l[0]*scale+translate[0],l[1]*scale+translate[1]]}map.mouse=function(){var e=mousemove||d3.event,s;while(s=e.sourceEvent)e=s;return mouse(e)};map.mouseCoordinates=function(){return projection.invert(map.mouse())};map.dblclickEnable=function(_){if(!arguments.length)return dblclickEnabled;dblclickEnabled=_;return map};function setZoom(_,force){if(_===map.zoom()&&!force)return false;var scale=256*Math.pow(2,_),center=pxCenter(),l=pointLocation(center);scale=Math.max(map.min_zoom(),Math.min(map.max_zoom(),scale));projection.scale(scale/(2*Math.PI));zoom.scale(scale);var t=projection.translate();l=locationPoint(l);t[0]+=center[0]-l[0];t[1]+=center[1]-l[1];projection.translate(t);zoom.translate(projection.translate());return true}function setCenter(_){var c=map.center();if(_[0]===c[0]&&_[1]===c[1])return false;var t=projection.translate(),pxC=pxCenter(),ll=projection(_);projection.translate([t[0]-ll[0]+pxC[0],t[1]-ll[1]+pxC[1]]);zoom.translate(projection.translate());return true}map.pan=function(d){var t=projection.translate();t[0]+=d[0];t[1]+=d[1];projection.translate(t);zoom.translate(projection.translate());dispatch.move(map);return redraw()};map.dimensions=function(_){if(!arguments.length)return dimensions;var center=map.center();dimensions=_;surface.dimensions(dimensions);background.dimensions(dimensions);projection.clipExtent([[0,0],dimensions]);mouse=iD.util.fastMouse(supersurface.node());setCenter(center);return redraw()};map.zoomIn=function(){return map.zoom(Math.ceil(map.zoom()+1))};map.zoomOut=function(){return map.zoom(Math.floor(map.zoom()-1))};map.center=function(loc){if(!arguments.length){return projection.invert(pxCenter())}if(setCenter(loc)){dispatch.move(map)}return redraw()};map.zoom=function(z){if(!arguments.length){var zoom=Math.max(Math.log(2*projection.scale()*Math.PI)/Math.LN2-8,0);return parseInt(zoom,10)}if(setZoom(z)){dispatch.move(map)}return redraw()};map.zoomTo=function(entity,zoomLimits){var extent=entity.extent(context.graph()),zoom=map.extentZoom(extent);zoomLimits=zoomLimits||[16,20];map.centerZoom(extent.center(),Math.min(Math.max(zoom,zoomLimits[0]),zoomLimits[1]))};map.centerZoom=function(loc,z){var centered=setCenter(loc),zoomed=setZoom(z);if(centered||zoomed){dispatch.move(map)}return redraw()};map.centerEase=function(loc){var from=map.center().slice(),t=0,stop;surface.one("mousedown.ease",function(){stop=true});d3.timer(function(){if(stop)return true;map.center(iD.geo.interp(from,loc,(t+=1)/10));return 10===t},20);return map};map.extent=function(_){if(!arguments.length){return new iD.geo.Extent(projection.invert([0,dimensions[1]]),projection.invert([dimensions[0],0]))}else{var extent=iD.geo.Extent(_);map.centerZoom(extent.center(),map.extentZoom(extent))}};map.trimmedExtent=function(){var headerY=60,footerY=30,pad=10;return new iD.geo.Extent(projection.invert([pad,dimensions[1]-footerY-pad]),projection.invert([dimensions[0]-pad,headerY+pad]))};map.extentZoom=function(_){var extent=iD.geo.Extent(_),tl=projection([extent[0][0],extent[1][1]]),br=projection([extent[1][0],extent[0][1]]);var hFactor=(br[0]-tl[0])/dimensions[0],vFactor=(br[1]-tl[1])/dimensions[1],hZoomDiff=Math.log(Math.abs(hFactor))/Math.LN2,vZoomDiff=Math.log(Math.abs(vFactor))/Math.LN2,newZoom=map.zoom()-Math.max(hZoomDiff,vZoomDiff);return newZoom};map.editableLevel=function(_){if(!arguments.length)return editLevel;editLevel=_;return map};map.minzoom=function(_){if(!arguments.length)return minzoom;minzoom=_;return map};map.max_zoom=function(_){if(!arguments.length)return max_zoom;max_zoom=256*Math.pow(2,_);return map};map.min_zoom=function(_){if(!arguments.length)return min_zoom;min_zoom=256*Math.pow(2,_);return map};map.init=function(opt,extent){__opt=opt;locs=opt.locs;_extent=opt.extent?opt.extent:getBoundsByLocs(locs);style=opt.style;size=style?style.size:null;background=iD.OverviewBackground(context,projection,opt.tilelayer);isDraw=false};function getBoundsByLocs(locs){var minll=[Infinity,Infinity],maxll=[0,0],loc;for(var i in locs){loc=locs[i];if(minll[0]>loc[0])minll[0]=loc[0];if(minll[1]>loc[1])minll[1]=loc[1];if(maxll[0]<loc[0])maxll[0]=loc[0];if(maxll[1]<loc[1])maxll[1]=loc[1]}return[minll,maxll]}function abortRequest(i){i.abort()}function bboxUrl(tile,layer){var dataUrl=layer.url+"?sid="+layer.bboxSId+"&bbox="+tile.extent.toParam()+"&filter="+layer.filter+"&layerid="+layer.id;return dataUrl}var loadedTiles={},inflight={};map.loadTiles=function(projection,dimensions,callback){var s=2*projection.scale()*Math.PI,z=Math.max(Math.log(s)/Math.log(2)-8,0);if(15>=z)tileZoom=z;var ts=256*Math.pow(2,z-tileZoom),origin=[s/2-projection.translate()[0],s/2-projection.translate()[1]];var tiles=d3.geo.tile().scaleExtent([tileZoom,tileZoom]).scale(s).size(dimensions).translate(projection.translate())().map(function(tile){var x=tile[0]*ts-origin[0],y=tile[1]*ts-origin[1];return{id:tile.toString(),extent:iD.geo.Extent(projection.invert([x,y+ts]),projection.invert([x+ts,y]))}});_.filter(inflight,function(v,i){var wanted=_.find(tiles,function(tile){return i===tile.id});if(!wanted)delete inflight[i];return!wanted}).map(abortRequest);tiles.forEach(function(tile){var id=tile.id;if(loadedTiles[id]||inflight[id])return;var layers=iD.Layers.getLayers();layers.forEach(function(layer){inflight[id]=context.connection().loadFromURL(bboxUrl(tile,layer),function(err,parsed,lay){loadedTiles[id]=true;delete inflight[id];callback(parsed)},layer)})})};map.addOverlays=function(overlay,type){if(overlay instanceof iD.Icon)overlayers.icon.push(overlay);else if(overlay instanceof iD.Polygon)overlayers.polygon.push(overlay)};map.getOverlays=function(overlaysid){if(!overlaysid)return overlayers;if(overlaysid&&"string"===typeof overlaysid){overlaysid=[overlaysid]}var array=[];overlayers.icon.forEach(function(overlay){overlaysid.forEach(function(id){if(overlay.id==id||overlay==id)array.push(overlay)})});overlayers.polygon.forEach(function(overlay){overlaysid.forEach(function(id){if(overlay.id==id||overlay==id)array.push(overlay)})});return array};map.removeOverlays=function(overlay){var o=overlayers;if(overlay instanceof iD.Icon)o.icon=iD.util.arrayRemove(overlay,o.icon);else if(overlay instanceof iD.Polygon)o.polygon=iD.util.arrayRemove(overlay,o.polygon)};map.cleanOverlays=function(){var overlayers=this.getOverlays();for(var type in overlayers){var os=overlayers[type];for(var i in os)this.removeOverlays(os[i])}drawOverlayers();isDraw=false};var markerIcon=iD.svg.OverviewMarkerIcon(roundedProjection,context),polygon=iD.svg.Polygon(projection,context,"overview"),overlayers={marker:[],polyline:[],polygon:[],circle:[],icon:[]};function drawOverlayers(){surface&&surface.call(markerIcon,overlayers.icon,d3.functor(true));surface&&surface.call(polygon,context.graph(),overlayers.polygon,d3.functor(true))}return d3.rebind(map,dispatch,"on")};iD.OverView=function iD_OverView(map,opt){if(!(this instanceof iD_OverView)){return new iD_OverView().initialize(map,opt)}else if(arguments.length){this.initialize(map,opt)}this.graphType="overview"};_.extend(iD.OverView.prototype,{type:"overview",initialize:function(map,opt){this.map=map;this.opt=opt},open:function(){if(!this.map)return;var context=this.map.getContext(),that=this;var tt=setInterval(function(){if(context.overview_isBand){clearInterval(tt);context.event.openoverview(that.opt)}},50)},flush:function(opt){if(!this.map)return;this.opt=opt;var context=this.map.getContext();var overview=context.overview();overview.cleanOverlays();overview.init(opt);context.event.openoverview(opt)},close:function(){if(!this.map)return;this.map.getContext().event.closeoverview()}});;;iD.OverviewBackground=function(context,projection,tilelayer){var dispatch=d3.dispatch("overview_change"),baseLayer=iD.TileLayer(context).projection(projection);var source;if(tilelayer){source=iD.BackgroundSource(tilelayer)}else{source=iD.BackgroundSource({url:"",zooms:[0,20]})}function background(selection){var base=selection.selectAll(".overview-background-layer").data([0]);base.enter().insert("div",".overview-layer-data").attr("class","overview-layer-layer overview-background-layer").attr("style","z-Index: 100");base.call(baseLayer);base.exit().remove()}background.dimensions=function(_){baseLayer.dimensions(_)};background.baseLayerSource=function(d){if(!arguments.length)return baseLayer.source();baseLayer.source(d);dispatch.overview_change();return background};background.init=function(){background.baseLayerSource(source)};background.init();return d3.rebind(background,dispatch,"on")};;;iD.svg={RoundProjection:function(projection){return function(d){return iD.geo.roundCoords(projection(d))}},PointTransform:function(projection){return function(entity){var pt=projection(entity.loc);return"translate("+pt[0]+","+pt[1]+")"}},PointTransformOffset:function(projection){return function(entity){var pt=projection(entity.loc);var x=pt[0]+(entity.offset[0]||0);var y=pt[1]+(entity.offset[1]||0);return"translate("+pt[0]+","+pt[1]+")"}},Round:function(){return d3.geo.transform({point:function(x,y){return this.stream.point(Math.floor(x),Math.floor(y))}})},Path:function(projection,graph,polygon){var cache={},round=iD.svg.Round().stream,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return polygon?project(round(output)):project(clip(round(output)))}});return function(entity){if(entity.id in cache){return cache[entity.id]}else{return cache[entity.id]=path(entity.asGeoJSON(graph))}}},PathThumbnail:function(projection,graph,polygon){var cache={},geoCache={},round=iD.svg.Round().stream,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return polygon?project(round(output)):project(clip(round(output)))}});var angleCache={},angleList=[];var lineCal=iD.util.LineCalCulate(),minAngle=20;function getFirstCoords(entity,coords,selectedNode){if(_.first(entity.nodes)==selectedNode){return coords.slice(0,2)}else if(_.last(entity.nodes)==selectedNode){var arr=coords.slice(entity.nodes.length-2,entity.nodes.length-1);arr.reverse();return arr}return coords}return function(entitys,selectedNode){if(polygon){entitys.forEach(function(entity){cache[entity.id]=path(entity.asGeoJSON(graph))});return cache}var fentity=entitys[0];if(1===entitys.length){var geo=fentity.asGeoJSON(graph);geoCache[fentity.id]=geo;cache[fentity.id]=path(geo);return cache}var baseIndex=0;entitys.forEach(function(entity){var nodes=graph.childNodes(entity);var angle=lineCal.getAngle(nodes[0].loc[0],nodes[0].loc[1],nodes[1].loc[0],nodes[1].loc[1]);if(360<=angle)angle=0;angleCache[entity.id]=angle;angleList.push([entity,angle])});angleList=angleList.sort(function(d1,d2){return d1[1]-d2[1]});angleList.forEach(function(d,idx){if(d[0].id==fentity.id)baseIndex=idx});var resultList={};var count=1;for(let i=baseIndex;i<angleList.length-1;i++){let nowMinAngle=minAngle*count;if(360<nowMinAngle)nowMinAngle=0;let entity=angleList[i][0];let angle=angleList[i][1];let nextEntity=angleList[i+1][0];let nextAngle=angleList[i+1][1];if(nextAngle-angle<nowMinAngle){let newAngle=angle+nowMinAngle;if(360<=newAngle){newAngle-=360}if(i==angleList.length-2&&0==baseIndex){let baseAngle=angleList[baseIndex][1];if(Math.abs(baseAngle-newAngle)<nowMinAngle){let diff=baseAngle-angle;if(0>diff)diff+=360;newAngle=diff/2}}resultList[nextEntity.id]={entity:nextEntity,angle:nextAngle,newAngle:newAngle};count++}}count=1;for(let i=baseIndex;0<i;i--){let nowMinAngle=minAngle*count;if(360<nowMinAngle)nowMinAngle=0;let entity=angleList[i][0];let angle=angleList[i][1];let prevEntity=angleList[i-1][0];let prevAngle=angleList[i-1][1];if(angle-prevAngle<nowMinAngle){let newAngle=angle-nowMinAngle;if(0>newAngle){newAngle+=360}resultList[prevEntity.id]={entity:prevEntity,angle:prevAngle,newAngle:newAngle};count++}}for(let i=0;i<entitys.length;i++){var entity=entitys[i];var item=resultList[entity.id];var geo=entity.asGeoJSON(graph);geo=geoCache[entity.id]||_.clone(geo);if(!geoCache[entity.id]){geo.coordinates=getFirstCoords(entity,geo.coordinates,selectedNode)}if(item){let newAngle=item.newAngle;let distance=iD.util.distanceByLngLat(geo.coordinates[0],geo.coordinates[1]);let lonlat=lineCal.calculateVerticalP(geo.coordinates[0][0],geo.coordinates[0][1],distance/1000,newAngle);geo.coordinates[1]=[lonlat.Longitude,lonlat.Latitude,geo.coordinates[1][2]]}geoCache[entity.id]=geo;cache[entity.id]=path(geo)}return cache;return cache}},GeoJsonPath:function(projection,polygon){var cache={},round=iD.svg.Round().stream,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return polygon?project(round(output)):project(clip(round(output)))}});return function(entity){return path(entity.geometry)}},OneWaySegments:function(projection,graph,dt){return function(entity){let wayNodes=[];try{wayNodes=graph.childNodes(entity)}catch(e){wayNodes=entity.getNodes&&entity.getNodes()||entity.nodes||[]}var a,b,i=0,offset=dt,segments=[],viewport=iD.geo.Extent(projection.clipExtent()),coordinates=wayNodes.map(function(n){return n.loc});if(entity.tags&&"3"===entity.tags.DIRECTION)coordinates.reverse();d3.geo.stream({type:"LineString",coordinates:coordinates},projection.stream({lineStart:function(){},lineEnd:function(){a=null},point:function(x,y){b=[x,y];if(a){var extent=iD.geo.Extent(a).extend(b),span=iD.geo.euclideanDistance(a,b)-offset;if(extent.intersects(viewport)&&0<=span){var angle=Math.atan2(b[1]-a[1],b[0]-a[0]),dx=dt*Math.cos(angle),dy=dt*Math.sin(angle),p=[a[0]+offset*Math.cos(angle),a[1]+offset*Math.sin(angle)];var segment="M"+a[0]+","+a[1]+"L"+p[0]+","+p[1];for(span-=dt;0<=span;span-=dt){p[0]+=dx;p[1]+=dy;segment+="L"+p[0]+","+p[1]}segment+="L"+b[0]+","+b[1];segments.push({id:entity.id,index:i,d:segment})}offset=-span;i++}a=b}}));return segments}},OneWalkLinkSegments:function(projection,graph,dt){return function(entity){var a,b,i=0,offset=dt,segments=[],viewport=iD.geo.Extent(projection.clipExtent()),coordinates=graph.childNodes(entity).map(function(n){return n.loc});d3.geo.stream({type:"LineString",coordinates:coordinates},projection.stream({lineStart:function(){},lineEnd:function(){a=null},point:function(x,y){b=[x,y];if(a){var extent=iD.geo.Extent(a).extend(b),span=iD.geo.euclideanDistance(a,b)-offset;if(extent.intersects(viewport)&&0<=span){var angle=Math.atan2(b[1]-a[1],b[0]-a[0]),dx=dt*Math.cos(angle),dy=dt*Math.sin(angle),p=[a[0]+offset*Math.cos(angle),a[1]+offset*Math.sin(angle)];var segment="M"+a[0]+","+a[1]+"L"+p[0]+","+p[1];for(span-=dt;0<=span;span-=dt){p[0]+=dx;p[1]+=dy;segment+="L"+p[0]+","+p[1]}segment+="L"+b[0]+","+b[1];segments.push({id:entity.id,index:i,d:segment})}offset=-span;i++}a=b}}));return segments}},OneWayTurnguidanceSegments:function(projection,graph,dt,nodeLoc,flag){return function(entity){var a,b,i=0,offset=dt,segments=[],viewport=iD.geo.Extent(projection.clipExtent()),coordinates=graph.childNodes(entity).map(function(n){return n.loc});if("1"==flag){if(coordinates[0][0]==nodeLoc[0]&&coordinates[0][1]==nodeLoc[1]){coordinates.reverse()}}else if("0"==flag){if(coordinates[coordinates.length-1][0]==nodeLoc[0]&&coordinates[coordinates.length-1][1]==nodeLoc[1]){coordinates.reverse()}}d3.geo.stream({type:"LineString",coordinates:coordinates},projection.stream({lineStart:function(){},lineEnd:function(){a=null},point:function(x,y){b=[x,y];if(a){var extent=iD.geo.Extent(a).extend(b),span=iD.geo.euclideanDistance(a,b)-offset;if(extent.intersects(viewport)&&0<=span){var angle=Math.atan2(b[1]-a[1],b[0]-a[0]),dx=dt*Math.cos(angle),dy=dt*Math.sin(angle),p=[a[0]+offset*Math.cos(angle),a[1]+offset*Math.sin(angle)];var segment="M"+a[0]+","+a[1]+"L"+p[0]+","+p[1];for(span-=dt;0<=span;span-=dt){p[0]+=dx;p[1]+=dy;segment+="L"+p[0]+","+p[1]}segment+="L"+b[0]+","+b[1];segments.push({id:entity.id,index:i,d:segment})}offset=-span;i++}a=b}}));return segments}},OneWayStopSegments:function(projection,graph,dt){return function(entity){var a,b,i=0,offset=dt,segments=[],coordinates=graph.childNodes(entity).map(function(n){return n.loc});d3.geo.stream({type:"LineString",coordinates:coordinates},projection.stream({lineStart:function(){},lineEnd:function(){a=null},point:function(x,y){b=[x,y];if(a){var span=iD.geo.euclideanDistance(a,b)/2;if(0<=span&&25<=span){a[0]=parseInt(a[0]);b[0]=parseInt(b[0]);a[1]=parseInt(a[1]);b[1]=parseInt(b[1]);var angle=Math.atan2(b[1]-a[1],b[0]-a[0]),p=[parseInt(a[0]+span*Math.cos(angle)),parseInt(a[1]+span*Math.sin(angle))];var segment="M"+a[0]+","+a[1]+"L"+p[0]+","+p[1];segment+="L"+b[0]+","+b[1];segments.push({id:entity.id,index:i,d:segment})}i++}a=b}}));return segments}},MultipolygonMemberTags:function(graph){return function(entity){var tags=entity.tags;graph.parentRelations(entity).forEach(function(relation){if(relation.isMultipolygon&&relation.isMultipolygon()){tags=_.extend({},relation.tags,tags)}});return tags}}};;;iD.svg.Areas=function(projection){var patterns={wetland:"wetland",beach:"beach",scrub:"scrub",construction:"construction",military:"construction",cemetery:"cemetery",grave_yard:"cemetery",meadow:"meadow",farm:"farmland",farmland:"farmland",orchard:"orchard"};var patternKeys=["landuse","natural","amenity"];var clipped=["residential","commercial","retail","industrial"];function clip(entity){return-1!==clipped.indexOf(entity.tags.landuse)}function setPattern(d){for(var i=0;i<patternKeys.length;i++){if(patterns.hasOwnProperty(d.tags[patternKeys[i]])){this.style.fill="url(\"#pattern-"+patterns[d.tags[patternKeys[i]]]+"\")";return}}this.style.fill=""}return function drawAreas(surface,graph,entities,filter){var path=iD.svg.Path(projection,graph,true),areas={},multipolygon;for(var i=0;i<entities.length;i++){var entity=entities[i];if("area"!==entity.geometry(graph))continue;multipolygon=iD.geo.isSimpleMultipolygonOuterMember(entity,graph);if(multipolygon){areas[multipolygon.id]={entity:multipolygon.mergeTags(entity.tags),area:Math.abs(entity.area(graph))}}else if(!areas[entity.id]){areas[entity.id]={entity:entity,area:Math.abs(entity.area(graph))}}}areas=d3.values(areas).filter(function hasPath(a){return path(a.entity)});areas.sort(function areaSort(a,b){return b.area-a.area});areas=_.pluck(areas,"entity");var strokes=areas.filter(function(area){return"way"===area.type});var data={clip:areas.filter(clip),shadow:strokes,stroke:strokes,fill:areas};var clipPaths=surface.selectAll("defs").selectAll(".clipPath").filter(filter).data(data.clip,iD.Entity.key);clipPaths.enter().append("clipPath").attr("class","clipPath").attr("id",function(entity){return entity.id+"-clippath"}).append("path");clipPaths.selectAll("path").attr("d",path);clipPaths.exit().remove();var areagroup=surface.select(".layer-areas").selectAll("g.areagroup").data(["fill","shadow","stroke"]);areagroup.enter().append("g").attr("class",function(d){return"layer areagroup area-"+d});var paths=areagroup.selectAll("path").filter(filter).data(function(layer){return data[layer]},iD.Entity.key);var fills=areagroup.selectAll(".area-fill path.area")[0];var bisect=d3.bisector(function(node){return-node.__data__.area(graph)}).left;function sortedByArea(entity){if("fill"===this.__data__){return fills[bisect(fills,-entity.area(graph))]}}paths.enter().insert("path",sortedByArea).each(function(entity){var layer=this.parentNode.__data__;if("stroke"===layer){var lay=iD.Layers.getLayer(entity.layerId);if(lay.style){d3.select(this).style(lay.style)}lay.onDraw&&lay.onDraw.call(this,d3.select(this),entity)}this.setAttribute("class",entity.type+" area "+(iD.Layers.getLayer(entity.layerId).isTF?"":layer)+" "+entity.id);if("fill"===layer&&clip(entity)){this.setAttribute("clip-path","url(#"+entity.id+"-clippath)")}if("fill"===layer){setPattern.apply(this,arguments)}});paths.attr("d",path);paths.classed("area-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});paths.exit().remove();areagroup.exit().remove()}};iD.svg.Polygon=function(projection,context,mapType){var patterns={wetland:"wetland",beach:"beach",scrub:"scrub",construction:"construction",military:"construction",cemetery:"cemetery",grave_yard:"cemetery",meadow:"meadow",farm:"farmland",farmland:"farmland",orchard:"orchard"};var patternKeys=["landuse","natural","amenity"];var clipped=["residential","commercial","retail","industrial"];function clip(entity){return-1!==clipped.indexOf(entity.tags.landuse)}function setPattern(d){for(var i=0;i<patternKeys.length;i++){if(patterns.hasOwnProperty(d.tags[patternKeys[i]])){this.style.fill="url(\"#pattern-"+patterns[d.tags[patternKeys[i]]]+"\")";return}}this.style.fill=""}return function drawAreas(surface,graph,entities,filter){var path=iD.svg.Path(projection,graph,true),areas={},multipolygon;for(var i=0;i<entities.length;i++){var entity=entities[i];multipolygon=iD.geo.isSimpleMultipolygonOuterMember(entity,graph);if(multipolygon){areas[multipolygon.id]={entity:multipolygon.mergeTags(entity.tags),area:Math.abs(entity.area(graph))}}else if(!areas[entity.id]){areas[entity.id]={entity:entity,area:Math.abs(entity.area(graph))}}}areas=d3.values(areas).filter(function hasPath(a){return path(a.entity)});areas.sort(function areaSort(a,b){return b.area-a.area});areas=_.pluck(areas,"entity");var strokes=areas.filter(function(area){return true});var data={clip:areas.filter(clip),shadow:strokes,stroke:strokes,fill:areas};var clipPaths=surface.selectAll("defs").selectAll(".clipPath").filter(filter).data(data.clip,iD.Entity.key);clipPaths.enter().append("clipPath").attr("class","clipPath").attr("id",function(entity){return entity.id+"-clippath"}).append("path");clipPaths.selectAll("path").attr("d",path);clipPaths.exit().remove();var areagroup=surface.select(!mapType?".layer-polygon":"."+mapType+"-layer-polygon").selectAll("g.polygongroup").data(["fill","shadow","stroke"]);areagroup.enter().append("g").attr("class",function(d){return"layer polygongroup area-"+d});var paths=areagroup.selectAll("path").filter(filter).data(function(layer){return data[layer]},iD.Entity.key);paths.exit().remove();var fills=areagroup.selectAll(".polygon-fill path.polygon")[0];var bisect=d3.bisector(function(node){return-node.__data__.area(graph)}).left;function sortedByArea(entity){if("fill"===this.__data__){return fills[bisect(fills,-entity.area(graph))]}}paths.enter().insert("path",sortedByArea).each(function(entity){var layer=this.parentNode.__data__;if("stroke"===layer){entity.style&&d3.select(this).style(entity.style);entity.onDraw&&entity.onDraw.call(this,d3.select(this),entity)}this.setAttribute("class",entity.type+(!mapType?" area ":" ")+layer+" "+entity.id);if("fill"===layer&&clip(entity)){this.setAttribute("clip-path","url(#"+entity.id+"-clippath)")}if("fill"===layer){setPattern.apply(this,arguments)}});paths.attr("d",path);paths.classed("area-hidden",function(d){return d.display?true:false})}};;;iD.svg.Defs=function(context){function autosize(image){var img=document.createElement("img");img.src=image.attr("xlink:href");img.onload=function(){image.attr({width:img.width,height:img.height})}}function SpriteDefinition(id,href,data){return function(defs){defs.append("image").attr("id",id).attr("xlink:href",href).call(autosize);defs.selectAll().data(data).enter().append("use").attr("id",function(d){return d.key}).attr("transform",function(d){return"translate(-"+d.value[0]+",-"+d.value[1]+")"}).attr("xlink:href","#"+id)}}return function(selection){var defs=selection.append("defs");defs.append("marker").attr({id:"oneway-marker",viewBox:"0 0 10 10",refY:2.5,refX:5,markerWidth:2,markerHeight:2,orient:"auto"}).append("path").attr("d","M 5 3 L 0 3 L 0 2 L 5 2 L 5 0 L 10 2.5 L 5 5 z");defs.append("marker").attr({id:"dvr-oneway-marker",viewBox:"0 0 10 10",refY:2.5,refX:5,markerWidth:2,markerHeight:2,orient:"auto"}).append("path").attr("d","M 5 3 L 0 3 L 0 2 L 5 2 L 5 0 L 10 2.5 L 5 5 z");defs.append("marker").attr({id:"oneway-stop",viewBox:"0 0 30 30",refY:10.5,refX:10.5,markerWidth:5,markerHeight:5,orient:"auto"}).append("path").attr("d","M 10, 10 m -7.5, 0 a 7.5,7.5 0 1,0 15,0 a 7.5,7.5 0 1,0 -15,0");defs.append("marker").attr({id:"oneway-stop-secondary",viewBox:"0 0 10 10",refY:4,refX:3.8,markerWidth:3,markerHeight:3,orient:"auto"}).append("path").attr("d","M 0 2 L 0 5 L 7 5 L 7 2 z");var patterns=defs.selectAll("pattern").data([["wetland","wetland"],["construction","construction"],["cemetery","cemetery"],["orchard","orchard"],["farmland","farmland"],["beach","dots"],["scrub","dots"],["meadow","dots"]]).enter().append("pattern").attr({id:function(d){return"pattern-"+d[0]},width:32,height:32,patternUnits:"userSpaceOnUse"});patterns.append("rect").attr({x:0,y:0,width:32,height:32,class:function(d){return"pattern-color-"+d[0]}});patterns.append("image").attr({x:0,y:0,width:32,height:32}).attr("xlink:href",function(d){return context.imagePath("pattern/"+d[1]+".png")});defs.selectAll().data([12,18,20,32,45]).enter().append("clipPath").attr("id",function(d){return"clip-square-"+d}).append("rect").attr("x",0).attr("y",0).attr("width",function(d){return d}).attr("height",function(d){return d});var maki=[];_.forEach(iD.data.featureIcons,function(dimensions,name){if(dimensions["12"]&&dimensions["18"]&&dimensions["24"]){maki.push({key:"maki-"+name+"-12",value:dimensions["12"]});maki.push({key:"maki-"+name+"-18",value:dimensions["18"]});maki.push({key:"maki-"+name+"-24",value:dimensions["24"]})}});defs.call(SpriteDefinition("sprite",context.imagePath("sprite.png"),d3.entries(iD.data.operations)));defs.call(SpriteDefinition("maki-sprite",context.imagePath("maki-sprite.png"),maki))}};;;iD.svg.Labels=function(projection,context){var path=d3.geo.path().projection(projection);var default_size=12;var iconSize=18;var pointOffsets=[[15,0,"start"],[10,-11,"start"],[-15,-11,"end"]];var lineOffsets=[50,45,55,40,60,35,65,30,70,25,75,20,80,15,95,10,90,5,95];function displayName(entity){var fieldKey="";if(entity instanceof iD.Node&&(entity.modelName==iD.data.DataType.ROAD_NODE||entity.modelName==iD.data.Constant.C_NODE||entity.modelName==iD.data.DataType.WALKENTER)&&null!=d3.select("#effects-nodeID")[0][0]&&true==d3.select("#effects-nodeID").classed("active")){if(context.variable.nodeLabel){return entity.id.slice(entity.id.indexOf("_")+1)}}if(entity instanceof iD.Way&&!entity.isOneRoadCrossWay()&&null!=d3.select("#effects-roadID")[0][0]&&true==d3.select("#effects-roadID").classed("active")){if(context.variable.roadLabel){return entity.id.slice(entity.id.indexOf("_")+1)}return entity.tags[fieldKey]||entity.tags.name}if(entity instanceof iD.Node&&_.include([iD.data.DataType.LAMPPOST,iD.data.DataType.OBJECT_PT,iD.data.DataType.TRAFFICLIGHT,iD.data.DataType.LIMITHEIGHT],entity.modelName)){if(_.include([iD.data.DataType.TRAFFICLIGHT,iD.data.DataType.LIMITHEIGHT],entity.modelName)){return iD.labels.labelSourceName(entity.modelName)}return iD.labels.labelSourceName(entity.modelName,["TYPE",entity.tags.TYPE])}return entity.tags[fieldKey]||entity.tags.name}function get(array,prop){return function(d,i){return array[i][prop]}}var textWidthCache={};function textWidth(text,size,elem){var c=textWidthCache[size];if(!c)c=textWidthCache[size]={};if(c[text]){return c[text]}else if(elem){c[text]=elem.getComputedTextLength();return c[text]}else{var str=encodeURIComponent(text).match(/%[CDEFcdef]/g);if(null===str){return 2*(size/3)*text.length}else{return size/3*(2*text.length+str.length)}}}function setLabelStyle(d,key){var value=iD.Layers.getLayer(d.layerId).label&&iD.Layers.getLayer(d.layerId).label[key];if(value){return value+("fontSize"===key?"px":"")}}function drawLineLabels(group,entities,filter,classes,labels,effectList){var texts=group.selectAll("text."+classes).filter(filter).data(entities,iD.Entity.key);texts.enter().append("text").attr("class",function(d,i){return classes+" "+labels[i].classes+" "+d.id}).append("textPath").attr("class","textpath");texts.selectAll(".textpath").filter(filter).data(entities,iD.Entity.key).attr({startOffset:"50%","xlink:href":function(d){return"#labelpath-"+d.id}}).text(function(d,i){if(effectList[i]){return effectList[i].value}return displayName.call(this,d)});texts.classed("linelabel-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});texts.style("fill",function(d){return setLabelStyle(d,"fill")});texts.style("font-size",function(d){return setLabelStyle(d,"fontSize")});texts.exit().remove()}function drawLinePaths(group,entities,filter,classes,labels){var halos=group.selectAll("path").filter(filter).data(entities,iD.Entity.key);halos.enter().append("path").style("stroke-width",get(labels,"font-size")).attr("id",function(d){return"labelpath-"+d.id}).attr("class",classes);halos.attr("d",get(labels,"lineString"));halos.exit().remove()}function drawPointLabels(group,entities,filter,classes,labels,effectList){var texts=group.selectAll("text."+classes).filter(filter).data(entities,iD.Entity.key);texts.enter().append("text").attr("class",function(d,i){return classes+" "+labels[i].classes+" "+d.id});texts.attr("x",get(labels,"x")).attr("y",get(labels,"y")).style("text-anchor",get(labels,"textAnchor")).text(function(d,i){if(effectList[i]){return effectList[i].value}return displayName(d)}).each(function(d,i){var text="";if(effectList[i]){text=effectList[i].value}else{text=displayName(d)}textWidth(text,labels[i].height,this)});texts.classed("pointlabel-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});texts.style("fill",function(d){return setLabelStyle(d,"fill")});texts.style("font-size",function(d){return setLabelStyle(d,"fontSize")});texts.exit().remove();return texts}function drawAreaLabels(group,entities,filter,classes,labels,effectList){entities=entities.filter(hasText);labels=labels.filter(hasText);return drawPointLabels(group,entities,filter,classes,labels,effectList);function hasText(d,i){return labels[i].hasOwnProperty("x")&&labels[i].hasOwnProperty("y")}}function reverse(p){var angle=Math.atan2(p[1][1]-p[0][1],p[1][0]-p[0][0]);return!(p[0][0]<p[p.length-1][0]&&angle<Math.PI/2&&angle>-Math.PI/2)}function lineString(nodes){return"M"+nodes.join("L")}function subpath(nodes,from,to){function segmentLength(i){var dx=nodes[i][0]-nodes[i+1][0];var dy=nodes[i][1]-nodes[i+1][1];return Math.sqrt(dx*dx+dy*dy)}var sofar=0,start,end,i0,i1;for(var i=0;i<nodes.length-1;i++){var current=segmentLength(i);var portion;if(!start&&sofar+current>=from){portion=(from-sofar)/current;start=[nodes[i][0]+portion*(nodes[i+1][0]-nodes[i][0]),nodes[i][1]+portion*(nodes[i+1][1]-nodes[i][1])];i0=i+1}if(!end&&sofar+current>=to){portion=(to-sofar)/current;end=[nodes[i][0]+portion*(nodes[i+1][0]-nodes[i][0]),nodes[i][1]+portion*(nodes[i+1][1]-nodes[i][1])];i1=i+1}sofar+=current}var ret=nodes.slice(i0,i1);ret.unshift(start);ret.push(end);return ret}function initLabelStack(){var stack=[];context.layers().getLayers().forEach(function(item){stack.push([item.type,item.label&&item.label.fieldKey||"name_chn"])});return stack}var rtree=rbush(),rectangles={};function labels(surface,graph,entities,filter,dimensions,fullRedraw){var hidePoints=!surface.select(".node.point").node();label_stack=[["road","name_chn"],["area","name_chn"],["point","TYPE"],["vertex","name_chn"]];if(context.variable.roadLabel){label_stack=[["road","id"],["area","name_chn"],["point","name_chn"],["vertex","name_chn"]]}else if(context.variable.nodeLabel){label_stack=[["vertex","id"],["road","name_chn"],["area","name_chn"],["point","name_chn"]]}var labelable=[],i,k,entity;for(i=0;i<label_stack.length;i++)labelable.push([]);var effect;if(fullRedraw){rtree.clear();rectangles={}}else{for(i=0;i<entities.length;i++){rtree.remove(rectangles[entities[i].id])}}var effectValList=[];for(i=0;i<entities.length;i++){entity=entities[i];var labelFilter=iD.labels.effectEntityFilter.get(entity.modelName);var layerInfo=iD.Layers.getLayer(entity.layerId);if(!labelFilter&&layerInfo&&layerInfo.label){if(layerInfo.label.displayMap){if(!layerInfo.label.displayMap[entity.modelName]){continue}}else if(!layerInfo.label.display){continue}}var geometry=entity.geometry(graph);var obj=labelFilter&&labelFilter(entity);if(obj){obj.entity=entity;obj.value=null==obj.value?"":obj.value;effectValList.push(obj)}let displayNameStr=displayName(entity);if(!displayNameStr)continue;for(k=0;k<label_stack.length;k++){if(geometry!=label_stack[k][0]){continue}if(displayNameStr){labelable[k].push(entity);break}}}function filterDisplayEntity(){var result=false;if(_.include([iD.data.DataType.LAMPPOST,iD.data.DataType.OBJECT_PT,iD.data.DataType.TRAFFICLIGHT,iD.data.DataType.LIMITHEIGHT],entity.modelName)){result=true}return result}var positions={point:[],line:[],area:[],vertex:[]};var labelled={point:[],line:[],area:[],vertex:[]};var effeced={point:[],line:[],area:[],vertex:[]};var fieldList=[].concat(effectValList);for(k=0;k<labelable.length;k++){for(i=0;i<labelable[k].length;i++){entity=labelable[k][i];name=displayName(entity);if(!name)continue;fieldList.push({entity:entity,name:label_stack[k][1],value:name,isold:true})}}for(var item of fieldList){entity=item.entity;var layerInfo=iD.Layers.getLayer(entity.layerId),font_size=layerInfo.label&&layerInfo.label.fontSize||default_size,name=item.value,width=name&&textWidth(name,font_size),p;if("point"===entity.geometry(graph)||"vertex"===entity.geometry(graph)){p=getPointLabel(entity,width,font_size)}else if("line"===entity.geometry(graph)){p=getLineLabel(entity,width,font_size)}else if("area"===entity.geometry(graph)){p=getAreaLabel(entity,width,font_size)}if(p){p.classes=entity.geometry(graph)+" tag-"+item.name;positions[entity.geometry(graph)].push(p);labelled[entity.geometry(graph)].push(entity);!item.isold&&effeced[entity.geometry(graph)].push(item)}}function getPointLabel(entity,width,height){var coord=projection(entity.loc),m=5,offset=pointOffsets[0],p={height:height,width:width,x:coord[0]+offset[0],y:coord[1]+offset[1],textAnchor:offset[2]};var rect=[p.x-m,p.y-m,p.x+width+m,p.y+height+m];if(tryInsert(rect,entity.id))return p}function getLineLabel(entity,width,height){var nodes=_.pluck(graph.childNodes(entity),"loc").map(projection),length=iD.geo.pathLength(nodes);if(length<width+20)return;for(var i=0;i<lineOffsets.length;i++){var offset=lineOffsets[i],middle=offset/100*length,start=middle-width/2;if(0>start||start+width>length)continue;var sub=subpath(nodes,start,start+width),rev=reverse(sub),rect=[Math.min(sub[0][0],sub[sub.length-1][0])-10,Math.min(sub[0][1],sub[sub.length-1][1])-10,Math.max(sub[0][0],sub[sub.length-1][0])+20,Math.max(sub[0][1],sub[sub.length-1][1])+30];if(rev)sub=sub.reverse();if(tryInsert(rect,entity.id))return{"font-size":height+2,lineString:lineString(sub),startOffset:offset+"%"}}}function getAreaLabel(entity,width,height){var centroid=path.centroid(entity.asGeoJSON(graph,true)),extent=entity.extent(graph),entitywidth=projection(extent[1])[0]-projection(extent[0])[0],rect;if(!centroid||20>entitywidth)return;var iconX=centroid[0]-iconSize/2,iconY=centroid[1]-iconSize/2,textOffset=iconSize+5;var p={transform:"translate("+iconX+","+iconY+")"};if(width&&entitywidth>=width+20){p.x=centroid[0];p.y=centroid[1]+textOffset;p.textAnchor="middle";p.height=height;rect=[p.x-width/2,p.y,p.x+width/2,p.y+height+textOffset]}else{rect=[iconX,iconY,iconX+iconSize,iconY+iconSize]}if(tryInsert(rect,entity.id))return p}function tryInsert(rect,id){if(0>rect[0]||0>rect[1]||rect[2]>dimensions[0]||rect[3]>dimensions[1])return false;var v=0===rtree.search(rect).length;if(v){rect.id=id;rtree.insert(rect);rectangles[id]=rect}return v}var label=surface.select(".layer-label"),halo=surface.select(".layer-halo");drawPointLabels(label,labelled.point,filter,"pointlabel",positions.point,effeced.point);drawPointLabels(halo,labelled.point,filter,"pointlabel-halo",positions.point,effeced.point);drawPointLabels(label,labelled.vertex,filter,"vetexlabel",positions.vertex,effeced.vertex);drawPointLabels(halo,labelled.vertex,filter,"vetexlabel-halo",positions.vertex,effeced.vertex);drawLinePaths(halo,labelled.line,filter,"",positions.line);drawLineLabels(label,labelled.line,filter,"linelabel",positions.line,effeced.line);drawLineLabels(halo,labelled.line,filter,"linelabel-halo",positions.line,effeced.line);drawAreaLabels(label,labelled.area,filter,"arealabel",positions.area,effeced.area);drawAreaLabels(halo,labelled.area,filter,"arealabel-halo",positions.area,effeced.area)}return labels};;;iD.svg.Lines=function(projection,context){var highway_stack={motorway:0,motorway_link:1,trunk:2,trunk_link:3,primary:4,primary_link:5,secondary:6,tertiary:7,unclassified:8,residential:9,service:10,footway:11};function waystack(a,b){var as=0,bs=0;if(a.isOneRoadCrossWay())return 1;if(b.isOneRoadCrossWay())return-1;if("uplink"===b._zleveltype)return 2;if("dnlink"===b._zleveltype)return 3;if(a.tags.highway){as-=highway_stack[a.tags.highway]}if(b.tags.highway){bs-=highway_stack[b.tags.highway]}return as-bs}return function drawLines(surface,graph,entities,filter,thumParam){var ways=[],pathdata={},onewaydata={},onewaystopdata={},getPath;thumParam=thumParam||{};if(thumParam.isThumbnail){getPath=iD.svg.PathThumbnail(projection,graph)}else{getPath=iD.svg.Path(projection,graph)}for(var i=0;i<entities.length;i++){var entity=entities[i],outer=iD.geo.simpleMultipolygonOuterMember(entity,graph);if(outer){ways.push(entity.mergeTags(outer.tags))}else if("line"===entity.geometry(graph)&&entity.modelName!=iD.data.DataType.WALKLINK){ways.push(entity)}}pathdata={0:ways};var wayData=[];var stopData=[];var oneWayFun=context.variable.bicycle?iD.svg.OneWayBicycleSegments(projection,graph,240):iD.svg.OneWaySegments(projection,graph,240);var oneStopWayFun=iD.svg.OneWayStopSegments(projection,graph,240);for(var i=0;i<ways.length;i++){var d=ways[i];if(context.variable.bicycle){if(d.isOneBicycleWay()){wayData=wayData.concat(oneWayFun(d))}}else if(!context.variable.greenway){if(d.isOneWay()){wayData=wayData.concat(oneWayFun(d))}}if(d.isOneStopWay()){stopData=stopData.concat(oneStopWayFun(d))}}onewaydata={0:wayData};onewaystopdata={0:stopData};var layergroup=surface.select(".layer-lines").selectAll("g.layergroup").data(d3.range(-10,11));layergroup.enter().append("g").attr("class",function(d){return"layer layergroup layer"+String(d)});var linegroup=layergroup.selectAll("g.linegroup").data(["shadow","casing","stroke"]);linegroup.enter().append("g").attr("class",function(d){return"layer linegroup line-"+d});var lines=linegroup.selectAll("path").filter(filter).data(function(){return pathdata[this.parentNode.parentNode.__data__]||[]},iD.Entity.key);lines.enter().append("path");lines.attr("class",function(d){var lay=iD.Layers.getLayer(d.layerId);var styleClass=this.parentNode.__data__;var rod="";if("stroke"===styleClass){if(lay.style){d3.select(this).style(_.isFunction(lay.style)?lay.style(d):lay.style)}}return"way line "+rod+" "+styleClass+" "+d.id+" b_"+(lay&&lay.batch||"")}).call(iD.svg.TagClasses(),graph);if(thumParam.isThumbnail){var result=getPath(pathdata[0],thumParam.selectedID);lines.attr("d",entity=>result[entity.id]||"")}else{lines.attr("d",getPath)}lines.call(iD.svg.TagClasses().tags(iD.svg.MultipolygonMemberTags(graph)),graph);lines.classed("line-hidden",function(d){return false});lines.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup").data(["oneway"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaydata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-marker)");oneways.attr("d",function(d){return d.d});oneways.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup-stop").data(["onewaystop"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup-stop");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaystopdata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-stop)");oneways.attr("d",function(d){return d.d});oneways.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup-secondary").data(["onewaysecondary"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup-secondary");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaystopdata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-stop-secondary)");oneways.attr("d",function(d){return d.d});oneways.exit().remove()}};iD.svg.Polyline=function(projection){return function drawLines(surface,graph,entities,filter){var ways=[],pathdata={},onewaydata={},onewaystopdata={},getPath=iD.svg.Path(projection,graph);for(var i=0;i<entities.length;i++){var entity=entities[i];ways.push(entity)}ways=ways.filter(getPath);pathdata=_.groupBy(ways,function(way){return way.layer()});_.forOwn(pathdata,function(v,k){onewaydata[k]=_(v).filter(function(d){return null!=d.layer()&&d.arrow}).map(iD.svg.OneWaySegments(projection,graph,40)).flatten().valueOf()});var layergroup=surface.select(".layer-polyline").selectAll("g.layergroup").data(d3.range(-10,11));layergroup.enter().append("g").attr("class",function(d){return"layer layergroup layer"+String(d)});var linegroup=layergroup.selectAll("g.linegroup").data(["shadow","casing","stroke"]);linegroup.enter().append("g").attr("class",function(d){return"layer linegroup line-"+d});var lines=linegroup.selectAll("path").filter(filter).data(function(){return pathdata[this.parentNode.parentNode.__data__]||[]},iD.Entity.key);lines.enter().append("path");lines.attr("class",function(d){var classed=this.parentNode.__data__;if("stroke"===classed){d.style&&d3.select(this).style(d.style(d));d.onDraw&&d.onDraw.call(this,d3.select(this),d,classed)}if("casing"===classed){d.style&&d3.select(this).style(d.style(d));d.onDraw&&d.onDraw.call(this,d3.select(this),d,classed)}return"way line "+classed+" "+d.id}).call(iD.svg.TagClasses(),graph);lines.attr("d",getPath);lines.classed("line-hidden",function(d){return d.display?true:false});lines.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup").data(["oneway"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaydata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-marker)");oneways.attr("d",function(d){return d.d});oneways.exit().remove()}};;;iD.svg.Divider=function(projection,context){var highway_stack={motorway:0,motorway_link:1,trunk:2,trunk_link:3,primary:4,primary_link:5,secondary:6,tertiary:7,unclassified:8,residential:9,service:10,footway:11};function waystack(a,b){var as=0,bs=0;if(a.isOneRoadCrossWay())return 1;if(b.isOneRoadCrossWay())return-1;if("uplink"===b._zleveltype)return 2;if("dnlink"===b._zleveltype)return 3;if(a.tags.highway){as-=highway_stack[a.tags.highway]}if(b.tags.highway){bs-=highway_stack[b.tags.highway]}return as-bs}function filterSubLayer(entity){if(entity.isOneRoadCrossWay&&entity.isOneRoadCrossWay()){var nodes=entity.nodes,node1=nodes[0],node=context.graph().entity(node1);var layerInfo=node&&iD.Layers.getLayer(node.layerId),available=true;if(layerInfo){var entType=node.modelName||node._type,sublayer=layerInfo.getSubLayerByType(entType);available=sublayer&&sublayer.display}return!available}if(entity.isRoadZLevel&&entity.isRoadZLevel()){var layerInfo=entity&&iD.Layers.getLayer(entity.layerId),available=true;if(layerInfo){var entType=entity.modelName||entity._type,sublayer=layerInfo.getSubLayerByType(entType);available=sublayer&&sublayer.display}if(!available){var zlevel_member=entity.members;if(!zlevel_member.length)return;var link_up=zlevel_member[0],link_down=zlevel_member[1];if("link_up"===link_up.role)link_up=zlevel_member[0],link_down=zlevel_member[1];else link_down=zlevel_member[0],link_up=zlevel_member[1];var link_up_way=context.graph().entity(link_up.id),link_down_way=context.graph().entity(link_down.id);link_up_way.zlevel&&(link_up_way.zlevel=0);link_down_way.zlevel&&(link_down_way.zlevel=0)}}else{return false}}return function drawLines(surface,graph,entities,filter){return;var ways=[],pathdata={},onewaydata={},onewaystopdata={},getPath=iD.svg.Path(projection,graph);for(var i=0;i<entities.length;i++){var entity=entities[i],outer=iD.geo.simpleMultipolygonOuterMember(entity,graph);if(filterSubLayer(entity))continue;if(outer){ways.push(entity.mergeTags(outer.tags))}else if("line"===entity.geometry(graph)&&entity.modelName!=iD.data.DataType.WALKLINK){ways.push(entity)}}ways=ways.filter(getPath);pathdata=_.groupBy(ways,function(way){return way.layer()});_.forOwn(pathdata,function(v,k){onewaydata[k]=_(v).filter(function(d){return d.isOneWay()&&iD.Layers.getLayer(d.layerId,d.modelName).display}).map(iD.svg.OneWaySegments(projection,graph,35)).flatten().valueOf();onewaystopdata[k]=_(v).filter(function(d){return d.isOneStopWay()&&iD.Layers.getLayer(d.layerId,d.modelName).display}).map(iD.svg.OneWayStopSegments(projection,graph,80)).flatten().valueOf()});var layergroup=surface.select(".layer-dividers").selectAll("g.layergroup").data(d3.range(-10,11));layergroup.enter().append("g").attr("class",function(d){return"layer layergroup layer"+String(d)});var linegroup=layergroup.selectAll("g.linegroup").data(["shadow","casing","stroke"]);linegroup.enter().append("g").attr("class",function(d){return"layer linegroup line-"+d});var lines=linegroup.selectAll("path").filter(filter).data(function(){return pathdata[this.parentNode.parentNode.__data__]||[]},iD.Entity.key);lines.enter().append("path");lines.attr("class",function(d){var lay=iD.Layers.getLayer(d.layerId);var styleClass=this.parentNode.__data__;var rod="";if("stroke"===styleClass){if(iD.Layers.getLayer(d.layerId).isRoad()){rod="road";if(lay.style){d3.select(this).style(_.isFunction(lay.style)?lay.style(d):lay.style)}}else if(iD.Layers.getLayer(d.layerId).isLine()){if(lay.style){d3.select(this).style(_.isFunction(lay.style)?lay.style(d):lay.style)}}lay.onDraw&&lay.onDraw.call(this,d3.select(this),d,styleClass)}return"way line "+rod+" "+styleClass+" "+d.id}).call(iD.svg.TagClasses());lines.sort(waystack).attr("d",getPath).call(iD.svg.TagClasses().tags(iD.svg.MultipolygonMemberTags(graph)));lines.classed("line-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});lines.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup").data(["oneway"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaydata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-marker)");oneways.attr("d",function(d){return d.d});oneways.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup-stop").data(["onewaystop"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup-stop");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaystopdata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-stop)");oneways.attr("d",function(d){return d.d});oneways.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup-secondary").data(["onewaysecondary"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup-secondary");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaystopdata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-stop-secondary)");oneways.attr("d",function(d){return d.d});oneways.exit().remove()}};;;iD.svg.Midpoints=function(projection,context){return function drawMidpoints(surface,graph,entities,filter,extent){var poly=extent.polygon(),midpoints={};for(var i=0;i<entities.length;i++){var entity=entities[i];if("way"!==entity.type)continue;if(!filter(entity))continue;if(0>context.selectedIDs().indexOf(entity.id))continue;if(entity.modelName!=iD.data.DataType.ROAD)continue;var nodes=graph.childNodes(entity);for(var j=0;j<nodes.length-1;j++){var a=nodes[j],b=nodes[j+1],id=[a.id,b.id].sort().join("-");if(midpoints[id]){midpoints[id].parents.push(entity)}else{if(40<iD.geo.euclideanDistance(projection(a.loc),projection(b.loc))){var point=iD.geo.interp(a.loc,b.loc,0.5),loc=null;if(extent.intersects(point)){loc=point}else{for(var k=0;4>k;k++){point=iD.geo.lineIntersection([a.loc,b.loc],[poly[k],poly[k+1]]);if(point&&20<iD.geo.euclideanDistance(projection(a.loc),projection(point))&&20<iD.geo.euclideanDistance(projection(b.loc),projection(point))){loc=point;break}}}if(loc){midpoints[id]={type:"midpoint",id:id,loc:loc,edge:[a.id,b.id],parents:[entity]}}}}}}function midpointFilter(d){if(midpoints[d.id])return true;for(var i=0;i<d.parents.length;i++)if(filter(d.parents[i]))return true;return false}var groups=surface.select(".layer-hit").selectAll("g.midpoint").filter(midpointFilter).data(_.values(midpoints),function(d){return d.id});var enter=groups.enter().insert("g",":first-child").attr("class","midpoint");enter.append("circle").attr("r",7).attr("class","shadow");enter.append("circle").attr("r",3).attr("class","fill");groups.attr("transform",iD.svg.PointTransform(projection));groups.select("circle.shadow");groups.select("circle.fill");groups.exit().remove()}};;;iD.svg.Points=function(projection,context){function markerPath(selection,klass,entity){var pmname=entity.modelName;if(iD.data.DataType.ROAD_ATTRIBUTE==pmname){selection.append("path").attr("class",klass).attr("transform","translate(-9, -26)").attr("d","M 17,8 C 17,13 11,21 8.5,23.5 C 6,21 0,13 0,8 C 0,4 4,-0.5 8.5,-0.5 C 13,-0.5 17,4 17,8 z")}else if(iD.data.DataType.POI==pmname||iD.data.DataType.TEXT_MARK==pmname){selection.append("path").attr("class",klass).attr("transform","translate(-8, -23)").attr("d","M 17,8 C 17,13 11,21 8.5,23.5 C 6,21 0,13 0,8 C 0,4 4,-0.5 8.5,-0.5 C 13,-0.5 17,4 17,8 z")}else if(iD.data.DataType.JUNCTION==pmname){selection.append("circle").attr("class",klass).attr("transform","translate(0, 2)").attr("x","0").attr("y","0").attr("r","8")}else if(_.include([iD.data.DataType.LAMPPOST,iD.data.DataType.LIMITHEIGHT,iD.data.DataType.TRAFFICLIGHT],pmname)){var rectNum=15;var translateNum=-Math.ceil(rectNum/2);var translateStr="translate("+translateNum+", "+translateNum+")";selection.append("path").attr("class",klass).attr("transform",translateStr).attr("d",path({width:rectNum,height:rectNum,shape:2}));selection.append("path").attr("class","stroke").attr("transform",translateStr).attr("d",path({width:rectNum,height:rectNum,shape:2}))}else if(_.include([iD.data.DataType.OBJECT_PT],pmname)){selection.append("path").attr("class",klass).attr("transform","translate(-30, -16)").attr("d",path({shape:8}))}else if(_.include([iD.data.DataType.CHECK_TAG,iD.data.DataType.IMAGE_TAG,iD.data.DataType.ANALYSIS_TAG,iD.data.DataType.QUESTION_TAG],pmname)){selection.classed(pmname.toLowerCase(),true);selection.append("path").attr("class",klass).attr("transform","translate(-8.5, -24)").attr("d",path({shape:-1}))}}var _imgObj={roadAttribute:{icon:"dist/img/pano_marker_b.png",width:24,height:32,offsetX:-12,offsetY:-30},junction:{icon:"dist/img/roadcross-point.png",width:24,height:32,offsetX:-12,offsetY:-14}};function markerImg(selection,klass,entity){if(!entity){return}var pmname=entity.modelName;var typeName="";if(iD.data.DataType.ROAD_ATTRIBUTE==pmname){typeName="roadAttribute"}else if(iD.data.DataType.JUNCTION==pmname){typeName="junction"}var obj=_imgObj[typeName];if(!obj){return}selection.attr("class",klass).attr("transform","translate("+(obj.offsetX||0)+", "+(obj.offsetY||0)+")").attr("xlink:href",obj.icon||"").attr("width",obj.width).attr("height",obj.height)}function sortY(a,b){return b.loc[1]-a.loc[1]}function drawPoints(surface,points,filter){points=(points||[]).filter(function(d){var result=filter(d);if(!result){return result}if(_.include([iD.data.DataType.LAMPPOST,iD.data.DataType.LIMITHEIGHT,iD.data.DataType.TRAFFICLIGHT,iD.data.DataType.CHECK_TAG,iD.data.DataType.IMAGE_TAG,iD.data.DataType.OBJECT_PT,iD.data.DataType.ANALYSIS_TAG,iD.data.DataType.QUESTION_TAG],d.modelName)){result=true}return result});points.sort(sortY);var groups=surface.select(".layer-hit").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point "+d.id}).order();group.each(function(d){markerPath(d3.select(this),"shadow",d)});group.each(function(d){if(d.modelName!=iD.data.DataType.ROAD_ATTRIBUTE&&d.modelName!=iD.data.DataType.JUNCTION){markerPath(d3.select(this),"stroke",d)}});group.append("image").classed("stroke",function(d){markerImg(d3.select(this),"stroke",d);return true});groups.each(function(entity){this.setAttribute("transform",iD.svg.PointTransform(projection)(entity))}).call(iD.svg.TagClasses(),context.graph());groups.select(".shadow").attr("class",function(entity){return"shadow"});groups.select(".stroke").attr("class",function(entity){return"stroke"});groups.classed("point-hidden",function(d){return false});groups.exit().remove()}drawPoints.points=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if("point"===entity.geometry(graph)&&!entity.isRoadCross()&&!entity.isPlaceName()&&!entity.isDetailSlope()&&!entity.isWalkZlevel()&&!entity.isQcTag()){points.push(entity);if(limit&&points.length>=limit)break}}return points};function path(marker){var width=marker.width,height=marker.height,rx=width/2,ry=height/2,shape=0==marker.shape?0:marker.shape||-1,shape=parseInt(shape),r=rx,d="M 17,8 C 17,13 11,21 8.5,23.5 C 6,21 0,13 0,8 C 0,4 4,-0.5 8.5,-0.5 C 13,-0.5 17,4 17,8 z";if(0==shape)d="M"+r+",0"+" A"+r+","+r+" 0 1,0 "+-r+",0 C"+-r+","+r+" 0,"+r+" 0,"+(height-r)+" C0,"+r+" "+r+","+r+" "+r+",0 Z";if(1==shape)d="m "+0+", "+ry+"   a "+rx+","+ry+" 0 1,0 "+width+",0    a "+rx+","+ry+" 0 1,0 "+-width+",0";else if(2==shape)d="M "+0+" "+0+" L"+0+" "+height+" L"+width+" "+height+" L"+width+" "+0+" Z";else if(3==shape)d="M "+0+" "+ry+" L"+rx+" "+height+" L"+width+" "+ry+" L"+rx+" "+0+" Z";else if(4==shape)d="M 14,6 L 8,6 L 8,0 L 6,0 L 6,6 L 0,6 L 0,8 L 6,8 L 6,14 L 8,14 L 8,8 L 14,8 z";else if(5==shape)d="M 14,6 L 0,6 L 0,8 L 14,8 z";else if(6==shape)d="M13.771,0L5.794,7.907L1.53,3.286L0,4.107L3.831,9.853L3.825,9.858L5.263,12L15,1.543z";else if(7==shape)d="M4.036,10.006C4.03,9.801,4.027,9.646,4.027,9.544c0-0.604,0.085-1.125,0.256-1.564  c0.125-0.33,0.328-0.664,0.607-1c0.206-0.245,0.575-0.603,1.108-1.073c0.532-0.471,0.879-0.845,1.038-1.125  c0.16-0.279,0.24-0.584,0.24-0.915c0-0.599-0.234-1.125-0.701-1.578C6.108,1.836,5.535,1.61,4.857,1.61 c-0.656,0-1.203,0.205-1.642,0.616c-0.439,0.41-0.727,1.052-0.863,1.924L0.77,3.961c0.143-1.168,0.566-2.063,1.27-2.685 c0.704-0.621,1.635-0.932,2.792-0.932c1.226,0,2.203,0.333,2.934,1c0.729,0.667,1.094,1.474,1.094,2.42 c0,0.547-0.128,1.052-0.385,1.513C8.218,5.74,7.716,6.301,6.969,6.962C6.468,7.406,6.14,7.734,5.986,7.945 C5.832,8.156,5.718,8.398,5.644,8.672s-0.116,0.719-0.128,1.334H4.036z M3.942,13.093V11.34h1.753v1.753H3.942z";else if(8==shape)d="M23 23 A 10 10, 0, 1, 1, 23.1 23.1 L 23.1 23Z";return d}return drawPoints};iD.svg.Marker=function(projection,context){function markerPath(selection,klass){if("shadow"===klass||"stroke"===klass){selection.each(function(entity){if("stroke"===klass)this.style.fill=entity.style&&entity.style.fill||"green"})}}function sortY(a,b){return a.index||b.loc[1]-a.loc[1]}function path(marker){var width=marker.width,height=marker.height,rx=width/2,ry=height/2,shape=0==marker.shape?0:marker.shape||-1,shape=parseInt(shape),r=rx,d="M 17,8 C 17,13 11,21 8.5,23.5 C 6,21 0,13 0,8 C 0,4 4,-0.5 8.5,-0.5 C 13,-0.5 17,4 17,8 z";if(0==shape)d="M"+r+",0"+" A"+r+","+r+" 0 1,0 "+-r+",0 C"+-r+","+r+" 0,"+r+" 0,"+(height-r)+" C0,"+r+" "+r+","+r+" "+r+",0 Z";if(1==shape)d="m "+0+", "+ry+"   a "+rx+","+ry+" 0 1,0 "+width+",0    a "+rx+","+ry+" 0 1,0 "+-width+",0";else if(2==shape)d="M "+0+" "+0+" L"+0+" "+height+" L"+width+" "+height+" L"+width+" "+0+" Z";else if(3==shape)d="M "+0+" "+ry+" L"+rx+" "+height+" L"+width+" "+ry+" L"+rx+" "+0+" Z";else if(4==shape)d="M 14,6 L 8,6 L 8,0 L 6,0 L 6,6 L 0,6 L 0,8 L 6,8 L 6,14 L 8,14 L 8,8 L 14,8 z";else if(5==shape)d="M 14,6 L 0,6 L 0,8 L 14,8 z";else if(6==shape)d="M13.771,0L5.794,7.907L1.53,3.286L0,4.107L3.831,9.853L3.825,9.858L5.263,12L15,1.543z";else if(7==shape)d="M4.036,10.006C4.03,9.801,4.027,9.646,4.027,9.544c0-0.604,0.085-1.125,0.256-1.564  c0.125-0.33,0.328-0.664,0.607-1c0.206-0.245,0.575-0.603,1.108-1.073c0.532-0.471,0.879-0.845,1.038-1.125  c0.16-0.279,0.24-0.584,0.24-0.915c0-0.599-0.234-1.125-0.701-1.578C6.108,1.836,5.535,1.61,4.857,1.61 c-0.656,0-1.203,0.205-1.642,0.616c-0.439,0.41-0.727,1.052-0.863,1.924L0.77,3.961c0.143-1.168,0.566-2.063,1.27-2.685 c0.704-0.621,1.635-0.932,2.792-0.932c1.226,0,2.203,0.333,2.934,1c0.729,0.667,1.094,1.474,1.094,2.42 c0,0.547-0.128,1.052-0.385,1.513C8.218,5.74,7.716,6.301,6.969,6.962C6.468,7.406,6.14,7.734,5.986,7.945 C5.832,8.156,5.718,8.398,5.644,8.672s-0.116,0.719-0.128,1.334H4.036z M3.942,13.093V11.34h1.753v1.753H3.942z";else if(8==shape)d="M23 23 A 10 10, 0, 1, 1, 23.1 23.1 L 23.1 23Z";return d}function ____(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-marker").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point "+d.id}).order();group.append("path").call(markerPath,"shadow");group.append("path").call(markerPath,"stroke");surface.select(".layer-marker").selectAll("g.point").each(function(marker){var translate=marker.getAttribute().translate,shape=path(marker),shadow=this.childNodes[0],stroke=this.childNodes[1];shadow.setAttribute("transform",translate);stroke.setAttribute("transform",translate);shadow.setAttribute("d",shape);stroke.setAttribute("d",shape)});group.append("rect").call(function(entitys){entitys.each(function(marker){if(!marker.visible||!marker.label){this.parentNode.removeChild(this);return}var attribute=marker.getRectAttribute();this.setAttribute("transform",attribute.translate);this.setAttribute("width",attribute.width);this.setAttribute("height",attribute.height);d3.select(this).style(attribute.style)})});group.append("text").call(function(entitys){entitys.each(function(marker){if(!marker.visible||!marker.label){this.parentNode.removeChild(this);return}var attribute=marker.getTextAttribute();this.setAttribute("transform",attribute.translate);this.textContent=marker.label;d3.select(this).style(attribute.style);this.parentNode.childNodes[2].setAttribute("width",this.getComputedTextLength())})});group.append("path").call(function(entitys){entitys.each(function(marker){if(!marker["arrow-visible"]){this.parentNode.removeChild(this);return}var attribute=marker.getArrowAttribute();this.setAttribute("d","M 20 12 L 0 12 L 0 8 L 20 8 L 20 0 L 40 10 L 20 20 z");this.setAttribute("transform",attribute.translate);d3.select(this).style(attribute.style)})});groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.select(".shadow").attr("class",function(entity){entity.style&&d3.select(this).style(entity.style);entity.onDraw&&entity.onDraw.call(this,d3.select(this),entity,"shadow");return"shadow"});groups.select(".stroke").attr("class",function(entity){entity.style&&d3.select(this).style(entity.style);entity.onDraw&&entity.onDraw.call(this,d3.select(this),entity,"stroke");return"stroke"});groups.classed("point-hidden",function(d){return d.display?true:false});groups.exit().remove()}return ____};iD.svg.MarkerIcon=function(projection,context){function markerImage(selection){selection.attr("class","image").attr("xlink:href",function(d){return d.url})}function ________(surface,points,filter){var groups=surface.select(".layer-icon").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point "+d.id}).order();group.append("image").call(markerImage,"image");surface.select(".layer-icon").selectAll("g.point").each(function(icon){var node=this.childNodes[0];var x=-icon.getSizeCenter()[0]+icon.offset[0];var y=-icon.getSizeCenter()[1]+icon.offset[1];node.setAttribute("width",icon.width);node.setAttribute("height",icon.height);node.setAttribute("transform","translate("+x+", "+y+")")});group.append("rect").call(function(entitys){entitys.each(function(icon){if(!icon.visible||!icon.label){return}var attribute=icon.getRectAttribute();this.setAttribute("transform",attribute.translate);this.setAttribute("width",attribute.width);this.setAttribute("height",attribute.height);d3.select(this).style(attribute.style)})});group.append("text").call(function(entitys){entitys.each(function(icon){if(!icon.visible||!icon.label){return}var attribute=icon.getTextAttribute();this.setAttribute("transform",attribute.translate);this.textContent=icon.label;d3.select(this).style(attribute.style);this.parentNode.childNodes[1].setAttribute("width",this.getComputedTextLength())})});group.append("path").call(function(entitys){entitys.each(function(icon){if(!icon["arrow-visible"]){return}var attribute=icon.getArrowAttribute();this.setAttribute("d","M 20 12 L 0 12 L 0 8 L 20 8 L 20 0 L 40 10 L 20 20 z");this.setAttribute("transform",attribute.translate);d3.select(this).style(attribute.style)})});groups.attr("transform",iD.svg.PointTransform(projection));groups.classed("point-hidden",function(d){return d.display?true:false});groups.exit().remove()}return ________};iD.svg.PartRedraw=function(projection,context){function redraw(){}redraw.resetIcon=function(surface,points){var selector="."+points.id,groups=surface.select(".layer-icon").selectAll(selector);groups.each(function(icon){var node=this.childNodes[0];var x=-icon.getSizeCenter()[0]+icon.offset[0];var y=-icon.getSizeCenter()[1]+icon.offset[1];node.setAttribute("width",icon.width);node.setAttribute("height",icon.height);node.setAttribute("transform","translate("+x+", "+y+")");node.setAttribute("href",icon.url);if(!icon.visible||!icon.label)return;node=this.childNodes[1];var attribute=icon.getRectAttribute();node.setAttribute("transform",attribute.translate);node.setAttribute("width",attribute.width);node.setAttribute("height",attribute.height);d3.select(node).style(attribute.style);node=this.childNodes[2];var attribute=icon.getTextAttribute();node.setAttribute("transform",attribute.translate);node.textContent=icon.label;d3.select(node).style(attribute.style);this.childNodes[1].setAttribute("width",node.getComputedTextLength())});groups.attr("transform",iD.svg.PointTransform(projection))};redraw.resetMarker=function(surface,points){var selector="."+points.id,groups=surface.select(".layer-marker").selectAll(selector);groups.each(function(marker){var node=this.childNodes[0];var translate=marker.getAttribute().translate;node.setAttribute("transform",translate);marker.onDraw&&marker.onDraw.call(node,d3.select(node),marker,"shadow");node=this.childNodes[1];node.setAttribute("transform",translate);d3.select(node).style(marker.style);marker.onDraw&&marker.onDraw.call(node,d3.select(node),marker,"stroke");if(!marker.visible||!marker.label)return;node=this.childNodes[2];var attribute=marker.getRectAttribute();node.setAttribute("transform",attribute.translate);node.setAttribute("width",attribute.width);node.setAttribute("height",attribute.height);d3.select(node).style(attribute.style);node=this.childNodes[3];var attribute=marker.getTextAttribute();node.setAttribute("transform",attribute.translate);node.textContent=marker.label;d3.select(node).style(attribute.style);node=this.childNodes[4];var attribute=marker.getArrowAttribute();node.setAttribute("transform",attribute.translate);d3.select(node).style(attribute.style)});groups.attr("transform",iD.svg.PointTransform(projection))};redraw.resetPolyline=function(surface,lines){var selector="."+lines.id,getPath=iD.svg.Path(projection,context.graph());surface.select(".layer-polyline").selectAll(selector).each(function(line){this.setAttribute("d",getPath(line))})};redraw.resetPolygon=function(surface,polygons){var selector="."+polygons.id,getPath=iD.svg.Path(projection,context.graph());surface.select(".layer-polygon").selectAll(selector).each(function(polygon){this.setAttribute("d",getPath(polygon))})};return redraw};iD.svg.Label=function(projection,context){function markerPath(selection,style){if("image"==style){selection.attr("class",style).attr("x",9).attr("y",-7).attr("width",13).attr("height",13).attr("xlink:href",function(d){return context.imagePath("toolbar-close.png")})}else selection.attr("r",6).attr("stroke","red").attr("stroke-width","2").attr("fill","#FFF").attr("opacity","0.7").attr("transform","translate(0, 0)")}function drawLabel(surface,points,filter,type){var groups=surface.select(".layer-"+type).selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point "+d.id}).order();if("polylabel"==type){var rectXY=[-8,-30,9,-9];var textXY=[-3,-18,13,3];function attrW(entity){var width=10000<entity.distance?180:160;if(entity.end)width=150;return width}function attrXY(entity,l){return[entity.end?l[0]:l[2],entity.end?l[1]:l[3]]}function text(entity){var text=entity.end?"":" (\u53CC\u51FB\u7ED3\u675F)";var dis=1000>entity.distance?entity.distance+"\u7C73":(entity.distance/1000).toFixed(2)+"\u516C\u91CC";return"\u603B\u957F \uFF1A"+dis+text}group.append("rect").call(function(entitys){entitys.each(function(entity){var xy=attrXY(entity,rectXY);this.setAttribute("x",xy[0]);this.setAttribute("y",xy[1]);this.setAttribute("width",attrW(entity))})}).attr("rx","6").attr("ry","12").attr("height","17").attr("fill","#fff").attr("stroke-width",2).attr("opacity","0.7").attr("stroke","red");group.append("text").call(function(entitys){entitys.each(function(entity){var xy=attrXY(entity,textXY);this.textContent=text(entity);this.setAttribute("x",xy[0]);this.setAttribute("y",xy[1]);this.setAttribute("font-size",10);this.setAttribute("font-family","\u5FAE\u8F6F\u96C5\u9ED1");this.setAttribute("font-weight","bold");this.setAttribute("fill","#333");entity.computedTextLength=this.getComputedTextLength()})})}else if("polygonlabel"==type){var rectXY=[-8,-30,9,-9];var textXY=[-3,-18,13,3];function attrXY(entity,l){return[l[0],l[1]]}function attrText(entity){var dis=100000>entity.distance?entity.distance+"\u5E73\u65B9\u7C73":(entity.distance/1000).toFixed(1)+"\u5E73\u65B9\u516C\u91CC";return"\u603B\u9762\u79EF \uFF1A"+dis}group.append("rect").call(function(entitys){entitys.each(function(entity){var xy=attrXY(entity,rectXY);this.setAttribute("x",xy[0]);this.setAttribute("y",xy[1]);this.setAttribute("width",10*attrText(entity).length)})}).attr("rx","6").attr("ry","12").attr("height","17").attr("fill","#fff").attr("stroke-width",2).attr("opacity","0.7").attr("stroke","red");group.append("text").call(function(entitys){entitys.each(function(entity){var xy=attrXY(entity,textXY);this.textContent=attrText(entity);this.setAttribute("x",xy[0]);this.setAttribute("y",xy[1]);this.setAttribute("font-size",10);this.setAttribute("font-family","\u5FAE\u8F6F\u96C5\u9ED1");this.setAttribute("font-weight","bold");this.setAttribute("fill","#333")})})}else{group.append("circle").call(markerPath,"stroke");group.append("image").call(markerPath,"image")}groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.exit().remove()}return drawLabel};iD.svg.Circle=function(projection,context){function drawCircle(surface,points,filter){var groups=surface.select(".layer-circle").selectAll("g.circle").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"layer circle "+d.id}).order();function euclideanDistance(projection){return function(entity){return iD.geo.euclideanDistance(projection(entity.loc),projection(entity.radius))}}group.append("circle").attr("r",euclideanDistance(projection)).attr("stroke","red").attr("stroke-width","2").attr("fill","#FFF").attr("opacity","0.7").attr("transform","translate(0, 0)");surface.select(".layer-circle").selectAll("g.circle").each(function(entity){var r=iD.geo.euclideanDistance(projection(entity.loc),projection(entity.radius));entity.getRadius(r);this.childNodes[0].setAttribute("r",r)});groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.classed("point-hidden",function(d){return d.display?true:false});groups.exit().remove()}return drawCircle};iD.svg.overlayers=[];iD.svg.overlayers.Vertices=function(projection,context){function midpoints(surface,graph,entities,filter,extent,type){var poly=extent.polygon(),midpoints={};for(var i=0;i<entities.length;i++){var entity=entities[i];if(!entity.editable||entity.display)continue;var nodes=entity.nodes;for(var j=0;j<nodes.length-1;j++){var a=nodes[j],b=nodes[j+1],id=[a.id,b.id].sort().join("-");if(midpoints[id]){}else{if(40<iD.geo.euclideanDistance(projection(a.loc),projection(b.loc))){var point=iD.geo.interp(a.loc,b.loc,0.5),loc=null;if(extent.intersects(point)){loc=point}else{for(var k=0;4>k;k++){point=iD.geo.lineIntersection([a.loc,b.loc],[poly[k],poly[k+1]]);if(point&&20<iD.geo.euclideanDistance(projection(a.loc),projection(point))&&20<iD.geo.euclideanDistance(projection(b.loc),projection(point))){loc=point;break}}}if(loc){midpoints[id]=new Point({editable:true,id:id,loc:loc,vertices:"m",edge:[a.id,b.id],parents:entity})}}}}}var groups=surface.select(".layer-"+type).selectAll("g.midpoint").filter(filter).data(_.values(midpoints),function(d){return d.id});var enter=groups.enter().append("g").attr("class","midpoint");enter.append("circle").attr("r",8).attr("class","shadow");enter.append("circle").attr("r",4).attr("class","fill");groups.attr("transform",iD.svg.PointTransform(projection));groups.select("circle.shadow");groups.select("circle.fill");groups.exit().remove()}var hover;function draw(selection,vertices,klass,graph,zoom){var groups=selection.data(vertices,function(entity){return iD.Entity.key(entity)});function classCircle(klass){return function(entity){this.setAttribute("class","node vertex "+klass+" "+entity.id)}}function setAttributes(selection){["shadow","stroke"].forEach(function(klass){selection.selectAll("."+klass).each(function(entity){this.setAttribute("cx",0);this.setAttribute("cy",-0);this.setAttribute("r","stroke"==klass?2.75:6.6);this.removeAttribute("visibility")})})}var enter=groups.enter().append("g").attr("class",function(d){return"node vertex "+klass+" "+d.id});enter.append("circle").each(classCircle("shadow"));enter.append("circle").each(classCircle("stroke"));groups.attr("transform",iD.svg.PointTransform(projection)).call(setAttributes);groups.classed("circle-hidden",function(d){return d.display?true:false});groups.exit().remove()}function drawVertices(surface,graph,entities,filter,extent,zoom,type){var vertices=[];entities.forEach(function(overlay){overlay.editable&&!overlay.display&&overlay.nodes.forEach(function(n,i){n.editable=true;n.vertices="v";n.parent=overlay.id;n.display=overlay.display;vertices.push(n)})});surface.select(".layer-"+type).selectAll("g.vertex.vertex-persistent").filter(filter).call(draw,vertices,"vertex-persistent",graph,zoom);midpoints(surface,graph,entities,filter,extent,type)}return drawVertices};iD.svg.PointPathLines=function(projection,context){var draw=function(surface,graph,entities,filter){function coordinates(entity){var c=iD.Layers.getLayer(entity.layerId).origCoord,k=entity.tags,loc=[];if(2==c.length&&k[c[0]]&&k[c[1]])loc=[k[c[0]],k[c[1]]];else if(k[c])loc=k[c];if(2==loc.length){if(isNaN(parseFloat(loc[0]))||isNaN(parseFloat(loc[1])))loc=[]}return loc}function PointPathLine(projection,graph){var round=iD.svg.Round().stream,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return project(clip(round(output)))}});return function(entity){try{var json={type:"LineString",coordinates:[]};json.coordinates.push(entity.loc);json.coordinates.push(coordinates(entity));return path(json)}catch(e){}}};function VirtualPointTransform(projection){return function(entity){var pt=projection(coordinates(entity));return"translate("+pt[0]+","+pt[1]+")"}};var path=PointPathLine(projection,graph);var graph=context.graph(),points=[],virtualPoints=[];if(context.temp().rawposition&&context.selectedIDs()){for(var i=0;i<context.selectedIDs().length;i++){var entityId=context.selectedIDs()[i],entity=context.entity(entityId);if("point"===entity.geometry(graph)){if(2==coordinates(entity).length){points.push(entity);virtualPoints.push(entity)}}}}function drawLinePaths(){var groups=surface.select(".layer-point-path-line").selectAll("g.point-to-path").filter(filter).data(points,function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"path point "+d.id});group.append("path").attr("d",path).style({stroke:"blue","stroke-width":"2"});groups.exit().remove()}function drawVirtualPointPaths(){var groups=surface.select(".layer-point-path-line").selectAll("g.point-to-point").filter(filter).data(virtualPoints,function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"path point "+d.id});group.append("path").attr("transform","translate(-5, -7)").attr("d","M 0, 6 L 6, 12 L 12, 6 L 6, 0 z").style({stroke:"blue",fill:"blue"});groups.attr("transform",VirtualPointTransform(projection));groups.exit().remove()}surface.selectAll(".layer-point-path-line").remove();surface.append("g").attr("class","layer layer-point-path-line");drawLinePaths();drawVirtualPointPaths()};return draw};iD.svg.PointPathLines=function(projection,context){function draw(surface,graph,entities,filter){function coordinates(entity){var c=iD.Layers.getLayer(entity.layerId).origCoord,k=entity.tags,loc=[];if(""!==k[c]){if(-1===k[c].indexOf(";")){loc=[k[c].split(",")[0],k[c].split(",")[1]];if(isNaN(parseFloat(loc[0]))||isNaN(parseFloat(loc[1])))loc=[]}else{var xys=k[c].split(";");for(var i in xys){var x_y=xys[i].split(",");loc.push([parseFloat(x_y[0]),parseFloat(x_y[1])])}if(1>=loc.length)loc=[]}}else loc=[];return loc}function getAttitudeD(projection,graph){var round=iD.svg.Round().stream,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return project(clip(round(output)))}}),json={type:"LineString",coordinates:[]};return{solid:function(entity){try{json.coordinates=[];var locs=coordinates(entity);for(var k in locs)json.coordinates.push(locs[k]);return path(json)}catch(e){}},dotted:function(entity){try{json.coordinates=[];var src_locs=coordinates(entity);var e_g=entity.geometry(graph);if("point"===e_g){json.coordinates.push(entity.loc);json.coordinates.push(src_locs)}else if("line"===e_g){if(2>=src_locs.length&&("string"===typeof src_locs[0]||!src_locs[0])){json.coordinates=[]}else{var locs=[],nodes=entity.nodes;for(var k in nodes)locs.push(context.entity(nodes[k]).loc);json.coordinates.push(iD.util.getLocsLenCenter(locs,projection));json.coordinates.push(iD.util.getLocsLenCenter(src_locs,projection))}}else if("area"===e_g){var locs=[],nodes=entity.nodes;for(var k in nodes)locs.push(context.entity(nodes[k]).loc);json.coordinates.push(iD.util.getLocsCenter(locs));json.coordinates.push(iD.util.getLocsCenter(src_locs))}return path(json)}catch(e){}}}};function srcPointTransform(projection){return function(entity){var pt=projection(coordinates(entity));return"translate("+pt[0]+","+pt[1]+")"}};var graph=context.graph(),path=getAttitudeD(projection,graph),entitys=[],sIDs=context.selectedIDs();if(context.temp().rawposition&&sIDs){for(var i=0;i<sIDs.length;i++){var entityId=sIDs[i],entity=context.entity(entityId);var e_geometry=entity.geometry(graph),locs=coordinates(entity);if("point"===e_geometry){if(2===locs.length)entitys.push(entity)}else if("line"===e_geometry||"area"===e_geometry){if(locs&&""!==locs)entitys.push(entity)}}}function filterEntities(type){if(!type)return entitys;var pts=[];for(var i in entitys){if(!entitys[i].geometry)continue;if(entitys[i].geometry(graph)===type)pts.push(entitys[i])}return pts}function drawSrcPoint(){var groups=surface.select(".layer-point-path-line").selectAll("g.point-to-point").filter(filter).data(filterEntities("point"),function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"path point "+d.id});group.append("path").attr("transform","translate(-5, -7)").attr("d","M 0, 6 L 6, 12 L 12, 6 L 6, 0 z").style({stroke:"blue",fill:"blue"});groups.attr("transform",srcPointTransform(projection));groups.exit().remove()}function drawSrcWay(){var groups=surface.select(".layer-point-path-line").selectAll("g.src-line-path").filter(filter).data(filterEntities("line"),function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"path line "+d.id});group.append("path").attr("d",path.solid).style({stroke:"blue","stroke-width":"2"});groups.exit().remove()}function drawSrcArea(){var groups=surface.select(".layer-point-path-line").selectAll("g.src-area-path").filter(filter).data(filterEntities("area"),function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"path area "+d.id});group.append("path").attr("d",path.solid).style({stroke:"blue","stroke-width":"2",fill:"#333333","fill-opacity":0.5});groups.exit().remove()}function drawDottedLine(){var groups=surface.select(".layer-point-path-line").selectAll("g.dotted-line").filter(filter).data(filterEntities(),function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"path dotted "+d.id});group.append("path").attr("d",path.dotted).style({stroke:"#333333","stroke-width":"2","stroke-dasharray":"5, 5"});groups.exit().remove()}surface.selectAll(".layer-point-path-line").remove();surface.append("g").attr("class","layer layer-point-path-line");drawSrcPoint();drawSrcWay();drawSrcArea();drawDottedLine()}return draw};;iD.svg.Surface=function(){return function(selection){selection.selectAll("defs").data([0]).enter().append("defs");var layers=selection.selectAll(".layer").data(["dref_memberareas","divider_effectareas","areas","lines","hit","dividers","halo","label","traffic","roadcross","zlevel","speedcamera","polygon","marker","polylabel","polygonlabel","circle","icon","pic","detailslope","qctag","zdshp","reftags","pbktags","forbidinfo","roadcrossline","transaction","walk","walkzlevel","polyicon","polyline","placename","searchpoint","points","way_direction"]);layers.enter().append("g").attr("class",function(d){if("detailslope"==d||"roadcrossline"==d){return"layer layer-"+d+" no-pointer-events"}return"layer layer-"+d})}};;;iD.svg.TagClasses=function(){var primary=["highway","railway","waterway","aeroway","motorway","boundary","power","amenity","natural","landuse","building","leisure","place","ROAD"],secondary=["R_LINE"],third=["datatype","navitype","wf_type"],modelNames=["DIVIDER"],roadclass=iD.store.roadclass,tagRoadclass="ROAD_CLASS",dividerAttrTypeClass=iD.store.dividerAttrType,tagDividerAttrType="TYPE",dividerAttrVirtualClass=iD.store.dividerAttrVirtual,tagDividerAttrVirtual="VIRTUAL",tagClassRe=/^tag-/,tags=function(entity){return entity.tags},roadcross=function(entity){entity._type&&(entity.tags[tagRoadclass]=roadclass[entity._type])},empty=function(classes){return classes+=" tag-highway tag-highway-service"};var tagClasses=function(selection,graph){selection.each(function tagClassesEach(entity){var classes,value=this.className;if(value.baseVal!==undefined)value=value.baseVal;classes=value.trim().split(/\s+/).filter(function(name){return name.length&&!tagClassRe.test(name)}).join(" ");var t=tags(entity),i,k,v;for(i=0;i<primary.length;i++){k=primary[i];v=roadclass[t[tagRoadclass]];if(!v||"no"===v)continue;classes+=" tag-"+k+" tag-"+k+"-"+v;break}if(entity.modelName==iD.data.DataType.DIVIDER&&graph){let keyName;let relation=iD.util.getDividerParentRelation(graph,entity,iD.data.DataType.DIVIDER_ATTRIBUTE);keyName=relation&&relation.tags[tagDividerAttrVirtual]||"0";v=dividerAttrVirtualClass[keyName];classes+=" tag-dvattr-"+v;keyName=relation&&relation.tags[tagDividerAttrType]||"0";v=keyName;classes+=" tag-dvattr-type-"+v}if(entity.modelName==iD.data.DataType.DIVIDER&&graph){keyName=entity.tags[tagDividerAttrType]||"0";v=keyName;classes+=" tag-dvattr-type-"+v}if(_.include([iD.data.DataType.OBJECT_PT],entity.modelName)&&graph){let typeVal=entity.tags.TYPE||0;v=entity.tags.SUBTYPE||0;classes+=" tag-pt-type-"+typeVal;classes+=" tag-pt-subtype-"+v}if(_.include([iD.data.DataType.LAMPPOST],entity.modelName)&&graph){let typeVal=entity.tags.TYPE||0;classes+=" tag-lmp-type-"+typeVal}if(_.include([iD.data.DataType.LIMITHEIGHT],entity.modelName)&&graph){classes+=" mdn-"+iD.data.DataType.LIMITHEIGHT.toLowerCase()}for(i=0;i<modelNames.length;i++){if(entity.modelName==modelNames[i]){classes+=" model-"+entity.modelName.toLowerCase();break}}for(i=0;i<secondary.length;i++){k=secondary[i];v=t[k];if(!v||"no"===v)continue;classes+=" tag-"+k+" tag-"+k+"-"+v}!modelNames.includes(entity.modelName)&&!t[tagRoadclass]&&(classes=empty(classes));classes=classes.trim();if(classes!==value){d3.select(this).attr("class",classes)}})};tagClasses.tags=function(_){if(!arguments.length)return tags;tags=_;return tagClasses};return tagClasses};;;iD.svg.Turns=function(projection){return function(surface,graph,turns){function key(turn){return[turn.from.node+turn.via.node+turn.to.node].join("-")}function icon(turn){var u=turn.u?"-u":"";if(!turn.restriction)return"#icon-restriction-yes"+u;var restriction=graph.entity(turn.restriction).tags.restriction;return"#icon-restriction-"+(!turn.indirect_restriction&&/^only_/.test(restriction)?"only":"no")+u}var groups=surface.select(".layer-hit").selectAll("g.turn").data(turns,key);var enter=groups.enter().append("g").attr("class","turn");var nEnter=enter.filter(function(turn){return!turn.u});nEnter.append("rect").attr("transform","translate(-12, -12)").attr("width","45").attr("height","25");nEnter.append("use").attr("transform","translate(-12, -12)").attr("clip-path","url(#clip-square-45)");var uEnter=enter.filter(function(turn){return turn.u});uEnter.append("circle").attr("r","16");uEnter.append("use").attr("transform","translate(-16, -16)").attr("clip-path","url(#clip-square-32)");groups.attr("transform",function(turn){var v=graph.entity(turn.via.node),t=graph.entity(turn.to.node),a=iD.geo.angle(v,t,projection),p=projection(v.loc),r=turn.u?0:60;return"translate("+(r*Math.cos(a)+p[0])+","+(r*Math.sin(a)+p[1])+")"+"rotate("+180*a/Math.PI+")"});groups.select("use").attr("xlink:href",icon);groups.select("rect");groups.select("circle");groups.exit().remove();return this}};;;iD.svg.Maat=function(projection){return function(surface,graph,turns){function key(turn){return[turn.from.node+turn.via.node+turn.to.node].join("-")}function icon(turn){var name="greenArrow.png";if(!turn.restriction){name="yellowArrow.png"}else if(turn.u){name="greenturn.png"}return editor.context.imagePath(name)}var groups=surface.select(".layer-hit").selectAll("g.turn").data(turns,key);var enter=groups.enter().append("g").attr("class","turn");var nEnter=enter.filter(function(turn){return!turn.u});nEnter.append("rect").attr("transform","translate(-12, -12)").attr("width","35").attr("height","25");nEnter.append("image").attr("class","maat-arrow");var uEnter=enter.filter(function(turn){return turn.u});uEnter.append("circle").attr("r","16");uEnter.append("image");groups.attr("transform",function(turn){var v=graph.entity(turn.via.node),t=graph.entity(turn.to.node),a=iD.geo.angle(v,t,projection),p=projection(v.loc),r=turn.u?0:60;return"translate("+(r*Math.cos(a)+p[0])+","+(r*Math.sin(a)+p[1])+")"+"rotate("+180*a/Math.PI+")"});groups.select("image.maat-arrow").attr("xlink:href",icon).attr({x:-12,y:-13,width:35,height:25});groups.exit().remove();return this}};;;iD.svg.Vertices=function(projection,context){var radiuses={shadow:[6,7.5,7.5,11.5],stroke:[2.5,3.5,3.5,7],fill:[1,1.5,1.5,1.5]};var hover;function siblingAndChildVertices(ids,graph,extent){var vertices={};function addChildVertices(entity){var i;if("way"===entity.type){for(i=0;i<entity.nodes.length;i++){addChildVertices(graph.entity(entity.nodes[i]))}}else if("relation"===entity.type){for(i=0;i<entity.members.length;i++){var member=context.hasEntity(entity.members[i].id);if(member){addChildVertices(member)}}}else if(entity.intersects(extent,graph)){vertices[entity.id]=entity}}ids.forEach(function(id){var entity=context.hasEntity(id);if(entity&&"node"===entity.type&&"vertex"==entity.geometry(graph)){vertices[entity.id]=entity;context.graph().parentWays(entity).forEach(function(entity){addChildVertices(entity)})}else if(entity){addChildVertices(entity)}});return vertices}function draw(selection,vertices,klass,graph,zoom,execEffect=true){var icons={},z;if(17>zoom){z=0}else if(18>zoom){z=1}else{z=2}var vs=[];vertices.forEach(function(entity){if(entity.modelName){vs.push(entity)}});vertices=vs;var groups=selection.data(vertices,function(entity){return iD.Entity.key(entity)});function icon(entity){if(entity.id in icons)return icons[entity.id];icons[entity.id]=entity.hasInterestingTags()&&context.presets().match(entity,graph).icon;return icons[entity.id]}function styleCircle(d){var lay=iD.Layers.getLayer(d.layerId);if(lay&&_.isFunction(lay.nodestyle)){s=lay.nodestyle(d)}else{s=lay&&lay.nodestyle||null}d3.select(this).style(s)}function classCircle(klass){return function(d){this.setAttribute("class","node vertex "+klass+" "+d.id)}}function setAttributes(selection){["shadow","stroke","fill"].forEach(function(klass){var rads=radiuses[klass];selection.selectAll("."+klass).each(function(entity){var i=z&&icon(entity),c=i?0.5:0,r=rads[i?3:z];this.setAttribute("cx",c);this.setAttribute("cy",-c);if("RoadNode"===entity.modelName||entity.modelName===iD.data.DataType.DIVIDER_NODE||entity.modelName===iD.data.DataType.ROAD_NODE||entity.modelName===iD.data.DataType.OBJECT_PL_NODE||entity.modelName===iD.data.DataType.BRIDGE_NODE){this.setAttribute("r",r)}else{var xr=0;switch(klass){case"stroke":xr=2.75;break;case"shadow":xr=6.6;break;case"fill":break;}this.setAttribute("r",xr)}if(i&&"fill"===klass){this.setAttribute("visibility","hidden")}else{this.removeAttribute("visibility")}})});selection.selectAll("use").each(function(){if(z){this.removeAttribute("visibility")}else{this.setAttribute("visibility","hidden")}})}function updateDomStyle(selection){if(!execEffect)return;selection.each(function(entity){var lay=iD.Layers.getLayer(entity.layerId);if(lay&&!_.isEmpty(lay.nodeDomStyleMap)){_.values(lay.nodeDomStyleMap).forEach(fun=>{if(!_.isFunction(fun))return;fun(entity,this)})}if(lay&&_.isFunction(lay.nodeDomStyle)){lay.nodeDomStyle(entity,this)}})}function isShared(entity,self){let g=d3.select(self);let parentWays=graph.parentWays(entity);if(!graph.isShared(entity)){if([iD.data.DataType.DIVIDER_NODE,iD.data.DataType.ROAD_NODE,iD.data.DataType.OBJECT_PL_NODE,iD.data.DataType.BRIDGE_NODE].includes(entity.modelName)&&self.childNodes.length&&[parentWays[0].first(),parentWays[0].last()].includes(entity.id)){if(3===self.childNodes.length){self.childNodes[1].style.fill="#FF0000";self.childNodes[1].setAttribute("d-fill","#FF0000")}if(0==g.selectAll("rect")[0].length){g.append("rect").attr("x","-3").attr("y","-3").attr("width","6").attr("height","6").style("fill","#ff0000").style("stroke","#ff0000");g.append("circle").attr("class","node vertex fill "+entity.id).attr("x","0").attr("y","0").attr("r","1.5").style("fill","#000")}}}else{if(2==parentWays.length&&[iD.data.DataType.DIVIDER_NODE,iD.data.DataType.ROAD_NODE,iD.data.DataType.OBJECT_PL_NODE,iD.data.DataType.BRIDGE_NODE].includes(entity.modelName)){if(2==parentWays.length){if(0==g.selectAll("rect")[0].length){g.append("rect").attr("x","-4").attr("y","-4").attr("width","8").attr("height","8").style("fill","#FFFFFF").style("stroke","#666").attr("transform","rotate(45,0,0)");g.append("circle").attr("class","node vertex fill "+entity.id).attr("x","0").attr("y","0").attr("r","1.5").style("fill","#000")}else if(g.node()&&5==g.node().childNodes.length){var $rect=g.select("rect");var $circle=d3.select(g.node().lastChild);$rect.attr("x","-4").attr("y","-4").attr("width","8").attr("height","8").style("fill","#FFFFFF").style("stroke","#666").attr("transform","rotate(45,0,0)");$circle.attr("x","0").attr("y","0").attr("r","1.5").style("fill","#000")}}}}return graph.isShared(entity)}var classTagName=["DASHTYPE"];var enter=groups.enter().append("g").attr("class",function(d){var tagClass="";if(classTagName.length){for(var i in classTagName){var tagName=classTagName[i];var value=d.tags&&d.tags[tagName];if(null!=value&&""!=value){tagClass+=" tag-"+tagName.toLowerCase()+"-"+value}}}return"node vertex "+klass+" "+d.id+tagClass});enter.append("circle").each(classCircle("shadow"));enter.append("circle").each(classCircle("stroke"));enter.filter(function(d){return}).append("use").attr("transform","translate(-6, -6)").attr("clip-path","url(#clip-square-12)").attr("xlink:href",function(d){return"#maki-"+icon(d)+"-12"});enter.filter(function(d){return!icon(d)&&d.isInterestingTags()}).append("circle").each(classCircle("fill"));groups.attr("transform",iD.svg.PointTransform(projection)).classed("shared",function(entity){return isShared(entity,this)}).call(setAttributes);groups.classed("vertex-hidden",function(d){return false;return!iD.Layers.getLayer(d.layerId,d.modelName).display});groups.call(updateDomStyle);groups.exit().remove();selection.selectAll(".stroke").each(styleCircle)}function drawVertices(surface,graph,entities,filter,extent,zoom,execEffect){var selected=siblingAndChildVertices(context.selectedIDs(),graph,extent),vertices=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if("vertex"!==entity.geometry(graph)){continue}let entityIsSelected=entity.id in selected;if(entityIsSelected||entity.isInterestingTags()||entity.isIntersection(graph)){if(entityIsSelected){vertices.push(entity)}else{let pways=graph.parentWays(entity);if(0==pways.length){continue}if(context.variable.showShapePoint){vertices.push(entity)}else if(entity.isEndpoint(graph)||isLAPoint(entity)||isDAPoint(entity)||isBreakType(entity)){vertices.push(entity)}}}}surface.select(".layer-hit").selectAll("g.vertex.vertex-persistent").filter(filter).call(draw,vertices,"vertex-persistent",graph,zoom,execEffect);drawHover(surface,graph,extent,zoom)}function isBreakType(entity){return entity.modelName==iD.data.DataType.DIVIDER_NODE&&"4"==entity.tags.DASHTYPE}function isLAPoint(entity){return 0<context.graph().parentRelations(entity,iD.data.DataType.LANE_ATTRIBUTE).length}function isDAPoint(entity){return 0<context.graph().parentRelations(entity,iD.data.DataType.DIVIDER_ATTRIBUTE).length}function drawHover(surface,graph,extent,zoom){var hovered=hover?siblingAndChildVertices([hover.id],graph,extent):{};surface.select(".layer-hit").selectAll("g.vertex.vertex-hover").call(draw,d3.values(hovered),"vertex-hover",graph,zoom)}drawVertices.drawHover=function(surface,graph,_,extent,zoom){if(hover!==_){hover=_;drawHover(surface,graph,extent,zoom)}};return drawVertices};;;iD.svg.TransactionAreas=function(projection,context){var patterns={wetland:"wetland",beach:"beach",scrub:"scrub",construction:"construction",military:"construction",cemetery:"cemetery",grave_yard:"cemetery",meadow:"meadow",farm:"farmland",farmland:"farmland",orchard:"orchard"};var patternKeys=["landuse","natural","amenity"];var clipped=["residential","commercial","retail","industrial"];function clip(entity){return-1!==clipped.indexOf(entity.tags.landuse)}function setPattern(d){for(var i=0;i<patternKeys.length;i++){if(d.tags&&patterns.hasOwnProperty(d.tags[patternKeys[i]])){this.style.fill="url(\"#pattern-"+patterns[d.tags[patternKeys[i]]]+"\")";return}}this.style.fill=""}function polygonDifference(nodeArray,holeArrs){var bbox={min:[0,0],max:[-1,0],center:function(){return[0.5*(this.min[0]+this.max[0]),0.5*(this.min[1]+this.max[1])]},add:function(x,y){if(this.min[0]>this.max[0]){this.min[0]=this.max[0]=x;this.min[1]=this.max[1]=y}else{if(x<this.min[0])this.min[0]=x;else if(x>this.max[0])this.max[0]=x;if(y<this.min[1])this.min[1]=y;else if(y>this.max[1])this.max[1]=y}},addArr:function(arr){for(let i=0,re=arr.length;i<re;i++){this.add(arr[i][0],arr[i][1])}},addArrs:function(arrs){for(let i=0,re=arrs.length;i<re;i++){this.addArr(arrs[i])}},arr2Path:function(arr){var path="[";for(let i=0,re=arr.length;i<re;i++){if(i)path+=",";path+="{X:"+arr[i][0]+",Y:"+arr[i][1]+"}"}path+="]";return path}};bbox.addArr(nodeArray);bbox.addArrs(holeArrs);var center=bbox.center();var scale=1.0e+8;var subj_paths=createClipPath(nodeArray,center);var clip_paths=createClipPaths(holeArrs,center);ClipperLib.JS.ScaleUpPaths(subj_paths,scale);ClipperLib.JS.ScaleUpPaths(clip_paths,scale);var cpr=new ClipperLib.Clipper;cpr.AddPaths(subj_paths,ClipperLib.PolyType.ptSubject,true);cpr.AddPaths(clip_paths,ClipperLib.PolyType.ptClip,true);var solution_paths=new ClipperLib.Paths;var succeeded=cpr.Execute(ClipperLib.ClipType.ctDifference,solution_paths,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);return paths2Polygon(solution_paths,center,1/scale);function createClipPath(arr,center){var clip_paths=new ClipperLib.Paths;var clip_path=new ClipperLib.Path;for(let i=0,re=arr.length-1;i<re;i++){clip_path.push(new ClipperLib.IntPoint(arr[i][0]-center[0],arr[i][1]-center[1]))}clip_paths.push(clip_path);return clip_paths}function createClipPaths(arrs,center){var clip_paths=new ClipperLib.Paths;for(let k=0,rk=arrs.length;k<rk;k++){var clip_path=new ClipperLib.Path;var arr=arrs[k];for(let i=0,re=arr.length;i<re;i++){clip_path.push(new ClipperLib.IntPoint(arr[i][0]-center[0],arr[i][1]-center[1]))}clip_paths.push(clip_path)}return clip_paths}function paths2Polygon(paths,center,scale){if(1==paths.length){var result={type:"Polygon",coordinates:[]};for(let i=0,re=paths.length;i<re;i++){var path=paths[i];if(0<path.length){var poly=[];for(let j=0,rj=path.length;j<rj;j++){poly[j]=[path[j].X*scale+center[0],path[j].Y*scale+center[1]]}poly[poly.length]=[path[0].X*scale+center[0],path[0].Y*scale+center[1]];result.coordinates.push(poly)}}return[result]}else if(1<paths.length){var result={type:"MultiPolygon",coordinates:[]};for(let i=0,re=paths.length;i<re;i++){var path=paths[i];if(0<path.length){var poly=[];for(let j=0,rj=path.length;j<rj;j++){poly[j]=[path[j].X*scale+center[0],path[j].Y*scale+center[1]]}poly[poly.length]=[path[0].X*scale+center[0],path[0].Y*scale+center[1]];result.coordinates.push([poly])}}return[result]}else{return[]}}}var old_contextCenter;function drawAreas(surface,graph,entities,filter){if(!iD.Task||!iD.Task.d)return;var current_contextCenter=context.map&&iD.Task.d?context.map().center()+"-"+context.map().zoom()+"-"+iD.User.getInfo().userid+"-"+iD.Task.d.trans_id:"";if(old_contextCenter==current_contextCenter&&iD.Task.d){return}else{old_contextCenter=current_contextCenter}var _extent=context.map().extent(),min=_extent[0],max=_extent[1];var dimensions=context.map().dimensions();var _expand0=(max[0]-min[0])/dimensions[0];var _expand1=(max[1]-min[1])/dimensions[1];min[0]-=_expand0,min[1]-=_expand1;max[0]+=_expand0,max[1]+=_expand1;var p1=new Point({loc:min}),p2=new Point({loc:[min[0],max[1]]}),p3=new Point({loc:max}),p4=new Point({loc:[max[0],min[1]]});var nodes=[p1,p2,p3,p4,p1];var holeArrs=[];var nodeArray=nodes.map(function(h){return h["loc"]});var taskTransaction=entities.filter(function(o){return iD.Task.d.trans_id==o.id});if(!taskTransaction.length){return}if(0<taskTransaction.length&&taskTransaction[0].holes){var holes=taskTransaction[0].holes;for(var k=0,rk=holes.length;k<rk;k++){var coords=holes[k].map(function(h){return h["loc"]});holeArrs.push(coords)}}var path=iD.svg.GeoJsonPath(projection,true),areas={};var drawArrays=polygonDifference(nodeArray,holeArrs);for(var i=0;i<drawArrays.length;i++){var entity={id:iD.Task.d.trans_id+""+i,geometry:drawArrays[i],onDraw:function(element,entity,classed){element.style({stroke:"#ff0000",opacity:0.3,"stroke-width":2,"stroke-dasharray":"5, 5",fill:"#333333"})},area:function(){return 0}};areas[entity.id]={entity:entity}}areas=d3.values(areas).filter(function hasPath(a){return path(a.entity)});areas=_.pluck(areas,"entity");var strokes=areas.filter(function(area){return true});var data={shadow:strokes,stroke:strokes,fill:areas};var areagroup=surface.select(".layer-transaction").selectAll("g.transaction-polygongroup").data(["fill","shadow","stroke"]);areagroup.enter().append("g").attr("class",function(d){return"layer transaction-polygongroup area-"+d});var paths=areagroup.selectAll("path").filter(filter).data(function(layer){return data[layer]},iD.Entity.key);paths.exit().remove();var fills=areagroup.selectAll(".polygon-fill path.polygon")[0];var bisect=d3.bisector(function(node){return-node.__data__.area(graph)}).left;function sortedByArea(entity){if("fill"===this.__data__){return fills[bisect(fills,-entity.area(graph))]}}paths.enter().insert("path",sortedByArea).each(function(entity){var layer=this.parentNode.__data__;if("stroke"===layer){entity.style&&d3.select(this).style(entity.style);entity.onDraw&&entity.onDraw.call(this,d3.select(this),entity)}if("fill"===layer){this.setAttribute("clip-path","url(#"+entity.id+"-clippath)")}if("fill"===layer){setPattern.apply(this,arguments)}this.setAttribute("fill-rule","evenodd")});paths.attr("d",path);paths.classed("area-hidden",function(d){return d.display?true:false})}drawAreas.resetGraphyInfo=function(){old_contextCenter=""};drawAreas.old_contextCenter=function(_){old_contextCenter=_};return drawAreas};;;iD.svg.WalkLink=function(projection,context){var highway_stack={motorway:0,motorway_link:1,trunk:2,trunk_link:3,primary:4,primary_link:5,secondary:6,tertiary:7,unclassified:8,residential:9,service:10,footway:11};function waystack(a,b){var as=0,bs=0;if(a.isOneRoadCrossWay())return 1;if(b.isOneRoadCrossWay())return-1;if("uplink"===b._zleveltype)return 2;if("dnlink"===b._zleveltype)return 3;if(a.tags.highway){as-=highway_stack[a.tags.highway]}if(b.tags.highway){bs-=highway_stack[b.tags.highway]}return as-bs}function filterSubLayer(entity){if(entity.isOneRoadCrossWay&&entity.isOneRoadCrossWay()){var nodes=entity.nodes,node1=nodes[0],node=context.graph().entity(node1);var layerInfo=node&&iD.Layers.getLayer(node.layerId),available=true;if(layerInfo){var entType=node.modelName||node._type,sublayer=layerInfo.getSubLayerByType(entType);available=sublayer&&sublayer.display}return!available}if(entity.isRoadZLevel&&entity.isRoadZLevel()){var layerInfo=entity&&iD.Layers.getLayer(entity.layerId),available=true;if(layerInfo){var entType=entity.modelName||entity._type,sublayer=layerInfo.getSubLayerByType(entType);available=sublayer&&sublayer.display}if(!available){var zlevel_member=entity.members;if(!zlevel_member.length)return;var link_up=zlevel_member[0],link_down=zlevel_member[1];if("link_up"===link_up.role)link_up=zlevel_member[0],link_down=zlevel_member[1];else link_down=zlevel_member[0],link_up=zlevel_member[1];var link_up_way=context.graph().entity(link_up.id),link_down_way=context.graph().entity(link_down.id);link_up_way.zlevel&&(link_up_way.zlevel=0);link_down_way.zlevel&&(link_down_way.zlevel=0)}}else{return false}}return function drawWalkLink(surface,graph,entities,filter){var ways=[],pathdata={},onewaydata={},onewaystopdata={},getPath=iD.svg.Path(projection,graph);for(var i=0;i<entities.length;i++){var entity=entities[i],outer=iD.geo.simpleMultipolygonOuterMember(entity,graph);if(outer){ways.push(entity.mergeTags(outer.tags))}else if("line"===entity.geometry(graph)&&entity.modelName==iD.data.DataType.WALKLINK){ways.push(entity)}}ways=ways.filter(getPath);pathdata=_.groupBy(ways,function(way){return way.layer()});var walkDirectionFlag=iD.WalkLinkDirection.getWalkLinkDirection();_.forOwn(pathdata,function(v,k){onewaydata[k]=_(v).filter(function(d){return walkDirectionFlag||d.isOneWay()&&iD.Layers.getLayer(d.layerId,d.modelName).display}).map(walkDirectionFlag?iD.svg.OneWalkLinkSegments(projection,graph,35):iD.svg.OneWaySegments(projection,graph,35)).flatten().valueOf();onewaystopdata[k]=_(v).filter(function(d){return d.isOneStopWay()&&iD.Layers.getLayer(d.layerId,d.modelName).display}).map(iD.svg.OneWayStopSegments(projection,graph,80)).flatten().valueOf()});var layergroup=surface.selectAll("g.layer-walk").selectAll("g.layer-walklink").data([0]);layergroup.enter().append("g").attr("class",function(d){return"layer layer-walklink"});var linegroup=layergroup.selectAll("g.linegroup").data(["shadow","casing","stroke"]);linegroup.enter().append("g").attr("class",function(d){return"layer linegroup line-"+d});var lines=linegroup.selectAll("path").filter(filter).data(function(){return pathdata[this.parentNode.parentNode.__data__]||[]},iD.Entity.key);lines.enter().append("path");lines.attr("class",function(d){var lay=iD.Layers.getLayer(d.layerId);var styleClass=this.parentNode.__data__;var rod="";if("stroke"===styleClass){if(iD.Layers.getLayer(d.layerId).isRoad()){rod="road";if(lay.style){d3.select(this).style(_.isFunction(lay.style)?lay.style(d):lay.style)}}else if(iD.Layers.getLayer(d.layerId).isLine()){if(lay.style){d3.select(this).style(_.isFunction(lay.style)?lay.style(d):lay.style)}}lay.onDraw&&lay.onDraw.call(this,d3.select(this),d,styleClass)}return"way line "+rod+" "+styleClass+" "+d.id}).call(iD.svg.TagClasses());lines.sort(waystack).attr("d",getPath).call(iD.svg.TagClasses().tags(iD.svg.MultipolygonMemberTags(graph)));lines.classed("line-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});lines.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup").data(["oneway"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaydata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-marker)");oneways.attr("d",function(d){return d.d});oneways.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup-stop").data(["onewaystop"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup-stop");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaystopdata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-stop)");oneways.attr("d",function(d){return d.d});oneways.exit().remove();var onewaygroup=layergroup.selectAll("g.onewaygroup-secondary").data(["onewaysecondary"]);onewaygroup.enter().append("g").attr("class","layer onewaygroup-secondary");var oneways=onewaygroup.selectAll("path").filter(filter).data(function(){return onewaystopdata[this.parentNode.parentNode.__data__]||[]},function(d){return[d.id,d.index]});oneways.enter().append("path").attr("class","oneway").attr("marker-mid","url(#oneway-stop-secondary)");oneways.attr("d",function(d){return d.d});oneways.exit().remove()}};;;iD.svg.WalkEnter=function(projection,context){var radiuses={shadow:[6,7.5,7.5,11.5],stroke:[2.5,3.5,3.5,7],fill:[1,1.5,1.5,1.5]};var hover;function siblingAndChildVertices(ids,graph,extent){var vertices={};function addChildVertices(entity){var i;if("way"===entity.type){for(i=0;i<entity.nodes.length;i++){addChildVertices(graph.entity(entity.nodes[i]))}}else if("relation"===entity.type){for(i=0;i<entity.members.length;i++){var member=context.hasEntity(entity.members[i].id);if(member){addChildVertices(member)}}}else if(entity.intersects(extent,graph)){vertices[entity.id]=entity}}ids.forEach(function(id){var entity=context.hasEntity(id);if(entity&&"node"===entity.type){vertices[entity.id]=entity;context.graph().parentWays(entity).forEach(function(entity){addChildVertices(entity)})}else if(entity){addChildVertices(entity)}});return vertices}function draw(selection,vertices,klass,graph,zoom){var icons={},z;if(17>zoom){z=0}else if(18>zoom){z=1}else{z=2}var groups=selection.data(vertices,function(entity){return iD.Entity.key(entity)});function icon(entity){if(entity.id in icons)return icons[entity.id];icons[entity.id]=entity.hasInterestingTags()&&context.presets().match(entity,graph).icon;return icons[entity.id]}function styleCircle(d){var lay=iD.Layers.getLayer(d.layerId);if(lay.isRoad()){rod="road";if(lay.nodestyle){var s;if(_.isFunction(lay.nodestyle)){s=lay.nodestyle(d)}else{s=lay.nodestyle}if(s&&null==s.fill){s.fill=this.getAttribute("d-fill")}d3.select(this).style(s)}}}function classCircle(klass){var rads=radiuses[klass];return function(d){this.setAttribute("class","node vertex "+klass+" "+d.id)}}function setAttributes(selection){["shadow","stroke","fill"].forEach(function(klass){var rads=radiuses[klass];selection.selectAll("."+klass).each(function(entity){var i=z&&icon(entity),c=i?0.5:0,r=rads[i?3:z];this.setAttribute("cx",c);this.setAttribute("cy",-c);if("RoadNode"===entity.modelName){this.setAttribute("r",r)}else{var xr=0;switch(klass){case"stroke":xr=2.75;break;case"shadow":xr=6.6;break;case"fill":break;}this.setAttribute("r",xr)}if(i&&"fill"===klass){this.setAttribute("visibility","hidden")}else{this.removeAttribute("visibility")}})});selection.selectAll("use").each(function(){if(z){this.removeAttribute("visibility")}else{this.setAttribute("visibility","hidden")}})}function isShared(entity,self){if(!graph.isShared(entity)){if(entity.modelName===iD.data.DataType.ROAD_NODE&&self.childNodes.length){if(3===self.childNodes.length){self.childNodes[1].style.fill="#FF0000";self.childNodes[1].setAttribute("d-fill","#FF0000")};}}else{var haveCrossWay=false,parentWays=graph.parentWays(entity);_(parentWays).each(function(way){if(way.isOneRoadCrossWay()){haveCrossWay=true;return false}});if(2===parentWays.length&&haveCrossWay){if(self.childNodes[1]){self.childNodes[1].style.fill="#FF0000";self.childNodes[1].setAttribute("d-fill","#FF0000")}}else{}}return graph.isShared(entity)}var enter=groups.enter().append("g").attr("class",function(d){return"node vertex "+klass+" "+d.id}).classed("walknode",function(d){return d.isWalkEnter()});enter.append("circle").each(classCircle("shadow"));enter.append("circle").each(classCircle("stroke"));enter.filter(function(d){return}).append("use").attr("transform","translate(-6, -6)").attr("clip-path","url(#clip-square-12)").attr("xlink:href",function(d){return"#maki-"+icon(d)+"-12"});enter.filter(function(d){return!icon(d)&&d.isInterestingTags()}).append("circle").each(classCircle("fill"));groups.attr("transform",iD.svg.PointTransform(projection)).classed("shared",function(entity){return isShared(entity,this)}).call(setAttributes);groups.classed("vertex-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});groups.exit().remove();selection.selectAll(".stroke").each(styleCircle)}function drawWalkEnter(surface,graph,entities,filter,extent,zoom){var selected=siblingAndChildVertices(context.selectedIDs(),graph,extent),vertices=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if("vertex"!==entity.geometry(graph)){continue}if(!entity.modelName){continue}if(entity.isWalkEnter&&entity.isWalkEnter()||entity.id in selected&&entity.tags&&iD.data.DataType.WALKLINK==entity.modelName||entity.isIntersection(graph)||entity.id in selected&&entity.isWalkAreaPoint&&entity.isWalkAreaPoint()){vertices.push(entity)}}function hasRelWithRoad(entity,graph){var relations=graph.parentRelations(entity);for(var i=0;i<relations.length;i++){if(relations[i].modelName==iD.data.DataType.RELWKETROAD){return true}}return false}var layer_walkenter=surface.select(".layer-walk").selectAll("g.layer.layer-walkenter").data([0]);layer_walkenter.enter().append("g").attr("class","layer layer-walkenter");surface.select(".layer-walkenter").selectAll("g.vertex.vertex-persistent").filter(filter).call(draw,vertices,"vertex-persistent",graph,zoom);surface.select(".layer-walkenter").selectAll("g.vertex.vertex-persistent").filter(filter).classed("walkRelation",function(d){return hasRelWithRoad(d,graph)})}return drawWalkEnter};;;iD.svg.WalkAreas=function(projection){var patterns={wetland:"wetland",beach:"beach",scrub:"scrub",construction:"construction",military:"construction",cemetery:"cemetery",grave_yard:"cemetery",meadow:"meadow",farm:"farmland",farmland:"farmland",orchard:"orchard"};var patternKeys=["landuse","natural","amenity"];var clipped=["residential","commercial","retail","industrial"];function clip(entity){return-1!==clipped.indexOf(entity.tags.landuse)}function setPattern(d){for(var i=0;i<patternKeys.length;i++){if(patterns.hasOwnProperty(d.tags[patternKeys[i]])){this.style.fill="url(\"#pattern-"+patterns[d.tags[patternKeys[i]]]+"\")";return}}this.style.fill=""}return function drawAreas(surface,graph,entities,filter){var path=iD.svg.Path(projection,graph,true),areas={},multipolygon;for(var i=0;i<entities.length;i++){var entity=entities[i];if("area"!==entity.geometry(graph))continue;if(entity.modelName!=iD.data.DataType.WALKAREA)continue;multipolygon=iD.geo.isSimpleMultipolygonOuterMember(entity,graph);if(multipolygon){areas[multipolygon.id]={entity:multipolygon.mergeTags(entity.tags),area:Math.abs(entity.area(graph))}}else if(!areas[entity.id]){areas[entity.id]={entity:entity,area:Math.abs(entity.area(graph))}}}areas=d3.values(areas).filter(function hasPath(a){return path(a.entity)});areas.sort(function areaSort(a,b){return b.area-a.area});areas=_.pluck(areas,"entity");var strokes=areas.filter(function(area){return"way"===area.type});var data={clip:areas.filter(clip),shadow:strokes,stroke:strokes,fill:areas};var clipPaths=surface.selectAll("defs").selectAll(".clipPath").filter(filter).data(data.clip,iD.Entity.key);clipPaths.enter().append("clipPath").attr("class","clipPath").attr("id",function(entity){return entity.id+"-clippath"}).append("path");clipPaths.selectAll("path").attr("d",path);clipPaths.exit().remove();var layer_walk=surface.select(".layer-walk");var layer_walkarea=layer_walk.selectAll("g.layer.layer-walkarea").data([0]);layer_walkarea.enter().insert("g",":first-child").attr("class","layer layer-walkarea");var areagroup=layer_walkarea.selectAll("g.areagroup").data(["fill","shadow","stroke"]);areagroup.enter().append("g").attr("class",function(d){return"layer areagroup area-"+d});var paths=areagroup.selectAll("path").filter(filter).data(function(layer){return data[layer]},iD.Entity.key);paths.exit().remove();var fills=areagroup.selectAll(".area-fill path.area")[0];var bisect=d3.bisector(function(node){return-node.__data__.area(graph)}).left;function sortedByArea(entity){if("fill"===this.__data__){return fills[bisect(fills,-entity.area(graph))]}}paths.enter().insert("path",sortedByArea).each(function(entity){var layer=this.parentNode.__data__;if("stroke"===layer){var lay=iD.Layers.getLayer(entity.layerId);if(lay.style){d3.select(this).style(lay.style)}lay.onDraw&&lay.onDraw.call(this,d3.select(this),entity)}this.setAttribute("class",entity.type+" area "+(iD.Layers.getLayer(entity.layerId).isTF?"":layer)+" "+entity.id);if("fill"===layer&&clip(entity)){this.setAttribute("clip-path","url(#"+entity.id+"-clippath)")}if("fill"===layer){setPattern.apply(this,arguments)}});paths.attr("d",path);paths.classed("area-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display})}};iD.svg.Polygon=function(projection,context,mapType){var patterns={wetland:"wetland",beach:"beach",scrub:"scrub",construction:"construction",military:"construction",cemetery:"cemetery",grave_yard:"cemetery",meadow:"meadow",farm:"farmland",farmland:"farmland",orchard:"orchard"};var patternKeys=["landuse","natural","amenity"];var clipped=["residential","commercial","retail","industrial"];function clip(entity){return-1!==clipped.indexOf(entity.tags.landuse)}function setPattern(d){for(var i=0;i<patternKeys.length;i++){if(patterns.hasOwnProperty(d.tags[patternKeys[i]])){this.style.fill="url(\"#pattern-"+patterns[d.tags[patternKeys[i]]]+"\")";return}}this.style.fill=""}return function drawAreas(surface,graph,entities,filter){var path=iD.svg.Path(projection,graph,true),areas={},multipolygon;for(var i=0;i<entities.length;i++){var entity=entities[i];multipolygon=iD.geo.isSimpleMultipolygonOuterMember(entity,graph);if(multipolygon){areas[multipolygon.id]={entity:multipolygon.mergeTags(entity.tags),area:Math.abs(entity.area(graph))}}else if(!areas[entity.id]){areas[entity.id]={entity:entity,area:Math.abs(entity.area(graph))}}}areas=d3.values(areas).filter(function hasPath(a){return path(a.entity)});areas.sort(function areaSort(a,b){return b.area-a.area});areas=_.pluck(areas,"entity");var strokes=areas.filter(function(area){return true});var data={clip:areas.filter(clip),shadow:strokes,stroke:strokes,fill:areas};var clipPaths=surface.selectAll("defs").selectAll(".clipPath").filter(filter).data(data.clip,iD.Entity.key);clipPaths.enter().append("clipPath").attr("class","clipPath").attr("id",function(entity){return entity.id+"-clippath"}).append("path");clipPaths.selectAll("path").attr("d",path);clipPaths.exit().remove();var areagroup=surface.select(!mapType?".layer-polygon":"."+mapType+"-layer-polygon").selectAll("g.polygongroup").data(["fill","shadow","stroke"]);areagroup.enter().append("g").attr("class",function(d){return"layer polygongroup area-"+d});var paths=areagroup.selectAll("path").filter(filter).data(function(layer){return data[layer]},iD.Entity.key);paths.exit().remove();var fills=areagroup.selectAll(".polygon-fill path.polygon")[0];var bisect=d3.bisector(function(node){return-node.__data__.area(graph)}).left;function sortedByArea(entity){if("fill"===this.__data__){return fills[bisect(fills,-entity.area(graph))]}}paths.enter().insert("path",sortedByArea).each(function(entity){var layer=this.parentNode.__data__;if("stroke"===layer){entity.style&&d3.select(this).style(entity.style);entity.onDraw&&entity.onDraw.call(this,d3.select(this),entity)}this.setAttribute("class",entity.type+(!mapType?" area ":" ")+layer+" "+entity.id);if("fill"===layer&&clip(entity)){this.setAttribute("clip-path","url(#"+entity.id+"-clippath)")}if("fill"===layer){setPattern.apply(this,arguments)}});paths.attr("d",path);paths.classed("area-hidden",function(d){return d.display?true:false})}};;;iD.svg.Traffic=function(projection,context){var longid=1,darwMinZoom=17;function sortY(a,b){return b.loc[1]-a.loc[1]}function transpsData(editor){var transId=iD.Transportation.operations.id;var way=context.hasEntity(transId);var graph=context.graph();if(!(way instanceof iD.Way))return[];var anode=graph.entity(way.first()),bnode=graph.entity(way.last()),nodeId2crossId={};filterNodeCross([anode,bnode],nodeId2crossId);var a=nodeId2crossId[anode.id],b=nodeId2crossId[bnode.id],transps={},filter={};if(a&&"0"!==a&&a===b)return;var ans=function(d){if(1==d){return[anode,bnode]}else if(2==d){return[bnode]}else if(3==d){return[anode]}else if(4==d){return[]}return[]}(way.tags.DIRECTION);if(-1==ans.indexOf(anode)){ans.push(anode)}if(-1==ans.indexOf(bnode)){ans.push(bnode)}_(ans).each(function(an){newTransps(transps,an,way,editor,filter,nodeId2crossId)});filter={};return transps}function filterNodeCross(ans,nodeId2crossId){_(ans).each(function(an){context.graph().parentRelations(an).forEach(function(rel){if(rel.modelName==iD.data.DataType.R_C_NODE_ROAD_NODE){rel.members.forEach(function(member){if(member.modelName==iD.data.DataType.C_NODE){nodeId2crossId[an.id]=member.id}})}})})}function buildTimeInfo(trans){var times=[];trans._rules.forEach(function(r){if("0"==r.type&&r.timeInfo&&r.timeInfo.timeRange){times.push.apply(times,r.timeInfo.timeRange.map(function(t){return t.start+" - "+t.end}))}});times=_.uniq(times);return times}function buildTranStyle(trans){var tag={};trans._rules.forEach(function(r){tag.blue=true;if("0"==r.type){tag.yellow=true;if(0<=r.time.indexOf("(h0){h24}")){tag.red=true}}else if("2"==r.type){tag.yellow=true}});return tag}function newTransps(transps,an,fromWay,editor,filter,nodeId2crossId){var graph=context.graph(),next,nodes,tags,acs_entity,bcs_entity,anid=iD.Entity.id.toOSM(an.id),an_cross_node_id=nodeId2crossId[an.id];var parentWays=graph.parentWays(an);_(parentWays).each(function(toWay){nodes=toWay.nodes;var fnode=iD.Entity.id.toOSM(toWay.first());var tnode=iD.Entity.id.toOSM(toWay.last());var len=nodes.length;tags=toWay.tags;acs_entity=graph.entity(nodes[0]),bcs_entity=graph.entity(nodes[len-1]);filterNodeCross([acs_entity,bcs_entity],nodeId2crossId);var acs=nodeId2crossId[acs_entity.id],bcs=nodeId2crossId[bcs_entity.id];if(acs&&""!==acs&&"0"!==acs&&acs===bcs){if(fnode===anid)next=graph.entity(nodes[len-1]);else if(tnode===anid)next=graph.entity(nodes[0]);if(!filter[next.id]){filter[next.id]=true;newTransps(transps,next,fromWay,editor,filter,nodeId2crossId)}return}if(!toWay.isOneRoadCrossWay()&&tags.DIRECTION!==undefined){var bn,dt=25;if(fromWay.id!=toWay.id){if(fnode===anid){bn=graph.entity(nodes[1])}else if(tnode===anid){bn=graph.entity(nodes[len-2])}}else if(fromWay.id==toWay.id&&"1"!==tags.DIRECTION){return}else if("1"===tags.DIRECTION){if(fnode===anid){bn=graph.entity(nodes[1])}else if(tnode===anid){bn=graph.entity(nodes[len-2])}else return}else if("2"===tags.DIRECTION){if(fnode===anid){bn=graph.entity(nodes[1])}else return}else if("3"===tags.DIRECTION){if(tnode===anid){bn=graph.entity(nodes[len-2])}else return}else if("4"===tags.DIRECTION){return}else{return}var a=context.projection(an.loc),b=context.projection(bn.loc);var angle=Math.atan2(b[1]-a[1],b[0]-a[0]),p=[parseInt(a[0]+dt*Math.cos(angle)),parseInt(a[1]+dt*Math.sin(angle))],loc=context.projection.invert(p);id=[an.id,bn.id].sort().join("-")+longid++;var parentRelations=context.graph().parentRelations(fromWay),pRelations=[],mRelations=[],crossOrmaat=false;parentRelations.forEach(function(relation){crossOrmaat=relation.modelName===iD.data.DataType.C_NODECONN||relation.modelName===iD.data.DataType.NODECONN;if(crossOrmaat){if(an_cross_node_id){relation.members[1].id===nodeId2crossId[an.id]&&mRelations.push(relation)}else mRelations.push(relation)}});mRelations.forEach(function(mRelation){var rules=context.graph().parentRelations(mRelation),r;rules.forEach(function(rule){r=_.clone(rule);r=iD.util.merge({members:mRelation.members},r);pRelations.push(r)})});var transportation=iD.Transportation();transps[id]=iD.Transportation({type:"transportation",id:id,loc:loc,edge:[an.id,bn.id],tags:{status:1},fromwayId:fromWay.id,towayId:toWay.id,nodeId:an_cross_node_id?an_cross_node_id:an.id,angle:angle*(180/Math.PI)});var transRelationInfo=iD.ui.RoadRuleEditor(context).transportation(transps[id]).getRelationInfo({withAnalyzed:true});transps[id].tags.status=transRelationInfo.relations.length?3:1;transps[id]._rules=transRelationInfo.analyzedRelations;transps[id]._styleInfo=buildTranStyle(transps[id]);transps[id]._timeInfo=buildTimeInfo(transps[id]);if(transRelationInfo.maat.tags&&"0"!=transRelationInfo.maat.tags.ACCESSABLE){delete transps[id]}editor&&(transps[id].editor=true);var ancs=nodeId2crossId[an.id];if(ancs&&"0"!==ancs&&""!==ancs){if(fnode===anid){next=graph.entity(nodes[len-1])}else if(tnode===anid){next=graph.entity(nodes[0])}if(!filter[next.id]&&ancs===nodeId2crossId[next.id]){filter[next.id]=true;newTransps(transps,next,fromWay,editor,filter,nodeId2crossId)}}}})}function addRoadControl(selection){var g=selection.append("g").attr("class","road-control-icon"),gw=20,gh=20,tranStr="translate(18, 0)";g.append("circle").attr("transform",tranStr).attr("cx",gw/2).attr("cy",gh/2).attr("r",Math.min(gw,gh)/2);g.append("text").attr("transform",tranStr).attr("text-anchor","middle").attr("x",gw/2).attr("y",gh/2).attr("dx",1).attr("dy","0.35em").html("&#10148;");return g}function roadMakerGrp(selection,style){selection.each(function(d){var grp=d3.select(this),roadRule,roadContrl,timeTip;grp.html("");var fromWay=context.entity(d.fromwayId),toWay=context.entity(d.towayId);var tranNode=context.entity(d.nodeId);var withControl="0"==tranNode.tags.realnode&&fromWay.id!==toWay.id;var withRule=withControl;if(!withRule){withRule="-1"!==tranNode.tags.realnode&&"2"!=fromWay.tags.status&&"2"!=toWay.tags.status}if(!withControl&&!withRule){return}var imgStyle="green";["red","yellow","blue"].some(function(t){if(d._styleInfo[t]){imgStyle=t;return true}});if(d._timeInfo&&d._timeInfo.length){timeTip=grp.append("g").attr("class","road-rule-time");var $timeTxtBg=timeTip.append("rect").attr("class","rule_time_bg");var $timeTxt=timeTip.append("text").attr("class","rule_time_txt").attr("text-anchor","middle").attr("x",0).attr("y",0).attr("dx","0").attr("dy","0");$timeTxt.selectAll("tspan").data(d._timeInfo).enter().append("tspan").attr("x",0).attr("y",function(d,idx){return 1.2*-idx+"em"}).text(function(d){return d});$timeTxt.each(function(){var bbox=this.getBBox();var w=Math.max(bbox.width+10,20),h=Math.max(bbox.height+10,20);d3.select(this.parentNode).select("rect.rule_time_bg").attr("rx",w/10).attr("ry",w/10).attr("x",-w/2).attr("width",w).attr("y",-h+10).attr("height",h)})}if(d.fromwayId==d.towayId){if(withRule){roadRule=grp.append("image").attr("class","road-rule-icon").attr("x",-16).attr("y",-8).attr("width",32).attr("height",33).attr("xlink:href",function(d){return context.imagePath(imgStyle+"turn.png")})}if(withControl){roadContrl=addRoadControl(grp);roadContrl.attr("transform","translate(-7,10)")}if(timeTip){timeTip.attr("transform","translate(60, -5)")}}else{if(withRule){roadRule=grp.append("image").attr("class","road-rule-icon").attr("x",-6).attr("y",-8).attr("width",45).attr("height",35).attr("xlink:href",function(d){return context.imagePath(imgStyle+"Arrow.png")})}if(withControl){roadContrl=addRoadControl(grp);roadContrl.attr("transform","translate(10, 15)")}if(timeTip){timeTip.attr("transform","translate(70, -5)")}}if(timeTip&&(90<d.angle||-90>d.angle)){var $bg=timeTip.select("rect.rule_time_bg");timeTip.attr("transform",timeTip.attr("transform")+" rotate(180,0,"+$bg.attr("y")/2+")")}if(roadRule){roadRule.on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault();context.container().call(iD.ui.RoadRuleEditor(context).transportation(d));return false})}if(roadContrl){roadContrl.on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault();context.container().call(iD.ui.RoadControl(context).transportation(d));return false})}});selection.each(function(entity){var size=11,coord=iD.geo.angleCoords(entity.angle,size);this.setAttribute("transform","translate("+coord[0]+", "+coord[1]+") rotate("+entity.angle+")")})}function drawTrafficArrow(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-traffic").selectAll("g.traffic_arrow").data(_.values(transpsData()),function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"node point traffic_arrow "+d.id}).order().on("mousedown",function(d){d3.event.stopPropagation()}).on("click",function(d){d3.event.stopPropagation()});group.append("g").call(roadMakerGrp);groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.exit().remove()}function markerNodePath(selection,style){if("shadow"===style||"stroke"===style){selection.attr("class",style).attr("r","10").attr("cx","0").attr("cy","0").attr("fill","white").attr("fill-opacity","1").attr("stroke","#00d8ff").attr("stroke-opacity","1").attr("stroke-width","3").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke-dasharray","none").attr("pointer-events","visiblePainted").attr("cursor","inherit")}else if("image"===style){selection.attr("class",style).attr("x",-12).attr("y",-12).attr("width",25).attr("height",25).attr("xlink:href",function(d){return"first"===d.tags.node?context.imagePath("pointa.png"):context.imagePath("pointb.png")})}else if("turn"===style){selection.attr("r","10").attr("cx",function(d){return"first"===d.tags.node?40:-40}).attr("cy",function(d){return"first"===d.tags.node?30:-30}).attr("fill","red").attr("opacity",function(d){return 1==d.relation?1:0})}selection.each(function(entity){if("stroke"===style){if(entity.tags&&"first"===entity.tags.node)this.style.fill="#f00";if(entity.tags&&"last"===entity.tags.node)this.style.fill="#0f0"}})}function transps(){var transId=iD.Transportation.operations.id;var way=context.hasEntity(transId);if(!(way instanceof iD.Way))return[];return iD.Transportation().newTransportations(context.graph().entity(way.first()),context.graph().entity(way.last()),way.tags.DIRECTION)}function drawTrafficNode(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-traffic").selectAll("g.traffic_node").data(_.values(transps()),function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"node point traffic_node "+d.id}).order().on("mousedown",function(d){d3.event.stopPropagation()}).on("click",function(d){d3.event.stopPropagation()});group.append("image").call(markerNodePath,"image");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.exit().remove()}function drawTraffic(surface,points,filter){drawTrafficNode(surface,points,filter);drawTrafficArrow(surface,points,filter)}drawTraffic.traffic=function(entities,limit){var points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if("trafficnode"===entity._type||"trafficarrow"===entity._type){points.push(entity);if(limit&&points.length>=limit)break}}return points};function markerRulePath(selection,style){if("stroke"===style||"shadow"===style){selection.attr("class",style).attr("transform","translate(-23, -35)").attr("r","7").attr("cx","40").attr("cy","-1.8")}else if("icon"===style){selection.attr("class","KDSEditor-icon").attr("transform","translate(40, 0)").attr("clip-path","url(#clip-square-20)")}else if("image"===style){selection.attr("class",style).attr("x",-4).attr("y",-4).attr("width",25).attr("height",25).attr("xlink:href",context.imagePath("clock.png"))}selection.each(function(entity){if("stroke"===style)this.style.fill="#FFD82F";var size=11,coord=iD.geo.angleCoords(entity.angle,size);if("icon"===style||"image"===style){var x=coord[0],y=coord[1];coord[0]+=30*1*Math.cos(Math.PI/180*entity.angle)+x;coord[1]+=30*1*Math.sin(Math.PI/180*entity.angle)+y}this.setAttribute("transform","translate("+coord[0]+", "+coord[1]+") rotate("+entity.angle+")")})}function drawTrafficArrowRule(surface,points,filter){var groups=surface.select(".layer-traffic").selectAll("g.traffic_clock").filter(filter).data(_.values(transpsData(true)),function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"node point traffic_clock "+d.id}).order();group.append("circle").call(markerRulePath,"shadow");group.append("circle").call(markerRulePath,"stroke");group.append("image").call(markerRulePath,"image");group.append("use").call(markerRulePath,"icon");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.exit().remove()}return drawTraffic};;;iD.svg.TurnGuidance=function(projection,context){var hightLightNodes=[],linkIdFlagSet={},$guidanceLayer;function getTurnGuidanceFromNode(firstWay,secondWay,nodeIdFlagSet,rel){if(firstWay&&secondWay){var nodeId;if(firstWay.first()==secondWay.first()||firstWay.first()==secondWay.last()){nodeId=firstWay.first()}else if(firstWay.last()==secondWay.first()||firstWay.last()==secondWay.last()){nodeId=firstWay.last()}if(nodeId&&!nodeIdFlagSet[nodeId]){nodeIdFlagSet[nodeId]=1;var topo=iD.TopoEntity();var crossNodeId=topo.isInCrossNode(context.graph(),nodeId);if(crossNodeId){nodeId=crossNodeId}if(nodeId){var entity=context.graph().hasEntity(nodeId);var obj={id:entity.id,rid:rel.id,loc:entity.loc,v:rel.v+"_"+entity.id+"_"+entity.v};return obj}}}return null}function setHighLightData(rels){linkIdFlagSet={};var nodeIdFlagSet={};hightLightNodes=[];for(var i=0;i<rels.length;i++){var rel=rels[i];var members=rel.members;if(1<members.length){var firstWay=context.hasEntity(members[0].id);var secondWay=context.hasEntity(members[1].id);var turnGuidanceFromNode=getTurnGuidanceFromNode(firstWay,secondWay,nodeIdFlagSet,rel);if(turnGuidanceFromNode){hightLightNodes.push(turnGuidanceFromNode)}for(var j=0;j<members.length;j++){var member=members[j];if(!linkIdFlagSet[member.id]){linkIdFlagSet[member.id]=1}}}}}function drawTurnGuidance(surface,points,filter){redrawDirection();setHighLightData(points);var layergroups=surface.select(".layer-lines").selectAll("g.layergroup");var linegroup=layergroups.selectAll("g.linegroup.line-stroke");var lines=linegroup.selectAll("path").filter(filter);lines.forEach(function(pathWays){if(0<pathWays.length){pathWays.forEach(function(path){if(linkIdFlagSet[d3.select(path).datum().id]){d3.select(path).classed("turn_guidance",true)}else{d3.select(path).classed("turn_guidance",false)}})}});var groups=surface.select(".layer-turnguidance").selectAll("g").filter(filter).data(hightLightNodes,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point turnguidance "+d.id}).order();group.append("image").attr("class","turn-guidance-icon").attr("x","-29").attr("y","-32").attr("width","20").attr("height","20").attr("xlink:href",function(){return context.imagePath("../../app/road-editor/dist/img/effect/turn-guidance.svg")});groups.attr("transform",iD.svg.PointTransform(projection));groups.exit().remove()}function isEffectOpen(){if(context.variable.TurnGuidanceVisible){return true}else{return false}}drawTurnGuidance.filter=function(entities,limit){if(!isEffectOpen()){return[]}else{var guidanceRels=[];var guidanceRelsFlag={};if(!context.variable.TurnGuidanceVisible){d3.selectAll(".layer-guidancevoice").selectAll("g").remove();return[]}else{for(var i=0;i<entities.length;i++){var entity=entities[i];var rels=context.graph().parentRelations(entity);for(var j=0;j<rels.length;j++){var rel=rels[j];if(rel.modelName==iD.data.DataType.TURN_GUIDANCE&&!guidanceRelsFlag[rel.id]){guidanceRelsFlag[rel.id]=1;guidanceRels.push(rel)}}}}return guidanceRels}};function redrawDirection(){var relations=d3.selectAll("g.layer-turnguidanceDir").data([0]).selectAll("g.onewaygroup").data();if(relations[0]){var relation=context.hasEntity(relations[0].id);if(relation){var nodeId=relation.memberByRole(iD.data.RoleType.ROAD_NODE_ID).id;if(context.hasEntity(nodeId)){drawTurnGuidance.drawDirection(context,relation)}}}}drawTurnGuidance.removeDirectionLayer=function(){d3.selectAll("g.turnguidance_way").remove()};function getNodeFromCrossMembers(context,crossNode,way){var resNodeId,wayNodes=way.nodes;var topoEntity=iD.TopoEntity();var crossMembers=topoEntity.getCrossNodeMembers(context.graph(),crossNode.id)||[];for(var i in crossMembers){if(wayNodes[0]==crossMembers[i].id){resNodeId=wayNodes[0]}else if(wayNodes[wayNodes.length-1]==crossMembers[i].id){resNodeId=wayNodes[wayNodes.length-1]}}return editor.context.graph().entity(resNodeId)}drawTurnGuidance.drawDirection=function(context,relation){if(!relation||!relation.tags){drawTurnGuidance.removeDirectionLayer();return}$guidanceLayer=d3.selectAll("g.layer-turnguidanceDir").data([0]);$guidanceLayer.on("mousedown",function(){d3.event.stopPropagation()});d3.selectAll("g.turnguidance_way").remove();if(relation.modelName==iD.data.DataType.NODEINFO||relation.modelName==iD.data.DataType.C_LANEINFO){var wayId=relation.memberByRole(iD.data.RoleType.ROAD_ID).id;var nodeId=relation.memberByRole(iD.data.RoleType.ROAD_NODE_ID).id;var way=context.graph().entity(wayId);var node=context.graph().entity(nodeId);if(relation.modelName==iD.data.DataType.C_LANEINFO){node=getNodeFromCrossMembers(context,node,way)}drawTurnGuidanceDir(context,[way],node,"1",relation)}else if(relation.modelName==iD.data.DataType.NODECONN||relation.modelName==iD.data.DataType.C_NODECONN){var wayId=relation.memberByRole(iD.data.RoleType.FROAD_ID).id;var nodeId;if(relation.modelName==iD.data.DataType.C_NODECONN){nodeId=relation.memberByRole(iD.data.RoleType.C_NODE_ID).id}else{nodeId=relation.memberByRole(iD.data.RoleType.ROAD_NODE_ID).id}var way=context.graph().entity(wayId);var node=context.graph().entity(nodeId);if(relation.modelName==iD.data.DataType.C_NODECONN){node=getNodeFromCrossMembers(context,node,way)}drawTurnGuidanceDir(context,[way],node,"1",relation);wayId=relation.memberByRole(iD.data.RoleType.TROAD_ID).id;way=context.graph().entity(wayId);node=context.graph().entity(nodeId);if(relation.modelName==iD.data.DataType.C_NODECONN){node=getNodeFromCrossMembers(context,node,way)}drawTurnGuidanceDir(context,[way],node,"0",relation)}};function drawTurnGuidanceDir(context,ways,node,flag,relation){var projection=context.projection,graph=context.graph(),getPath=iD.svg.Path(projection,graph),getOneWayPath=iD.svg.OneWayTurnguidanceSegments(projection,graph,70,node.loc,flag),ways=ways.filter(getPath);var $turnguidanceWays=$guidanceLayer.selectAll("g.turnguidance_way").data(_.filter(ways,function(w){return true}),iD.Entity.key);$turnguidanceWays.enter().append("g").attr("class",function(){return"turnguidance_way "+node.id});var $onewaygroup=$turnguidanceWays.selectAll("g.onewaygroup").data([relation]);$onewaygroup.enter().append("g").attr("class","layer onewaygroup");var $oneways=$onewaygroup.selectAll("path").data(function(){return getOneWayPath(d3.select(this.parentNode.parentNode).datum())});$oneways.enter().append("path").attr("class","oneway turnguidance-oneway").attr("marker-mid","url(#turnguidance-oneway-marker)");$oneways.attr("d",function(d){return d.d});$oneways.exit().remove()}return drawTurnGuidance};;iD.svg.TurnGuidanceSeq=function(context){var drawTurnGuidance={};function calcuTwoNodesDistance(nodeIdA,nodeIdB,graph){var nodeIdAEntity=graph.entity(nodeIdA),nodeIdBEntity=graph.entity(nodeIdB);var lon=iD.util.lassExtend.getDistance({lon:nodeIdAEntity.loc[0],lat:nodeIdAEntity.loc[1]},{lon:nodeIdBEntity.loc[0],lat:nodeIdBEntity.loc[1]});return lon}function getMidLoc(nodes,wayLength){var loc=[],midIndex;if(2==nodes.length){midIndex=0}else if(2<=nodes.length){var tmpLen=0;for(var i=0;i<nodes.length-1;i++){tmpLen+=calcuTwoNodesDistance(nodes[i],nodes[i+1],context.graph());if(tmpLen>wayLength/2){midIndex=i;break}}}var firstNode=context.graph().entity(nodes[midIndex]),lastNode=context.graph().entity(nodes[midIndex+1]);var firstLoc=firstNode.loc,lastLoc=lastNode.loc;var lng=(firstLoc[1]+lastLoc[1])/2,lat=(firstLoc[0]+lastLoc[0])/2;loc.push(lat);loc.push(lng);return loc}drawTurnGuidance.redraw=function(){var groups=d3.select(".layer-turnguidanceSeq").selectAll("g");groups.each(function(d){drawTurnGuidance.draw(d.rel)})};drawTurnGuidance.removeAll=function(){d3.select(".layer-turnguidanceSeq").selectAll("g").remove();d3.selectAll(".layer-lines path.selected").classed("selected",false)};drawTurnGuidance.draw=function(rel){drawTurnGuidance.removeAll();var wayArr=[],data=[],wayIdArr=[];if(rel.modelName!=iD.data.DataType.TURN_GUIDANCE)return;var members=rel.members;members.forEach(function(d,i){var way=context.graph().entity(d.id);var nodes=way.nodes;var seq=i;wayArr.push(way);wayIdArr.push(way.id);var loc=getMidLoc(nodes,way.tags.LENGTH);data.push({rel:rel,id:way.id,angle:"0",loc:loc,seq:seq})});selectElements(wayIdArr,true);var groups=d3.select(".layer-turnguidanceSeq").selectAll("g").data(data,function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"node point turnguidance "+d.id}).order();group.call(roadMakerGrp);groups.attr("transform",iD.svg.PointTransform(context.projection));groups.exit().remove()};function selectElements(selectedIDs,flag){context.surface().selectAll(iD.util.entityOrMemberSelector(selectedIDs,context.graph())).classed("selected",flag)}function roadMakerGrp(selection){var size="12";selection.each(function(d){var grp=d3.select(this);grp.append("text").attr("class","turn-guidance-text").attr("dx","5").attr("dy","-5").style("font-size","18px").html(function(d){return d.seq})})}return drawTurnGuidance};;iD.picUtil={player:null,context:null};iD.picUtil.colorRGBA=function(r,g,b,alpha){alpha=null==alpha?0.4:alpha;return iD.util.colorRGBA(r,g,b,alpha)};iD.picUtil.getModelNameParam=function(){var modelNameParam={DIVIDER:iD.data.DataType.DIVIDER,DIVIDER_NODE:iD.data.DataType.DIVIDER_NODE,OBJECT_PT:iD.data.DataType.OBJECT_PT,OBJECT_PG:iD.data.DataType.OBJECT_PG,OBJECT_PG_NODE:iD.data.DataType.OBJECT_PG_NODE,OBJECT_PL:iD.data.DataType.OBJECT_PL,OBJECT_PL_NODE:iD.data.DataType.OBJECT_PL_NODE,TRAFFICSIGN:iD.data.DataType.TRAFFICSIGN,TRAFFICSIGN_NODE:iD.data.DataType.TRAFFICSIGN_NODE,BRIDGE:iD.data.DataType.BRIDGE,BRIDGE_NODE:iD.data.DataType.BRIDGE_NODE,LIMITHEIGHT:iD.data.DataType.LIMITHEIGHT,TRAFFICLIGHT:iD.data.DataType.TRAFFICLIGHT,LAMPPOST:iD.data.DataType.LAMPPOST,CHECK_TAG:iD.data.DataType.CHECK_TAG,IMAGE_TAG:iD.data.DataType.IMAGE_TAG,ROAD_ATTRIBUTE:iD.data.DataType.ROAD_ATTRIBUTE,ANALYSIS_TAG:iD.data.DataType.ANALYSIS_TAG,QUESTION_TAG:iD.data.DataType.QUESTION_TAG};return modelNameParam};iD.picUtil.canNotDrag=function(entity){if(!iD.util.currentTrackPointDis.length){return true}let dist=iD.util.pt2LineDist(iD.util.currentTrackPointDis,entity.loc);let index=this.player.selectPicIndex+dist.i-1;if(0>index){index=0}let node=this.player.allNodes[index];if(!node||!entity){return false}return 3>Math.abs(node.loc[2]-entity.loc[2])};iD.picUtil.updateZrenderStyleByEntity=function(shape,entityid){var self=this;var param=iD.picUtil.getEntityToShapStyle(entityid,shape&&{shape:shape.shape,style:shape.style});if(shape.style){_.extend(shape.style,param.style)}else{shape.style=param.style}if(param.shape&&shape.shape){_.extend(shape.shape,param.shape)}if(shape.attr&&param.position){shape.attr("position",param.position)}var graph=self.context.graph();var player=self.player;var isDashed=player.getDrawTool().isDashedLineMode();var eid=shape._entityid||entityid;if(!eid||!isDashed)return;var node=graph.hasEntity(eid);if(!node||node.modelName!=iD.data.DataType.DIVIDER_NODE)return;if("1"==node.tags.DASHTYPE||"2"==node.tags.DASHTYPE)return;var way=graph.parentWays(node)[0];var index=way.nodes.indexOf(node.id);var flag=false;for(var i=index-1;0<=i;i--){var pnode=graph.entity(way.nodes[i]);if("2"==pnode.tags.DASHTYPE||"1"==pnode.tags.DASHTYPE){flag="2"==pnode.tags.DASHTYPE;break}}if(flag){shape.invisible=true}};iD.picUtil.getEntityToShapStyle=function(entityid,param){param=param||{};let context=this.context;let result={style:{},shape:{}};let entity=context.hasEntity(entityid);if(!entity){return result}if(entity.modelName==iD.data.DataType.DIVIDER){let type,lineColor;let lay=context.layers(entity.layerId);if(lay&&!lay.useEditColor&&lay.defaultColor){type="-1"}else{let relation=iD.util.getDividerParentRelation(context.graph(),entity,iD.data.DataType.DIVIDER_ATTRIBUTE);type=relation&&relation.tags.TYPE;type=null==type?"0":type+""}let dashColor="rgba(255, 201, 87, 0.8)";let solidColor="rgba(0, 187, 255, 0.6)";switch(type){case"1":lineColor="rgba(255, 192, 203, 0.8)";break;case"2":lineColor=dashColor;break;case"3":lineColor=solidColor;break;case"4":lineColor="rgba(193, 128, 255, 0.8)";break;case"5":lineColor="rgba(127, 128, 0, 0.8)";break;case"9":lineColor=dashColor;break;case"10":lineColor=solidColor;break;case"11":lineColor="rgba(33, 128, 192, 0.6)";break;case"12":lineColor=dashColor;break;case"13":lineColor=solidColor;break;case"14":case"15":case"16":case"17":lineColor=solidColor;break;case"19":case"20":case"21":case"22":case"23":case"24":case"25":case"26":case"31":lineColor="rgba(128, 0, 0, 0.8)";break;default:lineColor=lay&&lay.defaultColor||solidColor;break;}result.style.stroke=lineColor}else if(entity.modelName==iD.data.DataType.DIVIDER_NODE){let type=entity.tags.DASHTYPE;let colorArr=["rgba(255, 255, 255, 0.4)","rgba(18, 249, 255, 0.8)","rgba(0, 107, 255, 0.8)","rgba(255, 255, 255, 0.4)"];let strokeArr=["rgba(0, 0, 0, 1)","rgba(18, 249, 255, 0.4)","rgba(0, 107, 255, 0.4)","rgba(0, 0, 0, 1)"];let color=colorArr[type]||colorArr[0];let stroke=strokeArr[type]||strokeArr[0];if(this.isEffectDANode(entity.id)){if(result.shape.r){result.shape.r*=1.2}color="rgba(220, 20, 60, 0.8)";stroke="rgba(0, 0, 0, 0.8)"}else if(this.isEffectLANode(entity.id)){var height,width;if(result.style.width){width=result.style.width*=1.2}if(result.style.height){height=result.style.height*=1.2}if(width||height){result.position=[-width/2,-height/2]}color="rgba(18, 249, 255, 0.8)";stroke="rgba(0, 81, 255, 0.8)";result.style.lineWidth=2}else if(iD.picUtil.isEffectBreakTypeNode(entity.id)){color="rgba(90, 255, 90, 0.8)";stroke="rgba(0, 127, 0, 1)";if(result.shape.r){result.shape.r*=1.2}}result.style.fill=color;result.style.stroke=stroke}else if(entity.modelName==iD.data.DataType.LAMPPOST){if(2==entity.tags.TYPE){result.style.stroke="rgba(0, 255, 0, 0.8)"}else if(1==entity.tags.TYPE){result.style.stroke="rgba(114, 226, 114, 0.8)"}}else if(entity.modelName==iD.data.DataType.OBJECT_PG){result.style.fill="rgba(220, 20, 60, 0.2)";result.style.stroke="rgba(220, 20, 60, 0.2)"}else if(entity.modelName==iD.data.DataType.TRAFFICSIGN_NODE){result.shape.r=4}else if(entity.modelName==iD.data.DataType.LIMITHEIGHT){result.style={fill:"rgba(0, 255, 0, 0.8)",stroke:"rgba(0, 0, 0, 0)",lineWidth:0}}else if(entity.modelName==iD.data.DataType.TRAFFICLIGHT){result.style.stroke="rgba(0, 255, 0, 0.8)"}else if(entity.modelName==iD.data.DataType.CHECK_TAG){result.style.fill="rgba(255, 200, 0, 0.8)";if(param.shape&&param.shape.r){result.shape.r=1.5*param.shape.r;if(8<result.shape.r){result.shape.r=8}}}else if(entity.modelName==iD.data.DataType.IMAGE_TAG){result.style.fill="rgba(255, 0, 255, 0.8)";if(param.shape&&param.shape.r){result.shape.r=1.5*param.shape.r;if(8<result.shape.r){result.shape.r=8}}}else if(entity.modelName==iD.data.DataType.ANALYSIS_TAG){result.style.fill="rgba(0, 213, 255, 0.8)";if(param.shape&&param.shape.r){result.shape.r=1.5*param.shape.r;if(8<result.shape.r){result.shape.r=8}}}else if(entity.modelName==iD.data.DataType.QUESTION_TAG){result.style.fill="rgba(255, 0, 0, 0.8)";if(param.shape&&param.shape.r){result.shape.r=1.5*param.shape.r;if(8<result.shape.r){result.shape.r=8}}}else if(entity._type==iD.data.DataType.SEARCH_POINT){var colortype=entity.tags&&entity.tags.colortype||1;var color="rgba(255, 0, 0, 0.4)";switch(colortype){case 1:color="rgba(255, 0, 0, 0.4)";break;case 2:color="rgba(0, 255, 0, 0.4)";break;case 3:color="rgba(0, 0, 255, 0.4)";break;}result.style.fill=color}else if(entity.modelName==iD.data.DataType.ROAD_ATTRIBUTE){result.style.fill="rgba(0, 187, 255, 1)"}return result};iD.picUtil.entityHasRelation=function(entityid,relName){if(!relName){return false}var context=this.context,graph=context.graph();var entity=context.hasEntity(entityid);if(!entity){return false}return 0<graph.parentRelations(entity,relName).length};iD.picUtil.isDANode=function(entityid){return iD.picUtil.entityHasRelation(entityid,iD.data.DataType.DIVIDER_ATTRIBUTE)};iD.picUtil.isLANode=function(entityid){return iD.picUtil.entityHasRelation(entityid,iD.data.DataType.LANE_ATTRIBUTE)};iD.picUtil.isEffectDANode=function(entityid){var flag=this.context.variable.isDividerAttrHighlight;return flag&&iD.picUtil.isDANode(entityid)};iD.picUtil.isEffectLANode=function(entityid){var flag=this.context.variable.isLaneHighlight;return flag&&iD.picUtil.isLANode(entityid)};iD.picUtil.isEffectBreakTypeNode=function(entityid){var flag=this.context.variable.isBreakNodeHighlight;var entity=this.context.hasEntity(entityid);return flag&&entity&&"4"==entity.tags.DASHTYPE};iD.picUtil.startNodes=[];iD.picUtil.dashedSolidDivider=function(shape,entityid,isSolidLine){var context=this.context;var nodes=[];for(var key in shape._pointMappingNode){nodes.push(shape._pointMappingNode[key])}for(var i=0;i<nodes.length;i++){let startNodeId=nodes[i];let node=context.hasEntity(startNodeId);if(node.modelName!=iD.data.DataType.DIVIDER_NODE){return}let rels=context.graph().parentRelations(node,iD.data.DataType.DIVIDER_ATTRIBUTE);let relation=rels[0];let type,dashtype;dashtype=node.tags.DASHTYPE;type=relation&&relation.tags.TYPE;if(isSolidLine&&"1"!=type&&"3"!=type){if("1"==dashtype){shape.shape.lineType="dashed&solid";shape.shape.points[i][2]="start";shape.shape.points[i][3]=startNodeId}else if("2"==dashtype){shape.shape.lineType="dashed&solid";shape.shape.points[i][2]="end";shape.shape.points[i][3]=startNodeId}else if("3"==dashtype){shape.shape.lineType="dashed&solid";shape.shape.points[i][2]="middle";shape.shape.points[i][3]=startNodeId}}}};iD.picUtil.createIntersectionDatum=function(geometry){var self=this,context=self.context||editor.context;var actions=[];var lng=geometry.lng||geometry.x||geometry[0],lat=geometry.lat||geometry.y||geometry[1],z=geometry.elevation||geometry.z||geometry[2];actions.push(self.createPoint([lng,lat,z]));actions.push(t("operations.cancel_draw.annotation"));context.perform.apply(window,actions)};iD.picUtil.createPoint=function(loc,layerId,type){var node=iD.Node({_type:iD.data.DataType.PLACENAME,tags:{name_chn:"",x_coord:loc[0].toString(),y_coord:loc[1].toString()},loc:loc});return iD.actions.AddEntity(node)};iD.picUtil.replaceGeometryNode=function(entity,newNode){var self=this;return function(graph){if(entity instanceof iD.Way){graph=graph.replace(newNode).replace(entity.addNode(newNode.id))}return graph}};iD.picUtil.actionGeometryLineAddNode=function(entity,newNode,index){return function(graph){if(entity instanceof iD.Way){graph=graph.replace(newNode).replace(entity.addNode(newNode.id,index))}return graph}};iD.picUtil.pixelToLngLat=function(clickOffset){var player=this.player;let K=iD.AutoMatch.getParamK(player);let xy=player.reductionPoint(clickOffset,player.pics.select(".item.active"));let geometry=null;if(player.dataMgr.planes){geometry=iD.util.SimpleGroundPlaneMeasurer(player.selectPicIndex+1,xy,player.dataMgr.planes,player.allNodes,player.wayInfo.K);if(geometry){return geometry}}let utmZone=iD.AutoMatch.trackPointUTMZone;var point=iD.util.clickPosForTrackPoint2(player.pic_point,xy,player.getCameraHeight(),K);let z=point[2]-player.getCameraHeight();var lonlat=iD.util.picPixelToLonLat(K,player.pic_point,utmZone,xy,z);geometry={lng:lonlat[0],lat:lonlat[1],elevation:z};return geometry};iD.picUtil.pixelToLngLatByPlane=function(pixel,planeStr,trackNode){var player=this.player;let K=iD.AutoMatch.getParamK(player);trackNode=trackNode||player.pic_point;let R=_.cloneDeep(trackNode.tags.R),C=_.cloneDeep(trackNode.tags.C),T=_.cloneDeep(trackNode.tags.T);let plane=planeStr.split(",").map(function(v){return Number(v)});let plane_p=[plane[1],plane[0],plane[2]];let plane_n=[plane[3],plane[4],plane[5]];return iD.util.linePlaneCross(K,R,C,T,pixel,plane_p,plane_n)};iD.picUtil.getComputeEpilines=function(points1,opts={}){var player=this.player;var pt1=opts.node1||player.allNodes[opts.index1||player.selectPicIndex];var pt2=opts.node2||player.allNodes[opts.index2||player.rightPointIndex];var K1=iD.picUtil.getTrackParamK(pt1.tags.trackId),K2=iD.picUtil.getTrackParamK(pt2.tags.trackId);var f=iD.util.F_From_KRT(K1,pt1.tags.R,pt1.tags.T,pt2.tags.R,pt2.tags.T,K2);var abc=iD.util.computeEpilines([points1[0],points1[1]],2,f);var a=abc[0],b=abc[1],c=abc[2];var x1=0,y1=0;var x2=pt1.tags.picW;var y2=pt1.tags.picH;var newY1=(-c-x1*a)/b;var newY2=(-c-x2*a)/b;var newX1=(-c-y1*b)/a;var newX2=(-c-y2*b)/a;var result=[[x1,newY1],[x2,newY2]];var result2=[[newX1,y1],[newX2,y2]];return[result,result2]};iD.picUtil.getTrackParamK=function(trackid){var player=this.player;var track=player.dataMgr.getTrack(trackid);return track&&_.cloneDeep(track.K)};iD.picUtil.createZrenderEditorMapping=function(){var self=this;function getShapes(key,value){var player=self.player;var result=[];if(!player||!player._zrender){return result}var filter;if(value instanceof Function){filter=value}else{filter=v=>v==value}for(let i in player._zrender.storage._roots){let item=player._zrender.storage._roots[i];if(item[key]!=undefined&&filter(item[key],item)){result.push(item)}}return result}return{getShapesByEid:function(entityid){return getShapes("_entityid",entityid)},getShapesByEids:function(eids){return getShapes("_entityid",function(v,item){return eids.includes(v)})},getShapeByZid:function(zid){var player=self.player;if(!player){return}player._zrender.storage.get(zid)}}};iD.picUtil.createRectangeBy2Point=function(points){let p1=points[0];let p3=points[1];let p2=[p1[0],p3[1]];let p4=[p3[0],p1[1]];return[p1,p2,p3,p4]};iD.picUtil.createRectangleByGeo=function(geoList){var lt=geoList[0];var rb=geoList[2];var rt=_.clone(geoList[1]);rt.lng=lt.lng;rt.lat=rb.lat;var lb=_.clone(geoList[3]);lb.lng=rb.lng;lb.lat=lt.lat;return[lt,rt,rb,lb]};iD.picUtil.batchBreakDividerDref=function(point){var self=this,context=self.context,graph=context.graph();var player=self.player;if(!player||!player._zrender){return}var selectedIds=context.selectedIDs();if(1!=selectedIds.length){Dialog.alert("\u6253\u65AD\u8F66\u9053\u7EC4\u9700\u8981\u9009\u62E9\u8F66\u9053\u7EBF\u7EC4\u4E2D\u7684\u4E00\u6761\u53C2\u8003\u7EBF\u3002");return}var rline=context.entity(selectedIds[0]);var modelNameParam=iD.picUtil.getModelNameParam();if(rline.modelName!=modelNameParam.DIVIDER||"1"!=rline.tags.R_LINE){Dialog.alert("\u6253\u65AD\u8F66\u9053\u7EC4\u9700\u8981\u9009\u62E9\u8F66\u9053\u7EBF\u7EC4\u4E2D\u7684\u4E00\u6761\u53C2\u8003\u7EBF\u3002");return}var relation=graph.parentRelations(rline,iD.data.DataType.R_DIVIDER_DREF)[0];if(!relation){Dialog.alert("\u5F53\u524D\u53C2\u8003\u7EBF\u6CA1\u6709\u8F66\u9053\u7EBF\u7EC4\u3002");return}var lonlat=self.pixelToLngLat(point);var clickLoc=[lonlat.lng,lonlat.lat];var verLoc=iD.picUtil.pointToLineVerticalLoc(rline,clickLoc);if(!verLoc){return}var splitLineIds=_.uniq([rline.id].concat(_.pluck(relation.members,"id")));for(let way of _.map(splitLineIds,context.entity)){if(!iD.util.entityInPlyGon(way,context)){Dialog.alert(t("task_bounds.outside"));return}}context.enter(iD.modes.Browse(context));context.perform(iD.actions.SplitDividingLine([clickLoc,verLoc],splitLineIds,context,true),"\u6279\u91CF\u6253\u65AD\u8F66\u9053\u7EBF");var oldEntity=context.hasEntity(rline.id);if(oldEntity){console.log("\u8F66\u9053\u7EC4\u6CA1\u6709\u6210\u529F\u6253\u65AD\uFF0C\u70B9\u51FB\u5750\u6807\u5728\u53C2\u8003\u7EBF "+rline.id+" \u8303\u56F4\u5916");context.pop();return}context.event.entityedite({entitys:[]})};iD.picUtil.pointToLineVerticalLoc=function(way,lonlats){var context=this.context,graph=context.graph();var verLoc=[];var wayLocs=_.pluck(graph.childNodes(way),"loc").map(function(loc){let utm=iD.util.LLtoUTM_(loc[0],loc[1]);return[utm.x,utm.y]});var clickLocUTM=iD.util.LLtoUTM_(lonlats[0],lonlats[1]);clickLocUTM=[clickLocUTM.x,clickLocUTM.y];var dist=iD.util.pt2LineDist(wayLocs,clickLocUTM);if(null==dist.i){return}var node1=context.entity(way.nodes[dist.i]),node2=context.entity(way.nodes[dist.i+1]);var nodeLoc1=iD.util.LLtoUTM_(node1.loc[0],node1.loc[1]),nodeLoc2=iD.util.LLtoUTM_(node2.loc[0],node2.loc[1]);nodeLoc1=[nodeLoc1.x,nodeLoc1.y],nodeLoc2=[nodeLoc2.x,nodeLoc2.y];verLoc=iD.util.perpendicular(clickLocUTM,nodeLoc1,nodeLoc2);if(!verLoc.length){return}verLoc=UTMtoLL(verLoc[0],verLoc[1],iD.AutoMatch.trackPointUTMZone);return verLoc};iD.picUtil.getNearestDividerDrefRLine=function(lonlat,targetShapes){var player=this.player,context=this.context,graph=context.graph(),projection=context.projection;var pxLonlat=projection(lonlat);var result;if(!player||!player._zrender){return result}if(targetShapes&&!_.isArray(targetShapes)){targetShapes=[targetShapes]}let shapeList=targetShapes?targetShapes:player._zrender.storage._roots;let nearestWays=[],nearest;for(let i=0;i<shapeList.length;i++){let shape=shapeList[i];if("polyline"!=shape.type||!shape._entityid){continue}let way=graph.hasEntity(shape._entityid);if(!way||way.modelName!=iD.data.DataType.DIVIDER){continue}let relations=graph.parentRelations(way,iD.data.DataType.R_DIVIDER_DREF);if(!relations.length){continue}let wayLocs=_.pluck(graph.childNodes(way),"loc").map(function(loc){return projection(loc)});let dist=iD.util.pt2LineDist(wayLocs,pxLonlat);if(!nearest){nearest={way:way,dist:dist}}if(nearest.dist.dis>dist.dis){nearest.dist=dist;nearest.way=way}}if(!nearest){return result}var rel=graph.parentRelations(nearest.way,iD.data.DataType.R_DIVIDER_DREF)[0];if(!rel){return result}nearest=null;rel.members.forEach(function(m){if(nearest){return}let way=graph.hasEntity(m.id);if(way&&"1"==way.tags.R_LINE){let wayLocs=_.pluck(graph.childNodes(way),"loc").map(function(loc){return projection(loc)});let dist=iD.util.pt2LineDist(wayLocs,pxLonlat);let rstLonlat=projection.invert([dist.x,dist.y]);nearest={way:way,dist:{x:rstLonlat[0],y:rstLonlat[1]},relation:rel}}});result=nearest;return result};iD.picUtil.checkNodeIsGroundArea=function(entityid){if(!entityid){return false}var context=this.context;var modelNameParam=iD.picUtil.getModelNameParam();var entity=context.hasEntity(entityid);if(!entity){return false}var groundArea;if(entity.modelName==modelNameParam.OBJECT_PG_NODE){groundArea=context.graph().parentWays(entity)[0]}else if(entity.modelName==modelNameParam.OBJECT_PG){groundArea=entity}if(!groundArea){return false}return 3==groundArea.tags.TYPE&&![7,9].includes(parseInt(groundArea.tags.SUBTYPE))};iD.picUtil.isPointEqual=function(point1,point2,extend){if(!point1||!point1.length||!point2||!point2.length)return false;extend=Math.abs(extend||0);if(Math.abs(point1[0]-point2[0])<=extend&&Math.abs(point1[1]-point2[1])<=extend){return true}return false};iD.picUtil._entityIsPoleTop=function(entityid){var context=this.context,modelNameParam=this.getModelNameParam();let entity=context.entity(entityid);if(entity.modelName==modelNameParam.LAMPPOST&&1==entity.tags.TYPE){return true}return false};iD.picUtil.getEntityPlaneParam=function(entityid,trackNodeIndex,useUTM=true){let context=this.context,player=this.player;let result="",location;if(_.isString(entityid)){let entity=context.entity(entityid);location=entity.loc;if(entity.tags.PLANE){result=entity.tags.PLANE;return result}}else if(_.isArray(entityid)&&2<entityid.length){location=entityid}else if(entityid instanceof iD.Entity){let entity=entityid;if(entity.tags.PLANE){result=entity.tags.PLANE;return result}}else{return result}trackNodeIndex=trackNodeIndex||player.selectPicIndex;let parr=iD.util.calculatePlane(player.allNodes,location[0],location[1],trackNodeIndex,useUTM);return[location[1],location[0],location[2]].concat(parr).join(",")};iD.picUtil.getLampHolderLonlat=function(canvasOffset){var context=this.context,player=this.player;let selectedids=context.selectedIDs();if(!selectedids.length||1<selectedids.length||!this._entityIsPoleTop(selectedids[0])){Dialog.alert("\u64CD\u4F5C\u4E4B\u524D\u9700\u8981\u5148\u9009\u4E2D\u4E00\u4E2A\u6746\u9876\u70B9");return false}var trackNodeIndex=player.selectPicIndex;if(player.selectPicIndex==player.allNodes.length-1){trackNodeIndex-=3}if(0>trackNodeIndex){trackNodeIndex=0}let paramPLANE=iD.picUtil.getEntityPlaneParam(selectedids[0],trackNodeIndex,true);let xy=player.reductionPoint(canvasOffset,player.pics.select(".item.active"));let result=iD.picUtil.pixelToLngLatByPlane(xy,paramPLANE,player.allNodes[trackNodeIndex]);return{loc:result,PLANE:paramPLANE}};iD.picUtil.dargPanning=function(dragStartXY,dragEndXY,entity){function horizontalDistance(line,point){let locs=line;let pedalPoint=[];var pt=iD.util.pedal(line,point,pedalPoint);let line1=[[locs[0],locs[1]],[locs[2],locs[3]]];let distance=iD.util.distanceByLngLat(pedalPoint,point);return distance}var context=this.context,player=this.player;let nodes=context.graph().childNodes(entity);let isLeft=true;let startOffsetXY=player.leftZoomOffset(dragStartXY);let dragEndOffsetXY=player.leftZoomOffset(dragEndXY);let geometry=iD.picUtil.pixelToLngLat(startOffsetXY);let endLngLat=iD.picUtil.pixelToLngLat(dragEndOffsetXY);let rstData=iD.geo.chooseEdge(nodes,context.projection([geometry.lng,geometry.lat]),context.projection);let startIndes=rstData.index;if(startIndes>=nodes.length-1){startIndes--}if(dragStartXY[0]<dragEndXY[0]){isLeft=false}let startNode=nodes[startIndes];let endNode=nodes[startIndes+1];let line=[startNode.loc[0],startNode.loc[1],endNode.loc[0],endNode.loc[1]];let dist=horizontalDistance(line,[endLngLat.lng,endLngLat.lat])/1000;var action=iD.actions.HorizontalMove(context,context.projection,nodes,dist,isLeft);context.perform(action,"\u6C34\u5E73\u79FB\u52A8");entity=context.entity(entity.id);if(!iD.util.entityInPlyGon(entity,context)){Dialog.alert(t("task_bounds.outside"));player.clearFooterButton();context.pop()}player.resetCanvas()};iD.picUtil.requestIdentifyImage=function(protoSrc,callback){var img=new Image;var canvas=document.createElement("canvas");img.onload=function(){canvas.width=img.width;canvas.height=img.height;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0,img.width,img.height);var dataURL=canvas.toDataURL("image/png");dataURL.replace("data:image/png;base64,","");d3.xhr("http://192.168.5.38:30220/lane/single").post(JSON.stringify(dataURL),function(error,_data){if(error){callback();return}callback(_data.response)})};img.onerror=function(){callback()};img.setAttribute("crossOrigin","anonymous");img.src=protoSrc};iD.picUtil.trackPointQualityNumber=function(points){var cyanMap={},blueMap={},purpleMap={},magentaMap={},redMap={},otherMap={},points=points||player.allNodes;var nodes=points;for(let j=0;j<nodes.length;j++){var node=nodes[j],tags=node.tags;if(tags){if(1==tags.qualityNum){}else if(2==tags.qualityNum){cyanMap[node.id]=true}else if(3==tags.qualityNum){blueMap[node.id]=true}else if(4==tags.qualityNum){purpleMap[node.id]=true}else if(5==tags.qualityNum){magentaMap[node.id]=true}else if(6==tags.qualityNum){redMap[node.id]=true}else{otherMap[node.id]=true}}}return{cyanMap:cyanMap,blueMap:blueMap,purpleMap:purpleMap,magentaMap:magentaMap,redMap:redMap,otherMap:otherMap}};iD.picUtil.trackPointClassification=function(points){var context=this.context,player=this.player;points=points||player.allNodes;var badPoints=[],badMap={};var goodPoints=[],goodMap={};var acceptPoints=[],acceptMap={};var node;var tempbadPoints=[];var startNode=points[0];var _tempArr=[];function pushArr(_tempArr,node){if(node.tags&&"3"==node.tags.status.toString()&&"50"==node.tags.positionType.toString()){goodPoints.push(_tempArr);goodMap[node.id]=true}else{tempbadPoints.push(_tempArr)}}function isGoodPoint(node){return"3"==node.tags.status.toString()&&"50"==node.tags.positionType.toString()}_tempArr.push(startNode);for(let i=1,l=points.length;i<l;i++){node=points[i];if(node.tags&&isGoodPoint(node)==isGoodPoint(startNode)){_tempArr.push(node)}else{pushArr(_tempArr,startNode);_tempArr=[];startNode=node;_tempArr.push(startNode)}}pushArr(_tempArr,_tempArr[0]);var _tempNodes=[];for(let i=0,l=tempbadPoints.length;i<l;i++){_tempNodes=tempbadPoints[i];startNode=_tempNodes[0];for(let j=0,jl=_tempNodes.length;j<jl;j++){node=_tempNodes[j];if(10000<node.tags.locTime-startNode.tags.locTime){badPoints.push(node);badMap[node.id]=true}else{acceptPoints.push(node);acceptMap[node.id]=true}}}return{badPoints,acceptPoints,goodPoints:_.flatten(goodPoints),badMap,goodMap,acceptMap}};iD.picUtil.measureinfoAction=function(entity,opts={}){var player=this.player;var sceneModels=iD.util.getSceneModel();if(sceneModels.length&&-1==sceneModels.indexOf(iD.data.DataType.MEASUREINFO)){return}var modelNameParam=this.getModelNameParam();var handle=iD.measureinfo.handle();var result;var typeNum={remove:-1,normal:0,forward:1,plane:2};switch(null==opts.type?entity.modelName:opts.type){case typeNum.remove:result=getActionByType(typeNum.remove);break;case typeNum.normal:result=getActionByType(typeNum.normal);break;case typeNum.forward:result=getActionByType(typeNum.forward);break;case typeNum.plane:result=getActionByType(typeNum.plane);break;case modelNameParam.DIVIDER_NODE:case modelNameParam.OBJECT_PL_NODE:case modelNameParam.OBJECT_PG_NODE:case modelNameParam.OBJECT_PT:if(entity.modelName==modelNameParam.OBJECT_PT){if(2==entity.tags.TYPE&&14==entity.tags.SUBTYPE){result=getActionByType(typeNum.forward);break}}result=getActionByType(typeNum.normal);break;case modelNameParam.LAMPPOST:if(entity.modelName==modelNameParam.LAMPPOST){if(1==entity.tags.TYPE){result=getActionByType(typeNum.forward)}else if(2==entity.tags.TYPE){result=getActionByType(typeNum.plane)}break}result=getActionByType(typeNum.forward);break;case modelNameParam.TRAFFICLIGHT:result=getActionByType(typeNum.plane);break;case modelNameParam.BRIDGE_NODE:case modelNameParam.TRAFFICSIGN_NODE:result=getActionByType(typeNum.plane);break;default:break;}function getActionByType(type){let fun;if(-1==type){fun=function(graph){graph=handle.remove(graph,entity.id);return graph}}else if(0==type){fun=function(graph){graph=handle[methodName(graph,entity)](graph,entity,{type:0,method:1,trackPointId:opts.trackPointId,trackId:getTrackId(),imgOffset:opts.imgOffset});return graph}}else if(2==type){fun=function(graph){graph=handle[methodName(graph,entity)](graph,entity,{type:0,method:2,trackPointId:opts.trackPointId,trackId:getTrackId(),imgOffset:opts.imgOffset});return graph}}else if(1==type){fun=function(graph){graph=handle[methodName(graph,entity)](graph,entity,{type:1,method:3,points:_.flatten(opts.datas||[]),trackId:getTrackId()});return graph}}else if(3==type){fun=function(graph){let way=graph.entity(opts.wayid);graph=handle[methodName(graph,entity)](graph,entity,{type:3,trackPointId:opts.trackPointId,trackId:getTrackId(),imgOffset:opts.imgOffset,pointtype:entity.modelName,pointid:way.nodes[0]});return graph}}return fun}function getTrackId(){return opts.trackId||player.dataMgr.trackId}function methodName(graph,entity){var relation=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO)[0];return relation?"updateEntity":"addEntity"}return result||function(graph){return graph}};iD.picUtil.shapeXY=function(shape,xy){var xk="x",yk="y",xplus=0,yplus=0;if(["circle","star"].includes(shape.type)){xk="cx",yk="cy";xplus=0,yplus=0}else if(["rect","rectangle"].includes(shape.type)){xk="x",yk="y";xplus=shape.shape.width/2;yplus=shape.shape.height/2}if(!xy){let xval=shape.shape[xk],yval=shape.shape[yk];return[xval+xplus,yval+yplus]}shape.attrKV("shape",{[xk]:xy[0]-xplus,[yk]:xy[1]-yplus})};iD.picUtil.modShape=function(shape){var player=this.player;if(!player||!player._zrender){return}if(player._zrender.modShape){player._zrender.modShape(shape);return}iD.picUtil.shapeTransform(shape);shape.dirty&&shape.dirty(true)};iD.picUtil.shapePosition=function(shape,position,nolayer=false){var player=this.player;if(!player||!player._zrender){return}var pos=position;if(!nolayer){let layer=player.getZRenderLayer(0);let base=layer.position||[0,0];pos=[base[0]+pos[0],base[1]+pos[1]]}shape.attrKV("position",pos);shape.setShape("position",pos);this.modShape(shape)};iD.picUtil.shapeScale=function(shape,scale){shape.attrKV("scale",scale);shape.setShape("scale",scale);this.modShape(shape)};iD.picUtil.shapeTransform=function(shape){shape.invTransform=null;shape.update&&shape.update()||shape.updateTransform&&shape.updateTransform()};iD.picUtil.findMouseShapes=function(x,y,opts={first:false,shapes:[],type:null}){var player=this.player;var shapeList=player._zrender.storage.getDisplayList();var result=[];for(var shape of shapeList){if(null!=opts.type&&shape.type!=opts.type)continue;if(opts.shapes.includes(shape))continue;if(shape.isCover&&shape.isCover(x,y)||shape.isCoverRect&&shape.isCoverRect(x,y)){}else{continue}result.push(shape);if(opts.first)break}return result};iD.picUtil.getBoundsByLine=function(locs){var xs=[],ys=[],path=[],player=this.player;for(var i=0;i<locs.length;i++){var loc=locs[i];loc=player.leftZoomOffset([loc[0],loc[1]]);var lnglat=iD.picUtil.pixelToLngLat(loc);path.push([lnglat.lng,lnglat.lat]);xs.push(lnglat.lng);ys.push(lnglat.lat)}var minx=d3.min(xs);var miny=d3.min(ys);var maxx=d3.max(xs);var maxy=d3.max(ys);var bounds=[[minx,miny],[maxx,maxy]];return{bounds:bounds,path:path}};iD.picUtil.getIntersectCoordinate=function(nodes1,nodes2){var locs=[];var interPoint=[0,0];for(var j=0;j<nodes1.length;j++){if(j+1>nodes1.length-1)break;var nodes1_pre=nodes1[j],nodes1_next=nodes1[j+1],pre_arr1=[nodes1_pre[0],nodes1_pre[1],nodes1_next[0],nodes1_next[1]];for(var k=0;k<nodes2.length;k++){if(k+1>nodes2.length-1)break;var nodes2_pre=nodes2[k],nodes2_next=nodes2[k+1],pre_arr2=[nodes2_pre[0],nodes2_pre[1],nodes2_next[0],nodes2_next[1]];var loc=iD.util.extendIntersection(pre_arr1,pre_arr2);if(loc&&!isNaN(loc[0])&&!isNaN(loc[0])){locs.push(loc)}}}return locs};iD.picUtil.pt2LineVerticalCoordinate=function(lineLocs,point,opts={useUTM:false}){var context=this.context,graph=context.graph();var verLoc=[];var wayLocs=lineLocs;function toUTM(loc){if(opts.useUTM){let utm=iD.util.LLtoUTM_(loc[0],loc[1]);return[utm.x,utm.y]}else{return loc}}function cancelUTM(loc){if(opts.useUTM){return UTMtoLL(loc[0],loc[1],iD.AutoMatch.trackPointUTMZone)}else{return loc}}var clickLocUTM=toUTM(point);var dist=iD.util.pt2LineDist(lineLocs,clickLocUTM);if(null==dist.i){return}var node1=lineLocs[dist.i],node2=lineLocs[dist.i+1];var nodeLoc1=toUTM([node1[0],node1[1]]),nodeLoc2=toUTM([node2[0],node2[1]]);verLoc=iD.util.perpendicular(clickLocUTM,nodeLoc1,nodeLoc2);if(!verLoc.length){return}verLoc=cancelUTM(verLoc);if(node1[2]&&node2[2]){verLoc=iD.util.getBetweenPointLoc(node1,node2,verLoc)}return verLoc};iD.picUtil.getCrossLinePointsByTrack=function(player,clickOffset,viewDom,trackIndex){var trackNodeLocs=iD.util.currentTrackPointDis||[];var trackIndex=trackIndex||player.selectPicIndex;if(isNaN(trackIndex)){var track=player.dataMgr.getTrack(trackIndex.tags.trackId);trackNodeLocs=track&&_.pluck(track.nodes,"loc")||[]}if(!trackNodeLocs.length){return false}var geometry=iD.picUtil.pixelToLngLat(clickOffset);var crossLoc=iD.picUtil.pt2LineVerticalCoordinate(trackNodeLocs,[geometry.lng,geometry.lat],{useUTM:true});if(!crossLoc){return false}crossLoc[2]-=player.getCameraHeight();var clickPoint=iD.AutoMatch.locsToPicPlayer([[geometry.lng,geometry.lat,geometry.elevation]],player,null,trackIndex)[0];var crossPoint=iD.AutoMatch.locsToPicPlayer([crossLoc],player,null,trackIndex)[0];if(!clickPoint||!crossPoint){return false}clickPoint=clickPoint.coordinates[0];crossPoint=crossPoint.coordinates[0];var width=player.allNodes[0].tags.picW;var height=player.allNodes[0].tags.picH;var p1=iD.util.extendIntersection([0,0,0,height],[crossPoint[0],crossPoint[1],clickPoint[0],clickPoint[1]]);var p2=iD.util.extendIntersection([width,0,width,height],[crossPoint[0],crossPoint[1],clickPoint[0],clickPoint[1]]);if(isNaN(p1[0])||isNaN(p1[1])||isNaN(p2[0])||isNaN(p2[1])){return false}var pointList=[p1,p2];pointList[0][2]="start";pointList[1][2]="end";pointList[2]=[clickPoint[0],0,"start"];pointList[3]=[clickPoint[0],height,"end"];for(var i=0;i<pointList.length;i++){var status=pointList[i][2];pointList[i]=player.transformPoint(pointList[i],viewDom);if(status)pointList[i][2]=status}return pointList};iD.picUtil.checkDrawGeoOutEditable=function(drawTool,drawMark,geoData){var drawMarkList,dataGeoList;if(_.isArray(drawMark)){drawMarkList=drawMark;dataGeoList=geoData}else{drawMarkList=drawMark&&[drawMark]||[];dataGeoList=[geoData]}var hasOut=false;for(var idx in dataGeoList){var data=dataGeoList[idx];var loc;if(_.isArray(data)){loc=data}else if(data.location){loc=data.location}else if(data.geometry){var geo=data.geometry||data;loc=[geo.lng,geo.lat,geo.elevation]}else{hasOut=true;break}if(drawTool.locationOutTaskEditable(loc)){hasOut=true;break}}if(hasOut){(drawMarkList||[]).forEach(shape=>{shape.ignore=true;drawTool._zrender.remove(shape);if(shape._nodeList&&shape._nodeList.length){shape._nodeList.forEach(node=>{node.ignore=true;drawTool._zrender.remove(node)})}});return true}return false};iD.picUtil.shapeInSelected=function(shape){var context=this.context;if(shape&&shape._entityid&&-1<context.selectedIDs().indexOf(shape._entityid)){return true}return false};;;;(function(iD){iD=iD||{};const range=100;function splitWay(way,point){let newWay=iD.Way({id:way.id,modelName:way.modelName,tags:way.tags,nodes:way.nodes,layerId:way.layerId});let _nodes=way.nodes.slice();let context=editor.context;let tempNode;let dist;if("3"===way.tags.DIRECTION){_nodes=_nodes.slice().reverse()}if(way&&2>way.nodes.length){return way}let startIndex=getPoint(context,point,way);let i=startIndex+1,len=_nodes.length;let positionLoc=context.entity(way.nodes[i]).loc;for(;i<len;i++){tempNode=context.entity(way.nodes[i]);dist=iD.geo.sphericalDistance(positionLoc,tempNode.loc);if(dist>range){break}}for(;0<startIndex;startIndex--){tempNode=context.entity(way.nodes[startIndex]);dist=iD.geo.sphericalDistance(positionLoc,tempNode.loc);if(dist>range){break}}if(1<startIndex){startIndex--}var newNode=_nodes.slice(startIndex,i+2);newWay.nodes=newNode;return newWay}function getPoint(context,point,way){let nodes=context.graph().childNodes(way);if("3"===way.tags.DIRECTION){nodes=nodes.slice().reverse()}let index=iD.util.pt2LineDist(_.pluck(nodes,"loc"),point.loc).i;return index}function filterWay(_ways,point){let isPolygon,ways=[],polygons=[];for(way of _ways){if(2>way.nodes.length){console.warn("\u9519\u8BEF\u6570\u636E:",way);continue}isPolygon=_.include([iD.AutoMatch.modelNameParam.TRAFFICSIGN,iD.AutoMatch.modelNameParam.OBJECT_PG],way.modelName);if(isPolygon){polygons.push(way)}else{ways.push(splitWay(way,point))}}return{ways,polygons}}function pGinPic(coordinates,width,height){let flag=false;let coord;for(var i=0;i<coordinates.length;i++){coord=coordinates[i];if(0<coord[0]&&coord[1]<width&&0<coord[1]&&coord[1]<height){flag=true}}return flag}function intersects(extent,nodes){let restArr=[];for(var i=0,len=nodes.length;i<len;i++){let node=nodes[i];if(iD.util.isInsideRect(extent,node.loc)){restArr.push(node)}}return restArr}function getShowPolygon(ways,K,trackPoint){let geometrys=[],context=editor.context,R=trackPoint.tags.R,C=trackPoint.tags.C,T=trackPoint.tags.T,width=trackPoint.tags.picW,height=trackPoint.tags.picH;let rect=[[0,0],[width,height]];let lassExtend=iD.util.lassExtend,way,nodes,node,coordinate;let coordinates=[],pointMappingNode={},nodesStroe=[];let _stroeNode;for(let i=0,len=ways.length;i<len;i++){way=ways[i];nodes=way.nodes;coordinates=[];pointMappingNode={};nodesStroe=[];for(let i=0,len=nodes.length-1;i<len;i++){node=context.entity(nodes[i]);let ePoint=context.entity(nodes[i+1]);var n2=iD.util.trackPointToPicPixe(K,trackPoint,ePoint.loc);coordinate=iD.util.trackPointToPicPixe(K,trackPoint,node.loc);if(0<coordinate[2]){nodesStroe.push({coordinate:[coordinate[0],coordinate[1],node.loc[2]],nodeId:node.id})}else if(0<n2[2]){if(!lassExtend.isLineInRect(rect,[coordinate[0],coordinate[1],n2[0],n2[1]])){continue}point=iD.util.getScreenLineSegment(K,R,T,width,height,node.loc,ePoint.loc)[0];nodesStroe.push({coordinate:point,nodeId:node.id})}}for(let j=0;j<nodesStroe.length;j++){_stroeNode=nodesStroe[j];coordinates.push(_stroeNode.coordinate);pointMappingNode[j]=_stroeNode.nodeId}if(!pGinPic(coordinates,width,height))continue;if(2<=coordinates.length){geometrys.push({coordinates,entity:way,pointMappingNode,type:"Polygon"})}}return geometrys}function getShowWays(ways,K,trackPoint){let geometrys=[],context=editor.context,R=trackPoint.tags.R,C=trackPoint.tags.C,T=trackPoint.tags.T,width=trackPoint.tags.picW,height=trackPoint.tags.picH;let rect=[[0,0],[width,height]];let lassExtend=iD.util.lassExtend,way,nodes,node,coordinate;let coordinates=[],pointMappingNode={},nodesStroe=[];let _stroeNode;for(let i=0,len=ways.length;i<len;i++){way=ways[i];nodes=way.nodes;coordinates=[];pointMappingNode={};nodesStroe=[];for(let i=0,len=nodes.length-1;i<len;i++){node=context.entity(nodes[i]);let ePoint=context.entity(nodes[i+1]);var n2=iD.util.trackPointToPicPixe(K,trackPoint,ePoint.loc);coordinate=iD.util.trackPointToPicPixe(K,trackPoint,node.loc);if(0<coordinate[2]){nodesStroe.push({coordinate:[coordinate[0],coordinate[1],node.loc[2]],nodeId:node.id})}else if(0<n2[2]){if(!lassExtend.isLineInRect(rect,[coordinate[0],coordinate[1],n2[0],n2[1]])){nodesStroe.push({coordinate:[],nodeId:node.id});continue}point=iD.util.getScreenLineSegment(K,R,T,width,height,node.loc,ePoint.loc)[0];nodesStroe.push({coordinate:point,nodeId:node.id})}else{nodesStroe.push({coordinate:[],nodeId:node.id})}}let lastNode=context.entity(_.last(nodes));coordinate=iD.util.trackPointToPicPixe(K,trackPoint,lastNode.loc);if(0<coordinate[2]){nodesStroe.push({coordinate:[coordinate[0],coordinate[1],lastNode.loc[2]],nodeId:lastNode.id})}let _index=0;for(let j=0;j<nodesStroe.length;j++){_stroeNode=nodesStroe[j];if(0==_stroeNode.coordinate.length){if(1<coordinates.length){geometrys.push({coordinates,entity:way,pointMappingNode,type:"LineString"})}pointMappingNode={};coordinates=[];_index=0}else{coordinates.push(_stroeNode.coordinate);pointMappingNode[_index]=_stroeNode.nodeId;_index++}}if(1<coordinates.length){geometrys.push({coordinates,entity:way,pointMappingNode,type:"LineString"})}}return geometrys}iD.AutoMatch={trackPointUTMZone:50,isInitEvent:false,modelNameParam:iD.picUtil.getModelNameParam(),player(){},updatePicCanvas(picplayer){picplayer.getDrawTool().resetCanvas()},shapeHover(picplayer,selecteds){if(_.isEmpty(selecteds)){return}let selectId=selecteds[0].id;let zrender=picplayer._zrender;let shapeList=picplayer.ZEUtil.getShapesByEids(selecteds);for(let sp of shapeList){picplayer._zrenderEntityHover.call(sp)}},initEvent(context,picplayer){var _updatePicPlayer=d=>{if(!picplayer._zrender){return}picplayer._zrender.painter.clearHover();if(d&&d.acceptids&&d.acceptids.length){picplayer.getDrawTool().resetPointToPicPlayer(d.acceptids)}else{this.updatePicCanvas(picplayer)}this.shapeHover(picplayer,context.selectedIDs())};var _doneFun=function(){picplayer.hideRightPic();_updatePicPlayer.call(this)};context.history().on("undone.automatch",_doneFun).on("redone.automatch",_doneFun).on("change.automatch",function(difference,extent){if(!difference&&extent){_updatePicPlayer()}});context.ui().layermanager.on("roadEdit.test123",function(layeInfo,display){if(null!=display){_updatePicPlayer()}});context.event.on("changeeffect.picplayer",function(){_updatePicPlayer()});context.event.on("entityedite.picplayer",_updatePicPlayer);context.event.on("delete.picplayer",d=>{if(!picplayer._zrender){return}this.updatePicCanvas(picplayer);picplayer._zrender.painter.clearHover()});context.event.on("selected.picplayer",selecteds=>{if(!picplayer._zrender){return}if(0<selecteds.length){picplayer._zrender.painter.clearHover();this.shapeHover(picplayer,_.pluck(selecteds,"id"))}else{picplayer._zrender.painter.clearHover()}});return true},trackPointToPicPlayer(trackPoint,pic_player,isSolidLine=false,acceptids){if(!trackPoint)return;let self=this,displayLayerIds=[],flag,context=editor.context,loc=trackPoint.loc,bounds=iD.util.getBounds(loc,range),K=self.getParamK(pic_player),allEntities=[];context.layers().getLayers().forEach(function(lay){lay.display&&displayLayerIds.push(lay.id)});if(!this.isInitEvent){initEvent=this.initEvent(context,pic_player)}if(acceptids&&acceptids.length){allEntities=_.map(acceptids,function(eid){return context.hasEntity(eid)});allEntities=_.compact(allEntities)}else{allEntities=context.intersects(bounds)}var ways=allEntities.filter(function(datum){return datum instanceof iD.Way&&_.include(displayLayerIds,datum.layerId+"")&&_.include([self.modelNameParam.DIVIDER,self.modelNameParam.TRAFFICSIGN,self.modelNameParam.OBJECT_PL,self.modelNameParam.OBJECT_PG,self.modelNameParam.BRIDGE],datum.modelName)});var points=allEntities.filter(function(datum){flag=datum instanceof iD.Node;if(flag){flag=datum._type==iD.data.DataType.SEARCH_POINT||datum._type==iD.data.DataType.PLACENAME}if(_.include([self.modelNameParam.CHECK_TAG,self.modelNameParam.IMAGE_TAG,self.modelNameParam.ANALYSIS_TAG,self.modelNameParam.QUESTION_TAG],datum.modelName)){if(datum.tags.TASKID==iD.Task.d.tags.taskId){flag=_.include(displayLayerIds,datum.layerId+"")}else{return false}}return flag||datum instanceof iD.Node&&_.include(displayLayerIds,datum.layerId+"")&&_.include([self.modelNameParam.OBJECT_PT,self.modelNameParam.LAMPPOST,self.modelNameParam.LIMITHEIGHT,self.modelNameParam.TRAFFICLIGHT,self.modelNameParam.ROAD_ATTRIBUTE],datum.modelName)});var wayObj=filterWay(ways,trackPoint);this.trackPointUTMZone=iD.util.LLtoUTM_(loc[0],loc[1]).zone;var geometrys=[];if(0==ways.length&&0==points.length){return geometrys}if(!trackPoint.tags.R)return;geometrys.push(...getShowWays(wayObj.ways,K,trackPoint));geometrys.push(...getShowPolygon(wayObj.polygons,K,trackPoint));var coordinate,coordinates=[],_loc,point;for(let i=0;i<points.length;i++){point=points[i];coordinates=[];if(!trackPoint.tags.R)return;_loc=point.loc;if(_.include([self.modelNameParam.IMAGE_TAG],point.modelName)){_loc=_.clone(point.loc);let heightDiff=pic_player.getCameraHeight();if(heightDiff){_loc[2]=_loc[2]-heightDiff}}coordinate=iD.util.trackPointToPicPixe(K,trackPoint,_loc);if(0<coordinate[2]){coordinates.push([coordinate[0],coordinate[1],point.loc[2]]);geometrys.push({coordinates,entity:point,type:"Point"})}}return geometrys},createWay(){},updateShape(xy,entity,shape){},reset(){this.trackPointUTMZone=50},getParamK(pic_player){var K=_.cloneDeep(pic_player.wayInfo.K);return K},locsToPicPlayer(nodes,pic_player,heightDiff,trackNodeIndex,allNodes){var geometrys=[];if(null!=trackNodeIndex&&isNaN(trackNodeIndex)){if(!trackNodeIndex||!trackNodeIndex.loc){trackPoint=pic_player.allNodes[pic_player.selectPicIndex]}else{trackPoint=trackNodeIndex}var K=iD.picUtil.getTrackParamK(trackPoint.tags.trackId)}else{var trackPoint=pic_player.allNodes[null!=trackNodeIndex?trackNodeIndex:pic_player.selectPicIndex];var K=this.getParamK(pic_player)}var coordinates,coordinate;for(let i=0;i<nodes.length;i++){coordinates=[];var node=nodes[i];if(!trackPoint.tags.R)return;var _loc=_.clone(node);if(heightDiff){_loc[2]=_loc[2]-heightDiff}coordinate=iD.util.trackPointToPicPixe(K,trackPoint,_loc);if(0<coordinate[2]){coordinates.push([coordinate[0],coordinate[1],_loc[2]]);geometrys.push({coordinates,entity:allNodes&&allNodes[i],type:"Point",_index:i})}}return geometrys},calcTrackPointsToPicPlayer(pic_player){var trackPoint=pic_player.allNodes[pic_player.selectPicIndex];var loc=trackPoint.loc;var bounds=iD.util.getBounds(loc,range);var allNodes=intersects(bounds,pic_player.allNodes).filter(function(entity){return entity&&entity.loc});var results=this.locsToPicPlayer(_.pluck(allNodes,"loc"),pic_player,pic_player.getCameraHeight(),null,allNodes);return results},lightEntitys(){}}})(iD);;;iD.svg.PicToolEpiline=function(context){function EpilineTool(){this._canvasGeometrys=[];this.$surface;this.$tools;this.player;this.trackObj;this.isMutiTracks=false}EpilineTool.prototype.init=function(player,surface){this.player=player;this.$surface=surface.node?surface:d3.select(surface);var self=this;var isMutiTracks=self.hasMultiTracks();var $tools=self.$surface.selectAll(".rightbody-tools").data([0]);$tools.enter().append("div").attr("class","rightbody-tools");this.$tools=$tools;var $div=$tools.append("span").attr("class","item-group");$div.append("label").text("\u8DE8\u5E27:");$div.append("input").attr({type:"number",step:1,value:6,name:"stepnum"}).attr("class","right-param right-stepnum").on("change",function(){self.updateImageUrl();self.updateEpilineParam()});var cameraHeight=player.getCameraHeight()||0;var $div=$tools.append("span").attr("class","item-group no-tracks");$div.append("label").text("\u8F66\u9AD8:");$div.append("input").attr({type:"number",step:0.1,value:cameraHeight,name:"height"}).attr("class","right-param right-height").on("change",function(){self.updateEpilineParam()});var $div=$tools.append("span").attr("class","item-group no-tracks");$div.append("label").text("\u7FFB\u6EDA\u89D2:");$div.append("input").attr({type:"number",step:0.05,value:0,name:"roll"}).attr("class","right-param right-roll").on("input",function(){self.updateEpilineParam()});var $div=$tools.append("span").attr("class","item-group no-tracks");$div.append("label").text("\u4FEF\u4EF0\u89D2:");$div.append("input").attr({type:"number",step:0.01,value:0,name:"pitch"}).attr("class","right-param right-pitch").on("input",function(){self.updateEpilineParam()});var $div=$tools.append("span").attr("class","item-group no-tracks");$div.append("label").text("\u65B9\u4F4D\u89D2:");$div.append("input").attr({type:"number",step:0.01,value:0,name:"azimuth"}).attr("class","right-param right-azimuth").on("input",function(){self.updateEpilineParam()});var $div=$tools.append("span").attr("class","item-group no-tracks");$div.append("button").text("\u4FDD\u5B58\u53C2\u6570").attr("type","button").attr("class","right-button right-btn-save").on("click",function(){self.saveParamsRequest()});var $div=$tools.append("span").attr("class","item-group more-tracks");$div.append("label").text("\u8F68\u8FF9:");$div.append("select").attr({name:"trackId"}).attr("class","right-param right-trackId").on("change",function(){var option=this.selectedOptions[0];if(option){self.trackObj=d3.select(option).datum()}self.updateImageUrl();self.updateEpilineParam()});var imgUrl=self.player.pic_point&&self.player.pic_point.tags.picUrl||"";imgUrl=self.player.getNewPicUrl(imgUrl,"0");var $rightDiv=self.$surface.selectAll(".rightbody-item").data([0]);$rightDiv.enter().append("div").attr("class","rightbody-item");$rightDiv.selectAll(".picplayerimg.main").data([imgUrl]).enter().append("img").classed("picplayerimg main",true);$rightDiv.selectAll("img").attr("src",imgUrl);self.refreshTrackInit();if(self.$surface.select("#rightbody-canvas-content").empty()){self.$surface.append("div").attr("id","rightbody-canvas-content").attr("class","rightbody-canvas-content").append("canvas").attr("id","rightbody-canvas").attr("class","rightbody-canvas")}};EpilineTool.prototype.initImageUrl=function(url){var self=this;if(!url)return;self.$surface.select("img.picplayerimg.main").attr("src",url)};function intersects(extent,nodes){let restArr=[];for(var i=0,len=nodes.length;i<len;i++){let node=nodes[i];if(iD.util.isInsideRect(extent,node.loc)){restArr.push(node)}}return restArr}_.assign(EpilineTool.prototype,{show:function(){var self=this;if(!self.$surface||!self.$surface.size()){return}self._canvasGeometrys=[];self.$surface.classed("active",true);self.resizeDomStyle();self.refreshTrackInit();self.updateEpilineParam()},inputStepNum:function(newVal){var self=this;var $input=self.$surface.select("div.rightbody-tools input.right-stepnum");if(null!=newVal&&!isNaN(newVal)){$input.value(newVal);return}var val=$input.value();val=parseInt(val);if(isNaN(val)){val=0}return val},getBodyParam:function(){var self=this;var $inputs=self.$surface.selectAll("div.rightbody-tools input.right-param");var result={};$inputs.each(function(){if(this.name&&!this.disabled){result[this.name]=isNaN(this.value)?$.trim(this.value):+this.value}});return result},setBodyParam:function(data){var self=this;var $inputs=self.$surface.selectAll("div.rightbody-tools input.right-param");var changed=false;$inputs.each(function(){if(this.name&&null!=data[this.name]){this.value=data[this.name];changed=true}});changed&&self.updateEpilineParam()},checkBodyShown:function(){var self=this;if(!self.$surface||!self.$surface.size()){return false}return self.$surface.classed("active")},getStepsPicIndex:function(){var self=this;var player=this.player;var stepNum=6;var val=parseInt(self.inputStepNum());if(!isNaN(val)){stepNum=val}else{self.inputStepNum(stepNum)}var rightBodyIndex=player.selectPicIndex+stepNum;var node=player.allNodes[rightBodyIndex];if(!node){if(0>stepNum){rightBodyIndex=0}else{rightBodyIndex=player.allNodes.length-1}}return rightBodyIndex},getMeterStepsNode:function(){var self=this;var player=this.player;var stepNum=0;var val=parseInt(self.inputStepNum());if(!isNaN(val)){stepNum=val}else{self.inputStepNum(stepNum)}var result=self.getTrackBaseNode();var rightBodyIndex=result.index;var bounds=iD.util.getBounds(result.node.loc,Math.abs(stepNum));var allNodes=intersects(bounds,self.trackObj.nodes).map(function(d){return{index:self.trackObj.nodes.indexOf(d)}});if(0>stepNum){rightBodyIndex=_.min(_.pluck(allNodes,"index"))}else if(0<stepNum){rightBodyIndex=_.max(_.pluck(allNodes,"index"))}return{node:self.trackObj.nodes[rightBodyIndex],index:rightBodyIndex}},getTrackBaseNode:function(){var self=this;var player=this.player;var point=player.pic_point;var index=0;var result=iD.util.pt2LineDist2(_.pluck(self.trackObj.nodes,"loc"),point.loc);var node;if(result){index=result.i}node=self.trackObj.nodes[index];return{node:node,index:index}},updateImageUrl:function(){if(!this.checkBodyShown()){return}var self=this;var player=this.player;var node,index=-1;if(self.isMutiTracks){var obj=self.getMeterStepsNode();node=obj.node;index=obj.index}else{index=self.getStepsPicIndex();node=player.allNodes[index]}if(context.variable){context.variable.epilineParam={trackId:node.tags.trackId,trackPointId:node.tags.trackPointId,node:node,index:index}}self.$surface.select("img.picplayerimg.main").attr("src",self.player.getNewPicUrl(node.tags.picUrl,"0"))},hide:function(){var self=this;if(!self.$surface||!self.$surface.size()){return}self.$surface.classed("active",false);self.clearCanvas()},createCanvasPolylineCross:function(clickOffset,opts={}){var self=this;var player=this.player;if(!self.checkBodyShown())return;var style={strokeColor:iD.picUtil.colorRGBA(0,187,255,0.7),lineWidth:2,lineType:"dashed&solid"};_.assign(style,opts);var viewDom=self.$surface.select(".rightbody-item").node();var trackNode;if(self.isMutiTracks){trackNode=self.getMeterStepsNode().node}else{trackNode=player.allNodes[self.getStepsPicIndex()]}var pointList=iD.picUtil.getCrossLinePointsByTrack(player,clickOffset,self.$surface.node(),trackNode);if(!pointList){pointList=[[0,0],[0,0]]}return self.canvasDrawGeometry(_.extend({type:"line",pointList:pointList,_param:{point:clickOffset,type:"polyline-cross"}},style))},createCanvasPolyline:function(points,opts={}){var self=this;var player=this.player;if(!self.checkBodyShown())return;var style={strokeColor:iD.picUtil.colorRGBA(0,187,255,0.7),lineWidth:2};_.assign(style,opts);var viewDom=self.$surface.select(".rightbody-item").node();var leftViewDom=player.pics.select(".item.active");var pointList=[];points.forEach((protoPoint,idx)=>{var point=player.reductionPoint(protoPoint,leftViewDom);point=player.transformPoint(point,viewDom);if(protoPoint[2]){point[2]=protoPoint[2]}pointList.push(point)});self.canvasDrawGeometry(_.extend({type:"line",pointList:pointList,_param:{points:points,type:"polyline"}},style))},createCanvasEpiline:function(points){var self=this;var player=this.player;if(!self.checkBodyShown())return;var style={strokeColor:iD.picUtil.colorRGBA(255,0,0,0.8),lineWidth:2};var firstPoints=[];if(_.isArray(points[0])){firstPoints=points}else{firstPoints=[points]}var viewDom=self.$surface.select(".rightbody-item").node();var leftViewDom=player.pics.select(".item.active");var node2,node1=player.allNodes[player.selectPicIndex];if(self.isMutiTracks){node2=self.getMeterStepsNode().node}else{node2=player.allNodes[self.getStepsPicIndex()]}for(var idx in firstPoints){var protoPoint=firstPoints[idx];var point=player.reductionPoint(protoPoint,leftViewDom);var results=iD.picUtil.getComputeEpilines(point,{node1:node1,node2:node2});var pointList=_.cloneDeep(results[0]);pointList.forEach((pt,i)=>{pointList[i]=player.transformPoint(pt,viewDom)});self.canvasDrawGeometry(_.extend({type:"line",pointList:pointList,_param:{point:protoPoint,type:"epiline"}},style))}},canvasDrawGeometry:function(style){var self=this;var player=this.player;var canvasDom=self.$surface.select("#rightbody-canvas").node();var ctx=canvasDom.getContext("2d");if(style){self._canvasGeometrys.push(style)}var drawGeoDataList=self._canvasGeometrys;var canvasWidth=canvasDom.width;var canvasHeight=canvasDom.height;ctx.clearRect(-Infinity,-Infinity,Infinity,Infinity);canvasDom.width=canvasWidth;canvasDom.height=canvasHeight;ctx.clearRect(0,0,canvasWidth,canvasHeight);for(var idx in drawGeoDataList){var style=_.clone(drawGeoDataList[idx],true);var styleType=style.type;delete style.type;if("star"==styleType||"point"==styleType){style.x=scaleNum(style.x);style.y=scaleNum(style.y);player.createStarOnCtx(ctx,style)}else if("line"==styleType||"polygon"==styleType){ctx.beginPath();if(style.lineJoin){ctx.lineJoin=style.lineJoin}if(style.lineWidth){ctx.lineWidth=style.lineWidth}if(style.color){ctx.fillStyle=style.color}if(style.strokeColor){ctx.strokeStyle=style.strokeColor}var pointList=style.pointList;if("dashed&solid"==style.lineType){for(var i=0;i<pointList.length;i++){var point=pointList[i];if(0==i){if("end"!=point[2]){ctx.moveTo(point[0],point[1])}}else{var lastStep=pointList[i-1];if(lastStep[2]){if("start"==lastStep[2]){ctx.lineTo(point[0],point[1])}else if("end"==lastStep[2]){ctx.moveTo(point[0],point[1])}}else{ctx.lineTo(point[0],point[1])}}}}else{ctx.moveTo(scaleNum(pointList[0][0]),scaleNum(pointList[0][1]));for(var i=1;i<pointList.length;i++){ctx.lineTo(scaleNum(pointList[i][0]),scaleNum(pointList[i][1]))}}ctx.fill();ctx.stroke();ctx.closePath()}}function scaleNum(num){return num}if(style){return{index:drawGeoDataList.length-1,style:style,type:style.type}}},clearCanvas:function(){var self=this;self._canvasGeometrys.length=0;self._canvasGeometrys=[];self.canvasDrawGeometry()},updateEpilineParam:function(){var self=this;var player=this.player;var param=self.getBodyParam();var oldParam={epiline:[],polylineCross:[]};self._canvasGeometrys.forEach(function(shape){var d=shape._param||{};if("epiline"==d.type&&d.point){oldParam.epiline.push(d.point)}else if("polyline-cross"==d.type){oldParam.polylineCross.push({point:d.point,style:{lineType:shape.lineType,strokeColor:shape.strokeColor,lineWidth:shape.lineWidth}})}});clickPoints=_.compact(oldParam.epiline);self.updateAllNodesParam(param.height,param.roll,param.pitch,param.azimuth);self.clearCanvas();oldParam.epiline.length&&self.createCanvasEpiline(oldParam.epiline);if(oldParam.polylineCross.length){oldParam.polylineCross.forEach(d=>{self.createCanvasPolylineCross(d.point,d.style)})}player.resetCanvas()},updateAllNodesParam:function(height,roll=0,pitch=0,azimuth=0){var player=this.player;var allNode=player.allNodes;var firstNode;var node,obj,param;for(var i=0;i<allNode.length;i++){node=allNode[i];param={x:node.tags.x,y:node.tags.y,roll:node.tags.roll+roll,pitch:node.tags.pitch+pitch,azimuth:node.tags.azimuth+azimuth};if(0==i){firstNode=allNode[i];obj=iD.util.pos2CameraRTC(param,firstNode.tags,node.tags.z);node.tags.R=obj.R;node.tags.C=obj.C;node.tags.T=obj.T}else{obj=iD.util.pos2CameraRTC(param,firstNode.tags,node.tags.z);node.tags.R=obj.R;node.tags.C=obj.C;node.tags.T=obj.T}}},resizeDomStyle:function(){var self=this;if(!self.checkBodyShown())return;var $rightBodyList=self.$surface.selectAll("div.rightbody-item,div.rightbody-canvas-content");var viewDom=self.$surface.node();var newHeight=viewDom.offsetHeight;var newWidth=viewDom.offsetWidth;resizeDoms($rightBodyList);function resizeDoms($list){$list.style({left:0,top:0});$list.attr({"d-height":newHeight,"d-width":newWidth}).style({height:newHeight+"px",width:newWidth+"px"});$list.selectAll("canvas").style({width:newWidth+"px",height:newHeight+"px"}).each(function(){this.width=$list.attr("d-width")||newWidth+"px";this.height=$list.attr("d-height")||newHeight+"px"})}},saveParamsRequest:function(){var self=this;var player=this.player;if(!self.checkBodyShown()){return}var param=self.getBodyParam();var height=player.getCameraHeight();height=isNaN(param.height)?height:param.height;var bodyParam={taskId:iD.Task.d.protoData.id,properties:[{id:"cameraHeight",value:""+height},{id:"rollDelta",value:""+(param.roll||0)},{id:"pitchDelta",value:""+(param.pitch||0)},{id:"azimuthDelta",value:""+(param.azimuth||0)},{id:"doIt",value:"true"}]};d3.json(iD.config.URL.kts+"form/form-data").header("Content-Type","application/json;charset=UTF-8").post(JSON.stringify(bodyParam),function(error,data){var url=window.location.href;var param="taskID="+iD.Task.d.task_id;if(iD.url.getUrlParam("taskID")){url=url.replace(/taskID=\d+/,param)}else{url=url+(-1<url.indexOf("?")?"&":"?")+param}window.location.href=url})},loadTrackParams:function(trackid,callback){var self=this;callback=callback||_.noop;if(!trackid){callback();return}d3.json(iD.config.URL.krs+"track/extend/"+trackid).get(function(error,data){if(error||data&&"0"!=data.code){callback();return}var result=data.result;if(!result||_.isEmpty(result)){callback();return}var param={height:result.cameraHeight,roll:result.rollDelta,pitch:result.pitchDelta,azimuth:result.azimuthDelta};self.setBodyParam(param);callback(param)})},hasMultiTracks:function(){var isReset="true"===iD.url.getUrlParam("reset");if(7==window._systemType&&!isReset){return false}var player=this.player;return 1<player.dataMgr.tracks.length},getTracks:function(){var player=this.player;if(!player.dataMgr.trackObj){return[]}return player.dataMgr.tracks.filter(d=>d.trackId!=player.dataMgr.trackObj.trackId)},refreshTrackInit:function(targetTrackId){var player=this.player;var $tools=this.$tools;var self=this;var isMutiTracks=self.hasMultiTracks();this.isMutiTracks=isMutiTracks;var $step=$tools.select("input.right-stepnum");var $div=d3.select($step.node().parentNode);$div.selectAll("label.meter").remove();if(isMutiTracks){$step.value(0);$div.append("label").text("\u7C73").attr("class","meter")}var $select=$tools.select("select.right-trackId");if(isMutiTracks){var tracks=self.getTracks();var $options=$select.html("").selectAll("option").data(tracks);$options.enter().append("option").attr("value",d=>d.trackId).text(d=>d.trackId);$options.exit().remove();var d=tracks[0];if(targetTrackId){d=tracks.filter(t=>t.trackId===targetTrackId)[0]||d}$select.value(d.trackId);self.trackObj=d;$tools.selectAll(".item-group.no-tracks").classed("hidden",true).selectAll("input,button,select").property("disabled",true);$tools.selectAll(".item-group.more-tracks").classed("hidden",false).selectAll("input,button,select").property("disabled",false)}else{self.trackObj=player.dataMgr.trackObj;$tools.selectAll(".item-group.no-tracks").classed("hidden",false).selectAll("input,button,select").property("disabled",false);$tools.selectAll(".item-group.more-tracks").classed("hidden",true).selectAll("input,button,select").property("disabled",true)}self.updateImageUrl()}});return new EpilineTool};;iD.svg.PicDrawTool=function(context,_opts){var isSolidLine=false;var modelNameParam=_.clone(iD.data.DataType);const constant=_opts.constant;const markDrawStatus=_opts.markDrawStatus;const zrenderNodeStatus=_opts.zrenderNodeStatus;const markVectorPoint=_opts.markVectorPoint;const viewZoomParam=_opts.viewZoomParam;var CircleShape;var PolygonShape;var PolylineShape;var StarShape;var RectangleShape;var picLeftMarkers=[];var lastMousePos;var SELF;var player,epilineTool=_opts.epilineTool;var drawPlugins=[];var ZEUtil=iD.picUtil.createZrenderEditorMapping();var isSameCircleSize=true;var tempShape;function DrawTool(){}function execPlugin(method){let args=_.toArray(arguments).slice(1);let result=false;for(let item of drawPlugins){if(!item.check||!item.check(args[0]&&args[0].btnType))continue;let rst=item[method]&&item[method].apply(item,args);if(false===rst){result=true;break}}return result}function execPluginTrigger(method){let args=_.toArray(arguments).slice(1);let result=false;for(let item of drawPlugins){let rst=item[method]&&item[method].apply(item,args);if(false===rst){result=true;break}}return result}_.assign(DrawTool.prototype,{init:function(pic_player,intersection){var self=this;this.ZEUtil=ZEUtil;player=pic_player;intersectionTool=intersection;self.player=player;self._zrender=player._zrender;drawPlugins.length=0;for(let k in iD.svg.PicDraw){let plus=iD.svg.PicDraw[k](context,this);plus.init(markDrawStatus,zrenderNodeStatus);drawPlugins.push(plus)}console.log("\u5DF2\u52A0\u8F7D\u7ED8\u5236\u4EE3\u7801\uFF1A"+drawPlugins.length+"\u4E2A\uFF1B")},initZRender:function(callback){var self=this;require([],function(){CircleShape=zrender.Circle;PolygonShape=zrender.Polygon;PolylineShape=zrender.Polyline;StarShape=zrender.Star;RectangleShape=zrender.Rect;callback&&callback(zrender)})},domMousedown:function(){var self=this;lastMousePos=[d3.event.clientX,d3.event.clientY];if(!_.include([constant.ADD_GROUND_AREA],markDrawStatus.type)){return}player.canvasClickCheck=false;var clickOffset=self.leftZoomOffset(lastMousePos);var flag=execPlugin("domMousedown",d3.event,clickOffset);if(flag)return},domMouseup:function(){var self=this;var upPos=[d3.event.clientX,d3.event.clientY];player.canvasClickCheck=true;if(!_.include([constant.ADD_GROUND_AREA],markDrawStatus.type)){return}var clickOffset=self.leftZoomOffset(upPos);var flag=execPlugin("domMouseup",d3.event,clickOffset,{downOffset:lastMousePos});if(flag)return},domClickBefore:function(){var self=this;if(_.include([constant.ADD_GROUND_AREA,constant.MOVE_LINE],markDrawStatus.type)){return false}var upPos=[d3.event.clientX,d3.event.clientY];var clickOffset=self.leftZoomOffset(upPos);if(epilineTool&&epilineTool.checkBodyShown()){if(!markDrawStatus.type){self.zrenderDrawPoint(clickOffset);epilineTool.createCanvasEpiline(clickOffset)}else if(markDrawStatus.type==constant.TOOL_EPLILINE_CROSS){player.drawRightEpilineCross(clickOffset)}return false}if(!player.canvasClickCheck){return false}if(!markDrawStatus.type||markDrawStatus.type==constant.POLYLINE_ADD_NODE){return false}if(markDrawStatus.type==constant.BATCH_BREAK_DREF){iD.picUtil.batchBreakDividerDref(upPos);player.clearFooterButton();return false}},domClick:function(evt){var self=this;var d3evt=evt||d3.event;var clickOffset=self.leftZoomOffset([d3evt.offsetX,d3evt.offsetY]);var flag=execPlugin("domClick",d3evt,clickOffset);if(flag)return;var presult;if([constant.POINT,constant.INTERSECTION].includes(markDrawStatus.type)){self.zrenderDrawPoint(self,clickOffset)}intersectionTool.leftClickCoord(clickOffset,function(data,point,point2,isMultPoints){var flag=execPlugin("domClickMore",d3evt,clickOffset,data,point,point2,isMultPoints);if(flag)return})},domDblclick:function(){var self=this;zrenderNodeStatus.downOffset=undefined;zrenderNodeStatus.moveOffset=undefined;if(_.include([constant.TELEGRAPH_LAMP_HOLDER,constant.ADD_TRAFFICLIGHT,constant.ADD_GROUND_AREA,constant.ADD_BOARD,constant.INTERSECTION,constant.ADD_CHECK_TAG_POINT,constant.ADD_IMAGE_TAG_POINT,constant.ADD_ANALYSIS_TAG_POINT,constant.ADD_CONTROL_POINT,constant.ADD_ROAD_ATTRIBUTE,constant.BATCH_BREAK_DREF,constant.MOVE_LINE,constant.TOOL_EPLILINE_CROSS],markDrawStatus.type)||_.include([constant.MARK_VECTOR_POINT],markDrawStatus.secType)){return}if(!player.canvasClickCheck){return}if(!markDrawStatus.type||markDrawStatus.type==constant.POLYLINE_ADD_NODE){return}var clickOffset=self.leftZoomOffset([d3.event.offsetX,d3.event.offsetY]);var flag=execPlugin("domDblclick",d3.event,clickOffset);if(flag)return;var coordOffsetList=clickOffset},drawTrackPointsToShape:function(){var self=this;if(!player.allNodes.length){return}var resultList=iD.AutoMatch.calcTrackPointsToPicPlayer(player);let itemNode=player.divItem.node();for(var result of resultList){var style={lineWidth:1,fill:"rgba(0, 128, 0, 0.6)"};if(classified.cyanMap&&classified.cyanMap[result.entity.id]){style.fill="rgba(0, 255, 255, 0.8)"}else if(classified.blueMap&&classified.blueMap[result.entity.id]){style.fill="rgba(0, 0, 255, 0.8)"}else if(classified.purpleMap&&classified.purpleMap[result.entity.id]){style.fill="rgba(128, 0, 128, 0.8)"}else if(classified.magentaMap&&classified.magentaMap[result.entity.id]){style.fill="rgba(255, 0, 255, 0.8)"}else if(classified.redMap&&classified.redMap[result.entity.id]){style.fill="rgba(255, 0, 0, 0.8)"}else if(classified.otherMap&&classified.otherMap[result.entity.id]){style.fill="rgba(128, 128, 128, 0.8)"}else if(classified.badMap&&classified.badMap[result.entity.id]){style.fill="rgba(255, 0, 0, 0.8)"}else if(classified.acceptMap&&classified.acceptMap[result.entity.id]){style.fill="rgba(255, 255, 0, 0.8)"}let shape=self.createMarker(self.transformPoint(result.coordinates[0],itemNode),{hoverable:false,draggable:false,style:style});self._zrender.add(shape)}},createIcon:function(point,opts,nodeid){var self=this;var _r=27;var _rr=25;var _w=30;var offset=5.2;var entity=context.hasEntity(nodeid);var fillColor="",strokeColor="",colorPoint=[this.whitePointCanvas,this.cyanPointCanvas,this.bluePointCanvas,this.redPointCanvas],pointCanvas=colorPoint[0];if(entity&&entity.modelName==modelNameParam.DIVIDER_NODE){let type=entity.tags.DASHTYPE;pointCanvas=colorPoint[type]||colorPoint[0]}var options={style:{x:point[0]-offset,y:point[1]-offset,image:pointCanvas,width:_w+_w,height:_w,opacity:0.8},hoverable:true,draggable:true,ondragstart:_zrenderNodeEventDragstart,ondragend:_zrenderNodeEventDragend,onmousedown:_mousedownNodeCanDrag,ondragenter:function(evt){zrenderNodeStatus.dragoverShape=evt.target},ondragleave:function(evt){zrenderNodeStatus.dragoverShape=undefined}};var img=new zrender.Image(options);player.dividerCanvasGeometrys[img.id]={x:options.style.x,y:options.style.y,_r:_r,_rr:_rr,_w:_w,offset:offset};self.zrenderShapeInit(img);return img},createShap:function(geometry){var self=this;let points=[];let i=0,len=geometry.coordinates.length;let itemNode=player.divItem.node();for(;i<len;i++){points.push(self.transformPoint(geometry.coordinates[i],itemNode))}switch(geometry.type){case"Polygon":return self.createPolygon(points);break;case"LineString":return self.createPolyline(points);case"Point":let result,opts,entity=geometry.entity;if(entity&&[modelNameParam.LAMPPOST,modelNameParam.TRAFFICLIGHT].includes(entity.modelName)){opts={draggable:true,ondragstart:_zrenderNodeEventDragstart,ondragend:_zrenderPointEventDragend};result=self.createRectangle(points[0],opts)}else if(entity&&_.include([modelNameParam.LIMITHEIGHT],entity.modelName)){opts={draggable:false,style:{}};iD.picUtil.updateZrenderStyleByEntity(opts,entity.id);result=self.createRectangle(points[0],opts)}else if(entity&&[modelNameParam.OBJECT_PT,modelNameParam.ROAD_ATTRIBUTE].includes(entity.modelName)){opts={draggable:true,ondragstart:_zrenderNodeEventDragstart,ondragend:_zrenderPointEventDragend};result=self.createMarker(points[0],opts)}else if(entity&&"SearchPoint"==entity._type){opts={style:{text:entity.tags.index,textColor:"#000000",textPosition:"right",brushType:"both"}};result=self.createMarker(points[0],opts)}else if(entity&&entity.modelName==modelNameParam.DIVIDER_NODE){result=self.createNodeMarker(points[0],null,entity.id)}else{result=self.createMarker(points[0])}return result;}},createNodeMarker:function(point,options={},entityid){var self=this;let result;if(iD.picUtil.isEffectLANode(entityid)){let r=computeZrenderCircleRadius(point)+4;if(4>r)r=4;let opts={draggable:true,ondragstart:_zrenderNodeEventDragstart,ondragend:_zrenderNodeEventDragend,style:{color:"rgba(0, 255, 0, 0.8)",lineWidth:0,width:r,height:r}};_.extend(opts.style,options.style);delete options.style;_.extend(opts,options);result=self.createRectangle(point,opts)}else{result=self.createMarker(point,options)}result._entityid=entityid;return result},createMarker:function(point,opts){var self=this;var r=computeZrenderCircleRadius(point);var options={shape:{cx:point[0],cy:point[1],r:r},style:{brushType:"both",fill:iD.picUtil.colorRGBA(220,20,60,0.6),stroke:iD.picUtil.colorRGBA(0,0,0,1),lineWidth:1},hoverable:true,onmouseup:_mouseUpNodeCanDrag,onmousedown:_mousedownNodeCanDrag,ondragenter:function(evt){zrenderNodeStatus.dragoverShape=evt.target},ondragleave:function(evt){zrenderNodeStatus.dragoverShape=undefined}};opts=opts||{};let style=_.assign(options.style,opts.style);options=_.assign(options,opts);options.style=style;var marker=new CircleShape(options);self.zrenderShapeInit(marker);return marker},createRectangle:function(point,opts){var self=this;var width=10,height=10;var options={shape:{x:point[0],y:point[1],width:width,height:height},style:{brushType:"both",fill:iD.picUtil.colorRGBA(255,255,255,0),stroke:iD.picUtil.colorRGBA(220,20,60,0.8),lineWidth:4},hoverable:true,onmousedown:_mousedownNodeCanDrag,onmouseup:function(evt){if(zrenderNodeStatus.dragoverShape&&zrenderNodeStatus.dragoverShape.id===this.id){return}if(!markDrawStatus.type&&!tempShape){var mkr=this;if(mkr._entityid){var node=context.hasEntity(mkr._entityid);if(!node){return}self._lightMapEntities([node.id])}}},ondragenter:function(evt){zrenderNodeStatus.dragoverShape=evt.target},ondragleave:function(evt){zrenderNodeStatus.dragoverShape=undefined}};opts=opts||{};options.style=_.assign(options.style,opts.style);delete opts.style;options=_.assign(options,opts);var rect=new RectangleShape(options);iD.picUtil.shapeXY(rect,point);self.zrenderShapeInit(rect);return rect},createPolygon:function(points,opts){var self=this;if(!opts&&_.include([constant.ADD_GROUND_AREA,constant.ADD_OBJECT_PG,constant.ADD_DIVIDER_POLYGON],markDrawStatus.type)){opts={style:{fill:iD.picUtil.colorRGBA(220,20,60,0.2),stroke:iD.picUtil.colorRGBA(220,20,60,0.2)}}}var options={shape:{points:points},style:{brushType:"both",fill:iD.picUtil.colorRGBA(220,20,60,0.6),stroke:iD.picUtil.colorRGBA(220,20,60,0.6),lineWidth:1},draggable:false,hoverable:true,onmouseup:function(evt){if(markDrawStatus.type==constant.POLYLINE_ADD_NODE){var polygon=this;var entity=context.entity(polygon._entityid);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(polygon._entityid&&modelConfig.editable){var clickOffset=self.leftZoomOffset([evt.event.offsetX,evt.event.offsetY]);self.drawGeometryLineAddNode(polygon,clickOffset)}}else if(!markDrawStatus.type&&!tempShape){var shape=this;if(shape._entityid){var entity=context.hasEntity(shape._entityid);if(!entity){return}self._lightMapEntities([entity.id])}}}};opts=opts||{};options.style=_.assign(options.style,opts.style);delete opts.style;options=_.assign(options,opts);var polygon=new PolygonShape(options);self.zrenderShapeInit(polygon);return polygon},createPolyline:function(points,opts){var self=this;var options={shape:{points:points},style:{stroke:"rgba(220, 20, 60, 0.4)",lineWidth:2},hoverable:true,onmouseup:function(evt){if(markDrawStatus.type==constant.MOVE_LINE){return}if(!markDrawStatus.type&&!tempShape){var shape=this;var wayid=shape._entityid;wayid&&self._lightMapEntities([wayid])}if(markDrawStatus.type!=constant.POLYLINE_ADD_NODE||tempShape){return}var polyline=this;var entity=context.entity(polyline._entityid);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(polyline._entityid&&modelConfig.editable){var clickOffset=self.leftZoomOffset([evt.event.offsetX,evt.event.offsetY]);self.drawGeometryLineAddNode(polyline,clickOffset)}},onmouseout:function(){if(markDrawStatus.type!=constant.MOVE_LINE)return;this.draggable=false},onmousedown:function(evt){var args=Array.prototype.slice.call(arguments);self._zrenderEntityMousedown.apply(this,args);if(markDrawStatus.type!=constant.MOVE_LINE)return;this._startXY=[evt.event.offsetX,evt.event.offsetY];this.draggable=true},ondragstart:function(evt){if(markDrawStatus.type!=constant.MOVE_LINE)return;this._startXY=[evt.event.offsetX,evt.event.offsetY];iD.picUtil.shapePosition(this,[0,0])},ondragend:function(evt){player.canvasClickCheck=true;if(!this._startXY){iD.picUtil.shapePosition(this,[0,0]);return}if(markDrawStatus.type!=constant.MOVE_LINE)return;this.draggable=false;var entity=context.entity(this._entityid);var endXY=[evt.event.offsetX,evt.event.offsetY];iD.picUtil.dargPanning(this._startXY,endXY,entity)}};opts=opts||{};options.shape=_.assign(options.shape,opts.shape);options.style=_.assign(options.style,opts.style);delete opts.shape;delete opts.style;options=_.assign(options,opts);line=new PolylineShape(options);self.zrenderShapeInit(line);return line},createStar:function(point,opts){var self=this;var options={shape:{cx:point[0],cy:point[1],r:10,r0:0,n:4},style:{lineWidth:1,lineJoin:"square",brushType:"both",fill:"rgba(220, 20, 60, 0.4)",stroke:"rgba(220, 20, 60, 0.4)"},hoverable:false};opts=opts||{};options.style=_.assign(options.style,opts.style);delete opts.style;options=_.assign(options,opts);var star=new StarShape(options);self.zrenderShapeInit(star);return star},zrenderShapeInit:function(shape){var self=SELF;shape.on("mouseover",self._zrenderEntityHover);shape.on("mouseout",self._zrenderEntityOut);var layer=self.getZRenderLayer(0);if(!layer){return}if(layer.position){shape.position=[layer.position[0],layer.position[1]]}else{shape.position=viewZoomParam.position.slice()}if(layer.scale){shape.scale=[layer.scale[0],layer.scale[1]]}else{shape.scale=[viewZoomParam.scale,viewZoomParam.scale]}},_zrenderEntityHover:function(){if(!this.hoverable)return;var self=player;var style={stroke:iD.picUtil.colorRGBA(255,255,0,0.4),lineWidth:2};if("polygon"==this.type){style.fill=iD.picUtil.colorRGBA(0,0,0,0);style.lineWidth=4}else if(this.style.fill){style.fill=iD.picUtil.colorRGBA(255,255,0,0.6);style.lineWidth=4}self._zrender.addHover(this,style);self._zrender.refresh()},_zrenderEntityOut:function(){if(!this.hoverable)return;if(iD.picUtil.shapeInSelected(this)){return}var self=player;self._zrender.removeHover(this)},_zrenderEntityMousedown:function(e){var shape=this;clearZRenderNodeStatus();if("circle"!=shape.type||!shape._entityid){var result=iD.picUtil.findMouseShapes(e.event.offsetX,e.event.offsetY,{type:"circle",shapes:[shape],first:true});shape=result[0]}if(!shape||!shape._entityid||"circle"!=shape.type){return}zrenderNodeStatus.downEntityid=shape._entityid;zrenderNodeStatus.downShape=shape},drawGeometryLineAddNode:function(polyline,canvasOffset,data){var result=polyline;var self=this;if(!_.include(["polyline","polygon"],result.type)){return}var wayEntity=context.entity(polyline._entityid);if(!_.include([modelNameParam.OBJECT_PL,modelNameParam.OBJECT_PG,modelNameParam.DIVIDER],wayEntity.modelName)){return}if(wayEntity&&iD.picUtil.checkNodeIsGroundArea(wayEntity.id)){return}var geometry=iD.picUtil.pixelToLngLat(canvasOffset);var mapNodes=context.graph().childNodes(wayEntity);var xy=self.reductionPoint(canvasOffset);geometry.xy=xy;if(locationOutTaskEditable([geometry.lng,geometry.lat])){return}var rstData=iD.geo.chooseEdge(mapNodes,context.projection([geometry.lng,geometry.lat]),context.projection);if(!rstData||null==rstData.index){console.log("\u70B9\u51FB\u7684\u4F4D\u7F6E\u6CA1\u6709\u67E5\u8BE2\u5230\u7D22\u5F15");return}var prevNode=mapNodes[rstData.index-1];var nextNode=mapNodes[rstData.index];if(checkLineNodeDistanceLTE(_.pluck(_.compact([prevNode,nextNode]),"loc"),[geometry.lng,geometry.lat])){return}var marker=self.createMarker(canvasOffset,{draggable:true});marker.on("dragstart",_zrenderNodeEventDragstart);marker.on("dragend",_zrenderNodeEventDragend);marker._shape=result;if(!result._nodeList){result._nodeList=[]}if(_.include(["polyline"],result.type)){polylineAddNode(result,rstData.index,geometry)}else if(_.include(["polygon"],result.type)){polygonAddNode(result,rstData.index,geometry)}},updateZRenderLayer:function(layerid,config){var self=this;var configKeys={position:true,rotation:true,scale:true};if(null==layerid||""===layerid.toString()||!config||_.isEmpty(config)){return}var opts={},proto=self._zrender.painter.getLayer(layerid);for(var keyName in proto){if(configKeys[keyName]){opts[keyName]=proto[keyName]}}self._zrender.configLayer(layerid,_.extend(opts,config))},getZRenderLayer:function(layerid=0){var self=this;return self._zrender.painter.getLayer(layerid)},_lightMapEntities:function(ids){context.enter(iD.modes.Select(context,ids,null,true).suppressMenu(false).newFeature(false))},leftZoomOffset:function(point){var self=this;var vp=viewZoomParam;if(!point||2!=point.length){return point}var layer=self.getZRenderLayer(0);if(!layer){return[0,0]}var offset=[layer.position[0],layer.position[1]];var offsetX=(point[0]-offset[0])/vp.scale;var offsetY=(point[1]-offset[1])/vp.scale;var result=[offsetX,offsetY];return result},reductionPoint:function(p,element){element=element||player.pics.select(".item.active");var $element=element instanceof HTMLElement?d3.select(element):element;element=$element.node();var eleHeight=element.clientHeight;var eleWidth=element.clientWidth;var dheight=$element.attr("d-height");var dwidth=$element.attr("d-width");if(dheight&&0<dheight){eleHeight=dheight}if(dwidth&&0<dwidth){eleWidth=dwidth}var heightRate=eleHeight/+player.pic_point.tags.picH;var widthRate=eleWidth/+player.pic_point.tags.picW;return[iD.util.roundNumber(p[0]/widthRate),iD.util.roundNumber(p[1]/heightRate)]},transformPoint:function(p,element){element=element||player.pics.select(".item.active");let $playerNode=element instanceof HTMLElement?element:element.node();let heightRate=$playerNode.clientHeight/+player.pic_point.tags.picH;let widthRate=$playerNode.clientWidth/+player.pic_point.tags.picW;let point=[iD.util.roundNumber(p[0]*widthRate),iD.util.roundNumber(p[1]*heightRate)];return point},drawGeometryPoint:function(point){var marker,self=this;var clickoffset=[iD.util.roundNumber(point.canvasOffset[0]),iD.util.roundNumber(point.canvasOffset[1])];var opts={};if(_.include([constant.TELEGRAPH_POLE,constant.TELEGRAPH_LAMP_HOLDER,constant.ADD_TRAFFICLIGHT],markDrawStatus.type)){opts={draggable:true,ondragstart:_zrenderNodeEventDragstart,ondragend:_zrenderPointEventDragend};marker=self.createRectangle(clickoffset,opts)}else if(_.include([constant.ADD_CONTROL_POINT,constant.ADD_ROAD_ATTRIBUTE],markDrawStatus.type)){opts={draggable:true,ondragstart:_zrenderNodeEventDragstart,ondragend:_zrenderPointEventDragend};marker=self.createMarker(clickoffset,opts)}else{marker=self.createMarker(clickoffset)}return marker},drawGeometryNodes:function(result,point,opts){var self=this;if(!_.include(["polyline","polygon"],result.type)){return}let mkrOpts={},options=opts||{};let entityid=options.entityid;delete options.entityid;if(!options.draggable){mkrOpts.draggable=false}else{mkrOpts={draggable:true,ondragstart:_zrenderNodeEventDragstart,ondragend:_zrenderNodeEventDragend};_.extend(mkrOpts,options)}iD.picUtil.updateZrenderStyleByEntity(mkrOpts,entityid);let clickoffset=[iD.util.roundNumber(point.canvasOffset[0]),iD.util.roundNumber(point.canvasOffset[1])];let marker=self.createNodeMarker(clickoffset,mkrOpts,entityid);marker._shape=result;if(!result._nodeList){result._nodeList=[]}result._nodeList.push(marker);self._zrender.add(marker);return marker},drawMark:function(point,isDblclick=false){var self=this;if(!markDrawStatus.drawing)return;var result;if(markDrawStatus.type==constant.POINT){result=self.zrenderDrawPoint(point)}else if([constant.POLYLINE,constant.ADD_DIVIDER,constant.ADD_OBJECT_PL,constant.BRIDGE_BOTTOM_LINE].includes(markDrawStatus.type)){result=self.zrenderDrawpolyline(point,isDblclick)}else if(markDrawStatus.type==constant.POLYLINE_ADD_NODE){result=self.zrenderDrawPoint(point)}else if([constant.POLYGONE,constant.ADD_BOARD_POLYGON].includes(markDrawStatus.type)){result=self.zrenderDrawPolygon(point,isDblclick)}else if([constant.INTERSECTION,constant.TELEGRAPH_POLE,constant.ADD_BOARD].includes(markDrawStatus.type)){result=self.zrenderDrawPoint(point)}return result},zrenderDrawPoint:function(point){var self=this;var isMorePoint=_.include([],markDrawStatus.type);if(markDrawStatus.type&&!isMorePoint){self.clearLeftZrenderMarker()}var star=this.createStar(point);picLeftMarkers.push(star);_zrenderStarSetUnZoomStyle(star);self._zrender.add(star);return star},clearLeftZrenderMarker:function(){var self=this;if(self._zrender){for(var i in picLeftMarkers){var mkr=picLeftMarkers[i];self._zrender.remove(mkr)}picLeftMarkers.length=0}},zrenderDrawpolyline:function(point,isDblclick=false){var self=this;var shape=markDrawStatus.shape;if(!shape){shape=markDrawStatus.shape=self.createPolyline([point]);tempShape=self.createPolyline([point,point]);self._zrender.add(shape);self._zrender.add(tempShape);self._zrender.on("mousemove",self.zrenderMove,self)}else{var tempPoint=_.last(shape.shape.points);if(tempPoint[0]!=point[0]&&tempPoint[1]!=point[1]){shape.shape.points.push(point);shape.setShape("points",shape.shape.points)}}if(isDblclick){self._zrender.remove(tempShape);self._zrender.off("mousemove",self.zrenderMove);var points=[];for(var i=0,len=markDrawStatus.shape.shape.points.length;i<len;i++){points.push(self.reductionPoint(markDrawStatus.shape.shape.points[i]))}markDrawStatus.shape=null;tempShape=null}return shape},zrenderDrawPolygon:function(point,isDblclick=false){var self=this;var shape=markDrawStatus.shape;if(!shape){shape=markDrawStatus.shape=self.createPolygon([point,point,point]);self._zrender.add(shape);self._zrender.on("mousemove",self.zrenderMove,self)}else{var pointList=shape.shape.points;pointList.splice(pointList.length-2,1,point);if(!isDblclick){pointList.splice(pointList.length-1,0,point)}shape.setShape("points",pointList)}if(isDblclick){self._zrender.off("mousemove",self.zrenderMove);markDrawStatus.shape=null;tempShape=null}return shape},zrenderDrawRectangeOnMap:function(point,isMouseup=false){var self=this;var entityid=zrenderNodeStatus.drawingEntityid;if(isMouseup){zrenderNodeStatus.moveOffset=point;self._zrender.off("mousemove",self.zrenderMove);self.zrenderMove(null,{mouseup:true});markDrawStatus.shape=null;tempShape=null;zrenderNodeStatus.downOffset=zrenderNodeStatus.moveOffset=undefined;entityid=zrenderNodeStatus.drawingEntityid;zrenderNodeStatus.drawingEntityid=undefined}else{zrenderNodeStatus.downOffset=zrenderNodeStatus.moveOffset=point;self._zrender.on("mousemove",self.zrenderMove,self)}return entityid},zrenderDrawRectange:function(point,isMouseup=false){var self=this;var shape=markDrawStatus.shape;if(!shape){shape=markDrawStatus.shape=self.createPolygon([point,0,point,0,point]);self._zrender.add(shape);self._zrender.on("mousemove",self.zrenderMove,self)}if(isMouseup){self._zrender.off("mousemove",self.zrenderMove);markDrawStatus.shape=null;tempShape=null}return shape},zrenderMove:function(e,opts={}){var self=this;if(e){zrenderNodeStatus.moveOffset=self.leftZoomOffset([e.event.offsetX,e.event.offsetY])}else{zrenderNodeStatus.moveOffset=zrenderNodeStatus.moveOffset}var flag=execPlugin("zrenderMove",e,zrenderNodeStatus.moveOffset,opts);if(flag)return;if(!e){return}var shape=markDrawStatus.shape;if(!shape){self._zrender.off("mousemove",self.zrenderMove);return}var pointList=shape.shape.points;var evtOffset=self.leftZoomOffset([e.event.offsetX,e.event.offsetY]);if("polyline"==shape.type&&_.include([constant.ADD_DIVIDER,constant.ADD_OBJECT_PL,constant.BRIDGE_BOTTOM_LINE,constant.ADD_DIVIDER_POLYGON],markDrawStatus.type)){shape=tempShape;shape.shape.points=[_.last(pointList),evtOffset]}else if("polygon"==shape.type&&_.include([constant.ADD_BOARD],markDrawStatus.type)){let _points=[shape.shape.points[0],evtOffset];let rectPoints=iD.picUtil.createRectangeBy2Point(_points);rectPoints[rectPoints.length]=shape.shape.points[0];shape.shape.points=rectPoints}else if("polygon"==shape.type&&_.include([constant.ADD_OBJECT_PG,constant.ADD_BOARD_POLYGON],markDrawStatus.type)){var pointList=shape.shape.points;var way=shape._entityid?context.hasEntity(shape._entityid):null;if(way&&1!=pointList.length-way.nodes.length){pointList.splice(way.nodes.length-1);pointList.push(...[evtOffset,pointList[0]])}else{pointList.splice(pointList.length-2,1,evtOffset)}}else{shape.shape.points[shape.shape.points.length-1]=evtOffset}if(shape){self._zrender.add(shape)}shape.setShape("points",shape.shape.points)},clearVectorPointData:function(){markVectorPoint.loc=null;if(markVectorPoint.shape){this._zrender.remove(markVectorPoint.shape)}markVectorPoint.shape=null;markVectorPoint.points=null;return true},resetCanvas:function(){var self=this;if(self._zrender){self._zrender.clear();self.pointToPicPlayer()}var ids=context.selectedIDs();var eidList=[];_.each(ids,function(id){var e=context.hasEntity(id);e&&eidList.push(e.id)});if(eidList.length){iD.AutoMatch.shapeHover(player,eidList)}else{self.clearZRenderHover()}},resetPointToPicPlayer:function(acceptids){if(!this._zrender)return;this.pointToPicPlayer(acceptids)},getConstant:function(){return constant},getPlayer:function(){return player},setSolidLineRender:function(b){isSolidLine=b;this.resetCanvas()},isDashedLineMode:function(){return isSolidLine},clearZRenderHover:clearZRenderHover,drawClickBreakNode:drawClickBreakNode,clearZRenderNodeStatus:clearZRenderNodeStatus,checkLineNodeDistanceLTE:checkLineNodeDistanceLTE,clearWrongShapeAndEntity:clearWrongShapeAndEntity,locationOutTaskEditable:locationOutTaskEditable,_drawActionsPerform:_drawActionsPerform,clearTempShape:function(){tempShape&&this._zrender.remove(tempShape);tempShape=undefined},execPlugin:execPlugin,getDrawPlugins:function(){return drawPlugins}});function computeZrenderCircleRadius(point){var height=player.pics.node().getBoundingClientRect().height;var halfheight=height/2;var y=point[1];var yscale=Math.abs(halfheight-y)/halfheight;r=2.5+parseInt(yscale/0.2);return r+2*yscale}function checkLineNodeDistanceLTE(loc1,loc2,opts={distance:0.2,alert:true}){return false}function locationOutTaskEditable(loc,opts={}){if(iD.util.pointNotInPlyGonx(loc,context)){clearWrongShapeAndEntity();player.clearFooterButton();clearZRenderNodeStatus();if(true==opts.pop){context.pop()}SELF.resetCanvas();Dialog.close();Dialog.alert(t("task_bounds.outside"));opts.callback&&opts.callback(context);return true}opts.callback&&opts.callback(context);return false}function clearWrongShapeAndEntity(checkShape){var shape=checkShape||markDrawStatus.shape;if(shape){var delShapes=[],delEntities=[];var entity=context.hasEntity(shape._entityid);if(entity instanceof iD.Way){if(!entity.isArea()&&1==entity.nodes.length){delEntities.push(entity.id);delShapes.push(shape);shape._nodeList&&shape._nodeList[0]&&delShapes.push(shape._nodeList[0])}else if((entity.isArea()||_.include(["polygon"],shape.type))&&shape._nodeList&&3>shape._nodeList.length){for(var sp of shape._nodeList||[]){delShapes.push(sp)}delShapes.push(shape);entity&&delEntities.push(entity.id);if(delEntities.length){Dialog.alert("\u9762\u7C7B\u578B\u81F3\u5C11\u4E09\u4E2A\u8282\u70B9",null,null,null,null,{AutoClose:3})}}}for(var sp of delShapes){SELF._zrender.remove(sp)}if(delEntities.length){markDrawStatus.shape=null;context.replace(iD.actions.DeleteMultiple(delEntities,context),"");context.pop()}}}clearWrongShapeAndEntity.isWrong=function(checkShape,checkType){var shape=checkShape||markDrawStatus.shape;if(!shape._entityid){return false}checkType=checkType||shape.type;if(!checkType){return false}if("polyline"==checkType){return 2>context.entity(shape._entityid).nodes.length}else if("polygon"==checkType){return 4>context.entity(shape._entityid).nodes.length}return false};function _zrenderStarSetUnZoomStyle(item){var vp=viewZoomParam;if(item instanceof StarShape){if(null==item.__lineWidth){item.__lineWidth=item.style.lineWidth}if(null==item.__r){item.__r=item.shape.r}item.style.lineWidth=item.__lineWidth/vp.scale;item.shape.r=item.__r/vp.scale}}function drawClickBreakNode(type,exclude=[]){var downid=zrenderNodeStatus.downEntityid;if(!downid)return false;var modelName;if(type===constant.ADD_DIVIDER){modelName=modelNameParam.DIVIDER_NODE}else if(type===constant.ADD_OBJECT_PL){modelName=modelNameParam.OBJECT_PL_NODE}var entity=context.entity(downid);if(!modelName||entity.modelName!=modelName){return false}if(iD.util.nodeIsBreakPoint(entity,context.graph())){if(exclude&&exclude.length){var ways=context.graph().parentWays(entity);var isExclude=_.difference(_.pluck(ways,"id"),exclude).length<ways.length;if(isExclude)return false}return{entityid:downid,shape:zrenderNodeStatus.downShape}}return false}function _mouseUpNodeCanDrag(e){if(zrenderNodeStatus.dragoverShape&&zrenderNodeStatus.dragoverShape.id===this.id){return}if(!markDrawStatus.type&&!tempShape){let mkr=this;if(mkr.dragging)return;if(mkr._entityid&&mkr._shape){SELF._lightMapEntities([mkr._entityid])}else if(mkr._entityid){SELF._lightMapEntities([mkr._entityid])}}}function _mousedownNodeCanDrag(e){SELF._zrenderEntityMousedown.call(this,e);var mkr=this;if(mkr.__defDraggable==undefined){mkr.__defDraggable=mkr.draggable}var entity=context.hasEntity(mkr._entityid);let modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!entity||!modelConfig){return false}var shapeType=this._shape&&this._shape.type||"";if(entity){var entity_editable=modelConfig.editable;if(!entity_editable){mkr.draggable=false;return false}if(!iD.Layers.getLayerModelEditable(iD.Layers.getLayer(entity.layerId),entity.modelName)){mkr.draggable=false;return false}if("polyline"==shapeType){if(!_.include([modelNameParam.TRAFFICSIGN_NODE,modelNameParam.BRIDGE_NODE],entity.modelName)&&!iD.picUtil.canNotDrag(entity)){mkr.draggable=false;return false}}}if(markDrawStatus.type){mkr.draggable=false}else{mkr.draggable=mkr.__defDraggable}return false}function polylineAddNode(shape,index,geometry){var actions=[],way;if("polyline"==shape.type&&shape._entityid){way=context.entity(shape._entityid);var modelName=modelNameParam.DIVIDER_NODE;if(modelNameParam.OBJECT_PL==way.modelName){modelName=modelNameParam.OBJECT_PL_NODE}else if(modelNameParam.BRIDGE==way.modelName){modelName=modelNameParam.BRIDGE_NODE}var currentLayer=iD.Layers.getCurrentModelEnableLayer(modelName);var node=iD.Node({modelName:modelName,layerId:currentLayer.id,loc:[geometry.lng,geometry.lat,geometry.elevation]});node.setTags(iD.util.getDefauteTags(node,currentLayer));actions.push(iD.actions.Noop());actions.push(iD.picUtil.measureinfoAction(node,{trackPointId:player.allNodes[player.selectPicIndex].tags.trackPointId,imgOffset:{x:geometry.xy[0],y:geometry.xy[1]}}));actions.push(iD.picUtil.actionGeometryLineAddNode(way,node,index));actions.push("\u6DFB\u52A0\u7EBF\u8DEF\u8282\u70B9")}if(way){historyPicOperate=true;actions.length&&context.perform.apply(this,actions);historyPicOperate=false;context.event.entityedite({entitys:[way.id]})}}function polygonAddNode(shape,index,geometry){var actions=[],way;if("polygon"==shape.type&&shape._entityid){way=context.entity(shape._entityid);var modelName="";if(modelNameParam.OBJECT_PG==way.modelName){modelName=modelNameParam.OBJECT_PG_NODE}var currentLayer=iD.Layers.getCurrentModelEnableLayer(modelName);var node=iD.Node({modelName:modelName,layerId:currentLayer.id,loc:[geometry.lng,geometry.lat,geometry.elevation]});node.setTags(iD.util.getDefauteTags(node,currentLayer));actions.push(iD.actions.Noop());actions.push(iD.picUtil.measureinfoAction(node,{trackPointId:player.allNodes[player.selectPicIndex].tags.trackPointId,imgOffset:{x:geometry.xy[0],y:geometry.xy[1]}}));actions.push(iD.picUtil.actionGeometryLineAddNode(way,node,index));actions.push("\u6DFB\u52A0\u7EBF\u8DEF\u8282\u70B9")}if(way){actions.length&&context.perform.apply(this,actions);context.event.entityedite({entitys:[way.id]})}}function continueDrawDivider(self,shape){if(!(markDrawStatus.drawing&&_.include([constant.ADD_DIVIDER,constant.ADD_OBJECT_PL,constant.ADD_OBJECT_PG],markDrawStatus.type))){return false}if(markDrawStatus.shape&&markDrawStatus.shape._entityid==shape._entityid){markDrawStatus.shape=shape;var evtOffset;if("polyline"==shape.type&&tempShape){evtOffset=SELF.leftZoomOffset(_.last(tempShape.shape.points));self._zrender.remove(tempShape);tempShape=self.createPolyline([_.last(shape.shape.points),evtOffset]);self._zrender.add(tempShape)}}return true}function drawGeometryNodes(self,result,point,opts){if(!_.include(["polyline","polygon"],result.type)){return}let mkrOpts={},options=opts||{};let entityid=options.entityid;delete options.entityid;if(!options.draggable){mkrOpts.draggable=false}else{mkrOpts={draggable:true,ondragstart:_zrenderNodeEventDragstart,ondragend:_zrenderNodeEventDragend};_.extend(mkrOpts,options)}iD.picUtil.updateZrenderStyleByEntity(mkrOpts,entityid);let clickoffset=[iD.util.roundNumber(point.canvasOffset[0]),iD.util.roundNumber(point.canvasOffset[1])];let marker=self.createNodeMarker(clickoffset,mkrOpts,entityid);marker._shape=result;if(!result._nodeList){result._nodeList=[]}result._nodeList.push(marker);self._zrender.add(marker);return marker}function createRelationNode(self,shape){let pointList=shape.shape.points;let pointMap=shape._pointMappingNode;let pointMapIndexs=_.keys(pointMap);let i=0,len=pointList.length;let point,draggable,mapidx,nodeid,mapNode;for(;i<len;i++){point=pointList[i];draggable=false;mapidx=pointMapIndexs[i];nodeid=pointMap[mapidx];mapNode=context.graph().hasEntity(nodeid);if(mapNode&&_.include([modelNameParam.OBJECT_PG_NODE,modelNameParam.DIVIDER_NODE,modelNameParam.OBJECT_PL_NODE,modelNameParam.TRAFFICSIGN_NODE,modelNameParam.BRIDGE_NODE],mapNode.modelName)){draggable=true}let marker=drawGeometryNodes(self,shape,{canvasOffset:point},{draggable:draggable,entityid:nodeid});if(nodeid){marker&&(marker._entityid=nodeid);marker&&(marker._dividerindex=parseInt(mapidx))}if(!isSameCircleSize){marker&&iD.picUtil.updateZrenderStyleByEntity(marker,marker._entityid)}marker&&self._zrender.add(marker)}delete shape._pointMappingNode;pointMapIndexs.length=0;return}DrawTool.prototype.pointToPicPlayer=function(acceptids){var player=this.player,self=this;clearZRenderHover();if(acceptids&&acceptids.length){let shapeList=self._zrender.storage.getDisplayList();let shape;for(let i in shapeList){shape=shapeList[i];if(shape._entityid&&_.include(acceptids,shape._entityid)){self._zrender.remove(shape)}}}else{self.drawTrackPointsToShape()}let shapes=iD.AutoMatch.trackPointToPicPlayer(player.pic_point,player,isSolidLine,acceptids);var shape,mappingNodeMap={};for(shape of shapes){if(shape.entity instanceof iD.Way){shape.entity.nodes.forEach(function(nid){mappingNodeMap[nid]=true})}}var continueShape;if(shapes&&0<shapes.length){let i=0,len=shapes.length,newShape;for(;i<len;i++){shape=shapes[i];if(!shape.coordinates||!shape.coordinates.length){continue}if(shape.entity){var entity=shape.entity;if(entity.modelName==modelNameParam.TRAFFICSIGN_NODE){continue}}if(!shape.entity||!mappingNodeMap[shape.entity.id]){newShape=self.createShap(shape);if(shape.entity){newShape._entityid=shape.entity.id}newShape._pointMappingNode=shape.pointMappingNode;iD.picUtil.updateZrenderStyleByEntity(newShape,newShape._entityid);iD.picUtil.dashedSolidDivider(newShape,newShape._entityid,isSolidLine);self._zrender.add(newShape)}if(newShape&&shape.entity instanceof iD.Way){if(shape.entity.modelName==modelNameParam.TRAFFICSIGN){createRelationNode(self,newShape)}else{createRelationNode(self,newShape);if(markDrawStatus.shape&&markDrawStatus.shape._entityid==shape.entity.id){continueShape=newShape}}iD.picUtil.updateZrenderStyleByEntity(newShape,newShape._entityid)}};}if(continueShape){continueDrawDivider(self,continueShape)}player.refreshLeftEpilineCross()};function clearZRenderNodeStatus(){zrenderNodeStatus.dragoverShape=null;zrenderNodeStatus.drawingEntityid=null;zrenderNodeStatus.downEntityid=null;zrenderNodeStatus.downShape=null;zrenderNodeStatus.areaPivot=null;zrenderNodeStatus.dragProtoAngle=null}function clearZRenderHover(){if(SELF._zrender){SELF._zrender.painter.clearHover();SELF._zrender.painter.refresh()}}function _zrenderNodeEventDragstart(e){clearZRenderNodeStatus();zrenderNodeStatus.downOffset=SELF.leftZoomOffset([e.event.offsetX,e.event.offsetY]);var mkr=this;zrenderNodeStatus.downEntityid=mkr._entityid;zrenderNodeStatus.drawingEntityid=mkr._shape&&mkr._shape._entityid;if(!mkr._entityid){player._zrender.off("mousemove");player._zrender.off("mouseup");return false}player.canvasClickCheck=false;mkr._protoLoc=iD.picUtil.shapeXY(mkr);let first=true,isDrag=false;player._zrender.off("mousemove");player._zrender.off("mouseup");player._zrender.on("mousemove",function(evt){isDrag=true;clearZRenderHover();_zrenderNodeEventMousemove.call(mkr,evt);execPluginTrigger("dragEventMove",evt,zrenderNodeStatus.moveOffset,{isFirst:first});first=false});player._zrender.on("mouseup",_mouseDragEnd);player._zrender.on("dragend.pic-player-drag",_mouseDragEnd);function _mouseDragEnd(e){var a=1;if(!isDrag||!zrenderNodeStatus.downEntityid)return;execPluginTrigger("dragEventMoveend",e,zrenderNodeStatus.moveOffset);isDrag=false;player._zrender.off("mouseup",_mouseDragEnd);player._zrender.off("dragend.pic-player-drag",_mouseDragEnd)}}function _zrenderNodeEventMousemove(evt,mkr){var unzPos=SELF.leftZoomOffset([evt.event.offsetX,evt.event.offsetY]);zrenderNodeStatus.moveOffset=unzPos}function _zrenderPointEventDragend(evt){player._zrender.off("mousemove");player._zrender.off("mouseup");var mkr=this;if(mkr._entityid&&iD.picUtil.checkNodeIsGroundArea(mkr._entityid)){evt.event.stopPropagation();return}iD.picUtil.shapePosition(mkr,[0,0]);var unzPos=SELF.leftZoomOffset([evt.event.offsetX,evt.event.offsetY]);iD.picUtil.shapeXY(mkr,unzPos);player.canvasClickCheck=false;if(iD.picUtil.isPointEqual(zrenderNodeStatus.downOffset,unzPos,2/viewZoomParam.scale)){_zrenderResetDragMkr(player,mkr);clearZRenderNodeStatus();return}var nodeid=mkr._entityid;var entity=context.entity(nodeid);if(entity.modelName==modelNameParam.LAMPPOST&&2==entity.tags.TYPE){var lonlats;var newPLANE="";var mkrxy=iD.picUtil.shapeXY(mkr);if(entity.tags.PLANE){let xy=player.reductionPoint(mkrxy);lonlats=iD.picUtil.pixelToLngLatByPlane(xy,entity.tags.PLANE||"")}else{let result=iD.picUtil.getLampHolderLonlat(mkrxy);lonlats=result.loc;newPLANE=result.PLANE}if(!lonlats||!lonlats.length){_zrenderResetDragMkr(player,mkr);clearZRenderNodeStatus();evt.event.stopPropagation();return}dragEndFun({geometry:{lng:lonlats[0],lat:lonlats[1],elevation:lonlats[2]},newTags:newPLANE?{PLANE:newPLANE}:null})}else if(_.include([modelNameParam.TRAFFICLIGHT],entity.modelName)&&entity.tags.PLANE){var mkrxy=iD.picUtil.shapeXY(mkr);let xy=player.reductionPoint(mkrxy);let lonlats=iD.picUtil.pixelToLngLatByPlane(xy,entity.tags.PLANE||"");if(!lonlats||!lonlats.length){_zrenderResetDragMkr(player,mkr);clearZRenderNodeStatus();evt.event.stopPropagation();return}dragEndFun({geometry:{lng:lonlats[0],lat:lonlats[1],elevation:lonlats[2]}})}else if(_.include([modelNameParam.ROAD_ATTRIBUTE],entity.modelName)){var mkrPos=iD.picUtil.shapeXY(mkr);var xy=player.reductionPoint(mkrPos);var geometry={};overShape=zrenderNodeStatus.dragoverShape;var overEntity;if(overShape&&overShape._entityid){overEntity=context.entity(overShape._entityid)}if(overEntity&&overEntity.modelName==modelNameParam.DIVIDER_NODE){var ovnum=overShape.style.r;var flag=false;var mkrxy=iD.picUtil.shapeXY(mkr);var overxy=iD.picUtil.shapeXY(overShape);if(null!=ovnum){flag=Math.abs(mkrxy[0]-overxy[0])<=ovnum&&Math.abs(mkrxy[1]-overxy[1])<=ovnum}if(flag){geometry.lng=overEntity.loc[0];geometry.lat=overEntity.loc[1];geometry.elevation=overEntity.loc[2];iD.picUtil.shapeXY(mkr,overxy);if(overShape.shape.r){mkr.shape.r=overShape.shape.r}}}if(_.isEmpty(geometry)){geometry=iD.picUtil.pixelToLngLat(mkrPos)}geometry.xy=xy;dragEndFun({geometry})}else{intersectionTool.leftClickCoord(unzPos,function(data,point,point2,isMultPoints){if(isMultPoints){data=data[0]}dragEndFun(data,point)})}function dragEndFun(data){let node=context.entity(nodeid);let geoCoord=[data.geometry.lng,data.geometry.lat,data.geometry.elevation];if(locationOutTaskEditable(geoCoord)){return false}var actions=[iD.actions.UpdateNode(context,node.move(geoCoord))];if(!_.isEmpty(data.newTags)){actions.push(iD.actions.ChangeTags(node.id,data.newTags))}var mkrxy=iD.picUtil.shapeXY(mkr);let xy=player.reductionPoint(mkrxy);actions.push(iD.picUtil.measureinfoAction(node,{datas:intersectionTool.getIntersectionData().canvasList,trackPointId:player.pic_point.tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]}}));actions.push("\u62D6\u62FD\u70B9");context.perform.apply(context,actions)}clearZRenderNodeStatus();evt.event.stopPropagation();if(iD.picUtil.shapeInSelected(mkr)){SELF._zrenderEntityHover.call(mkr)}return false}function _zrenderNodeEventDragend(evt){player._zrender.off("mousemove");player._zrender.off("mouseup");var mkr=this;if(mkr._entityid&&iD.picUtil.checkNodeIsGroundArea(mkr._entityid)){evt.event.stopPropagation();return}player.canvasClickCheck=false;var shape=mkr._shape;if(!shape){return false}var index=_.indexOf(shape._nodeList,mkr);if(-1==index){return}var unzPos=SELF.leftZoomOffset([evt.event.offsetX,evt.event.offsetY]);iD.picUtil.shapePosition(mkr,[0,0]);if(iD.picUtil.isPointEqual(zrenderNodeStatus.downOffset,unzPos,2/viewZoomParam.scale)){_zrenderResetDragMkr(player,mkr);clearZRenderNodeStatus();return}iD.picUtil.shapeXY(mkr,unzPos);if("circle"==mkr.type){var r=computeZrenderCircleRadius(unzPos);mkr.shape.r=r}function dragEndFun(data,point){player.canvasClickCheck=true;var geometry=data.geometry;var dragNode=context.hasEntity(mkr._entityid);if("polyline"==shape.type&&dragNode&&_.include([modelNameParam.DIVIDER_NODE,modelNameParam.OBJECT_PL_NODE],dragNode.modelName)){for(var way of context.graph().parentWays(context.entity(mkr._entityid))){var nodeIndex=way.nodes.indexOf(mkr._entityid);var prevNode=context.hasEntity(way.nodes[nodeIndex-1]);var nextNode=context.hasEntity(way.nodes[nodeIndex+1]);var nodeLocs=_.pluck(_.compact([prevNode,nextNode]),"loc");if(checkLineNodeDistanceLTE(nodeLocs,[geometry.lng,geometry.lat])){_zrenderResetDragMkr(player,mkr);clearZRenderNodeStatus();return}}}nodeDragEndUpdate(player,shape,index,{geoCoord:[geometry.lng,geometry.lat,geometry.elevation],canvasOffset:point.canvasOffset},mkr._dividerindex);var graph=context.graph();var node=graph.hasEntity(mkr._entityid);if(!node){return}var markers=ZEUtil.getShapesByEid(node.id);markers=markers.filter(function(marker){return marker.id!==mkr.id});if(markers.length){player._zrender.clearHover()}markers.forEach(function(marker){var shapeWay=marker._shape;if(!shapeWay){return}var way=context.hasEntity(shapeWay._entityid);if(!way){return}var dividerIndex=_.indexOf(way.nodes,marker._entityid);if(-1==dividerIndex){return}iD.picUtil.shapeXY(marker,point.canvasOffset);var r=computeZrenderCircleRadius(point.canvasOffset);marker.shape.r=r;iD.picUtil.shapePosition(marker,[0,0]);var shapeIndex=_.indexOf(shapeWay._nodeList,marker);nodeDragEndUpdate(player,shapeWay,shapeIndex,{geoCoord:[geometry.lng,geometry.lat,geometry.elevation],canvasOffset:point.canvasOffset},dividerIndex,true)})}if(mkr._shape&&mkr._shape._entityid){var entity=context.entity(mkr._shape._entityid);if(_.include([modelNameParam.DIVIDER,modelNameParam.TRAFFICSIGN,modelNameParam.OBJECT_PL,modelNameParam.OBJECT_PG,modelNameParam.BRIDGE],entity.modelName)){var geometry={};if(_.include([modelNameParam.TRAFFICSIGN,modelNameParam.BRIDGE],entity.modelName)&&entity.tags.PLANE){var mkrxy=iD.picUtil.shapeXY(mkr);let xy=player.reductionPoint(mkrxy);var lonlats=iD.picUtil.pixelToLngLatByPlane(xy,entity.tags.PLANE||"");geometry.lng=lonlats[0];geometry.lat=lonlats[1];geometry.elevation=lonlats[2]}else{var mkrxy=iD.picUtil.shapeXY(mkr);geometry=iD.picUtil.pixelToLngLat(mkrxy)}var overShape;if(zrenderNodeStatus.dragoverShape&&zrenderNodeStatus.dragoverShape._entityid&&_.include([modelNameParam.OBJECT_PL,modelNameParam.DIVIDER],entity.modelName)&&_.include([entity.first(),entity.last()],mkr._entityid)){overShape=zrenderNodeStatus.dragoverShape;var overEntity=context.entity(overShape._entityid);if(overEntity&&overEntity.id!=mkr._entityid&&overEntity.modelName!=context.entity(mkr._entityid).modelName){var ovnum=overShape.shape.r;var ovw=overShape.shape.width||0,ovh=overShape.shape.height||0;var flag=false;var mkrxy=iD.picUtil.shapeXY(mkr);var overxy=iD.picUtil.shapeXY(overShape);if(null!=ovnum){flag=Math.abs(mkrxy[0]-overxy[0])<=ovnum&&Math.abs(mkrxy[1]-overxy[1])<=ovnum}else if(null!=ovw&&null!=ovh){flag=Math.abs(mkrxy[0]-overxy[0])<=ovw&&Math.abs(mkrxy[1]-overxy[1])<=ovh}if(flag){geometry.lng=overEntity.loc[0];geometry.lat=overEntity.loc[1];geometry.elevation=overEntity.loc[2];iD.picUtil.shapeXY(mkr,overxy);if(overShape.shape.r){mkr.shape.r=overShape.shape.r}}}}var mkrxy=iD.picUtil.shapeXY(mkr);dragEndFun({geometry},{canvasOffset:mkrxy});_zrenderNodeConnect(mkr._entityid,overShape&&overShape._entityid,{xy:[mkrxy[0],mkrxy[1]]})}else{var mkrxy=iD.picUtil.shapeXY(mkr);intersectionTool.leftClickCoord(mkrxy,function(data,point,point2){dragEndFun(data,point)})}}clearZRenderNodeStatus();evt.event.stopPropagation();if(iD.picUtil.shapeInSelected(mkr)){SELF._zrenderEntityHover.call(mkr)}return false}function _drawActionsPerform(allActions,isReplace=false){historyPicOperate=true;if(1==allActions.length){if(!isReplace){context.perform.apply(this,allActions[0])}else{context.replace.apply(this,allActions[0])}}else if(1<allActions.length){var oneActions=[];var lastStr="";for(var i in allActions){var actions=allActions[i];if("string"===typeof actions[actions.length-1]){lastStr=actions[actions.length-1];actions=actions.slice(0,actions.length-1)}if(actions.length){oneActions.push(...actions)}}oneActions.length&&oneActions.push(lastStr);if(!isReplace){context.perform.apply(this,oneActions)}else{context.replace.apply(this,oneActions)}}historyPicOperate=false}function _zrenderResetDragMkr(self,mkr){if(!mkr){return false}if(mkr._protoLoc){iD.picUtil.shapeXY(mkr,mkr._protoLoc);var r=computeZrenderCircleRadius(mkr._protoLoc);mkr.shape.r=r;iD.picUtil.modShape(mkr)}}function _zrenderNodeConnect(moveid,nodeid,opts={}){if(!moveid||!nodeid||moveid==nodeid){return}var graph=context.graph();var mnode=graph.entity(moveid);var tnode=graph.entity(nodeid);var modelConfig=iD.Layers.getLayer(tnode.layerId,tnode.modelName);if(!modelConfig&&!modelConfig.editable){return}if(mnode.modelName!==tnode.modelName){return}if(!iD.util.nodeIsBreakPoint(mnode,graph)||!iD.util.nodeIsBreakPoint(tnode,graph)){return}var didMap={},didRepeat;graph.parentWays(mnode).forEach(way=>{if(didMap[way.id]){didRepeat=true}didMap[way.id]=true});graph.parentWays(tnode).forEach(way=>{if(didMap[way.id]){didRepeat=true}didMap[way.id]=true});if(didRepeat){return}var connectNodes=[];if(mnode.modelName==modelNameParam.DIVIDER_NODE){var mrels=graph.parentRelations(mnode,iD.data.DataType.DIVIDER_ATTRIBUTE);var trels=graph.parentRelations(tnode,iD.data.DataType.DIVIDER_ATTRIBUTE);if(mrels.length&&trels.length){return}if(mrels.length){connectNodes=[nodeid,moveid]}else if(trels.length){connectNodes=[moveid,nodeid]}else{connectNodes=[moveid,nodeid]}}else if(mnode.modelName==modelNameParam.OBJECT_PL_NODE){connectNodes=[moveid,nodeid]}var moveXY=opts.xy;moveXY=player.reductionPoint(opts.xy);var args=[iD.picUtil.measureinfoAction(mnode,{type:-1}),iD.picUtil.measureinfoAction(tnode,{type:-1}),iD.actions.ConnectDivider(context,connectNodes),iD.picUtil.measureinfoAction(graph.entity(_.last(connectNodes)),{trackPointId:player.pic_point.tags.trackPointId,imgOffset:{x:moveXY[0],y:moveXY[1]}}),t("operations.connect.annotation."+tnode.geometry(context.graph()))];context.enter(iD.modes.Select(context,[_.last(connectNodes)]));context.replace.apply(this,args);SELF.resetCanvas()}function nodeDragEndUpdate(player,shape,nodeIndex,data,dividerNodeIndex,hisReplace=false){var actions=[];if(_.include(["polyline","polygon"],shape.type)&&shape._entityid){if(!context.hasEntity(shape._entityid))return;var way=context.entity(shape._entityid);var shapeNode=shape._nodeList[nodeIndex];let pointList=shape.shape.points;let indexFP=[0,pointList.length-1];var mkrxy=iD.picUtil.shapeXY(shapeNode);if("polygon"==shape.type&&_.isEqual(pointList[indexFP[0]],pointList[indexFP[1]])&&(nodeIndex==indexFP[0]||nodeIndex==indexFP[1])){pointList[indexFP[0]]=pointList[indexFP[1]]=mkrxy}else{pointList[nodeIndex]=mkrxy}var nodeid=shapeNode._entityid;if(shape._pointMappingNode){var mnid=shape._pointMappingNode[dividerNodeIndex.toString()];if(mnid){nodeid=mnid}}if(!nodeid)return;var node=context.entity(nodeid);if(locationOutTaskEditable(data.geoCoord)){return false}actions.push(iD.actions.Noop());actions.push(iD.actions.UpdateNode(context,node.move(data.geoCoord)));var xy=player.reductionPoint(data.canvasOffset);if(way.modelName==modelNameParam.TRAFFICSIGN||way.modelName==modelNameParam.BRIDGE){actions.push(iD.picUtil.measureinfoAction(node,{trackPointId:player.allNodes[player.selectPicIndex].tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]},wayid:shape._entityid}))}else{actions.push(iD.picUtil.measureinfoAction(node,{trackPointId:player.allNodes[player.selectPicIndex].tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]}}))}actions.push("\u62D6\u62FD\u8282\u70B9");shape.setShape("points",pointList)}actions.length&&context[hisReplace?"replace":"perform"].apply(this,actions)}SELF=new DrawTool;return SELF};;iD.svg.PicToolIntersection=function(context,_opts){const constant=_opts.constant;const markDrawStatus=_opts.markDrawStatus;var postCount=0;var intersectionArr=[];var intersectionCanvasPoints=[];var player,drawTool;var dispatch=d3.dispatch("start","intersection_callback","end","request_failed");function Tool(){this.$element;this.ignoreList;this.shapes;this.shown=false}Tool.prototype.init=function(arg1,arg2){player=arg1;drawTool=arg2;this.shapes=[];this.shown=false};_.assign(Tool.prototype,{postCall:null,_initDom:function(){if(!this.$element){this.$element=player.pics&&player.pics.select(".item.active")}},show:function(){this._initDom();if(!drawTool._zrender)return;drawTool.clearZRenderHover();this.clearCanvas();this.ignoreList=_.clone(drawTool._zrender.storage._roots);for(var shape of this.ignoreList){shape.ignore=true}drawTool._zrender.refresh();this.shown=true},hide:function(){this._initDom();if(!drawTool._zrender)return;this.clearCanvas();var nr=false;for(var shape of this.ignoreList||[]){shape.ignore=false;nr=true}nr&&drawTool._zrender.refresh();this.ignoreList=null;this.shown=false},clearCanvas:function(){if(!drawTool._zrender)return;for(var shape of this.shapes){shape.ignore=true;drawTool._zrender.remove(shape)}this.shapes.length=0},addShape:function(shape){if(!drawTool._zrender)return;if(shape.__storage!=drawTool._zrender.storage){this.shapes.push(shape)}drawTool._zrender.add(shape)},removeShape:function(shape){if(!drawTool._zrender)return;var index=this.shapes.indexOf(shape);if(-1<index)this.shapes.splice(index,1);drawTool._zrender.remove(shape)},getPointData:function(clickOffset,index){var self=this;var node,xy;if(0==index){node=player.pic_point;xy=drawTool.reductionPoint(clickOffset)}else if(1==index){node=player.allNodes[player.rightPointIndex];xy=drawTool.reductionPoint(clickOffset,self.$element)}return{trackPointId:node.tags.trackPointId,point:node,x:xy[0].toString(),y:xy[1].toString()}},leftClickCoord:function(firstOffset,callback){var self=this;if(_.include([constant.ADD_BOARD],markDrawStatus.type)){var pointList=firstOffset;for(var poffset of pointList){self.intersectionAdd(poffset,0,false)}dispatch.start(false)}else if(_.include([constant.INTERSECTION,constant.ADD_CONTROL_POINT,""],markDrawStatus.type)||_.include([constant.MARK_VECTOR_POINT],markDrawStatus.secType)){var xy=drawTool.reductionPoint(firstOffset);self.intersectionAdd(firstOffset,0);dispatch.start()}else if(_.include([constant.TELEGRAPH_POLE],markDrawStatus.type)){self.intersectionAdd(firstOffset,0);var typeNumber=1;if(intersectionArr[0]&&intersectionArr[0].length==typeNumber){dispatch.start()}}self.postCall=function(data,points=[]){self.postCall=undefined;drawTool.clearLeftZrenderMarker();callback=callback||_.noop;var isMultPoints=false;if(_.isArray(data)){if(1==data.length){data=data[0]}else if(1<data.length){isMultPoints=true}}if(_.isArray(points[0])&&!_.isArray(data)){data=[data];isMultPoints=true}callback(data,points[0],points[1],isMultPoints);intersectionArr.length=0;intersectionCanvasPoints.length=0}},rightClickCoord:function(evt,clickOffset){var self=this;if(!_.include([constant.TELEGRAPH_POLE,constant.ADD_BOARD,constant.ADD_BOARD_POLYGON],markDrawStatus.type)){self.clearCanvas()}self.addShape(drawTool.createStar(clickOffset));self.intersectionAdd(clickOffset,1)},intersectionAdd:function(canvasOffset,index,autoSendRequest=true){var self=this;var pointData=self.getPointData(canvasOffset,index);if(-1==$.inArray(index,[0,1])){return}var isMorePoint=_.include([constant.TELEGRAPH_POLE,constant.ADD_BOARD],markDrawStatus.type)&&!_.include([constant.MARK_VECTOR_POINT],markDrawStatus.secType);var isNomalIntersection=markDrawStatus.type==constant.INTERSECTION;var isDrawIntersection=_.include([constant.TELEGRAPH_POLE,constant.ADD_CONTROL_POINT],markDrawStatus.type)||_.include([constant.MARK_VECTOR_POINT],markDrawStatus.secType)||!markDrawStatus.type;if(!isMorePoint){if(intersectionArr[0]&&intersectionArr[1]){var arr=[1,0];var target=arr[index];intersectionArr[target]=undefined;intersectionCanvasPoints[target]=undefined;if(!target){drawTool.clearLeftZrenderMarker()}}var point=_.clone(pointData);intersectionCanvasPoints[index]={point:point.point,canvasOffset:canvasOffset,imgOffset:{x:Number(point.x),y:Number(point.y)},trackPointId:point.trackPointId};intersectionArr[index]=point;var obj;if(intersectionArr[0]&&intersectionArr[1]){dispatch.end();if(!autoSendRequest)return;postCount++;var pointArr=_.cloneDeep(intersectionArr);for(var i in pointArr){delete pointArr[i].point}obj={id:postCount.toString(),points:pointArr};var dataMgr=iD.svg.Pic.dataMgr;var _deviceId=dataMgr.trackObj&&dataMgr.trackObj.deviceId||"";var paramJson={deviceId:_deviceId,pointList:[obj]};dispatch.end();if(isNomalIntersection){intersectionPost(self,paramJson)}else if(isDrawIntersection){intersectionDrawPost(self,paramJson)}}}else{var point=_.clone(pointData);var cvsPoint=intersectionCanvasPoints[index];if(!cvsPoint){cvsPoint=intersectionCanvasPoints[index]=[]}cvsPoint.push({point:point.point,canvasOffset:canvasOffset,imgOffset:{x:Number(point.x),y:Number(point.y)},trackPointId:point.trackPointId});var itsPoint=intersectionArr[index];if(!itsPoint){itsPoint=intersectionArr[index]=[]}itsPoint.push(point);var typeNumber=1;if(markDrawStatus.type==constant.TELEGRAPH_POLE){typeNumber=1}if(markDrawStatus.type==constant.ADD_BOARD){typeNumber=4}if(intersectionArr[0]&&intersectionArr[0].length==typeNumber&&intersectionArr[1]&&intersectionArr[1].length==typeNumber){if(!autoSendRequest){dispatch.end();return}var pointArr=_.cloneDeep(intersectionArr);for(var i in pointArr){for(var j in pointArr[i]){delete pointArr[i][j].point}}var list=[];for(var i in pointArr[0]){var p0=pointArr[0][i];var p1=pointArr[1][i];if(!p0||!p1){continue}postCount++;list.push({id:postCount.toString(),points:[p0,p1]})}var dataMgr=iD.svg.Pic.dataMgr;var _deviceId=dataMgr.trackObj&&dataMgr.trackObj.deviceId||"";var paramJson={deviceId:_deviceId,pointList:list};dispatch.end();intersectionDrawPost(self,paramJson)}}},createCanvasEpiline:function(){var self=this;var pt1=intersectionArr[0];var style={strokeColor:"rgba(255, 0, 0, 0.4)",lineWidth:2};var firstPoints=[];if(pt1.length&&_.include([constant.TELEGRAPH_POLE],markDrawStatus.type)){var pt1arr=pt1;for(var i in pt1arr){var p=pt1arr[i];firstPoints.push([Number(p.x),Number(p.y)])}style.strokeColor="rgba(0, 229, 255, 0.4)"}else if(!_.isArray(pt1)){pt1=[Number(pt1.x),Number(pt1.y)];firstPoints=[pt1]}for(var idx in firstPoints){var point=firstPoints[idx];var results=iD.picUtil.getComputeEpilines(point);var pointList=results[0];for(var i in pointList){pointList[i]=drawTool.transformPoint(pointList[i])}var line=drawTool.createPolyline(pointList,{hoverable:false,style:style});self.addShape(line)}},getIntersectionData:function(){return{requestList:intersectionArr,canvasList:intersectionCanvasPoints}},clearData:function(){intersectionArr.length=0;intersectionCanvasPoints.length=0;this.postCall=undefined}});function intersectionPost(self,data){var url=iD.config.URL.forward_intersection;d3.json(url).post(JSON.stringify(data),function(error,_data){if(error||!_data||"0"!=_data.code){dispatch.request_failed();Dialog.alert("\u524D\u65B9\u4EA4\u4F1A\u5931\u8D25");return}var results=_data.resultList||_data.result||[];if(!results.length){dispatch.request_failed();Dialog.alert("\u524D\u65B9\u4EA4\u4F1A\u5931\u8D25");return}var geometry=results[0].geometry;if(drawTool.locationOutTaskEditable([geometry.lng,geometry.lat,geometry.elevation])){return false}dispatch.intersection_callback(geometry,intersectionArr,intersectionCanvasPoints)})}function intersectionDrawPost(self,data){var url=iD.config.URL.forward_intersection;d3.json(url).post(JSON.stringify(data),function(error,_data){if(error||!_data||"0"!=_data.code){dispatch.request_failed();Dialog.alert("\u524D\u65B9\u4EA4\u4F1A\u5931\u8D25");return}var results=_data.resultList||_data.result||[];if(!results.length){dispatch.request_failed();Dialog.alert("\u524D\u65B9\u4EA4\u4F1A\u5931\u8D25");return}self.postCall&&self.postCall(results,intersectionCanvasPoints)})}function intersectionDrawRectangePost(self){var url="",alertText="";if(markDrawStatus.type==constant.TELEGRAPH_LAMP_HOLDER){url=iD.config.URL.measure+"pole";alertText="\u706F\u5934"}else if(markDrawStatus.type==constant.ADD_BOARD){url=iD.config.URL.measure+"trafficsign";alertText="\u8DEF\u724C"}var pointArr=_.cloneDeep(intersectionArr);var leftXs=[],leftYs=[],rightXs=[],rightYs=[];var countMax=4;pointArr[0].forEach(function(n,idx){if(idx>=countMax){return}leftXs.push(Number(n.x));leftYs.push(Number(n.y))});pointArr[1].forEach(function(n,idx){if(idx>=countMax){return}rightXs.push(Number(n.x));rightYs.push(Number(n.y))});function getRectParam(xList,yList){var minX=_.min(xList),maxX=_.max(xList);var minY=_.min(yList),maxY=_.max(yList);return[minX,minY,maxX-minX,maxY-minY]}var data={taskId:iD.Task.d.task_id,trackId:iD.svg.Pic.dataMgr.trackId,startTrackPoint:pointArr[0][0].trackPointId,startRegion:getRectParam(leftXs,leftYs).join(","),endTrackPoint:pointArr[1][0].trackPointId,endRegion:getRectParam(rightXs,rightYs).join(",")};d3.json(url).post(JSON.stringify(data),function(error,_data){if(error||!_data||"0"!=_data.code){dispatch.request_failed();Dialog.alert(alertText+"\u6D4B\u91CF\u5931\u8D25");return}var result=_data.result;if(!result){dispatch.request_failed();Dialog.alert(alertText+"\u6D4B\u91CF\u5931\u8D25");return}self.postCall&&self.postCall(result,intersectionCanvasPoints)})}return d3.rebind(new Tool,dispatch,"on")};;iD.svg.PicDraw={};iD.svg.PicDrawUtil={};iD.svg.PicDrawUtil.clickAddLineAfter=function(shape,drawStatus,isDbclick,opts){var player=opts.player;var drawTool=player.getDrawTool();if(!opts)opts={isContinue:false,redraw:false};var flag=true;if(isDbclick&&drawTool.clearWrongShapeAndEntity.isWrong(shape,"polyline")){flag=false;drawTool.clearWrongShapeAndEntity(shape)}else if(opts.isContinue){if(opts.redraw||null!=drawStatus.__lastDrawIndex&&drawStatus.__lastDrawIndex!=player.selectPicIndex){var dids=_.compact([shape._entityid].concat(_.pluck(shape._nodeList||[],"_entityid")));dids=_.uniq(dids);drawTool.resetPointToPicPlayer(dids);var newShape=drawTool.ZEUtil.getShapesByEid(shape._entityid)[0];if(newShape){drawStatus.shape&&drawTool._zrender.remove(drawStatus.shape);drawStatus.shape=newShape;drawTool._zrender.add(newShape)}drawTool.clearZRenderHover()}}if(opts.isContinue){if(isDbclick){drawStatus.__lastDrawIndex=undefined}else{drawStatus.__lastDrawIndex=player.selectPicIndex}}return flag};iD.svg.PicDrawUtil.clickAddPolygonAfter=function(shape,drawStatus,isDbclick,opts){var player=opts.player;var drawTool=player.getDrawTool();if(!opts)opts={isContinue:false};var flag=true;if(isDbclick&&drawTool.clearWrongShapeAndEntity.isWrong(shape,"polygon")){flag=false;drawTool.clearWrongShapeAndEntity(shape)}else if(opts.isContinue){var marker=opts.marker;iD.picUtil.updateZrenderStyleByEntity(marker,marker._entityid);drawTool._zrender.add(marker);if(null!=drawStatus.__lastDrawIndex&&drawStatus.__lastDrawIndex!=player.selectPicIndex){var dids=_.compact([shape._entityid].concat(_.pluck(shape._nodeList||[],"_entityid")));dids=_.uniq(dids);drawTool.resetPointToPicPlayer(dids);var newShape=drawTool.ZEUtil.getShapesByEid(shape._entityid)[0];if(newShape){drawStatus.shape&&drawTool._zrender.remove(drawStatus.shape);drawStatus.shape=newShape;drawTool._zrender.add(newShape)}drawTool.clearZRenderHover()}}if(opts.isContinue){if(isDbclick){drawStatus.__lastDrawIndex=undefined}else{drawStatus.__lastDrawIndex=player.selectPicIndex}}return flag};iD.svg.PicDrawUtil.drawLine2Map=function(drawMark,geoData,opts={}){var player=opts.player,context=opts.context;var drawTool=player.getDrawTool();var result=drawMark;var data=geoData;if(iD.picUtil.checkDrawGeoOutEditable(drawTool,result,data)){return false}var actions=[];var isReplaceUpdate=false;result.geoType=2;var MODEL_NAME_NODE=opts.nodeModelName;var MODEL_NAME_LINE=opts.lineModelName;if(!MODEL_NAME_NODE||!MODEL_NAME_LINE)return false;var nodeLayer=iD.Layers.getCurrentModelEnableLayer(MODEL_NAME_NODE);var lineLayer=iD.Layers.getCurrentModelEnableLayer(MODEL_NAME_LINE);var fromNode=opts.downNodeid&&context.entity(opts.downNodeid);var isFromNode=fromNode&&opts.isCommonPoint&&fromNode.modelName==MODEL_NAME_NODE&&iD.util.nodeIsBreakPoint(fromNode,context.graph());if(isFromNode&&result._entityid){var fromNodeWays=context.graph().parentWays(fromNode);if(_.pluck(fromNodeWays,"id").includes(result._entityid)){isFromNode=false}}var node;if(isFromNode){node=fromNode}else{node=iD.Node({modelName:MODEL_NAME_NODE,layerId:nodeLayer.id,loc:[data.geometry.lng,data.geometry.lat,data.geometry.elevation]});node.setTags(iD.util.getDefauteTags(node,nodeLayer))}var way;var isCreate=false;if(!result._entityid){way=iD.Way({modelName:MODEL_NAME_LINE,layerId:lineLayer.id,nodes:[node.id]});way.setTags(iD.util.getDefauteTags(way,lineLayer));result._entityid=way.id;actions.push(iD.actions.AddEntity(node));actions.push(iD.actions.AddEntity(way));actions.push(iD.picUtil.measureinfoAction(node,{trackPointId:player.pic_point.tags.trackPointId,imgOffset:{x:data.geometry.xy[0],y:data.geometry.xy[1]},wayid:way.id}));isCreate=true}else{way=context.entity(result._entityid);if(!way){return}isReplaceUpdate=1==way.nodes.length;actions.push(iD.picUtil.replaceGeometryNode(way,node));actions.push(iD.picUtil.measureinfoAction(node,{trackPointId:player.pic_point.tags.trackPointId,imgOffset:{x:data.geometry.xy[0],y:data.geometry.xy[1]},wayid:way.id}))}actions.push(opts.actionText||"\u5F71\u50CF\u7ED8\u5236\u3002");var lastMkr=_.last(result._nodeList);if(lastMkr){lastMkr._entityid=node.id;lastMkr._dividerindex=isCreate?way.nodes.length-1:way.nodes.length}return{isReplaceUpdate:isReplaceUpdate,actions:actions}};iD.svg.PicDrawUtil.drawPoint2Map=function(drawMark,geoData,opts={}){var player=opts.player,context=opts.context;var drawTool=player.getDrawTool();var result=drawMark;var data=geoData;if(iD.picUtil.checkDrawGeoOutEditable(drawTool,result,data)){return false}var MODEL_NAME=opts.modelName;var actions=[];var isReplaceUpdate=false;var actions=[],createdEntities=[];var modelEntity=iD.Layers.getCurrentModelEnableLayer(MODEL_NAME);if(!modelEntity){return}var location=data.geometry&&[data.geometry.lng,data.geometry.lat,data.geometry.elevation]||data.location;var node=iD.Node({modelName:MODEL_NAME,layerId:modelEntity.id,loc:location});node.setTags(_.extend({},iD.util.getDefauteTags(node,modelEntity),data.tags));if(result){result.geoType=1;result._entityid=node.id}actions.push(iD.actions.AddEntity(node));if(0==opts.measureType){var xy=drawTool.reductionPoint(geoData.clickOffset);actions.push(iD.picUtil.measureinfoAction(node,{type:0,trackPointId:player.pic_point.tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]}}))}else if(2==opts.measureType){var xy=drawTool.reductionPoint(geoData.clickOffset);actions.push(iD.picUtil.measureinfoAction(node,{trackPointId:player.pic_point.tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]}}))}else if(1==opts.measureType){actions.push(iD.picUtil.measureinfoAction(node,{type:1,datas:player.getIntersectionData().canvasList}))}actions.push(opts.actionText||"\u7ED8\u5236\u70B9");createdEntities.push(node.id);return{isReplaceUpdate:isReplaceUpdate,actions:actions,createIds:createdEntities}};iD.svg.PicDrawUtil.drawPolygon2Map=function(drawMark,geoData,opts={}){var player=opts.player,context=opts.context;var boardArea=opts.boardArea;var drawTool=player.getDrawTool();if(iD.picUtil.checkDrawGeoOutEditable(drawTool,drawMark,geoData)){return false}var WAY_MODEL_NAME=opts.wayModelName;var NODE_MODEL_NAME=opts.nodeModelName;var wayModelEntity=iD.Layers.getCurrentModelEnableLayer(WAY_MODEL_NAME);var nodeModelEntity=iD.Layers.getCurrentModelEnableLayer(NODE_MODEL_NAME);if(!wayModelEntity||!nodeModelEntity){return}var isReplaceUpdate=false;var boardNodeCount=0;var actions=[];var result=drawMark;var data=geoData;var location=data.geometry&&[data.geometry.lng,data.geometry.lat,data.geometry.elevation]||data.location;result.geoType=3;var modelEntity=iD.Layers.getCurrentModelEnableLayer(NODE_MODEL_NAME);if(!modelEntity){return}var node=iD.Node({modelName:NODE_MODEL_NAME,layerId:modelEntity.id,loc:location});node.setTags(iD.util.getDefauteTags(node,modelEntity));if(!result._entityid){boardNodeCount=2;var areaLayer=iD.Layers.getCurrentModelEnableLayer(WAY_MODEL_NAME);boardArea=iD.Way({layerId:areaLayer.id,modelName:WAY_MODEL_NAME,nodes:[]});boardArea.setTags(_.extend({},iD.util.getDefauteTags(boardArea,areaLayer),opts.wayTags));actions.push(...[iD.actions.AddEntity(boardArea),iD.actions.AddEntity(node),iD.actions.AddVertex(boardArea.id,node.id),iD.actions.AddVertex(boardArea.id,node.id)]);result._entityid=boardArea.id}else{boardNodeCount=1;boardArea=context.entity(result._entityid);isReplaceUpdate=3>=boardArea.nodes.length;actions.push(...[iD.actions.AddEntity(node),iD.actions.AddVertex(boardArea.id,node.id,boardArea.nodes.length-1)])}var xy=drawTool.reductionPoint(data.clickOffset);actions.push(iD.picUtil.measureinfoAction(node,{trackPointId:player.pic_point.tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]},wayid:boardArea.id}));actions.push(opts.actionText||"\u7ED8\u5236\u9762");result._entityid=boardArea.id;var lastMkr=result._nodeList&&result._nodeList[result._nodeList.length-1];if(2==boardNodeCount){result._nodeList[0]._entityid=node.id;result._nodeList[0]._dividerindex=0}else if(lastMkr){lastMkr._entityid=node.id;lastMkr._dividerindex=boardArea.nodes.length-1}return{isReplaceUpdate:isReplaceUpdate,actions:actions,boardArea:boardArea}};iD.svg.PicDrawUtil.drawFullPolygon2Map=function(drawMark,geoData,opts={}){var player=opts.player,context=opts.context;var boardArea=opts.boardArea;var drawTool=player.getDrawTool();if(iD.picUtil.checkDrawGeoOutEditable(drawTool,drawMark,geoData)){return false}var WAY_MODEL_NAME=opts.wayModelName;var NODE_MODEL_NAME=opts.nodeModelName;var wayModelEntity=iD.Layers.getCurrentModelEnableLayer(WAY_MODEL_NAME);var nodeModelEntity=iD.Layers.getCurrentModelEnableLayer(NODE_MODEL_NAME);if(!wayModelEntity||!nodeModelEntity){return}var drawMarkList,dataGeoList;if(_.isArray(drawMark)){drawMarkList=drawMark;dataGeoList=geoData}else{drawMarkList=[drawMark];dataGeoList=[geoData]}var boardArea=iD.Way({layerId:wayModelEntity.id,modelName:WAY_MODEL_NAME,nodes:[]});boardArea.setTags(_.extend({},iD.util.getDefauteTags(boardArea,wayModelEntity),opts.wayTags));var allActions=[[iD.actions.AddEntity(boardArea)]];var boardNodeCount=0;for(var idx in drawMarkList){var result=drawMarkList[idx];var data=dataGeoList[idx];var actions=[];result.geoType=3;var node=iD.Node({modelName:NODE_MODEL_NAME,layerId:nodeModelEntity.id,loc:[data.geometry.lng,data.geometry.lat,data.geometry.elevation]});node.setTags(iD.util.getDefauteTags(node,nodeModelEntity));if(0==idx){boardNodeCount+=2;actions.push(...[iD.actions.AddEntity(node),iD.actions.AddVertex(boardArea.id,node.id),iD.actions.AddVertex(boardArea.id,node.id)])}else{boardNodeCount+=1;actions.push(...[iD.actions.AddEntity(node),iD.actions.AddVertex(boardArea.id,node.id,idx)])}var xy=drawTool.reductionPoint(data.clickOffset);actions.push(iD.picUtil.measureinfoAction(node,{trackPointId:player.allNodes[player.selectPicIndex].tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]},wayid:boardArea.id}));actions.push(opts.actionText||"\u7ED8\u5236\u9762");result._entityid=node.id;result._dividerindex=boardNodeCount-2;if(result._shape&&!result._shape._entityid){var zrenderPolygon=result._shape;zrenderPolygon._entityid=boardArea.id}allActions.push(actions)}return{allActions:allActions,boardArea:boardArea}};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addCheckTag=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={},zrenderNodeStatus;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1,arg2){drawStatus=arg1;zrenderNodeStatus=arg2},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_CHECK_TAG_POINT},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u8D28\u68C0\u6807\u8BB0\u70B9").data([this.getId()])},reset:function(){},domClick:function(evt,clickOffset,opts){var self=this;var geometry=iD.picUtil.pixelToLngLat(clickOffset);drawGeometry2Map2AutoMatch({geometry});player.clearFooterButton();return false}});function drawGeometry2Map2AutoMatch(dataOpts){dataOpts.tags={CREATEBY:iD.User.getInfo().username,TRACKID:player.dataMgr.trackId,TRACKPOINTID:player.pic_point.tags.trackPointId};var result=iD.svg.PicDrawUtil.drawPoint2Map(null,dataOpts,{player:player,context:context,actionText:"\u6DFB\u52A0\u8D28\u68C0\u6807\u8BB0\u70B9",modelName:iD.data.DataType.CHECK_TAG});if(!result)return false;var actions=result.actions;var createIds=result.createIds;if(actions.length){drawTool._drawActionsPerform([actions],false);drawTool.resetPointToPicPlayer(createIds);createIds.length&&drawTool._lightMapEntities(createIds);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addImageTag=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={},zrenderNodeStatus;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1,arg2){drawStatus=arg1;zrenderNodeStatus=arg2},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_IMAGE_TAG_POINT},renderBtn:function(selection){if(!iD.User.authQueryTag()){return}selection.append("button").attr("type","button").text("\u56FE\u50CF\u6807\u8BB0\u70B9").data([this.getId()])},reset:function(){},buttonClick:function(evt,isActive,button){var nownode=player.pic_point;var batch=getPicBatch();var extent=iD.util.getBounds(nownode.loc,10);var entities=context.intersects(extent);var repeat=false;for(var entity of entities){if(entity.modelName==iD.data.DataType.IMAGE_TAG&&nownode.tags.trackId==entity.tags.TRACKID&&nownode.tags.trackPointId==entity.tags.TRACKPOINTID&&(entity.tags.BATCH||"")==batch){repeat=true}}if(entities.length&&repeat){Dialog.sidebarAlert("\u5F53\u524D"+(batch?"\u6279\u6B21"+batch:"\u56FE\u50CF")+"\u5DF2\u88AB\u6807\u8BB0",{time:4000,type:"error"});return}drawGeometry2Map2AutoMatch({location:nownode.loc},{BATCH:batch});player.clearFooterButton();player._refreshViewTextTag(nownode);return false}});function getPicBatch(){if("0"!=player.getPicUrlParam().type){return player.picTools.select("#_sublist").value()}return""}function drawGeometry2Map2AutoMatch(data,newTags){data.tags={MARKBY:iD.User.getInfo().username,TRACKID:player.dataMgr.trackId,TRACKPOINTID:player.pic_point.tags.trackPointId,TRACKPOINTSEQ:player.pic_point.tags.seq||"",BATCH:newTags.BATCH,MARKTIME:new Date().getTime()};var result=iD.svg.PicDrawUtil.drawPoint2Map(null,data,{player:player,context:context,actionText:"\u6DFB\u52A0\u56FE\u50CF\u6807\u8BB0\u70B9",modelName:iD.data.DataType.IMAGE_TAG});if(!result)return false;var actions=result.actions;var createIds=result.createIds;if(actions.length){drawTool._drawActionsPerform([actions],false);drawTool.resetPointToPicPlayer(createIds);createIds.length&&drawTool._lightMapEntities(createIds);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addAnalysisTag=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={},zrenderNodeStatus;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1,arg2){drawStatus=arg1;zrenderNodeStatus=arg2},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_ANALYSIS_TAG_POINT},renderBtn:function(selection){var uselessClass="footer_useless_btn";selection.append("button").attr("class",uselessClass).attr("type","button").text("\u5206\u6790\u6807\u8BB0\u70B9").data([this.getId()])},reset:function(){},domClick:function(evt,clickOffset,opts){var self=this;var geometry=iD.picUtil.pixelToLngLat(clickOffset);var batch=getPicBatch();var pixel=drawTool.reductionPoint(clickOffset)||[];drawGeometry2Map2AutoMatch({geometry},{BATCH:batch,PIXEL:pixel.join(",")});player.clearFooterButton();return false}});function getPicBatch(){if("0"!=player.getPicUrlParam().type){return player.picTools.select("#_sublist").value()}return""}function drawGeometry2Map2AutoMatch(data,newTags){data.tags={MARKBY:iD.User.getInfo().username,TRACKID:player.dataMgr.trackId,TRACKPOINTID:player.pic_point.tags.trackPointId,TRACKPOINTSEQ:player.pic_point.tags.seq||"",BATCH:newTags.BATCH,MARKTIME:new Date().getTime(),PIXEL:newTags.PIXEL};var result=iD.svg.PicDrawUtil.drawPoint2Map(null,data,{player:player,context:context,actionText:"\u6DFB\u52A0\u5206\u6790\u6807\u8BB0\u70B9",modelName:iD.data.DataType.ANALYSIS_TAG});if(!result)return false;var actions=result.actions;var createIds=result.createIds;if(actions.length){drawTool._drawActionsPerform([actions],false);drawTool.resetPointToPicPlayer(createIds);createIds.length&&drawTool._lightMapEntities(createIds);drawTool.clearZRenderHover();return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addQuestionTag=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1,arg2){drawStatus=arg1},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_QUESTION_TAG_POINT},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u95EE\u9898\u8BB0\u5F55\u6807\u8BB0\u70B9").data([this.getId()])},reset:function(){},domClick:function(evt,clickOffset,opts){var self=this;var geometry=iD.picUtil.pixelToLngLat(clickOffset);var pixel=drawTool.reductionPoint(clickOffset)||[];drawGeometry2Map2AutoMatch({geometry});player.clearFooterButton();return false}});function drawGeometry2Map2AutoMatch(data,newTags){data.tags={CREATEBY:iD.User.getInfo().username,TRACKID:player.dataMgr.trackId,TRACKPOINTID:player.pic_point.tags.trackPointId};var result=iD.svg.PicDrawUtil.drawPoint2Map(null,data,{player:player,context:context,actionText:"\u6DFB\u52A0\u95EE\u9898\u8BB0\u5F55\u6807\u8BB0\u70B9",modelName:iD.data.DataType.QUESTION_TAG});if(!result)return false;var actions=result.actions;var createIds=result.createIds;if(actions.length){drawTool._drawActionsPerform([actions],false);drawTool.resetPointToPicPlayer(createIds);createIds.length&&drawTool._lightMapEntities(createIds);drawTool.clearZRenderHover();return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addBoardPolygon=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};var secType,markVectorLoc,markVectorPoints;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},check:function(btnType){if(btnType)return btnType==this.getId();if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_BOARD_POLYGON},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u8DEF\u724C(\u591A\u8FB9\u5F62)").data([this.getId()])},reset:function(){secType=undefined;markVectorLoc=undefined;markVectorPoints=undefined},buttonClick:function(evt,active,node){secType=active?constant.MARK_VECTOR_POINT:undefined;drawStatus.secType=secType},domClick:function(evt,clickOffset,opts={}){if(secType)return;var self=this;if(!markVectorLoc||!markVectorLoc.length){Dialog.alert("\u7ED8\u5236\u8DEF\u724C\u4E4B\u524D\u9700\u8981\u83B7\u53D6\u7B2C\u4E00\u4E2A\u70B9\u7684\u524D\u65B9\u4EA4\u4F1A\u5750\u6807");player.clearFooterButton();return false}var presult=drawTool.zrenderDrawPolygon(clickOffset,false);iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);return false},domClickMore:function(evt,clickOffset,data,point,point2,isMultPoints){if(!secType)return false;var self=this;var presult=drawTool.zrenderDrawPolygon(clickOffset,false);if(secType==constant.MARK_VECTOR_POINT&&data.geometry){markVectorLoc=[data.geometry.lng,data.geometry.lat,data.geometry.elevation];if(drawTool.locationOutTaskEditable(markVectorLoc)){return false}markVectorPoints=[point,point2];iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);drawStatus.secType=undefined;secType=undefined;return false}},domDblclick:function(evt,clickOffset,opts={}){if(secType)return false;var self=this;if(!markVectorLoc||!markVectorLoc.length){Dialog("\u7ED8\u5236\u8DEF\u724C\u4E4B\u524D\u9700\u8981\u83B7\u53D6\u7B2C\u4E00\u4E2A\u70B9\u7684\u524D\u65B9\u4EA4\u4F1A\u5750\u6807");player.clearFooterButton();return}var shape=drawTool.zrenderDrawPolygon(clickOffset,true);self.drawnAddPolygon(shape);player.clearFooterButton();self.reset();return false},drawnAddPolygon:function(shape){var self=this;var pointList=_.cloneDeep(shape.shape.points);pointList=pointList.slice(0,pointList.length-1);var markerList=[],dataList=[];for(var point of pointList){var marker=drawTool.drawGeometryNodes(shape,{canvasOffset:point},{draggable:true});markerList.push(marker)}var fieldPlane=iD.picUtil.getEntityPlaneParam(markVectorLoc,player.selectPicIndex);if(fieldPlane){for(var clickPoint of pointList){var xy=drawTool.reductionPoint(clickPoint);var lonlats=iD.picUtil.pixelToLngLatByPlane(xy,fieldPlane);var geometry={};geometry.lng=lonlats[0];geometry.lat=lonlats[1];geometry.elevation=lonlats[2];dataList.push({geometry,clickOffset:clickPoint})}}drawGeometry2Map(markerList,dataList,{tags:{PLANE:fieldPlane}});for(var marker of markerList){iD.picUtil.updateZrenderStyleByEntity(marker,marker._entityid);drawTool._zrender.add(marker)}drawTool.clearWrongShapeAndEntity(shape)}});function drawGeometry2Map(drawMark,geoData,opts){var result=iD.svg.PicDrawUtil.drawFullPolygon2Map(drawMark,geoData,{player:player,context:context,actionText:"\u7ED8\u5236\u8DEF\u724C",nodeModelName:iD.data.DataType.TRAFFICSIGN_NODE,wayModelName:iD.data.DataType.TRAFFICSIGN,wayTags:opts.tags});if(!result)return false;var allActions=result.allActions;if(allActions.length){var firstid=drawMark[0]._entityid;var tempActions=[];tempActions.push(function(graph){let node=graph.entity(firstid);let measureinfo=iD.picUtil.measureinfoAction(node,{type:1,datas:markVectorPoints||player.getIntersectionData().canvasList});return measureinfo(graph)});tempActions.push("\u7ED8\u5236\u8DEF\u724C");allActions.push(tempActions);drawTool._drawActionsPerform(allActions,false);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addBridgeDivider=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};var secType,markVectorLoc,markVectorPoints;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},check:function(btnType){if(btnType)return btnType==this.getId();if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.BRIDGE_BOTTOM_LINE},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u6865\u5E95\u7EBF").data([this.getId()])},reset:function(){secType=undefined;markVectorLoc=undefined;markVectorPoints=undefined},buttonClick:function(evt,active,node){secType=active?constant.MARK_VECTOR_POINT:undefined;drawStatus.secType=secType},domClick:function(evt,clickOffset,opts={}){if(secType)return;var self=this;if(!markVectorLoc||!markVectorLoc.length){Dialog.alert("\u7ED8\u5236\u6865\u5E95\u7EBF\u4E4B\u524D\u9700\u8981\u83B7\u53D6\u7B2C\u4E00\u4E2A\u70B9\u7684\u524D\u65B9\u4EA4\u4F1A\u5750\u6807");player.clearFooterButton();return false}var presult=drawTool.zrenderDrawpolyline(clickOffset,false);iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);self.clickAddDivider(presult,clickOffset);return false},domClickMore:function(evt,clickOffset,data,point,point2,isMultPoints){if(!secType)return false;var self=this;var presult=drawTool.zrenderDrawpolyline(clickOffset,false);if(secType==constant.MARK_VECTOR_POINT&&data.geometry){markVectorLoc=[data.geometry.lng,data.geometry.lat,data.geometry.elevation];if(drawTool.locationOutTaskEditable(markVectorLoc)){return false}markVectorPoints=[point,point2];iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);self.clickAddDivider(presult,clickOffset);drawStatus.secType=undefined;secType=undefined;return false}},domDblclick:function(evt,clickOffset,opts={}){if(secType)return false;var self=this;if(!markVectorLoc||!markVectorLoc.length){Dialog("\u7ED8\u5236\u6865\u5E95\u7EBF\u4E4B\u524D\u9700\u8981\u6807\u8BB0\u7279\u5F81\u70B9");player.clearFooterButton();return false}var presult=drawTool.zrenderDrawpolyline(clickOffset,true);iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);self.clickAddDivider(presult,clickOffset,true);if(presult._entityid&&presult._nodeList&&_.compact(presult.shape.points).length!=presult._nodeList.length){var _entity=context.hasEntity(presult._entityid);_entity&&drawTool.resetPointToPicPlayer([_entity.id].concat(_entity.nodes))}player.clearFooterButton();self.reset();return false},clickAddDivider:function(shape,clickOffset,isDbclick=false,opts={}){var self=this;var fieldPlane,isFirstDraw=false;var geometry=iD.picUtil.pixelToLngLat(clickOffset);var xy=drawTool.reductionPoint(clickOffset);geometry.xy=xy;if(shape._entityid){var entity=context.entity(shape._entityid);if(!entity.tags.PLANE){fieldPlane=iD.picUtil.getEntityPlaneParam(markVectorLoc,self.selectPicIndex)}else{fieldPlane=entity.tags.PLANE}}else{isFirstDraw=true;fieldPlane=iD.picUtil.getEntityPlaneParam(markVectorLoc,self.selectPicIndex)}if(fieldPlane){var xy=drawTool.reductionPoint(clickOffset);var lonlats=iD.picUtil.pixelToLngLatByPlane(xy,fieldPlane);geometry.lng=lonlats[0];geometry.lat=lonlats[1];geometry.elevation=lonlats[2];geometry.xy=xy}var marker=drawTool.drawGeometryNodes(shape,{canvasOffset:clickOffset},{draggable:true});drawGeometry2Map(shape,_.extend({},opts,{geometry}));iD.picUtil.updateZrenderStyleByEntity(marker,marker._entityid);if(isFirstDraw&&shape._entityid&&fieldPlane){var entity=context.entity(shape._entityid);if(fieldPlane!=entity.tags.PLANE){entity.tags.PLANE=fieldPlane}}var flag=iD.svg.PicDrawUtil.clickAddLineAfter(shape,drawStatus,isDbclick,{isContinue:false,player:player});return flag}});function drawGeometry2Map(drawMark,geoData){var result=iD.svg.PicDrawUtil.drawLine2Map(drawMark,geoData,{player:player,context:context,actionText:"\u7ED8\u5236\u6865\u5E95\u7EBF",isCommonPoint:false,nodeModelName:iD.data.DataType.BRIDGE_NODE,lineModelName:iD.data.DataType.BRIDGE});if(!result)return false;var isReplaceUpdate=result.isReplaceUpdate;var actions=result.actions;var allActions=actions.length&&[actions]||[];if(actions.length&&drawMark._entityid&&1==drawMark._nodeList.length){var firstid=drawMark._nodeList[0]._entityid;var tempActions=[];tempActions.push(function(graph){let node=graph.entity(firstid);let measureinfo=iD.picUtil.measureinfoAction(node,{type:1,datas:markVectorPoints||player.getIntersectionData().canvasList});return measureinfo(graph)});tempActions.push("\u7ED8\u5236\u6865\u5E95\u7EBF");allActions.push(tempActions)}if(allActions.length){drawTool._drawActionsPerform(allActions,isReplaceUpdate);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addControlPoint=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_CONTROL_POINT},renderBtn:function(selection){var uselessClass="footer_useless_btn";selection.append("button").attr("class",uselessClass).attr("type","button").text("\u63A7\u5236\u70B9").data([this.getId()])},reset:function(){},domClickMore:function(evt,clickOffset,data,point,point2,isMultPoints){var result=drawTool.drawGeometryPoint(point);drawGeometry2Map(result,data);iD.picUtil.updateZrenderStyleByEntity(result,result._entityid);drawTool._zrender.add(result);player.clearFooterButton();return false}});function drawGeometry2Map(result,data){data.tags={TYPE:2,SUBTYPE:14};var result=iD.svg.PicDrawUtil.drawPoint2Map(result,data,{player:player,context:context,actionText:"\u6DFB\u52A0\u63A7\u5236\u70B9",modelName:iD.data.DataType.OBJECT_PT,measureType:1});if(!result)return false;var actions=result.actions;var createIds=result.createIds;if(actions.length){drawTool._drawActionsPerform([actions],false);createIds.length&&drawTool._lightMapEntities(createIds);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addDividerPolygon=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={},zrenderNodeStatus;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1,arg2){drawStatus=arg1;zrenderNodeStatus=arg2},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_DIVIDER_POLYGON},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u5BFC\u6D41\u5E26").data([this.getId()])},reset:function(){},domClick:function(evt,clickOffset,opts){var self=this;drawTool.zrenderDrawpolyline(clickOffset,false);return false},domDblclick:function(evt,clickOffset){var self=this;var shape=drawTool.zrenderDrawpolyline(clickOffset,true);drawTool._zrender.remove(shape);var locs=shape.shape.points;createDividerPolygon(locs);player.clearFooterButton();return false}});function createDividerPolygon(locs){var intersectLoc=null,boundsObj=iD.picUtil.getBoundsByLine(locs),path=boundsObj.path,bounds=boundsObj.bounds,allEntities=context.intersects(bounds);var ways=[];for(var j=0;j<allEntities.length;j++){var entity=allEntities[j];if(entity.modelName==iD.data.DataType.DIVIDER){ways.push(entity)}}if(1<ways.length){var graph=context.graph(),projection=context.projection,intersectWays=[];for(var w=0;w<ways.length;w+=2){var first=ways[w];var second=ways[w+1];var eP1=iD.util.getSegmentIntersectLoc(path,first.nodes,graph);if(0!=eP1.length){intersectWays.push({way:first,intersectLoc:projection(eP1[0])})}if(second){var eP2=iD.util.getSegmentIntersectLoc(path,second.nodes,graph);if(0!=eP2.length){intersectWays.push({way:second,intersectLoc:projection(eP2[0])})}}}for(var i=0;i<intersectWays.length;i++){var obj1=intersectWays[i];var obj2=intersectWays[i+1];if(obj2){var first=obj1.way;var second=obj2.way;var sameNodeId=iD.util.hasSameNode(first,second),intersectLoc=null;if(sameNodeId){var e=graph.entity(sameNodeId);intersectLoc=e.loc}else{intersectLoc=iD.util.getIntersectLocByNodes(first.nodes,second.nodes,context.graph())[0]}if(intersectLoc){var vertex_px=projection(intersectLoc);var endPoint1_px=obj1.intersectLoc;var endPoint2_px=obj2.intersectLoc;var firstNodes=graph.childNodes(first);var secondNodes=graph.childNodes(second);var e1=iD.geo.chooseEdge(firstNodes,vertex_px,projection);var e2=iD.geo.chooseEdge(firstNodes,endPoint1_px,projection);var e3=iD.geo.chooseEdge(secondNodes,endPoint2_px,projection);var f_node_e1=firstNodes[e1.index-1].loc;var t_node_e1=firstNodes[e1.index].loc;var vertexTem=iD.util.getBetweenPointLoc(f_node_e1,t_node_e1,e1.loc);var vertex={lng:vertexTem[0],lat:vertexTem[1],elevation:vertexTem[2]};var f_node_e2=firstNodes[e1.index-1].loc;var t_node_e2=firstNodes[e1.index].loc;var endPointTem1=iD.util.getBetweenPointLoc(f_node_e2,t_node_e2,e2.loc);var endPoint1={lng:endPointTem1[0],lat:endPointTem1[1],elevation:endPointTem1[2]};var f_node_e3=firstNodes[e1.index-1].loc;var t_node_e3=firstNodes[e1.index].loc;var endPointTem2=iD.util.getBetweenPointLoc(f_node_e3,t_node_e3,e3.loc);var endPoint2={lng:endPointTem2[0],lat:endPointTem2[1],elevation:endPointTem2[2]};var rstData=createMapEntityByGeometry({geoList:[vertex,endPoint1,endPoint2]});var actions=rstData.actions,allActions=[],updateEntityids=rstData.createdEntities,entityid=rstData.id,isReplaceUpdate=false;allActions.push(actions);allActions.length&&drawTool._drawActionsPerform(allActions,isReplaceUpdate);drawTool.resetPointToPicPlayer(updateEntityids)}}}}else{Dialog.alert("\u8BF7\u76F8\u4EA4\u4E8E\u4E24\u6761\u8F66\u9053\u7EBF\uFF01")}}function createMapEntityByGeometry(data){var createdEntities=[],actions=[],returnParam={};var pgModelEntity=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.OBJECT_PG);var nodeModelEntity=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.OBJECT_PG_NODE);if(!pgModelEntity||!nodeModelEntity){return}var lonlatList=data.geoList;var nodeidList=[];var ntags={TYPE:3,SUBTYPE:9};var boardArea=iD.Way({layerId:pgModelEntity.id,modelName:iD.data.DataType.OBJECT_PG,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.OBJECT_PG,pgModelEntity),ntags),nodes:[]});actions.push(iD.actions.AddEntity(boardArea));for(var i=0;i<lonlatList.length;i++){var lonlat=lonlatList[i];var node=iD.Node({modelName:iD.data.DataType.OBJECT_PG_NODE,layerId:nodeModelEntity.id,tags:iD.util.getDefauteTags(iD.data.DataType.OBJECT_PG_NODE,nodeModelEntity),loc:[lonlat.lng,lonlat.lat,lonlat.elevation]});actions.push(iD.actions.AddEntity(node));actions.push(iD.actions.AddVertex(boardArea.id,node.id));nodeidList.push(node.id)}actions.push(iD.actions.AddVertex(boardArea.id,nodeidList[0]));actions.push("\u7ED8\u5236\u5BFC\u6D41\u5E26");createdEntities.push(boardArea.id);createdEntities.push(...nodeidList);returnParam.id=boardArea.id;return _.extend(returnParam,{createdEntities:createdEntities,actions:actions})}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addDivider=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};var trackPointChanged=false;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1;var self=this;player.on("picUpdate.add-divider",function(){if(!self.check())return;trackPointChanged=true})},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_DIVIDER},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u6DFB\u52A0\u8F66\u9053\u7EBF").data([this.getId()])},reset:function(){drawStatus.__lastDrawIndex=undefined;trackPointChanged=false},domClick:function(evt,clickOffset,opts={}){var self=this;var presult=drawStatus.shape;var downInfo=drawTool.drawClickBreakNode(drawStatus.type,presult&&[presult._entityid]);if(downInfo){var downShape=downInfo.shape;if(downShape){var shapeXY=iD.picUtil.shapeXY(downShape);clickOffset=shapeXY&&shapeXY||clickOffset}var isEnd=false;if(!presult){isEnd=false}else if(!presult._entityid||!presult._nodeList||!presult._nodeList.length){isEnd=false}else{isEnd=true}presult=drawTool.zrenderDrawpolyline(clickOffset,isEnd);iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);self.clickAddDivider(presult,clickOffset,isEnd,{downNodeid:downInfo.entityid})}else{presult=drawTool.zrenderDrawpolyline(clickOffset,false);iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);self.clickAddDivider(presult,clickOffset,false)}drawTool.clearZRenderNodeStatus();return false},domDblclick:function(evt,clickOffset,opts={}){var self=this;var presult=drawStatus.shape;if(!presult){self.reset();return false}if(presult._entityid){var geometry=iD.picUtil.pixelToLngLat(clickOffset);var shape=drawStatus.shape;var way=context.hasEntity(shape._entityid);if(way&&drawTool.checkLineNodeDistanceLTE(context.entity(_.last(way.nodes)).loc,[geometry.lng,geometry.lat])){return}}var downInfo=drawTool.drawClickBreakNode(drawStatus.type,presult&&[presult._entityid]);var downShape=downInfo&&downInfo.shape;if(downShape){var shapeXY=iD.picUtil.shapeXY(downShape);clickOffset=shapeXY&&shapeXY||clickOffset}presult=drawTool.zrenderDrawpolyline(clickOffset,true);iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);self.clickAddDivider(presult,clickOffset,true,downInfo&&{downNodeid:downInfo.entityid});drawTool.clearZRenderNodeStatus();drawStatus.shape=null;self.reset();return false},clickAddDivider:function(shape,clickOffset,isDbclick=false,opts={}){var geometry=iD.picUtil.pixelToLngLat(clickOffset);var xy=drawTool.reductionPoint(clickOffset);geometry.xy=xy;if(shape._entityid&&context.hasEntity(shape._entityid)){var way=context.entity(shape._entityid);var lastid=_.last(way.nodes);var node=context.entity(lastid);if(drawTool.checkLineNodeDistanceLTE(node.loc,[geometry.lng,geometry.lat])){shape.shape.points.length>(shape._nodeList||[]).length&&shape.shape.points.pop();return}}var marker=drawTool.drawGeometryNodes(shape,{canvasOffset:clickOffset},{draggable:true});drawGeometry2Map(shape,{geometry},opts);iD.picUtil.updateZrenderStyleByEntity(marker,marker._entityid);var flag=iD.svg.PicDrawUtil.clickAddLineAfter(shape,drawStatus,isDbclick,{isContinue:true,player:player,redraw:trackPointChanged&&2==shape._nodeList.length});trackPointChanged=false;return flag}});function drawGeometry2Map(drawMark,geoData,opts){var result=iD.svg.PicDrawUtil.drawLine2Map(drawMark,geoData,{player:player,context:context,actionText:"\u7ED8\u5236\u8F66\u9053\u7EBF",downNodeid:opts.downNodeid,isCommonPoint:true,nodeModelName:iD.data.DataType.DIVIDER_NODE,lineModelName:iD.data.DataType.DIVIDER});if(!result)return false;var isReplaceUpdate=result.isReplaceUpdate;var actions=result.actions;if(actions&&actions.length){drawTool._drawActionsPerform([actions],isReplaceUpdate);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addGroundArea=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={},zrenderNodeStatus;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1,arg2){drawStatus=arg1;zrenderNodeStatus=arg2},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_GROUND_AREA},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u5730\u9762\u533A\u57DF").data([this.getId()])},reset:function(){},domMousedown:function(evt,clickOffset){if(drawStatus.type!=constant.ADD_GROUND_AREA)return false;drawTool.zrenderDrawRectangeOnMap(clickOffset,false);return false},domMouseup:function(evt,clickOffset,opts){if(drawStatus.type!=constant.ADD_GROUND_AREA)return false;var entityid=drawTool.zrenderDrawRectangeOnMap(clickOffset,true);player.clearFooterButton();if(iD.picUtil.isPointEqual(opts.downOffset,clickOffset,5)){if(entityid&&context.hasEntity(entityid)){context.pop();drawTool.resetCanvas()}}return false},zrenderMove:function(evt,moveOffset,opts){if(drawStatus.type!=constant.ADD_GROUND_AREA)return;updateMoveMapEntityByGeometry([zrenderNodeStatus.downOffset,moveOffset],{mouseup:opts.mouseup});return false},dragEventMove:function(evt,moveOffset,opts){if(drawStatus.type)return;if(!iD.picUtil.checkNodeIsGroundArea(zrenderNodeStatus.downEntityid)){return}if(opts.isFirst){context.perform(iD.actions.Noop(),"")}updateMoveMapEntityByGeometry([zrenderNodeStatus.downOffset,moveOffset],{moveEntityId:zrenderNodeStatus.downEntityid})},dragEventMoveend:function(evt,moveOffset,opts){if(drawStatus.type)return;if(!iD.picUtil.checkNodeIsGroundArea(zrenderNodeStatus.downEntityid)){return}updateMoveMapEntityByGeometry([zrenderNodeStatus.downOffset,moveOffset],{moveEntityId:zrenderNodeStatus.downEntityid,mouseup:true})}});function updateMoveMapEntityByGeometry(data,opts={}){var allActions=[],isReplaceUpdate=false,updateEntityids=[];var moveNodeid=opts.moveEntityId,isMouseUp=opts.mouseup;var mRemoves=[],mAdds=[];if(drawStatus.type==constant.ADD_GROUND_AREA){var entityid=zrenderNodeStatus.drawingEntityid;var actions=[];var rstData;if(!entityid){var _points=[data[0],data[1]];var rectPoints=iD.picUtil.createRectangeBy2Point(_points);rstData=createMapEntityByGeometry({geoList:_.map(rectPoints,function(p){return iD.picUtil.pixelToLngLat(p)})});actions=rstData.actions;updateEntityids=rstData.createdEntities;entityid=rstData.id;isReplaceUpdate=false;zrenderNodeStatus.drawingEntityid=entityid}else{var boardArea=context.entity(entityid);var nodes=context.graph().childNodes(boardArea);var _points=[data[0],data[1]];var moveGeo=iD.picUtil.pixelToLngLat(data[1]);var rectPoints=iD.picUtil.createRectangeBy2Point(_points);var lonlatList=iD.picUtil.createRectangleByGeo(_.map(rectPoints,function(p){return iD.picUtil.pixelToLngLat(p)}));lonlatList=_.map(lonlatList,function(lonlat){return[lonlat.lng,lonlat.lat,lonlat.elevation]});if(isMouseUp){for(var idx in lonlatList){var loc=lonlatList[idx];if(drawTool.locationOutTaskEditable(loc,{pop:true})){return false}}for(var nid of boardArea.nodes){var point=drawTool.ZEUtil.getShapesByEid(nid)[0];var xy=[];if(point){xy=iD.picUtil.shapeXY(point);mAdds.push({node:context.entity(nid),xy:xy})}}}for(var i=0;i<lonlatList.length;i++){var lonlat=lonlatList[i];if(0==i){continue}else if(2==i){actions.push(iD.actions.UpdateNode(context,nodes[i].move([moveGeo.lng,moveGeo.lat,moveGeo.elevation])));continue}actions.push(iD.actions.UpdateNode(context,nodes[i].move([lonlat[0],lonlat[1],lonlat[2]])))}updateEntityids=_.uniq([boardArea.id].concat(boardArea.nodes));isReplaceUpdate=true}zrenderNodeStatus.drawingEntityid=entityid;if(isMouseUp){for(var item of mAdds){var xy=drawTool.reductionPoint(item.xy);actions.push(iD.picUtil.measureinfoAction(item.node,{trackPointId:player.pic_point.tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]}}))}for(var node of mRemoves){actions.push(iD.picUtil.measureinfoAction(node,{type:-1}))}}if(actions.length&&"string"!=typeof actions[actions.length-1]){actions.push("\u66F4\u6539\u5730\u9762\u533A\u57DF")}allActions.push(actions)}else{var actions=[];var nowNode=context.entity(moveNodeid);var boardArea=context.entity(zrenderNodeStatus.drawingEntityid);var nodes=context.graph().childNodes(boardArea);var nowIndex=boardArea.nodes.indexOf(moveNodeid);if(-1==nowIndex||5!=nodes.length){return}var crossIndex=_nodesIndex(nowIndex,2);var crossNode=nodes[crossIndex];var prevIndex=_nodesIndex(nowIndex,-1);var prevNode=nodes[prevIndex];var nextIndex=_nodesIndex(nowIndex,1);var nextNode=nodes[nextIndex];var nowGeo=iD.picUtil.pixelToLngLat(data[1]);var projection=context.projection;var crossLoc=projection(crossNode.loc),oldPrevLoc=projection(prevNode.loc);var nowLoc=projection([nowGeo.lng,nowGeo.lat]);var temp=[];var trst=iD.util.pedal([crossLoc[0],crossLoc[1],oldPrevLoc[0],oldPrevLoc[1]],nowLoc,temp);var prevLoc=[temp[0],temp[1]];var prevDiffLoc=[prevLoc[0]-nowLoc[0],prevLoc[1]-nowLoc[1]];var nextLoc=[crossLoc[0]-prevDiffLoc[0],crossLoc[1]-prevDiffLoc[1]];crossLoc=crossNode.loc;prevLoc=projection.invert(prevLoc);prevLoc[2]=prevNode.loc[2];nowLoc=projection.invert(nowLoc);nowLoc[2]=nowGeo.elevation;nextLoc=projection.invert(nextLoc);nextLoc[2]=nextNode.loc[2];prevNode=prevNode.move(prevLoc);nowNode=nowNode.move(nowLoc);nextNode=nextNode.move(nextLoc);actions.push(iD.actions.UpdateNode(context,prevNode));actions.push(iD.actions.UpdateNode(context,nowNode));actions.push(iD.actions.UpdateNode(context,nextNode));if(isMouseUp){var lonlatList=[crossLoc,prevLoc,nowLoc,nextLoc];for(var idx in lonlatList){var loc=lonlatList[idx];if(drawTool.locationOutTaskEditable(loc,{pop:true})){return false}}for(var nid of boardArea.nodes){var point=drawTool.ZEUtil.getShapesByEid(nid)[0];var xy=[];if(point){xy=iD.picUtil.shapeXY(point);mAdds.push({node:context.entity(nid),xy:xy})}}for(var item of mAdds){var xy=drawTool.reductionPoint(item.xy);actions.push(iD.picUtil.measureinfoAction(item.node,{trackPointId:player.pic_point.tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]}}))}for(var node of mRemoves){actions.push(iD.picUtil.measureinfoAction(node,{type:-1}))}}actions.push("\u66F4\u6539\u5730\u9762\u533A\u57DF");updateEntityids=_.uniq([boardArea.id].concat(boardArea.nodes));isReplaceUpdate=true;allActions.push(actions);function _nodesIndex(index,diff){var diffend=index+diff;if(0<=diffend){return diffend%4}else{return 4+index+diff}}}allActions.length&&drawTool._drawActionsPerform(allActions,isReplaceUpdate);drawTool.resetPointToPicPlayer(updateEntityids)}function createMapEntityByGeometry(data){var createdEntities=[],actions=[],returnParam={};var pgModelEntity=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.OBJECT_PG);var nodeModelEntity=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.OBJECT_PG_NODE);if(!pgModelEntity||!nodeModelEntity){return}var lonlatList=iD.picUtil.createRectangleByGeo(data.geoList||[]);var nodeidList=[];var ntags={TYPE:3,SUBTYPE:1};var boardArea=iD.Way({layerId:pgModelEntity.id,modelName:iD.data.DataType.OBJECT_PG,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.OBJECT_PG,pgModelEntity),ntags),nodes:[]});actions.push(iD.actions.AddEntity(boardArea));for(var i=0;i<lonlatList.length;i++){var lonlat=lonlatList[i];var node=iD.Node({modelName:iD.data.DataType.OBJECT_PG_NODE,layerId:nodeModelEntity.id,tags:iD.util.getDefauteTags(iD.data.DataType.OBJECT_PG_NODE,nodeModelEntity),loc:[lonlat.lng,lonlat.lat,lonlat.elevation]});actions.push(iD.actions.AddEntity(node));actions.push(iD.actions.AddVertex(boardArea.id,node.id));nodeidList.push(node.id)}actions.push(iD.actions.AddVertex(boardArea.id,nodeidList[0]));actions.push("\u7ED8\u5236\u5730\u9762\u533A\u57DF");createdEntities.push(boardArea.id);createdEntities.push(...nodeidList);returnParam.id=boardArea.id;return _.extend(returnParam,{createdEntities:createdEntities,actions:actions})}function _getTrackPointsAngle(loc1,loc2){var defAngle=player.pic_point.tags.azimuth;var selectIndex=player.selectPicIndex;if(!player.allNodes[selectIndex+1]){return defAngle}var xdiff=player.allNodes[selectIndex+1].loc[0]-player.allNodes[selectIndex].loc[0];var K=iD.AutoMatch.getParamK(player);var crossTrackGeo=iD.util.clickPosForTrackPoint2(player.pic_point,loc1,player.getCameraHeight(),K);var moveTrackGeo=iD.util.clickPosForTrackPoint2(player.pic_point,loc2,player.getCameraHeight(),K);var newAngle=defAngle;if(!_.isEqual(crossTrackGeo,moveTrackGeo)){var geo1=crossTrackGeo,geo2=moveTrackGeo,tempGeo;if(geo1[0]>geo2[0]){tempGeo=geo1;geo1=geo2;geo2=tempGeo}newAngle=iD.util.LineCalCulate().getAngle(geo1[0],geo1[1],geo2[0],geo2[1])}return newAngle}function _getRotatePolygonGeoList(nodeLocs,newAngle){var projection=context.projection;var points=nodeLocs.map(function(loc){return projection(loc)});var pivot=zrenderNodeStatus.areaPivot||d3.geom.polygon(points).centroid();var geoList=[],graph=context.graph(),angle=null!=newAngle?newAngle:player.pic_point.tags.azimuth;angle=angle*Math.PI/180;nodeLocs.forEach(function(loc){var point=projection(loc),radial=[0,0];radial[0]=point[0]-pivot[0];radial[1]=point[1]-pivot[1];point=[radial[0]*Math.cos(angle)-radial[1]*Math.sin(angle)+pivot[0],radial[0]*Math.sin(angle)+radial[1]*Math.cos(angle)+pivot[1]];var newLoc=projection.invert(point);newLoc[2]=loc[2]||-1;geoList.push(newLoc)});return geoList}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addLamppostLampHolder=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.TELEGRAPH_LAMP_HOLDER},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u706F\u5934").call(bootstrap.tooltip().placement("top").html(false).title(function(d){return"\u5148\u9009\u4E2D\u4E00\u4E2A\u6746\u9876\u70B9\uFF0C\u518D\u70B9\u51FB\u5BF9\u5E94\u706F\u5934\u4F4D\u7F6E"})).data([this.getId()])},reset:function(){},domClick:function(evt,clickOffset,opts){var self=this;var result=iD.picUtil.getLampHolderLonlat(clickOffset);if(!result.loc){return false}drawGeometry2Map2AutoMatch(result.loc,{tags:{PLANE:result.PLANE},clickOffset:clickOffset});return false}});function drawGeometry2Map2AutoMatch(data,dataOpts){dataOpts.tags.TYPE=2;dataOpts.location=data;var result=iD.svg.PicDrawUtil.drawPoint2Map(null,dataOpts,{player:player,context:context,actionText:"\u6DFB\u52A0\u706F\u5934",modelName:iD.data.DataType.LAMPPOST,measureType:2});if(!result)return false;var actions=result.actions;var createIds=result.createIds;if(actions.length){drawTool._drawActionsPerform([actions],false);drawTool.resetPointToPicPlayer(createIds);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addLamppost=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.TELEGRAPH_POLE},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u706F\u6746").data([this.getId()])},reset:function(){},domClickMore:function(evt,clickOffset,data,point,point2,isMultPoints){point=point[0];data=data[0];var result=drawTool.drawGeometryPoint(point);drawGeometry2Map(result,data);iD.picUtil.updateZrenderStyleByEntity(result,result._entityid);drawTool._zrender.add(result);player.clearFooterButton();return false}});function drawGeometry2Map(result,data){data.tags={TYPE:1};var result=iD.svg.PicDrawUtil.drawPoint2Map(result,data,{player:player,context:context,actionText:"\u6DFB\u52A0\u706F\u6746",modelName:iD.data.DataType.LAMPPOST,measureType:1});if(!result)return false;var actions=result.actions;var createIds=result.createIds;if(actions.length){drawTool._drawActionsPerform([actions],false);createIds.length&&drawTool._lightMapEntities(createIds);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addObjectPG=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={},zrenderNodeStatus;var boardArea;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1,arg2){drawStatus=arg1;zrenderNodeStatus=arg2},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_OBJECT_PG},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u4EBA\u884C\u6A2A\u9053").data([this.getId()])},reset:function(){boardArea=undefined},domClick:function(evt,clickOffset,opts){var self=this;var presult=drawTool.zrenderDrawPolygon(clickOffset,false);self.clickAddPolygon(presult,clickOffset,false);return false},domDblclick:function(evt,clickOffset){var self=this;var shape=drawTool.zrenderDrawPolygon(clickOffset,true);var isok=self.clickAddPolygon(shape,clickOffset,true);isok&&player.clearFooterButton();self.reset();return false},clickAddPolygon:function(shape,clickOffset,isDbclick=false){var self=this;var geometry=iD.picUtil.pixelToLngLat(clickOffset);var marker=drawTool.drawGeometryNodes(shape,{canvasOffset:clickOffset},{draggable:true});drawGeometry2Map(shape,{geometry,clickOffset});iD.picUtil.updateZrenderStyleByEntity(marker,marker._entityid);var flag=iD.svg.PicDrawUtil.clickAddPolygonAfter(shape,drawStatus,isDbclick,{isContinue:true,player:player,marker:marker});return flag}});function drawGeometry2Map(drawMark,geoData){var result=iD.svg.PicDrawUtil.drawPolygon2Map(drawMark,geoData,{player:player,context:context,actionText:"\u7ED8\u5236\u4EBA\u884C\u6A2A\u9053",nodeModelName:iD.data.DataType.OBJECT_PG_NODE,wayModelName:iD.data.DataType.OBJECT_PG,boardArea:boardArea,wayTags:{TYPE:3,SUBTYPE:7}});if(!result)return false;var isReplaceUpdate=result.isReplaceUpdate;var actions=result.actions;boardArea=result.boardArea;if(actions.length){drawTool._drawActionsPerform([actions],isReplaceUpdate);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addObjectPL=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};var trackPointChanged=false;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1;var self=this;player.on("picUpdate.add-object-pl",function(){if(!self.check())return;trackPointChanged=true})},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_OBJECT_PL},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u6DFB\u52A0\u8F85\u52A9\u7EBF").data([this.getId()])},reset:function(){drawStatus.__lastDrawIndex=undefined;trackPointChanged=false},domClick:function(evt,clickOffset,opts={}){var self=this;var presult=drawStatus.shape;var downInfo=drawTool.drawClickBreakNode(drawStatus.type,presult&&[presult._entityid]);if(downInfo){var downShape=downInfo.shape;if(downShape){var shapeXY=iD.picUtil.shapeXY(downShape);clickOffset=shapeXY&&shapeXY||clickOffset}var isEnd=false;if(!presult){isEnd=false}else if(!presult._entityid||!presult._nodeList||!presult._nodeList.length){isEnd=false}else{isEnd=true}presult=drawTool.zrenderDrawpolyline(clickOffset,isEnd);iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);self.clickAddDivider(presult,clickOffset,isEnd,{downNodeid:downInfo.entityid})}else{presult=drawTool.zrenderDrawpolyline(clickOffset,false);iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);self.clickAddDivider(presult,clickOffset,false)}drawTool.clearZRenderNodeStatus();return false},domDblclick:function(evt,clickOffset,opts={}){var self=this;var presult=drawStatus.shape;if(!presult){self.reset();return false}if(presult._entityid){var geometry=iD.picUtil.pixelToLngLat(clickOffset);var shape=drawStatus.shape;var way=context.hasEntity(shape._entityid);if(way&&drawTool.checkLineNodeDistanceLTE(context.entity(_.last(way.nodes)).loc,[geometry.lng,geometry.lat])){return}}var downInfo=drawTool.drawClickBreakNode(drawStatus.type,presult&&[presult._entityid]);var downShape=downInfo&&downInfo.shape;if(downShape){var shapeXY=iD.picUtil.shapeXY(downShape);clickOffset=shapeXY&&shapeXY||clickOffset}presult=drawTool.zrenderDrawpolyline(clickOffset,true);iD.picUtil.updateZrenderStyleByEntity(presult,presult._entityid);self.clickAddDivider(presult,clickOffset,true,downInfo&&{downNodeid:downInfo.entityid});drawTool.clearZRenderNodeStatus();drawStatus.shape=null;self.reset();return false},clickAddDivider:function(shape,clickOffset,isDbclick=false,opts={}){var geometry=iD.picUtil.pixelToLngLat(clickOffset);var xy=drawTool.reductionPoint(clickOffset);geometry.xy=xy;if(shape._entityid&&context.hasEntity(shape._entityid)){var way=context.entity(shape._entityid);var lastid=_.last(way.nodes);var node=context.entity(lastid);if(drawTool.checkLineNodeDistanceLTE(node.loc,[geometry.lng,geometry.lat])){shape.shape.points.length>(shape._nodeList||[]).length&&shape.shape.points.pop();return}}var marker=drawTool.drawGeometryNodes(shape,{canvasOffset:clickOffset},{draggable:true});drawGeometry2Map(shape,{geometry},opts);iD.picUtil.updateZrenderStyleByEntity(marker,marker._entityid);var flag=iD.svg.PicDrawUtil.clickAddLineAfter(shape,drawStatus,isDbclick,{isContinue:true,player:player,redraw:trackPointChanged&&2==shape._nodeList.length});trackPointChanged=false;return flag}});function drawGeometry2Map(drawMark,geoData,opts){var result=iD.svg.PicDrawUtil.drawLine2Map(drawMark,geoData,{player:player,context:context,actionText:"\u7ED8\u5236\u8F85\u52A9\u7EBF",downNodeid:opts.downNodeid,isCommonPoint:true,nodeModelName:iD.data.DataType.OBJECT_PL_NODE,lineModelName:iD.data.DataType.OBJECT_PL});if(!result)return false;var isReplaceUpdate=result.isReplaceUpdate;var actions=result.actions;if(actions.length){drawTool._drawActionsPerform([actions],isReplaceUpdate);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addRoadAttribute=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={},zrenderNodeStatus;function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1,arg2){drawStatus=arg1;zrenderNodeStatus=arg2},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_ROAD_ATTRIBUTE},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9").data([this.getId()])},reset:function(){},domClick:function(evt,clickOffset,opts){var self=this;var downEntity,downShape;if(zrenderNodeStatus.downEntityid){downEntity=context.hasEntity(zrenderNodeStatus.downEntityid);downShape=zrenderNodeStatus.downShape}var geometry={};if(downEntity&&downEntity.modelName==iD.data.DataType.DIVIDER_NODE){var downxy=iD.picUtil.shapeXY(downShape);clickOffset=[downxy[0],downxy[1]];geometry.lng=downEntity.loc[0];geometry.lat=downEntity.loc[1];geometry.elevation=downEntity.loc[2]}if(_.isEmpty(geometry)){geometry=iD.picUtil.pixelToLngLat(clickOffset)}geometry.xy=drawTool.reductionPoint(clickOffset);var result=drawTool.drawGeometryPoint({canvasOffset:clickOffset});drawGeometry2Map(result,{geometry,clickOffset});iD.picUtil.updateZrenderStyleByEntity(result,result._entityid);drawTool._zrender.add(result);drawTool.clearZRenderNodeStatus();player.clearFooterButton();return false}});function drawGeometry2Map(result,data){var result=iD.svg.PicDrawUtil.drawPoint2Map(result,data,{player:player,context:context,actionText:"\u6DFB\u52A0\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9",modelName:iD.data.DataType.ROAD_ATTRIBUTE,measureType:0});if(!result)return false;var actions=result.actions;var createIds=result.createIds;if(actions.length){drawTool._drawActionsPerform([actions],false);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.addTrafficlight=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},check:function(){if(!drawStatus)return false;return drawStatus.type==this.getId()},getId:function(){return constant.ADD_TRAFFICLIGHT},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u4EA4\u901A\u706F").call(bootstrap.tooltip().placement("top").html(false).title(function(d){return"\u5148\u9009\u4E2D\u4E00\u4E2A\u6746\u9876\u70B9\uFF0C\u518D\u70B9\u51FB\u5BF9\u5E94\u4EA4\u901A\u706F\u4F4D\u7F6E"})).data([this.getId()])},reset:function(){},domClick:function(evt,clickOffset,opts){var self=this;var result=iD.picUtil.getLampHolderLonlat(clickOffset);if(!result.loc){return false}drawGeometry2Map2AutoMatch(result.loc,{tags:{PLANE:result.PLANE},clickOffset:clickOffset});return false}});function drawGeometry2Map2AutoMatch(data,dataOpts){dataOpts.location=data;var result=iD.svg.PicDrawUtil.drawPoint2Map(null,dataOpts,{player:player,context:context,actionText:"\u6DFB\u52A0\u4EA4\u901A\u706F",modelName:iD.data.DataType.TRAFFICLIGHT,measureType:2});if(!result)return false;var actions=result.actions;var createIds=result.createIds;if(actions.length){drawTool._drawActionsPerform([actions],false);drawTool.resetPointToPicPlayer(createIds);return true}return false}return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.defaultButtonList=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var playerFooter=player.getPlayerFooter();var drawStatus={};const picParams=[{value:0,name:"\u539F\u59CB"},{value:1,name:"\u8F66\u9053\u7EBF"},{value:3,name:"\u8DEF\u9762\u8981\u7D20"},{value:4,name:"\u8DEF\u724C"},{value:5,name:"\u6746\u72B6\u7269\u3001\u8DEF\u724C"},{value:6,name:"\u8F66\u9053\u7EBF\u3001\u6746\u72B6\u7269\u3001\u8DEF\u724C"}];function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},getId:function(){return"default"},renderBtn:function(selection){var exceptClearClass="except_action";var epilineClass="epliline_tool_btn";var uselessClass="footer_useless_btn";var seElement=selection.append("select").attr("class",epilineClass).attr("style","height: 100%;width: 98px;padding: 0 8px;font-size: 14px;margin-right: 6px;background: #FFFFFF;").on("change",function(e){this.blur&&this.blur();var e=d3.event;playerFooter.event.imagetype_change(e,this)});var options=seElement.selectAll("option").data(picParams);options.enter().append("option").text(function(d,i){return d.name}).value(function(d,i){return d.value});seElement.value(player.getPicUrlParam().type);selection.append("select").attr("id","_sublist").attr("style","height: 100%;width: 98px;padding: 0 8px;font-size: 14px;margin-right: 6px;background: #FFFFFF;display: none;").on("change",function(e){this.blur&&this.blur();var e=d3.event;playerFooter.event.imagebatch_change(e,this)});selection.append("button").attr("id","_newest_batch").attr("class",exceptClearClass+" "+epilineClass+" "+uselessClass).attr("type","button").text("\u6700\u65B0\u6279\u6B21");selection.append("select").attr("class","pic-current-trackid ").attr("style","height: 100%;padding: 0 8px;font-size: 14px;margin-right: 6px;background: #FFFFFF;").on("change",function(e){this.blur&&this.blur();var e=d3.event;playerFooter.event.track_change(e,this)});selection.append("button").attr("class",uselessClass).attr("type","button").text("\u865A\u7EBF\u6A21\u5F0F");selection.append("button").attr("class",epilineClass+" "+uselessClass).attr("type","button").text("\u6E05\u9664");selection.append("button").attr("class",uselessClass).attr("type","button").text("\u4E09\u7EF4");selection.append("button").attr("class",uselessClass).attr("type","button").text("\u70B9\u4E91");if(iD.User.authQueryTag()){selection.append("button").attr("class",uselessClass).attr("type","button").text("\u6807\u8BB0");selection.append("button").attr("class",uselessClass).attr("type","button").text("\u6807\u8BB0\u8F68\u8FF9\u70B9").on("click.pic-player",player.markTrackPointRequest)}}});return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.btnIntersection=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},getId:function(){return constant.INTERSECTION},renderBtn:function(selection){var uselessClass="footer_useless_btn";selection.append("button").attr("class",uselessClass).attr("type","button").text("\u524D\u65B9\u4EA4\u4F1A").data([this.getId()])}});return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.btnBatchBreakDref=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},getId:function(){return constant.BATCH_BREAK_DREF},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u6253\u65AD\u8F66\u9053\u7EC4").data([this.getId()])}});return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.btnPolylineAddNode=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},getId:function(){return constant.POLYLINE_ADD_NODE},renderBtn:function(selection){selection.append("button").attr("type","button").text("\u6DFB\u52A0\u8282\u70B9").data([this.getId()])}});return new drawPlus};;iD.svg.PicDraw=iD.svg.PicDraw||{};iD.svg.PicDraw.btnToolEpilineCross=function(context,drawTool){const constant=drawTool.getConstant();var player=drawTool.getPlayer();var drawStatus={};function drawPlus(){}_.assign(drawPlus.prototype,{init:function(arg1){drawStatus=arg1},getId:function(){return constant.TOOL_EPLILINE_CROSS},renderBtn:function(selection){var epilineClass="epliline_tool_btn";if(player.getEpilineTool()){selection.append("button").attr("class",epilineClass).attr("type","button").style("display","none").text("\u6838\u7EBF\u5341\u5B57\u6807\u8BB0").data([constant.TOOL_EPLILINE_CROSS])}}});return new drawPlus};;iD.svg.PlayerFooter=function(context,_opts){const constant=_opts.constant;const markDrawStatus=_opts.markDrawStatus;const zrenderNodeStatus=_opts.zrenderNodeStatus;const picUrlParam=_opts.picUrlParam;const epilineTool=_opts.epilineTool;const drawLineTypeArr=["\u865A\u7EBF\u6A21\u5F0F","\u666E\u901A\u6A21\u5F0F"];const nonBrowseMode=["\u4EA4\u901A\u706F","\u706F\u5934","\u6253\u65AD\u8F66\u9053\u7EC4","\u8D28\u68C0\u6807\u8BB0\u70B9","\u56FE\u50CF\u6807\u8BB0\u70B9","\u5206\u6790\u6807\u8BB0\u70B9"];const CONSTANT_DATATYPE={[constant.ADD_DIVIDER]:[iD.data.DataType.DIVIDER,iD.data.DataType.DIVIDER_NODE],[constant.ADD_OBJECT_PL]:[iD.data.DataType.OBJECT_PL,iD.data.DataType.OBJECT_PL_NODE],[constant.ADD_OBJECT_PG]:[iD.data.DataType.OBJECT_PG,iD.data.DataType.OBJECT_PG_NODE],[constant.POLYLINE_ADD_NODE]:[iD.data.DataType.DIVIDER,iD.data.DataType.DIVIDER_NODE,iD.data.DataType.OBJECT_PL,iD.data.DataType.OBJECT_PL_NODE,iD.data.DataType.OBJECT_PG,iD.data.DataType.OBJECT_PG_NODE],[constant.TELEGRAPH_POLE]:[iD.data.DataType.LAMPPOST],[constant.TELEGRAPH_LAMP_HOLDER]:[iD.data.DataType.LAMPPOST],[constant.ADD_BOARD]:[iD.data.DataType.TRAFFICSIGN,iD.data.DataType.TRAFFICSIGN_NODE],[constant.ADD_BOARD_POLYGON]:[iD.data.DataType.TRAFFICSIGN,iD.data.DataType.TRAFFICSIGN_NODE],[constant.ADD_GROUND_AREA]:[iD.data.DataType.OBJECT_PG,iD.data.DataType.OBJECT_PG_NODE],[constant.BATCH_BREAK_DREF]:[iD.data.DataType.DIVIDER,iD.data.DataType.DIVIDER_NODE,iD.data.DataType.R_DIVIDER_DREF],[constant.BRIDGE_BOTTOM_LINE]:[iD.data.DataType.BRIDGE,iD.data.DataType.BRIDGE_NODE],[constant.ADD_TRAFFICLIGHT]:[iD.data.DataType.TRAFFICLIGHT],[constant.ADD_CHECK_TAG_POINT]:[iD.data.DataType.CHECK_TAG],[constant.ADD_IMAGE_TAG_POINT]:[iD.data.DataType.IMAGE_TAG],[constant.ADD_ANALYSIS_TAG_POINT]:[iD.data.DataType.ANALYSIS_TAG],[constant.ADD_CONTROL_POINT]:[iD.data.DataType.OBJECT_PT],[constant.ADD_ROAD_ATTRIBUTE]:[iD.data.DataType.ROAD_ATTRIBUTE],[constant.ADD_DIVIDER_POLYGON]:[iD.data.DataType.DIVIDER,iD.data.DataType.OBJECT_PG,iD.data.DataType.OBJECT_PG_NODE]};const delFlag={1:"\u8F68\u8FF9\u5B58\u5728\u9519\u8BEF!",2:"\u56FE\u7247\u5B58\u5728\u9519\u8BEF!",3:"\u8F68\u8FF9\u4E0E\u56FE\u7247\u5B58\u5728\u9519\u8BEF!"};var dispatch=d3.dispatch("progress_change","progress_mousedown","playcontrol_next","playcontrol_prev","playcontrol_play","playcontrol_pause","playcontrol_speedchange","keydown","button_click","imagetype_change","imagebatch_change","track_change");var select_speed=1;var player,drawTool;function PlayerFooter(){this.$dom;this.$status;this.$buttonList}_.assign(PlayerFooter.prototype,{init:function(arg1,arg2){player=arg1;drawTool=arg2;select_speed=player.time},render:function($root,$statusBar){var self=this;this.$dom=$root;this.$status=$statusBar;this.renderMark();this.renderPlayProgress();var $control=this.$dom.append("div").classed("footer-controller",true);this.renderPlayControl($control);this.renderButtonList($control)},renderMark:function(){var self=this;var footer=this.$dom;var markDelete=footer.append("div").attr("class","markDelete");var markDeleteModel=`
				<div class="div1header">
		            <button type="button" class="close" data-dismiss="modal" aria-label="Close" >
		              	<span aria-hidden="true">&times;</span>
		            </button>
					<h4>错误标记</h4>
				</div>
				<div class="div1body">
					<p><input type="radio" id="contrail" name="false" value="1" /><label for="contrail">轨迹存在错误。</label></p>
					<p><input type="radio" id="image" name="false" checked="checked" value="2" /><label for="image">图片存在错误。</label></p>
					<p><input type="radio" id="all" name="false" value="3" /><label for="all">图片与轨迹存在错误。</label></p>
				</div>
				<div class="div1footer">
					<button type="button" class="btn btn-info confirm" >确认</button>
					<button type="button" class="btn btn-info cancel" >取消</button>
				</div>
			`;markDelete.html(markDeleteModel);var $markDelete=$(markDelete.node());$markDelete.find(".div1header .close").on("click",function(){$markDelete.hide()});$markDelete.find(".div1footer button.cancel").on("click",function(){$markDelete.hide()});$markDelete.find(".div1footer button.confirm").on("click",function(){var valueDelete=$(".markDelete .div1body input:radio:checked").val();$.ajax({url:iD.config.URL.krs+"track/mark?trackPointId="+trackPointId1+"&delFlag="+valueDelete,type:"get",async:false,dataType:"json",success:function(data){$(markFalse.node()).show().text(delFlag[valueDelete]);for(var i=0;i<player.allNodes.length;i++){if(trackPointId1==player.allNodes[i].tags.trackPointId){player.allNodes[i].tags.delFlag=valueDelete}}}});$markDelete.hide()})},renderPlayProgress:function(){var self=this;var footer=this.$dom;var totalCount=player.allNodes&&player.allNodes.length||player.picCount;var progressBar=footer.append("div").attr("class","footer-progress-bar");var progressRangeDiv=progressBar.append("div").attr("class","footer-progress-range-div");var progressRange=progressRangeDiv.append("input").attr("type","range").attr("class","footer-progress-range").attr("value",0).attr("min",0).attr("max",totalCount-1).attr("step",1);var progressNumberDiv=progressBar.append("div").attr("class","footer-progress-number-div");var progressNumber=progressNumberDiv.append("input").attr("type","number").attr("class","footer-progress-number no-number").attr("value",1).attr("min",1).attr("max",totalCount).attr("step",1).attr("title",1);var progressRangeTip=progressRangeDiv.append("span").attr("class","footer-progress-range-tip");progressNumber.on("keydown.pic-progress",function(){var evt=d3.event;if(_.include([38,40],evt.keyCode)){evt.stopImmediatePropagation();evt.preventDefault();return false}}).on("keyup.pic-progress",function(){var evt=d3.event;if(13!=evt.keyCode){return false}if(""!=this.value&&!isNaN(this.value)&&this.value!=this.__triggerValue){progressRange.value(parseInt(this.value)-1).trigger("change");this.__triggerValue=this.value}return false}).on("change.pic-progress",function(){if(""!=this.value&&!isNaN(this.value)){progressRange.value(parseInt(this.value)-1).trigger("change");this.__triggerValue=this.value}return false});progressBar.append("span").attr("class","footer-progress-total").text("/"+totalCount+"\u5E27");var newNumberW=8*totalCount.toString().length+8+5;progressNumberDiv.style("width",newNumberW+"px");progressBar.on("picPlayerEvt",function(data,idx,group){var event=d3.event;var playerData=event.detail[0].playerData;progressRange.node().value=playerData.current;let per=playerData.current/parseFloat(progressRange.attr("max"));let indx=playerData.current+1;progressRange.style("background-image","-webkit-gradient(linear, 0 0, 100% 0, from(#4a7fec), color-stop("+Math.max(per-0.001,0)+", #4a7fec), color-stop("+Math.max(per-0.0009,0)+", #ffffff), to(#ffffff))");progressNumber.value(indx);progressNumber.attr("title",indx)});progressRange.on("mousedown",function(data,idx,group){var event=d3.event;dispatch.progress_mousedown(event);self.udpatePlayControl(false);var per=parseFloat(+progressRange.node().value)/parseFloat(progressRange.attr("max"));progressRangeTip.text(+progressRange.node().value+1+"\u5E27").style("left",100*per+"%").style("display","inline-block")});progressRange.on("mouseup",function(data,idx,group){var event=d3.event;progressRangeTip.style("display","none")});progressRange.on("input",function(data,idx,group){var event=d3.event;var per=parseFloat(this.value)/parseFloat(this.getAttribute("max"));progressRange.attr("style","background-image: -webkit-gradient(linear, 0 0, 100% 0, from(#4a7fec), color-stop("+Math.max(per-0.001,0)+", #4a7fec), color-stop("+Math.max(per-0.0009,0)+", #ffffff), to(#ffffff))");progressRangeTip.text(+progressRange.node().value+1+"\u5E27").style("left",100*per+"%")});progressRange.on("keydown",function(){d3.event.preventDefault();d3.event.stopPropagation();this.blur&&this.blur();return false});progressRange.on("change",function(data,idx,group){dispatch.progress_change(d3.event,{value:parseInt(this.value),oldValue:parseInt($.trim(progressNumber.value()))})})},renderPlayControl:function(footer){var self=this;var $playBtn;var playSpeed=[1,2,4,8];var seElement=footer.append("div").classed("playSpeed",true).append("select").on("change",function(){this.blur&&this.blur();select_speed=+this.value||1;d3.select(".compress_original").classed("active",false);dispatch.playcontrol_speedchange(select_speed)});var options=seElement.selectAll("option").data(playSpeed);options.enter().append("option").text(function(d,i){return d+"x"}).value(function(d,i){return d});options.filter(function(d,i){return d==player.time||0==i}).attr("selected","selected");var playerSpan=footer.append("div").attr("class","play-controller");playerSpan.append("a").attr({class:"glyphicon glyphicon-backward playericon",title:"\u4E0A\u4E00\u5E27"}).style("display","inline-block").on("click",function(){dispatch.playcontrol_prev();d3.select(".compress_original").classed("active",false)});$playBtn=playerSpan.append("a").attr({class:"glyphicon playcontrol-play glyphicon-triangle-right playericon",title:"\u64AD\u653E"}).style("display","inline-block").on("click",function(){if("\u64AD\u653E"===$playBtn.attr("title")){select_speed=select_speed||1;dispatch.playcontrol_play(select_speed);self.udpatePlayControl(true)}else{dispatch.playcontrol_pause();self.udpatePlayControl(false)}});playerSpan.append("a").attr({class:"glyphicon glyphicon-forward playericon",title:"\u4E0B\u4E00\u5E27"}).style("display","inline-block").on("click",function(){dispatch.playcontrol_next();d3.select(".compress_original").classed("active",false)})},udpatePlayControl:function(isPlay){var self=this;var $playBtn=self.$dom.select("a.glyphicon.playcontrol-play");$playBtn.classed({"glyphicon-triangle-right":false,"glyphicon-pause":false});if(isPlay){$playBtn.classed("glyphicon-pause",true);$playBtn.attr("title","\u6682\u505C")}else{$playBtn.classed("glyphicon-triangle-right",true);$playBtn.attr("title","\u64AD\u653E")}},renderButtonList:function(footer){var self=this;var markSpan=footer.append("div").attr("class","btn-group").attr("role","group").attr("data-toggle","buttons").on("click",function(e){e=e||d3.event;var btnText=e.target.textContent;if(e.target.childNodes&&e.target.childNodes.length){btnText=e.target.childNodes[0].textContent}dispatch.button_click(e||d3.event,btnText);if(drawLineTypeArr.includes(btnText)){var index=drawLineTypeArr.lastIndexOf(btnText)+1;d3.select(e.target).text(drawLineTypeArr[index%2]);drawTool.setSolidLineRender(!!(index%2))}if(!_.include(["browse","select"],context.mode().id)){context.enter(iD.modes.Browse(context))}else if(!nonBrowseMode.includes(btnText)&&"select"==context.mode().id){context.enter(iD.modes.Browse(context))}});self.$buttonList=markSpan;self.refreshFooterBtnDisplay();self.appplyNewKeybinding(surface)},refreshFooterBtnDisplay:function(nowLay){var self=this;var $buttonList=self.$buttonList;var drawPlugins=drawTool.getDrawPlugins();var pluginMap={};_.each(drawPlugins,function(d){if(!d.getId)return;pluginMap[d.getId()]=d});var elementLayers=_.values(iD.Static.layersInfo.getElements())||[];$buttonList.html("");var defaultKey="default";var allPicDatas=[],editDatas=[],uneditDatas=[],deleteDatas=[],afterDefaults=[];var uneditModelDatas=[],deleteModelDatas=[];elementLayers.forEach(function(layer){if(layer&&layer.picdatas&&layer.picdatas.length){let datas=layer.picdatas;allPicDatas.push(...datas);let dindex=datas.indexOf(defaultKey);if(-1<dindex){afterDefaults.push(...datas.slice(dindex+1))}var dlayer=iD.Layers.getLayerById(layer.layerId);var modelStatus=dlayer&&dlayer.models&&dlayer.models.datas;if(modelStatus&&null!=layer.editable){datas.forEach(function(pname){let models=CONSTANT_DATATYPE[pname];if(!models||!models.length)return;if(pname==constant.POLYLINE_ADD_NODE){let b=true;for(let mname of models){if(iD.Layers.getLayerModelEditable(dlayer,mname)){b=false;break}}if(b)uneditModelDatas.push(pname)}else{let mdelete=false,munedit=false;for(let mname of models){let status=modelStatus[mname];if(!status){mdelete=true;deleteModelDatas.push(pname);break}if(null!=status.editable&&!status.editable){munedit=true}else if(null==status.editable){mdelete=true}}if(mdelete){deleteModelDatas.push(pname)}else if(munedit){uneditModelDatas.push(pname)}}})}if(layer.display&&layer.editable){editDatas.push(...datas)}else if(false===layer.editable){uneditDatas.push(...datas)}else if(layer.editable===undefined||null===layer.editable){deleteDatas.push(...datas)}else if(false===layer.display){uneditDatas.push(...datas)}}});var tempDatas=[],dcount=0,tcount=0;_.each(allPicDatas,function(v){if(v==defaultKey)dcount++});_.each(allPicDatas,function(v){if(v==defaultKey&&tcount<dcount-1){tcount++;return}tempDatas.push(v)});if(afterDefaults.length){allPicDatas=_.difference(tempDatas,afterDefaults).concat(afterDefaults)}else{allPicDatas=tempDatas}allPicDatas=_.uniq(allPicDatas);editDatas=_.uniq(editDatas);editDatas=_.difference(editDatas,uneditModelDatas,deleteModelDatas);uneditDatas=_.uniq(uneditDatas.concat(uneditModelDatas));uneditDatas=_.difference(uneditDatas,editDatas,deleteModelDatas);deleteDatas=_.difference(_.uniq(deleteDatas.concat(deleteModelDatas)),editDatas,uneditDatas);var keepDatas=[constant.INTERSECTION];if(7==window._systemType){keepDatas.push(constant.TOOL_EPLILINE_CROSS)}if(allPicDatas.length){_.each(allPicDatas,function(btnType){var d=pluginMap[btnType];if(!d)return;d.renderBtn($buttonList)});$buttonList.selectAll("button").each(function(btnType){if(_.include(keepDatas,btnType)){this.disabled=false;return}if(_.include(deleteDatas,btnType)){d3.select(this).remove();return}if(_.include(uneditDatas,btnType)){this.disabled=true}})}else{var d=pluginMap[defaultKey];d&&d.renderBtn($buttonList)}if(pluginMap[defaultKey]){player.updateBatch()}var uselessClass="footer_useless_btn";if(!player.developShow){$buttonList.selectAll("button,select").each(function(){var $this=d3.select(this);if($this.classed(uselessClass)){$this.classed("hidden",true)}})}},refreshFooterBtnDisplayBAKUP:function(lay){var self=this;var modelNames=[],layerStatus={};var dataLayers=iD.Layers.getLayers()||[];if(lay){var dataLay,editLays=[],uneditLays=[];for(var dlay of dataLayers){if(true==dlay.display&&true==dlay.editable){editLays.push(dlay)}else if(dlay.editable!=undefined){uneditLays.push(dlay)}if(-1<lay.children.indexOf(dlay.id)){dataLay=dlay}}var flag=lay.editable!=undefined;if(dataLay){modelNames=dataLay.models.datas||[];flag=flag&&dataLay.editable!=undefined}if(flag){for(let name in modelNames){layerStatus[name]=lay&&lay.display&&lay.editable&&dataLay.hasModelEntity(name)||false}}uneditLays.forEach(function(layer){if(dataLay&&layer.id==dataLay.id)return;for(let name in layer.models.datas){layerStatus[name]=layer.editable&&layer.hasModelEntity(name)}});editLays.forEach(function(layer){if(dataLay&&layer.id==dataLay.id)return;for(let name in layer.models.datas){layerStatus[name]=layer.editable&&layer.hasModelEntity(name)}})}else{dataLayers.forEach(function(layer){if(layer.editable==undefined)return;for(let name in layer.models.datas){layerStatus[name]=layer.display&&layer.editable&&layer.hasModelEntity(name)||false}})}var $allBtns=self.$dom.selectAll("div.btn-group > button");var allBtnMap={};$allBtns.each(function(type){if(!type){return}allBtnMap[type]=this});for(var constName in CONSTANT_DATATYPE){var constModes=CONSTANT_DATATYPE[constName]||[];var btnEditable=true,btnDelete=false;if(constName==constant.POLYLINE_ADD_NODE){var statusArr=_.map(constModes,function(mname){if(null==layerStatus[mname]){return null}if(layerStatus[mname]){return 2}if(!layerStatus[mname]){return 1}});if(0==_.compact(statusArr).length){btnDelete=true}else if(!_.include(statusArr,2)){btnEditable=false}}else if(constName==constant.ADD_DIVIDER_POLYGON){btnDelete=true;btnEditable=true;for(var mname of constModes){if(layerStatus[mname]!=undefined){btnDelete=false}if(false==layerStatus[mname]){btnEditable=false}}}else{for(var mname of constModes){if(null==layerStatus[mname]){btnDelete=true;break}if(!layerStatus[mname]){btnEditable=false;continue}}}var $btn=d3.select(allBtnMap[constName]);if(btnDelete){$btn.size()&&$btn.remove();continue}if(!allBtnMap[constName]){continue}$btn.node().disabled=!btnEditable}},appplyNewKeybinding:function(surface){var self=this;function switchKey(key){key=key.toLowerCase();var data={returnValue:null};dispatch.keydown(key,data);return data.returnValue}d3.select(document).on("keydown.picplayer",()=>{var event=d3.event||window.event;if("INPUT"===event.target.tagName){return}var key=event.key;var ctrl=event.ctrlKey?"ctrl+":"";var shift=event.shiftKey?"shift+":"";var alt=event.altKey?"alt+":"";var meta=event.metaKey?"meta+":"";key=ctrl+shift+alt+meta+key;if(switchKey(key)){d3.event.preventDefault();d3.event.stopPropagation()}})},updateTitle:function(node){var self=this;node=node||player.allNodes[player.selectPicIndex];var data=[node];var tableTempl=(result,isHidden)=>`
            <table id="picplayer-status-table" class="${isHidden?"hidden-visibility":""} ">
                <thead>
	                <tr>
		                <th>roll</th>
		                <th>pitch</th>
		                <th>azimuth</th>
		                <th>B</th>
		                <th>L</th>
		                <th>H</th>
		                <th>UTM-X</th>
		                <th>UTM-Y</th>
		                <th>rollSigma</th>
		                <th>pitchSigma</th>
		                <th>azimuthSigma</th>
		                <th>latitudeSigma</th>
		                <th>longitudeSigma</th>
		                <th>heightSigma</th>
		                <th>车高</th>
	                </tr>
                </thead>
                <tbody>
                 ${result.map(d=>`
                    <tr>
	                    <td>${d.tags.roll}</td>
	                    <td>${d.tags.pitch}</td>
	                    <td>${d.tags.azimuth}</td>
	                    <td>${d.tags.y}</td>
	                    <td>${d.tags.x}</td>
	                    <td>${d.tags.z}</td>
	                    <td>${iD.util.LLtoUTM_(d.tags.x,d.tags.y).x}</td>
	                    <td>${iD.util.LLtoUTM_(d.tags.x,d.tags.y).y}</td>
	                    <td>${d.tags.rollSigma}</td>
	                    <td>${d.tags.pitchSigma}</td>
	                    <td>${d.tags.azimuthSigma}</td>
	                    <td>${d.tags.latitudeSigma}</td>
	                    <td>${d.tags.longitudeSigma}</td>
	                    <td>${d.tags.heightSigma}</td>
	                    <td>${player.getCameraHeight()}</td>
                    </tr>
                `).join("")}
                </tbody>
            </table>
	        `;var $statusBar=self.$status;var $table=$statusBar.select("#picplayer-status-table");var table=tableTempl(data,$table.size()?$table.classed("hidden-visibility"):true);$statusBar.html(table);var date=new Date(+node.tags.locTime);var title="<b>\u8F68\u8FF9\u70B9ID\uFF1A</b>&nbsp;"+node.tags.trackPointId+"&nbsp;&nbsp;&nbsp;<b>\u62CD\u6444\u65F6\u95F4\uFF1A</b>&nbsp;"+date.toLocaleString();var trackIds=iD.Task.d.tags.trackIds||"";if(trackIds){var arr=trackIds.split(",");var index=arr.indexOf(node.tags.trackId);if(-1!=index){trackIds=arr[index]}}$statusBar.append("div").attr("class","picplayer-title-track").html("<b>\u8F68\u8FF9ID\uFF1A</b>"+trackIds);$statusBar.append("div").attr("class","picplayer-title").html(title)},getDelFlagText:function(v){return delFlag[v]||""},getPlaySpeed:function(){return select_speed||1}});var playerFooter=new PlayerFooter;playerFooter.event=dispatch;return d3.rebind(playerFooter,dispatch,"on")};;iD.svg.PicPlayer=function(context){var player;var dispatch=d3.dispatch("ready","loadedmetadata","close","picUpdate","referneceUpdate");var loading=iD.ui.Loading(context).message("\u56FE\u7247\u521D\u59CB\u5316\u4E2D,\u8BF7\u7A0D\u540E").blocking(false);var loadImageFirstIndex=0;var loadImagelastIndex=20;var currentTrackPointDis=60;var imgLoading=true;var trackPointId1;var rightCanvasGeometrys=[];var intersectionParamHistory=[];var postCount=0;var isGetParameters=false;var markDrawStatus={drawing:false,type:"",secType:"",shape:null,postCall:_.noop};var zrenderNodeStatus={dragoverShape:null,downOffset:null,moveOffset:null,drawingEntityid:null,downEntityid:null,downShape:null};var markVectorPoint={loc:null,shape:null,points:null};const constant=_.clone(iD.Static.playerConstant);var datumPanelTmpl=`
    <div class="picplayer-right-content">
		<div class="body">
			<div class="inner">
				<div class="rigth-pic">
					<img class="picplayerimg-r" src="" />
				</div>
				<div class="right-canvas-content">
					<canvas class='right-canvas' id='right-canvas'></canvas>
				</div>
			</div>
		</div>
	</div>
     `;require.config({packages:[{name:"zrender",location:"./zrender/src",main:"zrender"}]});const picUrlParam={0:{type:"00",seq:"005",imageType:"jpg"},1:{type:"04",seq:"000",imageType:"png"},2:{type:"99",seq:"000",imageType:"png"},3:{type:"09",seq:"000",imageType:"png"},4:{type:"05",seq:"000",imageType:"png"},5:{type:"06",seq:"000",imageType:"png"},6:{type:"07",seq:"000",imageType:"png"},type:"0",subType:""};var viewZoomParam={position:[0,0],scale:1,min:1,max:8};var epilineTool;if(7==window._systemType){epilineTool=new iD.svg.PicToolEpiline(context)}var drawTool=new iD.svg.PicDrawTool(context,{constant:constant,markDrawStatus:markDrawStatus,zrenderNodeStatus:zrenderNodeStatus,markVectorPoint:markVectorPoint,viewZoomParam:viewZoomParam,epilineTool:epilineTool});var playerFooter=new iD.svg.PlayerFooter(context,{constant:constant,markDrawStatus:markDrawStatus,epilineTool:epilineTool,picUrlParam:picUrlParam});var intersectionTool=new iD.svg.PicToolIntersection(context,{constant:constant,markDrawStatus:markDrawStatus});var next_throttle=_.throttle(function(self,key){nextShow(self)},400,{leading:false,trailing:true});var pre_throttle=_.throttle(function(self,key){preShow(self)},400,{leading:false,trailing:true});context.on("enter.pic-player",function(){if(!player)return;if(0==context.selectedIDs().length){drawTool.clearZRenderHover()}if("browse"==context.mode().id){return}if("select"!=context.mode().id){drawTool.clearZRenderNodeStatus()}clearFooterButton();hideRightPic();drawTool.clearLeftZrenderMarker()});context.history().on("change.pic-player",function(difference,extent){if(!difference||!difference.length()){return}player._refreshViewTextTag()});context.event.on("selected.pic-player",function(entities){if(0==entities.length){drawTool.clearZRenderHover()}if(1==entities.length){var datum=entities[0];if(datum.tags.TASKID==iD.Task.d.task_id&&_.include([iD.data.DataType.IMAGE_TAG,iD.data.DataType.QUESTION_TAG],datum.modelName)){if(datum.tags.TRACKPOINTID&&player&&player._zrender){if(datum.tags.BATCH&&"0"!=picUrlParam.type){player.setPicBatch(datum.tags.BATCH,false)}player.locateTrackPointToPlayer(datum.tags.TRACKPOINTID,datum.tags.TRACKID);iD.AutoMatch.shapeHover(player,[datum.id])}}if(player.developShow&&[iD.data.DataType.ANALYSIS_TAG].includes(datum.modelName)){showLeftbar()}}if(!_.include([constant.TELEGRAPH_LAMP_HOLDER,constant.ADD_TRAFFICLIGHT],markDrawStatus.type)){return}if(0==entities.length&&1==context.selectedIDs().length){clearFooterButton();return}if(1==entities.length){var entity=entities[0];if(!iD.picUtil._entityIsPoleTop(entity.id)){clearFooterButton()}}else{clearFooterButton()}});context.ui().layermanager.on("change.pic-player",function(lay){if(!lay)return;if(lay&&lay.editable!=undefined&&"elements"==lay._parentType){playerFooter.refreshFooterBtnDisplay(lay);clearFooterButton()}});intersectionTool.on("intersection_callback",function(geometry,requestList,canvasList){iD.picUtil.createIntersectionDatum(geometry);var hisdata={geometry:geometry,points:_.cloneDeep(canvasList)};intersectionParamHistory.push(hisdata);showIntersectionHistoryList();drawTool.resetCanvas()});intersectionTool.on("start",function(showEpiline){showRightPic(showEpiline)});intersectionTool.on("end",function(){hideRightPic()});intersectionTool.on("request_failed",function(){drawTool.clearWrongShapeAndEntity();clearFooterButton();drawTool.clearZRenderNodeStatus();picUpdate(player)});function showLeftbar(){iD.ui.LeftBarControl.show&&iD.ui.LeftBarControl.show()}function resetDirectionLabel(text){d3.select(".direction-label").text(text)}function picPlayer(){this.canvasClickCheck=true;this.wayInfo=null;this._locate_point_index=0;this._init_byurl=true;this.surface=null;this.pics=null;this.picTools=null;this.statusBar=null;this.loadImageLenght=60;this.picBox=null;this.$zoomList=null;this.divItem=null;this.$rightBody=null;this.playerTimeId=null;this.pic_point=null;this.classified=null;this.picCount=0;this.time=1;this.isNewBatch=false;this.allNodes=null;this._zrender=null;this.dividerCanvasGeometrys=[];this.rightPointIndex=0;this.selectPicIndex=0;this.playStatus="pause";this.direction=null;this.picMinGroup=null;this.config=null;this.dataMgr=iD.svg.Pic.dataMgr;this.dialog=null;this.playDirection="forward";this.dot_imgs=[];this.dot_img=null;this.developShow=false}function preShow(self,jumpOne=false){if(!self.allNodes||0==self.allNodes.length||0==self.selectPicIndex){return}var jumpNum=1;if(!jumpOne){jumpNum=parseInt(self.time)}var newPicIndex=self.selectPicIndex-jumpNum;if(0>newPicIndex){newPicIndex=0}var preDiv=self.allNodes[newPicIndex]||null;if(preDiv){trackPointId1=preDiv.tags.trackPointId;trackImage1=parseNewPicUrl(preDiv.tags.picUrl);self._refreshViewTextTag(preDiv);if(loadImagelastIndex==self.selectPicIndex&&imgLoading){showLoading();return}self.clearMark();self.selectPicIndex=newPicIndex;self.pic_point=preDiv;imgLoaded();self.dot_imgs=[];playerFooter.updateTitle(preDiv);self.updateImgUrl(self.divItem,preDiv);rightPicNext(self);self.indexUpdate();self.preLoadOneImage(self.allNodes,loadImageFirstIndex);picUpdate(self);self.clearRightBodyCanvas()}else{if(self.dataMgr.preEmptyFlag||0>=self.selectPicIndex){if(self.playerTimeId){window.clearInterval(self.playerTimeId)}}}d3.select(".footer-progress-bar").dispatch("picPlayerEvt",{playerData:{current:self.selectPicIndex}})}function nextShow(self,jumpOne=false){if(!self.allNodes||0==self.allNodes.length||self.selectPicIndex==self.allNodes.length){return}var jumpNum=1;if(!jumpOne){jumpNum=parseInt(self.time)}var newPicIndex=self.selectPicIndex+jumpNum;if(newPicIndex>self.allNodes.length-1){newPicIndex=self.allNodes.length-1}var nextDiv=self.allNodes[newPicIndex]||null;if(nextDiv){trackPointId1=nextDiv.tags.trackPointId;trackImage1=parseNewPicUrl(nextDiv.tags.picUrl);self._refreshViewTextTag(nextDiv);if(loadImageFirstIndex==self.selectPicIndex&&imgLoading){showLoading();return}self.clearMark();self.selectPicIndex=newPicIndex;self.pic_point=nextDiv;self.dot_imgs=[];playerFooter.updateTitle(nextDiv);self.updateImgUrl(self.divItem,nextDiv);rightPicNext(self);imgLoaded();self.indexUpdate();self.preLoadOneImage(self.allNodes,loadImagelastIndex);picUpdate(self);self.clearRightBodyCanvas()}if(self.selectPicIndex+1==self.picCount&&null==nextDiv){if(self.playerTimeId){window.clearInterval(self.playerTimeId)}}d3.select(".footer-progress-bar").dispatch("picPlayerEvt",{playerData:{current:self.selectPicIndex}})}function picUpdate(self){drawTool.clearZRenderHover();hideRightPic();self.hoverPlay();self.allNodes&&dispatch.picUpdate(self.pic_point);player.canvasClickCheck=true;if(!d3.select(".picplayerimg.recognize").classed("hide")){updateRecognizeUrl(self.pic_point.tags.picUrl)}if(!(markDrawStatus.drawing&&_.include([constant.ADD_DIVIDER,constant.ADD_OBJECT_PL,constant.ADD_OBJECT_PG,constant.POLYLINE_ADD_NODE],markDrawStatus.type))){clearFooterButton()}drawTool.resetCanvas()}function clearFooterButton(){d3.selectAll(".btn-group button").classed("active",function(){if(true==this.__active)return true;return false});if(_.include([constant.ADD_DIVIDER,constant.ADD_OBJECT_PL,constant.BRIDGE_BOTTOM_LINE,constant.ADD_OBJECT_PG],markDrawStatus.type)){drawTool.clearWrongShapeAndEntity(markDrawStatus.shape);drawTool.clearTempShape();if(markDrawStatus.shape&&"polygon"==markDrawStatus.shape.type&&markDrawStatus.shape._entityid){var entity=context.hasEntity(markDrawStatus.shape._entityid);if(entity){var eids=[entity.id].concat(_.uniq(entity.nodes));drawTool.resetPointToPicPlayer(eids)}}}markDrawStatus.drawing=false;markDrawStatus.type="";markDrawStatus.secType="";intersectionTool.clearData();markDrawStatus.shape=undefined;tempShape=null;drawTool.clearVectorPointData()}function imgLoaded(obj=null){loading.close();imgLoading=false;d3.selectAll(".shaded").remove()}function showLoading(){context.container().call(loading)}function rightPicNext(self){var nextIndex=self.selectPicIndex-5;if(nextIndex>self.allNodes.length-1){nextIndex=self.allNodes.length-1}else if(0>nextIndex){nextIndex=0}var nextDiv=self.allNodes[nextIndex];if(nextDiv){self.rightPointIndex=nextIndex}}function showIntersectionHistoryList(){var $body=d3.select("body");var $panel=$body.selectAll("div#intersection-history-div").style("display","block");if(!$panel.node()){$panel=$panel.data([0]).enter().append("div").attr("id","intersection-history-div");$panel.append("div").attr("class","history-list")}var $list=$panel.select("div.history-list");var $items=$list.selectAll("div.list-item").data(intersectionParamHistory);$items.enter().append("div").attr("class","list-item").each(function(d){var $this=d3.select(this);var geometry=d.geometry;var utmLonlat=iD.util.LLtoUTM_(geometry.lng,geometry.lat);$this.html(`
    				<div class="item-left">
    					<p>${geometry.lng||""}</p>
    					<p>${geometry.lat||""}</p>
    					<p>${geometry.elevation||""}</p>
    					<hr />
    					<p>${utmLonlat.x||""}</p>
    					<p>${utmLonlat.y||""}</p>
    				</div>
    				<button type="button">详情</button>
    				`)});$items.exit().remove();$list.selectAll("div.list-item button").on("click.pic-player",function(d){var data=this.parentNode.__data__;var geometry=data.geometry;var pointDatas=data.points;var arr=[{trackPointId:pointDatas[0].trackPointId,x:pointDatas[0].imgOffset.x,y:pointDatas[0].imgOffset.y,point:pointDatas[0].point},{trackPointId:pointDatas[1].trackPointId,x:pointDatas[1].imgOffset.x,y:pointDatas[1].imgOffset.y,point:pointDatas[1].point}];var utmLonlat=iD.util.LLtoUTM_(geometry.lng,geometry.lat);showdata(arr,{center:geometry.lng+","+geometry.lat,utmX:utmLonlat.x,utmY:utmLonlat.y})})}function showdata(data,opts){opts=opts||{};var tableTempl=result=>`
          <div>
             <table id="example2" class="">
                    <thead>
                    <tr>
                    <th>trackPointId</th>
                <th>roll</th>
                <th>pitch</th>
                <th>azimuth</th>
                <th>x</th>
                <th>y</th>
                <th>z</th>
                <th>pixelX</th>
                <th>pixelY</th>
                <th>UTM-X</th>
                <th>UTM-Y</th>
                </tr>
                </thead>
                <tbody>
                 ${result.map(d=>`
                      <tr>
                    <td>${d.point.tags.trackPointId}</td>
                    <td>${d.point.tags.roll}</td>
                    <td>${d.point.tags.pitch}</td>
                    <td>${d.point.tags.azimuth}</td>
                    <td>${d.point.tags.x}</td>
                    <td>${d.point.tags.y}</td>
                    <td>${d.point.tags.z}</td>
                    <td>${d.x}</td>
                    <td>${d.y}</td>
                    <td>${opts.utmX}</td>
                    <td>${opts.utmY}</td>
                    </tr>
                `).join("")}
                
                </tbody>
                <tfoot>
                <tr>
                 <th>trackPointId</th>
                <th>roll</th>
                <th>pitch</th>
                <th>azimuth</th>
                <th>x</th>
                <th>y</th>
                <th>z</th>
                <th>pixelX</th>
                <th>pixelY</th>
                <th>UTM-X</th>
                <th>UTM-Y</th>
                </tr>
                </tfoot>
              </table>
              <div class="positioning-location"> 
                  <div>
                    <input type="text" class="coordinate-text"  placeholder="116.48397884,39.94358273999999" value="${opts.center||""}"/>
                  </div>
                  <input class="coordinate-subimt" value="生成定位" type="button"/>
                  <input class="coordinate-close" value="关闭" type="button"/>
              </div>
           </div>    
            `;var table=tableTempl(data);d3.select("#showdata").html(table).style("display","block");d3.select(".coordinate-subimt").on("click",function(){var $input=d3.select("#showdata input.coordinate-text");var coordinate=$input.value()||$input.attr("placeholder");var xy=coordinate.split(",");if(2!=xy.length){Dialog.alert("\u5750\u6807\u683C\u5F0F\u9519\u8BEF\uFF1A "+xy);return}context.map().center([+xy[0],+xy[1]]);iD.picUtil.createIntersectionDatum({x:+xy[0],y:+xy[1]})});d3.select(".coordinate-close").on("click",function(){d3.select("#showdata").html("").style("display","none")})}function hideRightPic(intersectionEnd){intersectionTool.hide();player.updateImgUrl(player.divItem,player.pic_point);player.mouseZoomChange(viewZoomParam.scale,false,true)}function showRightPic(showEpiline=true){if(0>=player.selectPicIndex){Dialog.alert("\u7B2C\u4E00\u5E27\u7981\u6B62\u524D\u65B9\u4EA4\u4F1A");drawTool.clearWrongShapeAndEntity();clearFooterButton();drawTool.clearZRenderNodeStatus();drawTool.clearLeftZrenderMarker();return}rightPicNext(player);player.updateImgUrl(player.divItem,player.allNodes[player.rightPointIndex]);player.mouseZoomChange(viewZoomParam.scale,false,true);intersectionTool.show();showEpiline&&intersectionTool.createCanvasEpiline()}function parseNewPicUrl(url,type=picUrlParam.type){var param=picUrlParam[type];if(!param){return url}for(var key in param){var value=param[key];url=url.replace(new RegExp("(&?"+key+"=)[^&]+","g"),"$1"+value)}if(!player.isNewBatch&&""!=picUrlParam.subType&&"0"!=type){url+="&batch="+picUrlParam.subType}return url}function updateRecognizeUrl(_url,type="2"){var url=parseNewPicUrl(_url,type);d3.selectAll(".picplayerimg.recognize").attr("src",url)}_.assign(picPlayer.prototype,{play:function(opts){var self=this;var play_intervalTime_ms=1000/self.time;var playDirection=self.playDirection;var playElementSelection="#picplayer-tools-bar a.glyphicon.glyphicon-triangle-right";if(opts&&opts.time&&0<=opts.time){play_intervalTime_ms=1000/opts.time}if(opts&&opts.playDirection){playDirection=opts.playDirection}if(this.playerTimeId){window.clearInterval(this.playerTimeId)}var intervalID=window.setInterval(function(){if("backword"==playDirection){preShow(self);playElementSelection="#picplayer-tools-bar a.glyphicon.glyphicon-triangle-left";self.setElementActive(playElementSelection)}else{nextShow(self,true)}},play_intervalTime_ms);this.setElementActive(playElementSelection);this.playerTimeId=intervalID;this.playStatus="play";return this},show:function(){if(!d3.select("#showdata").size()){d3.select("#id-container ").append("div").attr({id:"showdata"}).style("display","none")}return this},hoverPlay:function(){if("pause"==this.playStatus){this.dataMgr.resetPlanes(this.selectPicIndex);iD.util.getTrackPointsByDis(this.pic_point,this.allNodes,currentTrackPointDis)}},pause:function(){if(this.playerTimeId){window.clearInterval(this.playerTimeId)}this.playStatus="pause";this.hoverPlay();this.setElementActive("#picplayer-tools-bar a.glyphicon.glyphicon-pause")},getPlayStatus:function(){return this.playStatus},indexUpdate:function(){loadImageFirstIndex=this.selectPicIndex-this.loadImageLenght/2;loadImagelastIndex=this.selectPicIndex+this.loadImageLenght/2;loadImagelastIndex=loadImagelastIndex-1;if(0>loadImageFirstIndex){loadImageFirstIndex=0}if(loadImagelastIndex>=this.picCount){loadImagelastIndex=this.picCount-1}},hide:function(){if(this.player){this.player.pause()}return this},close:function(){dispatch.close()},destory:function(){hideRightPic();this.clearMark();this.clearIntersectionHistory();this.destoryPlayer();this.picBox&&this.picBox.selectAll("*").remove();this.picBox&&this.picBox.remove();this.$zoomList&&this.$zoomList.remove();this.picBox=null;this.classified=null;this.wayInfo=null;this.picCount=0;this.surface&&this.surface.html("");this.surface=null;this.allNodes=null;this.pic_point=null;this._zrender=null;this.dividerCanvasGeometrys=null;this.cacheCanvas=null;this.dataMgr=null;d3.select(document).on("keydown.picplayer",null);d3.select(window).on("resize.pic-player",null);this.dialog&&this.dialog.close();d3.select("#KDSEditor-all-wrap").attr("class","layout-10");d3.select(window).trigger("resize");return this},destoryPlayer:function(){if(this.playerTimeId){window.clearInterval(this.playerTimeId)}this.playerTimeId=null;return this},preLoadOneImage:function(images,index){var img=new Image;img.src=parseNewPicUrl(images[index].tags.picUrl);if(img.complete){return}img.onload=function(){return};img.onerror=function(){console.log("\u89C6\u9891\u56FE\u7247\u672A\u52A0\u8F7D\u5168")}},getNewPicUrl:function(url,type){if(!url||!type){return url}return parseNewPicUrl(url,type)},preloadImage:function(images,f=null){imgLoading=true;var loadedimages=0,iserr=false;var loadedCount=0;var postaction=function(){};var length=loadImagelastIndex-loadImageFirstIndex+1;postaction=f||postaction;function imageloadpost(){loadedimages++;if(loadedimages==length){postaction({length:loadedCount});imgLoading=false;if(iserr)console.log("\u89C6\u9891\u56FE\u7247\u672A\u52A0\u8F7D\u5168")}}for(var i=loadImageFirstIndex;i<=loadImagelastIndex;i++){var img=new Image;img.src=parseNewPicUrl(images[i].tags.picUrl);if(img.complete){loadedCount++;imageloadpost();continue}img.onload=function(){loadedCount++;imageloadpost()};img.onerror=function(){iserr=true;loadedCount++;imageloadpost()}}},getCurrentPic_node:function(){return this.pic_point.id},renderPicPlayer:function(wayInfo,needMatch){player.canvasClickCheck=true;window.pic=this;if(this._zrender&&this.pic_point&&wayInfo.nodeId!=this.pic_point.id){this.clearMark()}var self=this;var initParam=self._init_byurl&&iD.util.isInitTrackPointByUrl(self.dataMgr.tracks);if(initParam){wayInfo=initParam.track;self._locate_point_index=initParam.index}self._init_byurl=false;var allNodes=[];self.wayInfo=null;self.dot_imgs=[];self.allNodes=[];self.wayInfo=wayInfo;var nodes=wayInfo.nodes;var currentNode=nodes[self._locate_point_index||0];var selectNodeId=currentNode&&currentNode.id||wayInfo.nodeId;_.forEach(nodes,function(d,i){if(selectNodeId==d.id){self.selectPicIndex=i;self.pic_point=d}allNodes.push(d)});self.allNodes=allNodes;self.picCount=allNodes.length;self.indexUpdate();showLoading();self.updateTrackPoints();self.updateBatch();imageStartLoadTime=new Date;self.preloadImage(allNodes,imgLoaded);self.rightPointIndex=self.selectPicIndex;self.pic_point&&dispatch.picUpdate(self.pic_point);self.clearIntersectionHistory();var imgUrl;this.divItem=this.pics.selectAll(".item").data([0]);this.divItem.enter().append("div").attr("class","item active");this.divItem.classed("zdsb",self.config.picMinGroup).classed("active",true);imgUrl=parseNewPicUrl(self.pic_point&&self.pic_point.tags.picUrl,"0");this.divItem.selectAll(".picplayerimg.main").data([imgUrl]).enter().append("img").classed("picplayerimg main",true);this.divItem.selectAll(".picplayerimg.overlap").data([imgUrl]).enter().append("img").classed("picplayerimg overlap",true);this.divItem.selectAll(".picplayerimg.recognize").data([imgUrl]).enter().append("img").classed("picplayerimg recognize",true);this.divItem.selectAll("img").attr("src",imgUrl);if(epilineTool){epilineTool.initImageUrl(imgUrl);epilineTool.clearCanvas()}this.divItem.selectAll(".picplayerimg.recognize").classed("hide",true);self.updateDirectionByUrl(imgUrl);self.markCanvas(this.pics);trackPointId1=self.pic_point.tags.trackPointId;trackImage1=parseNewPicUrl(self.pic_point.tags.picUrl);self._refreshViewTextTag(self.pic_point);playerFooter.updateTitle(self.pic_point);if("play"==self.playStatus){self.play()}self.picTools.select(".footer-progress-range").attr("max",self.picCount-1);self.picTools.select(".footer-progress-number.no-number").attr("max",self.picCount);self.picTools.select(".footer-progress-total").text("/"+self.picCount+"\u5E27");let newNumberW=8*self.picCount.toString().length+8+5;self.picTools.select(".footer-progress-number-div").style("width",newNumberW+"px");d3.select(".footer-progress-bar").dispatch("picPlayerEvt",{playerData:{current:self.selectPicIndex,max:self.picCount}});var surface=self.surface;hideRightPic();self.resizeDomStyle();self.updateImgUrl(this.divItem,self.pic_point);rightPicNext(self);picUpdate(this);playerFooter.refreshFooterBtnDisplay();self._locate_point_index=0;if(epilineTool){epilineTool.loadTrackParams(player.wayInfo&&player.wayInfo.trackId,function(result){if(!result){epilineTool.updateEpilineParam()}})}return this},updateBatch:function(){var self=this;self._refreshBatch();var trackIds=[];for(var i=0;i<this.dataMgr.tracks.length;i++){var trackId=this.dataMgr.tracks[i].trackId;trackIds.push({value:trackId,name:trackId})}var seElement_trackIds=d3.select(".pic-current-trackid");if(!seElement_trackIds.size())return;seElement_trackIds.html("");var options_trackIds=seElement_trackIds.selectAll("option").data(trackIds);options_trackIds.enter().append("option").text(function(d){return d.name}).attr("value",function(d){return d.value});options_trackIds.exit().remove();if(2>trackIds.length){seElement_trackIds.classed("hidden",true)}else{seElement_trackIds.classed("hidden",false);if(self.wayInfo){seElement_trackIds.value(self.wayInfo.trackId);self.dataMgr.trackId=self.wayInfo.trackId}}},_refreshBatch:function(){var sublist=d3.select("#_sublist");if(!sublist.size())return;var oldVal=sublist.value(),inOpts=false;var subParams=[],trackBatchs=iD.config.trackBatchMap[this.dataMgr.trackId]||[];for(var i=0;i<trackBatchs.length;i++){if(oldVal&&trackBatchs[i]==oldVal){inOpts=true}subParams.push({name:trackBatchs[i],value:trackBatchs[i]})}sublist.html("");var subOptions=sublist.selectAll("option").data(subParams);subOptions.enter().append("option").text(function(d,i){return d.name}).value(function(d,i){this.value=d.value;return d.value});subOptions.exit().remove();if(1<subParams.length&&picUrlParam.type&&0!=picUrlParam.type){if(inOpts){sublist.value(oldVal);picUrlParam.subType=oldVal}else{sublist.value(subParams[0].value);picUrlParam.subType=subParams[0].value}sublist.style("display","inline-block")}else{sublist.style("display","none");picUrlParam.subType=subParams[0]&&subParams[0].value||""}},setPicBatch:function(batch,trigger){if(!batch)return;var self=this;var sublist=d3.select("#_sublist");if(!_.pluck(sublist.node().options,"value").includes(batch))return;sublist.value(batch);picUrlParam.subType=batch;true==trigger&&sublist.dispatch("change")},updateImgUrl:function(currentDiv,selectPoint){currentDiv.selectAll(".picplayerimg.main").attr("src",parseNewPicUrl(selectPoint.tags.picUrl,"0"));if("0"!=picUrlParam.type){currentDiv.selectAll(".picplayerimg.overlap").style("display","block");currentDiv.selectAll(".picplayerimg.overlap").attr("src",parseNewPicUrl(selectPoint.tags.picUrl))}else{currentDiv.selectAll(".picplayerimg.overlap").style("display","none")}if(epilineTool){epilineTool.updateImageUrl()}},updateImgOverlapOpacity:function(num,setNumber=false){var self=this;var $imgs=self.pics.selectAll(".picplayerimg.recognize, .picplayerimg.overlap");var opacity=Number($imgs.style("opacity"));if(!isNaN(opacity)){if(setNumber){opacity=num}else{opacity+=num}if(0>opacity){opacity=0}else if(1<opacity){opacity=1}$imgs.style("opacity",opacity)}},getSelectPicIndex:function(selectPoint,allNodes){var picIndex=0;for(var i=0;i<allNodes.length;i++){if(selectPoint.point_id==allNodes[i].point_id){picIndex=i;break}}return picIndex},setElementActive:function(eleSelection){var domSelection=d3.select(eleSelection);if(0<domSelection.size()){d3.select(domSelection[0][0].parentNode).selectAll("a").classed("active",false);domSelection.classed("active",true)}},init:function(surface,pra_config){viewZoomParam.scale=1;var self=this;var config={directionPlay:false,minPic:false,zoomPic:false};if(pra_config){_.assign(config,pra_config)}self.config=config;if(self.picBox){return this}var surface=d3.select("#KDSEditor-picplayer");surface.html("");this.surface=surface;var picplayerDom=surface.append("div").attr("class","pic-player");var picplayerShadow=surface.append("div").attr("class","pic-player-shadow");picplayerDom.append("div").attr("id","picplayer-view").attr("class","carousel-inner").style({height:surface.node().offsetHeight-140+"px",width:"100%"});picplayerDom.append("div").attr("id","picplayer-tools-bar");picplayerDom.append("div").attr("id","picplayer-status-bar");picplayerDom.append("div").attr("id","pic-player-rightbox").classed("pic-player-rightbox",true);self.makeHtml(surface,config);if(epilineTool){epilineTool.init(self,picplayerDom.select("#pic-player-rightbox"))}self.initMouseWheelEvent();return this},resizeDomStyle:function(){var self=this;var $view=self.pics||d3.select("#picplayer-view");var surfaceDom=self.surface.node();var bottomHeight=parseInt(self.picTools.style("height"))+parseInt(self.statusBar.style("height"));$view.style({height:surfaceDom.offsetHeight-bottomHeight+"px",width:"100%"});var viewDom=$view.node();var $leftList=self.picBox.selectAll("div.item,#picplayer-mark-canvas");var newHeight=viewDom.offsetHeight;var newWidth=viewDom.offsetWidth;resizeDoms($leftList,false);var dpr=window.devicePixelRatio||1;if(1!=dpr&&self._zrender){_.each(self._zrender.painter.getLayers(),function(layer){layer.resize(newWidth,newHeight)})}else if(self._zrender){self._zrender.resize()}var map=context.map();map.zoomOut();map.zoomIn();function resizeDoms($list,setCanvas=false){$list.style({left:0,top:0});$list.attr({"d-height":newHeight,"d-width":newWidth}).style({height:newHeight+"px",width:newWidth+"px"});if(!setCanvas){return}$list.selectAll("canvas").style({width:newWidth+"px",height:newHeight+"px"}).each(function(){this.width=$list.attr("d-width")||newWidth+"px";this.height=$list.attr("d-height")||newHeight+"px"})}},makeHtml:function(surface,config){var self=this;self.picBox;self.$zoomList;self.pics;self.picTools;self.$rightBody;var resetCanvasTimelimit=_.throttle(function(){drawTool.resetCanvas()},50,{leading:false,trailing:true});_.bind(resetCanvasTimelimit,self);var picModal=self.surface.select("div.pic-player");d3.select(window).on("resize.pic-player",function(){self.resizeDomStyle();if(epilineTool){epilineTool.resizeDomStyle()}if(!self.pics||!self.pics.node())return;iD.util.whichTransitionEndEvent(self.pics.select("div.item.active").node(),function(){resetCanvasTimelimit()})});self.picBox=picModal;var picBody=picModal;var $rightTool=d3.select("#rightmenu-tools");d3.select("#rightmenu-picplayer").remove();var $picTools=$rightTool.append("div").attr("id","rightmenu-picplayer").attr("class","rightmenu-picplayer");$picTools.append("div").text("\u56FE\u50CF").style({"border-top":"1px solid #666","margin-top":"15px",padding:"0 5px","font-size":"18px"});var $zoomList=$picTools.append("div").attr("class","pic-player-zoom-list");$zoomList.selectAll("div").data([["reset"],["scale"],["useless_btn"]]).enter().append("div").attr("class","map-control").selectAll("button").data(function(d){return d}).enter().append("button").attr("class",function(type){return"btn-zoom-"+type}).html(function(type){var iconName;if("in"==type){iconName="glyphicon glyphicon-plus"}else if("reset"==type){iconName="glyphicon glyphicon-refresh"}else if("out"==type){iconName="glyphicon glyphicon-minus"}else if("scale"==type){return"<span class=\"scale-value\" style=\"width: 100%; text-align: center;\">"+Number(viewZoomParam.scale).toFixed(1)+"</span>"}else if("useless_btn"==type){return"<span class=\"text-fill\">\u5F00\u53D1\u529F\u80FD</span>;"}return"<span class=\""+iconName+"\"></span>"}).on("click",function(type){if("reset"==type){self.viewScaleReset()}else if("useless_btn"==type){var $btns=self.picTools.selectAll(".footer_useless_btn");var $status=self.statusBar.select("#picplayer-status-table");if($btns.classed("hidden")){$btns.classed("hidden",false);$status.classed("hidden-visibility",false);self.developShow=true}else{$btns.classed("hidden",true);$status.classed("hidden-visibility",true);self.developShow=false}}}).call(bootstrap.tooltip().placement("left").html(true).title(function(type){var result="";if("in"==type){result="\u653E\u5927\u7EA7\u522B"}else if("reset"==type){result="\u91CD\u7F6E\u7EA7\u522B"}else if("out"==type){result="\u7F29\u5C0F\u7EA7\u522B"}else if("scale"==type){result="\u5F53\u524D\u7EA7\u522B"}else if("useless_btn"==type){result="\u663E\u793A/\u9690\u85CF \u5F00\u53D1\u529F\u80FD"}return result}));self.$zoomList=$zoomList;self._$zoomScaleNum=$zoomList.select("button.btn-zoom-scale");var pics=picBody.select("#picplayer-view");self.pics=pics;self.picTools=picBody.select("#picplayer-tools-bar");self.statusBar=picBody.select("#picplayer-status-bar");picBody.select("#picplayer-status-bar").append("div");var markFalse=pics.append("span").attr("class","markFalse");pics.append("span").attr("class","pic-imagetag-mark");var footer=picBody.select("#picplayer-tools-bar");footer.classed("zdsb",config.picMinGroup);playerFooter.render(footer,self.statusBar);context.history().on("undone.picplayer",function(e){var isClear=false;if(markDrawStatus.shape&&markDrawStatus.shape._entityid){var way=context.hasEntity(markDrawStatus.shape._entityid);if(!way||2>way.nodes.length){isClear=true}else if(_.include([constant.ADD_DIVIDER,constant.ADD_OBJECT_PL],markDrawStatus.type)){markDrawStatus.shape.shape.points.pop();iD.picUtil.modShape(markDrawStatus.shape)}}if(isClear){markDrawStatus.shape=undefined;markDrawStatus.__lastDrawIndex=undefined;drawTool.clearTempShape()}});playerFooter.on("imagetype_change",function(evt,select){var value=select.value;picUrlParam.type=value.toString();if("0"==value.toString()){d3.$("#_sublist").style("display","none");picUrlParam.subType=""}else{self._refreshBatch()}self.pics.select(".picplayerimg.main").classed("hide",false);self.updateImgUrl(self.divItem,self.pic_point);rightPicNext(self)});playerFooter.on("imagebatch_change",function(evt,select){var value=select.value;picUrlParam.subType=value;var currentDiv=d3.select("div.carousel-inner div.item.active");player.updateImgUrl(currentDiv,player.allNodes[player.selectPicIndex]);rightPicNext(self)});playerFooter.on("track_change",function(evt,select){var trackId=select.value;player.switchPlayerTrackId(trackId)});playerFooter.on("playcontrol_prev",function(){preShow(self)});playerFooter.on("playcontrol_next",function(){nextShow(self)});playerFooter.on("playcontrol_play",function(playSpeed){self.playDirection="forward";self.play({time:playSpeed,playDirection:"forward"})});playerFooter.on("playcontrol_speedchange",function(playSpeed){self.time=playSpeed;self.play({time:playSpeed});playerFooter.udpatePlayControl(true)});playerFooter.on("playcontrol_pause",function(){self.pause()});playerFooter.on("keydown",function(key,data){switch(key){case"w":case"arrowup":keyUpdateDirection(key,false);break;case"s":case"arrowdown":keyUpdateDirection(key,true);break;case"a":case"arrowleft":{pre_throttle(self,key);d3.select(".compress_original").classed("active",false)}break;case"d":case"arrowright":{next_throttle(self,key);d3.select(".compress_original").classed("active",false)}break;case"ctrl+p":keyPause(key);break;case" ":keyPause(key);break;case"`":player.markTrackPointRequest();break;case"ctrl+,":player.updateImgOverlapOpacity(-0.1);break;case"ctrl+.":player.updateImgOverlapOpacity(+0.1);break;}});function keyUpdateDirection(key,flag){if(0<d3.select(".pic_player_direction").size()){player.updateDirection(flag?1:-1)}}function keyPause(key){var isPaused=true;if("pause"==self.playStatus){isPaused=false}player.playDirection=player.playDirection||"forward";if(!isPaused){if(player.playDirection){var playSpeed=playerFooter.getPlaySpeed();player.play({time:playSpeed,playDirection:player.playDirection});playerFooter.udpatePlayControl(true)}}else{player.pause();playerFooter.udpatePlayControl(false)}}playerFooter.on("progress_mousedown",function(){self.pause()});playerFooter.on("progress_change",function(evt,data){self.selectPicIndex=data.value-1;var currentIndex=data.oldValue;if(!isNaN(currentIndex)&&self.selectPicIndex<currentIndex||self.selectPicIndex>loadImagelastIndex-10){imgLoaded();showLoading()}self.indexUpdate();imageStartLoadTime=new Date;self.preloadImage(self.allNodes,function(obj=null){imgLoaded(obj);nextShow(self,true);self._zrender&&self._zrender.refreshHover()})});playerFooter.on("button_click",function(e,btnText){if("BUTTON"!=e.target.nodeName.toUpperCase()){return}if(!d3.select(e.target).classed("epliline_tool_btn")&&self.checkRightBodyShown()){self.hideRightBody()}if(d3.select(e.target).classed("except_action")){self._buttonKeepClickAction(e.target,btnText);return}var arr=["\u539F\u59CB","\u8BC6\u522B"];intersectionTool.clearData();isGetParameters=false;d3.select("#showdata").html("").style("display","none");var btnType=d3.select(e.target).datum();drawTool.clearLeftZrenderMarker();if(markDrawStatus.type&&markDrawStatus.type!=btnType){clearFooterButton();drawTool.clearZRenderNodeStatus();self._zrender.off("mousemove",drawTool.zrenderMove)}if(null!=btnType){markDrawStatus.type=btnType}else{markDrawStatus.type=""}if("\u6E05\u9664"==btnText){self.clearMark()}else if("\u6807\u8BB0"==e.target.textContent){self.signMark(e.target)}if("\u53C2\u6570\u83B7\u53D6"==btnText){isGetParameters=true}if(!_.include(["\u524D\u65B9\u4EA4\u4F1A","6\u53C2\u6570","\u53C2\u6570\u83B7\u53D6"].concat(arr),btnText)){intersectionParamHistory.length=0;showIntersectionHistoryList()}var $btn=d3.select(d3.event.target);if(/\bactive\b/.test($btn.attr("class"))){clearFooterButton();drawTool.clearZRenderNodeStatus();$btn.classed("active",false);markDrawStatus.drawing=false;markDrawStatus.type="";markDrawStatus.shape=undefined}else{d3.selectAll(".btn-group button").classed("active",function(){if(true==this.__active)return true;return false});$btn.classed("active",true);markDrawStatus.drawing=true}var $img=self.pics.select(".picplayerimg.main");if("\u4E09\u7EF4"==btnText){if($img.classed("hide")){$img.classed("hide",false);$btn.classed("active",false)}else{$img.classed("hide",true);$btn.classed("active",true)}}if("\u70B9\u4E91"==btnText){var recognize=d3.select(".picplayerimg.recognize");var isShow=recognize.classed("hide");recognize.classed("hide",!isShow);$btn.classed("active",isShow);if(isShow){updateRecognizeUrl(self.pic_point&&self.pic_point.tags.picUrl)}}e.btnType=btnType;drawTool.execPlugin("buttonClick",e,$btn.classed("active"),$btn.node())})},updateZoomHtml:function($divSelecter,picUrl){if(!picUrl||""==picUrl.trim()){return}$divSelecter.selectAll(".picZoom img").attr("src",picUrl)},updateDirection:function(step){var index=0;var i=0,len=direcObj.length;for(;i<len;i++){if(this.dataMgr.directNum==direcObj[i].directNum){index=i;break}}index=index+step;if(-1==index){index=len-1}else if(index==len){index=0}d3.select(".pic_player_direction").value(index);d3.select(".pic_player_direction").trigger("change")},updateDirectionByUrl:function(picurl){if(this.config.directionPlay&&picurl){var picArr=picurl.match(/(\d{1})\.(png|jpg)/g);var index=picArr[0][0];if(0>index||index>=direcObj.length)return;if(0<d3.select(".pic_player_direction").size()){this.dataMgr.directNum=index;d3.select(".pic_player_direction").value(index);resetDirectionLabel(direcObj[index].name)}}},resetZrenderLayer:function(){drawTool.updateZRenderLayer(0,{zoomable:true,position:[0,0],scale:[viewZoomParam.min,viewZoomParam.min],minZoom:viewZoomParam.min,maxZoom:viewZoomParam.max});var layer=this._zrender.painter.getLayer(0);layer.__zoom=1;$img=d3.select("#picplayer-view .item.active");var style="transform-origin: 0px 0px 0px; transition: all 0.7s ease-out; transform: translate3d("+0+"px, "+0+"px, 0px) scale3d("+1+", "+1+", 1)";d3.select("#picplayer-view div.rigth-pic").attr("style",style);d3.select("#picplayer-view .item.active").attr("style",style);viewZoomParam.scale=1;this._zrender.painter.refresh();this._$zoomScaleNum&&this._$zoomScaleNum.select("span.scale-value").text(1)},viewScaleReset:function(){var self=this;if(!self._zrender)return;var layer=self._zrender.painter.getLayer(0);if(!layer){return}layer.position=[0,0];layer.scale=[viewZoomParam.min,viewZoomParam.min];self._zrender.painter.refresh();var shapes=self._zrender.storage._roots;for(var i=0;i<shapes.length;i++){var shape=shapes[i];iD.picUtil.shapeScale(shape,layer.scale);iD.picUtil.shapePosition(shape,layer.position,true)}self.updateViewDomStyle(layer);viewZoomParam.position=[layer.position[0],layer.position[1]];viewZoomParam.scale=layer.scale[0];self._$zoomScaleNum&&self._$zoomScaleNum.select("span.scale-value").text(layer.scale[0])},updateViewDomStyle:function(layer){var self=this;var $img=d3.select("#picplayer-view .item.active"),width=$img.attr("d-width"),height=$img.attr("d-height");var pos=[layer.position[0],layer.position[1]];var x=parseInt(pos[0])/layer.scale[0];var y=parseInt(pos[1])/layer.scale[0];var x2=pos[0]+width*layer.scale[0];var y2=pos[1]+height*layer.scale[0];if(0<x||0<y){if(0<x){pos[0]=0}if(0<y){pos[1]=0}}if(x2<width||y2<height){if(x2<width){pos[0]=pos[0]+(width-x2)}if(y2<height){pos[1]=pos[1]+(height-y2)}}pos[0]=parseInt(pos[0]);pos[1]=parseInt(pos[1]);drawTool.updateZRenderLayer(0,{zoomable:true,position:pos,scale:layer.scale,minZoom:viewZoomParam.min,maxZoom:viewZoomParam.max});var style="transform-origin: 0px 0px 0px; transition: all 0.7s ease-out; transform: translate3d("+pos[0]+"px, "+pos[1]+"px, 0px) scale3d("+layer.scale[0]+", "+layer.scale[1]+", 1)";d3.select("#picplayer-view div.rigth-pic").attr("style",style);$img.attr("style",style)},markCanvas:function($container){var self=this;var t=0;drawTool.initZRender(function(zrender){CircleShape=zrender.Circle;PolygonShape=zrender.Polygon;PolylineShape=zrender.Polyline;StarShape=zrender.Star;RectangleShape=zrender.Rect;if(!self._zrender){self._zrender=zrender.init(document.getElementById("picplayer-mark-canvas"));drawTool._zrender=self._zrender;document.getElementById("picplayer-mark-canvas").oncontextmenu=function(evt){evt.stopPropagation();return false};drawTool.resetCanvas();drawTool.updateZRenderLayer(0,{zoomable:true,minZoom:viewZoomParam.min,maxZoom:viewZoomParam.max,panable:true});var bboxZrender=function(painterlayer){self.updateViewDomStyle(painterlayer);self._zrender.painter.refresh();var shapes=self._zrender.storage._roots;for(var i=0;i<shapes.length;i++){var shape=shapes[i];iD.picUtil.shapePosition(shape,painterlayer.position,true)}};var isDown=false;var startP=null;var dragZrender=function(e){var l=pic._zrender.painter,painterlayer=l.getLayer(0);if(!painterlayer.panable||!isDown){isDown=false;startP=null;self._zrender.off("mousemove",dragZrender);self._zrender.off("mouseup",_mouseup);return}if(player.canvasClickCheck){var l=pic._zrender.painter,painterlayer=l.getLayer(0);if(1<painterlayer.scale[0]){var mouseX=e.offsetX-startP[0];var mouseY=e.offsetY-startP[1];painterlayer.position[0]+=mouseX;painterlayer.position[1]+=mouseY;startP=[e.offsetX,e.offsetY];bboxZrender(painterlayer)}}};function _mousedown(e){drawTool.updateZRenderLayer(0,{panable:player.canvasClickCheck});startP=[e.offsetX,e.offsetY];if(player.canvasClickCheck){isDown=true;self._zrender.on("mouseup",_mouseup);self._zrender.on("mousemove",dragZrender)}}function _mouseup(e){drawTool.updateZRenderLayer(0,{panable:player.canvasClickCheck});startP=null;if(player.canvasClickCheck){isDown=false;self._zrender.off("mouseup",_mouseup);self._zrender.off("mousemove",dragZrender)}}self._zrender.on("mousedown",_mousedown);self._zrender.on("mouseup",_mouseup);d3.select(player._zrender.dom).on("mouseout.picplayer",function(e){if(isDown){self._zrender.off("mousemove",dragZrender);self._zrender.off("mouseup",_mouseup);var l=pic._zrender.painter,painterlayer=l.getLayer(0);bboxZrender(painterlayer);drawTool.updateZRenderLayer(0,{panable:false})}isDown=false});self._zrender.on("mousewheel",function(){var event=window.event;var layer=drawTool.getZRenderLayer(0);if(!layer){return}var delta=event.wheelDelta||-event.detail;var scale=0<delta?1.1:0.9;var mouseX=event.offsetX;var mouseY=event.offsetY;var pos=layer.position;layer.__zoom=layer.__zoom||1;var newZoom=layer.__zoom;newZoom*=scale;newZoom=Math.max(Math.min(layer.maxZoom,newZoom),layer.minZoom);scale=newZoom/layer.__zoom;layer.__zoom=newZoom;pos[0]-=(mouseX-pos[0])*(scale-1);pos[1]-=(mouseY-pos[1])*(scale-1);if(-1<(pos[0]+"").indexOf("e")){}pos[0]=parseInt(pos[0]);pos[1]=parseInt(pos[1]);if(0==pos[0]&&0==pos[1]){scale=layer._zoom=layer.minZoom;layer.scale=[layer.minZoom,layer.minZoom]}else{layer.scale=[newZoom,newZoom]}if(layer.scale[0]<layer.minZoom){layer.scale[0]=layer.minZoom}if(layer.scale[1]<layer.minZoom){layer.scale[1]=layer.minZoom}layer.position=pos;self.updateViewDomStyle(layer);layer=drawTool.getZRenderLayer(0);var shapes=self._zrender.storage._roots;for(var i=0;i<shapes.length;i++){var shape=shapes[i];iD.picUtil.shapeScale(shape,layer.scale);iD.picUtil.shapePosition(shape,layer.position,true)}window.viewZoomParam=viewZoomParam;self.updateViewDomStyle(layer);viewZoomParam.position=[layer.position[0],layer.position[1]];viewZoomParam.scale=layer.scale[0];self._$zoomScaleNum&&self._$zoomScaleNum.select("span.scale-value").text(layer.scale[0])})}if(self._zrender){self.resetZrenderLayer()}});var clickTimeout=iD.util.getClickTimeout();var lastMousePos;if($container.selectAll(".picplayer-mark-canvas").empty()){$container.append("div").attr("id","picplayer-mark-canvas").attr("class","picplayer-mark-canvas").style("position","absolute").style("width","100%").style("height","100%").on("mousedown.tag",function(){lastMousePos=[d3.event.clientX,d3.event.clientY];if(intersectionTool.shown){return}drawTool.domMousedown(d3.event)}).on("mouseup",function(){if(intersectionTool.shown){return}drawTool.domMouseup(d3.event)}).on("dblclick",function(){if(intersectionTool.shown){return}clickTimeout.clear();drawTool.domDblclick(d3.event)}).on("click",function(){var upPos=[d3.event.clientX,d3.event.clientY];if(3<iD.geo.euclideanDistance(lastMousePos,upPos)){return}if(intersectionTool.shown){var point=drawTool.leftZoomOffset(upPos);intersectionTool.rightClickCoord(d3.event,point);return}var flag=drawTool.domClickBefore(d3.event);if(false==flag){return}clickTimeout.set(function(evt){flag=drawTool.domClick(evt)},d3.event)})}},clearIntersectionHistory:function(){intersectionParamHistory.length=0;var $dom=d3.select("#intersection-history-div");$dom.select("div.history-list").html("");$dom.style("display","none")},clearMark:function(){if(!this._zrender)return;intersectionTool.clearData();this._zrender.clear();d3.select("#showdata").html("").style("display","none")},signMark:function(btn){var $div=$(".markDelete");if($div.is(":hidden")){var pos=$(btn).position();var ppos=$(btn).parent().position();$div.css({bottom:40,left:ppos.left+pos.left,top:"auto"}).show()}else if($div.is(":visible")){$div.hide()}},zoomPic:function(originPic){var self=this;var zoomScale=2;var picdiv=originPic;var picUrl="";if(self.config.picMinGroup){picdiv=originPic.select(".normalPic");var img=picdiv.select("img");picUrl=img.attr("src")}else{picUrl=originPic.select("img").attr("src")}var win=picdiv.node().parentNode;var $win=d3.select(win);if(0<$win.select(".picZoom img").size()){self.updateZoomHtml($win,picUrl);return}self.makeZoomHtml($win,{picUrl:picUrl,zoomScale:zoomScale},initZoom);function initZoom(){var box=$win.select(".picZoom").node();if(!box){return}var img=box.getElementsByTagName("IMG")[0];var picImgDom=win.getElementsByTagName("IMG")[0];var zoomWidth,zoomHeight;var moveListenerFlag=true;win.onmousemove=function(e){if(!moveListenerFlag){return}e=e||window.event;var ori=win.getBoundingClientRect();var x=e.clientX,y=e.clientY;var boxOffsetWidth=box.offsetWidth;var boxOffsetHeight=box.offsetHeight;var z=Math.round((boxOffsetWidth-2)/2);if(x>ori.right+20||y>ori.bottom+20||x<ori.left-20||y<ori.top-20)box.style.display="none";x-=ori.left;y-=ori.top;self.updateZoomImgScale(picImgDom,img);var boxX=x+5;var boxY=y+5;if(boxX>=ori.width-boxOffsetWidth-5){boxX=x-boxOffsetWidth-5}if(boxY>=ori.height-boxOffsetHeight-5){boxY=y-boxOffsetHeight-5}box.style.left=boxX+"px";box.style.top=boxY+"px";zoomWidth=img.width*zoomScale/picImgDom.width;zoomHeight=img.height*zoomScale/picImgDom.height;img.style.left=-x*zoomWidth+z+"px";img.style.top=-y*zoomHeight+z+"px"};win.onmouseover=function(){box.style.display="";moveListenerFlag=true};win.onclick=function(){if(_.include([constant.POINT,constant.POLYLINE,constant.POLYGONE,constant.INTERSECTION],markDrawStatus.type)){if(moveListenerFlag){moveListenerFlag=false}else{moveListenerFlag=true}}};win.onmouseout=function(){if(moveListenerFlag){box.style.display="none"}moveListenerFlag=false}}},makeZoomHtml:function(picdiv,opts,initZoom){var opts=opts||{};var picUrl=parseNewPicUrl(opts.picUrl||"");var zoomScale=opts.zoomScale||1;var $picZoom=picdiv.append("div");var $img=$picZoom.attr("class","picZoom").append("img").attr("src",picUrl||"").attr("zscale",zoomScale).style("transform","scale("+zoomScale+")");$picZoom.selectAll("p.zoom-hr").data(["x","y"]).enter().append("p").attr("class",function(d){return"zoom-hr hr-"+d});$img.on("load",function(){var imgDom=$img.node();$img.attr({pwidth:imgDom.offsetWidth,pheight:imgDom.offsetHeight})});initZoom()},updateZoomImgScale:function(picImg,zoomImg){picImg=picImg&&picImg.node?picImg.node():picImg;zoomImg=zoomImg&&zoomImg.node?zoomImg.node():zoomImg;if(!picImg||!zoomImg){return}var imgscale=picImg.width/picImg.height;var pwidth=zoomImg.getAttribute("pwidth");if(0<pwidth){var newHeight=pwidth/imgscale;zoomImg.style.width=pwidth+"px";zoomImg.style.height=newHeight+"px"}},changePicUrl:function(picurl,direction){var newurl="";if(picurl){newurl=picurl.replace(/(\d{1})\.(png|jpg)/g,function(){return direction+"."+arguments[2]})}return newurl},updatePicplayerImg:function(imgUrl){var self=this;d3.select(".picplayerimg").each(function(d,i){this.src=imgUrl});d3.select(".picZoom img").each(function(d,i){this.src=imgUrl})},initMouseWheelEvent:function(){var self=this;var $picView=self.surface.select("#picplayer-view");$picView.on("mousewheel.changed",function(){var event=_.clone(d3.event,true);Object.defineProperty(event,"toElement",{writable:true});event.toElement=d3.selectAll(".picplayer-mark-canvas canvas").nodes()[1];self._zrender.trigger("mousewheel",event);return})},mouseZoomChange:function(dirnum,leftZoom,rightZoom){var self=this;leftZoom=null==leftZoom?true:leftZoom;rightZoom=null==rightZoom?true:rightZoom;if(!leftZoom&&!rightZoom){return}var vp=viewZoomParam;var $leftRightList=getLeftRightImgCanvasList();var $leftList=$leftRightList.$leftList;function resetDivListStyle(){$leftList.style({position:"",left:0,top:0})}var splitNum=1;if("in"==dirnum){vp.scale=vp.scale+splitNum;resetDivListStyle()}else if("out"==dirnum){vp.scale=vp.scale-splitNum;resetDivListStyle()}else if("reset"==dirnum){vp.scale=vp.min;resetDivListStyle()}else if("number"===typeof dirnum){vp.scale=dirnum}if(vp.scale>vp.max){vp.scale=vp.max;return}else if(vp.scale<vp.min){return;vp.scale=vp.min}self._$zoomScaleNum&&self._$zoomScaleNum.select("span.scale-value").text(Number(vp.scale).toFixed(1))},drawVectorPointShape:function(){var self=this;if(markVectorPoint.loc&&markVectorPoint.loc.length){var result=iD.AutoMatch.locsToPicPlayer([markVectorPoint.loc],self)[0];if(result){let shape=drawTool.createStar(drawTool.transformPoint(result.coordinates[0]),{hoverable:false,draggable:false,style:{lineWidth:3,color:iD.picUtil.colorRGBA(220,20,60,0.8),strokeColor:iD.picUtil.colorRGBA(220,20,60,0.8)}});markVectorPoint.shape=shape;self._zrender.add(shape)}}},updateTrackPoints:function(){if(this.allNodes[0].tags.qualityNum!=undefined){classified=iD.picUtil.trackPointQualityNumber(this.allNodes)}else{classified=iD.picUtil.trackPointClassification(this.allNodes)}},markTrackPointRequest:function(){var trackId=player.pic_point.tags.trackId;var trackPointId=player.pic_point.tags.trackPointId;d3.json(iD.config.URL.krs+"image/mark/save?"+iD.util.parseParam2String({trackId:trackId,trackPointId:trackPointId})).get(function(error,_data){if(error||!_data){Dialog.alert("\u8F68\u8FF9\u70B9\u6807\u8BB0\u51FA\u9519",null,null,null,null,{AutoClose:3});return}if("0"!=_data.code){Dialog.alert(_data.message||"\u8F68\u8FF9\u70B9\u6807\u8BB0\u5931\u8D25",null,null,null,null,{AutoClose:3});return}Dialog.sidebarAlert("\u8F68\u8FF9\u70B9\u6807\u8BB0\u6210\u529F");clearFooterButton()})},_refreshViewTextTag:function(node){var self=player;node=node||self.pic_point;var delFlagNum=node.tags.delFlag;var $markFalse=self.pics.select(".markFalse");if("1"==delFlagNum||"2"==delFlagNum||"3"==delFlagNum){$markFalse.style("display","block");$markFalse.html(playerFooter.getDelFlagText(delFlagNum))}else{$markFalse.style("display","none")}var extent=new iD.geo.Extent(node.loc);var entities=context.intersects(extent);var tagEntities=[];for(var entity of entities){if(entity.modelName==iD.data.DataType.IMAGE_TAG&&node.tags.trackId==entity.tags.TRACKID&&node.tags.trackPointId==entity.tags.TRACKPOINTID){tagEntities.push(entity)}}var $imgMark=self.pics.select(".pic-imagetag-mark").style("display","none").html("");var doms=[];for(var entity of tagEntities){doms.push("\u6807"+(entity.tags.BATCH||" \u539F\u56FE"))}doms.length&&$imgMark.html(_.uniq(doms).reverse().join("<br/>")).style("display","block")},switchPlayerTrackId:function(trackId){var self=this;if(!trackId||self.dataMgr.trackId==trackId){return}if(!_.include(self.dataMgr.trackIds||[],trackId)){Dialog.alert("\u6CA1\u6709\u627E\u5230\u8F68\u8FF9 "+trackId+"\uFF0C\u65E0\u6CD5\u5207\u6362\u8F68\u8FF9");return}clearFooterButton();drawTool.clearZRenderNodeStatus();self.clearMark();this.updateTrackPoints();drawTool.clearVectorPointData();self.picTools.select("select.pic-current-trackid").value(trackId);if(epilineTool){var rtrack=epilineTool.trackObj;var ltrack;self.__tool_switch=true;if(epilineTool.checkBodyShown()&&epilineTool.hasMultiTracks()&&rtrack.trackId===trackId){ltrack=self.dataMgr.trackObj;var rinfo=epilineTool.getMeterStepsNode();var node=rinfo.node;self._locate_point_index=rinfo.index;self.dataMgr.redrawPic(trackId)}else{self.dataMgr.redrawPic(trackId)}epilineTool.refreshTrackInit(ltrack&&ltrack.trackId)}else{self.dataMgr.redrawPic(trackId)}},locateTrackPointToPlayer:function(trackPointId,trackId){var self=this;if(trackId&&!_.include(self.dataMgr.trackIds||[],trackId)){Dialog.alert("\u6CA1\u6709\u627E\u5230\u8F68\u8FF9 "+trackId+"\uFF0C\u65E0\u6CD5\u5B9A\u4F4D");return}if(trackId&&player.dataMgr.tracks&&player.dataMgr.tracks.length){var tracks=player.dataMgr.tracks||[];var flag=false;var track,node;for(track of tracks){if(track.trackId!=trackId)continue;for(var i=0;i<track.nodes.length;i++){node=track.nodes[i];if(node.tags&&node.tags.trackPointId==trackPointId){self._locate_point_index=i;flag=true;break}}}if(!flag){Dialog.alert("\u6CA1\u6709\u627E\u5230\u8F68\u8FF9\u70B9 "+trackPointId+"\uFF0C\u65E0\u6CD5\u5B9A\u4F4D");return}}if(trackId&&self.dataMgr.trackId!=trackId){self.switchPlayerTrackId(trackId);self._locate_point_index=0}else{self.locateFrameByTrackPoint(trackPointId)}},locateFrameByIndex:function(index){var self=this;if(isNaN(index)||self.selectPicIndex==index){return}var $range=self.picTools.select("input.footer-progress-range");$range.value(parseInt(index)).trigger("change")},locateFrameByTrackPoint:function(trackPointId){var self=this,index;for(var i=0;i<self.allNodes.length;i++){var node=self.allNodes[i];if(node.tags.trackPointId==trackPointId){index=i;break}}if(null==index){Dialog.alert("\u6CA1\u6709\u627E\u5230\u8F68\u8FF9\u70B9 "+trackPointId+"\uFF0C\u65E0\u6CD5\u5B9A\u4F4D");return}self.locateFrameByIndex(index)},_buttonKeepClickEvent:function(btn){if(1!=btn.nodeType){return}if(btn.__active){btn.__active=false}else{btn.__active=true}d3.select(btn).classed("active",btn.__active);return btn.__active},_buttonKeepClickAction:function(btn,btnText){var self=this;this.isNewBatch=self._buttonKeepClickEvent(btn);switch(btnText){case"\u6700\u65B0\u6279\u6B21":var currentDiv=self.pics.select("div.item.active");self.updateImgUrl(currentDiv,self.pic_point);break;}},showRightBody:function(){if(epilineTool&&!this.checkRightBodyShown()){clearFooterButton();this.clearLeftEpilineCorss();epilineTool.show();this.picTools.selectAll("button").each(function(){var $this=d3.select(this);if($this.classed("except_action")){return}if($this.classed("epliline_tool_btn")){$this.style("display",null)}else{$this.style("display","none")}})}},hideRightBody:function(){if(epilineTool&&this.checkRightBodyShown()){clearFooterButton();this.clearLeftEpilineCorss();epilineTool.hide();this.picTools.selectAll("button").each(function(){var $this=d3.select(this);if($this.classed("except_action")){return}if($this.classed("epliline_tool_btn")){$this.style("display","none")}else{$this.style("display",null)}})}},clearRightBodyCanvas:function(){if(epilineTool){this.clearLeftEpilineCorss();epilineTool.clearCanvas()}},checkRightBodyShown:function(){return epilineTool&&epilineTool.checkBodyShown()},__leftCrossLines:[],drawRightEpilineCross:function(clickOffset,drawRight=true){if(!epilineTool){return}var self=this;var pointList=iD.picUtil.getCrossLinePointsByTrack(self,clickOffset,self.pics.select(".item.active").node(),self.selectPicIndex);if(pointList&&pointList.length){var polyline=drawTool.createPolyline(pointList,{shape:{lineType:"dashed&solid"},style:{strokeColor:"rgba(0, 187, 255, 0.7)"}});self._zrender.add(polyline);polyline._param={point:clickOffset};self.__leftCrossLines.push(polyline)}if(drawRight){epilineTool.createCanvasPolylineCross(clickOffset,{lineType:"dashed&solid"})}},refreshLeftEpilineCross:function(){var self=this;if(!epilineTool||!self.__leftCrossLines){return}var lines=_.clone(self.__leftCrossLines);self.clearLeftEpilineCorss();lines.forEach(d=>{self.drawRightEpilineCross(d._param.point,false)})},clearLeftEpilineCorss:function(){var self=this;if(!epilineTool||!self.__leftCrossLines){return}self.__leftCrossLines.forEach(shape=>{self._zrender.remove(shape)});self.__leftCrossLines.length=0;self.__leftCrossLines=[]},getCameraHeight:function(){var self=this;var result;if(self.wayInfo){result=self.wayInfo.cameraHeight}if(!result&&self.dataMgr&&self.dataMgr.trackObj){result=self.dataMgr.trackObj.cameraHeight}return result},getIntersectionData:function(){return intersectionTool.getIntersectionData()},getPicUrlParam:function(){return picUrlParam},resetCanvas:function(){return drawTool.resetCanvas()},_zrenderEntityHover:function(){return drawTool._zrenderEntityHover.apply(this,_.toArray(arguments))},reductionPoint:function(){return drawTool.reductionPoint.apply(drawTool,_.toArray(arguments))},leftZoomOffset:function(){return drawTool.leftZoomOffset.apply(drawTool,_.toArray(arguments))},transformPoint:function(){return drawTool.transformPoint.apply(drawTool,_.toArray(arguments))},getZRenderLayer:function(){return drawTool.getZRenderLayer.apply(drawTool,_.toArray(arguments))},resetPointToPicPlayer:function(){return drawTool.resetPointToPicPlayer.apply(drawTool,_.toArray(arguments))},clearFooterButton:clearFooterButton,hideRightPic:hideRightPic,getDrawTool:function(){return drawTool},getPlayerFooter:function(){return playerFooter},getEpilineTool:function(){return epilineTool}});function getLeftRightImgCanvasList(){return{$leftList:player.picBox.selectAll("div.item,div#picplayer-mark-canvas")}}function _eachAttrWH(type){var fbigType=type.replace(/^./,type.charAt(0).toUpperCase());return function(){var dattr=this.getAttribute("d-"+type);if(!dattr){dattr=this["client"+fbigType]}return dattr}}function _domIsHidden(elem){if(elem.node){elem=elem.node()}var display=elem.style.display;if(getComputedStyle){display=getComputedStyle(elem).display}return 0>=elem.offsetWidth&&0>=elem.offsetHeight||"none"==display}player=d3.rebind(new picPlayer,dispatch,"on");drawTool.init(player,intersectionTool);playerFooter.init(player,drawTool);intersectionTool.init(player,drawTool);player.ZEUtil=drawTool.ZEUtil;window.drawTool=drawTool;iD.picUtil.player=player;iD.picUtil.context=context;return player};;;iD.svg.Pic=function(proj,context){var picPlayer=null,playableModeIds=["browse","pic_play"],dispatch=d3.dispatch("playerTimeupdate"),drawnPoint,_tracks=[],trackIndex=-1;_trackPointRel=null,width=0,height=0,oldZoom=null,oldCenter=null;flattenArr=arr=>arr.reduce((begin,current)=>{Array.isArray(current)?begin.push(...flattenArr(current)):begin.push(current);return begin},[]);var isFirstLocate=false,firstLocate;var locate=iD.url.getUrlParam("locate");if(locate){locate=locate.split(",").map(v=>Number(v.trim()))}if(locate.length&&!isNaN(locate[0])&&!isNaN(locate[1])){firstLocate=locate;isFirstLocate=true}var img=new Image;img.src=context.imagePath("dvr_cursor.png");var startImg=new Image;startImg.src=context.imagePath("start.png");var endImg=new Image;endImg.src=context.imagePath("end.png");let $lineCanvas,$trackCanvas,$anchorCanvas,$arrowCanvas,lineCanvas,trackCanvas,anchorCanvas,arrowCanvas;var __prevTaskId;var canvasWork;var _r=5;var _rr=3;var _w=9;var goodCacheCanvas=document.createElement("canvas");var goodCacheCtx=goodCacheCanvas.getContext("2d");goodCacheCtx.width=_w;goodCacheCtx.height=_w;goodCacheCtx.save();goodCacheCtx.fillStyle="green";goodCacheCtx.lineWidth=2;goodCacheCtx.beginPath();goodCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);goodCacheCtx.fill();goodCacheCtx.restore();var badSpotsCacheCanvas=document.createElement("canvas");var badSpotsCacheCtx=badSpotsCacheCanvas.getContext("2d");badSpotsCacheCtx.width=_w;badSpotsCacheCtx.height=_w;badSpotsCacheCtx.save();badSpotsCacheCtx.fillStyle="red";badSpotsCacheCtx.lineWidth=2;badSpotsCacheCtx.beginPath();badSpotsCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);badSpotsCacheCtx.fill();badSpotsCacheCtx.restore();var acceptableCacheCanvas=document.createElement("canvas");var acceptableCacheCtx=acceptableCacheCanvas.getContext("2d");acceptableCacheCtx.width=_w;acceptableCacheCtx.height=_w;acceptableCacheCtx.save();acceptableCacheCtx.lineWidth=2;acceptableCacheCtx.fillStyle="yellow";acceptableCacheCtx.beginPath();acceptableCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);acceptableCacheCtx.fill();acceptableCacheCtx.restore();var greenCacheCanvas=document.createElement("canvas");var greenCacheCtx=greenCacheCanvas.getContext("2d");greenCacheCtx.width=_w;greenCacheCtx.height=_w;greenCacheCtx.save();greenCacheCtx.lineWidth=2;greenCacheCtx.fillStyle="green";greenCacheCtx.beginPath();greenCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);greenCacheCtx.fill();greenCacheCtx.restore();var cyanCacheCanvas=document.createElement("canvas");var cyanCacheCtx=cyanCacheCanvas.getContext("2d");cyanCacheCtx.width=_w;cyanCacheCtx.height=_w;cyanCacheCtx.save();cyanCacheCtx.lineWidth=2;cyanCacheCtx.fillStyle="Cyan";cyanCacheCtx.beginPath();cyanCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);cyanCacheCtx.fill();cyanCacheCtx.restore();var blueCacheCanvas=document.createElement("canvas");var blueCacheCtx=blueCacheCanvas.getContext("2d");blueCacheCtx.width=_w;blueCacheCtx.height=_w;blueCacheCtx.save();blueCacheCtx.lineWidth=2;blueCacheCtx.fillStyle="blue";blueCacheCtx.beginPath();blueCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);blueCacheCtx.fill();blueCacheCtx.restore();var purpleCacheCanvas=document.createElement("canvas");var purpleCacheCtx=purpleCacheCanvas.getContext("2d");purpleCacheCtx.width=_w;purpleCacheCtx.height=_w;purpleCacheCtx.save();purpleCacheCtx.lineWidth=2;purpleCacheCtx.fillStyle="purple";purpleCacheCtx.beginPath();purpleCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);purpleCacheCtx.fill();purpleCacheCtx.restore();var magentaCacheCanvas=document.createElement("canvas");var magentaCacheCtx=magentaCacheCanvas.getContext("2d");magentaCacheCtx.width=_w;magentaCacheCtx.height=_w;magentaCacheCtx.save();magentaCacheCtx.lineWidth=2;magentaCacheCtx.fillStyle="magenta";magentaCacheCtx.beginPath();magentaCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);magentaCacheCtx.fill();magentaCacheCtx.restore();var redCacheCanvas=document.createElement("canvas");var redCacheCtx=redCacheCanvas.getContext("2d");redCacheCtx.width=_w;redCacheCtx.height=_w;redCacheCtx.save();redCacheCtx.lineWidth=2;redCacheCtx.fillStyle="red";redCacheCtx.beginPath();redCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);redCacheCtx.fill();redCacheCtx.restore();var otherCacheCanvas=document.createElement("canvas");var otherCacheCtx=otherCacheCanvas.getContext("2d");otherCacheCtx.width=_w;otherCacheCtx.height=_w;otherCacheCtx.save();otherCacheCtx.lineWidth=2;otherCacheCtx.fillStyle="grey";otherCacheCtx.beginPath();otherCacheCtx.arc(_r,_r,_rr,0,2*Math.PI);otherCacheCtx.fill();otherCacheCtx.restore();function destroyPlayer(){if(!picPlayer){return}picPlayer.destory();picPlayer=null;__prevTaskId=undefined}function initDvrPlayer(context){if(picPlayer){return}oldCenter=context.map().center();oldZoom=context.map().zoom();picPlayer=new iD.svg.PicPlayer(context);picPlayer.init(context.container());picPlayer.on("close.player",function(){destroyPlayer()});picPlayer.on("picUpdate",function(updaeNodeid){drawnPoint=updaeNodeid;var loc=drawnPoint.loc;if(isFirstLocate){loc=firstLocate}updateMapPos(loc,true);dispatch.playerTimeupdate(updaeNodeid)});context.map().on("drawn.pic",redrawCanvas).on("zoom.pic",redrawCanvas);function redrawCanvas(){let isEqual=true,newCenter=context.map().center(),newZoom=context.map().zoom();if(oldCenter&&oldCenter[0]==newCenter[0]&&oldCenter[1]==newCenter[1]&&oldZoom==newZoom){isEqual=false}else{oldCenter=newCenter;oldZoom=newZoom}if(picPlayer&&picPlayer.pic_point&&_trackPointRel&&isEqual){clearCanvas();drawPic(_trackPointRel,picPlayer.pic_point)}}var clickTimeId;let surface=context.surface();surface.on("mousedown.pic-canvas",function(d){var lastMousePos=[d3.event.offsetX,d3.event.offsetY];var lastMouseTarget=d3.event.target;if(lastMouseTarget==this){}surface.on("mouseup.pic-canvas",function(d){if(lastMouseTarget==this){}var upPos=[d3.event.offsetX,d3.event.offsetY];if(d3.event.target===lastMouseTarget&&5>iD.geo.euclideanDistance(lastMousePos,upPos)){var targetEvent=d3.event;if(clickTimeId){clearTimeout(clickTimeId)}clickTimeId=setTimeout(function(){clickTimeId=null;var oldEvent=d3.event;d3.event=targetEvent;if(context.variable.altKeyDown){resetLoc()}d3.event=oldEvent;targetEvent=null},250)}lastMousePos=null;lastMouseTarget=null;surface.on("mouseup.pic-canvas",null)})}).on("mousemove.pic-canvas",function(){var lastMouseTarget=d3.event.target;if(lastMouseTarget==this){}})}function resetLoc(){var allNodes=[];if(picPlayer){allNodes=_.compact(_.flatten(_.pluck(picPlayer.dataMgr.tracks||[],"nodes")));if(!allNodes.length){allNodes=picPlayer.allNodes||[]}}if(!allNodes.length){console.log("\u8F68\u8FF9\u4E2D\u6CA1\u6709\u5BF9\u5E94\u6570\u636E\uFF01");return}var loc=editor.context.map().mouseCoordinates();var line=_.pluck(allNodes,"loc");var dist=iD.util.pt2LineDist2(line,loc);var result=getNearestNode([allNodes[dist.i],allNodes[dist.i+1]],loc);var node=result.node;if(node&&12>=result.dist){picPlayer.locateTrackPointToPlayer(node.tags.trackPointId,node.tags.trackId)}}function getNearestNode(nodes,loc){var projection=context.projection;var p=projection(loc);var result={i:-1,node:null,dist:null};var idx=0;for(var node of nodes){var np=projection(node.loc);var xs=[np[0],p[0]],ys=[np[1],p[1]],minX=_.min(xs),maxX=_.max(xs),minY=_.min(ys),maxY=_.max(ys);var a=maxX-minX,b=maxY-minY,dist=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));if(0==idx){result.dist=dist;result.node=node;result.i=idx};if(result.dist>dist){result.dist=dist;result.node=node;result.i=idx}idx++}return result}function updateTimePoint(point){if(!point){return}drawTimePoint(point)}var updateMapPos=_.throttle(function(loc,isPan=false){if(!isPan){return}isFirstLocate=false;var map=context.map(),projection=context.projection;var pos=projection(loc),dimensions=map.dimensions(),panOffset=[0,0],bounds={left:40,right:Math.max(dimensions[0]-100,200),top:70,bottom:Math.max(dimensions[1]-100,200)},buffPan=[370,500];if(pos[0]<bounds.left){panOffset[0]=bounds.left-pos[0]+buffPan[0]}else if(pos[0]>bounds.right){panOffset[0]=bounds.right-pos[0]-buffPan[0]}if(pos[1]<bounds.top){panOffset[1]=bounds.top-pos[1]+buffPan[1]}else if(pos[1]>bounds.bottom){panOffset[1]=bounds.bottom-pos[1]-buffPan[1]}if((0!==panOffset[0]||0!==panOffset[1])&&isPan){map.center(loc)}},500,{leading:false,trailing:true});function drawTimePoint(point,isPan=false){anchorCanvas.clearRect(0,0,width,height);point&&trackAnchor(anchorCanvas,[point])}function redrawDvr(trackObj,tI,isFirst){if(!trackObj){return}trackIndex=tI;if(0>playableModeIds.indexOf(context.mode().id)){iD.svg.Pic.dataMgr.selectedIDs([])}initDvrPlayer(context);picPlayer.init(context.container());picPlayer.renderPicPlayer(trackObj,trackObj.nodes[0].id).show();dispatch.on("playerTimeupdate",function(point){drawnPoint=point;updateTimePoint(point)});drawArrowAandAnchor();if(trackObj.selectPoint){drawnPoint=trackObj.selectPoint}}function dvrRender(surface,opts){initContainer();if(!iD.Task.d){return}if(opts.event&&opts.event.difference){return}};function loc2PixCoords(nodes){let pixCoords=[],loc;for(let i=0,il=nodes.length;i<il;i++){loc=nodes[i].loc;pixCoords.push(context.projection(loc))}return pixCoords}function drawPic(points,anchorPoint){trackPoint(trackCanvas,points);drawArrowAandAnchor(anchorPoint)}function drawArrowAandAnchor(anchorPoint){let nodes=_tracks[trackIndex].nodes;trackArrow(arrowCanvas,[nodes[0],nodes[nodes.length-1]]);if(anchorPoint){trackAnchor(anchorCanvas,[anchorPoint])}}function clearCanvas(){let surface=d3.selectAll("#surfaceCanvas").node();let width=surface.clientWidth,height=surface.clientHeight;$lineCanvas.width=width;$trackCanvas.width=width;$anchorCanvas.width=width;$arrowCanvas.width=width}function resetSize(){let surface=d3.selectAll("#surfaceCanvas").node();height=surface.clientHeight;width=surface.clientWidth;$lineCanvas.width=width;$lineCanvas.height=height;$trackCanvas.width=surface.clientWidth;$trackCanvas.height=surface.clientHeight;$anchorCanvas.width=surface.clientWidth;$anchorCanvas.height=surface.clientHeight;$arrowCanvas.width=surface.clientWidth;$arrowCanvas.height=surface.clientHeight;_trackPointRel&&drawPic(_trackPointRel,drawnPoint);drawTimePoint(drawnPoint)}function trackAnchor(cxt,points){let pixPoints=loc2PixCoords(points);cxt.drawImage(img,pixPoints[0][0]-11,pixPoints[0][1]-30)}function trackArrow(cxt,points){arrowCanvas.clearRect(0,0,width,height);let pixPoints=loc2PixCoords(points);cxt.drawImage(startImg,pixPoints[0][0]-10,pixPoints[0][1]-28);cxt.drawImage(endImg,pixPoints[1][0]-10,pixPoints[1][1]-28)}function trackPoint(cxt,points){let bounds=[[0,0],context.map().dimensions()];let pointClassification=points;var node;var loc,x,y;if(pointClassification.goodPoints){var goodPix=loc2PixCoords(pointClassification.goodPoints);for(let i=0,l=goodPix.length;i<l;i++){node=goodPix[i];if(!iD.util.isInsideRect(bounds,node)){continue}cxt.drawImage(goodCacheCanvas,node[0]-_r,node[1]-_r)}var badSpotsPix=loc2PixCoords(pointClassification.badSpots);for(let i=0,l=badSpotsPix.length;i<l;i++){node=badSpotsPix[i];if(!iD.util.isInsideRect(bounds,node)){continue}cxt.drawImage(badSpotsCacheCanvas,node[0]-_r,node[1]-_r)}var acceptablePixs=loc2PixCoords(pointClassification.acceptables);for(let j=0,jl=acceptablePixs.length;j<jl;j++){node=acceptablePixs[j];cxt.drawImage(acceptableCacheCanvas,node[0]-_r,node[1]-_r)}}else{var greenPix=loc2PixCoords(pointClassification.greenPoints);for(let i=0,l=greenPix.length;i<l;i++){node=greenPix[i];if(!iD.util.isInsideRect(bounds,node)){continue}cxt.drawImage(greenCacheCanvas,node[0]-_r,node[1]-_r)}var cyanPix=loc2PixCoords(pointClassification.cyanPoints);for(let i=0,l=cyanPix.length;i<l;i++){node=cyanPix[i];if(!iD.util.isInsideRect(bounds,node)){continue}cxt.drawImage(cyanCacheCanvas,node[0]-_r,node[1]-_r)}var bluePixs=loc2PixCoords(pointClassification.bluePoints);for(let j=0,jl=bluePixs.length;j<jl;j++){node=bluePixs[j];cxt.drawImage(blueCacheCanvas,node[0]-_r,node[1]-_r)}var purplePixs=loc2PixCoords(pointClassification.purplePoints);for(let j=0,jl=purplePixs.length;j<jl;j++){node=purplePixs[j];cxt.drawImage(purpleCacheCanvas,node[0]-_r,node[1]-_r)}var magentaPixs=loc2PixCoords(pointClassification.magentaPoints);for(let j=0,jl=magentaPixs.length;j<jl;j++){node=magentaPixs[j];cxt.drawImage(magentaCacheCanvas,node[0]-_r,node[1]-_r)}var redPixs=loc2PixCoords(pointClassification.redPoints);for(let j=0,jl=redPixs.length;j<jl;j++){node=redPixs[j];cxt.drawImage(redCacheCanvas,node[0]-_r,node[1]-_r)}var otherPixs=loc2PixCoords(pointClassification.otherPoints);for(let j=0,jl=otherPixs.length;j<jl;j++){node=otherPixs[j];cxt.drawImage(otherCacheCanvas,node[0]-_r,node[1]-_r)}}}function initContainer(){let container=d3.selectAll("#surfaceCanvas");container.append("canvas").attr("id","pic-line-canvas").attr("style","width:100%;height:100%;position: absolute;");container.append("canvas").attr("id","pic-track-canvas").attr("style","width:100%;height:100%;position: absolute;");container.append("canvas").attr("id","pic-arrow-canvas").attr("style","width:100%;height:100%;position: absolute;");container.append("canvas").attr("id","pic-anchor-canvas").attr("style","width:100%;height:100%;position: absolute;");$lineCanvas=container.select("#pic-line-canvas").node();lineCanvas=$lineCanvas.getContext("2d");$lineCanvas.width=$lineCanvas.clientWidth;$lineCanvas.height=$lineCanvas.clientHeight;$trackCanvas=container.select("#pic-track-canvas").node();trackCanvas=$trackCanvas.getContext("2d");$trackCanvas.width=$trackCanvas.clientWidth;$trackCanvas.height=$trackCanvas.clientHeight;$anchorCanvas=container.select("#pic-anchor-canvas").node();anchorCanvas=$anchorCanvas.getContext("2d");$anchorCanvas.width=$anchorCanvas.clientWidth;$anchorCanvas.height=$anchorCanvas.clientHeight;$arrowCanvas=container.select("#pic-arrow-canvas").node();arrowCanvas=$arrowCanvas.getContext("2d");$arrowCanvas.width=$arrowCanvas.clientWidth;$arrowCanvas.height=$arrowCanvas.clintHeight}d3.select(window).on("resize.picCanvas",function(){resetSize()});dvrRender.getTrackPointRel=function(){return _trackPointRel};dvrRender.redrawPic=redrawDvr;dvrRender.drawPic=drawPic;dvrRender.getPicPlayer=function(){return picPlayer};dvrRender.clearCanvas=clearCanvas;dvrRender.resetSize=resetSize;dvrRender.setTracks=function(_){if(_==_tracks){return}_tracks=_;canvasWork=new Worker("./svg/pic_canvas_work.js");canvasWork.postMessage(_tracks);canvasWork.onmessage=function(event){_trackPointRel=event.data;drawPic(event.data);canvasWork.terminate()}};return dvrRender};;;onmessage=function(context,mes){var points=context.data;if(points[0]instanceof Array){var pointClassification=trackPointRel(flattenArr(points))}else{var pointClassification=trackPointRel(points)}postMessage(pointClassification)};flattenArr=arr=>arr.reduce((begin,current)=>{Array.isArray(current)?begin.push(...flattenArr(current)):begin.push(current);return begin},[]);function sortY(a,b){return a.index||b.loc[1]-a.loc[1]}function trackPointRel(points){if(points[0].nodes[0].tags.qualityNum!=undefined){var result=trackPointQualityNumber(points);return{greenPoints:result.greenPoints,cyanPoints:result.cyanPoints,bluePoints:result.bluePoints,purplePoints:result.purplePoints,magentaPoints:result.magentaPoints,redPoints:result.redPoints,otherPoints:result.otherPoints}}else{var result=trackPointClassification(points);return{badSpots:result.badPoints,acceptables:result.acceptPoints,goodPoints:flattenArr(result.goodPoints)}}}function trackPointQualityNumber(points){let greenPoints=[],cyanPoints=[],bluePoints=[],purplePoints=[],magentaPoints=[],redPoints=[],otherPoints=[],node,nodes,qualityNum;for(let i=0;i<points.length;i++){nodes=points[i].nodes;for(let j=0;j<nodes.length;j++){node=nodes[j];qualityNum=node.tags.qualityNum||-1;if(qualityNum){if(1==qualityNum){greenPoints.push(node)}else if(2==qualityNum){cyanPoints.push(node)}else if(3==qualityNum){bluePoints.push(node)}else if(4==qualityNum){purplePoints.push(node)}else if(5==qualityNum){magentaPoints.push(node)}else if(6==qualityNum){redPoints.push(node)}else{otherPoints.push(node)}}}}return{greenPoints:greenPoints,cyanPoints:cyanPoints,bluePoints:bluePoints,purplePoints:purplePoints,magentaPoints:magentaPoints,redPoints:redPoints,otherPoints:otherPoints}}function trackPointClassification(points){points=points;let badPoints=[],badMap={};let goodPoints=[],goodMap={};let acceptPoints=[],acceptMap={};let node;let tempbadPoints=[];let startNode=points[0].nodes[0];let _tempArr=[];function pushArr(_tempArr,node){if(node.tags&&"3"==node.tags.status.toString()&&"50"==node.tags.positionType.toString()){goodPoints.push(_tempArr);goodMap[node.id]=true}else{tempbadPoints.push(_tempArr)}}function isGoodPoint(node){return"3"==node.tags.status.toString()&&"50"==node.tags.positionType.toString()}for(let i=0,l=points.length;i<l;i++){var nodes=points[i].nodes;for(let j=0;j<nodes.length;j++){node=nodes[j];if(node.tags&&isGoodPoint(node)==isGoodPoint(startNode)){_tempArr.push(node)}else{pushArr(_tempArr,startNode);_tempArr=[];startNode=node;_tempArr.push(startNode)}}}pushArr(_tempArr,_tempArr[0]);var _tempNodes=[];for(let i=0,l=tempbadPoints.length;i<l;i++){_tempNodes=tempbadPoints[i];startNode=_tempNodes[0];for(let j=0,jl=_tempNodes.length;j<jl;j++){node=_tempNodes[j];if(10000<node.tags.locTime-startNode.tags.locTime){badPoints.push(node);badMap[node.id]=true}else{acceptPoints.push(node);acceptMap[node.id]=true}}}badPoints=badPoints.sort(sortY);acceptPoints=acceptPoints.sort(sortY);goodPoints=flattenArr(goodPoints);return{badPoints,acceptPoints,goodPoints,badMap,goodMap,acceptMap}};;iD.svg.Pic.dataMgr=function(){var mgrEvent=d3.dispatch("loading","loaded");function DataMgr(){this.tracks=[];this.pic=null;this.context=null;this.planes=null;this.planeFrames=null;this.identifyData={}}_.assign(DataMgr.prototype,{initPic:function(context){if(_.isNull(this.pic)){this.pic=iD.svg.Pic(context.projection,context)}let surface=context.surface();let args=[surface];this.pic.apply(surface,args)},setContext:function(context){if(this.context===context){return}this.context=context;this.initPic(context);var self=this;context.ui().layermanager.on("pic",function(taskObj,display){if(!iD.User.authTrail()||!iD.User.authTrailPicture()){return}if(!display){self.clearData(null);d3.select(".pic_cursor").remove();return}else if(taskObj){var _trackIds=[];if(taskObj.tags.trackIds){_trackIds=taskObj.tags.trackIds.split(",")}self.trackIds=_trackIds;self.promiseTaskData=function(dataurl){return new Promise((resolve,reject)=>{mgrEvent.loading();d3.jsonp(dataurl,result=>{mgrEvent.loaded();if(!result||!result.result){changePicPlayerDisplay(false);Dialog.alert("\u8F68\u8FF9\u52A0\u8F7D\u5931\u8D25<br/>"+(result&&result.message||""));return}let trackObj,trackPoints,K;for(var i=0;i<result.result.length;i++){trackPoints=self.buildTaskData(result.result[i].pointList);cameraParams=result.result[i].cameraParams;cameraHeight=result.result[i].cameraHeight;if(!trackPoints||!trackPoints.length){continue}K=[[cameraParams.focusX,0,cameraParams.principlePointX],[0,cameraParams.focusY,cameraParams.principlePointY],[0,0,1]];trackObj={nodeId:trackPoints[0].id,nodes:trackPoints,K,cameraParams:result.result[i].cameraParams,cameraHeight:result.result[i].cameraHeight,deviceId:result.result[i].deviceId,trackId:result.result[i].trackId};var s=d3.$("#KDSEditor-bar button.save");if(!trackObj.cameraHeight){trackObj.cameraHeight=1.77;if(6!=window._systemType&&7!=window._systemType){Dialog.alert("\u83B7\u53D6\u8F66\u8F86\u9AD8\u5EA6\u5931\u8D25\uFF0C\u5C06\u7981\u6B62\u4FDD\u5B58\u6570\u636E\uFF01<br/>");s.style("visibility","hidden")}}else{s.style("visibility","visible")}self.tracks.push(trackObj)}if(self.trackIds.length!=self.tracks.length){Dialog.alert("\u8F68\u8FF9\u4E2D\u6CA1\u6709\u8F68\u8FF9\u70B9\u3002<br/>"+_.difference(self.trackIds,_.pluck(self.tracks,"trackId")).join("<br/>"))}resolve(self.tracks[0])})})};self.tracks=[];self.planes=null;self.promisePlane=function(planURL){return new Promise((resolve,reject)=>{d3.json(planURL,result=>{if(!result||!result.result){resolve(null);return}let data=result.result;let planeFrame,pfs;pfs=new Map;for(taskId in data){planeFrame=data[taskId];planeFrame.map(function(d){d.groundHeights=JSON.parse(d.groundHeights);d.frameId=d.groundHeights.frameId});pfs.set(taskId,planeFrame)}resolve(pfs)})})};var param1={callback:"{callback}",trackIds:self.trackIds};var dataurl=iD.config.URL.krs+"track/get/tracks/byTrackIds?"+iD.util.parseParam2String(param1);if(7==iD.util.urlParamSystemType()){dataurl+="&dynamicCal=false"}let planURL=iD.config.URL.krs+"track/point/extend/tracks/"+self.trackIds;self.promiseTaskData(dataurl).then(function(_track){self.promisePlane(planURL).then(function(d){self.planeFrames=d;self.promiseComplete(_track);self.resetData()})});self.promiseComplete=function(_track){if(!_track||!_track.nodes.length){self.clearData(null);changePicPlayerDisplay(false);return}if(_track.nodes.length){self.pic.setTracks(self.tracks);self.redrawPic(self.tracks[0]&&self.tracks[0].trackId||self.trackIds[0]);changePicPlayerDisplay(true);self.pic.resetSize()}}}});context.ui().layermanager.on("change.pic",function(layerInfo,flag){if(!layerInfo||"pic"!=layerInfo.type){return}if(layerInfo.editable){self.movePicLayerToFirst&&self.movePicLayerToFirst()}else{self.movePicLayerAfterDvr&&self.movePicLayerAfterDvr()}})},resetPlanes:function(index){if(this.planes){this.planes.pix_y_planes.clear();this.planes=null}if(!this.planeFrames||!this.planeFrames.size){this.planes=null;return}let nodes=this.trackObj.nodes,map=new Map,cameraParams=this.trackObj.cameraParams,k=[[cameraParams.focusX,0,cameraParams.principlePointX],[0,cameraParams.focusY,cameraParams.principlePointY],[0,0,1]];let pf=this.planeFrames.get(this.trackId);if(!pf){this.planes=null;return}let plane={frameId:index+1,pix_y_planes:new Map};iD.util.processGroundPlaneFrame(plane,k,nodes,pf);this.planes=plane},resetData:function(){if(!this.planeFrames||!this.planeFrames.size){this.planes=null;return}let nodes=this.trackObj.nodes,map=new Map,pf=this.planeFrames.get(this.trackId);if(!pf){this.planes=null;return}var node,param,firstNode,obj;for(var i=0;i<nodes.length;i++){node=nodes[i];param={x:node.tags.x,y:node.tags.y,roll:node.tags.roll,pitch:node.tags.pitch,azimuth:node.tags.azimut};var offsetData=_.find(pf,{trackPointId:node.id});if(offsetData){var loc=node.loc;var position=node.tags.position;var coordinate=node.tags.coordinate;loc[0]+=offsetData.xDelta;loc[1]+=offsetData.yDelta;loc[2]+=offsetData.zDelta;position.longitude+=offsetData.xDelta;position.latitude+=offsetData.yDelta;position.height+=offsetData.zDelta;coordinate.x+=offsetData.xDelta;coordinate.y+=offsetData.yDelta;coordinate.z+=offsetData.zDelta;node.tags.x+=offsetData.xDelta;node.tags.y+=offsetData.yDelta;node.tags.z+=offsetData.zDelta}if(0==i){firstNode=nodes[i];obj=iD.util.pos2CameraRTC(param,firstNode.tags,node.tags.z);node.tags.R=obj.R;node.tags.C=obj.C;node.tags.T=obj.T}else{obj=iD.util.pos2CameraRTC(param,firstNode.tags,node.tags.z);node.tags.R=obj.R;node.tags.C=obj.C;node.tags.T=obj.T}}},redrawPic:function(currentId,callback){var self=this;var tracks=self.tracks;var index=_.pluck(tracks,"trackId").indexOf(currentId);var _track=tracks[index];if(!_track){Dialog.alert("\u9009\u62E9\u8F68\u8FF9\u4E0D\u5728\u6570\u636E\u96C6\u4E2D\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9\uFF01");return}self.trackObj=_track;if(_track.trackId!=self.trackId||!self.trackId){self.trackId=_track.trackId}_track=tracks[index];self.pic&&self.pic.redrawPic(_track,index,true);callback&&callback(_track)},clearData:function(_){this.selectedIDs(null);if(this.renderDvrSurface){this.renderDvrSurface({trigger:"data.renew"})}},selectedIDs:function(ids){if(!arguments.length)return this._selectedIDs;this._selectedIDs=ids},mousePos:function(mouse){if(!arguments.length)return this._mousePos;this._mousePos=mouse},simpleTaskCoords:function(coordstr){var locArray=/(POINT\s*)\((.*)(\))/.exec(coordstr);if(locArray){var coords=locArray[2].split(" ")}else{}var newCoords=[];newCoords.push(parseFloat(coords[0]).toFixed(6),parseFloat(coords[1]).toFixed(6));return newCoords},trackId2Track:function(trackId){if(!this.tracks.length)return false;for(let i=0;i<this.tracks.length;i++){if(trackId==this.tracks[i].trackId){return this.tracks[i]}}return false},pointId2Track:function(pointId){if(!this.tracks.length)return[];let nodes,node;for(let i=0;i<this.tracks.length;i++){nodes=this.tracks[i].nodes;for(let j=0;j<nodes.length;j++){node=nodes[j];if(pointId==node.id){return this.tracks[i]}}}return[]},getTrack:function(trackid){var tracks=this.tracks||[];var track;for(let d of tracks){if(d&&d.trackId==trackid){track=d;break}}return track},buildTaskData:function(result){if(!result||0==result.length){return[]}var tList=result;if(!tList||!tList.length){return[]}var traceList=[];for(var i=0,len=tList.length;i<len;i++){var tmpTrace=tList[i];tmpTrace.picUrl=iD.config.URL.track_image+"image/get?trackPointId="+tmpTrace.trackPointId+"&type=00&seq=000&imageType=jpg";var node={id:tmpTrace.trackPointId,loc:[tmpTrace.x,tmpTrace.y,tmpTrace.z],tags:tmpTrace};traceList.push(node)}return traceList}});let picDataMgr=new DataMgr;function changePicPlayerDisplay(show){var classList=["layout-5_5","layout-6_4","layout-7_3"];var classedList=[false,false,false];var $allWrap=d3.select("#KDSEditor-all-wrap");if(show){for(var i=0;i<classList.length;i++){var name=classList[i];if($allWrap.classed(name)){classedList[i]=true;break}}if(!_.compact(classedList).length){classedList[1]=true}$allWrap.classed(_.zipObject(classList,classedList));d3.select("#KDSEditor-picplayer").style("display","block");$("#KDSEditor-content #_link_compare_recog").show();d3.select(".pic-player-shadow").style("display","none");d3.select("div.background-container .item-pic").classed("hide",false);d3.select(window).trigger("resize")}else{$allWrap.classed(_.zipObject(classList,classedList));d3.select("#KDSEditor-picplayer").style("display","none");$("#KDSEditor-content #_link_compare_recog").hide();d3.select(".pic-player-shadow").style("display","none");d3.select("div.background-container .item-pic").classed("hide",true);d3.select(window).trigger("resize")}}return d3.rebind(picDataMgr,mgrEvent,"on")}();;;iD.svg.RoadCrossLine=function(projection,context){function drawRoadCrossLine(surface,graph,entities,filter){var layers=iD.Layers;var currentLayer=layers.getLayer();var getPath=iD.svg.Path(projection,graph);var layergroup=surface.select(".layer-roadcrossline");var linegroup=layergroup.selectAll("g").data(["shadow","casing","stroke"]);linegroup.enter().append("g").attr("class",function(d){return"layer roadcrossline-"+d});var lines=linegroup.selectAll("path").filter(filter).data(function(){return entities||[]},iD.Entity.key);lines.enter().append("path");lines.attr("d",getPath).attr("style",function(d){return"stroke:red;stroke-width:1;stroke-dasharray: 2,2;"});lines.exit().remove()}drawRoadCrossLine.available=function(points){var layerInfo=points[0]&&iD.Layers.getLayer(points[0].layerId);if(layerInfo){var entType=points[0].modelName||points[0]._type,sublayer=layerInfo.getSubLayerByType(entType);return sublayer&&sublayer.display}return false};drawRoadCrossLine.roadcrossline=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.isRoadCross&&entity.isRoadCross()){points.push(entity);if(limit&&points.length>=limit)break}}if(this.available(points))return points;return[]};return drawRoadCrossLine};;;iD.svg.RoadCross=function(projection,context){function markerPath(selection,klass){if("shadow"===klass||"stroke"===klass){selection.attr("class",klass).attr("transform","translate(-35, -50)").attr("d","M 35,37.5 L 37.9,46.1 L 46.9,46.1 L 39.7,51.5 L 42.3,60.1 L 35,55 L 27.7,60.1 L 30.3,51.5 L 23.1,46.1 L 32.1,46.1 z");selection.each(function(entity){if("stroke"===klass)this.style.fill="#ff0000"})}else if("image"===klass){selection.attr({x:-12,y:-12,width:25,height:25}).attr("xlink:href",function(d){if(d.isRoadCross())return context.imagePath("roadcross.png")})}}function sortY(a,b){return b.loc[1]-a.loc[1]}function drawRoadCross(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-roadcross").selectAll("g.point");groups=groups.filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point crosspoint "+d.id}).order();group.append("path").call(markerPath,"shadow");group.append("path").call(markerPath,"stroke");group.append("use").attr("class","KDSEditor-icon").attr("transform","translate(-6, -20)").attr("clip-path","url(#clip-square-12)");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.select(".shadow");groups.select(".stroke");groups.select(".KDSEditor-icon").attr("xlink:href",function(entity){var preset=context.presets().match(entity,context.graph());return preset.icon?"#maki-"+preset.icon+"-12":""});groups.classed("point-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});groups.exit().remove()}drawRoadCross.available=function(points){return true};drawRoadCross.roadcross=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.isRoadCross&&entity.isRoadCross()){points.push(entity);if(limit&&points.length>=limit)break}}if(this.available(points))return points;return[]};return drawRoadCross};;;iD.svg.RoadZLevel=function(projection,context){function getAttitudeD(){var round=iD.svg.Round().stream,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return project(clip(round(output)))}}),json={type:"LineString",coordinates:[]};return{dotted:function(obj){var entity=obj.entity,wyId=obj.wayId;try{json.coordinates=[];json.coordinates.push(entity.loc);json.coordinates.push(context.temp().zlevel_locs[entity.id+"-"+wyId]);return path(json)}catch(e){}}}};function drawDottedLine(surface,path,points,filter){var groups=surface.select(".layer-zlevel-path-point").selectAll("g.dotted-line").filter(filter).data(points,function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"path dotted "+d.id});group.append("path").attr("d",path.dotted).style({stroke:"#333333","stroke-width":"2","stroke-dasharray":"5, 5"});groups.exit().remove()}function drawLinkLine(surface,points,filter){surface.selectAll(".layer-zlevel-path-point").remove();surface.append("g").attr("class","layer layer-zlevel-path-point");var graph=context.graph(),path=getAttitudeD(projection,graph),_points=[];for(var i=0;i<points.length;i++){var entity=points[i];if(1>=entity.members.length)continue;var wayId0=entity.members[0].id,oId0=entity.id+"-"+wayId0,wayId1=entity.members[1].id,oId1=entity.id+"-"+wayId1;iD.util.storeDottedLoc(entity,context.graph().entity(wayId0),oId0,context.temp().zlevel_locs,context);iD.util.storeDottedLoc(entity,context.graph().entity(wayId1),oId1,context.temp().zlevel_locs,context);_points.push({id:oId0,entity:entity,wayId:wayId0});_points.push({id:oId1,entity:entity,wayId:wayId1})}if(points[0]&&iD.Layers.getLayer(points[0].layerId,points[0].modelName).display)drawDottedLine(surface,path,_points,filter)}function markerPath(selection,klass){var width=16,height=16,hw=width/2,hh=height/2;if("shadow"===klass||"stroke"===klass){selection.attr("class",klass).attr("transform","translate(-"+hw+", -"+hh+")").attr("d","M "+0+" "+0+" L"+0+" "+height+" L"+width+" "+height+" L"+width+" "+0+" Z");selection.each(function(entity){if("stroke"===klass)this.style.fill="#ff0000"})}else if("image"===klass){selection.attr({x:-hw,y:-hh,width:width,height:height}).attr("xlink:href",function(d){return context.imagePath("zlevel.png")})}}function sortY(a,b){return b.loc[1]-a.loc[1]}function drawRoadZLevel(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-zlevel").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point crosspoint "+d.id}).order();group.append("path").call(markerPath,"shadow");group.append("path").call(markerPath,"stroke");group.append("image").call(markerPath,"image");group.append("use").attr("class","KDSEditor-icon").attr("transform","translate(-6, -20)").attr("clip-path","url(#clip-square-12)");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.select(".shadow");groups.select(".stroke");groups.select(".KDSEditor-icon").attr("xlink:href",function(entity){var preset=context.presets().match(entity,context.graph());return preset.icon?"#maki-"+preset.icon+"-12":""});groups.classed("point-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});groups.exit().remove();drawLinkLine(surface,points,filter)}drawRoadZLevel.available=function(points){var layerInfo=points[0]&&iD.Layers.getLayer(points[0].layerId);if(layerInfo){var entType=points[0].modelName||points[0]._type,sublayer=layerInfo.getSubLayerByType(entType);return sublayer&&sublayer.display}return false};drawRoadZLevel.roadzlevel=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.isRoadZLevel&&entity.isRoadZLevel()){points.push(entity);if(limit&&points.length>=limit)break}}if(this.available(points))return points;return[]};return drawRoadZLevel};;;iD.svg.SpeedCamera=function(projection,context){function getAttitudeD(){var round=iD.svg.Round().stream,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return project(clip(round(output)))}}),json={type:"LineString",coordinates:[]};return{dotted:function(entity){try{json.coordinates=[];json.coordinates.push(entity.loc);json.coordinates.push(context.temp().camaera_locs[entity.id]);return path(json)}catch(e){}}}};function drawDottedLine(surface,path,points,filter){var groups=surface.select(".layer-point-path-point").selectAll("g.dotted-line").filter(filter).data(points,function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"path dotted "+d.id});group.append("path").attr("d",path.dotted).style({stroke:"#333333","stroke-width":"2","stroke-dasharray":"5, 5"});groups.exit().remove()}function drawLinkLine(surface,points,filter){surface.selectAll(".layer-point-path-point").remove();surface.append("g").attr("class","layer layer-point-path-point");var graph=context.graph(),path=getAttitudeD(projection,graph),_points=[];for(var i=0;i<points.length;i++){var entity=points[i];if(entity.members.length){_points.push(entity);iD.util.storeDottedLoc(entity,context.graph().entity(entity.members[0].id),entity.id,context.temp().camaera_locs,context)}}if(points[0]&&iD.Layers.getLayer(points[0].layerId,points[0].modelName).display)drawDottedLine(surface,path,_points,filter)}function markerPath(selection,klass){if("shadow"===klass||"stroke"===klass){var width=24,height=24;selection.attr("class",klass).attr("transform","translate(-11, -11)").attr("d","M "+0+" "+0+" L"+0+" "+height+" L"+width+" "+height+" L"+width+" "+0+" Z");selection.each(function(entity){if("stroke"===klass)this.style.fill="#ff0000"})}else if("image"===klass){selection.attr({x:-12,y:-12,width:25,height:25}).attr("xlink:href",function(d){return context.imagePath("speedcamera.png")})}}function sortY(a,b){return b.loc[1]-a.loc[1]}function drawSpeedCamera(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-speedcamera").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point crosspoint "+d.id}).order();group.append("path").call(markerPath,"shadow");group.append("path").call(markerPath,"stroke");group.append("image").call(markerPath,"image");group.append("use").attr("class","KDSEditor-icon").attr("transform","translate(-6, -20)").attr("clip-path","url(#clip-square-12)");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.select(".shadow");groups.select(".stroke");groups.select(".KDSEditor-icon").attr("xlink:href",function(entity){var preset=context.presets().match(entity,context.graph());return preset.icon?"#maki-"+preset.icon+"-12":""});groups.classed("point-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});groups.exit().remove();drawLinkLine(surface,points,filter)}drawSpeedCamera.available=function(points){var layerInfo=points[0]&&iD.Layers.getLayer(points[0].layerId);if(layerInfo){var entType=points[0].modelName||points[0]._type,sublayer=layerInfo.getSubLayerByType(entType);return sublayer&&sublayer.display}return false};drawSpeedCamera.speedcamera=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.isSpeedcamera&&entity.isSpeedcamera()){points.push(entity);if(limit&&points.length>=limit)break}}if(this.available(points))return points;return[]};return drawSpeedCamera};;;iD.svg.OverviewSurface=function(){return function(selection){selection.selectAll("defs").data([0]).enter().append("defs");var layers=selection.selectAll(".overview-layer").data(["polygon","icon"]);layers.enter().append("g").attr("class",function(d){return"overview-layer overview-layer-"+d})}};;;iD.svg.OverviewMarkerIcon=function(projection,context){function markerImage(selection){selection.attr("class","image").attr("xlink:href",function(d){return d.url})}function ________(surface,points,filter){var groups=surface.select(".overview-layer-icon").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point "+d.id}).order();group.append("image").call(markerImage,"image");surface.select(".overview-layer-icon").selectAll("g.point").each(function(icon){var node=this.childNodes[0];var x=-icon.getSizeCenter()[0]+icon.offset[0];var y=-icon.getSizeCenter()[1]+icon.offset[1];node.setAttribute("width",icon.width);node.setAttribute("height",icon.height);node.setAttribute("transform","translate("+x+", "+y+")")});groups.attr("transform",iD.svg.PointTransform(projection));groups.exit().remove()}return ________};;iD.svg.PlaceName=function(projection,context){function markerPath(selection,klass){if("shadow"===klass||"stroke"===klass){selection.attr("class",klass).attr("transform","translate(-14, -30)").attr("d","M8.80238396875 7.22626859375c0-3.610090369315548 3.29837171875-6.8804230625 7.2661135625-6.8804230625 3.9678378125 0 7.18440896875 3.0803755 7.18440896875 6.8804230625 0 3.2657538125-2.3784194375 5.99423990625-5.56525075 6.69840246875l-1.7124709375 16.55664659375-1.71729965625-16.6038785625C11.16826790625 13.10778490625 8.80238396875 10.42601915625 8.80238396875 7.22626859375zM15.9751848125 5.38332609375c0-1.03635334375-0.87716528125-1.87648775-1.9591836875-1.87648775-1.08227421875 0-1.95947146875 0.840134375-1.95947146875 1.87648775s0.87716528125 1.87648775 1.95947146875 1.87648775C15.09801953125 7.25981384375 15.9751848125 6.41967946875 15.9751848125 5.38332609375z");selection.each(function(entity){if("stroke"===klass)this.style.fill="#ff0000"})}else if("image"===klass){selection.attr({x:-12,y:-12,width:25,height:25}).attr("xlink:href",function(d){if(d.isPlaceName())return context.imagePath("roadcross.png")})}}function sortY(a,b){return b.loc[1]-a.loc[1]}function drawPlaceName(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-placename").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point crosspoint "+d.id}).order();group.append("path").call(markerPath,"shadow");group.append("path").call(markerPath,"stroke");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.select(".shadow");groups.select(".stroke");groups.select(".KDSEditor-icon").attr("xlink:href",function(entity){var preset=context.presets().match(entity,context.graph());return preset.icon?"#maki-"+preset.icon+"-12":""});groups.classed("point-hidden",function(d){var modelConfig=iD.Layers.getLayer(d.layerId,d.modelName);return modelConfig&&!modelConfig.display});groups.exit().remove()}drawPlaceName.available=function(points){return true};drawPlaceName.placename=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.isPlaceName&&entity.isPlaceName()){points.push(entity);if(limit&&points.length>=limit)break}}if(this.available(points))return points;return[]};return drawPlaceName};;;iD.svg.SearchPoint=function(projection,context){function markerPath(selection,klass){if("shadow"===klass||"stroke"===klass){selection.attr("class",klass).attr("transform","translate(-14, -30)").attr("d","M8.80238396875 7.22626859375c0-3.610090369315548 3.29837171875-6.8804230625 7.2661135625-6.8804230625 3.9678378125 0 7.18440896875 3.0803755 7.18440896875 6.8804230625 0 3.2657538125-2.3784194375 5.99423990625-5.56525075 6.69840246875l-1.7124709375 16.55664659375-1.71729965625-16.6038785625C11.16826790625 13.10778490625 8.80238396875 10.42601915625 8.80238396875 7.22626859375zM15.9751848125 5.38332609375c0-1.03635334375-0.87716528125-1.87648775-1.9591836875-1.87648775-1.08227421875 0-1.95947146875 0.840134375-1.95947146875 1.87648775s0.87716528125 1.87648775 1.95947146875 1.87648775C15.09801953125 7.25981384375 15.9751848125 6.41967946875 15.9751848125 5.38332609375z");selection.each(function(entity){if("stroke"!==klass){return}var colortype=entity.tags&&entity.tags.colortype||1;var color="#ff0000";switch(colortype){case 1:color="#ff0000";break;case 2:color="#00ff00";break;case 3:color="#0000ff";break;}this.style.fill=color})}else if("image"===klass){selection.attr({x:-12,y:-12,width:25,height:25}).attr("xlink:href",function(d){if(d.isSearchPoint())return context.imagePath("roadcross.png")})}}function sortY(a,b){return b.loc[1]-a.loc[1]}function drawSearchPoint(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-searchpoint").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point crosspoint "+d.id}).order();group.append("path").call(markerPath,"shadow");group.append("path").call(markerPath,"stroke");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.select(".shadow");groups.select(".stroke");groups.select(".KDSEditor-icon").attr("xlink:href",function(entity){var preset=context.presets().match(entity,context.graph());return preset.icon?"#maki-"+preset.icon+"-12":""});groups.classed("point-hidden",function(d){var modelConfig=iD.Layers.getLayer(d.layerId);return modelConfig&&!modelConfig.display});groups.exit().remove()}drawSearchPoint.available=function(points){return true};drawSearchPoint.searchpoint=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.isSearchPoint&&entity.isSearchPoint()){points.push(entity);if(limit&&points.length>=limit)break}}if(this.available(points))return points;return[]};return drawSearchPoint};;;iD.svg.Effects=function(projection,context){function markerPath(selection,klass){}function sortY(a,b){return b.loc[1]-a.loc[1]}function imagePath(entity){var block_type=blockTypeAssistInfoRel(entity),d="";if("0"==block_type)return false;else if("1"==block_type)d="assistInfoPass.png";else if("21"==block_type||"22"==block_type||"23"==block_type||"24"==block_type||"2"==block_type)d="assistInfoCondition.png";else if("3"==block_type)d="assistInfoRefuse.png";return context.imagePath(d)}function blockTypeAssistInfoRel(entity){var graph=context.graph();var block_type="0";if(entity.isRoadNode&&entity.isRoadNode()){var rel=graph.parentRelations(entity);var count=0;var pre_rel;rel.forEach(function(relation){if(relation.modelName==iD.data.DataType.NODECONN){var secondRel=graph.parentRelations(relation);secondRel.forEach(function(rel){if(rel.modelName&&rel.modelName==iD.data.DataType.ASSISTINFO){block_type=rel.tags.block_type;count++;if(2<=count){block_type=priorBlockType(pre_rel,rel)}if(block_type==rel.tags.block_type){pre_rel=rel}}})}})}else if(entity.isRoadCross&&entity.isRoadCross()){var rel=graph.parentRelations(entity);var countC=0;var pre_rel;rel.forEach(function(relation){if(relation.modelName==iD.data.DataType.CROSSMAAT){var secondRel=graph.parentRelations(relation);secondRel.forEach(function(rel){if(rel.modelName&&rel.modelName==iD.data.DataType.ASSISTINFOC){block_type=rel.tags.block_type;countC++;if(2<=countC){block_type=priorBlockType(pre_rel,rel)}if(block_type==rel.tags.block_type){pre_rel=rel}}})}})}return block_type}function priorBlockType(pre_rel,rel){var block_type_pre=pre_rel.tags.block_type;var block_type=rel.tags.block_type;var final_block_type;var conditionArr=["21","22","23","24"];if("3"==block_type||"3"==block_type_pre){final_block_type="3"}else if(0<=conditionArr.indexOf(block_type_pre)){final_block_type=block_type_pre}else if(0<=conditionArr.indexOf(block_type)){final_block_type=block_type}else if("1"==block_type||"1"==block_type_pre){final_block_type="1"}else{final_block_type="0"}return final_block_type}function drawEffects(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-forbidinfo").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point crosspoint "+d.id}).order();group.append("image").call(markerPath,"image");surface.select(".layer-forbidinfo").selectAll("g.point").each(function(entity){var shape=imagePath(entity);if(false!==shape){var node=this.childNodes[0];node.setAttribute("x","-12");node.setAttribute("y","-12");node.setAttribute("width","25");node.setAttribute("height","25");node.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",shape)}});groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.select(".shadow");groups.select(".stroke");groups.select(".KDSEditor-icon").attr("xlink:href",function(entity){var preset=context.presets().match(entity,context.graph());return preset.icon?"#maki-"+preset.icon+"-12":""});groups.classed("point-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});groups.exit().remove()}drawEffects.available=function(points){return true};drawEffects.effects=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.isRoadCross&&entity.isRoadCross()||entity.isRoadNode&&entity.isRoadNode()){var rel=graph.parentRelations(entity);rel.forEach(function(relation){var secondRel=graph.parentRelations(relation);secondRel.forEach(function(rel){if(rel.modelName&&(rel.modelName==iD.data.DataType.ASSISTINFO||rel.modelName==iD.data.DataType.ASSISTINFOC)){points.push(entity)}})});if(limit&&points.length>=limit)break}}if(this.available(points))return points;return[]};return drawEffects};;;iD.svg.DetailSlope=function(projection,context){function markerPath(selection,klass){if("shadow"===klass||"stroke"===klass){selection.attr("class",klass).attr("transform","translate(-8, -23)").attr("d","M 14,6 L 8,6 L 8,0 L 6,0 L 6,6 L 0,6 L 0,8 L 6,8 L 6,14 L 8,14 L 8,8 L 14,8 z");selection.each(function(entity){if("stroke"===klass)this.style.fill="#ff0000"})}else if("image"===klass){selection.attr({x:-12,y:-12,width:25,height:25}).attr("xlink:href",function(d){if(d.isPlaceName())return context.imagePath("roadcross.png")})}}function sortY(a,b){return b.loc[1]-a.loc[1]}function drawDetailSlope(surface,points,filter){points.sort(sortY);var groups=surface.select(".layer-detailslope").selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point crosspoint "+d.id}).order();group.append("path").call(markerPath,"shadow");group.append("path").call(markerPath,"stroke");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.select(".shadow");groups.select(".stroke");groups.select(".KDSEditor-icon").attr("xlink:href",function(entity){var preset=context.presets().match(entity,context.graph());return preset.icon?"#maki-"+preset.icon+"-12":""});groups.classed("point-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});groups.exit().remove()}drawDetailSlope.available=function(points){return true};drawDetailSlope.detailslope=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.isDetailSlope&&entity.isDetailSlope()){points.push(entity);if(limit&&points.length>=limit)break}}if(this.available(points))return points;return[]};return drawDetailSlope};;;iD.svg.WalkZlevel=function(projection,context){function getAttitudeD(){var round=iD.svg.Round().stream,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return project(clip(round(output)))}}),json={type:"LineString",coordinates:[]};return{dotted:function(obj){var entity=obj.entity,wyId=obj.wayId;try{json.coordinates=[];json.coordinates.push(entity.loc);json.coordinates.push(context.temp().zlevel_locs[entity.id+"-"+wyId]);return path(json)}catch(e){}}}};function drawDottedLine(surface,path,points,filter){var groups=surface.select(".layer-zlevel-path-point").selectAll("g.dotted-line").filter(filter).data(points,function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"path dotted "+d.id});group.append("path").attr("d",path.dotted).style({stroke:"#333333","stroke-width":"2","stroke-dasharray":"5, 5"});groups.exit().remove()}function drawLinkLine(surface,points,filter){surface.selectAll(".layer-zlevel-path-point").remove();surface.append("g").attr("class","layer layer-zlevel-path-point");var graph=context.graph(),path=getAttitudeD(projection,graph),_points=[];for(var i=0;i<points.length;i++){var entity=points[i];if(1>=entity.members.length)continue;var wayId0=entity.members[0].id,oId0=entity.id+"-"+wayId0,wayId1=entity.members[1].id,oId1=entity.id+"-"+wayId1;iD.util.storeDottedLoc(entity,context.graph().entity(wayId0),oId0,context.temp().zlevel_locs,context);iD.util.storeDottedLoc(entity,context.graph().entity(wayId1),oId1,context.temp().zlevel_locs,context);_points.push({id:oId0,entity:entity,wayId:wayId0});_points.push({id:oId1,entity:entity,wayId:wayId1})}if(points[0]&&iD.Layers.getLayer(points[0].layerId,points[1].modelName).display)drawDottedLine(surface,path,_points,filter)}function markerPath(selection,klass){var width=16,height=16,hw=width/2,hh=height/2;if("shadow"===klass||"stroke"===klass){selection.attr("class",klass).attr("transform","translate(-"+hw+", -"+hh+")").attr("d","M "+0+" "+0+" L"+0+" "+height+" L"+width+" "+height+" L"+width+" "+0+" Z");selection.each(function(entity){if("stroke"===klass)this.style.fill="#ff0000"})}else if("image"===klass){selection.attr({x:-hw,y:-hh,width:width,height:height}).attr("xlink:href",function(d){return context.imagePath("zlevel.png")})}}function sortY(a,b){return b.loc[1]-a.loc[1]}function drawWalkZlevel(surface,points,filter){points.sort(sortY);var layer_walkzlevel=surface.select(".layer-walk").selectAll("g.layer.layer-walkzlevel").data([0]);layer_walkzlevel.enter().append("g").attr("class","layer layer-walkzlevel no-pointer-events");var groups=layer_walkzlevel.selectAll("g.point").filter(filter).data(points,iD.Entity.key);var group=groups.enter().append("g").attr("class",function(d){return"node point crosspoint "+d.id}).order();group.append("path").call(markerPath,"shadow");group.append("path").call(markerPath,"stroke");group.append("image").call(markerPath,"image");group.append("use").attr("class","KDSEditor-icon").attr("transform","translate(-6, -20)").attr("clip-path","url(#clip-square-12)");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.select(".shadow");groups.select(".stroke");groups.select(".KDSEditor-icon").attr("xlink:href",function(entity){var preset=context.presets().match(entity,context.graph());return preset.icon?"#maki-"+preset.icon+"-12":""});groups.classed("point-hidden",function(d){return!iD.Layers.getLayer(d.layerId,d.modelName).display});groups.exit().remove();drawLinkLine(surface,points,filter)}drawWalkZlevel.available=function(points){return true};drawWalkZlevel.walkzlevel=function(entities,limit){var graph=context.graph(),points=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.isWalkZlevel&&entity.isWalkZlevel()){points.push(entity);if(limit&&points.length>=limit)break}}if(this.available(points))return points;return[]};return drawWalkZlevel};;;iD.ui=function(context){var User=iD.User;User.context=context;function render(container){var map=context.map();if(iD.detect().opera)container.classed("opera",true);container.append("svg").attr("id","defs").call(iD.svg.Defs(context));var isNoneLeft=isNoneFooter=isNoneTop=isNoneRight=isNoneRight2=tilelayer="none",uiNone=context.options.ui;if(!("object"===typeof uiNone)&&!uiNone){isNoneLeft=isNoneFooter=isNoneTop=isNoneRight=isNoneRight2=tilelayer="block"}if("object"===typeof uiNone){if(false!=uiNone.panel){isNoneLeft="block"}if(false!=uiNone.bar){isNoneTop="block"}if(false!=uiNone.zoom){isNoneRight="block"}if(false!=uiNone.toolbar){isNoneRight2="block"}if(false!=uiNone.tilelayer){tilelayer="block"}if(false!=uiNone.footer){isNoneFooter="block"}}container.append("div").attr("id","leftbar").attr("class","col3").call(ui.leftbar);ui.openDialog.open();var outerWrap=container.append("div").attr("id","KDSEditor-outer-wrap");var rightTool=container.append("div").attr("id","rightmenu-tools").attr("class","model-right-tools");container.append("div").attr("id","track-legend-control").attr("class","track-legend-control").call(iD.ui.TrackLegend(context));var allWrap=outerWrap.append("div").attr("id","KDSEditor-all-wrap");var picplayer=allWrap.append("div").attr("id","KDSEditor-picplayer").attr("class","model-pos-left");var content=allWrap.append("div").attr("id","KDSEditor-content").attr("class","model-pos-right");var bar=content.append("div").attr("id","KDSEditor-bar").attr("style","display:"+isNoneTop).attr("class","KDSEditor-div");var m=content.append("div").attr("id","map").call(map);var limiter=bar.append("div").attr("class","KDSEditor-limiter");User.on("login.topbar",function(){limiter.append("div").attr("class","KDSEditor-button-wrap task-list").call(iD.ui.TaskList(context));limiter.append("div").attr("class","KDSEditor-button-wrap joined").call(iD.ui.UndoRedo(context));limiter.append("div").attr("class","KDSEditor-button-wrap").call(iD.ui.Save(context));limiter.append("div").attr("class","KDSEditor-button-wrap joined effects-group").call(iD.ui.Effects(context));var actionButtons=limiter.append("div").attr("class","KDSEditor-button-wrap joined");var reportButtons=limiter.append("div").attr("class","KDSEditor-button-wrap joined report-button");var button3=reportButtons.append("button").attr({id:"button3",title:"\u67E5\u770B\u8D28\u68C0\u62A5\u544A"});button3.append("span").attr("class","text-center").text("\u67E5\u770B\u8D28\u68C0\u62A5\u544A");var button4=reportButtons.append("button").attr({id:"button4",title:"\u4F5C\u4E1A\u62A5\u8868",style:"    font-size: 12px;\n"+"    width: 78px;\n"+"    height: 40px;\n"+"    /* display: none; */\n"+"    border-radius: 4px;"});button4.append("span").attr("class","text-center").text("\u4F5C\u4E1A\u62A5\u8868");var button2=reportButtons.append("button").attr({id:"button2",title:"\u5B8C\u6210"});button2.append("span").attr("class","text-center").text("\u5B8C\u6210");var button5=reportButtons.append("button").attr({id:"button5",title:"\u53D6\u6D88"});button5.append("span").attr("class","text-center").text("\u53D6\u6D88");var reportform=content.append("div").attr("id","reportform").call(iD.ui.ReportForm(context));var effectform=content.append("div").attr("id","effectform").call(iD.ui.EffectForm(context));actionButtons.call(iD.ui.RoadCrossing(context));content.append("div").attr("class","KDSEditor-spinner").call(iD.ui.Spinner(context));content.append("div").style("display","none").attr("class","help-wrap map-overlay KDSEditor-fillL KDSEditor-col5 content");var controls=content.append("div").attr("class","map-controls");controls.append("div").attr("class","map-control zoomlevel-control").attr("style","display:"+isNoneRight).call(iD.ui.ZoomLevel(map));controls.append("div").attr("class","map-control zoombuttons").attr("style","display:"+isNoneRight).call(iD.ui.Zoom(context));rightTool.append("div").attr("class","map-control geolocate-control").attr("style","display:"+isNoneRight).call(iD.ui.Geolocate(map,context));rightTool.append("div").attr("class","map-control toolbarbuttons").attr("style","display:"+isNoneRight2).call(iD.ui.toolbar.Toolbar(context));rightTool.append("div").attr("class","map-control roadfilter-control").attr("style","display:"+isNoneRight).call(iD.ui.RoadFilterControl(context));controls.append("div").attr("class","map-control background-control").attr("style","display:"+tilelayer).call(iD.ui.Background(context));rightTool.append("div").attr("class","map-control nodesearch-control").attr("style","display:"+isNoneRight).call(iD.ui.NodeSearchControl(context));rightTool.append("div").attr("class","map-control editcheck-tag-control").call(iD.ui.EditCheckTagControl(context));rightTool.append("div").attr("class","map-control view-modechange-control").call(iD.ui.ViewModeChange(context,content,picplayer,allWrap));rightTool.append("div").attr("class","map-control user-control").call(function(selection){let button=selection.append("button").attr("tabindex",-1).attr("class","user-control-logout").on("click.user-control",function(d){iD.User&&iD.User.logout(function(){window.location.reload()})});button.append("span").attr("class","text-center").text("\u9000\u51FA")});iD.svg.Pic.dataMgr.setContext(context)});var overview,isClose=false;context.overview_isBand=true;function getBoundsByLocs(locs){var minll=[Infinity,Infinity],maxll=[0,0],loc;for(var i in locs){loc=locs[i];if(minll[0]>loc[0])minll[0]=loc[0];if(minll[1]>loc[1])minll[1]=loc[1];if(maxll[0]<loc[0])maxll[0]=loc[0];if(maxll[1]<loc[1])maxll[1]=loc[1]}return[minll,maxll]}context.event.on("openoverview",function(opt){if(overview)overview.remove();overview=null;var ov=context.overview(context);ov.zoom(0);var extentC,_extent;if(opt.extent){extentC=iD.geo.Extent(opt.extent).center()}else if(opt.locs){_extent=getBoundsByLocs(opt.locs);extentC=iD.geo.Extent(_extent).center()}else return;ov.center(extentC);ov.init(opt,_extent);var style=opt.style||{width:400,height:350},delt=7,dw=style.width-delt,dh=style.height-delt;overview=content.append("div").attr("class","map-overview").attr("style",function(){var whstr="";if(style.width)whstr+=";width: "+style.width+"px;";if(style.height)whstr+=";height: "+style.height+"px;";return whstr});var overviewmain=overview.append("div").attr("class","map-overview-main").attr("style",function(){var whstr="";if(style.width)whstr+=";width: "+dw+"px;";if(style.height)whstr+=";height: "+dh+"px;";return whstr}).call(ov);var overviewnode=overview.node(),overviewmainnode=overviewmain.node(),w=parseInt(iD.util.getStyleValue(overviewnode,"width")),h=parseInt(iD.util.getStyleValue(overviewnode,"height"));var __extent=opt.extent?opt.extent:_extent,extentMinXY=context.overview_projection([__extent[0][0],__extent[1][1]]),extentMaxXY=context.overview_projection([__extent[1][0],__extent[0][1]]),extentW=extentMaxXY[0]-extentMinXY[0];extentH=extentMaxXY[1]-extentMinXY[1];var x=0,y=0,dx=0,dy=0,l=0,t=0,nl=0,nt=0,draging=false;var vmW=extentW/4,vmH=extentH/6,locate_wh=6;function setNodeLT(node,l,t){node.style.left=l+vmW/2-locate_wh+"px";node.style.top=t+vmH/2-locate_wh+"px"}function locMvLTByMCenter(){var x=extentMinXY[0]-vmW/2,y=extentMinXY[1]-vmH/2;var cter=context.map().center();var cpixel=context.overview_projection(cter);var lt=[cpixel[0]-vmW/2,cpixel[1]-vmH/2],rb=[cpixel[0]+vmW/2,cpixel[1]+vmH/2];if(cpixel[0]>extentMinXY[0]&&cpixel[0]<extentMaxXY[0])x=lt[0];if(cpixel[1]>extentMinXY[1]&&cpixel[1]<extentMaxXY[1])y=lt[1];if(cpixel[0]>extentMaxXY[0])x=extentMaxXY[0]-vmW/2;if(cpixel[1]>extentMaxXY[1])y=extentMaxXY[1]-vmH/2;return[x,y]}var x_y=locMvLTByMCenter();var viewMv=overviewmain.append("div").attr("class","overview-viewMv").attr("style",function(){var str="";if(style.width)str+=";left: "+x_y[0]+"px;";if(style.height)str+=";top: "+x_y[1]+"px;";if(style.width)str+=";width: "+vmW+"px;";if(style.height)str+=";height: "+vmH+"px;";return str}).on("mousedown",function(){d3.event.stopPropagation();x=d3.event.x||d3.event.clientX;y=d3.event.y||d3.event.clientY;l=parseInt(iD.util.getStyleValue(this,"left"));t=parseInt(iD.util.getStyleValue(this,"top"));draging=true}).on("mousemove.drag",function(){if(!draging)return;dx=(d3.event.x||d3.event.clientX)-x;dy=(d3.event.y||d3.event.clientY)-y;nl=l+dx;nt=t+dy;this.style.left=nl+"px";this.style.top=nt+"px";setNodeLT(locatenode,nl,nt)}).on("mouseup",function(){if(!draging)return;dx=(d3.event.x||d3.event.clientX)-x;dy=(d3.event.y||d3.event.clientY)-y,nl=l+dx;nt=t+dy;if(nl+vmW/2<extentMinXY[0])nl=extentMinXY[0]-vmW/2;if(nt+vmH/2<extentMinXY[1])nt=extentMinXY[1]-vmH/2;if(nl+vmW/2>extentMaxXY[0])nl=extentMaxXY[0]-vmW/2;if(nt+vmH/2>extentMaxXY[1])nt=extentMaxXY[1]-vmH/2;this.style.left=nl+"px";this.style.top=nt+"px";setNodeLT(locatenode,nl,nt);draging=false;var loc=context.overview_projection.invert([nl+vmW/2,nt+vmH/2]);context.map().center(loc)});var viewMvnode=viewMv.node();context.event.on("moveoverview",function(){var xy=locMvLTByMCenter();viewMvnode.style.left=xy[0]+"px";viewMvnode.style.top=xy[1]+"px";setNodeLT(locatenode,xy[0],xy[1])});var locate=overviewmain.append("div").attr("class","overview-locate").attr("style",function(){var ltstr="";if(style.width)ltstr+=";left: "+(x_y[0]+vmW/2-locate_wh)+"px;";if(style.height)ltstr+=";top: "+(x_y[1]+vmH/2-locate_wh)+"px;";return ltstr});var locatenode=locate.node();var btn=overview.append("div").attr("class","map-overview-btn").on("click",function(){if(isClose){_open();isClose=false}else{_close();isClose=true}});function _open(){var _w=style.width?style.width:w,_h=style.height?style.height:h;overviewnode.style.width=_w+"px";overviewnode.style.height=_h+"px";overviewmainnode.style.width=_w-delt+"px";overviewmainnode.style.height=_h-delt+"px";btn.attr("class","map-overview-btn")}function _close(){overviewnode.style.width="14px";overviewnode.style.height="14px";overviewmainnode.style.width="14px";overviewmainnode.style.height="14px";btn.attr("class","map-overview-btn-close")}function _open_close(){if(isClose)_close();else _open()}_open_close()});context.event.on("closeoverview",function(){if(overview)overview.remove();overview=null});var infowindow,infowindow_position,infowindow_size;context.infowindow_isBand=true;function getLt(position,infowindow_size){var lt=context.projection(position),offset_center_x=-10+30/2-infowindow_size[0]/2-2,offset_center_y=2*-10-23-infowindow_size[1]-4;lt[0]=lt[0]+offset_center_x;lt[1]=lt[1]+offset_center_y;return lt}context.event.on("openinfowindow",function(){if(infowindow)infowindow.remove();infowindow=null;infowindow_position=arguments[0][1];infowindow_size=arguments[0][0].size||[300,100];var lt=getLt(infowindow_position,infowindow_size);infowindow=m.append("div").attr("class","KDSEditor-info").attr("style",";left: "+lt[0]+"px;top: "+lt[1]+"px;").call(ui.infowindow,arguments)});context.event.on("closeinfowindow",function(){if(infowindow)infowindow.remove();infowindow=null;infowindow_position=null;infowindow_size=null});context.event.on("moveinfowindow",function(){if(infowindow&&infowindow_position){var lt=getLt(infowindow_position,infowindow_size);infowindow.attr("style",";left: "+lt[0]+"px;top: "+lt[1]+"px;")}});context.event.on("changeinfowindow",function(opt){if(infowindow){ui.infowindow.updateContent(opt).updateSize(opt);infowindow_size=opt.size||infowindow_size;var lt=getLt(infowindow_position,opt.size);infowindow.attr("style",";left: "+lt[0]+"px;top: "+lt[1]+"px;")}});var footer=content.append("div").attr("id","KDSEditor-footer").attr("class","KDSEditor-fillD").style("display",isNoneFooter).style("z-index","301");footer.append("div").attr("id","scale-block").call(iD.ui.Scale(context));window.onbeforeunload=function(){return context.save()};window.onunload=function(){context.history().unlock()};d3.select(window).on("resize.editor",function(){map.dimensions(m.dimensions())});function pan(d){return function(){context.pan(d)}}var pa=5;var keybinding=d3.keybinding("main").on("\u232B",function(){d3.event.preventDefault()});d3.select(document).call(keybinding);context.enter(iD.modes.Browse(context));iD.Task.on("afterget.ui",function(){context.container().call(iD.ui.Restore(context))});var authenticating=iD.ui.Loading(context).message(t("loading_auth"));context.connection().on("authenticating.ui",function(){context.container().call(authenticating)}).on("authenticated.ui",function(){authenticating.close()});var fmouse=iD.util.fastMouse(d3.select("#supersurface").node());var mouseMoveProjection=_.debounce(function(obj){var mouseEvent=obj.event;var peojection=editor.pixelToLonlat(fmouse(mouseEvent));var dataObj={lan:peojection[0],lat:peojection[1]};var dataArray=[dataObj];var geInfo=d3.select("#KDSEditor-footer").selectAll("#geoProjectionInfo").data(dataArray);var update=geInfo;var insert=geInfo.enter();update.text(function(d,i){return"L="+d.lan.toFixed(7)+"      B="+d.lat.toFixed(7)});insert.append("div").attr("id","geoProjectionInfo").classed("geoProjection",true).text(function(d,i){return"L="+d.lan.toFixed(7)+"      B="+d.lat.toFixed(7)});geInfo.exit().remove()},300);d3.select("#supersurface").on("mousemove.projection",function(){mouseMoveProjection({event:d3.event})})}function ui(container){context.container(container);context.loadLocale(function(){render(container)})}ui.updateLayer=function(layer){ui.layermanager.update&&ui.layermanager.update(layer)};ui.sidebar=iD.ui.Sidebar(context);ui.reportform=iD.ui.ReportForm(context);ui.leftbar=iD.ui.LeftBar(context);ui.navtab=iD.ui.NavTab(context);ui.layermanager=iD.ui.LayerManager(context);ui.effectform=iD.ui.EffectForm(context);ui.infowindow=iD.ui.Infowindow(context);ui.openDialog=iD.ui.openDialog(context);return ui};iD.ui.tooltipHtml=function(text,key){return"<span>"+text+"</span>"+"<div class=\"keyhint-wrap\">"+"<span> "+t("tooltip_keyhint")+" </span>"+"<span class=\"keyhint\"> "+key+"</span></div>"};iD.ui.dispEntity=function(context,datum){var footer=d3.select("#KDSEditor-footer");var geoRoadInfo=d3.select("#geoRoadInfo");if(!geoRoadInfo.node())geoRoadInfo=footer.append("div");geoRoadInfo.text("");if(!datum)return;if(!("way"==datum.type)||datum.tags&&datum.modelName!=iD.data.DataType.HIGHWAY&&datum.modelName!=iD.data.DataType.WALKLINK)return;var len=datum.tags.length;var num=datum.nodes.length;var floatLen=parseFloat(len).toFixed(1);if(""!=len)geoRoadInfo.attr("class","geoProjection").attr("id","geoRoadInfo").text("\u9053\u8DEF\u957F\u5EA6\uFF1A"+parseFloat(len).toFixed(1)+"\u7C73  "+"\u5F62\u72B6\u70B9\u4E2A\u6570\uFF1A"+num+"\u4E2A")};iD.ui.dispMultiEntity=function(context,selectedIDs){var footer=d3.select("#KDSEditor-footer");var geoRoadInfo=d3.select("#geoRoadInfo");if(!geoRoadInfo.node())geoRoadInfo=footer.append("div");geoRoadInfo.text("");if(!selectedIDs.length){return}var datum=context.graph().entity(selectedIDs[0]);if(!datum)return;if(!("way"==datum.type)||datum.tags&&datum.modelName!=iD.data.DataType.HIGHWAY&&datum.modelName!=iD.data.DataType.WALKLINK)return;var entities=[];var counts=0,totalLength=0;selectedIDs.forEach(function(selectedID){var entity=context.graph().entity(selectedID);entities.push(entity);counts++;totalLength+=parseFloat(entity.tags.length)});geoRoadInfo.attr("class","geoProjection").attr("id","geoRoadInfo").text("\u9053\u8DEF\u957F\u5EA6\uFF1A"+totalLength.toFixed(1)+"\u7C73  "+"\u9053\u8DEF\u6761\u6570\uFF1A"+counts+"\u6761")};iD.ui.toolbar={};;;iD.ui.RoadTip=function(context){function roadTip(selection){selection.append("div").attr("id","KDSEditor-RoadTip").text("\u9053\u8DEF\u7F16\u8F91\u5668")}return roadTip};;iD.ui.RoadMergeTip=function(context){var center=[];var roadMergeTip={};var isShowFlag=false;var tipUtil=iD.ui.TipUtil(context);var modal;roadMergeTip.perform=function(selection,startWay,endWay,perforFun,cancelFun){modal=iD.ui.modal(context.container());modal.on("close.merge",function(){d3.selectAll("."+startWay.id).classed("merge_a",false);d3.selectAll("."+endWay.id).classed("merge_b",false)});modal.select(".modal").attr("class","modal-splash modal KDSEditor-col6");modal.select("button.close").attr("class","hide");modal.append("div").attr("class","mergeDiv").attr("id","mergeDiv");var mergeDiv=d3.select(".mergeDiv");var introModal=mergeDiv.append("div").attr("class","merge-window").attr("id","merge-window");var titleTable=introModal.append("table").attr("class","merge-title-table").attr("id","merge-title-table").attr("cellspacing","0");var tbody=titleTable.append("tbody");var tr=tbody.append("tr");tr.append("td").attr("class","merge-title-content-td").text("\u9053\u8DEF\u5408\u5E76");tr.append("td").attr("class","merge-title-close-td").on("click",function(){modal.close()}).append("span").attr("class","merge-title-close-span").text("\xD7");var title=introModal.append("div").append("dl").attr("class","info-list").append("dt");title.append("b").text("\u5C5E \u6027");title.append("b").classed("merge_a",true).text("\u9053\u8DEF A");title.append("b").classed("merge_b",true).text("\u9053\u8DEF B");introModal.append("div").attr("class","info-list-content").html(attributeCompare(startWay,endWay));if(!isShowFlag){perforFun(startWay.id);modal.close()}var buttons=introModal.append("div").attr("class","merge-button-content");buttons.append("button").attr("class","merge-cancel").text("\u53D6\u6D88").on("click",function(){modal.close();cancelFun()});var performProcess=function(id){if(startWay.tags.adas!=endWay.tags.adas){var adasPasswordTip=iD.ui.AdasPasswordTip(context,function(){perforFun(id);modal.close()},function(){});adasPasswordTip.perform("\u5408\u5E76\u9053\u8DEF\u6D89\u53CAADAS\u9053\u8DEF,\u8BF7\u8F93\u5165\u5BC6\u7801\uFF1A")}else{perforFun(id);modal.close()}};buttons.append("button").attr("class","merge-A-ok").text("\u6309\u9053\u8DEFA\u5C5E\u6027\u5408\u5E76").on("click",function(){performProcess(startWay.id)});buttons.append("button").attr("class","merge-B-ok").text("\u6309\u9053\u8DEFB\u5C5E\u6027\u5408\u5E76").on("click",function(){performProcess(endWay.id)});new tipUtil.dragDrop({target:document.getElementById("merge-window"),bridge:document.getElementById("merge-title-table")})};var attributeCompare=function(startWay,endWay){d3.selectAll("."+startWay.id).classed("merge_a","true");d3.selectAll("."+endWay.id).classed("merge_b","true");var htmlStr="<table>";var modelEntity;modelEntity=iD.Layers.getLayer(startWay.layerId).modelEntity();if(!modelEntity.getGeoType){modelEntity=iD.ModelEntitys[startWay.modelName]}var gtype=modelEntity.getGeoType();var compareFields=iD.data.RoadMerge.compareFields[startWay.modelName];modelEntity.getFields(gtype).filter(function(d){htmlStr+="<tr>";if(-1!=compareFields.indexOf(d.fieldName.toLocaleUpperCase())){if("DIRECTION"==d.fieldName.toLocaleUpperCase()){if(startWay.tags[d.fieldName]==iD.way.direction.twoway&&endWay.tags[d.fieldName]==iD.way.direction.twoway||startWay.tags[d.fieldName]==iD.way.direction.twowayforbid&&endWay.tags[d.fieldName]==iD.way.direction.twowayforbid){return}if(startWay.first()==endWay.first()||startWay.last()==endWay.last()){if(startWay.tags[d.fieldName]==iD.way.direction.positive&&endWay.tags[d.fieldName]==iD.way.direction.reverse||startWay.tags[d.fieldName]==iD.way.direction.reverse&&endWay.tags[d.fieldName]==iD.way.direction.positive){return}}}else if(startWay.tags[d.fieldName]==endWay.tags[d.fieldName]){return}var zname=d.fieldName;if(d.fieldTitle){zname=d.fieldTitle}htmlStr+="<td>"+zname+"</td>";htmlStr+="<td>"+startWay.tags[d.fieldName]+"</td>";htmlStr+="<td>"+endWay.tags[d.fieldName]+"</td>";isShowFlag=true}htmlStr+="</tr>"});htmlStr+="</table>";return htmlStr};roadMergeTip.center=function(_){if(_){center=_}else{return center}};return roadMergeTip};;iD.ui.SelectionList=function(context,selectedIDs){function visibleFilter(entity){if(!entity)return false;var blanks=context.variable.blankFieldList||[];return!blanks.includes(entity.modelName)}function selectEntity(entity){var graph=context.graph();if(entity.geometry(graph)!=iD.data.GeomType.RELATION){context.enter(iD.modes.Select(context,[entity.id],null,true).newFeature(true));return}var selectid=entity.id;var $sidebar=d3.select("#KDSEditor-sidebar");if($sidebar.size()&&$sidebar.attr("data-multiselectids")&&$sidebar.attr("data-member-multiselectids")){var rids=$sidebar.attr("data-multiselectids").split(",");var mids=$sidebar.attr("data-member-multiselectids").split(",");selectid=mids[rids.indexOf(entity.id)]}context.enter(iD.modes.Select(context,[selectid],null,true).newFeature(true))}function selectionList(selection){selection.classed("selection-list-pane",true);var header=selection.append("div").attr("class","KDSEditor-header KDSEditor-fillL cf");header.append("h3").text(t("inspector.multiselect"));var listWrap=selection.append("div").attr("class","KDSEditor-inspector-body");var $filter=listWrap.append("div").attr("class","KDSEditor-feature-filter cf");var listFilter=new ListFilter($filter);var $header=listWrap.append("div").attr("class","KDSEditor-feature-header cf");var list=listWrap.append("div").attr("class","KDSEditor-feature-list cf");context.history().on("change.selection-list",drawList);drawList();function drawList(){var entities=selectedIDs.map(function(id){return context.hasEntity(id)}).filter(visibleFilter);var modelNames=_.compact(_.uniq(_.pluck(entities,"modelName")));var onlyRelation=true;for(var mname of modelNames){var modelEntity=iD.ModelEntitys[mname];if(modelEntity&&0!=modelEntity.type()){onlyRelation=false}}listWrap.classed("only-relation",onlyRelation);$header.append("div").text("\u7C7B\u578B").attr("class","feature-head");$header.append("div").text("\u672C\u8EABid").attr("class","feature-head");$header.append("div").text("\u6392\u5E8Fid").attr("class","feature-head");$header.append("div").text("\u6210\u5458").attr("class","feature-head membernum");var items=list.selectAll(".KDSEditor-feature-list-item").data(entities,iD.Entity.key);var enter=items.enter().append("button").attr("class","KDSEditor-feature-list-item").on("click",function(entity){d3.event._isFromList=true;selectEntity(entity)});var label=enter.append("div").attr("class","label");label.append("span").append("span").attr("class","KDSEditor-icon");label.append("span").attr("class","entity-type");label.append("span").attr("class","entity-name");label.append("span").attr("class","entity-membernum");items.selectAll(".KDSEditor-icon").attr("class",function(entity){return context.geometry(entity.id)+" KDSEditor-icon"});items.selectAll(".entity-type").text(function(entity){return iD.Entity.id.toOSM(entity.id)});items.selectAll(".entity-name").text(function(entity){return iD.util.displayName(entity,null)});items.selectAll(".entity-membernum").text(function(entity){return entity.members&&entity.members.length||0});items.exit().remove();listFilter.sortSelectionList(items);listFilter.on("change",function(param){listFilter.sortSelectionList(items,param)});function locationEntity(entity){var selExtent=iD.geo.Extent(),map=context.map(),graph=context.graph();var oldExtentArea=selExtent.area()||1;selExtent=selExtent.extend(entity.extent(graph));map.extent(selExtent)}function addMultiEditorFooter(entity){var data=[];var d3Obj=d3.select("div.entity-editor-pane.KDSEditor-pane");if(0<d3Obj.size()){var selectIds=d3Obj.attr("data-multiselectids");if(selectIds){data.push(selectIds)}}var parentNode=d3.select("div.KDSEditor-inspector-border.raw-tag-editor.KDSEditor-inspector-inner");var multiEditor=parentNode.selectAll("preset-form.form-input-field.checkselect.multiRoadEditor");var update=multiEditor.data(data);var enter=update.enter();var exit=update.exit();var preset_footer=enter.append("div").attr("class","preset-form form-input-field checkselect").attr("id","multiRoadEditor_footer");var roadNav=preset_footer.append("div").attr("class","preset-form form-input-field");var selectIds=0<data.length?data[0].split(","):data;var index=_.indexOf(selectIds,entity.id);var currentRoadIndex=(index||0)+1;var selectIdsLength=selectIds.length;var ul=roadNav.append("nav").append("ul").attr("class","pagination");ul.append("li").append("a").on("click",previousRoad).attr({"aria-label":"Previous",href:"#"}).append("span").attr({"aria-hidden":true}).text("\xAB");ul.append("li").append("a").attr({"aria-label":"Previous",href:"#"}).append("span").attr({"aria-hidden":true,id:"currentRoadInfo"}).text(currentRoadIndex+"/"+selectIdsLength);ul.append("li").append("a").on("click",nextRoad).attr({"aria-label":"Previous",href:"#"}).append("span").attr({"aria-hidden":true}).text("\xBB");locationEntity(entity);function toogleRoadName_ZHState(){var d_button=d3.select("button.button-input-action.roadname-add.minor");if(0<d_button.size()){if(d3.select("#multiEditor")[0][0].checked){d_button.classed("hide",true)}else{d_button.classed("hide",false)}}}function previousRoad(){currentRoadIndex=currentRoadIndex-1;if(1>currentRoadIndex){currentRoadIndex=1;return}var selectid=selectIds[currentRoadIndex-1];d3.event._multiEditRoadProp=true;d3.select("#multiRoadEditor_footer #currentRoadInfo").text(currentRoadIndex+"/"+selectIdsLength);context.enter(iD.modes.Select(context,[selectid]))}function nextRoad(){currentRoadIndex=currentRoadIndex+1;if(currentRoadIndex>selectIdsLength){currentRoadIndex=selectIdsLength;return}var selectid=selectIds[currentRoadIndex-1];d3.event._multiEditRoadProp=true;d3.select("#multiRoadEditor_footer #currentRoadInfo").text(currentRoadIndex+"/"+selectIdsLength);context.enter(iD.modes.Select(context,[selectid]))}exit.remove()}}}function ListFilter(selection){this.$body=selection;this.$sidebar=d3.select("#KDSEditor-sidebar");this.init();this._initFilterEvent();var $sidebar=this.$sidebar;if($sidebar.size()&&$sidebar.attr("data-filterparam")){var param=$sidebar.attr("data-filterparam").split(",");this.setFilterParam({type:param[0],sort:param[1]},false)}if($sidebar.size()){$sidebar.attr("data-filterparam",null);$sidebar.attr("data-member-multiselectids",null)}this.event=d3.dispatch("change");d3.rebind(this,this.event,"on")}ListFilter.prototype.init=function(){var self=this;var $ul=self.$body.selectAll("ul.feature-filter").data([0]).enter().append("ul").attr("class","feature-filter cf");var $item=$ul.selectAll("li.filter-item").data(["type","sort"]).enter().append("li").attr("class","filter-item");$item.append("label").attr("class","filter-label").text(function(d){if("type"==d){return"\u7C7B\u578B:"}else if("sort"==d){return"\u6392\u5E8F:"}});$item.append("select").attr("name",function(d){return d}).attr("class","filter-item").attr("id",function(d){return"_filter_"+d}).selectAll("option").data(function(d){if("type"==d){return self.getOptionsType()}else if("sort"==d){return self.getOptionsSort()}}).enter().append("option").attr("value",function(d){return d.value}).text(function(d){return d.name})};ListFilter.prototype.getOptionsType=function(){var entityList=selectedIDs.map(function(id){return context.hasEntity(id)}).filter(visibleFilter);var modelNames=_.compact(_.uniq(_.pluck(entityList,"modelName")));var dataList=[{name:"id",value:"id"}];if(1<modelNames.length){return dataList}var modelName=modelNames[0];if(_.include([iD.data.DataType.DIVIDER_ATTRIBUTE,iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.R_ROAD_RA],modelName)){dataList.push(...[{name:"\u70B9id",value:"nodeid"},{name:"\u7EBFid",value:"wayid"}])}else if(modelName==iD.data.DataType.R_DIVIDER_DREF){dataList.push(...[{name:"\u7EBFid",value:"wayid"}])}return dataList};ListFilter.prototype.getOptionsSort=function(){return[{name:"\u6B63\u5E8F",value:"asc"},{name:"\u5012\u5E8F",value:"desc"}]};ListFilter.prototype.getFilterParam=function(){var self=this;var $inputs=self.$body.selectAll("li.filter-item select");var param={};$inputs.each(function(){if(this.name){param[this.name]=this.value||""}});return param};ListFilter.prototype.setFilterParam=function(param,trigger=false){var self=this;var $inputs=self.$body.selectAll("li.filter-item select");var result={};param=_.clone(param);$inputs.each(function(){var newVal=param[this.name];var optVals=_.pluck(this.options,"value")||[];if(this.name&&null!=newVal&&this.value!=newVal&&_.include(optVals,newVal)){this.value=newVal}result[this.name]=this.value});trigger&&self.event.change(result)};ListFilter.prototype._initFilterEvent=function(){var self=this;var $inputs=self.$body.selectAll("li.filter-item select");$inputs.on("change",selectValueChange);function selectValueChange(){self.event.change(self.getFilterParam())}};ListFilter.prototype.sortSelectionList=function($items,param){var self=this;var $sidebar=self.$sidebar;if(!param){param=self.getFilterParam()}$items.sort(function(d1,d2){var id1=sortFieldVal(d1),id2=sortFieldVal(d2);if(!param.sort||false==id1||false==id2){return 0}return sortVal(id1,id2)});var memberids=[];var entityids=[];if("id"!=param.type){$items.each(function(d){d3.select(this).select(".entity-name").text(sortFieldVal(d));entityids.push(d.id);if(d instanceof iD.Relation){memberids.push(iD.util.entityRelationMainMember(d,context))}})}else{$items.each(function(d){d3.select(this).select(".entity-name").text(iD.Entity.id.toOSM(d.id));entityids.push(d.id);if(d instanceof iD.Relation){memberids.push(iD.util.entityRelationMainMember(d,context))}})}if($sidebar.size()){$sidebar.attr("data-multiselectids",entityids);$sidebar.attr("data-filterparam",[param.type,param.sort]);$sidebar.attr("data-member-multiselectids",memberids.length&&memberids||null)}function sortVal(a,b){var result=0;if(a<b){result=-1}else if(a>b){result=1}if("desc"==param.sort){result=-result}return result}function sortFieldVal(d,toOSM=true){var result=false;var geoType="",filterFun=()=>true;if(_.include([iD.data.DataType.DIVIDER_ATTRIBUTE,iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.R_ROAD_RA],d.modelName)){if("nodeid"==param.type){geoType=iD.data.GeomType.NODE}else if("wayid"==param.type){geoType=iD.data.GeomType.WAY}}else if(d.modelName==iD.data.DataType.R_DIVIDER_DREF){if("wayid"==param.type){geoType=iD.data.GeomType.WAY;filterFun=function(entity){return entity&&"1"==entity.tags.R_LINE}}}for(let m of d.members||[]){let entity=context.hasEntity(m.id);if(entity&&entity.type==geoType&&filterFun(entity)){result=entity.id;break}}if(!result&&"id"==param.type){result=d.id}return"string"===typeof result?toOSM?Number(iD.Entity.id.toOSM(result)):result:result}};return selectionList};;;iD.ui.RoadExpandTip=function(context){var tipUtil=iD.ui.TipUtil(context);var center=[];var roadExpandTip={};var screenX,screenY,modal;function closeExpandBox(){var delDiv=document.getElementById("road-expand-box");if(null!=delDiv)delDiv.parentNode.removeChild(delDiv);modal.close()}roadExpandTip.perform=function(selection,perforFun){var left,right,originalRoadTag=true;screenX=tipUtil.getMousePos().X;screenY=tipUtil.getMousePos().Y;modal=iD.ui.modal(selection);modal.select(".modal").attr("class","modal-splash modal KDSEditor-col6");modal.select("button.close").attr("class","hide");modal.append("div").attr("class","road-expand-box").attr("id","road-expand-box");var expandBox=d3.select(".road-expand-box");var titleTable=expandBox.append("table").attr("class","expand-title-table").attr("id","expand-title-table").attr("cellspacing","0");var tbody=titleTable.append("tbody");var tr=tbody.append("tr");tr.append("td").attr("class","expand-title-content-td").text("\u6269\u8DEF");tr.append("td").attr("class","expand-title-close-td").on("click",function(){closeExpandBox()}).append("span").attr("class","expand-title-close-span").text("\xD7");var expandContent=expandBox.append("div").attr("class","road-expand-content");var expandLeft=expandContent.append("div").attr("class","expand-left");expandLeft.append("lable").attr("class","expand-annotation").text("\u5DE6\u8FB9\u6269\u8DEF");expandLeft.append("input").attr("id","expand-text-left").attr("class","expand-text-left").attr("value","3.00").attr("type","number").attr("min","0.00").attr("step","1.50");expandLeft.append("lable").attr("class","meter").text("\u7C73");var expandRight=expandContent.append("div").attr("class","expand-right");expandRight.append("lable").attr("class","expand-annotation").text("\u53F3\u8FB9\u6269\u8DEF");expandRight.append("input").attr("id","expand-text-right").attr("class","expand-text-right").attr("value","3.00").attr("type","number").attr("min","0.00").attr("step","1.50");expandRight.append("lable").attr("class","meter").text("\u7C73");var functionItem=expandContent.append("div").attr("class","expand-item");functionItem.insert("input",".original-road-annotation").attr("type","checkbox").attr("id","expand-item-original-road").attr("class","expand-item-original-road").attr("checked","true").on("click",function(){var checkbox=document.getElementById("expand-item-original-road");if(checkbox.checked){originalRoadTag=true}else{originalRoadTag=false}});functionItem.append("label").attr("class","original-road-annotation").text("\u4FDD\u7559\u539F\u59CB\u9053\u8DEF");var buttonContent=expandContent.append("div").attr("class","button-content");buttonContent.append("input").attr("type","button").attr("class","expand-ok").attr("value","\u786E\u5B9A").on("click",function(){var userInputParam={left:"",right:"",originalRoadTag:""};left=document.getElementById("expand-text-left").value;right=document.getElementById("expand-text-right").value;userInputParam.left=left;userInputParam.right=right;userInputParam.originalRoadTag=originalRoadTag;perforFun(userInputParam);closeExpandBox()});new tipUtil.dragDrop({target:document.getElementById("road-expand-box"),bridge:document.getElementById("expand-title-table")})};roadExpandTip.center=function(_){if(_){center=_}else{return center}};return roadExpandTip};;iD.ui.RoadExpandAnimation=function(context){var roadExpandAnimation={},lineCal=iD.util.LineCalCulate();var userInputParam,projection=context.projection;var graph=context.graph();roadExpandAnimation.perform=function(wayIds,_userInputParam){userInputParam=_userInputParam;wayIds.forEach(function(wayId){var survivor=graph.entity(wayId),newNodesLoc=[];if(userInputParam.left&&0<Number(_userInputParam.left)){roadOffset("left",survivor,newNodesLoc)}});wayIds.forEach(function(wayId){var survivor=graph.entity(wayId),newNodesLoc=[];if(userInputParam.right&&0<Number(_userInputParam.right)){roadOffset("right",survivor,newNodesLoc)}})};function roadOffset(position,survivor,newNodesLoc){var distance;if("left"==position){distance=3;if(""!=userInputParam.left){distance=parseFloat(userInputParam.left)}}else{distance=-3;if(""!=userInputParam.right){distance=-parseFloat(userInputParam.right)}}var result=iD.util.RoadOffset().roadOffset(graph,survivor,distance);var pline_cnt=result.length;for(var r=0;r<pline_cnt;r++){var pline=result[r];draw(pline,position)}};function newroad(position,survivor,newNodesLoc){var newLoc;var oldLoc;var interPoint=[0,0];var nodeEntity;var adjoinEntity;for(var i=0;i<survivor.nodes.length-1;i++){nodeEntity=graph.entity(survivor.nodes[i]);adjoinEntity=graph.entity(survivor.nodes[i+1]);if(0==i){newLoc=getLngLat(nodeEntity.loc[0],nodeEntity.loc[1],adjoinEntity.loc[0],adjoinEntity.loc[1],position);interPoint=[newLoc[0].Longitude,newLoc[0].Latitude]}else{if(nodeEntity.loc[0]==adjoinEntity.loc[0]&&adjoinEntity.loc[1]==adjoinEntity.loc[1]&&i<survivor.nodes.length-2){i++;adjoinEntity=graph.entity(survivor.nodes[i+1])}newLoc=getLngLat(nodeEntity.loc[0],nodeEntity.loc[1],adjoinEntity.loc[0],adjoinEntity.loc[1],position);lineCal.getIntersectionPoint(projection,[oldLoc[0].Longitude,oldLoc[0].Latitude],[oldLoc[1].Longitude,oldLoc[1].Latitude],[newLoc[0].Longitude,newLoc[0].Latitude],[newLoc[1].Longitude,newLoc[1].Latitude],interPoint)}newNodesLoc.push([interPoint[0],interPoint[1]]);oldLoc=newLoc}newNodesLoc.push([newLoc[1].Longitude,newLoc[1].Latitude]);draw(newNodesLoc,position)};function draw(newNodesLoc,position){var style={stroke:"rgb(0, 0, 255)",opacity:"0.5","stroke-width":2,"stroke-dasharray":"10, 6"};var nodes=[],mode="distance";newNodesLoc.forEach(function(loc){nodes.push(new Marker({loc:loc}))});var polyline=new Polyline({nodes:nodes,mode:"polyline",onDraw:function(element){element.style(style)}});context.map().addOverlays(polyline);context.event.drawstart({overlay:polyline,mode:mode});context.event.drawoverlayers();context.event.drawing({overlay:polyline,mode:mode});iD.expandRoadAnimation.addExpandRoadObj(polyline)}function getLngLat(lngA,latA,lngB,latB,position){var result=new Array;var angle=lineCal.getAngle(lngA,latA,lngB,latB);var distance=0.003;if("left"==position){angle=angle-90+360;if(""!=userInputParam.left){distance=userInputParam.left/1000}}else if("right"==position){angle=angle+90+360;if(""!=userInputParam.right){distance=userInputParam.right/1000}}var newPointA={};var newPointB={};var pointA=lineCal.calculateVerticalP(lngA,latA,distance,angle);newPointA.Longitude=pointA.Longitude;newPointA.Latitude=pointA.Latitude;result.push(newPointA);var pointB=lineCal.calculateVerticalP(lngB,latB,distance,angle);newPointB.Longitude=pointB.Longitude;newPointB.Latitude=pointB.Latitude;result.push(newPointB);return result};return roadExpandAnimation};(function(iD){var expandRoadAnimationObjs=[];iD=iD||{};iD.expandRoadAnimation={addExpandRoadObj:function(obj){expandRoadAnimationObjs.push(obj)},resetExpandObjs:function(){expandRoadAnimationObjs=[]},getExpandRoadObj:function(){return expandRoadAnimationObjs}}})(iD);;;iD.ui.TipUtil=function(context){var tipUtil={};tipUtil.getMousePos=function(){var event=d3.event;var e=event||window.event;return{X:e.screenX,Y:e.screenY}};tipUtil.dragDrop=function(option){this.target=option.target;this.dragX=false!=option.dragX;this.dragY=false!=option.dragY;this.disX=0;this.disY=0;this.bridge=option.bridge;this.area=option.area;this.callback=option.callback;this.target.style.zIndex="0";var _this=this;this.bridge&&(this.bridge.onmouseover=function(){_this.bridge.style.cursor="move"});this.bridge?this.bridge.onmousedown=function(e){_this.mousedown(e)}:this.target.onmousedown=function(e){_this.mousedown(e)}};tipUtil.dragDrop.prototype={mousedown:function(e){var e=e||event;var _this=this;this.disX=e.clientX-this.target.offsetLeft;this.disY=e.clientY-this.target.offsetTop;this.target.style.cursor="move";if(window.captureEvents){e.stopPropagation();e.preventDefault()}else{e.cancelBubble=true}if(this.target.setCapture){this.target.onmousemove=function(e){_this.move(e)};this.target.onmouseup=function(e){_this.mouseup(e)};this.target.setCapture()}else{document.onmousemove=function(e){_this.move(e)};document.onmouseup=function(e){_this.mouseup(e)}}},move:function(e){this.target.style.margin=0;var e=e||event;var scrollTop=document.documentElement.scrollTop||document.body.scrollTop;var moveX=e.clientX-this.disX;var moveY=e.clientY-this.disY;if(this.area){moveX<_this.area[0]&&(moveX=this.area[0]);moveX>_this.area[1]&&(moveX=this.area[1]);moveY<_this.area[2]&&(moveY=this.area[2]);moveY>_this.area[3]&&(moveY=this.area[3])}this.dragX&&(this.target.style.left=moveX+"px");this.dragY&&(this.target.style.top=moveY+"px");0>parseInt(this.target.style.top)&&(this.target.style.top=0);0>parseInt(this.target.style.left)&&(this.target.style.left=0);parseInt(this.target.style.left)>document.documentElement.clientWidth-this.target.offsetWidth&&(this.target.style.left=document.documentElement.clientWidth-this.target.offsetWidth+"px");parseInt(this.target.style.top)>scrollTop+document.documentElement.clientHeight-this.target.offsetHeight&&(this.target.style.top=scrollTop+document.documentElement.clientHeight-this.target.offsetHeight+"px");if(this.callback){var obj={moveX:moveX,moveY:moveY};this.callback.call(this,obj)}return false},mouseup:function(e){var e=e||event;this.target.style.cursor="default";var _this=this;this.target.onmousemove=null;this.target.onmouseup=null;document.onmousemove=null;document.onmouseup=null;if(this.target.releaseCapture){this.target.releaseCapture()}}};return tipUtil};;iD.ui.AdasPasswordTip=function(context,passwordRight,passwordWrong,adasRoads,adasValue){var adsPassword={},modal,res=false;function openAdasPasswordBox(tip){res=false;modal=iD.ui.modal(context.container());modal.select(".modal").attr("class","modal-splash modal KDSEditor-col6");modal.select("button.close").attr("class","hide");modal.append("div").attr("class","adasPwDiv").attr("id","adasPwDiv");var adasPwDiv=d3.select(".adasPwDiv");var adasPw=adasPwDiv.append("div").attr("class","adasPw").attr("id","adasPw");var titleTable=adasPw.append("table").attr("class","adasPw-title-table").attr("id","adasPw-title-table").attr("cellspacing","0");var tbody=titleTable.append("tbody");var tr=tbody.append("tr");tr.append("td").attr("class","adasPw-title-content-td").text("ADAS\u6765\u6E90\u4FEE\u6539");tr.append("td").attr("class","adasPw-title-close-td").on("click",function(){closeAdasPasswordBox()}).append("span").attr("class","adasPw-title-close-span").text("\xD7");var notice=adasPw.append("div").attr("class","adasPw-notice");notice.append("div").attr("class","adasPw-noticeContent").text(tip);notice.append("input").attr("class","adasPw-passwd").attr("id","adasPw-passwd").attr("type","password");notice.append("div").attr("class","adasPw-passwordErr").attr("id","adasPw-passwordErr").text("\u5BC6\u7801\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165!").attr("class","hide");var button=adasPw.append("div").attr("class","adasPw-buttons");button.append("input").attr("type","button").attr("class","adasPw-ok").attr("value","\u786E \u5B9A").on("click",function(){var passwd=document.getElementById("adasPw-passwd").value;var err=d3.select("#adasPw-passwordErr");if(passwd==iD.AdasPassword.password){err.attr("class","hidden");res=true;closeAdasPasswordBox()}else{res=false;err.attr("class","adasPw-passwordErr")}});button.append("input").attr("type","button").attr("class","adasPw-cancel").attr("value","\u53D6 \u6D88").on("click",function(){closeAdasPasswordBox()})}function closeAdasPasswordBox(){var delDiv=document.getElementById("adasPwDiv");if(null!=delDiv){delDiv.parentNode.removeChild(delDiv);modal.close();if(true==res){if(passwordRight)passwordRight(adasRoads,adasValue)}else{if(passwordWrong)passwordWrong()}}}adsPassword.perform=function(tip){var delDiv=document.getElementById("adasPwDiv");if(null==delDiv){openAdasPasswordBox(tip);if(false==res){if(passwordWrong)passwordWrong()}else{if(passwordRight)passwordRight(adasRoads,adasValue)}}};return adsPassword};;iD.compareTimeOverlap=function(typeA,typeB,timeA,timeB){function strToHourMinute(str){var parts=str.split(":");var hh_mm=[];hh_mm[0]=parseInt(parts[0]);hh_mm[1]=parseInt(parts[1]);return hh_mm}function lessThan(start,end){var hh_mm_1=strToHourMinute(start);var hh_mm_2=strToHourMinute(end);if(hh_mm_1[0]<hh_mm_2[0]){return true}else if(hh_mm_1[0]==hh_mm_2[0]&&hh_mm_1[1]<=hh_mm_2[1]){return true}return false}function isTimeOverlap(rA,range){if(range.some(function(r){if(!(lessThan(r.end,rA.start)||lessThan(rA.end,r.start))){return true}})){return true}return false}function isTimeRangeOver(timeRangeA,timeRangeB){if(timeRangeA.some(function(r){if(isTimeOverlap(r,timeRangeB)){return true}})){return true}return false}function strToMonthDay(data){var parts=data.split("-");var hh_mm=[];hh_mm[0]=parseInt(parts[0]);hh_mm[1]=parseInt(parts[1]);return hh_mm}function lessThanData(mm_dd_1,mm_dd_2){if(mm_dd_1[0]<mm_dd_2[0]){return true}else if(mm_dd_1[0]==mm_dd_2[0]){if(mm_dd_1[1]<=mm_dd_2[1]){return true}}return false}function isDataOverlap(dateA,dateB){var mm_dd_1=strToMonthDay(dateA.start);var mm_dd_2=strToMonthDay(dateA.end);var mm_dd_3=strToMonthDay(dateB.start);var mm_dd_4=strToMonthDay(dateB.end);if(lessThanData(mm_dd_2,mm_dd_3)||lessThanData(mm_dd_3,mm_dd_1))return false;return true}function isDataRangeOver(dateRangeA,dateRangeB){if(0==dateRangeA.length&&0==dateRangeB.length){return"undefined"}else if(0==dateRangeA.length||0==dateRangeB.length){return"separate"}for(var a=0;a<dateRangeA.length;a++){for(var b=0;b<dateRangeB.length;b++){if(isDataOverlap(dateRangeA[a],dateRangeB[b]))return"overlap"}}return"separate"}function isSeasonOver(seasonA,seasonB){if(0==seasonA.length&&0==seasonB.length){return"undefined"}else if(0==seasonA.length||0==seasonB.length){return"separate"}for(var a=0;a<seasonA.length;a++){for(var b=0;b<seasonB.length;b++){if(seasonA[a]==seasonB[b])return"overlap"}}return"separate"}function isWeekDayOver(weekDayA,weekDayB){if(0==weekDayA.length&&0==weekDayB.length){return"undefined"}else if(0==weekDayA.length||0==weekDayB.length){return"separate"}for(var a=0;a<weekDayA.length;a++){for(var b=0;b<weekDayB.length;b++){if(weekDayA[a]==weekDayB[b])return"overlap"}}return"separate"}function isHolidayOver(holidayA,holidayB){if(holidayA==holidayB){return"overlap"}return"separate"}var bTime=isTimeRangeOver(timeA.timeRange,timeB.timeRange),bData=isDataRangeOver(timeA.dateRange,timeB.dateRange),bSeason=isSeasonOver(timeA.season,timeB.season),bWeek=isWeekDayOver(timeA.weekDay,timeB.weekDay),bHoliday=isHolidayOver(timeA.holiday,timeB.holiday);if(!bTime)return false;if("separate"==bData)return false;if("separate"==bSeason)return false;if("separate"==bWeek)return false;if("separate"==bHoliday)return false;if(0==typeA&&1==typeB||1==typeA&&0==typeB||2==typeA&&1==typeB||1==typeA&&2==typeB)return false;return true};iD.convertGDFToInfo=function(gdfTime){function IsNumber(ch){switch(ch){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return true;}return false}function strToHourMinute(str){var time=[],count=0;var ch,sub,hour,minute;for(var i=0;i<str.length;i++){ch=str.charAt(i);if("h"==ch){sub=undefined;count=1}else if("m"==ch){if(1==count){hour=sub}sub=undefined;count=2}else if(IsNumber(ch)){if(0<count){if(sub==undefined)sub=ch;else sub+=ch}}else{if(1==count){hour=sub}else if(2==count){minute=sub}sub=undefined;count++}}if(1==count){hour=sub}else if(2==count){minute=sub}if(hour==undefined)time[0]=0;else time[0]=parseInt(hour);if(minute==undefined)time[1]=0;else time[1]=parseInt(minute);return time}function ComputerEndTime(start_t,end_t){if(start_t==undefined||end_t==undefined){return false}var hour=start_t[0]+end_t[0];var minute=start_t[1]+end_t[1];if(60<=minute){minute-=60;hour+=1}if(24==hour&&0==minute){}else if(24<=hour){hour-=24}end_t[0]=hour;end_t[1]=minute;return true}function arrToTime(start_t){var time;if(10>start_t[0]){time="0"+start_t[0]}else{time=start_t[0].toString()}time+=":";if(10>start_t[1]){time+="0"+start_t[1]}else{time+=start_t[1].toString()}return time}function strToTime(str,hourminue){var start_t,end_t,sub;var first=str.indexOf("("),last=str.indexOf(")");if(0<=first&&0<=last){sub=str.slice(first+1,last);start_t=strToHourMinute(sub)}first=str.indexOf("{"),last=str.indexOf("}");if(0<=first&&0<=last){sub=str.slice(first+1,last);end_t=strToHourMinute(sub)}if(ComputerEndTime(start_t,end_t)){var time={start:arrToTime(start_t),end:arrToTime(end_t)};hourminue.push(time)}}function gdfToTimeRange(gdfTime){var hourminue=[];var first=gdfTime.indexOf("[(h"),last,str;while(0<=first){last=gdfTime.indexOf("]",first);if(-1==last)break;str=gdfTime.slice(first,last+1);strToTime(str,hourminue);first=gdfTime.indexOf("[(h",last)}return hourminue}function ComputerEndDate(start_t,end_t){if(start_t==undefined||end_t==undefined){return false}var days=[31,28,31,30,31,30,31,31,30,31,30,31];var month=start_t[0]+end_t[0];var day=start_t[1]+end_t[1]-1;if(day>days[month-1]){day=end_t[1]-(days[start_t[0]-1]-start_t[1]);month+=1}if(12<month){month-=12}end_t[0]=month;end_t[1]=day;return true}function arrToDate(start_t){var data=start_t[0].toString()+"-"+start_t[1].toString();return data}function strToMonthDay(str){var date=[],count=0;var ch,sub,month,day;for(var i=0;i<str.length;i++){ch=str.charAt(i);if("M"==ch){sub=undefined;count=1}else if("d"==ch){if(1==count){month=sub}sub=undefined;count=2}else if(IsNumber(ch)){if(0<count){if(sub==undefined)sub=ch;else sub+=ch}}else{if(1==count){month=sub}else if(2==count){day=sub}sub=undefined;count++}}if(1==count){month=sub}else if(2==count){day=sub}if(month==undefined)date[0]=0;else date[0]=parseInt(month);if(day==undefined)date[1]=0;else date[1]=parseInt(day);return date}function strToDate(str,monthday){var start_t,end_t,sub;var first=str.indexOf("("),last=str.indexOf(")");if(0<=first&&0<=last){sub=str.slice(first+1,last);start_t=strToMonthDay(sub)}first=str.indexOf("{"),last=str.indexOf("}");if(0<=first&&0<=last){sub=str.slice(first+1,last);end_t=strToMonthDay(sub)}if(ComputerEndDate(start_t,end_t)){var time={start:arrToDate(start_t),end:arrToDate(end_t)};monthday.push(time)}}function gdfToDataRange(gdfTime){var monthday=[];var first=gdfTime.indexOf("[(M"),last,str;while(0<=first){last=gdfTime.indexOf("]",first);if(-1==last)break;str=gdfTime.slice(first,last+1);strToDate(str,monthday);first=gdfTime.indexOf("[(M",last)}return monthday}function strToWeekStart(str){var count=0;var ch,sub,week;for(var i=0;i<str.length;i++){ch=str.charAt(i);if("t"==ch){sub=undefined;count=1}else if(IsNumber(ch)){if(0<count){if(sub==undefined)sub=ch;else sub+=ch}}else{if(1==count){week=sub}sub=undefined;count++}}if(1==count){week=sub}if(week==undefined)return undefined;else return parseInt(week)}function strToWeekDuration(str){var count=0;var ch,sub,week;for(var i=0;i<str.length;i++){ch=str.charAt(i);if("d"==ch){sub=undefined;count=1}else if(IsNumber(ch)){if(0<count){if(sub==undefined)sub=ch;else sub+=ch}}else{if(1==count){week=sub}sub=undefined;count++}}if(1==count){week=sub}if(week==undefined)return undefined;else return parseInt(week)}function strToWeekDay(start_t,dur,week){var day;for(var i=0;i<dur;i++){day=start_t+i-1;if(7<day)day-=7;else if(0==day)day=7;week.push(day.toString())}}function strToWeek(str,week){var start_t,dur,sub;var first=str.indexOf("("),last=str.indexOf(")");if(0<=first&&0<=last){sub=str.slice(first+1,last);start_t=strToWeekStart(sub)}first=str.indexOf("{"),last=str.indexOf("}");if(start_t!=undefined&&0<=first&&0<=last){sub=str.slice(first+1,last);dur=strToWeekDuration(sub);strToWeekDay(start_t,dur,week)}}function gdfToWeekDay(gdfTime){var week=[];var first=gdfTime.indexOf("[(t"),last,str;while(0<=first){last=gdfTime.indexOf("]",first);if(-1==last)break;str=gdfTime.slice(first,last+1);strToWeek(str,week);first=gdfTime.indexOf("[(t",last)}return week}function gdfToHoliday(gdfTime){var pos=gdfTime.indexOf("-[(z4){z54}]");if(0<=pos){return"2"}pos=gdfTime.indexOf("[(z4){z54}]");if(0<=pos){return"1"}return"0"}function gdfToSeason(gdfTime){var seasons=[];var pos=gdfTime.indexOf("[(z5){z55}]");if(-1!=pos){seasons.push("spring")}pos=gdfTime.indexOf("[(z6){z56}]");if(-1!=pos){seasons.push("summer")}pos=gdfTime.indexOf("[(z7){z57}]");if(-1!=pos){seasons.push("autumn")}pos=gdfTime.indexOf("[(z8){z58}]");if(-1!=pos){seasons.push("winter")}pos=gdfTime.indexOf("[(z14){z64}]");if(-1!=pos){seasons.push("dry")}pos=gdfTime.indexOf("[(z13){z63}]");if(-1!=pos){seasons.push("rainy")}return seasons}var info={};info.timeRange=gdfToTimeRange(gdfTime);info.dateRange=gdfToDataRange(gdfTime);info.holiday=gdfToHoliday(gdfTime);info.weekDay=gdfToWeekDay(gdfTime);info.season=gdfToSeason(gdfTime);return info};iD.convertInfoToGDF=function(timeInfo){function addMultiply(str1,str2){if(str1==undefined){return str2}if(str2==undefined){return str1}return str1+"*"+str2}function addPlus(str1,str2){if(str1==undefined){return str2}if(str2==undefined){return str1}return str1+"+"+str2}function addTail(str1,str2){if(str1==undefined){return str2}if(str2==undefined){return str1}return str1+str2}function addCommon(str){if(str==undefined){return str}return"["+str+"]"}function toGDFStr(start,duration){return"[("+start+"){"+duration+"}]";;}function strToHourMinute(str){var parts=str.split(":");var hh_mm=[];hh_mm[0]=parseInt(parts[0]);hh_mm[1]=parseInt(parts[1]);return hh_mm}function timeToDuration(hh_mm_1,hh_mm_2){var hh_mm=[];if(hh_mm_1[0]<hh_mm_2[0]){if(hh_mm_1[1]<=hh_mm_2[1]){hh_mm[0]=hh_mm_2[0]-hh_mm_1[0];hh_mm[1]=hh_mm_2[1]-hh_mm_1[1]}else{hh_mm[0]=hh_mm_2[0]-hh_mm_1[0]-1;hh_mm[1]=60-hh_mm_1[1]+hh_mm_2[1]}}else if(hh_mm_1[0]==hh_mm_2[0]){if(hh_mm_1[1]<=hh_mm_2[1]){hh_mm[0]=0;hh_mm[1]=hh_mm_2[1]-hh_mm_1[1]}else{hh_mm[0]=24;hh_mm[1]=hh_mm_2[1]+60-hh_mm_1[1]}}else{if(hh_mm_1[1]<=hh_mm_2[1]){hh_mm[0]=24-hh_mm_1[0]+hh_mm_2[0];hh_mm[1]=hh_mm_2[1]-hh_mm_1[1]}else{hh_mm[0]=24-hh_mm_1[0]+hh_mm_2[0]-1;hh_mm[1]=60-hh_mm_1[1]+hh_mm_2[1]}}return hh_mm}function timeToGDF(start,end){var hh_mm_1=strToHourMinute(start);var hh_mm_2=strToHourMinute(end);var hh_mm_3=timeToDuration(hh_mm_1,hh_mm_2);var start_time="h"+hh_mm_1[0];if(0<hh_mm_1[1])start_time+="m"+hh_mm_1[1];var duration="h"+hh_mm_3[0];if(0<hh_mm_3[1])duration+="m"+hh_mm_3[1];return toGDFStr(start_time,duration)}function timeRangeToGDF(timeRange){var gdf,val;for(var i=0;i<timeRange.length;i++){val=timeToGDF(timeRange[i].start,timeRange[i].end);gdf=addPlus(gdf,val)}if(1<i){gdf=addCommon(gdf)}return gdf}function strToMonthDay(data){var parts=data.split("-");var hh_mm=[];hh_mm[0]=parseInt(parts[0]);hh_mm[1]=parseInt(parts[1]);return hh_mm}function dataDuration(mm_dd_1,mm_dd_2){var days=[31,28,31,30,31,30,31,31,30,31,30,31];var mm_dd=[];if(mm_dd_1[0]<mm_dd_2[0]){if(mm_dd_1[1]<=mm_dd_2[1]){mm_dd[0]=mm_dd_2[0]-mm_dd_1[0];mm_dd[1]=mm_dd_2[1]-mm_dd_1[1]}else{mm_dd[0]=mm_dd_2[0]-mm_dd_1[0]-1;mm_dd[1]=days[mm_dd_1[0]-1]-mm_dd_1[1]+mm_dd_2[1]}}else if(mm_dd_1[0]==mm_dd_1[0]){if(mm_dd_1[1]<=mm_dd_1[1]){mm_dd[0]=0;mm_dd[1]=mm_dd_2[1]-mm_dd_1[1]}else{mm_dd[0]=12;mm_dd[1]=days[mm_dd_1[0]-1]-mm_dd_1[1]+mm_dd_2[1]}}else{if(mm_dd_1[1]<=mm_dd_1[1]){mm_dd[0]=12-mm_dd_1[0]+mm_dd_2[0];mm_dd[1]=mm_dd_2[1]-mm_dd_1[1]}else{mm_dd[0]=12-mm_dd_1[0]+mm_dd_2[0]-1;mm_dd[1]=days[mm_dd_1[0]-1]-mm_dd_1[1]+mm_dd_2[1]}}mm_dd[1]+=1;return mm_dd}function dataToGDF(start,end){var mm_dd_1=strToMonthDay(start);var mm_dd_2=strToMonthDay(end);var mm_dd_3=dataDuration(mm_dd_1,mm_dd_2);var start_md="M"+mm_dd_1[0]+"d"+mm_dd_1[1];var duration;if(0<mm_dd_3[0])duration="M"+mm_dd_3[0];if(0<mm_dd_3[1]){if(duration==undefined)duration="d"+mm_dd_3[1];else duration+="d"+mm_dd_3[1]}if(duration==undefined)duration="d0";return toGDFStr(start_md,duration)}function dataRangeToGDF(dateRange){var gdf,val;for(var i=0;i<dateRange.length;i++){val=dataToGDF(dateRange[i].start,dateRange[i].end);gdf=addPlus(gdf,val)}if(1<i){gdf=addCommon(gdf)}return gdf}function addWeekDay(prev,last){var delta=last-prev+1;if(7!=delta){prev++}if(8==prev){prev=1}return"[(t"+prev+"){d"+delta+"}]"}function weekDayToGDF(weekDay){var gdf,count=0;var prev,last,val,delta;for(var i=0;i<weekDay.length;i++){val=parseInt(weekDay[i]);if(prev==undefined){prev=val;last=val}else{delta=val-last;if(1==delta){last=val}else{delta=addWeekDay(prev,last);gdf=addPlus(gdf,delta);prev=val;last=val;count++}}}if(prev!=undefined){delta=addWeekDay(prev,last);gdf=addPlus(gdf,delta);count++}if(1<count){gdf=addCommon(gdf)}return gdf}function seasonToGDFStr(season){switch(season){case"spring":return"[(z5){z55}]";break;case"summer":return"[(z6){z56}]";break;case"autumn":return"[(z7){z57}]";break;case"winter":return"[(z8){z58}]";break;case"dry":return"[(z14){z64}]";break;case"rainy":return"[(z13){z63}]";break;}return undefined}function seasonToGDF(season){var gdf,val;for(var i=0;i<season.length;i++){val=seasonToGDFStr(season[i]);gdf=addPlus(gdf,val)}if(1<i){gdf=addCommon(gdf)}return gdf}function holidayToGDF(holiday){var gdf;if(1==holiday){gdf="[(z4){z54}]"}else if(2==holiday){gdf="-[(z4){z54}]"}return gdf}var count=0;if(timeInfo.timeRange){var timeRange=timeRangeToGDF(timeInfo.timeRange);if(timeRange!=undefined){count++}}if(timeInfo.dateRange){var dateRange=dataRangeToGDF(timeInfo.dateRange);if(dateRange!=undefined){timeRange=addMultiply(timeRange,dateRange);count++}}if(timeInfo.weekDay){var weekDay=weekDayToGDF(timeInfo.weekDay);if(weekDay!=undefined){timeRange=addMultiply(timeRange,weekDay);count++}}if(timeInfo.season){var season=seasonToGDF(timeInfo.season);if(season!=undefined){timeRange=addMultiply(timeRange,season);count++}}if(timeInfo.holiday){var holiday=holidayToGDF(timeInfo.holiday);if(holiday!=undefined){if(1==timeInfo.holiday)timeRange=addMultiply(timeRange,holiday);else timeRange=addTail(timeRange,holiday);count++}}if(1<count){timeRange=addCommon(timeRange)}return timeRange};iD.gdfTest1=function(){var info={timeRange:[{start:"00:00",end:"02:59"},{start:"03:00",end:"23:59"}],dateRange:[{start:"1-1",end:"3-31"},{start:"5-25",end:"8-18"},{start:"9-20",end:"10-10"}],weekDay:["2","6","7"],season:["summer","autumn"],holiday:"2"};var gdftime=iD.convertInfoToGDF(info);var result=iD.convertGDFToInfo(gdftime);gdftime+="----[]"};iD.gdfTest2=function(){var info={timeRange:[{start:"00:00",end:"23:59"}],dateRange:[{start:"1-1",end:"12-31"}],weekDay:["2","6"],season:["spring","summer","autumn","winter","dry","rainy"],holiday:"1"};var gdftime=iD.convertInfoToGDF(info);var result=iD.convertGDFToInfo(gdftime);gdftime+="----[]"};iD.gdfTest=function(info){var gdftime=iD.convertInfoToGDF(info);var result=iD.convertGDFToInfo(gdftime);gdftime+="----[]"};iD.gdfTest_1=function(){var info={timeRange:[],dateRange:[{start:"2-26",end:"3-8"},{start:"1-29",end:"2-27"}],weekDay:["2","6","7"],season:["summer","autumn"],holiday:"2"};iD.gdfTest(info)};iD.testGDF=function(){iD.gdfTest_1();iD.gdfTest1();iD.gdfTest2()};;iD.ui.RoadRuleEditor=function(context){var event=d3.dispatch("apply"),transportation,modal,nodeId,nodeDataType,fromWayId,toWayId,relations=[],deleteRelations=[],editRelation,relationTemplate={},maat,edit={},timeRuleObj={time1:"",time2:""},ruleTypeBinary=[0,0,0];var _Util={_cars:_.map(iD.ui.RoadRule.CarList.carOptions,function(item){return _.assign({},item,{name:item.label})}),_2To16:function(v){return parseInt(v,2).toString(16).toUpperCase()},_16To2:function(v){return parseInt(v,16).toString(2)},_2To10:function(v){return parseInt(v,2).toString(10)},_10To2:function(v){return parseInt(v,10).toString(2)},_createHexadecimalBySelectedCars:function(ids){var temp=[];for(var i=0;32>i;i++){temp.push(0)}_(ids).each(function(id){temp[id]=1});return this._2To16(temp.reverse().join(""))},_getCarNamesByHexadecimal:function(v){var array=[],v=v&&this._16To2(v)||"",cars=this._cars;for(var i=0,l=v.length;i<l;i++){if(1===parseInt(v[i],10)){var obj=searchCar(l-1-i);if(obj){array.push(obj)}}}function searchCar(i){var obj;_(cars).each(function(item){if(item.id===i){obj=item;return false}});return obj}return array}};function compareMember(members){var objA={FROAD_ID:"",ROAD_NODE_ID:"",TROAD_ID:""};_(members).each(function(member){if([iD.data.RoleType.ROAD_NODE_ID,iD.data.RoleType.C_NODE_ID].includes(member.role)){objA.ROAD_NODE_ID=member.id}else{objA[member.role]=member.id}});var objB={FROAD_ID:fromWayId,ROAD_NODE_ID:nodeId,TROAD_ID:toWayId};return _.isEqual(objA,objB)}function parseRuleTime(ruleTime){return iD.convertGDFToInfo(ruleTime||"")}function buildRuleTime(timeInfo){return iD.convertInfoToGDF(timeInfo)}function analyzeSingleRelation(relation){var obj=_.assign({},relation.tags);obj.id=relation.id;obj.rule_type=relation.tags.rule_type||"1";obj.isOuter="1"===relation.tags.licplate;obj.vehicle=_Util._getCarNamesByHexadecimal(relation.tags.VEHICLE||"80000000");obj.modelName=relation.modelName;obj.timeInfo=parseRuleTime(relation.tags.TIME);return obj};function roadRuleEditor(selection){var relationInfo=roadRuleEditor.getRelationInfo();relations=relationInfo.relations;maat=relationInfo.maat;nodeDataType=context.graph().entity(nodeId).modelName||"";nodeDataType=-1<nodeDataType.indexOf(iD.data.DataType.ROAD_NODE)?iD.data.DataType.TRAFFICRULE:iD.data.DataType.C_TRAFFICRULE;modal=iD.ui.modal(selection);modal.select(".modal").classed("modal-alert common-dialog",true);var section=modal.select(".KDSEditor-content");var restriction=section.append("div").attr("class","traffic-area");restriction.append("div").attr("class","title model_title").html("\u9650\u884C\u4FE1\u606F");var wrap=restriction.append("div").attr("class","body");var fromWay=context.graph().entity(fromWayId);var toWay=context.graph().entity(toWayId);var maatType=relationInfo.maatType;if(!maat.id){maat=[];context.perform(iD.actions.AddMaat(maat,fromWayId,toWayId,nodeId,maatType),"\u521B\u5EFAMatt");maat=maat[0]}relationTemplate.modelName=maat.modelName==iD.data.DataType.NODECONN?iD.data.DataType.TRAFFICRULE:iD.data.DataType.C_TRAFFICRULE;relationTemplate.layerId=iD.Layers.getCurrentModelEnableLayer(relationTemplate.modelName).id;relationTemplate.members=[{id:maat.id,role:maat.modelName==iD.data.DataType.NODECONN?iD.data.RoleType.NODECONN_ID:iD.data.RoleType.C_NODECONN_ID,type:iD.data.GeomType.RELATION,modelName:maat.modelName}];drawRestrictionList();function drawRestrictionList(){modal.classed("restriction_detail",false);var fieldKey=iD.Layers.getLayer(fromWay.layerId).label.fieldKey||"name_chn";var items=wrap.html("");var aName=iD.util.displayName(fromWay,fieldKey)||"\u672A\u77E5\u9053\u8DEF";var bName=iD.util.displayName(toWay,fieldKey)||"\u672A\u77E5\u9053\u8DEF";modal.select("div.model_title").html("\u4ECE <strong>"+aName+"</strong> \u5230 <strong>"+bName+"</strong> \u7684\u9650\u884C\u4FE1\u606F: ");var dl=items.append("dl").attr("class","time-list");var dl_title=dl.append("dt");dl_title.append("b").html("\u7C7B\u578B");dl_title.append("b").html("\u5916\u57E0\u9650\u5236");dl_title.append("b").html("\u8F66\u8F86\u9650\u5236");dl_title.append("b").html("\u64CD\u4F5C");var dds=dl.selectAll("dd").data(_.map(relations,function(d){return{relation:d,analyzed:analyzeSingleRelation(d)}}));var enter=dds.enter().append("dd");enter.append("b").attr("class","type");enter.append("b").attr("class","outer");enter.append("b").attr("class","car");var opt=enter.append("b").attr("class","opt");opt.append("button").attr("class","edit button blue").html("\u7F16\u8F91");opt.append("button").attr("class","del button red").html("\u5220\u9664");var ddesc=enter.append("div").attr("class","relDes").attr("id","relDes");ddesc.append("dd").html(function(d){var obj=d.analyzed,cars=obj.vehicle,names=[];_(cars).each(function(o){names.push(o.name)});return"\u8F66\u8F86\uFF1A"+names.join(",")}).classed("hide",function(d){var obj=d.analyzed,cars=obj.vehicle,names=[];_(cars).each(function(o){names.push(o.name)});return 0==names.length});ddesc.append("dd").html(function(d){var obj=d.analyzed,timeRange=obj.timeInfo.timeRange,times=[];_(timeRange).each(function(o){times.push(o.start+"-"+o.end)});return"\u65F6\u95F4\u6BB5\uFF1A"+times.join(",")}).classed("hide",function(d){var obj=d.analyzed,timeRange=obj.timeInfo.timeRange,times=[];_(timeRange).each(function(o){times.push(o.start+"-"+o.end)});return 0==times.length});ddesc.append("dd").html(function(d){var obj=d.analyzed,dateRange=obj.timeInfo.dateRange,dates=[];_(dateRange).each(function(o){dates.push(o.start+"-"+o.end)});return"\u65E5\u671F\u6BB5\uFF1A"+dates.join(",")}).classed("hide",function(d){var obj=d.analyzed,dateRange=obj.timeInfo.dateRange,dates=[];_(dateRange).each(function(o){dates.push(o.start+"-"+o.end)});return 0==dates.length});ddesc.append("dd").html(function(d){var obj=d.analyzed,weekDay=obj.timeInfo.weekDay,weeks=[];var weekObj={1:"\u661F\u671F\u4E00",2:"\u661F\u671F\u4E8C",3:"\u661F\u671F\u4E09",4:"\u661F\u671F\u56DB",5:"\u661F\u671F\u4E94",6:"\u661F\u671F\u516D",7:"\u661F\u671F\u65E5"};_(weekDay).each(function(o){weeks.push(weekObj[o.toString()])});return"\u661F\u671F\uFF1A"+weeks.join(",")}).classed("hide",function(d){var obj=d.analyzed,weekDay=obj.timeInfo.weekDay,weeks=[];var weekObj={1:"\u661F\u671F\u4E00",2:"\u661F\u671F\u4E8C",3:"\u661F\u671F\u4E09",4:"\u661F\u671F\u56DB",5:"\u661F\u671F\u4E94",6:"\u661F\u671F\u516D",7:"\u661F\u671F\u65E5"};_(weekDay).each(function(o){weeks.push(weekObj[o.toString()])});return 0==weeks.length});ddesc.append("dd").html(function(d){var obj=d.analyzed,season=obj.timeInfo.season,seasons=[];var seasonObj={spring:"\u6625\u5B63",summer:"\u590F\u5B63",autumn:"\u79CB\u5B63",winter:"\u51AC\u5B63",dry:"\u5E72\u5B63",rainy:"\u96E8\u5B63/\u6C5B\u671F"};_(season).each(function(o){seasons.push(seasonObj[o.toString()])});return"\u5B63\u8282\uFF1A"+seasons.join(",")}).classed("hide",function(d){var obj=d.analyzed,season=obj.timeInfo.season,seasons=[];var seasonObj={spring:"\u6625\u5B63",summer:"\u590F\u5B63",autumn:"\u79CB\u5B63",winter:"\u51AC\u5B63",dry:"\u5E72\u5B63",rainy:"\u96E8\u5B63/\u6C5B\u671F"};_(season).each(function(o){seasons.push(seasonObj[o.toString()])});return 0==seasons.length});ddesc.append("dd").html(function(d){var obj=d.analyzed,holiday=obj.timeInfo.holiday,holidayObj={0:"\u672A\u8BBE\u5B9A",1:"\u8282\u5047\u65E5",2:"\u8282\u5047\u65E5\u9664\u5916"};return"\u8282\u5047\u65E5\uFF1A"+holidayObj[holiday.toString()]}).classed("hide",function(d){var obj=d.analyzed,holiday=obj.timeInfo.holiday,holidayObj={0:"\u672A\u8BBE\u5B9A",1:"\u8282\u5047\u65E5",2:"\u8282\u5047\u65E5\u9664\u5916"};return"0"==holiday.toString()});enter.on("click",function(d){if("relDes"==this.lastElementChild.className){d3.select(this.lastElementChild).classed("hide",true)}else if("relDes hide"==this.lastElementChild.className){d3.select(this.lastElementChild).classed("hide",false)}});enter.select("b.type").html(function(d){var obj=d.analyzed;return iD.ui.RoadRule.RuleType.getOptionLabel(obj.type)});enter.select("b.outer").html(function(d){var obj=d.analyzed;if(obj.isOuter){return"\u6709"}return"\u65E0"});enter.select("b.car").html(function(d){var obj=d.analyzed,cars=obj.vehicle,names=[];_(cars).each(function(o){names.push(o.name)});return names.join(",")});enter.select("button.edit").on("click",function(d){editRelation=d.relation;drawRestrictionDetail()});enter.select("button.del").on("click",function(d){d=d.relation;if(context.graph().hasEntity(d.id)){deleteRelations.push(context.graph().entity(d.id))}var temp=[];_(relations).each(function(item,index){if(item.id!=d.id){temp.push(item)}});relations=temp;drawRestrictionList()});var bottom=items.append("div").attr("class","bottom");var addRuleBtn=bottom.append("button").attr("class","add-rule button blue").html("\u6DFB\u52A0\u9650\u884C\u89C4\u5219").classed("hide",function(d){var modelConfig=iD.Layers.getLayer(fromWay.layerId,fromWay.modelName);if("check"==d3.select("body").attr("role")||"work"==d3.select("body").attr("role")&&!modelConfig&&!modelConfig.editable){return true}else{return false}}).on("click",btnAddNewRule);if(5>relations.length){addRuleBtn.style("display","")}else{addRuleBtn.style("display","none")}bottom.append("button").attr("class","apply button blue").html("\u5E94\u7528").on("click",btnApply);bottom.append("button").attr("class","cancel button gray").html("\u53D6\u6D88").on("click",btnClose)}function isVehicleOverlap(rA,rB){for(var a=0;a<rA.length;a++){if(31==rA[a].id){rA.pop();rA.push({id:24},{id:25},{id:26},{id:27},{id:28},{id:29},{id:30});break}}for(var b=0;b<rB.length;b++){if(31==rB[b].id){rB.pop();rB.push({id:24},{id:25},{id:26},{id:27},{id:28},{id:29},{id:30});break}}for(var a=0;a<rA.length;a++){for(var b=0;b<rB.length;b++){if(rA[a].id==rB[b].id)return true}}return false}function isTimeOverlap(tagsA,tagsB){if(typeof tagsA.type!=undefined&&typeof tagsB.type!=undefined){if(tagsA.type==tagsB.type&&tagsA.licplate!=tagsB.licplate)return false;if("1"==tagsA.type&&"0"==tagsB.type&&"1"==tagsB.licplate)return false;if("1"==tagsB.type&&"0"==tagsA.type&&"1"==tagsA.licplate)return false;var vehicleA=_Util._getCarNamesByHexadecimal(tagsA.vehicle),vehicleB=_Util._getCarNamesByHexadecimal(tagsB.vehicle);if(isVehicleOverlap(vehicleA,vehicleB)){var timeA=parseRuleTime(tagsA.time),timeB=parseRuleTime(tagsB.time);return iD.compareTimeOverlap(tagsA.type,tagsB.type,timeA,timeB)}}return false}function doEditRuleDetail(newRelation,oldRelation){var carSelectedIds=newRelation.vehicle||[];if(0===carSelectedIds.length){Dialog.alert("\u8BF7\u9009\u62E9\u8981\u9650\u5236\u7684\u8F66\u8F86\uFF01");return;carSelectedIds=[]}var relation;if(editRelation){relation=_.find(relations,function(r){return r.id===editRelation.id})}else{relation=iD.Relation();relation=_.extend(relation,_.clone(relationTemplate));relation.modelName=nodeDataType;relation.tags=iD.util.getDefauteTags(nodeDataType,iD.Layers.getLayer(relation.layerId))}relation=relation.update({tags:_.assign({},relation.tags,{LICPLATE:newRelation.isOuter?"1":"0",TYPE:newRelation.type,VEHICLE:_Util._createHexadecimalBySelectedCars(carSelectedIds),TIME:buildRuleTime(newRelation.timeInfo)})});var tmpEqRel=null;if(relations.some(function(r){if(r.id==relation.id){return}if(_.isEqual(r.tags,relation.tags)){tmpEqRel=r;return true}})){Dialog.alert("\u76F8\u540C\u5185\u5BB9\u7684\u9650\u884C\u4FE1\u606F\u5DF2\u7ECF\u5B58\u5728\uFF01");return}if(relations.some(function(r){if(r.id==relation.id){return}if(isTimeOverlap(r.tags,relation.tags)){tmpEqRel=r;return true}})){Dialog.alert("\u5B58\u5728\u4E24\u6761\u65F6\u95F4\u91CD\u53E0\u7684\u660E\u793A\u65F6\u95F4\u7981\u6B62\u4FE1\u606F\uFF01");return}if(relations.some(function(r){var isSameTypeForbid=function(r_Forbid){if(0!=r_Forbid.tags.LICPLATE||"[(h0){h24}]"!=r_Forbid.tags.TIME){return false}var vh_flag=parseInt(r_Forbid.tags.VCHICLE.slice(0,4),16);if(vh_flag>>15&1==1||vh_flag>>14&1==1||vh_flag>>13&1==1||vh_flag>>9&1==1){return true}else{return false}};if(r.id==relation.id){return}if(1==r.tags.TYPE&&0==relation.tags.TYPE){if(isSameTypeForbid(relation)){return true}else{return false}}else if(0==r.tags.TYPE&&1==relation.tags.TYPE){if(isSameTypeForbid(r)){return true}else{return false}}})){Dialog.alert("\u9AD8\u5FB7\u63A8\u8350\u4E0D\u80FD\u4E0E\u53EA\u5305\u542B\u201C\u5C0F\u8F7F\u8F66\u3001\u5C0F\u578B\u5BA2\u8F66\u3001\u5FAE\u578B\u8F66\u3001\u5168\u90E8\u8F66\u8F86\u201D\u3001\u975E\u5916\u57E0\uFF0C24\u5C0F\u65F6\u5F3A\u5236\u7981\u6B62\u4FE1\u606F\u540C\u65F6\u5B58\u5728\uFF01");return}console.log("road rule",relation);if(editRelation){edit[relation.id]=true}if(!editRelation){relations.push(relation)}else{var temp=[];_(relations).each(function(r){if(r.id!=editRelation.id){temp.push(r)}});relations=temp;relations.push(relation)}editRelation=null;relation=null;drawRestrictionList()}var defaultNewRelation={vehicle:[{id:31}],type:"0",timeInfo:{timeRange:[{start:"00:00",end:"24:00"}]}};var blockTypeFlag=false;let _entity=context.entity(nodeId);let topoEntity=iD.TopoEntity();let crossNodeMembers=[];if(_entity.isRoadCross()){crossNodeMembers=topoEntity.getCrossNodeMembers(context.graph(),_entity.id)}if(_entity.isRoadCross()||fromWayId==toWayId){blockTypeFlag=false}else if("0"==_entity.tags.realnode){blockTypeFlag=true}var ruleTypeFlag=false;var ruleTypeFlagFrom=false;var ruleTypeFlagTo=false;if("1"===fromWay.tags.DIRECTION){ruleTypeFlagFrom=true}else if("2"===fromWay.tags.DIRECTION){if(fromWay.last()===nodeId){ruleTypeFlagFrom=true}else if(_entity.isRoadCross()){if(-1!=crossNodeMembers.indexOf(fromWay.last())){ruleTypeFlagFrom=true}crossNodeMembers.forEach(function(member){if(member.id==fromWay.last()){ruleTypeFlagFrom=true}})}}else if("3"===fromWay.tags.DIRECTION){if(fromWay.first()===nodeId){ruleTypeFlagFrom=true}else if(_entity.isRoadCross()){crossNodeMembers.forEach(function(member){if(member.id==fromWay.first()){ruleTypeFlagFrom=true}})}}if(ruleTypeFlagFrom){if("1"===toWay.tags.DIRECTION){ruleTypeFlagTo=true}else if("3"===toWay.tags.DIRECTION){if(toWay.last()===nodeId){ruleTypeFlagTo=true}else if(_entity.isRoadCross()){if(-1!=crossNodeMembers.indexOf(toWay.last())){ruleTypeFlagTo=true}crossNodeMembers.forEach(function(member){if(member.id==toWay.last()){ruleTypeFlagTo=true}})}}else if("2"===toWay.tags.DIRECTION){if(toWay.first()===nodeId){ruleTypeFlagTo=true}else if(_entity.isRoadCross()){crossNodeMembers.forEach(function(member){if(member.id==toWay.first()){ruleTypeFlagTo=true}})}}}if(ruleTypeFlagFrom&&ruleTypeFlagTo){ruleTypeFlag=true}if(!ruleTypeFlag){defaultNewRelation.type="2"}var ruleDetailFormTpl=[{title:null,render:iD.ui.RoadRule.RuleType(ruleTypeFlag,blockTypeFlag),setVal:function(render,editRelation){render.val(editRelation.type)},getVal:function(render,newRelation){newRelation.type=render.val()||"0"},onChange:function($formGrps,d){var isAmapRecommend="1"===d.render.val();[{id:"time-range",val:[{start:"00:00",end:"24:00"}]},{id:"vehicle",val:[31]},{id:"outerlnk",val:[]},{id:"holiday",val:[]},{id:"season",val:[]},{id:"date-range",val:[]},{id:"weekday",val:[]}].forEach(function(d){var inpInfo=d3.select("#traffic-rule-grp-"+d.id).datum();inpInfo.render.disable(isAmapRecommend);if(isAmapRecommend){inpInfo.render.val(d.val)}})}},{id:"outerlnk",title:null,render:iD.ui.RoadRule.MultiCheck({options:[{label:"\u5916\u57E0\u9650\u5236",name:"outer",value:"outer"}]}),setVal:function(render,editRelation){var vals={};if(editRelation.isOuter){vals.outer="outer"}render.val(vals)},getVal:function(render,newRelation){var vals=render.val();if(vals.outer){newRelation.isOuter=true}}},{id:"vehicle",title:"\u8F66\u8F86",render:iD.ui.RoadRule.CarList(),setVal:function(render,editRelation){render.val(_.map(editRelation.vehicle,function(item){return item.id}))},getVal:function(render,newRelation){newRelation.vehicle=render.val()}},{id:"time-range",title:"\u65F6\u95F4\u6BB5",render:iD.ui.RoadRule.TimeRange({limit:5}),setVal:function(render,editRelation){render.val(editRelation.timeInfo.timeRange)},getVal:function(render,newRelation){newRelation.timeInfo.timeRange=render.val()}},{id:"date-range",title:"\u65E5\u671F",render:iD.ui.RoadRule.DateRange({limit:2}),fold:1,setVal:function(render,editRelation){render.val(editRelation.timeInfo.dateRange)},getVal:function(render,newRelation){newRelation.timeInfo.dateRange=render.val()}},{id:"weekday",title:"\u661F\u671F",render:iD.ui.RoadRule.WeekDay(),fold:1,setVal:function(render,editRelation){render.val(editRelation.timeInfo.weekDay)},getVal:function(render,newRelation){newRelation.timeInfo.weekDay=render.val()}},{id:"season",title:"\u5B63\u8282",render:iD.ui.RoadRule.Season(),fold:1,setVal:function(render,editRelation){render.val(editRelation.timeInfo.season)},getVal:function(render,newRelation){newRelation.timeInfo.season=render.val()}},{id:"holiday",title:"\u8282\u5047\u65E5",render:iD.ui.RoadRule.Holiday(),fold:1,setVal:function(render,editRelation){render.val(editRelation.timeInfo.holiday||"0")},getVal:function(render,newRelation){newRelation.timeInfo.holiday=render.val()}}];function drawRestrictionDetail(){if(editRelation){editRelation=analyzeSingleRelation(editRelation)}modal.select("div.model_title").html((editRelation?"\u7F16\u8F91":"\u521B\u5EFA")+"\u4E00\u6761\u9650\u884C\u89C4\u5219");modal.classed("restriction_detail",true);var items=wrap.html("");var $form=items.append("div").attr("class","rule-grplist");var $formGrps=$form.selectAll("div.rule-group").data(ruleDetailFormTpl);var $newGrps=$formGrps.enter().append("div").attr("class","rule-group cf").attr("id",function(d,idx){return"traffic-rule-grp-"+(d.id?d.id:idx)});$newGrps.append("h3").attr("class","rule-group-title fold_title").on("click",function(d){var grp=d3.select(this.parentNode);grp.classed("fold",!grp.classed("fold"))});$newGrps.append("div").attr("class","rule-group-body fold_body cf");$formGrps.classed("fold",function(d){return d.fold});$formGrps.selectAll("h3.rule-group-title").classed("no-title",function(d){return!d.title}).html(function(d){return d.title});$formGrps.selectAll("div.rule-group-body").each(function(d){if(d.onChange){d.render.on("change",function(){d.onChange.apply(null,[$formGrps,d])})}d3.select(this).call(d.render)});$formGrps.selectAll("div.rule-group-body").each(function(d){if(d.setVal){d.setVal(d.render,editRelation||defaultNewRelation);var changeFunc=d.render.on("change");if(changeFunc){changeFunc()}}});var bottom=wrap.append("div").attr("class","bottom");bottom.append("button").attr("class","apply button blue").on("click",function(){var newRelation={timeInfo:{}};var passed=true;$formGrps.selectAll("div.rule-group-body").each(function(d){if(!passed){return}var validateFunc=d.validate||d.render.validate;if(validateFunc){var validateResult=validateFunc();if(false!==validateResult){var $topGrp=d3.select(this.parentNode);$topGrp.classed("fold",false);passed=false;return false}}if(d.getVal){d.getVal(d.render,newRelation,editRelation)}});if(!passed){return}doEditRuleDetail(newRelation,editRelation)}).html(editRelation?"\u4FEE\u6539":"\u6DFB\u52A0");bottom.append("button").attr("class","cancel button gray").html("\u53D6\u6D88").on("click",btnCancel)}function btnAddNewRule(){editRelation=null;drawRestrictionDetail()}function btnClose(){modal.close()}function btnCancel(){editRelation=null;drawRestrictionList()}function btnApply(){if("work"==d3.select("body").attr("role")&&context.layers().getCurrentModelEnableLayer(iD.data.DataType.ROAD)){relations.forEach(function(v,k){context.graph().hasEntity(v.id)&&!edit[v.id]&&(relations[k]=context.graph().entity(v.id));relations[k]=iD.util.tagExtend.updateVerifyTag(relations[k])});context.perform(iD.actions.EditRelation(context,relations,deleteRelations),"\u66F4\u65B0\u9650\u884C\u5173\u7CFB")}btnClose()}};roadRuleEditor.nodeId=function(_){if(!arguments.length)return nodeId;nodeId=_;return roadRuleEditor};roadRuleEditor.fromWayId=function(_){if(!arguments.length)return fromWayId;fromWayId=_;return roadRuleEditor};roadRuleEditor.toWayId=function(_){if(!arguments.length)return toWayId;toWayId=_;return roadRuleEditor};roadRuleEditor.transportation=function(_){if(!arguments.length){return transportation}transportation=_;roadRuleEditor.fromWayId(transportation.fromwayId).nodeId(transportation.nodeId).toWayId(transportation.towayId);return roadRuleEditor};roadRuleEditor.getMaatInfo=function(){var fromWay=context.graph().entity(fromWayId);var mRelations=[];_(context.graph().parentRelations(fromWay)).each(function(relation){var crossOrmaat=relation.modelName===iD.data.DataType.C_NODECONN||relation.modelName===iD.data.DataType.NODECONN;if(crossOrmaat){if(compareMember(relation.members)){mRelations.push(relation)}}});if(1<mRelations.length){console.warn("More than one maat found!!",mRelations)}var maat=mRelations[0]||{};var isCross=false,maatType=null;if(maat.id){maatType=maat.modelName}else{maatType=context.graph().entity(nodeId).isRoadCross()?iD.data.DataType.C_NODECONN:iD.data.DataType.NODECONN}switch(maatType){case iD.data.DataType.C_NODECONN:isCross=true;break;case iD.data.DataType.NODECONN:break;default:console.warn("Unkown maat type",maatType);}return{maat:maat,maatType:maatType,isCross:isCross}};roadRuleEditor.getRelationInfo=function(opts){opts=_.assign({},opts);var maatInfo=roadRuleEditor.getMaatInfo();var targetType=maatInfo.isCross?iD.data.DataType.C_TRAFFICRULE:iD.data.DataType.TRAFFICRULE;var roadRules=[],pareRels=context.graph().parentRelations(maatInfo.maat);_.each(pareRels,function(rel){if(targetType===rel.modelName){roadRules.push(rel)}});roadRules.sort(function(a,b){return a.id-b.id});var relationInfo=_.assign({},maatInfo,{relations:roadRules});if(opts.withAnalyzed){relationInfo.analyzedRelations=relationInfo.relations.map(analyzeSingleRelation)}return relationInfo};return d3.rebind(roadRuleEditor,event,"on")};iD.ui.RoadRule={};;;iD.ui.RoadControl=function(context){var event=d3.dispatch("apply"),modal,transportation,nodeId,fromWayId,toWayId,maatType,maat,assInfo;var fieldConfs=[{label:"\u95E8\u7981\u4FE1\u606F",renderGetter:getBlockTypeRender,setVal:function(render,cVals){render.setVal(cVals.block_type||"0")},getVal:function(render,cVals){cVals.block_type=render.val()}}];function roadControl(selection){modal=iD.ui.modal(selection);modal.select(".modal").classed("modal-alert common-dialog",true);var section=modal.select(".KDSEditor-content");var $wrap=section.append("div").attr("class","traffic-area road_control_pane");$wrap.append("div").attr("class","title model_title").html("\u4EA4\u901A\u4FE1\u606F");var $body=$wrap.append("div").attr("class","body cf");var $fieldRows=$body.selectAll("div.field_row").data(fieldConfs.map(function(f){if(f.renderGetter){f.render=f.renderGetter()}return f}));var $newFieldRows=$fieldRows.enter().append("div").attr("class","field_row");$newFieldRows.append("label").attr("class","field-label");$newFieldRows.append("span").attr("class","field-input");$fieldRows.selectAll(".field-label").html(function(d){return d.label});assInfo=roadControl.getAssistInfo();var cVals=assInfo.tags;$fieldRows.selectAll(".field-input").each(function(d){d3.select(this).html("").call(d.render);if(cVals&&d.setVal){d.setVal(d.render,cVals)}});$fieldRows.exit().remove();var bottom=$wrap.append("div").attr("class","footer");bottom.append("button").attr("class","apply button blue").html("\u786E\u5B9A").on("click",function(){var newVals={};$fieldRows.selectAll(".field-input").each(function(d){if(d.getVal){d.getVal(d.render,newVals,cVals)}});if("work"==d3.select("body").attr("role")&&false){doSaveRoadContral(newVals,cVals)}modal.close()});bottom.append("button").attr("class","cancel button gray").html("\u53D6\u6D88").on("click",function(){modal.close()})}function getBlockTypeRender(){var fromWay=context.entity(fromWayId),toWay=context.entity(toWayId);var options=[{label:"\u672A\u8BBE\u5B9A",value:0},{label:"\u65E0\u969C\u788D\u901A\u884C\u95E8\u7981",value:1},{label:"\u5237\u5361\u8FDB\u5165\u95E8\u7981",value:21},{label:"\u6388\u6743\u8FDB\u5165\u95E8\u7981",value:22},{label:"\u6536\u8D39\u8FDB\u5165\u95E8\u7981",value:23},{label:"\u7D27\u6025\u901A\u9053\u95E8\u7981",value:24},{label:"\u4E0D\u53EF\u901A\u884C\u95E8\u7981",value:3}];return iD.ui.RoadRule.Select({name:"block_type",options:options})}function doSaveRoadContral(newVals,oldVals){if(!maat.id){if(assInfo.id){console.error("No matt but got assInfo!!!",maat,assInfo)}maat=[];context.perform(iD.actions.AddMaat(maat,fromWayId,toWayId,nodeId),"\u521B\u5EFAMatt");maat=maat[0];assInfo.members[0].id=maat.id}if(!assInfo.id&&"0"==newVals.block_type){return}if(!assInfo.id){assInfo=_.assign(iD.Relation(),assInfo)}if("0"==newVals.block_type){context.perform(iD.actions.DeleteRelation(assInfo.id),"\u5220\u9664\u95E8\u7981\u4FE1\u606F")}else{if(5>parseFloat(context.entity(fromWayId).tags.length)||5>parseFloat(context.entity(toWayId).tags.length)){Dialog.alert("\u5236\u4F5C\u95E8\u7981\u8FDE\u63A5\u7684\u4E24\u6761\u9053\u8DEF\u957F\u5EA6\u5FC5\u987B\u5927\u4E8E5\u7C73");return}assInfo=assInfo.update({tags:_.assign({},assInfo.tags,newVals)});assInfo=iD.util.tagExtend.updateVerifyTag(assInfo);if(newVals.block_type!=undefined){if(assInfo.tags.type!=undefined&&"2"!=assInfo.tags.type){assInfo.tags.type="2"}}context.perform(iD.actions.EditRelation(context,[assInfo],[]),"\u66F4\u65B0\u95E8\u7981\u4FE1\u606F")}}roadControl.transportation=function(_){if(!arguments.length){return transportation}transportation=_;roadControl.fromWayId(transportation.fromwayId).nodeId(transportation.nodeId).toWayId(transportation.towayId);return roadControl};roadControl.nodeId=function(_){if(!arguments.length)return nodeId;nodeId=_;return roadControl};roadControl.fromWayId=function(_){if(!arguments.length)return fromWayId;fromWayId=_;return roadControl};roadControl.toWayId=function(_){if(!arguments.length)return toWayId;toWayId=_;return roadControl};roadControl.getAssistInfo=function(){var maatInfo=iD.ui.RoadRuleEditor(context).transportation(transportation).getMaatInfo();maat=maatInfo.maat;var maatType=maatInfo.maatType,isCross=maatInfo.isCross;var targetType=isCross?"AssistInfoC":"AssistInfo";function createNewAssInfo(){var fromWay=context.graph().entity(fromWayId);var assInfo={layerId:fromWay.layerId,version:1,members:[{id:maat.id,role:"maat",type:maatType}],tags:{mesh:fromWay.tags.mesh}};return assInfo}if(!maat||!maat.id){return createNewAssInfo()}var pareRels=context.graph().parentRelations(maat);var assInfos=[];_.each(pareRels,function(rel){if(targetType===rel.modelName){assInfos.push(rel)}});assInfos.sort(function(a,b){return a.id<b.id?1:-1});if(1<assInfos.length){console.warn("More than one AssistInfo found!!",assInfos)}return assInfos.length?assInfos[0]:createNewAssInfo()};return d3.rebind(roadControl,event,"on")};;;var IMAGESPATH="../../dist/img/dialog/";var isIE=-1!=navigator.userAgent.indexOf("MSIE");var isIE6=-1!=navigator.userAgent.indexOf("MSIE 6.0");var isIE8=!!window.XDomainRequest&&!!document.documentMode;if(isIE)try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}var $id=function(id){return"string"==typeof id?document.getElementById(id):id};_remove=function(arr,s,dust){if(dust){var dustArr=[];for(var i=0;i<arr.length;i++){if(s==arr[i]){dustArr.push(arr.splice(i,1)[0])}}return dustArr}for(var i=0;i<arr.length;i++){if(s==arr[i]){arr.splice(i,1)}}return arr};var $topWindow=function(){var parentWin=window;while(parentWin!=parentWin.parent){if(0<parentWin.parent.document.getElementsByTagName("FRAMESET").length)break;parentWin=parentWin.parent}return parentWin};var $bodyDimensions=function(win){win=win||window;var doc=win.document;var cw="BackCompat"==doc.compatMode?doc.body.clientWidth:doc.documentElement.clientWidth;var ch="BackCompat"==doc.compatMode?doc.body.clientHeight:doc.documentElement.clientHeight;var sl=Math.max(doc.documentElement.scrollLeft,doc.body.scrollLeft);var st=Math.max(doc.documentElement.scrollTop,doc.body.scrollTop);var sw=Math.max(doc.documentElement.scrollWidth,doc.body.scrollWidth);var sh=Math.max(doc.documentElement.scrollHeight,doc.body.scrollHeight);var w=Math.max(sw,cw);var h=Math.max(sh,ch);return{clientWidth:cw,clientHeight:ch,scrollLeft:sl,scrollTop:st,scrollWidth:sw,scrollHeight:sh,width:w,height:h}};var fadeEffect=function(element,start,end,speed,callback){if(!element.effect)element.effect={fade:0,move:0,size:0};clearInterval(element.effect.fade);var speed=speed||20;element.effect.fade=setInterval(function(){start=start<end?Math.min(start+speed,end):Math.max(start-speed,end);element.style.opacity=start/100;element.style.filter="alpha(opacity="+start+")";if(start==end){clearInterval(element.effect.fade);if(callback)callback.call(element)}},20)};var topWin=$topWindow();var topDoc=topWin.document;var Dialog=function(){this.ID=null;this.Width=null;this.Height=null;this.URL=null;this.OnLoad=null;this.InnerHtml="";this.InvokeElementId="";this.Top="50%";this.Left="50%";this.Title="";this.OKEvent=null;this.CancelEvent=null;this.ShowButtonRow=false;this.MessageIcon="window.gif";this.MessageTitle="";this.Message="";this.ShowMessageRow=false;this.Modal=true;this.Drag=true;this.AutoClose=null;this.ShowCloseButton=true;this.Animator=true;this.dialogDiv=null;this.bgDiv=null;this.parentWindow=null;this.innerFrame=null;this.innerWin=null;this.innerDoc=null;this.zindex=900;this.cancelButton=null;this.okButton=null;if(0<arguments.length&&"string"==typeof arguments[0]){this.ID=arguments[0]}else if(0<arguments.length&&"object"==typeof arguments[0]){Dialog.setOptions(this,arguments[0])}if(!this.ID)this.ID=topWin.Dialog._Array.length+"";if(!this.ID)this.ID=Math.ceil(100*Math.random())};Dialog._Array=[];Dialog.bgDiv=null;Dialog.setOptions=function(obj,optionsObj){if(!optionsObj)return;for(var optionName in optionsObj){obj[optionName]=optionsObj[optionName]}};Dialog.attachBehaviors=function(){if(isIE){document.attachEvent("onkeydown",Dialog.onKeyDown);window.attachEvent("onresize",Dialog.resetPosition)}else{document.addEventListener("keydown",Dialog.onKeyDown,false);window.addEventListener("resize",Dialog.resetPosition,false)}};Dialog.prototype.attachBehaviors=function(){if(this.Drag&&topWin.Drag)topWin.Drag.init(topWin.$id("_Draghandle_"+this.ID),topWin.$id("_DialogDiv_"+this.ID));if(!isIE&&this.URL){var self=this;topWin.$id("_DialogDiv_"+this.ID).onDragStart=function(){topWin.$id("_Covering_"+self.ID).style.display=""};topWin.$id("_DialogDiv_"+this.ID).onDragEnd=function(){topWin.$id("_Covering_"+self.ID).style.display="none"}}};Dialog.prototype.displacePath=function(){if("http://"==this.URL.substr(0,7)||"/"==this.URL.substr(0,1)||"javascript:"==this.URL.substr(0,11)){return this.URL}else{var thisPath=this.URL;var locationPath=window.location.href;locationPath=locationPath.substring(0,locationPath.lastIndexOf("/"));while(0<=thisPath.indexOf("../")){thisPath=thisPath.substring(3);locationPath=locationPath.substring(0,locationPath.lastIndexOf("/"))}return locationPath+"/"+thisPath}};Dialog.prototype.setPosition=function(){var bd=$bodyDimensions(topWin);var thisTop=this.Top,thisLeft=this.Left,thisdialogDiv=this.getDialogDiv();if("string"==typeof this.Top&&"%"==this.Top.substring(this.Top.length-1,this.Top.length)){var percentT=0.01*this.Top.substring(0,this.Top.length-1);thisTop=bd.clientHeight*percentT-thisdialogDiv.scrollHeight*percentT+bd.scrollTop}if("string"==typeof this.Left&&"%"==this.Left.substring(this.Left.length-1,this.Left.length)){var percentL=0.01*this.Left.substring(0,this.Left.length-1);thisLeft=bd.clientWidth*percentL-thisdialogDiv.scrollWidth*percentL+bd.scrollLeft}thisdialogDiv.style.top=Math.round(thisTop)+"px";thisdialogDiv.style.left=Math.round(thisLeft)+"px"};Dialog.setBgDivSize=function(){var bd=$bodyDimensions(topWin);if(Dialog.bgDiv){if(isIE6){Dialog.bgDiv.style.height=bd.clientHeight+"px";Dialog.bgDiv.style.top=bd.scrollTop+"px";Dialog.bgDiv.childNodes[0].style.display="none";Dialog.bgDiv.childNodes[0].style.display=""}else{Dialog.bgDiv.style.height=bd.scrollHeight+"px"}}};Dialog.resetPosition=function(){Dialog.setBgDivSize();for(var i=0,len=topWin.Dialog._Array.length;i<len;i++){topWin.Dialog._Array[i].setPosition()}};Dialog.prototype.create=function(){var bd=$bodyDimensions(topWin);if("function"==typeof this.OKEvent)this.ShowButtonRow=true;if(!this.Width)this.Width=Math.round(4*bd.clientWidth/10);if(!this.Height)this.Height=Math.round(this.Width/2);if(this.MessageTitle||this.Message)this.ShowMessageRow=true;var DialogDivWidth=this.Width+13+13;var DialogDivHeight=this.Height+33+13+(this.ShowButtonRow?40:0)+(this.ShowMessageRow?50:0);if(DialogDivWidth>bd.clientWidth)this.Width=Math.round(bd.clientWidth-26);if(DialogDivHeight>bd.clientHeight)this.Height=Math.round(bd.clientHeight-46-(this.ShowButtonRow?40:0)-(this.ShowMessageRow?50:0));var html="  <table id=\"_DialogTable_"+this.ID+"\" width=\""+(this.Width+26)+"\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" onselectstart=\"return false;\" style=\"-moz-user-select: none; font-size:12px; line-height:1.4;\">    <tr id=\"_Draghandle_"+this.ID+"\" style=\""+(this.Drag?"cursor: move;":"")+"\">       <td height=\"35px\" style=\"background-color: #F6F6F6;color:#000;font-size:14px;\"><div style=\"padding: 9px 0 4px 14px; float: left; font-weight: bold; color:#333333;font:14px;\"><span id=\"_Title_"+this.ID+"\">"+this.Title+"</span></div>        <div onclick=\"Dialog.getInstance('"+this.ID+"').cancelButton.onclick.apply(Dialog.getInstance('"+this.ID+"').cancelButton,[]);\" style=\"margin-top:5px;margin-right:10px; position: relative; cursor: pointer; float: right; height: 20px; width: 20px; background-image: url("+IMAGESPATH+"close.png);"+(this.ShowCloseButton?"":"display:none;")+"\"></div></td>        </tr>    <tr valign=\"top\">        <td align=\"center\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" bgcolor=\"#ffffff\">          <tr id=\"_MessageRow_"+this.ID+"\" style=\""+(this.ShowMessageRow?"":"display:none")+"\">            <td valign=\"top\" height=\"50\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background:#eaece9 url("+IMAGESPATH+"dialog_bg.jpg) no-repeat scroll right top;\" id=\"_MessageTable_"+this.ID+"\">                <tr>                  <td width=\"50\" height=\"50\" align=\"center\"><img width=\"32\" height=\"32\" src=\""+IMAGESPATH+this.MessageIcon+"\" id=\"_MessageIcon_"+this.ID+"\"/></td>                  <td align=\"left\" style=\"line-height: 16px;\"><div id=\"_MessageTitle_"+this.ID+"\" style=\"font-weight:bold\">"+this.MessageTitle+"</div>                    <div id=\"_Message_"+this.ID+"\">"+this.Message+"</div></td>                </tr>              </table></td>          </tr>          <tr>            <td valign=\"top\" align=\"center\"><div id=\"_Container_"+this.ID+"\" style=\"position: relative; width: "+this.Width+"px; height: "+this.Height+"px;\">                <div style=\"position: absolute; height: 100%; width: 100%; display: none; background-color:#fff; opacity: 0.5;\" id=\"_Covering_"+this.ID+"\">&nbsp;</div>\t"+function(obj){if(obj.InnerHtml)return obj.InnerHtml;if(obj.URL)return"<iframe width=\"100%\" height=\"100%\" frameborder=\"0\" style=\"border:none 0;\" allowtransparency=\"true\" id=\"_DialogFrame_"+obj.ID+"\" src=\""+obj.displacePath()+"\"></iframe>";return""}(this)+"              </div></td>          </tr>          <tr id=\"_ButtonRow_"+this.ID+"\" style=\""+(this.ShowButtonRow?"":"display:none")+"\">            <td height=\"48\"><div id=\"_DialogButtons_"+this.ID+"\" style=\"padding-bottom:12px; text-align: right; background-color:#fff;\">                <input type=\"button\" class=\"dialog_buttonStyle\" value=\"\u786E \u5B9A\" id=\"_ButtonOK_"+this.ID+"\"/>                <input type=\"button\" class=\"dialog_cancel_buttonStyle\" value=\"\u53D6 \u6D88\" onclick=\"Dialog.getInstance('"+this.ID+"').close();\" id=\"_ButtonCancel_"+this.ID+"\"/>              </div></td>          </tr>        </table></td>      </tr></table></div>";var div=topWin.$id("_DialogDiv_"+this.ID);if(!div){div=topDoc.createElement("div");div.id="_DialogDiv_"+this.ID;topDoc.getElementsByTagName("BODY")[0].appendChild(div)}div.style.position="absolute";div.style.left="-9999px";div.style.top="-9999px";div.innerHTML=html;if(this.InvokeElementId){var element=$id(this.InvokeElementId);element.style.position="";element.style.display="";if(isIE){var fragment=topDoc.createElement("div");fragment.innerHTML=element.outerHTML;element.outerHTML="";topWin.$id("_Covering_"+this.ID).parentNode.appendChild(fragment)}else{topWin.$id("_Covering_"+this.ID).parentNode.appendChild(element)}}this.parentWindow=window;if(this.URL){if(topWin.$id("_DialogFrame_"+this.ID)){this.innerFrame=topWin.$id("_DialogFrame_"+this.ID)};var self=this;innerFrameOnload=function(){try{self.innerWin=self.innerFrame.contentWindow;self.innerWin.parentDialog=self;self.innerDoc=self.innerWin.document;if(!self.Title&&self.innerDoc&&self.innerDoc.title){if(self.innerDoc.title)topWin.$id("_Title_"+self.ID).innerHTML=self.innerDoc.title};}catch(e){if(console&&console.log)console.log("\u53EF\u80FD\u5B58\u5728\u8BBF\u95EE\u9650\u5236\uFF0C\u4E0D\u80FD\u83B7\u53D6\u5230iframe\u4E2D\u7684\u5BF9\u8C61\u3002")}if("function"==typeof self.OnLoad)self.OnLoad()};if(this.innerFrame.attachEvent){this.innerFrame.attachEvent("onload",innerFrameOnload)}else{this.innerFrame.onload=innerFrameOnload};};topWin.$id("_DialogDiv_"+this.ID).dialogId=this.ID;topWin.$id("_DialogDiv_"+this.ID).dialogInstance=this;this.attachBehaviors();this.okButton=topWin.$id("_ButtonOK_"+this.ID);this.cancelButton=topWin.$id("_ButtonCancel_"+this.ID);div=null};Dialog.prototype.setSize=function(w,h){if(w&&20<+w){this.Width=+w;topWin.$id("_DialogTable_"+this.ID).width=this.Width+26;topWin.$id("_Container_"+this.ID).style.width=this.Width+"px"}if(h&&10<+h){this.Height=+h;topWin.$id("_Container_"+this.ID).style.height=this.Height+"px"}this.setPosition()};Dialog.prototype.show=function(){this.create();var bgdiv=Dialog.getBgdiv(),thisdialogDiv=this.getDialogDiv();this.zindex=thisdialogDiv.style.zIndex=Dialog.bgDiv.style.zIndex+1;if(0<topWin.Dialog._Array.length){this.zindex=thisdialogDiv.style.zIndex=topWin.Dialog._Array[topWin.Dialog._Array.length-1].zindex+2}else{var topWinBody=topDoc.getElementsByTagName("BackCompat"==topDoc.compatMode?"BODY":"HTML")[0];bgdiv.style.display="none"}topWin.Dialog._Array.push(this);if(this.Modal){bgdiv.style.zIndex=topWin.Dialog._Array[topWin.Dialog._Array.length-1].zindex-1;Dialog.setBgDivSize();if("none"==bgdiv.style.display){if(this.Animator){var bgMask=topWin.$id("_DialogBGMask");bgMask.style.opacity=0;bgMask.style.filter="alpha(opacity=0)";bgdiv.style.display="";fadeEffect(bgMask,0,40,isIE6?20:10);bgMask=null}else{bgdiv.style.display=""}}}this.setPosition();if(this.CancelEvent){this.cancelButton.onclick=this.CancelEvent;if(this.ShowButtonRow)this.cancelButton.focus()}if(this.OKEvent){this.okButton.onclick=this.OKEvent;if(this.ShowButtonRow)this.okButton.focus()}if(this.AutoClose&&0<this.AutoClose)this.autoClose();this.opened=true;bgdiv=null};Dialog.prototype.close=function(){var thisdialogDiv=this.getDialogDiv();if(this==topWin.Dialog._Array[topWin.Dialog._Array.length-1]){var isTopDialog=topWin.Dialog._Array.pop()}else{_remove(topWin.Dialog._Array,this)}if(this.InvokeElementId){var innerElement=topWin.$id(this.InvokeElementId);innerElement.style.display="none";if(isIE){var fragment=document.createElement("div");fragment.innerHTML=innerElement.outerHTML;innerElement.outerHTML="";document.getElementsByTagName("BODY")[0].appendChild(fragment)}else{document.getElementsByTagName("BODY")[0].appendChild(innerElement)}}if(0<topWin.Dialog._Array.length){if(this.Modal&&isTopDialog)Dialog.bgDiv.style.zIndex=topWin.Dialog._Array[topWin.Dialog._Array.length-1].zindex-1}else{Dialog.bgDiv.style.zIndex="900";Dialog.bgDiv.style.display="none";var topWinBody=topDoc.getElementsByTagName("BackCompat"==topDoc.compatMode?"BODY":"HTML")[0]}if(isIE){thisdialogDiv.dialogInstance=null;if(this.innerFrame)this.innerFrame.detachEvent("onload",innerFrameOnload);this.innerFrame=null;this.parentWindow=null;this.bgDiv=null;if(this.CancelEvent){this.cancelButton.onclick=null};if(this.OKEvent){this.okButton.onclick=null};topWin.$id("_DialogDiv_"+this.ID).onDragStart=null;topWin.$id("_DialogDiv_"+this.ID).onDragEnd=null;topWin.$id("_Draghandle_"+this.ID).onmousedown=null;topWin.$id("_Draghandle_"+this.ID).root=null;thisdialogDiv.outerHTML="";CollectGarbage()}else{var RycDiv=topWin.$id("_RycDiv");if(!RycDiv){RycDiv=topDoc.createElement("div");RycDiv.id="_RycDiv"}RycDiv.appendChild(thisdialogDiv);RycDiv.innerHTML="";RycDiv=null}thisdialogDiv=null;this.closed=true};Dialog.prototype.autoClose=function(){if(this.closed){clearTimeout(this._closeTimeoutId);return}this.AutoClose-=1;topWin.$id("_Title_"+this.ID).innerHTML=this.AutoClose+" \u79D2\u540E\u81EA\u52A8\u5173\u95ED";if(0>=this.AutoClose){this.close()}else{var self=this;this._closeTimeoutId=setTimeout(function(){self.autoClose()},1000)}};Dialog.getInstance=function(id){var dialogDiv=topWin.$id("_DialogDiv_"+id);if(!dialogDiv)alert("\u6CA1\u6709\u53D6\u5230\u5BF9\u5E94ID\u7684\u5F39\u51FA\u6846\u9875\u9762\u5BF9\u8C61");try{return dialogDiv.dialogInstance}finally{dialogDiv=null}};Dialog.prototype.addButton=function(id,txt,func){topWin.$id("_ButtonRow_"+this.ID).style.display="";this.ShowButtonRow=true;var button=topDoc.createElement("input");button.id="_Button_"+this.ID+"_"+id;button.type="button";button.style.cssText="margin-right:5px";button.value=txt;button.onclick=func;var input0=topWin.$id("_DialogButtons_"+this.ID).getElementsByTagName("INPUT")[0];input0.parentNode.insertBefore(button,input0);return button};Dialog.prototype.removeButton=function(btn){var input0=topWin.$id("_DialogButtons_"+this.ID).getElementsByTagName("INPUT")[0];input0.parentNode.removeChild(btn)};Dialog.getBgdiv=function(){if(Dialog.bgDiv)return Dialog.bgDiv;var bgdiv=topWin.$id("_DialogBGDiv");if(!bgdiv){bgdiv=topDoc.createElement("div");bgdiv.id="_DialogBGDiv";bgdiv.style.cssText="position:absolute;left:0px;top:0px;width:100%;height:100%;z-index:900";var bgIframeBox="<div style=\"position:relative;width:100%;height:100%;\">";var bgIframeMask="<div id=\"_DialogBGMask\" style=\"position:absolute;background-color:#333;opacity:0.4;filter:alpha(opacity=40);width:100%;height:100%;\"></div>";var bgIframe=isIE6?"<iframe src=\"about:blank\" style=\"filter:alpha(opacity=0);\" width=\"100%\" height=\"100%\"></iframe>":"";bgdiv.innerHTML=bgIframeBox+bgIframeMask+bgIframe+"</div>";topDoc.getElementsByTagName("BODY")[0].appendChild(bgdiv);if(isIE6){var bgIframeDoc=bgdiv.getElementsByTagName("IFRAME")[0].contentWindow.document;bgIframeDoc.open();bgIframeDoc.write("<body style='background-color:#333' oncontextmenu='return false;'></body>");bgIframeDoc.close();bgIframeDoc=null}}Dialog.bgDiv=bgdiv;bgdiv=null;return Dialog.bgDiv};Dialog.prototype.getDialogDiv=function(){var dialogDiv=topWin.$id("_DialogDiv_"+this.ID);if(!dialogDiv)alert("\u83B7\u53D6\u5F39\u51FA\u5C42\u9875\u9762\u5BF9\u8C61\u51FA\u9519\uFF01");try{return dialogDiv}finally{dialogDiv=null}};Dialog.onKeyDown=function(event){if(event.shiftKey&&9==event.keyCode){if(0<topWin.Dialog._Array.length){stopEvent(event);return false}}if(27==event.keyCode){Dialog.close()}};Dialog.close=function(id){if(0<topWin.Dialog._Array.length){var diag=topWin.Dialog._Array[topWin.Dialog._Array.length-1];diag.cancelButton.onclick.apply(diag.cancelButton,[])}};Dialog.alert=function(msg,func,title,w,h,opts){var w=w||300,h=h||110;var diag=new Dialog(_.extend({Width:w,Height:h},opts));diag.ShowButtonRow=true;diag.Title="\u63D0\u793A";if(title)diag.Title=title;diag.CancelEvent=function(){diag.close();if(func)func()};diag.InnerHtml="<table height=\"100%\" border=\"0\" align=\"center\" cellpadding=\"10\" cellspacing=\"0\"  style=\"padding:2px;vertical-align: middle;margin:2px\">\t\t<tr>\t\t    <td align=\"right\" style=\"vertical-align:middle\"><img id=\"Icon_"+this.ID+"\" src=\""+IMAGESPATH+"icon_alert.png\" style=\"padding-right:4px;\"></td>\t\t\t<td align=\"left\" id=\"Message_"+this.ID+"\" class = \"dialog_msg\">"+msg+"</td></tr>\t</table>";diag.show();diag.okButton.parentNode.style.textAlign="center";diag.okButton.style.display="none";diag.cancelButton.setAttribute("class","dialog_buttonStyle");diag.cancelButton.value="\u786E \u5B9A";diag.cancelButton.focus()};Dialog.confirm=function(msg,funcOK,funcCal,w,h){var w=w||300,h=h||110;var diag=new Dialog({Width:w,Height:h});diag.ShowButtonRow=true;diag.Title="\u4FE1\u606F\u786E\u8BA4";diag.CancelEvent=function(){if(funcCal){funcCal()}diag.close()};diag.OKEvent=function(){if(funcOK){funcOK()}diag.close()};diag.InnerHtml="<table height=\"100%\" border=\"0\" align=\"center\" cellpadding=\"10\" cellspacing=\"0\">\t\t<tr><td align=\"right\" style=\"vertical-align:middle;padding: 2px;\"><img id=\"Icon_"+this.ID+"\" src=\""+IMAGESPATH+"icon_query.gif\" style=\"padding-right:4px;\"></td>\t\t\t<td align=\"left\" id=\"Message_"+this.ID+"\" style=\"font-size:9pt;vertical-align:middle\">"+msg+"</td></tr>\t</table>";diag.show();diag.okButton.parentNode.style.textAlign="center";diag.okButton.focus()};Dialog.open=function(arg){var diag=new Dialog(arg);diag.show();return diag};Dialog.sidebarAlert=function(content,opts){if(!content){return}opts=_.extend({time:4000,type:"success"},opts);let $body=d3.select("body");let $panel=$body.select("#_Dialog_Sidebar");if(0==$panel.size()){$panel=$body.append("div").attr("id","_Dialog_Sidebar").attr("class","_Dialog_Sidebar_list").style()}let $allitem=$panel.selectAll("div.dialog_listitem");let indexList=[];$allitem.each(function(){indexList.push(parseInt(this.getAttribute("list-index"))||0)});indexList.sort(function(a,b){return a-b});let itemNum=0;for(let i=0;;i++){itemNum=i;if(i!=indexList[i]){break}}let $info=$panel.append("div").html(content).attr("class","dialog_listitem bg-"+opts.type).attr("title",content).attr("list-index",itemNum);let $self=$($info.node());$info.style({left:-($self.outerWidth()+5)+"px",top:($self.outerHeight()+10)*itemNum+"px"});setTimeout(function(){$info.style({left:"0px"});setTimeout(function(){$info.remove()},200)},opts.time)};if(isIE){window.attachEvent("onload",Dialog.attachBehaviors)}else{window.addEventListener("load",Dialog.attachBehaviors,false)};;iD.dialog=d3.widget("dialog",{options:{appendTo:"body",autoOpen:true,buttons:[],closeOnEscape:true,draggable:true,resizable:false,onTask:false,onlayResizeTop:false,resizeMinHeight:0,resizeMaxHeight:0,width:300,height:"auto",modal:false,title:null,position:{of:window,at:"center middle",my:"center middle"},destroyOnClose:true,beforeClose:null,close:null,open:null,onDragEnd:_.noop,onDrag:_.noop},sizeRelatedOptions:{buttons:true,height:true,width:true},_create:function(){if(this.options.disabled){this.options.disabled=false}this.uiAppendTo=d3.$(this.options.appendTo);this._createWrapper();this._createTitlebar();this.uiDialog.node().appendChild(this.element.node());this._addClass("ui-dialog-content");this._createButtonPane();if(this.options.draggable){this._makeDraggable()}if(this.options.resizable){this._makeResizable()}this._isOpen=false;if(this.options.autoOpen){this.open()}if(this.options.onTask){iD.Task.on("start.closeDialog",this.close.bind(this))}},_destroy:function(){this._keybinding.off();this.uiDialog.remove();if(this.options.resizable){this._off(this.document,"mouseup.dialogresizable");this._off(this.document,"mousemove.dialogresizable")}this._destroyOverlay()},widget:function(){return this.uiDialog},disable:function(){},enable:function(){},close:function(){if(!this._isOpen||false===this._dispatch("beforeClose")){return}this._isOpen=false;this._destroyOverlay();this.uiDialog.style("display","none");this._dispatch("close");if(this.options.destroyOnClose){this.destroy()}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(){var that=this,zIndices=[],zIndexMax;d3.$$(".ui-dialog").each(function(){if(this!==that.uiDialog.node()){zIndices.push(+this.style.zIndex)}});zIndexMax=Math.max.apply(null,zIndices);if(zIndexMax>=+this.uiDialog.style("z-index")){this.uiDialog.style("z-index",zIndexMax+1)}},open:function(){var that=this;if(this._isOpen){this._moveToTop();return}this._isOpen=true;this.uiDialog.style("display","block");this._size();this._position();this._createOverlay();this._moveToTop();if(this.overlay){this.overlay.style("z-index",this.uiDialog.style("z-index")-1)}this._dispatch("open")},_createWrapper:function(){this.uiDialog=this.uiAppendTo.append("div");this.uiDialog.style("display","none");this._addClass(this.uiDialog,"ui-dialog","common-dialog ui-helper-front");this._on(this.uiDialog,{mousedown:"_moveToTop"});this._keybinding=d3.keybinding("dialog").on("\u21A9",this.close.bind(this));d3.select(document).call(this._keybinding)},_createTitlebar:function(){this.uiDialogTitlebar=this.uiDialog.append("div");this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar");var uiDialogTitle=this.uiDialogTitlebar.append("div");uiDialogTitle.html(this.options.title||"&#160;");this._addClass(uiDialogTitle,"ui-dialog-title");this.uiDialogTitlebarClose=this.uiDialogTitlebar.append("div");this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close iconfont icon-close");this._on(this.uiDialogTitlebarClose,{click:function(){d3.event.preventDefault();this.close()}})},_createButtonPane:function(){this.uiDialogButtonPane=d3.$(document.createElement("div"));this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane");this.uiButtonSet=this.uiDialogButtonPane.append("div");this._addClass(this.uiButtonSet,"ui-dialog-buttonset");this._createButtons()},_createButtons:function(){var buttons=this.uiButtonSet.selectAll("button").data(this.options.buttons);buttons.enter().append("button");buttons.attr("class",function(d){return"button "+(d.classname||"")});buttons.html(function(d){return d.text});buttons.exit().remove();this._off(this.uiButtonSet);this._on(this.uiButtonSet,{"click button":function(){d3.event.target.__data__.click.apply(this,arguments)}});if(this.options.buttons.length){this.uiDialog.node().appendChild(this.uiDialogButtonPane.node());this._addClass(this.uiDialog,"ui-dialog-buttons")}else{this._removeClass(this.uiDialog,"ui-dialog-buttons")}},_makeDraggable:function(){var dx,dy,mx,my,crt;this.uiDialogTitlebar.property("draggable",true);this._on(this.uiDialogTitlebar,{dragstart:function(){d3.event.dataTransfer.effectAllowed="move";crt=document.createElement("div");crt.style.cssText="position: absolute; width: 10px; height: 10px; visibility: hidden;";document.body.appendChild(crt);d3.event.dataTransfer.setDragImage(crt,0,0);var rect=this.uiDialog.node().getBoundingClientRect();dx=rect.left;dy=rect.top;mx=d3.event.pageX;my=d3.event.pageY},drag:function(){if(0===d3.event.pageX&&0===d3.event.pageY){return}var deltaX=d3.event.pageX-mx;var deltaY=d3.event.pageY-my;this.uiDialog.style("left",dx+deltaX+"px");this.uiDialog.style("top",dy+deltaY+"px");var onDrag=this.options.onDrag;onDrag&&onDrag(this,this.uiDialog)},dragend:function(){var onDragEnd=this.options.onDragEnd;document.body.removeChild(crt);crt=null;onDragEnd&&onDragEnd(this,this.uiDialog)},dragover:function(){d3.event.preventDefault()}})},_makeResizable:function(){var isResizing=false;var cursorPos=[];var mode;var xreverse;var yreverse;this._on(this.uiDialog,{"mousemove.resizable":function(){var rect=this.uiDialog.node().getBoundingClientRect();var x=d3.event.x;var y=d3.event.y;var cursorMap={10:"ew-resize","-10":"ew-resize",20:"ns-resize","-20":"ns-resize",200:"nwse-resize","-200":"nesw-resize"};var cursor="auto";cursorPos=[];if(this.options.onlayResizeTop){if(20>Math.abs(rect.top-y)){cursorPos[2]=20}}else{if(20>Math.abs(rect.left-x)){cursorPos[0]=10}else if(20>Math.abs(rect.right-x)){cursorPos[1]=-10}if(20>Math.abs(rect.top-y)){cursorPos[2]=20}else if(20>Math.abs(rect.bottom-y)){cursorPos[3]=-20}}cursorPos=cursorPos.filter(function(p){return"number"===typeof p});if(1===cursorPos.length&&this.options.onlayResizeTop){cursor=cursorMap[cursorPos[0]]}if(2===cursorPos.length){cursor=cursorMap[cursorPos[0]*cursorPos[1]]}this.uiDialog.style("cursor",cursor)},"mousedown.resizable":function(){if(1===d3.event.buttons&&/resize$/.test(this.uiDialog.style("cursor"))){isResizing=true;if(2===cursorPos.length){mode=2}else if(1===cursorPos.length){if(10===Math.abs(cursorPos[0])){mode=0}else{mode=1}}}}});this._on(document,{"mousemove.dialogresizable":function(){if(isResizing){var rect=this.uiDialog.node().getBoundingClientRect();if(1!==mode&&d3.event.movementX){if(!this.options.onlayResizeTop){if("boolean"!==typeof xreverse){xreverse=d3.event.pageX<rect.left+rect.width/2}if(xreverse){this.uiDialog.style("left",rect.left+d3.event.movementX+"px");this.uiDialog.style("width",rect.width-d3.event.movementX+"px")}else{this.uiDialog.style("width",rect.width+d3.event.movementX+"px")}}}if(0!==mode&&d3.event.movementY){if("boolean"!==typeof yreverse){yreverse=d3.event.pageY<rect.top+rect.height/2}if(yreverse){var distY=this.element.node().getBoundingClientRect().height-d3.event.movementY;if(this.options.resizeMaxHeight&&this.options.resizeMinHeight){if(distY<this.options.resizeMaxHeight&&distY>this.options.resizeMinHeight){this.uiDialog.style("top",rect.top+d3.event.movementY+"px");this.element.style("height",distY+"px")}}else{this.uiDialog.style("top",rect.top+d3.event.movementY+"px");this.element.style("height",distY+"px")}}else{this.element.style("height",this.element.node().getBoundingClientRect().height+d3.event.movementY+"px")}}d3.event.preventDefault();this._dispatch("dialogResize")}},"mouseup.dialogresizable":function(e){var onDragResizeEnd=this.options.onDragResizeEnd;isResizing=false;mode=null;xreverse=null;yreverse=null;if(this._isOpen&&onDragResizeEnd){onDragResizeEnd(this)}}})},_position:function(){var getRect=function(element){var rect;if(element===window){rect={left:0,top:0,width:window.innerWidth,height:window.innerHeight}}else{rect=element.getBoundingClientRect()}return rect};var rposition=/^([a-z]+)([+-]\d+)?$/;var getOffset=function(str,rect,c){return str.split(" ").map(function(pos){var result=pos.match(rposition);var direction=result[1];var offset=parseFloat(result[2]||0,10);switch(direction){case"left":break;case"center":offset=c*rect.width/2+offset;break;case"right":offset=c*rect.width+offset;break;case"top":break;case"middle":offset=c*rect.height/2+offset;break;case"bottom":offset=c*rect.height+offset;break;}return offset})};var atRect=getRect(d3.$(this.options.position.of).node());var myRect=getRect(this.uiDialog.node());var atOffset=getOffset(this.options.position.at,atRect,1);var myOffset=getOffset(this.options.position.my,myRect,-1);var left=atRect.left+atOffset[0]+myOffset[0];var top=atRect.top+atOffset[1]+myOffset[1];if(top+myRect.height>window.innerHeight){top-=top+myRect.height-window.innerHeight}if(0>top){top=0}this.uiDialog.style({left:left+"px",top:top+"px"})},_setOptions:function(options){var that=this,resize=false;Object.keys(options).forEach(function(key){var value=options[key];that._setOption(key,value);if(key in that.sizeRelatedOptions){resize=true}});if(resize){this._size();this._position()}},_setOption:function(key,value){if("disabled"===key){return}this._super(key,value);if("appendTo"===key){this.uiAppendTo=d3.$(value);this.uiAppendTo.node().appendChild(this.uiDialog.node())}if("buttons"===key){this._createButtons()}if("position"===key){this._position()}if("title"===key){d3.$(".ui-dialog-title",this.uiDialogTitlebar).html(value)}},_size:function(){var width=this.options.width;var height=this.options.height;if("number"===typeof width){width+="px"}this.uiDialog.style("width",width);if("auto"===this.options.height){this.element.style("height","auto");return}this.element.style({display:"none",width:"auto",height:0});var nonContentHeight=this.uiDialog.style("height","auto").node().offsetHeight;this.element.style({height:Math.max(0,this.options.height-nonContentHeight)+"px",display:"block"})},_createOverlay:function(){if(!this.options.modal){return}this.overlay=this.uiAppendTo.append("div");this._addClass(this.overlay,null,"ui-helper-overlay ui-helper-front")},_destroyOverlay:function(){if(!this.options.modal){return}this.overlay.remove()}});;;var Drag={obj:null,init:function(handle,dragBody,e){if(null==e){handle.onmousedown=Drag.start}handle.root=dragBody;if(isNaN(parseInt(handle.root.style.left)))handle.root.style.left="0px";if(isNaN(parseInt(handle.root.style.top)))handle.root.style.top="0px";handle.root.onDragStart=new Function;handle.root.onDragEnd=new Function;handle.root.onDrag=new Function;if(null!=e){var handle=Drag.obj=handle;e=Drag.fixe(e);var top=parseInt(handle.root.style.top);var left=parseInt(handle.root.style.left);handle.root.onDragStart(left,top,e.pageX,e.pageY);handle.lastMouseX=e.pageX;handle.lastMouseY=e.pageY;document.onmousemove=Drag.drag;document.onmouseup=Drag.end}},start:function(e){var handle=Drag.obj=this;e=Drag.fixEvent(e);var top=parseInt(handle.root.style.top);var left=parseInt(handle.root.style.left);handle.root.onDragStart(left,top,e.pageX,e.pageY);handle.lastMouseX=e.pageX;handle.lastMouseY=e.pageY;document.onmousemove=Drag.drag;document.onmouseup=Drag.end;return false},drag:function(e){e=Drag.fixEvent(e);var handle=Drag.obj;var mouseY=e.pageY;var mouseX=e.pageX;var top=parseInt(handle.root.style.top);var left=parseInt(handle.root.style.left);if(document.all){Drag.obj.setCapture()}else{e.preventDefault()};var currentLeft,currentTop;currentLeft=left+mouseX-handle.lastMouseX;currentTop=top+(mouseY-handle.lastMouseY);handle.root.style.left=currentLeft+"px";handle.root.style.top=currentTop+"px";handle.lastMouseX=mouseX;handle.lastMouseY=mouseY;handle.root.onDrag(currentLeft,currentTop,e.pageX,e.pageY);return false},end:function(){if(document.all){Drag.obj.releaseCapture()};document.onmousemove=null;document.onmouseup=null;Drag.obj.root.onDragEnd(parseInt(Drag.obj.root.style.left),parseInt(Drag.obj.root.style.top));Drag.obj=null},fixEvent:function(e){var sl=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);var st=Math.max(document.documentElement.scrollTop,document.body.scrollTop);if("undefined"==typeof e)e=window.event;if("undefined"==typeof e.layerX)e.layerX=e.offsetX;if("undefined"==typeof e.layerY)e.layerY=e.offsetY;if("undefined"==typeof e.pageX)e.pageX=e.clientX+sl-document.body.clientLeft;if("undefined"==typeof e.pageY)e.pageY=e.clientY+st-document.body.clientTop;return e}};;;iD.ui.ReportForm=function(context){var url=iD.config.URL.kcs_edit+"check/status/update";function postStatus(id,status){d3.json(url).header("Content-Type","application/json").post(JSON.stringify([{id,status}]),function(error,data){if(error||data&&"0"!=data.code){Dialog.alert("\u62A5\u8868\u63D0\u4EA4\u5F02\u5E38",null,null,null,null,{AutoClose:3})}})}function locationPlayer(entity){if(!(entity instanceof iD.Node)){return}let graph,relations,parameter,trackPointId,trackId;graph=context.graph();relations=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO);if(!relations.length)return;if(!relations[0].tags.PARAMETER)return;parameter=JSON.parse(relations[0].tags.PARAMETER);trackPointId=parameter.Paras.nodes[0].trackPointId;trackId=parameter.Paras.nodes[0].trackId;if(!trackId){let trackPoint=iD.svg.Pic.dataMgr.pointId2Track(trackPointId);if(trackPoint){trackId=trackPoint.trackId}}if(trackId){iD.svg.Pic.dataMgr.pic.getPicPlayer()&&iD.svg.Pic.dataMgr.pic.getPicPlayer().locateTrackPointToPlayer(trackPointId,trackId)}}function lightEntity(type="n",did,name){var lay=getLayerByName(name);if(!lay){return}var sim=iD.Entity.id.delimiter||"_";var entity=context.hasEntity(type+lay.id+sim+did)||context.hasEntity(type+sim+did);if(!entity){context.enter(iD.modes.Browse(context));return}if(!(entity instanceof iD.Relation)){context.map().lightEntity(entity.id);locationPlayer(entity)}else{var mids=[];_.each(entity.members||[],function(m){let d=context.hasEntity(m.id);if(!(d instanceof iD.Relation)){mids.push(d.id)}if(d instanceof iD.Node){locationPlayer(entity)}});mids.length&&context.map().lightEntity(mids)}}function getFormFilterFunc(filterstr){var args=filterstr.split("=");var modelName=_.last(args);if(!modelName)return()=>false;var prefix=$.trim(args[0]);var includeFun=function(str,modelName){var mnames=modelName.split(",");return mnames.includes(str)};var result;switch(prefix){case"!":result=element=>{return!includeFun(element.getAttribute("filter-mname"),modelName)};break;default:result=element=>{return includeFun(element.getAttribute("filter-mname"),modelName)};break;}return result}function getFormFilterText(filterstr){var args=filterstr.split("=");var modelName=_.last(args);var prefix=$.trim(args[0]);var text="";if("!"==prefix){text+="\u975E"}text+="\u8F66\u9053\u7EBF";return text}var reportForm=function(selection){var reportform=selection.append("div").attr("id","ReportForm");var $formHeader=reportform.append("div").attr("class","reportform-header");var $fmBtn=$formHeader.selectAll("div.fm-btn.mname-filter").data([[iD.data.DataType.DIVIDER,iD.data.DataType.DIVIDER_NODE].join(","),"!="+[iD.data.DataType.DIVIDER,iD.data.DataType.DIVIDER_NODE].join(",")]).enter().append("div").attr("class","fm-btn mname-filter").text(function(d){return getFormFilterText(d)}).on("click",function(d){var filter=getFormFilterFunc(d);$fmBtn.classed("active",false);d3.select(this).classed("active",true);d3.selectAll("#example2 tbody tr").each(function(){if(filter(this)){this.style.display=""}else{this.style.display="none"}})});$fmBtn.classed("active",false);$formHeader.append("div").attr("class","fm-btn").attr("id","_reportform_close").text("X").on("click",function(){reportform.style("display","none")});var reportFormTable=reportform.append("div").attr("id","reportFormTable");var $button2=$(".report-button #button2");var $button3=$(".report-button #button3");var $button4=$(".report-button #button4");var kcs_edit=iD.config.URL.kcs_edit;_data={action:"complete",variables:[]};$button2.click(function(data){if(!iD.Task.d){Dialog.alert("\u672A\u9009\u4E2D\u4EFB\u4F55\u4EFB\u52A1\u3002");return}var text=userAuthText();if(iD.User.isAuditRole()){var batchs=iD.Task.editBatchs();Dialog.confirm(`
                	<span>选择最佳批次</span>
					<select id="_report_audit_select_batch" style="padding: 3px 5px;">
					${batchs.map(batch=>`
                		<option value="${batch}">${batch}</option>
                	`).join("")}
					</select>
                	<br/>
					<span>${text}是否通过</span>
					<select id="_report_audit_select" value="true" style="padding: 3px 5px;">
						<option value="true">是</option>
						<option value="false">否</option>
					</select>
				`,function(){var flag="true"==d3.select("#_report_audit_select").value();var param=flag?{auditBatch:d3.select("#_report_audit_select_batch").value()}:null;processPassStatus(d3.select("#_report_audit_select").value(),function(){reloadCurrentPage()},param)});return}else if(iD.User.isLineWorkRole()){processPassStatus(true,function(){reloadCurrentPage()});return}else if(iD.User.isWorkRole()||iD.User.isEditCheckRole()||iD.User.isVerifyRole()){Dialog.confirm(`
					<span>${text}是否通过</span>
					<select id="_report_editcheck_select" value="true" style="padding: 3px 5px;">
						<option value="true">是</option>
						<option value="false">否</option>
					</select>
				`,function(){if(!editor.getHistory()){processPassStatus(d3.select("#_report_editcheck_select").value(),function(){reloadCurrentPage()})}else{Dialog.alert(`请先保存您的作业！`)}});return}processPassStatus(true,function(){reloadCurrentPage()});reportform.fadeOut(300)});var batch,taskId;$button3.click(function getstart2(data){if(iD.Task.d){taskId=iD.Task.d.tags.taskId;batch=iD.Task.d.tags.editCheckBatch;let app=iD.Task.d.tags.dbCode;if(batch&&taskId&&app){setTimeout(getForm(),1000)}else{Dialog.alert("\u4EFB\u52A1\u4E2D\u6CA1\u6709\u8D28\u68C0\u6279\u6B21\uFF0C\u65E0\u6CD5\u67E5\u8BE2\u62A5\u8868\u3002",null,null,null,null,{AutoClose:3})}}});$button4.click(function(){if(iD.Task.d){taskId=iD.Task.d.tags.taskId;let app=iD.Task.d.tags.dbCode;if(taskId){$.ajax({url:kcs_edit+"check/tasks/"+taskId+"?sceneCode=AUTO_CHECK_DIVIDER&app="+app,type:"get",async:false,dataType:"json",success:function(data){if("0"!=data.code){$("#ReportForm").fadeIn(500);reportFormTable.html(data.message||"\u7CFB\u7EDF\u5F02\u5E38");Dialog.alert(data.message);return false}else{batch=data.result.id;setTimeout(getForm(),2000)}}})}}});function getForm(data){var isChecker=iD.User.isCheckRole();var merge=isChecker?"?filter=true":"";$.ajax({url:kcs_edit+"check/report/"+batch+merge,type:"get",async:false,dataType:"json",success:function(data){if("0"!=data.code){$("#ReportForm").fadeIn(500);reportFormTable.html(data.message||"\u7CFB\u7EDF\u5F02\u5E38");Dialog.alert(data.message);return false}else{appendForm(data)}}})}function appendForm(data){var effectform=$("#EffectForm");effectform.hide();var reportform=$("#ReportForm");if(0==data.result.checkDataResults.length){reportFormTable.html("\u6CA1\u6709\u53D1\u73B0\u9519\u8BEF");Dialog.alert("\u62A5\u8868\u4E2D\u6CA1\u6709\u9519\u8BEF\u4FE1\u606F")}else{reportform.fadeIn(500);var currentInstance="";var mety=iD.ModelEntitys[currentInstance+"DIVIDER"];if(!mety){mety={getChineseName:function(str){return str},getGeoType:function(){return 0}}}var datumPanelTmpl=`
			    <div class="table-header">
	                <table>
	                	<thead style="font-weight:bold;">
			                <tr>
				                <th>状态</th>
				                <th>id</th>
				                <th>要素ID</th>
				                <th>数据类型 </th>
				                <!--<th>dataType</th>-->
				                <th>描述</th>
			                </tr>
			            </thead>
	                </table>
			    </div>
			    <div class="reportform-table-wrap">
		          	<div id="example2" class="table table-bordered table-hover">
			            <div class="box-body" style="text-align:center;font-size:14px;">
						    <table class="table table-bordered table-hover">
					            <tbody>
			                	${data.result.checkDataResults.map(d=>`
					                <tr filter-mname="${d.dataLayer}">
						                <td title="${d.id}" class="td" style="font-weight:normal;">
						                <button class="iconfont icon-check " value = "{id:${d.id},status:1}"></button>
						                <button class="iconfont icon-cross " value= "{id:${d.id},status:2}" ></button>
						                </td>
						                <td title="${d.id}" class="td" style="font-weight:normal;">${d.id}</td>
						                <td title="${d.dataId}" class="td"style="font-weight:normal;">${d.dataId}</td>
						                <td title="${d.dataLayer}" class="td" style="font-weight:normal;">${d.dataLayer} </td>
						                <!--<th title="${d.dataType}" style="font-weight:normal;">${d.dataType}</th>-->
						                <td title="${d.errorMsg}" class="td" style="font-weight:normal;">${d.errorMsg}</td>
					                </tr>
			                	`).join("")}
					            </tbody>
						    </table>

			  			</div>
		          	</div>
		        </div>
			    `;reportFormTable.html(datumPanelTmpl);var tbody=d3.selectAll("#example2 tbody");tbody.selectAll("tr").data(data.result.checkDataResults);tbody.selectAll("tr").nodes().forEach(function(d,i){if("1"==d3.select(d).datum().status){d3.select(d).select(".icon-check").classed("active",true)}else if("2"==d3.select(d).datum().status){d3.select(d).select(".icon-check").classed("active",true);d3.select(d).select(".icon-cross").classed("active",true)}});$(".pre").on("click",function(data){$button3.css("display","block");reportform.fadeOut(300)});$(".next").on("click",function(data){$button3.css("display","block");reportform.fadeOut(300)});var child=$("#example2 tbody tr");for(var i=0;i<child.length;i++){var a=child[i];a.index=i;a.onclick=function(e){d3.selectAll("#example2 tbody tr").classed("active",false);d3.select(this).classed("active",true);if(d3.select(e.target).classed("icon-check")){postStatus(d3.select(this).datum().id,1);d3.select(e.target).classed("active",true)}else if(d3.select(e.target).classed("icon-cross")){postStatus(d3.select(this).datum().id,2);d3.select(e.target).classed("active",true);d3.select(this).select(".icon-check").classed("active",true)}if(!iD.User.authCheckResultHandle()){Dialog.alert(t("permission.checkedit_no_handle"));return}var dataX=data.result.checkDataResults[this.index].dataX;var dataY=data.result.checkDataResults[this.index].dataY;var dataId=data.result.checkDataResults[this.index].dataId;var dataType=data.result.checkDataResults[this.index].dataType;var modelName=data.result.checkDataResults[this.index].dataLayer;if("relation"==dataType){context.map().center([dataX,dataY])}else if("node"==dataType){context.map().center([dataX,dataY]);lightEntity("n",dataId,modelName)}else{context.map().center([dataX,dataY]);lightEntity("w",dataId,modelName)}}}}var history=iD.util.urlParamHistory();if(history){reportForm.hideBtn()}}};function getLayerByName(name){var result;var layers=iD.Layers.getLayers();for(let lay of layers){if(iD.util.getModelNameByItem(lay.models.datas||[],name)){result=lay;break}}return result}var reportform=$("#ReportForm");var LocationTaskID,LocationType,batch,taskId;var $button3=$(".report-button #button3").show();var $button2=$(".report-button #button2");LocationType=iD.url.getUrlParam("system_type")||"1";reportForm.showBtn=function(){var history=iD.util.urlParamHistory();if(history)return;reportform.fadeOut(300);if(iD.Task.d.protoData.tags.editCheckBatch){setTimeout(function(){batch=iD.Task.d.protoData.tags.editCheckBatch;taskId=iD.Task.d.protoData.tags.taskId;$button3.html("\u67E5\u770B\u68C0\u67E5\u62A5\u544A").show()},400)}else{}var text=userAuthText();if(iD.User.isAuditRole()||iD.User.isVerifyRole()||iD.User.isEditCheckRole()){$button2.html(text+"\u5B8C\u6210").show()}else if(iD.User.isWorkRole()){$button2.html(text+"\u5B8C\u6210").show()}else{if(LocationType&&"1"==LocationType){$button2.html("\u7F16\u8F91\u5B8C\u6210").show();if(iD.User.authCheckTrigger()||iD.User.authCheckReportForm()){$button2.html("\u7F16\u8F91\u5B8C\u6210").show()}}else if(LocationType&&"2"==LocationType){$button2.html("\u878D\u5408\u5B8C\u6210").show()}else if(LocationType&&"3"==LocationType){$button2.html("\u8BC6\u522B\u5B8C\u6210").show()}else if(LocationType&&"5"==LocationType){$button2.html("\u8D28\u68C0\u5B8C\u6210").show()}}};reportForm.hideBtn=function(){$button2.hide()};function reloadCurrentPage(){var url=window.location.href;var param="taskID="+iD.Task.d.task_id;if(iD.url.getUrlParam("taskID")){url=url.replace(/taskID=(\d+)?&?/,"")}window.location.href=url.split("#")[0]}function userAuthText(){var result="";if(iD.User.isAuditRole()){result="\u5BA1\u6838"}else if(iD.User.isWorkRole()){result="\u7F16\u8F91"}else if(iD.User.isEditCheckRole()){result="\u8D28\u68C0"}else if(iD.User.isVerifyRole()){result="\u9A8C\u6536"}return result}function processPassStatus(isPass,callback,params={}){if(null==isPass){return}let _checkData={taskId:""+iD.Task.d.protoData.id,properties:[{id:"passFlag",value:isPass+""}]};_checkData.properties.push(..._.compact(_.map(params,function(v,k){if(null==v)return;return{id:k,value:v}})));$.ajax({type:"post",url:iD.config.URL.kts+"form/form-data",async:false,contentType:"application/json; charset=utf-8",data:JSON.stringify(_checkData),complete:function(xhr,status){callback&&callback(xhr,status)}})}return reportForm};;iD.ui.EffectForm=function(context){var url=iD.config.URL.kcs_edit+"check/status/update";function postStatus(id,status){d3.json(url).header("Content-Type","application/json").post(JSON.stringify([{id,status}]),function(error,data){if(error||data&&"0"!=data.code){Dialog.alert("\u62A5\u8868\u63D0\u4EA4\u5F02\u5E38",null,null,null,null,{AutoClose:3})}})}function locationPlayer(entity){if(!(entity instanceof iD.Node)){return}let graph,relations,parameter,trackPointId,trackId;graph=context.graph();relations=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO);if(!relations.length)return;if(!relations[0].tags.PARAMETER)return;parameter=JSON.parse(relations[0].tags.PARAMETER);trackPointId=parameter.Paras.nodes[0].trackPointId;trackId=parameter.Paras.nodes[0].trackId;if(!trackPointId)return;if(!trackId){trackId=iD.svg.Pic.dataMgr.pointId2Track(trackPointId).trackId}if(!trackId)return;iD.svg.Pic.dataMgr.pic.getPicPlayer()&&iD.svg.Pic.dataMgr.pic.getPicPlayer().locateTrackPointToPlayer(trackPointId,trackId)}function lightEntity(type="n",did,name){var lay=getLayerByName(name);if(!lay){return}var sim=iD.Entity.id.delimiter||"_";var entity=context.hasEntity(type+lay.id+sim+did)||context.hasEntity(type+sim+did);if(!entity){context.enter(iD.modes.Browse(context));return}if(!(entity instanceof iD.Relation)){context.map().lightEntity(entity.id);locationPlayer(entity)}else{var mids=[];_.each(entity.members||[],function(m){let d=context.hasEntity(m.id);if(!(d instanceof iD.Relation)){mids.push(d.id)}if(d instanceof iD.Node){locationPlayer(entity)}});mids.length&&context.map().lightEntity(mids)}}var effectForm=function(selection){var effectTypeList=[iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.DIVIDER_ATTRIBUTE,iD.data.DataType.ROAD_ATTRIBUTE];var effectform=selection.append("div").attr("id","EffectForm");var $formHeader=effectform.append("div").attr("class","effectsform-header");var $fmBtns=$formHeader.selectAll("div.fm-btn.mname-filter").data(effectTypeList).enter().append("div").attr("class","fm-btn mname-filter").text(function(name){return name.charAt(0).toUpperCase()+"A"}).on("click",function(name){renderForm(name)});$formHeader.append("div").attr("class","effectsform-toggle").attr("id","_effectform_toggle").on("click",function(){var height=effectform.node().offsetHeight;var $trans=effectform.transition().ease("liner").duration(500);if(effectform.classed("active")){effectform.classed("active",false);$trans.style("bottom",-height+"px")}else{effectform.classed("active",true);$trans.style("bottom","0px")}}).append("span").attr("class","glyphicon glyphicon-triangle-right");$formHeader.append("div").attr("class","fm-btn").attr("id","_effectform_close").text("X").on("click",function(){effectform.style("display","none")});var effectFormTable=effectform.append("div").attr("id","effectFormTable");var $button2=$("#effects-lane-highlight");var $button3=$("#effects-divider-attr-highlight");var $button4=$("#effects-road-highlight");var showBtnList=$button2.add($button3).add($button4).toArray();var $otherBtns=context.container().selectAll("#KDSEditor-bar .effects-group > button").filter(function(){return-1==showBtnList.indexOf(this)}).on("click.effect-form",function(){effectform.style("display","none")});var fieldListLA=[{fieldName:"LANETYPE",fieldTitle:"\u8F66\u9053\u7C7B\u578B",chn:true},{fieldName:"MAX_SPEED",connectField:["MIN_SPEED"],connect:" \u2014 ",fieldTitle:"\u9650\u901F"},{fieldName:"STATUS",fieldTitle:"\u901A\u884C\u72B6\u6001",chn:true},{fieldName:"SMTYPE",fieldTitle:"\u8F66\u9053\u5206\u6B67\u70B9\u7C7B\u578B",chn:true}];var fieldListDA=[{fieldName:"VIRTUAL",fieldTitle:"\u865A\u62DF\u5206\u9694\u7EBF\u7C7B\u578B",chn:true},{fieldName:"COLOR",fieldTitle:"\u5206\u9694\u7EBF\u989C\u8272",chn:true},{fieldName:"TYPE",fieldTitle:"\u5206\u9694\u7EBF\u7C7B\u578B",chn:true},{fieldName:"DRIVE_RULE",fieldTitle:"\u901A\u884C\u7C7B\u578B",chn:true}];var fieldListRA=[{fieldName:"TYPE",fieldTitle:"\u5C5E\u6027\u7C7B\u578B",chn:true},{fieldName:"VALUE",fieldTitle:"\u53D8\u5316\u540E\u5C5E\u6027\u503C",chn:true,parentFieldName:"TYPE"},{fieldName:"SMTYPE",fieldTitle:"\u9053\u8DEF\u5206\u6B67\u7C7B\u578B",chn:true}];function getRenderParam(entity,modelName){var result,node;if(entity.modelName!=modelName)return;if(_.include([iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.DIVIDER_ATTRIBUTE],modelName)){for(var m of entity.members){if(m.modelName==iD.data.DataType.DIVIDER_NODE){node=context.hasEntity(m.id);if(!node)continue;node.type=m.type;break}}}else if(modelName==iD.data.DataType.ROAD_ATTRIBUTE){node=entity}if(!node)return result;var nodeId=iD.Entity.id.toOSM(node.id);var values=[];var paramList;if(modelName==iD.data.DataType.LANE_ATTRIBUTE){paramList=fieldListLA}else if(modelName==iD.data.DataType.DIVIDER_ATTRIBUTE){paramList=fieldListDA}else if(modelName==iD.data.DataType.ROAD_ATTRIBUTE){paramList=fieldListRA}for(let item of paramList){let v=entity.tags[item.fieldName];let subVals;if(item.connect&&item.connectField&&item.connectField.length){subVals=_.map(item.connectField,fname=>{let sv=entity.tags[fname];if(item.chn){sv=getFieldText(modelName,fname,sv)}sv=null==sv?"":sv+"";return sv})}if(item.chn){v=getFieldText(modelName,item.fieldName,v,{parentFieldName:item.parentFieldName,parentFieldValue:entity.tags[item.parentFieldName]})}v=null==v?"":v+"";if(subVals){v=[v].concat(...subVals).join(item.connect)}values.push(v)}result={id:nodeId,modelName:node.modelName,dataX:node.loc[0],dataY:node.loc[1],type:node.type,values:values};return result}function renderForm(modelName){var graph=context.graph();var entitys=graph.entities;var arr=[];var flag=_.include(effectTypeList,modelName);if(!flag){effectForm.hideBtn();return}$fmBtns.classed("active",false);var btnIndex=effectTypeList.indexOf(modelName);if(-1<btnIndex){d3.select($fmBtns[0][btnIndex]).classed("active",true)}for(var i in entitys){if(entitys[i]&&entitys[i].modelName==modelName){var param=getRenderParam(entitys[i],modelName);param&&arr.push(param)}}var paramList=[];if(modelName==iD.data.DataType.LANE_ATTRIBUTE){paramList=fieldListLA}else if(modelName==iD.data.DataType.DIVIDER_ATTRIBUTE){paramList=fieldListDA}else if(modelName==iD.data.DataType.ROAD_ATTRIBUTE){paramList=fieldListRA}appendForm({title:["\u8981\u7D20ID"].concat(_.pluck(paramList,"fieldTitle")),content:arr})}$button2.click(function(){renderForm(iD.data.DataType.LANE_ATTRIBUTE)});$button3.click(function(){renderForm(iD.data.DataType.DIVIDER_ATTRIBUTE)});$button4.click(function(){renderForm(iD.data.DataType.ROAD_ATTRIBUTE)});function appendForm(data){var effectform=$("#EffectForm");effectform.addClass("active").css("bottom","");effectform.fadeIn(500);var datumPanelTmpl=`
			    <div class="table-header">
	                <table>
	                	<thead style="font-weight:bold;">
			                <tr>
			                ${data.title.map(t=>`
				                <th style="white-space: nowrap;">${t}</th>
				            `).join("")}
			                </tr>
			            </thead>
	                </table>
			    </div>
			    <div class="effectform-table-wrap">
		          	<div id="example2" class="table table-bordered table-hover">
			            <div class="box-body" style="text-align:center;font-size:14px;">
						    <table class="table table-bordered table-hover">
					            <tbody>
			                	${data.content.map(d=>`
					                <tr filter-mname="${d.modelName}">
					                	<td title="${d.id}" class="td" style="font-weight:normal;">${d.id}</td>
					                	${d.values.map(v=>`
						                	<td title="${v}" class="td" style="font-weight:normal;">${v}</td>
						                `).join("")}
					                </tr>
			                	`).join("")}
					            </tbody>
						    </table>
			  			</div>
		          	</div>
		        </div>
			`;effectFormTable.html(datumPanelTmpl);var tbody=d3.selectAll("#example2 tbody");var child=$("#example2 tbody tr");for(var i=0;i<child.length;i++){var a=child[i];a.index=i;a.onclick=function(e){d3.selectAll("#example2 tbody tr").classed("active",false);d3.select(this).classed("active",true);if(d3.select(e.target).classed("icon-check")){postStatus(d3.select(this).datum().id,1);d3.select(e.target).classed("active",true)}else if(d3.select(e.target).classed("icon-cross")){postStatus(d3.select(this).datum().id,2);d3.select(e.target).classed("active",true);d3.select(this).select(".icon-check").classed("active",true)}if(!iD.User.authCheckResultHandle()){Dialog.alert(t("permission.checkedit_no_handle"));return}var dataX=data.content[this.index].dataX;var dataY=data.content[this.index].dataY;var dataId=data.content[this.index].id;var dataType=data.content[this.index].type;var modelName=data.content[this.index].modelName;if("relation"==dataType){context.map().center([dataX,dataY])}else if("node"==dataType){context.map().center([dataX,dataY]);lightEntity("n",dataId,modelName)}else{context.map().center([dataX,dataY]);lightEntity("w",dataId,modelName)}}}}function getFieldText(modelName,fieldName,fieldValue,options){var model=iD.ModelEntitys[modelName];if(!model)return"";var fieldList=model.getFields(model.getGeoType());options=options||{};var parentId,parentName=options.parentFieldName,parentValue=options.parentFieldValue;if(parentName){for(var f of fieldList){if(f.fieldName==parentName){if(!f.fieldInput||!f.fieldInput.values)break;for(let v of f.fieldInput.values){if(v.value==parentValue){parentId=v.id}}break}}}for(var f of fieldList){if(f.fieldName!=fieldName)continue;if(!f.fieldInput||!f.fieldInput.values)return"";for(let v of f.fieldInput.values){if(null!=parentId&&v.parentId!=parentId)continue;if(v.value==fieldValue){return v.name}}}return""}};function getLayerByName(name){var result;var layers=iD.Layers.getLayers();for(let lay of layers){if(iD.util.getModelNameByItem(lay.models.datas||[],name)){result=lay;break}}return result}effectForm.hideBtn=function(){var effectform=$("#EffectForm");effectform.hide()};return effectForm};;;;(function(root){"use strict";var COMPOUND="Compound",IDENTIFIER="Identifier",MEMBER_EXP="MemberExpression",LITERAL="Literal",THIS_EXP="ThisExpression",CALL_EXP="CallExpression",UNARY_EXP="UnaryExpression",BINARY_EXP="BinaryExpression",LOGICAL_EXP="LogicalExpression",CONDITIONAL_EXP="ConditionalExpression",ARRAY_EXP="ArrayExpression",PERIOD_CODE=46,COMMA_CODE=44,SQUOTE_CODE=39,DQUOTE_CODE=34,OPAREN_CODE=40,CPAREN_CODE=41,OBRACK_CODE=91,CBRACK_CODE=93,QUMARK_CODE=63,SEMCOL_CODE=59,COLON_CODE=58,throwError=function(message,index){var error=new Error(message+" at character "+index);error.index=index;error.description=message;throw error},t=true,unary_ops={"-":t,"!":t,"~":t,"+":t},binary_ops={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},getMaxKeyLen=function(obj){var max_len=0,len;for(var key in obj){if((len=key.length)>max_len&&obj.hasOwnProperty(key)){max_len=len}}return max_len},max_unop_len=getMaxKeyLen(unary_ops),max_binop_len=getMaxKeyLen(binary_ops),literals={true:true,false:false,null:null},this_str="this",binaryPrecedence=function(op_val){return binary_ops[op_val]||0},createBinaryExpression=function(operator,left,right){var type="||"===operator||"&&"===operator?LOGICAL_EXP:BINARY_EXP;return{type:type,operator:operator,left:left,right:right}},isDecimalDigit=function(ch){return 48<=ch&&57>=ch},isIdentifierStart=function(ch){return 36===ch||95===ch||65<=ch&&90>=ch||97<=ch&&122>=ch},isIdentifierPart=function(ch){return 36===ch||95===ch||65<=ch&&90>=ch||97<=ch&&122>=ch||48<=ch&&57>=ch},jsep=function(expr){var index=0,charAtFunc=expr.charAt,charCodeAtFunc=expr.charCodeAt,exprI=function(i){return charAtFunc.call(expr,i)},exprICode=function(i){return charCodeAtFunc.call(expr,i)},length=expr.length,gobbleSpaces=function(){var ch=exprICode(index);while(32===ch||9===ch){ch=exprICode(++index)}},gobbleExpression=function(){var test=gobbleBinaryExpression(),consequent,alternate;gobbleSpaces();if(exprICode(index)===QUMARK_CODE){index++;consequent=gobbleExpression();if(!consequent){throwError("Expected expression",index)}gobbleSpaces();if(exprICode(index)===COLON_CODE){index++;alternate=gobbleExpression();if(!alternate){throwError("Expected expression",index)}return{type:CONDITIONAL_EXP,test:test,consequent:consequent,alternate:alternate}}else{throwError("Expected :",index)}}else{return test}},gobbleBinaryOp=function(){gobbleSpaces();var biop,to_check=expr.substr(index,max_binop_len),tc_len=to_check.length;while(0<tc_len){if(binary_ops.hasOwnProperty(to_check)){index+=tc_len;return to_check}to_check=to_check.substr(0,--tc_len)}return false},gobbleBinaryExpression=function(){var ch_i,node,biop,prec,stack,biop_info,left,right,i;left=gobbleToken();biop=gobbleBinaryOp();if(!biop){return left}biop_info={value:biop,prec:binaryPrecedence(biop)};right=gobbleToken();if(!right){throwError("Expected expression after "+biop,index)}stack=[left,biop_info,right];while(biop=gobbleBinaryOp()){prec=binaryPrecedence(biop);if(0===prec){break}biop_info={value:biop,prec:prec};while(2<stack.length&&prec<=stack[stack.length-2].prec){right=stack.pop();biop=stack.pop().value;left=stack.pop();node=createBinaryExpression(biop,left,right);stack.push(node)}node=gobbleToken();if(!node){throwError("Expected expression after "+biop,index)}stack.push(biop_info,node)}i=stack.length-1;node=stack[i];while(1<i){node=createBinaryExpression(stack[i-1].value,stack[i-2],node);i-=2}return node},gobbleToken=function(){var ch,to_check,tc_len;gobbleSpaces();ch=exprICode(index);if(isDecimalDigit(ch)||ch===PERIOD_CODE){return gobbleNumericLiteral()}else if(ch===SQUOTE_CODE||ch===DQUOTE_CODE){return gobbleStringLiteral()}else if(isIdentifierStart(ch)||ch===OPAREN_CODE){return gobbleVariable()}else if(ch===OBRACK_CODE){return gobbleArray()}else{to_check=expr.substr(index,max_unop_len);tc_len=to_check.length;while(0<tc_len){if(unary_ops.hasOwnProperty(to_check)){index+=tc_len;return{type:UNARY_EXP,operator:to_check,argument:gobbleToken(),prefix:true}}to_check=to_check.substr(0,--tc_len)}return false}},gobbleNumericLiteral=function(){var number="",ch,chCode;while(isDecimalDigit(exprICode(index))){number+=exprI(index++)}if(exprICode(index)===PERIOD_CODE){number+=exprI(index++);while(isDecimalDigit(exprICode(index))){number+=exprI(index++)}}ch=exprI(index);if("e"===ch||"E"===ch){number+=exprI(index++);ch=exprI(index);if("+"===ch||"-"===ch){number+=exprI(index++)}while(isDecimalDigit(exprICode(index))){number+=exprI(index++)}if(!isDecimalDigit(exprICode(index-1))){throwError("Expected exponent ("+number+exprI(index)+")",index)}}chCode=exprICode(index);if(isIdentifierStart(chCode)){throwError("Variable names cannot start with a number ("+number+exprI(index)+")",index)}else if(chCode===PERIOD_CODE){throwError("Unexpected period",index)}return{type:LITERAL,value:parseFloat(number),raw:number}},gobbleStringLiteral=function(){var str="",quote=exprI(index++),closed=false,ch;while(index<length){ch=exprI(index++);if(ch===quote){closed=true;break}else if("\\"===ch){ch=exprI(index++);switch(ch){case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="\t";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="\x0B";break;}}else{str+=ch}}if(!closed){throwError("Unclosed quote after \""+str+"\"",index)}return{type:LITERAL,value:str,raw:quote+str+quote}},gobbleIdentifier=function(){var ch=exprICode(index),start=index,identifier;if(isIdentifierStart(ch)){index++}else{throwError("Unexpected "+exprI(index),index)}while(index<length){ch=exprICode(index);if(isIdentifierPart(ch)){index++}else{break}}identifier=expr.slice(start,index);if(literals.hasOwnProperty(identifier)){return{type:LITERAL,value:literals[identifier],raw:identifier}}else if(identifier===this_str){return{type:THIS_EXP}}else{return{type:IDENTIFIER,name:identifier}}},gobbleArguments=function(termination){var ch_i,args=[],node;while(index<length){gobbleSpaces();ch_i=exprICode(index);if(ch_i===termination){index++;break}else if(ch_i===COMMA_CODE){index++}else{node=gobbleExpression();if(!node||node.type===COMPOUND){throwError("Expected comma",index)}args.push(node)}}return args},gobbleVariable=function(){var ch_i,node;ch_i=exprICode(index);if(ch_i===OPAREN_CODE){node=gobbleGroup()}else{node=gobbleIdentifier()}gobbleSpaces();ch_i=exprICode(index);while(ch_i===PERIOD_CODE||ch_i===OBRACK_CODE||ch_i===OPAREN_CODE){index++;if(ch_i===PERIOD_CODE){gobbleSpaces();node={type:MEMBER_EXP,computed:false,object:node,property:gobbleIdentifier()}}else if(ch_i===OBRACK_CODE){node={type:MEMBER_EXP,computed:true,object:node,property:gobbleExpression()};gobbleSpaces();ch_i=exprICode(index);if(ch_i!==CBRACK_CODE){throwError("Unclosed [",index)}index++}else if(ch_i===OPAREN_CODE){node={type:CALL_EXP,arguments:gobbleArguments(CPAREN_CODE),callee:node}}gobbleSpaces();ch_i=exprICode(index)}return node},gobbleGroup=function(){index++;var node=gobbleExpression();gobbleSpaces();if(exprICode(index)===CPAREN_CODE){index++;return node}else{throwError("Unclosed (",index)}},gobbleArray=function(){index++;return{type:ARRAY_EXP,elements:gobbleArguments(CBRACK_CODE)}},nodes=[],ch_i,node;while(index<length){ch_i=exprICode(index);if(ch_i===SEMCOL_CODE||ch_i===COMMA_CODE){index++}else{if(node=gobbleExpression()){nodes.push(node)}else if(index<length){throwError("Unexpected \""+exprI(index)+"\"",index)}}}if(1===nodes.length){return nodes[0]}else{return{type:COMPOUND,body:nodes}}};jsep.version="0.3.0";jsep.toString=function(){return"JavaScript Expression Parser (JSEP) v"+jsep.version};jsep.addUnaryOp=function(op_name){unary_ops[op_name]=t;return this};jsep.addBinaryOp=function(op_name,precedence){max_binop_len=Math.max(op_name.length,max_binop_len);binary_ops[op_name]=precedence;return this};jsep.removeUnaryOp=function(op_name){delete unary_ops[op_name];if(op_name.length===max_unop_len){max_unop_len=getMaxKeyLen(unary_ops)}return this};jsep.removeBinaryOp=function(op_name){delete binary_ops[op_name];if(op_name.length===max_binop_len){max_binop_len=getMaxKeyLen(binary_ops)}return this};if("undefined"===typeof exports){var old_jsep=root.jsep;root.jsep=jsep;jsep.noConflict=function(){if(root.jsep===jsep){root.jsep=old_jsep}return jsep}}else{if("undefined"!==typeof module&&module.exports){exports=module.exports=jsep}else{exports.parse=jsep}}})(this);;;;;(function(iD,jsep){jsep.addBinaryOp("OR",1);jsep.addBinaryOp("AND",2);jsep.addBinaryOp("=",6);jsep.addBinaryOp("*=",7);jsep.addBinaryOp("^=",7);jsep.addBinaryOp("$=",7);var falseFilter=function(){return false};iD.ui.RoadFilterExpParser=function(){};_.assign(iD.ui.RoadFilterExpParser.prototype,{parseExp:function(exp,modelList){var error=null,filter=null;exp=exp||"";exp=exp.trim();if(!exp){return{filter:falseFilter,error:null}}try{filter=this.getFilter(jsep(exp))}catch(e){error=e}return{filter:filter,error:error}},getFilter:function(tree,opts){if(!tree){return falseFilter}var self=this,tmpVal;return function(obj){switch(tree.type){case"Literal":return tree.value;case"Identifier":tmpVal=obj[tree.name];return tmpVal!==undefined?tmpVal:tree.name||"";case"UnaryExpression":return self.evalUnaryExpVal(tree,obj,opts);case"BinaryExpression":return self.evalBinaryExpVal(tree,obj,opts);case"LogicalExpression":return self.evalLogicalExpVal(tree,obj,opts);case"CallExpression":case"Compound":return false;default:console.error("Unknown tree type",tree);break;}return false}},evalLogicalExpVal:function(tree,obj,opts){var leftVal=this.getFilter(tree.left,_.assign({},opts,{left:true,right:false}))(obj),rightVal=this.getFilter(tree.right,_.assign({},opts,{left:false,right:true}))(obj);switch(tree.operator){case"&&":case"AND":return leftVal&&rightVal;case"||":case"OR":return leftVal||rightVal;default:console.error("Unknown Logical operator",tree);break;}return false},evalBinaryExpVal:function(tree,obj,opts){var leftVal=this.getFilter(tree.left,_.assign({},opts,{left:true,right:false}))(obj),rightVal=this.getFilter(tree.right,_.assign({},opts,{left:false,right:true}))(obj);var tmpStrL=(""+(leftVal||"")).toLowerCase(),tmpStrR=(""+(rightVal||"")).toLowerCase();if(leftVal===undefined&&rightVal===undefined){return false}switch(tree.operator){case"AND":case"OR":return this.evalLogicalExpVal(tree,obj);case"=":case"==":return leftVal==rightVal;case"!=":return leftVal!=rightVal;case"===":return leftVal===rightVal;case"!==":return leftVal!==rightVal;case"*=":return 0<=tmpStrL.indexOf(tmpStrR);case"^=":return tmpStrL.startsWith(tmpStrR);case"$=":return tmpStrL.endsWith(tmpStrR);case">":return leftVal>rightVal;case"<":return leftVal<rightVal;case">=":return leftVal>=rightVal;case"<=":return leftVal<=rightVal;case"+":return leftVal+rightVal;case"-":return leftVal-rightVal;case"*":return leftVal*rightVal;case"/":return leftVal/rightVal;case"%":return leftVal%rightVal;default:console.error("Unknown Binary operator",tree);break;}return false},evalUnaryExpVal:function(tree,obj,opts){var uVal=this.getFilter(tree.argument,_.assign({},opts,{unary:true}))(obj);switch(tree.operator){case"!":case"NOT":return!uVal;case"-":return-uVal;default:console.error("Unknown Unary operator",tree);break;}return false}})})(iD,jsep);;;iD.ui.RoadFilterControl=function(context){var filterPanel=null;function showRoadFilter(){if(!filterPanel){filterPanel=new iD.ui.RoadFilterPanel(context,context.container())}context.enter(iD.modes.Browse(context));filterPanel.show()}var buttons=[{id:"road-filter-control",title:"\u8981\u7D20\u5C5E\u6027\u67E5\u8BE2",action:showRoadFilter,key:"Ctrl+F"}];return function(selection){var button=selection.selectAll("button").data(buttons).enter().append("button").attr("tabindex",-1).attr("class",function(d){return d.id}).on("click.control",function(d){d.action()}).call(bootstrap.tooltip().placement("left").html(true).title(function(d){return iD.ui.tooltipHtml(d.title,d.key)}));button.append("span").attr("class",function(d){return d.id+" icon"});var keybinding=d3.keybinding("RoadFilterControl");buttons.forEach(function(b){keybinding.on(b.key,function(){d3.event.stopPropagation();d3.event.preventDefault();b.action()})});d3.select(document).call(keybinding)}};;;(function(iD){var pathIds=[];var ttab=`<div class="line-info-title">
            <h3 class="sub-title">{{title}}</h3>
            {{#editable}}
            <input type="text" class="thumbnail" value="{{value}}" {{disabled}} />
            {{/editable}}
            {{^editable}}
            <div class="thumbnail">{{&value}}</div>
            {{/editable}}
            <i class="iconfont icon-arrow-down"></i>
            <button class="button clear" {{disabled}}>删除</button>
        </div>`;function isRealpictureScene(){return false;return iD.Task.d&&iD.Task.d.task_classes==iD.data.TaskClass.REALPICTURE}function filterNodeCross(context,ans,nodeId2crossId){_(ans).each(function(an){context.graph().parentRelations(an).forEach(function(rel){if(rel.modelName==iD.data.DataType.R_C_NODE_ROAD_NODE){rel.members.forEach(function(member){if(member.modelName==iD.data.DataType.C_NODE){nodeId2crossId[an.id]=member.id}})}})})}function buildTranStyle(trans){var tag={};trans._rules.forEach(function(r){tag.blue=true;if("0"==r.type){tag.yellow=true;if(0<=r.time.indexOf("(h0){h24}")){tag.red=true}}else if("2"==r.type){tag.yellow=true}});return tag}function buildTimeInfo(trans){var times=[];trans._rules.forEach(function(r){if("0"==r.type&&r.timeInfo&&r.timeInfo.timeRange){times.push.apply(times,r.timeInfo.timeRange.map(function(t){return t.start+" - "+t.end}))}});times=_.uniq(times);return times}function newTransps(context,transps,an,toWay,fromWay,editor,filter,nodeId2crossId){var graph=context.graph(),next,nodes,tags,acs_entity,bcs_entity,anid=iD.Entity.id.toOSM(an.id),an_cross_node_id=nodeId2crossId[an.id];nodes=toWay.nodes;var fnode=iD.Entity.id.toOSM(toWay.first());var tnode=iD.Entity.id.toOSM(toWay.last());var len=nodes.length;tags=toWay.tags;acs_entity=graph.entity(nodes[0]),bcs_entity=graph.entity(nodes[len-1]);filterNodeCross(context,[acs_entity,bcs_entity],nodeId2crossId);var acs=nodeId2crossId[acs_entity.id],bcs=nodeId2crossId[bcs_entity.id];if(!toWay.isOneRoadCrossWay()&&tags.DIRECTION!==undefined){var bn,dt=25;if(fromWay.id!=toWay.id){if(fnode===anid){bn=graph.entity(nodes[1])}else if(tnode===anid){bn=graph.entity(nodes[len-2])}else if(an_cross_node_id){let topoEntity=iD.TopoEntity();let members=topoEntity.getCrossNodeMembers(graph,an_cross_node_id);for(var i=0;i<members.length;i++){if(nodes.includes(members[i].id)){let nodeIndex=nodes.indexOf(members[i].id);an=graph.entity(nodes[nodeIndex]);if(nodeIndex){bn=graph.entity(nodes[0])}else{bn=graph.entity(nodes[1])}}}}}else if(fromWay.id==toWay.id&&"1"!==tags.DIRECTION){return}else if(fromWay.id==toWay.id){return}else if("1"===tags.DIRECTION){if(fnode===anid){bn=graph.entity(nodes[1])}else if(tnode===anid){bn=graph.entity(nodes[len-2])}else return}else if("2"===tags.DIRECTION){if(fnode===anid){bn=graph.entity(nodes[1])}else return}else if("3"===tags.DIRECTION){if(tnode===anid){bn=graph.entity(nodes[len-2])}else return}else if("4"===tags.DIRECTION){return}else{return}if(!bn)return;var a=context.projection(an.loc),b=context.projection(bn.loc);var angle=Math.atan2(b[1]-a[1],b[0]-a[0]),p=[parseInt(a[0]+dt*Math.cos(angle)),parseInt(a[1]+dt*Math.sin(angle))],loc=context.projection.invert(p);id=[an.id,bn.id].sort().join("-");var parentRelations=context.graph().parentRelations(fromWay),pRelations=[],mRelations=[],crossOrmaat=false;parentRelations.forEach(function(relation){crossOrmaat=relation.modelName===iD.data.DataType.C_NODECONN||relation.modelName===iD.data.DataType.NODECONN;if(crossOrmaat){if(an_cross_node_id){relation.members[1].id===nodeId2crossId[an.id]&&mRelations.push(relation)}else mRelations.push(relation)}});mRelations.forEach(function(mRelation){var rules=context.graph().parentRelations(mRelation),r;rules.forEach(function(rule){r=_.clone(rule);r=iD.util.merge({members:mRelation.members},r);pRelations.push(r)})});var transportation=iD.Transportation();transps[id]=iD.Transportation({type:"transportation",id:id,loc:loc,edge:[an.id,bn.id],tags:{status:1},fromwayId:fromWay.id,towayId:toWay.id,nodeId:an_cross_node_id?an_cross_node_id:an.id,angle:angle*(180/Math.PI)});var transRelationInfo=iD.ui.RoadRuleEditor(context).transportation(transps[id]).getRelationInfo({withAnalyzed:true});transps[id].tags.status=transRelationInfo.relations.length?3:1;transps[id]._rules=transRelationInfo.analyzedRelations;transps[id]._styleInfo=buildTranStyle(transps[id]);transps[id]._timeInfo=buildTimeInfo(transps[id]);editor&&transps[id]&&(transps[id].editor=true)}}function roadMakerGrp(selection,style,context){selection.each(function(d){var grp=d3.select(this),roadRule,roadContrl,timeTip;grp.html("");if(d.fromwayId==d.towayId)return false;var fromWay=context.entity(d.fromwayId),toWay=context.entity(d.towayId);var tranNode=context.entity(d.nodeId);var withControl="0"==tranNode.tags.realnode&&fromWay.id!==toWay.id;var withRule=withControl;if(!withRule){withRule="-1"!==tranNode.tags.realnode&&"2"!=fromWay.tags.status&&"2"!=toWay.tags.status}if(!withControl&&!withRule){return}var imgStyle="green";["red","yellow","blue"].some(function(t){if(d._styleInfo[t]){imgStyle=t;return true}});if(d._timeInfo&&d._timeInfo.length){timeTip=grp.append("g").attr("class","road-rule-time");var $timeTxtBg=timeTip.append("rect").attr("class","rule_time_bg");var $timeTxt=timeTip.append("text").attr("class","rule_time_txt").attr("text-anchor","middle").attr("x",0).attr("y",0).attr("dx","0").attr("dy","0");$timeTxt.selectAll("tspan").data(d._timeInfo).enter().append("tspan").attr("x",0).attr("y",function(d,idx){return 1.2*-idx+"em"}).text(function(d){return d});$timeTxt.each(function(){var bbox=this.getBBox();var w=Math.max(bbox.width+10,20),h=Math.max(bbox.height+10,20);d3.select(this.parentNode).select("rect.rule_time_bg").attr("rx",w/10).attr("ry",w/10).attr("x",-w/2).attr("width",w).attr("y",-h+10).attr("height",h)})}if(d.fromwayId==d.towayId){if(withRule){roadRule=grp.append("image").attr("class","road-rule-icon").attr("x",-16).attr("y",-8).attr("width",32).attr("height",33).attr("xlink:href",function(d){return context.imagePath(imgStyle+"turn.png")})}if(withControl){roadContrl=addRoadControl(grp);roadContrl.attr("transform","translate(-7,10)")}if(timeTip){timeTip.attr("transform","translate(60, -5)")}}else{if(withRule){roadRule=grp.append("image").attr("class","road-rule-icon").attr("x",-6).attr("y",-8).attr("width",45).attr("height",35).attr("xlink:href",function(d){return context.imagePath(imgStyle+"Arrow.png")})}if(withControl){roadContrl=addRoadControl(grp);roadContrl.attr("transform","translate(10, 15)")}if(timeTip){timeTip.attr("transform","translate(70, -5)")}}if(timeTip&&(90<d.angle||-90>d.angle)){var $bg=timeTip.select("rect.rule_time_bg");timeTip.attr("transform",timeTip.attr("transform")+" rotate(180,0,"+$bg.attr("y")/2+")")}});selection.each(function(entity){var size=11,coord=iD.geo.angleCoords(entity.angle,size);this.setAttribute("transform","translate("+coord[0]+", "+coord[1]+") rotate("+entity.angle+")")})}function addRoadControl(selection){var g=selection.append("g").attr("class","road-control-icon"),gw=20,gh=20,tranStr="translate(18, 0)";g.append("circle").attr("transform",tranStr).attr("cx",gw/2).attr("cy",gh/2).attr("r",Math.min(gw,gh)/2);g.append("text").attr("transform",tranStr).attr("text-anchor","middle").attr("x",gw/2).attr("y",gh/2).attr("dx",1).attr("dy","0.35em").html("&#10148;");return g}iD.ui.NodeLineInfo=function(context,selection,selectedIDs){this.dataMgr=iD.ui.NodeLineInfo.dataMgr(context);this.dispatch=d3.dispatch("close");this.selection=selection;this.context=context;this.nodeId=selectedIDs[0];this.refTextValueArr=[];this.image_id="";this.side_bmp="";this.rear_bmp="";this.roadTypeArr=[{name:"\u666E\u901A\u9053\u8DEF",type:"0"},{name:"\u9AD8\u901F\u516C\u8DEF",type:"1"}];this.result={lt_turn_left:{}};this.arrowResult={image_id:"",side_bmp:"",rear_bmp:""};this.highSpeedArr=["G","H","I","J","K","L","M","N"];this.ordinaryArr=["O","P","Q","R","S","T","U","V","W","X","Y","Z"];this.arrowValidateFlag={};this.directOptions=this.dataMgr.directOptions;this.applyflag=false;this.slopOptions={label:"\u5761\u5EA6\u5BFC\u822A",options:[{label:"0 \u672A\u8C03\u67E5",value:0},{label:"1 \u5E73\u9762->\u5E73\u9762\uFF08\u6CA1\u6709\u503E\u659C\uFF09",value:1},{label:"10 \u5E73\u9762->\u4E0A\u5761",value:10},{label:"11 \u4E0A\u5761->\u4E0A\u5761\uFF08\u8FDB\u5165\u9000\u51FA\u65F6\u540C\u4E00\u89D2\u5EA6\uFF09",value:11},{label:"12 \u4E0A\u5761->\u4E0A\u5761\uFF08\u9000\u51FA\u6BD4\u8FDB\u5EA6\u8981\u6025\u89D2\u5EA6\uFF09",value:12},{label:"13 \u4E0A\u5761->\u4E0A\u5761\uFF08\u9000\u51FA\u6BD4\u8FDB\u5EA6\u8981\u7F13\u89D2\u5EA6\uFF09",value:13},{label:"14 \u4E0B\u5761->\u4E0A\u5761",value:14},{label:"30 \u5E73\u9762->\u4E0B\u5761",value:30},{label:"31 \u4E0B\u5761->\u4E0B\u5761\uFF08\u8FDB\u5165\u9000\u51FA\u65F6\u540C\u4E00\u89D2\u5EA6\uFF09",value:31},{label:"32 \u4E0B\u5761->\u4E0B\u5761\uFF08\u9000\u51FA\u6BD4\u8FDB\u5EA6\u8981\u6025\u89D2\u5EA6\uFF09",value:32},{label:"33 \u4E0B\u5761->\u4E0B\u5761\uFF08\u9000\u51FA\u6BD4\u8FDB\u5EA6\u8981\u7F13\u89D2\u5EA6\uFF09",value:33},{label:"34 \u4E0A\u5761->\u4E0B\u5761",value:34},{label:"40 \u4E0A\u5761->\u5E73\u9762",value:40},{label:"50 \u4E0B\u5761->\u5E73\u9762",value:50}]};this.arrowOptions=["LBCD","RBCD","LBC","LAC","LBD","LAB","RCD","RCE","RBD","RDE","ABC","BCD","LA","LB","LC","RC","RD","RE","AB","AC","AD","BC","BD","BE","CD","CE","DE","A","B","C","D","E","Z","L","R","LINE","F","G"];this.gspTextvalueOptions={label:"\u65B9\u5411\u4FE1\u606F",options:[{label:"1-\u65B9\u5411 1-\u5730\u70B9\u65B9\u5411(11)",value:11},{label:"1-\u65B9\u5411 2-\u8DEF\u7EBF\u540D\u79F0(12)",value:12},{label:"1-\u65B9\u5411 3-\u8857\u9053\u540D\u79F0(13)",value:13},{label:"1-\u65B9\u5411 4-\u65C5\u6E38\u666F\u70B9(14)",value:14},{label:"1-\u65B9\u5411 5-\u670D\u52A1\u8BBE\u65BD\u540D\u79F0(15)",value:15},{label:"1-\u65B9\u5411 6-\u670D\u52A1\u8BBE\u65BD\u56FE\u6807(16)",value:16},{label:"2-\u51FA\u53E3 1-\u5730\u70B9\u65B9\u5411(21)",value:21},{label:"2-\u51FA\u53E3 2-\u8DEF\u7EBF\u540D\u79F0(22)",value:22},{label:"2-\u51FA\u53E3 3-\u8857\u9053\u540D\u79F0(23)",value:23},{label:"2-\u51FA\u53E3 4-\u65C5\u6E38\u666F\u70B9(24)",value:24},{label:"2-\u51FA\u53E3 5-\u670D\u52A1\u8BBE\u65BD\u540D\u79F0(25)",value:25},{label:"2-\u51FA\u53E3 6-\u670D\u52A1\u8BBE\u65BD\u56FE\u6807(26)",value:26},{label:"2-\u51FA\u53E3 9-\u9AD8\u901F\u51FA\u53E3\u7F16\u53F7(29)",value:29},{label:"3-\u5165\u53E3 1-\u5730\u70B9\u65B9\u5411(31)",value:31},{label:"3-\u5165\u53E3 2-\u8DEF\u7EBF\u540D\u79F0(32)",value:32},{label:"3-\u5165\u53E3 3-\u8857\u9053\u540D\u79F0(33)",value:33},{label:"3-\u5165\u53E3 5-\u670D\u52A1\u8BBE\u65BD\u540D\u79F0(35)",value:35},{label:"3-\u5165\u53E3 6-\u670D\u52A1\u8BBE\u65BD\u56FE\u6807(36)",value:36},{label:"4-\u9AD8\u901F\u6CBF\u7EBF\u8BBE\u65BD 5-\u670D\u52A1\u8BBE\u65BD\u540D\u79F0(45)",value:45},{label:"4-\u9AD8\u901F\u6CBF\u7EBF\u8BBE\u65BD 7-\u9AD8\u901F\u670D\u52A1\u533A(47)",value:47},{label:"4-\u9AD8\u901F\u6CBF\u7EBF\u8BBE\u65BD 8-\u9AD8\u901F\u505C\u8F66\u533A(48)",value:48}]};return d3.rebind(this,this.dispatch,"on")};_.assign(iD.ui.NodeLineInfo.prototype,{initPanel:function(){var selection=this.selection,self=this,context=this.context,dialog=this.dialog=iD.dialog(null,{width:600,appendTo:"#id-container",autoOpen:false});dialog.option("title",function(){var entity=context.entity(self.nodeId);if(entity.modelName==iD.data.DataType.ROAD_NODE){return"\u8282\u70B9"}else{return"\u7EFC\u5408\u4EA4\u53C9\u70B9"}}());var buttons=[{text:"\u786E\u5B9A",classname:"confirm",click:function(){var datum=self.resultDatum;var context=self.context;var d=context.entity(self.resultDatum.id);if(datum.modelName==iD.data.DataType.NODECONN||datum.modelName==iD.data.DataType.C_NODECONN){self.dataValidate(datum,context)}context.perform(iD.actions.Noop(),"\u8FDB\u5165\u9000\u51FA\u5173\u7CFB\u4FE1\u606F\u7F16\u8F91");self.doSaveFunc(d);datum=context.entity(d.id);if(datum){self.applyflag=true;self.initContext(self.mainContext,datum);self.applyflag=false;self.doSaveFunc(d)}self.dialog.close();iD.svg.TurnGuidance().removeDirectionLayer();context.map().dimensions(context.map().dimensions())}},{text:"\u5E94\u7528",classname:"apply",click:function(){var datum=self.resultDatum;var context=self.context;var d=context.entity(self.resultDatum.id);if(datum.modelName==iD.data.DataType.NODECONN||datum.modelName==iD.data.DataType.C_NODECONN){self.dataValidate(datum,context)}context.perform(iD.actions.Noop(),"\u8FDB\u5165\u9000\u51FA\u5173\u7CFB\u4FE1\u606F\u7F16\u8F91");self.doSaveFunc(d);datum=context.entity(d.id);self.applyflag=true;self.initContext(self.mainContext,datum);self.applyflag=false;d3.selectAll(".line-info-panel .line-info-edit").classed("hidden",true);context.map().dimensions(context.map().dimensions())}},{text:"\u53D6\u6D88",classname:"gray",click:function(){self.dialog.close();iD.svg.TurnGuidance().removeDirectionLayer()}}];if("check"==d3.select("body").attr("role")){buttons.splice(0,2)}dialog.option("buttons",buttons);dialog.on("close",this.hide.bind(this));dialog.widget().classed("line-info-panel",true);var actions=[{title:"\u8FDE\u63A5\u9053\u8DEF\u4FE1\u606F",type:"saat",active:true},{title:"\u8FDB\u5165\u548C\u9000\u51FA\u5173\u7CFB\u4FE1\u606F",type:"maat",active:false}];var panelActions=dialog.element.append("div").attr("class","btn-group panel-actions");panelActions.selectAll("a.btn").data(actions).enter().append("a").attr("class","btn").text(function(d){return d.title}).attr("id",function(d,i){return d.type}).classed("active",function(d){return d.active}).on("click",function(d){iD.svg.TurnGuidanceSeq(context).removeAll();d3.select(this.parentNode).selectAll("a").classed("active",false);d3.select(this).classed("active",true);$newPanelBody.attr("id",function(d){var $bodyType=d3.select(".line-info-panel .btn-group .active").attr("id");return $bodyType});self.initBody($newPanelBody)});$newPanelBody=dialog.element.append("div").attr("class","panel-body").attr("id",function(d){var $bodyType=d3.select(".line-info-panel .btn-group .active").attr("id");return $bodyType});this.initBody($newPanelBody);this.$panelBody=$newPanelBody;dialog.open()},transpsData:function(datas){let context=this.context;var from_transId="";var to_transId="";var data=null;if(!datas){return{}}for(var i=0;i<datas.length;i++){var d=datas[i];if("0"==d.tags.ACCESSABLE){data=d;break}}data&&data.members&&data.members.forEach(function(member){if(member.modelName==iD.data.DataType.ROAD&&"FROAD_ID"==member.role){from_transId=member.id}else if(member.modelName==iD.data.DataType.ROAD&&"TROAD_ID"==member.role){to_transId=member.id}});var way=context.hasEntity(from_transId);var to_way=context.hasEntity(to_transId);var graph=context.graph();if(!(way instanceof iD.Way))return[];var anode=graph.entity(way.first()),bnode=graph.entity(way.last()),nodeId2crossId={};filterNodeCross(context,[anode,bnode],nodeId2crossId);var a=nodeId2crossId[anode.id],b=nodeId2crossId[bnode.id],transps={},filter={};if(a&&"0"!==a&&a===b)return;var ans=function(d){if(1==d){return[anode,bnode]}else if(2==d){return[bnode]}else if(3==d){return[anode]}else if(4==d){return[]}return[]}(way.tags.DIRECTION);if(-1==ans.indexOf(anode)){ans.push(anode)}if(-1==ans.indexOf(bnode)){ans.push(bnode)}_(ans).each(function(an){newTransps(context,transps,an,to_way,way,editor,filter,nodeId2crossId)});filter={};return transps},drawMaatArrow:function(datas){var groups=d3.$("#surface").select(".layer-traffic").selectAll("g.traffic_arrow").data(_.values(this.transpsData(datas)),function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"node point traffic_arrow "+d.id});var context=this.context;group.append("g").call(roadMakerGrp,null,context);groups.attr("transform",iD.svg.PointTransform(context.projection)).call(iD.svg.TagClasses())},initBody:function($body){d3.selectAll(".line-info-panel .panel-body *").remove();var self=this;var context=this.context;var nodeId=this.nodeId;var $sidebar=$body.append("div").attr("class","side-bar-panel");var maatArrs=this.dataMgr.getMaatArrs(this.nodeId);var saatArrs=this.dataMgr.getSaatArrs(this.nodeId);var $bodyType=d3.select(".line-info-panel .btn-group .active").attr("id");var datas=[];var initData;if("saat"==$bodyType){datas=saatArrs;context.enter(iD.modes.Browse(context))}else if("maat"==$bodyType){datas=maatArrs;this.drawMaatArrow(datas)}datas=self.dataMgr.sortRealtions(datas,self.resultDatum);for(var i=0;i<datas.length;i++){if(!self.dataMgr.isDisabledLabel(datas[i],context)){initData=datas[i];break}}iD.svg.TurnGuidance().drawDirection(editor.context,initData);$sidebar.append("div").attr("class","side-bar-title").text("\u5173\u8054\u9053\u8DEF");var $showItems=$sidebar.append("ul").selectAll("li").data(datas);var $eachItem=$showItems.enter().append("li").on("click",function(d){if(d3.$(this).classed("disabled")&&!self.dataMgr.isActivableLabel(d,context)){return}var selectedIds=self.dataMgr.getHighlightIds(d);var preRel=d3.select(".side-bar-panel ul li.active").data()[0];var preSelectedIds=self.dataMgr.getHighlightIds(preRel);context.enter(iD.modes.Browse(context));self.selectElements(preSelectedIds,false);d3.select(this.parentNode).selectAll("li").classed("active",false);d3.select(this).classed("active",true);self.initContext($mainContext,d);self.selectElements(selectedIds,true);iD.svg.TurnGuidance().drawDirection(editor.context,d);self.drawMaatArrow([d])}).classed("active",function(d){if(d==initData){return true}return false}).classed("disabled",function(d){return self.dataMgr.isDisabledLabel(d,context)}).classed("saat-li",function(d){return self.dataMgr.isSaat(d)}).attr("index",function(d,i){return i});if(!initData)return;if(self.dataMgr.isSaat(initData)){$eachItem.append("label").text(function(d){var selectedIds=self.dataMgr.getHighlightIds(d);var way=context.entity(selectedIds[0]);var namechn=iD.ui.TagName.dbc2sbc(way.tags.NAME_CHN);return(""==way.tags.NAME_CHN?"\u672A\u547D\u540D":namechn)+":"+selectedIds[0].slice(selectedIds[0].indexOf("_")+1)}).attr("id",function(d){return d.id}).attr("class","saat-lable")}else{$eachItem.append("label").text(function(d){var selectedIds=self.dataMgr.getHighlightIds(d);var fWayId=selectedIds[0],fWay=context.entity(fWayId);var tWayId=selectedIds[1],tWay=context.entity(tWayId);var fnamechn=iD.ui.TagName.dbc2sbc(fWay.tags.NAME_CHN);var tnamechn=iD.ui.TagName.dbc2sbc(tWay.tags.NAME_CHN);return(""==fWay.tags.NAME_CHN?"\u672A\u547D\u540D":fnamechn)+"--"+(""==tWay.tags.NAME_CHN?"\u672A\u547D\u540D":tnamechn)}).attr("class","maat-lable");$eachItem.append("label").text(function(d){var selectedIds=self.dataMgr.getHighlightIds(d);var fWayId=selectedIds[0];var tWayId=selectedIds[1];var from_id=fWayId.slice(fWayId.indexOf("_")+1);var to_id=tWayId.slice(tWayId.indexOf("_")+1);return from_id+"->"+to_id}).attr("class","maat-lable")}var $mainContext=$body.append("div").attr("class","main-context");this.mainContext=$mainContext;if(initData){this.initContext($mainContext,initData);var selectedIds=self.dataMgr.getHighlightIds(initData);this.selectElements(selectedIds,true)}var keybinding=d3.keybinding("nodeLaneInfo");keybinding.on("\u2191",function(){self.keyBindingShow(self,"previous");d3.event.stopPropagation()},true).on("\u2193",function(){self.keyBindingShow(self,"next");d3.event.stopPropagation()},true).on("\u21A9",function(){d3.$(".line-info-panel .ui-dialog-buttonset .confirm").dispatch("click");d3.event.stopPropagation()},true);self.keybinding=keybinding;d3.select(document).call(keybinding)},initContext:function($mainContext,datum){var self=this;if(self.dataMgr.isSaat(datum)){self.initSaatContext($mainContext,datum)}else{self.initMaatContext($mainContext,datum)}},initSaatContext:function($mainContext,datum){d3.selectAll(".line-info-panel .main-context *").remove();var context=this.context;var self=this;var dataMgr=this.dataMgr;datum=context.entity(datum.id);var arrowTag=this.dataMgr.getArrowTag(datum);if("check"==d3.select("body").attr("role")||dataMgr.isZeroBugTask()||!dataMgr.isRealPictureTask()){var ltTurnLOption={options:[{label:"0 \u672A\u8C03\u67E5(\u9ED8\u8BA4)",value:0},{label:"1 \u6709",value:1},{label:"2 \u65E0",value:2}]};var ltTurnLeft=$mainContext.append("div").attr("class","lt-turn-left");self.select(ltTurnLOption,ltTurnLeft,datum.tags.LT_TURN_L,"\u5DE6\u8F6C");self.select(ltTurnLOption,ltTurnLeft,datum.tags.LT_UTURN_L,"\u5DE6\u6389\u5934");self.select(ltTurnLOption,ltTurnLeft,datum.tags.WAIT_L,"\u5DE6\u8F6C\u5F2F\u5F85\u8F6C\u533A");var arrowsArr=this.dataMgr.parseArrowTag(arrowTag.arrowTag,self.arrowOptions,self.applyflag);var $maatLineInfo=$mainContext.append("div").attr("class","maat-line-info").attr("laneinfoid",function(d){return arrowTag.id});var $lineInfoTitle=this.drawTitleBar($maatLineInfo,{title:"\u884C\u8F66\u5F15\u5BFC\u7EBF",disabled:isRealpictureScene(),editable:false,value:arrowsArr.map(function(d){return`<span class="image-${d}"></span>`}).join(""),render:function(){d3.$(".button-line-info input[value=\u6E05\u7A7A]",$maatLineInfo).dispatch("click")}});this.editLineInfo($maatLineInfo,arrowsArr,datum)}if("check"==d3.select("body").attr("role")||dataMgr.isZeroBugTask()||dataMgr.isRealPictureTask()){var $real=$mainContext.append("div").attr("class","background-mode");this.realBackground(datum,$real,false)}this.saveBtnGroups($mainContext,datum)},initMaatContext:function($mainContext,datum){d3.selectAll(".line-info-panel .main-context *").remove();var context=this.context;var self=this;var dataMgr=this.dataMgr;datum=context.entity(datum.id);var arrowResult=self.arrowResult;var guidancePicArrImage=self.dataMgr.getGuidancePic(datum,context,["20","21"]);arrowResult.image_id=0<guidancePicArrImage.length?guidancePicArrImage[0].tags.PIC_AR:"";var guidancePicArrSide=self.dataMgr.getGuidancePic(datum,context,["40"]);arrowResult.side_bmp=0<guidancePicArrSide.length?guidancePicArrSide[0].tags.PIC_AR:"";var guidancePicArrRear=self.dataMgr.getGuidancePic(datum,context,["10","11"]);arrowResult.rear_bmp=0<guidancePicArrRear.length?guidancePicArrRear[0].tags.PIC_AR:"";if("check"==d3.select("body").attr("role")||dataMgr.isZeroBugTask()||!dataMgr.isRealPictureTask()){this.editLaneInfoTotal($mainContext,datum);this.editTurnGuidances($mainContext,datum)}if("check"==d3.select("body").attr("role")||dataMgr.isZeroBugTask()||dataMgr.isRealPictureTask()){var $commonRealArrow=$mainContext.append("div").attr("class","common-Real-arrow");var realInitOptions=this.getInitArrowOption("rear_bmp",datum,context,true);this.editArrowTitle($commonRealArrow,realInitOptions);this.getArrowDataArrs($commonRealArrow,realInitOptions,self.editThreeDemensionArrow)}this.saveBtnGroups($mainContext,datum)},editArrowTitle:function(container,options){var $threeDemenArrowTitle=this.drawTitleBar(container,{title:options.title,value:options.initTextValue.replace(/^.+:/,""),disabled:options.disabled,editable:true,validate:function(){if(this.value&&!d3.$(`.left-side-image input[value="${this.value}"]`,container).node()){if("\u5B9E\u666F\u7BAD\u5934"===options.title&&/^[G-N]D\d{7}$/.test(this.value)){return false}d3.$(".clear-btn input",container).dispatch("click");return"\u7BAD\u5934ID\u9519\u8BEF"}},render:function(){if(this.value){d3.$(`.left-side-image input[value="${this.value}"]`,container).property("checked",true).dispatch("change")}else{d3.$(".clear-btn input",container).dispatch("click")}}})},saveBtnGroups:function($mainContext,datum){this.resultDatum=datum},editLaneInfoTotal:function($mainContext,datum){var context=this.context;var self=this;datum=context.entity(datum.id);var laneInfoOption=this.dataMgr.getArrowTag(datum,"1");var arrowsArr=this.dataMgr.parseArrowTag(laneInfoOption.arrowTag,self.arrowOptions,self.applyflag);var $maatLineInfo=$mainContext.append("div").attr("class","maat-line-info").attr("laneinfoid",function(d){return laneInfoOption.id});var $lineInfoTitle=this.drawTitleBar($maatLineInfo,{title:"\u884C\u8F66\u5F15\u5BFC\u7EBF",disabled:isRealpictureScene(),editable:false,value:arrowsArr.map(function(d){return`<span class="image-${d}"></span>`}).join(""),render:function(){d3.$(".button-line-info input[value=\u6E05\u7A7A]",$maatLineInfo).dispatch("click")}});this.editLineInfo($maatLineInfo,arrowsArr,datum);laneInfoOption.initFlag=true;laneInfoOption.subInputFlag=true;this.editLaneInfoNo($maatLineInfo,datum,laneInfoOption)},editLineInfo:function($context,arrowsArr,datum){var self=this;var $lineInfoEdit=$context.append("div").attr("class","line-info-edit").classed("hidden",function(d){return true});var arrowOptions=this.arrowOptions;$lineInfoEdit.append("h3").attr("class","edit-title").text("\u9009\u62E9\u5F15\u5BFC\u7EBF\u7C7B\u578B\uFF1A");var $chooseLaneInfo=$lineInfoEdit.append("div").attr("class","choose-line-info");$chooseLaneInfo.selectAll("span").data(arrowOptions).enter().append("span").attr("class",function(d){return"image-"+d}).on("dblclick.choose",function(d){var chooseimg=d;var titleSection=d3.select(this.parentNode.parentNode.parentNode.firstChild);titleSection.select(".thumbnail").append("span").attr("class",function(d){return"image-"+chooseimg});var selection=d3.select(this.parentNode.nextSibling);var isChecked=selection.select("input").node().checked;if(isChecked){titleSection.select(".thumbnail").append("span").attr("class",function(d){return"image-"+"LINE"})}});var $btnLineInfo=$lineInfoEdit.append("div").attr("class","button-line-info");var checkBoxBtn=$btnLineInfo.append("div").attr("class","check-box-div");checkBoxBtn.append("input").attr("type","checkbox").attr("checked",true);checkBoxBtn.append("label").text("\u81EA\u52A8\u8FFD\u52A0\u8F66\u9053\u7EBF").on("click.text",function(d){var checkbox=this.previousSibling;var isChecked=checkbox.checked;checkbox.checked=!isChecked});$btnLineInfo.append("input").attr("class","button").attr("type","button").attr("value","\u56DE\u5220").on("click",function(d){var titleDeleteEle=d3.select(this.parentNode.parentNode.parentNode).select(".thumbnail").node().lastChild;if(null==titleDeleteEle)return;titleDeleteEle.remove();var laneNoSection=d3.select(this.parentNode.parentNode.parentNode.parentNode.parentNode).select(".line-info-panel .maat-line-info .lane-info-number input");if(!laneNoSection.node())return;if("image-LINE"==titleDeleteEle.className)return;var value=laneNoSection.value();var newValue="";if(""!=value){var valueArr=value.split("|");valueArr.splice(valueArr.length-1,1);newValue=valueArr.join("|")}var laneInfoOption={initFlag:false,lane_no:newValue,subInitFlag:false};self.editLaneInfoNo($context,datum,laneInfoOption)});$btnLineInfo.append("input").attr("class","button").attr("type","button").attr("value","\u6E05\u7A7A").on("click",function(d){var titleCont=d3.select(this.parentNode.parentNode.parentNode).selectAll(".thumbnail *").remove();if(null==titleCont)return;titleCont.remove();var laneInfoNo=d3.select(".line-info-panel .maat-line-info .lane-info-number-input").node();if(laneInfoNo){var inputArrs=laneInfoNo.childNodes;for(var i=0;i<inputArrs.length;i++){d3.select(inputArrs[i]).value("")}d3.select(".line-info-panel .maat-line-info .lane-info-number input").value("")}});$btnLineInfo.append("input").attr("class","button").attr("type","button").attr("value","\u786E\u5B9A").on("click",function(d){var childNodes=this.parentNode.parentNode.parentNode.childNodes;for(var i=1;i<childNodes.length;i++){d3.select(childNodes[i]).classed("hidden",true)}var $thumbnail=d3.select(this.parentNode.parentNode.previousElementSibling).select(".thumbnail span:last-child").node();if($thumbnail&&"image-LINE"==$thumbnail.className){d3.select(this.parentNode.parentNode.previousElementSibling).select(".thumbnail span:last-child").remove()}})},editLaneInfoNo:function($maatLineInfo,datum,laneInfoOption){d3.selectAll(".line-info-panel .main-context .lane-info-number").remove();var context=this.context;var self=this;var initFlag=laneInfoOption.initFlag;var lane_no=laneInfoOption.lane_no;var $laneInfoNumber=$maatLineInfo.append("div").attr("class","lane-info-number").classed("hidden",function(d){return initFlag});var $laneInfoNumberManul=$laneInfoNumber.append("div").attr("class","lane-info-number-manul");var $laneInfoNumberText=$laneInfoNumber.append("div").attr("class","lane-info-number-text").classed("hidden",function(){if(laneInfoOption.subInputFlag!=undefined){return laneInfoOption.subInputFlag}else{return true}});var $laneInfoNumberInput=$laneInfoNumber.append("div").attr("class","lane-info-number-input").classed("hidden",function(){if(laneInfoOption.subInputFlag!=undefined){return laneInfoOption.subInputFlag}else{return true}});var $laneInfoNumberBtn=$laneInfoNumber.append("div").attr("class","lane-info-number-btn").classed("hidden",function(){if(laneInfoOption.subInputFlag!=undefined){return laneInfoOption.subInputFlag}else{return true}});$laneInfoNumberManul.append("span").text("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7:");$laneInfoNumberManul.append("input").attr("type","input").value(lane_no).on("change",function(){var value=this.value;self.dataMgr.isLaneNoValidate(value,datum,context,self)});$laneInfoNumberManul.append("input").attr("class","button").attr("type","button").attr("value","\u7F16\u8F91").on("click.laneInfoNum",function(d){var value=this.previousSibling.value;var valueArr=self.dataMgr.parseStr2IntArr(value,"|");var saat=self.dataMgr.getSaatFromMaat(context,datum)[0];var laneinfo=saat.tags.LANEINFO;var length1=laneinfo?laneinfo.split("|").length:0;var lanoInfoLength=self.dataMgr.getLaneInfoLineNum();var lane_no_flag=self.dataMgr.isLaneNoValidate(value,datum,context,self);if(lane_no_flag)return;var ischecked=d3.select(".line-info-panel .maat-line-info .lane-info-number .lane-info-number-btn .modify-in-order").node().checked;if(ischecked&&value){var numLength=valueArr.length;for(var i=numLength;i<lanoInfoLength;i++){valueArr[i]=valueArr[i-1]+1}value=valueArr.join("|")}var childNodes=this.parentElement.parentElement.childNodes;var isShown=d3.select(childNodes[1]).classed("hidden");var laneInfoOption={lane_no:value,initFlag:false,subInputFlag:!isShown};var $maatLineInfo=d3.selectAll(".line-info-panel .main-context .maat-line-info");self.editLaneInfoNo($maatLineInfo,datum,laneInfoOption)});$laneInfoNumberText.append("span").text("\u6FC0\u6D3B\u7F16\u8F91\u6846\u540E\uFF0C\u9F20\u6807\u6EDA\u8F6E\u53EF\u4EE5\u53D8\u66F4\u6570");for(var i=0;10>i;i++){$laneInfoNumberInput.append("input").attr("type","input").attr("id",i).on("mousewheel",function(d){d3.event.stopPropagation();d3.event.preventDefault();var value=parseInt(this.value);var id=parseInt(this.id);var checked=this.parentNode.nextElementSibling.childNodes[1].checked;var childs=this.parentNode.childNodes;var delta=d3.event.wheelDelta;var lanoInfoLength=self.dataMgr.getLaneInfoLineNum();var nextValue=9==id?undefined:childs[parseInt(id)+1].value;var preValue=0==id?undefined:childs[parseInt(id)-1].value;nextValue=parseInt(nextValue);preValue=parseInt(preValue);if(""==value||isNaN(value)||1>value)return;if(checked){if(0<delta){for(var j=id;j<lanoInfoLength;j++){d3.select(childs[j]).value(value+1+j-id)}}else if(1<value){if(value&&value<=preValue+1){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7\u5FC5\u987B\u4ECE\u5C0F\u5230\u5927\u5F55\u5165");return}for(var j=id;j<lanoInfoLength;j++){var jValue=value+(j-id)-1;0<jValue&&d3.select(childs[j]).value(jValue)}}}else{if(0<delta){if(value&&value+1>=nextValue){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7\u5FC5\u987B\u4ECE\u5C0F\u5230\u5927\u5F55\u5165");return}d3.select(this).value(value+1)}else if(1<value){if(value&&value-1<=preValue){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7\u5FC5\u987B\u4ECE\u5C0F\u5230\u5927\u5F55\u5165");return}d3.select(this).value(value-1)}}self.dataMgr.dealLaneInfoNoInput()}).on("change",function(){var childs=this.parentNode.childNodes;var id=parseInt(this.id);var value=parseInt(this.value);var nextValue=9==id?undefined:childs[parseInt(id)+1].value;var preValue=0==id?undefined:childs[parseInt(id)-1].value;var originValue=d3.select(".line-info-panel .maat-line-info .lane-info-number-manul input").value();var oValue=originValue.split("|")[id];if(value&&parseInt(value)<=parseInt(preValue)){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7\u5FC5\u987B\u4ECE\u5C0F\u5230\u5927\u5F55\u5165");d3.select(this).value(oValue?oValue:"");return}var ischecked=d3.select(".line-info-panel .maat-line-info .lane-info-number .lane-info-number-btn .modify-in-order").node().checked;if(ischecked){var lanoInfoLength=self.dataMgr.getLaneInfoLineNum();for(var i=id+1;i<lanoInfoLength;i++){d3.select(childs[i]).value(value+i-id)}}else if(value&&parseInt(value)>=parseInt(nextValue)){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7\u5FC5\u987B\u4ECE\u5C0F\u5230\u5927\u5F55\u5165");d3.select(this).value(oValue?oValue:"");return}self.dataMgr.dealLaneInfoNoInput()}).classed("disabled",function(){var selection=d3.select(".line-info-panel .maat-line-info .line-info-title .thumbnail").node();var arrowNodes=selection?selection.childNodes:[];var lineCount=0;for(var j=0;j<arrowNodes.length;j++){if("image-LINE"==d3.select(arrowNodes[j]).attr("class"))lineCount++}if(0<arrowNodes.length&&"image-LINE"!=d3.select(arrowNodes[arrowNodes.length-1]).attr("class")){lineCount++}var id=this.id;if(id<lineCount){return false}else{return true}}).attr("value",function(){var isDisable=d3.select(this).classed("disabled");if(isDisable)return;var value=d3.select(".line-info-panel .maat-line-info .lane-info-number input").value();var valueArr=""!=value?value.split("|"):[];d3.select(this).value(valueArr[i])})}$laneInfoNumberBtn.append("input").attr("class","button").attr("type","button").attr("value","\u6E05\u7A7A").on("click.clear",function(){var childs=this.parentNode.previousSibling.childNodes;for(var i=0;i<childs.length;i++){d3.select(childs[i]).value("")}d3.select(".line-info-panel .maat-line-info .lane-info-number input").value("")});$laneInfoNumberBtn.append("input").attr("type","checkbox").attr("class","modify-in-order").attr("checked",true);$laneInfoNumberBtn.append("label").text("\u987A\u5E8F\u5173\u8054\u4FEE\u6539").on("click.check",function(){var checkbox=this.previousSibling;var isChecked=checkbox.checked;checkbox.checked=!isChecked})},editTurnGuidances:function($mainContext,datum){var context=this.context;iD.svg.TurnGuidanceSeq(context).removeAll();var self=this;var $lineInfoPath=$mainContext.append("div").attr("class","line-info-path");var $lineInfoTitle=this.drawTitleBar($lineInfoPath,{title:"\u5F15\u5BFC\u7EBF\u8DEF\u5F84",value:"",disabled:isRealpictureScene(),editable:false,render:function(){d3.$$(".sub-line-info-path",$lineInfoPathDetail).each(function(d,i){d3.select(this).remove();context[i?"replace":"perform"](iD.actions.DeleteRelation(d.id),"\u5220\u9664\u884C\u8F66\u5F15\u5BFC\u7EBF\u8DEF\u5F84")})}});var $lineInfoPathBtn=$lineInfoPath.append("div").attr("class","line-info-btn-div");$lineInfoPathBtn.append("input").attr("type","button").attr("value","\u6DFB\u52A0\u8DEF\u5F84").attr("class","button").attr("status","edit").on("click",function(d){if("check"==d3.select("body").attr("role"))return;if(isRealpictureScene())return;var editable=d3.select(this).attr("status");if("edit"==editable){pathIds=[];context.enter(iD.modes.LaneInfoModify(context,pathIds,datum));d3.select(this).attr("value","\u6DFB\u52A0\u5B8C\u6210");d3.select(this).attr("status","finish")}else if("finish"==editable){if(context.mode().availableExit&&context.mode().availableExit()){var tgdArr=[];context.perform(iD.actions.CreateTurnGuidance(context,pathIds,tgdArr,{type:"30"}),"\u6DFB\u52A0\u884C\u8F66\u5F15\u5BFC\u7EBF\u8DEF\u5F84");context.enter(iD.modes.Browse(context));self.editLaneInfoTgd($lineInfoPathDetail,datum);d3.select(this).attr("value","\u6DFB\u52A0\u8DEF\u5F84");d3.select(this).attr("status","edit")}else if(!context.mode().availableExit){var tgdArr=[];context.enter(iD.modes.Browse(context));self.editLaneInfoTgd($lineInfoPathDetail,datum);d3.select(this).attr("value","\u6DFB\u52A0\u8DEF\u5F84");d3.select(this).attr("status","edit")}}});$lineInfoPathBtn.append("input").attr("class","button").attr("type","button").attr("value","\u5220\u9664").on("click.delete",function(){if("check"==d3.select("body").attr("role"))return;if(isRealpictureScene())return;if(null!=d3.select(".line-info-panel .line-info-path-title.active").node()){var selection=d3.select(".line-info-panel .line-info-path-title.active").node().parentElement;var data=d3.select(".line-info-panel .line-info-path-title.active").data()[0];d3.select(selection).remove();context.perform(iD.actions.DeleteRelation(data.id),"\u5220\u9664\u884C\u8F66\u5F15\u5BFC\u7EBF\u8DEF\u5F84")}});$lineInfoPathBtn.append("input").attr("type","button").attr("value","\u7F16\u8F91\u8DEF\u5F84").attr("class","button").attr("status","edit").on("click.edit",function(){if("check"==d3.select("body").attr("role"))return;if(isRealpictureScene())return;if(null!=d3.select(".line-info-panel .line-info-path-title.active").node()){var data=d3.select(".line-info-panel .line-info-path-title.active").data()[0];var editable=d3.select(this).attr("status");if("edit"==editable){pathIds=[];data.members.forEach(function(member){pathIds.push(member.id)});context.enter(iD.modes.LaneInfoModify(context,pathIds,datum));d3.select(this).attr("value","\u7F16\u8F91\u5B8C\u6210");d3.select(this).attr("status","finish")}else if("finish"==editable){if(context.mode().availableExit()){var members=[];for(var i=0;i<pathIds.length;i++){var member={id:pathIds[i],role:iD.data.RoleType.ROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD};members.push(member)}var tgdArr=[];context.perform(iD.actions.ChangeNodeMember(data.id,members),"\u7F16\u8F91\u884C\u8F66\u5F15\u5BFC\u7EBF\u8DEF\u5F84");context.enter(iD.modes.Browse(context));self.editLaneInfoTgd($lineInfoPathDetail,datum);d3.select(this).attr("value","\u7F16\u8F91\u8DEF\u5F84");d3.select(this).attr("status","edit")}}}});var $lineInfoPathDetail=$lineInfoPath.append("div").attr("class","line-info-path-detail");this.editLaneInfoTgd($lineInfoPathDetail,datum)},editLaneInfoTgd:function($lineInfoPathDetail,datum){d3.selectAll(".line-info-panel .line-info-path-detail *").remove();var context=this.context;var self=this;var TGDRelations=datum.getTurnGuidanceByMaat(context.graph(),"30");var tgdArrowsArr=[];TGDRelations.forEach(function(rel){var secondRels=context.graph().parentRelations(rel,iD.data.DataType.LANEINFO);if(0<secondRels.length){var arrows=secondRels[0].tags.ARROW;var arrowsArr=self.dataMgr.parseArrowTag(arrows,self.arrowOptions,self.applyflag);tgdArrowsArr.push({tgd_id:rel.id,arrow:arrowsArr})}else{tgdArrowsArr.push({tgd_id:rel.id,arrow:undefined,arrowStr:""})}});var $enter=$lineInfoPathDetail.selectAll("div").data(TGDRelations).enter();var $subLineInfoPath1=$enter.append("div").attr("class","sub-line-info-path").attr("id",function(d,i){return i}).attr("tgd",function(d,i){return d.id});var $lineInfoPathTitle=$subLineInfoPath1.append("div").attr("class","line-info-path-title");var $lineInfoPathTitleDiv=$lineInfoPathTitle.append("div").attr("class","sub").on("click.laneinfopath",function(d,i){var svg=iD.svg.TurnGuidanceSeq(context);svg.draw(d);if("check"==d3.select("body").attr("role"))return;if(isRealpictureScene())return;var targetIds=[];d.members.forEach(function(member){targetIds.push(member.id)});var isShow=d3.select(this.parentElement.nextElementSibling).classed("hidden");d3.selectAll(".line-info-panel .line-info-path .line-info-edit").classed("hidden",true);d3.selectAll(".line-info-panel .line-info-path .line-info-path-title").classed("active",false);d3.select(this.parentElement.nextElementSibling).classed("hidden",!isShow);d3.select(this.parentElement).classed("active",true);var selection=d3.selectAll(".line-info-panel .line-info-path .line-info-path-title .sub .thumbnail");selection[0].forEach(function(sel){var className=sel.lastChild?sel.lastChild.className:"";if(className&&"image-LINE"==className){d3.select(sel.lastChild).remove()}})});$lineInfoPathTitleDiv.append("span").attr("class","sub-path").html(function(d,i){var str="\u8DEF\u5F84"+i+":";var members=d.members;for(var i=0;i<members.length;i++){if(i!=members.length-1){str+=members[i].id.slice(members[i].id.indexOf("_")+1)+"->"}else{str+=members[i].id.slice(members[i].id.indexOf("_")+1)}}return str});var $pathThumbnail=$lineInfoPathTitleDiv.append("div").attr("class","thumbnail");$pathThumbnail[0].forEach(function(pthumbnail,i){var $tgd_path_sub=d3.select(pthumbnail.parentElement.parentElement.parentElement);var tgd_arrows_arr=tgdArrowsArr[i].arrow;if(tgd_arrows_arr!=undefined){d3.select(pthumbnail).selectAll("span").data(tgd_arrows_arr).enter().append("span").attr("class",function(d){return"image-"+d});self.editLineInfo($tgd_path_sub,tgdArrowsArr[i].arrow,datum)}else{self.editLineInfo($tgd_path_sub,[],datum)}})},drawTitleBar:function(container,opt){opt.disabled=opt.disabled?"disabled":"";opt.validate=opt.validate||(()=>false);if(this.dataMgr.isZeroBugTask()||"check"==d3.select("body").attr("role")){opt.disabled=""}container.html(Mustache.render(ttab,opt));var $backgroundTitle=d3.$(".line-info-title",container);var onInput=function(){var result=opt.validate.call(this);if(result){$backgroundTitle.classed("error",true);$backgroundTitle.attr("data-error",result)}else{opt.render.call(this,!result)}};d3.$("input",$backgroundTitle).on("input",function(){var args=Array.prototype.slice.call(arguments,0);args.unshift(this);setTimeout(Function.prototype.bind.apply(onInput,args),200);if($backgroundTitle.classed("error")){$backgroundTitle.classed("error",false)}d3.select(this.parentNode.nextElementSibling).classed("hidden",false)});d3.$("button",$backgroundTitle).on("click",function(){if(opt.editable){d3.$("input.thumbnail",$backgroundTitle).property("value","").dispatch("input")}else{opt.render.call(this)}});d3.$("i",$backgroundTitle).on("click.backgroundMode",function(d){if(opt.disabled)return;var title=this.parentNode;if(!title.nextElementSibling)return;var hidden=-1===title.nextElementSibling.className.indexOf("hidden");var childNodes=title.parentNode.childNodes;for(var i=1;i<childNodes.length;i++){d3.select(childNodes[i]).classed("hidden",hidden)}});return $backgroundTitle},realBackground:function(datum,container){var option=_.clone(option);var $backgroundTitle=container.append("div").attr("class","line-info-title");var self=this;this.rear_bmp=datum.tags.REAR_BMP;var $backgroundTitle=this.drawTitleBar(container,{title:"\u5B9E\u666F\u5BFC\u822A\u56FE\u7247",value:datum.tags.REAR_BMP,disabled:false,editable:true,render:function(isValid){if(isValid){if(this.value){self.rear_bmp=this.value}else{self.rear_bmp="";$img.style("background-image","none");$img.classed("preview",true)}}else{self.rear_bmp="";$img.style("background-image","none");$img.classed("preview",true)}},validate:function(){if(""!==this.value&&!/^[56]\d{7}$/.test(this.value)){return"\u8F93\u5165\u80CC\u666F\u56FE\u7247ID\u9519\u8BEF"}}});var $backgroundDetail=container.append("div").attr("class","realBackground-detail").classed("hidden",function(){return true});var $detailImg=$backgroundDetail.append("div").attr("class","background-tree-img");var $img=$detailImg.append("div").attr("class","background-img preview")},editBackgroundMode:function(datum,container,option){var option=_.clone(option);var self=this;var $backgroundTitle=this.drawTitleBar(container,{title:option.initTextValue,value:datum.tags[option.tagString],disabled:isRealpictureScene(),editable:true,render:function(){if(this.value){var valueType=0==this.value.indexOf("8")?"1":"0";if("undefined"!==typeof $roadTypes){_.map($roadTypes.selectAll("input")[0],function(num,i){if(num.value==valueType){num.checked=true;d3.select(num).dispatch("change")}})}$tree.datum().value(this.value,true)}else{if($tree.datum().value()){var input=d3.$("input",$tree.datum()._selected);input.property("checked",false);input.dispatch("change")}}},validate:function(){if(this.value&&!/^\d{8}$/.test(this.value)){$tree.datum().value(null);return"\u8F93\u5165\u80CC\u666F\u56FE\u7247ID\u9519\u8BEF"}}});option.value=datum.tags[option.tagString];this[option.tagString]=datum.tags[option.tagString];var $backgroundDetail=container.append("div").classed("backgroundMode-detail",true).classed("hidden",option.initFlag);if(option.isRadio){var $roadTypes=$backgroundDetail.append("div").attr("class","road-type");$roadTypes.selectAll("span").data(self.roadTypeArr,function(d){return d.type}).enter().append("span");$roadTypes.selectAll("span").append("input").attr("type","radio").attr("name","background"+option.tagString).attr("value",function(d){return d.type}).property("checked",function(d){if(d.type==option.type){return true}return false}).on("change",roadTypeChange);$roadTypes.selectAll("span").append("text").text(function(d){return d.name})}var $treeImg=$backgroundDetail.append("div").attr("class","background-tree-img");var $tree=$treeImg.append("div").attr("class","background-tree");var $img=$treeImg.append("div").attr("class","background-img");function roadTypeChange(e){option.type=e.type;$tree.node().removeChild($tree.node().childNodes[0])}},editTextValueForGSP:function(datum,$guidancespSub,textValueArr,refTextValueArr,initFlag,isEdit){var self=this;var context=this.context;var $mainContext=d3.select(".line-info-panel .main-context");var guidancespArr=self.dataMgr.getGuidanceSP(datum,context);var initTextValue="";if(0<guidancespArr.length){initTextValue=guidancespArr[0].tags.TEXTVALUE}var $guidancespTitle=this.drawTitleBar($guidancespSub,{title:"\u65B9\u5411\u4FE1\u606F",value:textValueArr.join("::"),disabled:isRealpictureScene(),editable:true,validate:function(){if(/^::|::$/.test(this.value)){return"\u683C\u5F0F\u9519\u8BEF"}},render:function(){if(this.value){this.value=this.value.toUpperCase()}self.editTextValueForGSP(datum,$guidancespSub,this.value?this.value.split("::"):[],self.refTextValueArr,false,true)}});if(isEdit){var input=d3.$("input",$guidancespTitle).node();input.focus();input.value=input.value.toUpperCase();input.setSelectionRange(input.value.length,input.value.length+1)}var $guidancespDetail=$guidancespSub.append("div").attr("class","guidancesp-detail").classed("hidden",function(){return initFlag});var gspTextvalueOptions=self.gspTextvalueOptions;var $guidancespSelect=$guidancespDetail.append("div").attr("class","line-info-select");var $gspTextvalue=$guidancespSelect.append("div").attr("class","select-div").attr("id","text-value").attr("value","0");var text_value_init="11";this.select(gspTextvalueOptions,$gspTextvalue,text_value_init);$guidancespSelect.append("input").attr("type","text").attr("class","to-road-name").attr("placeholder","\u5230\u8DEF\u53E3").on("change",function(){var value=this.value.toUpperCase();var selection=d3.select(".line-info-panel .gsp-detail-left .gsp-select-list ul li.active label");if(selection.node()){var name=selection.text();var str=name.substr(0,2)+value;var textvalueArr=self.getTextValueArrForGSP();if(""==value){Dialog.alert("\u8DEF\u724C\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01");return}else if(-1<textvalueArr.indexOf(str)){Dialog.alert("\u4E0D\u80FD\u6DFB\u52A0\u91CD\u590D\u7684\u8DEF\u724C\u540D\u79F0!");return}selection.text(str);textvalueArr=self.getTextValueArrForGSP();self.editTextValueForGSP(datum,$guidancespSub,textvalueArr,self.refTextValueArr,false)}});d3.$(".select",$gspTextvalue).on("change.intext",function(d){var value=this.value;var selection=d3.select(".line-info-panel .gsp-detail-left .gsp-select-list ul li.active label");if(selection.node()){var name=selection.text();var str=value+name.substr(2);selection.text(str)}});var $guidancespDetailCont=$guidancespDetail.append("div").attr("class","gsp-detail-cont");var $guidancespLeft=$guidancespDetailCont.append("div").attr("class","gsp-detail-left");var $guidancespCenter=$guidancespDetailCont.append("div").attr("class","gsp-detail-center");var $guidancespRight=$guidancespDetailCont.append("div").attr("class","gsp-detail-right");$guidancespLeft.append("div").attr("class","gsp-select-title").text("\u76EE\u7684\u5730\u4FE1\u606F\u5217\u8868");var $gspLeftList=$guidancespLeft.append("div").attr("class","gsp-select-list");var $showItems=$gspLeftList.append("ul").selectAll("li").data(textValueArr);var $eachItem=$showItems.enter().append("li").on("click",function(d){var isShow=d3.select(this).classed("active");d3.select(this.parentNode).selectAll("li").classed("active",false);d3.select(this).classed("active",!isShow);var str=d3.select(this).text();if(!isShow){d3.select(".line-info-panel .to-road-name").value(str.substr(2));d3.select(".line-info-panel .guidancesp-sub .guidancesp-detail .select").value(str.substr(0,2))}else{d3.select(".line-info-panel .to-road-name").value("");d3.select(".line-info-panel .guidancesp-sub .guidancesp-detail .select").value("11")}});$eachItem.append("label").text(function(d){return d});$guidancespCenter.append("input").attr("class","button").attr("type","button").attr("value","\u6DFB\u52A0").on("click.add",function(){var textvalueArr=self.getTextValueArrForGSP();var selectvalue=d3.selectAll(".guidancesp-sub .line-info-select .select").node().value;var inputvalue=d3.selectAll(".guidancesp-sub .line-info-select .to-road-name").node().value;var value=selectvalue+inputvalue.toUpperCase();if(""==inputvalue){Dialog.alert("\u8DEF\u724C\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01");return}else if(-1<textvalueArr.indexOf(value)){Dialog.alert("\u4E0D\u80FD\u6DFB\u52A0\u91CD\u590D\u7684\u8DEF\u724C\u540D\u79F0!");return}var newTextvalueArr=textvalueArr.concat(value);self.editTextValueForGSP(datum,$guidancespSub,newTextvalueArr,self.refTextValueArr,false)});$guidancespCenter.append("input").attr("class","button").attr("type","button").attr("value","\u5220\u9664").on("click.delete",function(){var textvalueArr=self.getTextValueArrForGSP();var selection=d3.select(".line-info-panel .gsp-detail-left .gsp-select-list ul li.active label");if(selection.node()){var value=selection.text();var index=textvalueArr.indexOf(value);textvalueArr.splice(index,1);self.editTextValueForGSP(datum,$guidancespSub,textvalueArr,self.refTextValueArr,false)}});$guidancespCenter.append("input").attr("class","button").attr("type","button").attr("value","\u4E0A\u79FB").on("click.moveup",function(d){var textvalueArr=self.getTextValueArrForGSP();var selection=d3.select(".line-info-panel .gsp-detail-left .gsp-select-list ul li.active label");if(selection.node()){var value=selection.text();var index=textvalueArr.indexOf(value);if(0==index){Dialog.alert("\u5DF2\u7ECF\u662F\u6700\u4E0A\u9762\u4E00\u4E2A\uFF01")}else{textvalueArr[index]=textvalueArr[index-1];textvalueArr[index-1]=value}self.editTextValueForGSP(datum,$guidancespSub,textvalueArr,self.refTextValueArr,false)}});$guidancespCenter.append("input").attr("class","button").attr("type","button").attr("value","\u4E0B\u79FB").on("click.movedown",function(){var textvalueArr=self.getTextValueArrForGSP();var selection=d3.select(".line-info-panel .gsp-detail-left .gsp-select-list ul li.active label");if(selection.node()){var value=selection.text();var index=textvalueArr.indexOf(value);if(index==textvalueArr.length-1){Dialog.alert("\u5DF2\u7ECF\u662F\u6700\u4E0B\u9762\u4E00\u4E2A\uFF01")}else{textvalueArr[index]=textvalueArr[index+1];textvalueArr[index+1]=value}self.editTextValueForGSP(datum,$guidancespSub,textvalueArr,self.refTextValueArr,false)}});$guidancespCenter.append("input").attr("class","button").attr("type","button").attr("value","\u6E05\u9664").on("click.clear",function(d){d3.selectAll(".line-info-panel .gsp-detail-left .gsp-select-list ul *").remove()});$guidancespRight.append("div").attr("class","gsp-select-title").text("\u53C2\u8003\u5185\u5BB9(\u53CC\u51FB\u66FF\u6362)");var $gspRightList=$guidancespRight.append("div").attr("class","gsp-select-list");var $showItems=$gspRightList.append("ul").selectAll("li").data(refTextValueArr);var $eachItem=$showItems.enter().append("li").on("dblclick.refrence",function(d){var selection=d3.select(".line-info-panel .gsp-detail-left .gsp-select-list ul li.active label");if(selection.node()){var name=selection.text();var str=name.substr(0,2)+d;var textvalueArr=self.getTextValueArrForGSP();if(-1<textvalueArr.indexOf(str)){Dialog.alert("\u4E0D\u80FD\u6DFB\u52A0\u91CD\u590D\u7684\u8DEF\u724C\u540D\u79F0!")}else{selection.text(str)}}d3.select(this.parentNode).selectAll("li").classed("active",false);d3.select(this).classed("active",true);d3.select(".line-info-panel .to-road-name").value(d)});$eachItem.append("label").text(function(d){return d})},editThreeDemensionArrow:function(container,arrowInitOptions){var self=arrowInitOptions.self;var $threeDemenArrowDetail=container.append("div").attr("class","threeDemenArrowTitle-detail").classed("hidden",function(){return arrowInitOptions.initFlag});var $treeImg=$threeDemenArrowDetail.append("div").attr("class","background-tree-img");var $imageLeftSide=$treeImg.append("div").attr("class","left-side-image");$imageLeftSide.selectAll("span").data(arrowInitOptions.arrowArr).enter().append("span");$imageLeftSide.selectAll("span").append("input").attr("type","radio").attr("name","threeDemenArrows"+arrowInitOptions.roadType).attr("value",function(d){return d.code}).property("checked",function(d){if(d.code==arrowInitOptions.target){return true}return false}).on("change",function(d){var tagtype=arrowInitOptions.roadType;self.arrowResult[tagtype]=d.code;var url=d.url;var canvas=container.select(" canvas").node();if(!url){var context2d=canvas.getContext("2d");context2d.clearRect(0,0,canvas.width,canvas.height);d3.$(".line-info-title",container).classed("error",true).attr("data-error","\u8BF7\u6C42\u4E0D\u5230\u5BF9\u5E94\u7684\u56FE\u7247\u6570\u636E");d3.$(".line-info-title input",container).property("value",d.code)}else{self.dataMgr.drawImage(canvas,url);d3.$(".line-info-title input",container).property("value",d.code);d3.$(".line-info-title",container).classed("error",false)}});$imageLeftSide.selectAll("span").append("text").text(function(d){return d.name});$imageLeftSide.append("div").attr("class","clear-btn").append("input").attr("class","button").attr("type","button").attr("value","\u6E05\u9664\u7BAD\u5934").on("click.clearBtn",function(d){self.arrowResult[arrowInitOptions.roadType]="";container.selectAll(".left-side-image input").property("checked",false);var canvas=container.select(".right-side-image canvas").node();var context2d=canvas.getContext("2d");context2d.clearRect(0,0,canvas.width,canvas.height);d3.$(".line-info-title input",container).property("value","")});var $imageRightSide=$treeImg.append("div").attr("class","right-side-image");var canvas=$imageRightSide.append("canvas");var target=arrowInitOptions.target;var targetImg=arrowInitOptions.targetImg;if(""!=targetImg){var style="url("+arrowInitOptions.bgUrl+")";$imageRightSide.style("style",function(d){d3.select(this).style("background-image",style);d3.select(this).style("background-repeat","no-repeat")})}if(""!=target){var arrowArr=arrowInitOptions.arrowArr.filter(function(d){return d.code==target});if(0<arrowArr.length){var url=arrowArr[0].url;self.dataMgr.drawImage(canvas.node(),url)}}},getArrowDataArrs:function($threeDemenArrow,arrowInitOptions,callback){$threeDemenArrow.select(".line-info-panel .threeDemenArrowTitle-detail").remove();var context=this.context;var datum=arrowInitOptions.maat,tag=arrowInitOptions.roadType,initFlag=arrowInitOptions.initFlag;var saat=arrowInitOptions.saat;var self=this;var targetImg;if("image_id"==tag){targetImg=saat.tags.IMAGE_ID}else if("side_bmp"==tag){targetImg=saat.tags.SIDE_BMP}else if("rear_bmp"==tag){targetImg=saat.tags.REAR_BMP}if(""!=targetImg){var catalogUrl=iD.url.getURL().fms_url+self.urlOptions.catalogUrl;var url=catalogUrl+targetImg;if("rear_bmp"==tag){var style="6"==targetImg[0]?"&style=101":"&style=201";url+=style}if("image_id"==tag){var style="";if(0==targetImg.indexOf("7040")){style="&style=4"}else if(0==targetImg.indexOf("7080")){style="&style=5"}url+=style}d3.json(url,function(error,data){if(error){Dialog.alert("\u8BF7\u6C42\u4E0D\u5230\u5BF9\u5E94\u7684\u7BAD\u5934\u6570\u636E\uFF01");return[]}var bgUrl=data.bg?data.bg[0].url:"";var arrowArr=[];var arr=data.ar||[];var tempArr=[];arr=_.sortBy(arr,function(d){return d.code});if("rear_bmp"==tag){tempArr=arrowInitOptions.self.commonRealArrow;self.dataMgr.updataArray(tempArr,arr);tempArr.forEach(function(arrow,index){var str="\u7BAD\u5934"+arrow.code.substr(0,1);arrow=_.assign(arrow,{name:str});arrowArr.push(arrow)})}else{arr.forEach(function(arrow,index){var str="\u7BAD\u5934"+(index+1);arrow=_.assign(arrow,{name:str});arrowArr.push(arrow)})}arrowInitOptions=_.assign(arrowInitOptions,{self:self,targetImg:targetImg,bgUrl:bgUrl,arrowArr:arrowArr});callback($threeDemenArrow,arrowInitOptions)})}},getInitArrowOption:function(roadTagTpye,datum,context,initFlag){var self=this;var saatArrs=this.dataMgr.getSaatFromMaat(context,datum);var type,title,disabled=false;var image_id=saatArrs[0].tags.IMAGE_ID;if("image_id"==roadTagTpye){type=["20","21"];title="3D\u7BAD\u5934"}else if("rear_bmp"==roadTagTpye){type=["10","11"];title="\u5B9E\u666F\u7BAD\u5934"}else if(roadTagTpye="side_bmp"){type=["40"];title="\u8F85\u8DEF\u7BAD\u5934"}var initOptions={saat:saatArrs[0],maat:datum,initFlag:initFlag,disabled:disabled};var guidancePicArr=self.dataMgr.getGuidancePic(datum,context,type);var target="";if(0<guidancePicArr.length){target=guidancePicArr[0].tags.PIC_AR}var saat_rear_bmp="";if(0<saatArrs.length){saat_rear_bmp=saatArrs[0].tags.REAR_BMP}var tempRearArrows=[];var temp_rear_bmp=saat_rear_bmp.substr(1);if("rear_bmp"==roadTagTpye&&saat_rear_bmp){if("5"==saat_rear_bmp[0]){_.map(self.highSpeedArr,function(v){tempRearArrows.push({code:v+temp_rear_bmp})})}else{_.map(self.ordinaryArr,function(v){tempRearArrows.push({code:v+temp_rear_bmp})})}}self.commonRealArrow=tempRearArrows;var initTextValue="";if("image_id"==roadTagTpye){if(image_id&&"7"==image_id[0]){initTextValue="\u666E\u901A\u7BAD\u5934:"+target}else{initTextValue="\u9AD8\u901F\u7BAD\u5934:"+target}}else if("side_bmp"==roadTagTpye){initTextValue="\u8F85\u8DEF\u7BAD\u5934:"+target}else if("rear_bmp"==roadTagTpye){initTextValue="\u5B9E\u666F\u7BAD\u5934:"+target}var arrowInitOptions=_.assign(initOptions,{roadType:roadTagTpye,target:target,initTextValue:initTextValue,self:self,title:title});return arrowInitOptions},select:function(options,selection,initVal,label){selection.append("label").attr("class","field-label").html(function(d){return options.label||label});var $section=selection.append("span").attr("class","field-input");var $select=$section.append("select").attr("class","select").attr("disabled",function(){if("check"==d3.select("body").attr("role"))return true;return null}).on("change",function(d){d3.select(this.parentElement.parentElement).attr("value",this.value)});$select.selectAll("option").data(options.options).enter().append("option").attr("value",function(d){return d.value}).attr("selected",function(d){if(d.value==initVal){return true}return null}).text(function(d){return d.label})},getTextValueArrForGSP:function(){var selections=d3.selectAll(".line-info-panel .main-context .gsp-detail-left .gsp-select-list ul li label")[0];var results=[];for(var i=0;i<selections.length;i++){var substr=d3.select(selections[i]).text();results.push(substr)}return results},doSaveFunc:function(datum){var context=this.context;var self=this;var dataMgr=this.dataMgr;var laneinfoTag=self.dataMgr.getLaneInfoTag();var saat,arrowResult;if("check"==d3.select("body").attr("role"))return;if(self.dataMgr.isSaat(datum)){if(dataMgr.isZeroBugTask()||!dataMgr.isRealPictureTask()){var turnSelection=d3.selectAll(".line-info-panel .lt-turn-left select")[0];var turnTags={LT_TURN_L:"0",LT_UTURN_L:"0",WAIT_L:"0"};for(var i=0;i<turnSelection.length;i++){var value=turnSelection[i].value.toString();switch(i){case 0:turnTags.LT_TURN_L=value;break;case 1:turnTags.LT_UTURN_L=value;break;case 2:turnTags.WAIT_L=value;break;default:break;}}datum=datum.mergeTags(turnTags);context.replace(iD.actions.AddEntity(datum),"\u4FEE\u6539saat\u4E0A\u7684\u5DE6\u8F6C\u4FE1\u606F");var fWayId=datum.memberByRole(iD.data.RoleType.ROAD_ID).id;if(datum.tags.LANEINFO!=laneinfoTag){self.arrowValidateFlag[fWayId]=true}datum=datum.mergeTags({LANEINFO:laneinfoTag});datum=iD.util.tagExtend.updateVerifyTag(datum);context.replace(iD.actions.AddEntity(datum),"\u4FEE\u6539saat\u4E0A\u7684\u7BAD\u5934\u4FE1\u606F")}}else{if(dataMgr.isZeroBugTask()||!dataMgr.isRealPictureTask()){var laneInfoForMaat=self.dataMgr.getLaneInfoRel(datum,context);var lane_no=d3.select(".line-info-panel .maat-line-info .lane-info-number-manul input").value();var lane_no_Arr=lane_no?lane_no.split("|"):[],lane_no_length=lane_no_Arr.length,lane_info_arrow_arr=laneinfoTag.split("|"),arrow_length=lane_info_arrow_arr.length;if(lane_no_length>arrow_length){var tempArr=[];for(var i=0;i<arrow_length;i++){tempArr[i]=lane_no_Arr[i]}lane_no=tempArr.join("|")}if(0==laneInfoForMaat.length&&""!=laneinfoTag){context.replace(iD.actions.CreateLaneInfo(context,datum.id,{ARROW:laneinfoTag,LANE_NO:lane_no}),"\u521B\u5EFAmaat\u4E0A\u7684\u7BAD\u5934\u4FE1\u606F")}else if(0<laneInfoForMaat.length){laneInfoForMaat[0]=iD.util.tagExtend.updateVerifyTag(laneInfoForMaat[0]);laneInfoForMaat[0]=laneInfoForMaat[0].mergeTags({ARROW:laneinfoTag,LANE_NO:lane_no});context.replace(iD.actions.AddEntity(laneInfoForMaat[0]),"\u4FEE\u6539maat\u4E0A\u7684\u7BAD\u5934\u4FE1\u606F")}var pathResults=self.dataMgr.getPathResults();pathResults.forEach(function(result){var tgd_rel=context.entity(result.tgd_id);var laneInfoForTgd=self.dataMgr.getLaneInfoRel(tgd_rel,context);if(0==laneInfoForTgd.length&&""!=result.arrowTag){context.replace(iD.actions.CreateLaneInfo(context,result.tgd_id,{ARROW:result.arrowTag},datum),"\u521B\u5EFAtgd\u4E0A\u7684\u7BAD\u5934\u4FE1\u606F")}else if(0<laneInfoForTgd.length){laneInfoForTgd[0]=iD.util.tagExtend.updateVerifyTag(laneInfoForTgd[0]);laneInfoForTgd[0]=laneInfoForTgd[0].mergeTags({ARROW:result.arrowTag});context.replace(iD.actions.AddEntity(laneInfoForTgd[0]),"\u4FEE\u6539tgd\u4E0A\u7684\u7BAD\u5934\u4FE1\u606F")}});arrowResult=self.arrowResult;saat=self.dataMgr.getSaatFromMaat(context,datum)[0];var image_id=saat.tags.IMAGE_ID;var side_bmp=saat.tags.SIDE_BMP;var image_id_arrow=arrowResult.image_id;var side_bmp_arrow=arrowResult.side_bmp;var guidancePicArrImage=self.dataMgr.getGuidancePic(datum,context,["20","21"]);if(0==guidancePicArrImage.length&&""!=image_id_arrow){var type="7"==image_id[0]?"20":"21";context.replace(iD.actions.CreateGuidancePicture(context,datum,[],{pic_ar:image_id_arrow,pic_bk:image_id,type:type}),"\u521B\u5EFAmaat\u4E0A\u7684\u9AD8\u901F/\u666E\u901A\u5F15\u5BFC\u56FE\u7247\u5173\u7CFB")}else if(0<guidancePicArrImage.length){var type="7"==image_id[0]?"20":"21";guidancePicArrImage[0]=iD.util.tagExtend.updateVerifyTag(guidancePicArrImage[0]);guidancePicArrImage[0]=guidancePicArrImage[0].mergeTags({pic_ar:image_id_arrow,pic_bk:image_id,type:type});context.replace(iD.actions.AddEntity(guidancePicArrImage[0]),"\u4FEE\u6539maat\u4E0A\u7684\u9AD8\u901F/\u666E\u901A\u5F15\u5BFC\u56FE\u7247\u5173\u7CFB")}var guidancePicArrSide=self.dataMgr.getGuidancePic(datum,context,["40"]);if(0==guidancePicArrSide.length&&""!=side_bmp_arrow){context.replace(iD.actions.CreateGuidancePicture(context,datum,[],{pic_ar:side_bmp_arrow,pic_bk:side_bmp,type:"40"}),"\u521B\u5EFAmaat\u4E0A\u7684\u8F85\u8DEF\u5F15\u5BFC\u56FE\u7247\u5173\u7CFB")}else if(0<guidancePicArrSide.length){guidancePicArrSide[0]=iD.util.tagExtend.updateVerifyTag(guidancePicArrSide[0]);guidancePicArrSide[0]=guidancePicArrSide[0].mergeTags({pic_ar:side_bmp_arrow,pic_bk:side_bmp});context.replace(iD.actions.AddEntity(guidancePicArrSide[0]),"\u4FEE\u6539maat\u4E0A\u7684\u8F85\u8DEF\u5F15\u5BFC\u56FE\u7247\u5173\u7CFB")}}if(dataMgr.isZeroBugTask()||dataMgr.isRealPictureTask()){arrowResult=self.arrowResult;saat=self.dataMgr.getSaatFromMaat(context,datum)[0];var rear_bmp=saat.tags.REAR_BMP;var rear_bmp_arrow=arrowResult.rear_bmp;var guidancePicArrRear=self.dataMgr.getGuidancePic(datum,context,["10","11"]);if(0==guidancePicArrRear.length&&""!=rear_bmp_arrow){var rear_type="6"==rear_bmp[0]?"10":"11";context.replace(iD.actions.CreateGuidancePicture(context,datum,[],{pic_ar:rear_bmp_arrow,pic_bk:rear_bmp,type:rear_type}),"\u521B\u5EFAmaat\u4E0A\u7684\u8F85\u8DEF\u5F15\u5BFC\u56FE\u7247\u5173\u7CFB")}else if(0<guidancePicArrRear.length){guidancePicArrRear[0]=iD.util.tagExtend.updateVerifyTag(guidancePicArrRear[0]);guidancePicArrRear[0]=guidancePicArrRear[0].mergeTags({pic_ar:rear_bmp_arrow,pic_bk:rear_bmp});context.replace(iD.actions.AddEntity(guidancePicArrRear[0]),"\u4FEE\u6539maat\u4E0A\u7684\u5B9E\u666F\u56FE\u7247\u5173\u7CFB")}}}},dataValidate:function(datum,context){var self=this;if(!d3.select(".line-info-panel .main-context .maat-line-info .lane-info-number-input").node())return;var saatDatum=self.dataMgr.getSaatFromMaat(context,datum);var fWayId=saatDatum[0].memberByRole(iD.data.RoleType.ROAD_ID).id;var laneinfoTag=self.dataMgr.getLaneInfoTag();var laneInfoForMaat=self.dataMgr.getLaneInfoRel(datum,context);if(0==laneInfoForMaat.length&&""!=laneinfoTag){self.arrowValidateFlag[fWayId]=true}else if(0<laneInfoForMaat.length&&!self.arrowValidateFlag[fWayId]){self.arrowValidateFlag[fWayId]=laneInfoForMaat[0].tags.ARROW!=laneinfoTag?true:false}if(!self.arrowValidateFlag[fWayId])return;var lane_no_value=d3.select(".line-info-panel .maat-line-info .lane-info-number .lane-info-number-manul input").value();var lane_no_flag=self.dataMgr.isLaneNoValidate(lane_no_value,datum,context,self);if(lane_no_flag)return;var childNodes=d3.select(".line-info-panel .main-context .maat-line-info .lane-info-number-input").node().childNodes;var editFlag=false;var laneInfoLength=self.dataMgr.getLaneInfoLineNum();var lane_no=d3.select(".line-info-panel .maat-line-info .lane-info-number-manul input").value();var length=self.dataMgr.parseStr2IntArr(lane_no,"|").length;if(lane_no){editFlag=true}var laneinfoTag=self.dataMgr.getLaneInfoTag();var laneindoTagObject=self.dataMgr.getLaneInfoTagObject(laneinfoTag);var saat=self.dataMgr.getSaatFromMaat(context,datum)[0];var saatTag=saat.tags.LANEINFO;var saatTagObject=self.dataMgr.getLaneInfoTagObject(saatTag);var flag=false;for(var key in laneindoTagObject){if(laneindoTagObject[key]>saatTagObject[key]){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u8F91\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u7F16\u8F91");flag=true;break}}if(flag){return}for(var key in laneindoTagObject){if(laneindoTagObject[key]<saatTagObject[key]&&laneInfoLength!=length){Dialog.alert("\u8BF7\u7F16\u8F91\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7");flag=true;break}}if(flag){return}if(editFlag&&laneInfoLength!=length){Dialog.alert("\u8BF7\u7F16\u8F91\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7");return}},selectElements:function(selectedIDs,flag){var context=this.context;context.surface().selectAll(iD.util.entityOrMemberSelector(selectedIDs,context.graph())).classed("selected",flag)},show:function(){d3.select(".line-info-panel").remove();if(!this.dialog){this.initPanel()}var self=this;try{self.$panelBody.node().focus()}catch(e){console.warn(e)}},showContextByClick:function($mainContext,self,d,enablePreDom){var context=this.context;var selectedIds=self.dataMgr.getHighlightIds(d);var preRel=d3.select(".side-bar-panel ul li.active").data()[0];var preSelectedIds=self.dataMgr.getHighlightIds(preRel);var selectli=d3.select(".side-bar-panel ul li.active")[0][0];self.selectElements(preSelectedIds,false);context.enter(iD.modes.Browse(context));d3.select(selectli.parentNode).selectAll("li").classed("active",false);d3.select(enablePreDom).classed("active",true);self.initContext($mainContext,d);self.selectElements(selectedIds,true);iD.svg.TurnGuidance().drawDirection(editor.context,d)},keyBindingShow:function(self,flag){var selection=d3.select(".side-bar-panel ul li.active")[0][0];var index=selection.getAttribute("index");while(!enablePreDom){if("previous"==flag){var flagDom=selection.previousSibling}else{var flagDom=selection.nextSibling;;}if(flagDom){if(!d3.select(flagDom).classed("disabled")){var enablePreDom=flagDom}else{selection=flagDom}}else{break}}if(enablePreDom){var d=d3.select(enablePreDom).data()[0];self.showContextByClick(self.mainContext,self,d,enablePreDom)}},hide:function(){var context=this.context;context.enter(iD.modes.Browse(context));iD.svg.TurnGuidanceSeq(context).removeAll();this.dialog=null;if(this.keybinding){d3.select(document).call(this.keybinding.off);this.keybinding=null}this.context.history().on("change.road_fitler",null);this.entities=null;this.dispatch.close();iD.svg.TurnGuidance().removeDirectionLayer()},disabled:function(graph){let entity=graph.entity(this.nodeId),isDirection=true;let ways=graph.parentWays(entity);ways&&ways.length&&ways.forEach(function(w){if(w&&w.modelName==iD.data.DataType.ROAD&&(!w.tags.DIRECTION||"NULL"==w.tags.DIRECTION)){isDirection=false}});if(!isDirection){return"not_eligible"}return isDirection}})})(iD);;;iD.ui.NodeLineInfo.dataMgr=function(context){var mgrEvent=d3.dispatch("loading","loaded");function DataMgr(){this.directOptions={label:"\u987A\u884C\u9053\u8DEF",options:[{label:"-1-\u672A\u8C03\u67E5",value:-1},{label:"100-\u987A\u884C",value:100},{label:"101-\u524D\u65B9",value:101},{label:"102-\u53F3\u524D\u65B9",value:102},{label:"103-\u53F3\u65B9",value:103},{label:"104-\u53F3\u540E\u65B9",value:104},{label:"105-\u540E\u65B9",value:105},{label:"106-\u5DE6\u540E\u65B9",value:106},{label:"107-\u5DE6\u65B9",value:107},{label:"108-\u5DE6\u524D\u65B9",value:108},{label:"110-\u4FDD\u6301\u5728\u4E2D\u592E\u8F66\u9053\u884C\u9A76",value:110},{label:"111-\u4FDD\u6301\u5728\u5DE6\u4FA7\u8F66\u9053\u884C\u9A76",value:111},{label:"112-\u4FDD\u6301\u5728\u53F3\u4FA7\u8F66\u9053\u884C\u9A76",value:112},{label:"180-\u4FDD\u6301\u5728\u4E2D\u592E\u8F66\u9053\u884C\u9A762",value:180},{label:"181-\u4FDD\u6301\u5728\u5DE6\u4FA7\u8F66\u9053\u884C\u9A762",value:181},{label:"182-\u4FDD\u6301\u5728\u53F3\u4FA7\u8F66\u9053\u884C\u9A762",value:182},{label:"190-\u4FDD\u6301\u5728\u4E2D\u592E\u884C\u9A76(1\u8F66\u9053)",value:190},{label:"191-\u4FDD\u6301\u5728\u5DE6\u4FA7\u884C\u9A76(1\u8F66\u9053)",value:191},{label:"192-\u4FDD\u6301\u5728\u53F3\u4FA7\u884C\u9A76(1\u8F66\u9053)",value:192}]};this.context=context}_.assign(DataMgr.prototype,{getSaatFromMaat:function(context,datum){var fWayId=datum.memberByRole(iD.data.RoleType.FROAD_ID).id;var nodeId;if(datum.modelName==iD.data.DataType.NODECONN){nodeId=datum.memberByRole(iD.data.RoleType.ROAD_NODE_ID).id}else if(datum.modelName==iD.data.DataType.C_NODECONN){nodeId=datum.memberByRole(iD.data.RoleType.C_NODE_ID).id}var fWay=context.entity(fWayId);var node=context.entity(nodeId);var graph=context.graph();var relations=[];if(node.modelName==iD.data.DataType.C_NODE){var mtype=iD.data.DataType.C_NODEINFO}else{var mtype=iD.data.DataType.NODEINFO}var relations1=graph.parentRelations(fWay).filter(function(d){return d.modelName==mtype});var relations2=graph.parentRelations(node).filter(function(d){return d.modelName==mtype});function isInObjectArr(id,arrs){for(var i=0;i<arrs.length;i++){if(arrs[i].id==id){return true}}return false}for(var i=0;i<relations1.length;i++){if(isInObjectArr(relations1[i].id,relations2)){relations.push(relations1[i])}}return relations},getMaatFromSaat:function(context,datum){var wayId=datum.memberByRole(iD.data.RoleType.ROAD_ID).id;var nodeId;if(datum.modelName==iD.data.DataType.NODECONN){nodeId=datum.memberByRole(iD.data.RoleType.ROAD_NODE_ID).id}else if(datum.modelName==iD.data.DataType.C_NODECONN){nodeId=datum.memberByRole(iD.data.RoleType.C_NODE_ID).id}var way=context.entity(wayId);var isMaap=false,isSyMaat=false;if(!way)return[];return context.graph().parentRelations(way).filter(function(d){isMaap=d.modelName==iD.data.DataType.NODECONN;isSyMaat=d.modelName==iD.data.DataType.C_NODECONN;if(isMaap&&d.memberByRole(iD.data.RoleType.ROAD_NODE_ID).id==nodeId&&d.memberByRole(iD.data.RoleType.FROAD_ID).id==wayId){return true}if(isSyMaat&&d.memberByRole(iD.data.RoleType.C_NODE_ID).id==nodeId&&d.memberByRole(iD.data.RoleType.FROAD_ID).id==wayId){return true}return false})},updataGuidancePicArr:function(context,saat,type,value){var rels=this.getMaatFromSaat(context,saat);var i=0,len=rels.length;var datum;var picArr;for(;i<len;i++){picArr=this.getGuidancePic(rels[i],context,type);_.each(picArr,function(d){if(""==value){context.replace(iD.actions.DeleteRelation(d.id),"\u5220\u9664\u5BF9\u5E94\u7684GuidancePic")}else{datum=d.mergeTags({pic_ar:""});datum=datum.mergeTags({pic_bk:""});context.replace(iD.actions.AddEntity(datum),"\u4FEE\u6539\u5BF9\u5E94\u7BAD\u5934\u4FE1\u606F")}})}},sortRealtions:function(arr,rel){if(!rel){return arr}var wayId;var wayArr=[];var bArr=[];var i=0;len=arr.length;var tempRelation;if(rel.modelName==iD.data.DataType.NODEINFO||rel.modelName==iD.data.DataType.C_NODEINFO){wayId=rel.memberByRole(iD.data.RoleType.ROAD_ID).id}else{wayId=rel.memberByRole(iD.data.RoleType.FROAD_ID).id}for(;i<len;i++){tempRelation=arr[i];if(tempRelation.modelName==iD.data.DataType.NODEINFO||tempRelation.modelName==iD.data.DataType.C_NODEINFO){if(wayId==tempRelation.memberByRole(iD.data.RoleType.ROAD_ID).id){wayArr.push(tempRelation)}else{bArr.push(tempRelation)}}else{if(wayId==tempRelation.memberByRole(iD.data.RoleType.FROAD_ID).id||wayId==tempRelation.memberByRole(iD.data.RoleType.TROAD_ID).id){wayArr.push(tempRelation)}}}return wayArr.concat(bArr)},drawImage:function(canvas,imageUrl){var image=new Image;var done=function(){canvas.width=image.width;canvas.height=image.height;var context=canvas.getContext("2d");context.drawImage(image,0,0);var imageData=context.getImageData(0,0,image.width,image.height);var pixels=imageData.data;var backgroundColor=pixels.slice(0,4);for(var i=0,n=pixels.length;i<n;i+=4){if(pixels[i]===backgroundColor[0]&&pixels[i+1]===backgroundColor[1]&&pixels[i+2]===backgroundColor[2]&&pixels[i+3]===backgroundColor[3]){pixels[i]=0;pixels[i+1]=0;pixels[i+2]=0;pixels[i+3]=0}}context.putImageData(imageData,0,0)};image.onload=done;image.crossOrigin="Anonymous";image.src=imageUrl;if(image.complete||image.complete===undefined){done()}},getGuidancePic:function(rel,context,type){if(rel.modelName==iD.data.DataType.NODECONN){var mtype=iD.data.DataType.GUIDANCEPICTURE}else{var mtype=iD.data.DataType.GUIDANCEPICTUREC}var secondRels=[];secondRels=context.graph().parentRelations(rel).filter(function(r){if(r.modelName==mtype){return true}return false});if(type){secondRels=secondRels.filter(function(relation){if(-1<type.indexOf(relation.tags.type)){return true}return false})}return secondRels},getLaneInfoRel:function(rel,context){var secondRels=[];secondRels=context.graph().parentRelations(rel).filter(function(r){if(r.modelName==iD.data.DataType.LANEINFO||r.modelName==iD.data.DataType.C_LANEINFO){return true}return false});return secondRels},getGuidanceVoiceRel:function(rel,context){if(rel.modelName==iD.data.DataType.NODECONN){var mtype=iD.data.DataType.GUIDANCEVOICE}else{var mtype=iD.data.DataType.GUIDANCEVOICEC}var secondRels=[];secondRels=context.graph().parentRelations(rel).filter(function(r){if(r.modelName==mtype){return true}return false});return secondRels},getAssistInfo:function(rel,context){if(rel.modelName==iD.data.DataType.NODECONN){var mtype=iD.data.DataType.ASSISTINFO}else{var mtype=iD.data.DataType.ASSISTINFOC}var secondRels=[];secondRels=context.graph().parentRelations(rel).filter(function(r){if(r.modelName==mtype){return true}return false});return secondRels},getGuidanceSP:function(rel,context){if(rel.modelName==iD.data.DataType.NODECONN){var mtype=iD.data.DataType.GUIDANCESIGNPOST}else{var mtype=iD.data.DataType.GUIDANCESIGNPOSTC}var secondRels=[];secondRels=context.graph().parentRelations(rel).filter(function(r){if(r.modelName==mtype){return true}return false});return secondRels},getRefNameChnArr:function(context,nodeId){var results=[];var saatArrs=this.getSaatArrs(nodeId);saatArrs.forEach(function(d){var wayMember=d.memberByRole(iD.data.RoleType.ROAD_ID);var way=context.entity(wayMember.id);if(way.tags.NAME_CHN&&""!=way.tags.NAME_CHN){var str=iD.ui.TagName.dbc2sbc(way.tags.NAME_CHN);results.push(str)}});return this.unique(results)},unique:function(arr){var result=[],hash={};for(var i=0,elem;null!=(elem=arr[i]);i++){if(!hash[elem]){result.push(elem);hash[elem]=true}}return result},updataArray:function(arr1,arr2){var i=0,j=0,ilen=arr2.length,jlen=arr2.length;for(;i<ilen;i++){for(j=0;j<jlen;j++){if(arr1[i].code==arr2[j].code){arr1[i]=arr2[j]}}}},getMaatArrs:function(nodeId){var context=this.context;var entity=context.entity(nodeId);var maatArrs=[];var relations=context.graph().parentRelations(entity);var maatObject={};if(entity.modelName==iD.data.DataType.ROAD_NODE){var maatType=iD.data.DataType.NODECONN;relations.forEach(function(rel){if(rel.modelName==maatType){var fWayId=rel.memberByRole(iD.data.RoleType.FROAD_ID).id;var tWayId=rel.memberByRole(iD.data.RoleType.TROAD_ID).id;if(fWayId!=tWayId){rel=iD.util.tagExtend.updateAcceTagOfNMaat(context.graph(),rel);if(!maatObject[fWayId])maatObject[fWayId]=[];maatObject[fWayId].push(rel)}}})}else{var maatType=iD.data.DataType.C_NODECONN;relations.forEach(function(rel){if(rel.modelName==maatType){var fWayId=rel.memberByRole(iD.data.RoleType.FROAD_ID).id;var tWayId=rel.memberByRole(iD.data.RoleType.TROAD_ID).id;if(fWayId!=tWayId){rel=iD.util.tagExtend.updateAcceTagOfCMaat(context.graph(),rel);if(!maatObject[fWayId])maatObject[fWayId]=[];maatObject[fWayId].push(rel)}}})}var Maatkeys=_.sortBy(Object.keys(maatObject));Maatkeys.forEach(function(key){maatArrs=maatArrs.concat(maatObject[key])});return maatArrs},getSaatArrs:function(nodeId){var context=this.context;var entity=context.entity(nodeId);var saatArrs=[],saatObject={};var relations=context.graph().parentRelations(entity);if(entity.modelName==iD.data.DataType.ROAD_NODE){var saatType=iD.data.DataType.NODEINFO}else{var saatType=iD.data.DataType.C_NODEINFO}relations.forEach(function(d){if(d.modelName==saatType){var way=d.memberByRole(iD.data.RoleType.ROAD_ID).id;saatObject[way]=d}});var saatkeys=_.sortBy(Object.keys(saatObject));saatkeys.forEach(function(key){saatArrs=saatArrs.concat(saatObject[key])});return saatArrs},getArrowTag:function(relation,type){var arrow={id:"",arrowTag:"",lane_no:""};var context=this.context;if(1==arguments.length){if(relation.modelName==iD.data.DataType.NODEINFO||relation.modelName==iD.data.DataType.C_NODEINFO){return{id:relation.id,arrowTag:relation.tags.LANEINFO}}}else if(relation.modelName==iD.data.DataType.NODECONN||relation.modelName==iD.data.DataType.C_NODECONN){var laneInfoRel=context.graph().parentRelations(relation).filter(function(rel){if(rel.modelName==iD.data.DataType.LANEINFO||rel.modelName==iD.data.DataType.C_LANEINFO){return true}return false});if(1==laneInfoRel.length){arrow.id=laneInfoRel[0].id;arrow.arrowTag=laneInfoRel[0].tags.ARROW;arrow.lane_no=laneInfoRel[0].tags.LANE_NO;return arrow}}return arrow},isMaat:function(entity){if(entity.modelName==iD.data.DataType.NODECONN||entity.modelName==iD.data.DataType.C_NODECONN){return true}return false},isSaat:function(entity){if(entity.modelName==iD.data.DataType.NODEINFO||entity.modelName==iD.data.DataType.C_NODEINFO){return true}return false},isAccessable:function(entity){if(entity.modelName==iD.data.DataType.NODECONN||entity.modelName==iD.data.DataType.C_NODECONN){if("0"==entity.tags.ACCESSABLE){return true}}return false},seperateArrow:function(arrow){var arr=arrow.split(/\b|/g);if(""==arr[arr.length-1]){arr.splice(arr.length-1,1)}var arrowArr=[],str;for(var i=0,r=arr.length;i<r;i++){if(str==undefined){str=arr[i]}else{if("|"==arr[i]){if(str){arrowArr.push(str);str=undefined}arrowArr.push(arr[i])}else{str=str+arr[i]}}}if(str){arrowArr.push(str)}return arrowArr},parseArrowTag:function(arrow,arrowOptions){var results=[];var options=arrowOptions;var arrowArr=this.seperateArrow(arrow);arrowArr.forEach(function(sub){if("|"==sub){results.push("LINE")}else{var temp=sub;var count=0;while(0!=temp.length){var length=temp.length;if(-1<options.indexOf(temp)){results.push(temp);count+=temp.length;temp=sub.slice(count)}else{temp=temp.slice(0,length-1)}}}});return results},getHighlightIds:function(datum){var selectedIds=[];if(datum.modelName==iD.data.DataType.NODEINFO||datum.modelName==iD.data.DataType.C_NODEINFO){var wayId=datum.memberByRole(iD.data.RoleType.ROAD_ID).id;selectedIds.push(wayId)}else{var fWayId=datum.memberByRole(iD.data.RoleType.FROAD_ID).id;var tWayId=datum.memberByRole(iD.data.RoleType.TROAD_ID).id;selectedIds.push(fWayId);selectedIds.push(tWayId)}return selectedIds},getLaneInfoTag:function(){var laneinfoTag="";var selectArrs=d3.selectAll(".line-info-panel .main-context .maat-line-info .thumbnail span")[0];var length=selectArrs.length;selectArrs.forEach(function(selection,index){var str=selection.className.split("-")[1];if("LINE"==str){if(index==length-1){str=""}else{str="|"}}laneinfoTag+=str});return laneinfoTag},getPathResults:function(){var pathSelection=d3.selectAll(".line-info-path .sub-line-info-path .line-info-path-title .thumbnail")[0];var pathResults=[];for(var i=0;i<pathSelection.length;i++){var tgd=d3.select(pathSelection[i]).data()[0];var pathVals=d3.select(pathSelection[i]).selectAll("span")[0];var length=pathVals.length;var tgdTag="";pathVals.forEach(function(selection,index){var str=selection.className.split("-")[1];if("LINE"==str){if(index==length-1){str=""}else{str="|"}}tgdTag+=str});pathResults.push({tgd_id:tgd.id,arrowTag:tgdTag})}return pathResults},dealLaneInfoNoInput:function(){var childNodes=d3.select(".line-info-panel .maat-line-info .lane-info-number-input").node().childNodes;var lane_no_tmp="",lane_no="";for(var k=0;k<childNodes.length;k++){var value=childNodes[k].value;if(""==value)continue;lane_no_tmp+=value+"|"}if("|"==lane_no_tmp[lane_no_tmp.length-1]){lane_no=lane_no_tmp.substring(0,lane_no_tmp.length-1)}d3.select(".line-info-panel .maat-line-info .lane-info-number-manul input").value(lane_no)},parseStr2IntArr:function(value,splitStr){var valueArr=value?value.split(splitStr):[];if(!valueArr[valueArr.length-1])valueArr.splice(valueArr.length-1,1);for(var i=0;i<valueArr.length;i++){valueArr[i]=parseInt(valueArr[i])}return valueArr},getLaneInfoLineNum:function(){var arrowNodes=d3.select(".line-info-panel .maat-line-info .line-info-title .thumbnail").node().childNodes;var length2=0,lineLength=0;for(var k=0;k<arrowNodes.length;k++){if("image-LINE"!=d3.select(arrowNodes[k]).attr("class")){length2++}else if(k!=arrowNodes.length-1){lineLength++}}if(0==lineLength){if(0!=arrowNodes.length){return 1}else{return 0}}var lanoInfoLength=lineLength+1;return lanoInfoLength},getLaneInfoTagObject:function(value){var result=new Object;for(var i=0;i<value.length;i++){var key=value[i];if("|"==key)continue;if(!result[key]){result[key]=1}else{result[key]+=1}}return result},isStringAndSplit:function(value){if(""==value)return true;var valueArr=value.split("|");for(var i=0;i<valueArr.length;i++){var key=parseInt(valueArr[i]);if(isNaN(key)||0==key){return false}else if(50<key){return false}}return true},getModelObjectByDatatype:function(datatype,tag,title){var layers=iD.Layers;var fieldHash={},tagHash={},tagValueArr=[];return tagHash;var currentLayer=layers.getLayer();if(!currentLayer||!currentLayer.modelEntity())return tagHash;var modelEntity=currentLayer.modelEntity(),geoType=modelEntity.getGeoType();if(currentLayer.isRoad()){var typeModelEntity=currentLayer.typeModelEntity()[datatype];if(typeModelEntity){geoType=typeModelEntity.modelId;modelEntity=typeModelEntity.model}else{geoType=""}}var fields=modelEntity.getFields(geoType);for(var i=0,len=fields.length;i<len;i++){var fieldName=fields[i].fieldName;fieldHash[fieldName]=fields[i]}if(fieldHash[tag]){tagHash.label=title;var values=fieldHash[tag].fieldInput.values;for(var j=0;j<values.length;j++){tagValueArr.push({label:values[j].name,value:values[j].value})}tagHash.options=tagValueArr}return tagHash},isZeroBugTask:function(){if(iD.Task&&iD.Task.d){var task=iD.Task.d;var task_type=task.task_type;return 7==task_type}return false},isZeroBugQcTask:function(){if(iD.Task&&iD.Task.d){var task=iD.Task.d;var task_type=task.qc_type;return 7==task_type}return false},isRealPictureTask:function(){return false;return iD.Task&&iD.Task.isScene(iD.data.TransScene.REALPICTURE)?true:false},isTagUpdateAlikeTask:function(){if(iD.Task){var scene=iD.data.TransScene;return iD.Task.isScene([scene.TAGSUPDATE,scene.ROADFACILITY,scene.ROADSIGN,scene.ADASROAD,scene.FULLSCENE])}return false},isScene:function(scene){return iD.Task&&iD.Task.isScene(scene)?true:false},isCameraTask:function(){var task=iD.Task.d;if(!task)return false;var taskClasses=task.task_classes;if(taskClasses==iD.data.TaskClass.CAMEREGULAR||taskClasses==iD.data.TaskClass.CAMECOMP||taskClasses==iD.data.TaskClass.CAMETICKET||taskClasses==iD.data.TaskClass.ONEMILE){return true}return false},isDisabledLabel:function(d,context){if(d.modelName==iD.data.DataType.NODECONN||d.modelName==iD.data.DataType.C_NODECONN){if("1"==d.tags.ACCESSABLE){return true}return false}else if(d.modelName==iD.data.DataType.C_NODEINFO){var road_member=d.memberByRole(iD.data.RoleType.ROAD_ID);var nodeId=d.memberByRole(iD.data.RoleType.C_NODE_ID).id;let topoEntity=iD.TopoEntity();let cmembers=topoEntity.getCrossNodeMembers(context.graph(),nodeId)||[];var nodeArr=cmembers.map(function(member){return member.id});var way=context.entity(road_member.id),direction=way.tags.DIRECTION;if("1"==d.tags.INNERARC){return true}if("1"==direction||"2"==direction&&-1<nodeArr.indexOf(way.last())||"3"==direction&&-1<nodeArr.indexOf(way.first())){return false}else{return true}}else{var road_member=d.memberByRole(iD.data.RoleType.ROAD_ID);var nodeId=d.memberByRole(iD.data.RoleType.ROAD_NODE_ID).id;var way=context.entity(road_member.id),direction=way.tags.DIRECTION;if("1"==direction||"2"==direction&&way.last()==nodeId||"3"==direction&&way.first()==nodeId){return false}else{return true}}},isActivableLabel:function(d,context){var self=this;var tags=d.tags;if(this.isSaat(d)){if("0"!=tags.LT_TURN_L||tags.LT_UTRUN_L&&"0"!=tags.LT_UTRUN_L||"0"!=tags.WAIT_L||tags.LANEINFO){return true}else{return false}}else if(this.isMaat(d)){var lane_info_rel=self.getLaneInfoRel(d,context);var gd_voice_rel=self.getGuidanceVoiceRel(d,context);var assist_info_rel=self.getAssistInfo(d,context);var guidancesp_rel=self.getGuidanceSP(d,context);var guidancePicArrImage=self.getGuidancePic(d,context,["20","21"]);var guidancePicArrSide=self.getGuidancePic(d,context,["40"]);var guidancePicArrRear=self.getGuidancePic(d,context,["10","11"]);if(0<lane_info_rel.length&&lane_info_rel[0].tags.ARROW){return true}else if(0<gd_voice_rel.length&&gd_voice_rel[0].tags.VOICE_INFO){return true}else if(0<assist_info_rel.length&&assist_info_rel[0].tags.DIR_SLOPE){return true}else if(0<guidancesp_rel.length&&guidancesp_rel[0].tags.TEXTVALUE){return true}else if(0<guidancePicArrImage.length&&guidancePicArrImage[0].tags.PIC_BK){return true}else if(0<guidancePicArrSide.length&&guidancePicArrSide[0].tags.PIC_BK){return true}else if(0<guidancePicArrRear.length&&guidancePicArrRear[0].tags.PIC_BK){return true}else{return false}}},isLaneNoValidate:function(value,maat,context,self){var selection=d3.select(".line-info-panel .maat-line-info .lane-info-number .lane-info-number-manul input");var valueArr=self.dataMgr.parseStr2IntArr(value,"|");var saat=self.dataMgr.getSaatFromMaat(context,maat)[0];var laneinfo=saat.tags.LANEINFO;var length1=laneinfo?laneinfo.split("|").length:0;var lanoInfoLength=self.dataMgr.getLaneInfoLineNum();if(length1<lanoInfoLength||0==lanoInfoLength){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u8F91\u4E0D\u7B26\u5408\u8981\u6C42,\u8BF7\u91CD\u65B0\u7F16\u8F91");return true}else if(!self.dataMgr.isStringAndSplit(value)){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7\u5F55\u5165\u975E\u6CD5\u5B57\u7B26");selection.node()&&selection.value("");return true}else{for(var p=0;p<valueArr.length-1;p++){if(parseInt(valueArr[p])>=parseInt(valueArr[p+1])){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u7F16\u53F7\u5FC5\u987B\u4ECE\u5C0F\u5230\u5927\u5F55\u5165");return true}}}return false}});return d3.rebind(new DataMgr,mgrEvent,"on")};;;;(function(iD){var expParser=new iD.ui.RoadFilterExpParser;flattenArr=arr=>arr.reduce((begin,current)=>{Array.isArray(current)?begin.push(...flattenArr(current)):begin.push(current);return begin},[]);var tableLabel=[{title:"\u8F66\u9053\u7EBF\u5C5E\u6027\u67E5\u8BE2",type:"divider",active:true},{title:"\u9053\u8DEF\u5C5E\u6027\u67E5\u8BE2",type:"road",active:false},{title:"\u6A21\u578B\u67E5\u8BE2",type:"modelName",active:false}];var expOperators=[{op:"=",tip:"\u76F8\u7B49"},{op:"!=",tip:"\u4E0D\u7B49"},{op:"*=",tip:"\u5305\u542B\u53F3\u4FA7\u5B57\u7B26"},{op:"^=",tip:"\u4EE5\u53F3\u4FA7\u5B57\u7B26\u5F00\u59CB"},{op:"$=",tip:"\u4EE5\u53F3\u4FA7\u5B57\u7B26\u7ED3\u675F"},{op:"&&",tip:"\u5E76\u4E14"},{op:"||",tip:"\u6216\u8005"},{op:">",tip:"\u5927\u4E8E"},{op:">=",tip:"\u5927\u4E8E\u7B49\u4E8E"},{op:"<",tip:"\u5C0F\u4E8E"},{op:"<=",tip:"\u5C0F\u4E8E\u7B49\u4E8E"},{op:"!",tip:"\u53D6\u53CD"},{op:"( )",tip:"\u5916\u62EC\u53F7",opts:{wrap:["(",")"],extraSpace:false}}];var entityFilterCnfs=[{id:"divider",name:"\u8F66\u9053\u7EBF",title:"\u8F66\u9053\u7EBF\u5C5E\u6027\u67E5\u8BE2",filter:function(entity){var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);return entity instanceof iD.Way&&1<entity.nodes.length&&modelConfig&&modelConfig.editable&&entity.tags&&entity.modelName===iD.data.DataType.DIVIDER&&iD.util.wayInPlyGonx(entity,this.context)},typicalFilter:function(entity){return entity.tags&&entity.modelName===iD.data.DataType.DIVIDER},actionType:"divider"},{id:"dividerNode",name:"\u8F66\u9053\u7EBF\u8282\u70B9",title:"\u8282\u70B9\u5C5E\u6027\u67E5\u8BE2",filter:function(entity){var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);return entity instanceof iD.Node&&modelConfig&&modelConfig.editable&&entity.tags&&entity.modelName===iD.data.DataType.DIVIDER_NODE&&iD.util.nodeInPlyGonx(entity,this.context)},typicalFilter:function(entity){return entity.tags&&entity.modelName===iD.data.DataType.DIVIDER_NODE},actionType:"divider"},{id:"road",name:"\u9053\u8DEF",title:"\u9053\u8DEF\u5C5E\u6027\u67E5\u8BE2",filter:function(entity){var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);return entity instanceof iD.Way&&1<entity.nodes.length&&modelConfig&&modelConfig.editable&&entity.tags&&entity.modelName===iD.data.DataType.ROAD},typicalFilter:function(entity){return entity.tags&&entity.modelName===iD.data.DataType.ROAD},actionType:"road"},{id:"roadNode",name:"\u9053\u8DEF\u8282\u70B9",title:"\u8282\u70B9\u5C5E\u6027\u67E5\u8BE2",filter:function(entity){var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);return entity instanceof iD.Node&&modelConfig&&modelConfig.editable&&entity.tags&&entity.modelName===iD.data.DataType.ROAD_NODE&&iD.util.nodeInPlyGonx(entity,this.context)},typicalFilter:function(entity){return entity.tags&&entity.modelName===iD.data.DataType.ROAD_NODE},actionType:"road"},{id:"modelName",name:"\u6A21\u578B\u540D\u79F0",title:"\u6A21\u578B\u67E5\u8BE2",filter:function(entity){var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);var flag=entity instanceof iD.Entity&&modelConfig&&modelConfig.editable&&entity.modelName;if(entity instanceof iD.Relation){return flag}return flag&&iD.util.entityInPlyGon(entity,this.context)},typicalFilter:function(entity){return entity&&entity.modelName},actionType:"modelName"}];iD.ui.RoadFilterPanel=function(context,selection){this.dispatch=d3.dispatch("close");this.selection=selection;this.context=context;this.entities=null;return d3.rebind(this,this.dispatch,"on")};_.assign(iD.ui.RoadFilterPanel.prototype,{refreshEntities:function(){var entities=this.context.intersects(iD.geo.Extent([-Infinity,-Infinity],[Infinity,Infinity]));this.entities=entities.filter(this.filterCnf.filter,this);this.updateEntityNum(this.entities.length);if(0<this.entities.length){this.refreshFieldList()}},updateEntityNum:function(num){var $num=this.$msgBox.select("span.total");if($num.size()){$num.html(num)}else{this.statMsg("\u603B\u6570\u91CF: <span class=\"total\">"+num+"</span>")}},updateEntityCnfs:function(actionType){var self=this;var $cnfSwhRow=d3.select("div.panel-body div.cnf-switch ul");var $newCnfSwhItems=$cnfSwhRow.selectAll("li");var actions=_.filter(entityFilterCnfs,function(entity){return entity.actionType==actionType});var update=$newCnfSwhItems.data(actions);var $newCnfSwhItem=update.enter().append("li");$newCnfSwhItem.append("label").html(function(d){return"<input type=\"radio\" name=\"road_filter_cnf_type\" value=\""+d.id+"\" />"+d.title}).on("click",function(d){self.switch2Type(d.id);return false});update.html(function(d){return"<lable><input type=\"radio\" name=\"road_filter_cnf_type\" value=\""+d.id+"\" />"+d.title+"</lable>"}).on("click",function(d){self.switch2Type(d.id);return false});update.exit().remove()},initPanel:function(){var selection=this.selection,self=this;var $panelBox=selection.selectAll("div.road-filter-panel").data([0]);var $newPanelBox=$panelBox.enter().append("div").attr("class","road-filter-panel common-dialog");$newPanelBox.append("div").attr("class","tl-close").html("&times;").on("click",function(){self.hide();self.dispatch.close()});;$newPanelBox.append("div").attr("class","panel-title");window.tableLabel=tableLabel;var panelActions=$newPanelBox.append("div").attr("class","btn-group panel-actions");panelActions.selectAll("a.btn").data(tableLabel).enter().append("a").attr("class","btn").text(function(d){return d.title}).attr("id",function(d,i){return d.type}).classed("active",function(d){return d.active}).on("click",function(d){d3.select(this.parentNode).selectAll("a").classed("active",false);d3.select(this).classed("active",true);self.updateEntityCnfs(d.type)});$newPanelBody=$newPanelBox.append("div").attr("class","panel-body");this.initBody($newPanelBody);this.$panelBox=d3.select($panelBox.node());this.$panelTitle=this.$panelBox.select("div.panel-title");this.$panelBody=this.$panelBox.select("div.panel-body");this.$filterExpInput=this.$panelBody.select("input.expression");this.$msgBox=this.$panelBody.select("div.msg_box");this.initPos()},needZoomIn:function(mapExtent,selExtent){return 0.5>mapExtent.percentContainedIn(selExtent)},needZoomOut:function(mapExtent,selExtent){return 0.9>selExtent.percentContainedIn(mapExtent)},selectEntitiesByExp:function(){var entities=this.evalExp(),context=this.context,self=this;if(!entities||!entities.length){context.enter(iD.modes.Browse(context));return}var eleTab=d3.select("#leftbar .nav .item-element");eleTab.on("click").call(eleTab.node(),eleTab.datum());var selExtent=iD.geo.Extent(),graph=context.graph(),toCenterExtent=null;entities.forEach(function(w,idx){var oldExtentArea=selExtent.area()||1;selExtent=selExtent.extend(w.extent(graph));if(1<idx&&!toCenterExtent&&5<selExtent.area()/oldExtentArea){toCenterExtent=selExtent}});var map=context.map();if(0<=selExtent.area()){if(20>parseInt(map.extentZoom(selExtent))){map.zoom(20)}else{map.extent(selExtent)}if(!map.editable()){if(toCenterExtent){if(20>parseInt(map.extentZoom(toCenterExtent))){map.zoom(20)}else{map.extent(toCenterExtent)}}map.zoom(map.editableLevel())}}else{if(null==toCenterExtent){map.zoom(18);map.center(entities[0].loc)}}if(d3.event){_.assign(d3.event,{_isLasso:true})}var selectedIDs=entities.map(function(w){d3.select("circle.node.stroke."+w.id).transition().duration(1500).ease("liner").style("stroke-width","10").transition().duration(1000).ease("liner").style("stroke-width","1");return w.id});var relationMemberIDs=entities.map(function(w){var entity=w;var ids=self.getEntityAndAllMemberIds(_.pluck(entity.members||[],"id"));d3.select("circle.node.stroke."+entity.id).transition().duration(1500).ease("liner").style("stroke-width","10").transition().duration(1000).ease("liner").style("stroke-width","1");return ids});relationMemberIDs=flattenArr(relationMemberIDs);context.surface().selectAll(".selected").classed("selected",false);if(d3.event){d3.event._isFromList=true}var allSelected=selectedIDs;context.enter(iD.modes.Select(context,allSelected,null,true).suppressMenu(1<allSelected.length).newFeature(false));context.surface().selectAll(iD.util.entitySelector(relationMemberIDs)).classed("selected",true)},getEntityAndAllMemberIds:function(ids=[],hasRel=false){var self=this;var result=[];for(let id of ids){var entity=self.context.entity(id);if(entity instanceof iD.Relation){hasRel&&result.push(entity.id);result.push(...self.getEntityAndAllMemberIds(_.pluck(entity.members||[],"id")))}else{result.push(entity.id)}}return _.uniq(result)},unselectEntitiesByExp:function(){var context=this.context;if("select"===context.mode().id){var selIds=context.selectedIDs();if(selIds&&selIds.length){var entities=this.evalExp();if(entities&&entities.length){var removeIds=entities.map(function(w){return w.id});var leftIds=_.without.apply(_,[selIds].concat(removeIds));context.enter(leftIds.length?iD.modes.Select(context,leftIds):iD.modes.Browse(context))}}}},clearExp:function(){this.unselectEntitiesByExp();this.statMsg("");this.$filterExpInput.property("value","")},evalExp:function(){if(!this.entities){this.refreshEntities()}var exp=this.$filterExpInput.property("value")||"";var signs=_.pluck(expOperators,"op");var flag=true;for(var sign of signs){if(-1<exp.indexOf(sign)){flag=false;break}}if(flag){return[]}var result=expParser.parseExp(exp,this._fieldsModelInfo);if(result.error){this.statMsg(result.error);return null}else if(this.filterCnf&&"modelName"==this.filterCnf.id){var matchedWays=this.entities.filter(function(w){return result.filter(_.assign({id:iD.Entity.id.toOSM(w.id)},{modelName:w.modelName}))});this.statMsg("\u603B\u6570\u91CF: <span class=\"total\">"+this.entities.length+"</span>, \u7B26\u5408\u6761\u4EF6\u6570\u91CF: <span class=\"match\">"+matchedWays.length+"</span>");return matchedWays}else{var matchedWays=this.entities.filter(function(w){return result.filter(_.assign({id:iD.Entity.id.toOSM(w.id)},w.tags))});this.statMsg("\u603B\u6570\u91CF: <span class=\"total\">"+this.entities.length+"</span>, \u7B26\u5408\u6761\u4EF6\u6570\u91CF: <span class=\"match\">"+matchedWays.length+"</span>");return matchedWays}},statMsg:function(str){this.$msgBox.html(str)},initBody:function($body){var self=this;var expChange=_.debounce(function(){self.evalExp()},350);$body.attr("tabindex",1);var $cnfSwhRow=$body.append("div").attr("class","cnf-switch");var selectTableLabelType=this.selection.select(".panel-actions a.active").property("id");if(!selectTableLabelType){selectTableLabelType=iD.data.DataType.DIVIDER}var entityFilterCnfs_Road=_.filter(entityFilterCnfs,function(d){return d.actionType==selectTableLabelType});var $cnfSwhItems=$cnfSwhRow.append("ul").selectAll("li").data(entityFilterCnfs_Road);var $newCnfSwhItem=$cnfSwhItems.enter().append("li");$newCnfSwhItem.append("label").html(function(d){return"<input type=\"radio\" name=\"road_filter_cnf_type\" value=\""+d.id+"\" />"+d.title}).on("click",function(d){self.switch2Type(d.id);return false});$cnfSwhItems.exit().remove();var $expression=$body.append("input").attr("class","expression").attr("type","text").on("input",expChange).on("paste",expChange).on("propertychange",expChange).on("keypress",function(){;if(13===d3.event.keyCode){self.selectEntitiesByExp()}});var $searchBtn=$body.append("button").attr("class","search_btn button blue").html("\u5B9A\u4F4D").on("click",function(){self.selectEntitiesByExp()});var $clearBtn=$body.append("button").attr("class","clear_btn button gray").html("\u6E05\u9664").on("click",function(){self.clearExp()});$body.append("div").attr("class","cf");var $colBoxRow=$body.append("div").attr("class","col_box_row");var $fieldList=$colBoxRow.append("div").attr("class","col_box field_list_box");this.initFieldList($fieldList);var $operatorList=$colBoxRow.append("div").attr("class","col_box operator_list_box");this.initOperatorList($operatorList);var $fieldVals=$colBoxRow.append("div").attr("class","col_box field_vals_box");this.initFieldVals($fieldVals);$body.append("div").attr("class","cf");$body.append("div").attr("class","msg_box");$body.selectAll("input,select").on("mousedown",function(){d3.event.stopPropagation()})},initFieldList:function($fieldList){$fieldList.append("label").attr("class","top-opts").html("<input type=\"checkbox\" class=\"inEqlOpCk\" />\u81EA\u52A8\u6DFB\u52A0=\u53F7");$fieldList.append("h3").html("\u5B57\u6BB5\u540D");$fieldList.append("div").attr("class","col_body field_list");this.refreshFieldList()},buildFieldsModelInfo:function(modelFields){var mInfo={},keptFlds=["fieldName","fieldInput","fieldType","fieldTitle"];function simpleFldInfo(m){var res={};keptFlds.forEach(function(f){res[f]=m[f]});return res}modelFields.forEach(function(m){mInfo[m.fieldName]=simpleFldInfo(m)});return mInfo},refreshFieldList:function(){if(!this.entities||!this.entities.length){return}if(this._fieldsModelInfo){return}var modelFields=[];if("modelName"==this.filterCnf.id){modelFields=this.getModelNameListFields()}else{modelFields=_.clone(this.getEntityModelFields(this.findTypicalEntity()));this.filterModelFields(modelFields)}this._fieldsModelInfo=this.buildFieldsModelInfo(modelFields);var $fldList=this.$panelBody.select("div.field_list");var $ul=$fldList.selectAll("ul").data([0]);$ul.enter().append("ul");var $li=$ul.selectAll("li").data(modelFields);var self=this;$li.enter().append("li").on("click",function(d){$li.classed("selected",false);d3.select(this).classed("selected",true);self.refreshFieldVals(d)}).on("dblclick",function(d){$li.classed("selected",false);d3.select(this).classed("selected",true);self.refreshFieldVals(d);var eqlOp=self.$panelBody.select("input.inEqlOpCk").property("checked");self.insertExpOp(d.fieldName+(eqlOp?" = ":""))});$li.html(function(d){return"<span class=\"name\">"+d.fieldName+"</span>: <span class=\"title\">"+d.fieldTitle+"</span>"}).attr("title",function(d){return d.fieldName+": "+d.fieldTitle});$li.exit().remove();$ul.exit().remove()},refreshFieldVals:function(fld){this.$panelBody.select("div.field_val_fname").html(fld.fieldName);var selVals=[];if(fld.fieldInput&&fld.fieldInput.values){selVals=fld.fieldInput.values}var $fldValsList=this.$panelBody.select("div.field_vals_list");var $ul=$fldValsList.selectAll("ul").data([0]);$ul.enter().append("ul");var $li=$ul.selectAll("li").data(selVals);var self=this;$li.enter().append("li").on("dblclick",function(d){self.insertExpOp(d.value,{extraLeft:"="})});$li.html(function(d){return"<span class=\"value\">"+d.value+"</span>: <span class=\"name\">"+d.name+"</span>"}).attr("title",function(d){return d.value+": "+d.name});$li.exit().remove();$ul.exit().remove()},filterModelFields:function(modelFields){var topFields=["id"];modelFields.unshift({fieldName:"id",fieldTitle:"ID"});modelFields.forEach(function(m,idx){var fname=m.fieldName,topFldIdx=topFields.indexOf(fname);m._sortIdx=0<=topFldIdx?1000-topFldIdx:0});modelFields.sort(function(a,b){if(a._sortIdx!==b._sortIdx){return b._sortIdx-a._sortIdx}if(a.fieldName!=b.fieldName){return a.fieldName>b.fieldName?1:-1}return 0})},findTypicalEntity:function(){return _.find(this.entities,this.filterCnf.typicalFilter,this)},getEntityModelFields:function(entity){if(!entity){return}var modelEntity=iD.ModelEntitys[entity.modelName];return modelEntity&&modelEntity.getFields(modelEntity.getGeoType())},getModelNameListFields:function(){var vals=_.map(iD.data.DataType,function(modelName){return modelName?{name:modelName,value:modelName}:false});vals=_.compact(vals);return[{fieldName:"modelName",fieldTitle:"\u6A21\u578B",fieldInput:{type:"select",values:vals}}]},insertExpOp:function(op,opts){opts=_.assign({extraSpace:true},opts);var input=this.$filterExpInput.node();var len=input.value.length,start=input.selectionStart,end=input.selectionEnd,sel=input.value.substring(start,end);var replace=op;if(opts.wrap){replace=opts.wrap[0]+sel+opts.wrap[1]}var startStr=input.value.substring(0,start),endStr=input.value.substring(end,len);if(opts.extraSpace){if(!startStr.endsWith(" ")){startStr+=" "}if(!endStr.startsWith(" ")){endStr=" "+endStr}}if(opts.extraLeft){if(!startStr.trim().endsWith(opts.extraLeft)){startStr+=opts.extraLeft}}if(opts.extraRight){if(!endStr.trim().startsWith(opts.extraRight)){endStr=opts.extraRight+endStr}}input.value=startStr+replace+endStr;try{input.focus()}catch(e){}this.evalExp()},initOperatorList:function($operatorList){$operatorList.append("h3").html("\u8BA1\u7B97\u7B26\u53F7");var $box=$operatorList.append("div").attr("class","col_body operator_list");$ul=$box.append("ul");$newLi=$ul.selectAll("li").data(expOperators);var self=this;$newLi.enter().append("li").attr("title",function(d){return d.tip}).html(function(d){return d.op}).on("click",function(d){self.insertExpOp(d.op,d.opts)})},initFieldVals:function($fieldVals){$fieldVals.append("div").attr("class","field_val_fname");$fieldVals.append("h3").html("\u5B57\u6BB5\u53D6\u503C");$fieldVals.append("div").attr("class","col_body field_vals_list")},initPos:function(){var self=this,surfaceRect=this.selection.node().getBoundingClientRect(),panelBoxRect=this.$panelBox.node().getBoundingClientRect();var boxPosition=[(surfaceRect.width-panelBoxRect.width)/2,(surfaceRect.height-panelBoxRect.height)/2];this.$panelBox.style({right:"auto",bottom:"auto",top:0,left:0});iD.util.setTransform(this.$panelBox,boxPosition[0],boxPosition[1]);var behavior=iD.behavior.drag().surface(this.selection).on("start",function(){}).on("move",function(){var delta=d3.event.delta;boxPosition[0]+=delta[0];boxPosition[1]+=delta[1];iD.util.setTransform(self.$panelBox,boxPosition[0],boxPosition[1])}).on("end",function(){});this.$panelBox.call(behavior)},switch2Type:function(id){if(this.filterCnf&&this.filterCnf.id===id){return}this.filterCnf=_.find(entityFilterCnfs,function(e){return e.id===id});if(!this.filterCnf){console.error("Can not switch 2 id: ",id)}this.$filterExpInput.attr("placeholder","\u8BF7\u8F93\u5165\u67E5\u8BE2\u6761\u4EF6\uFF0C\u4F8B\u5982id = 4500");this.clearExp();this.$panelTitle.html(this.filterCnf.title);this.$panelBody.select("input[name=\"road_filter_cnf_type\"][value=\""+id+"\"]").property("checked",true);this.entities=null;this._fieldsModelInfo=null;this.$panelBody.select("div.field_list").html("");this.$panelBody.select("div.field_vals_list").html("");this.initFieldList(this.$panelBody.select("div.field_list_box").html(""));this.initFieldVals(this.$panelBody.select("div.field_vals_box").html(""));this.refreshEntities()},show:function(){if(!this.$panelBox){this.initPanel();this.switch2Type("divider")}this.$panelBox.classed("hidden",false);var self=this;this.context.history().on("change.road_fitler",function(){self.refreshEntities();self.evalExp()});self.refreshEntities();try{self.$panelBody.node().focus()}catch(e){console.warn(e)}},hide:function(){this.$panelBox.classed("hidden",true);this.context.history().on("change.road_fitler",null);this.entities=null;this.context.enter(iD.modes.Browse(this.context))}})})(iD);;;iD.ui.NodeSearchControl=function(context){var searchPanel=null;function showNodeSearchPanel(){if(!searchPanel){searchPanel=new iD.ui.NodeSearchPanel(context,context.container())}searchPanel.show()}var buttons=[{id:"node-search-control",title:"\u89E3\u6790\u5750\u6807\u5B9A\u4F4D",action:showNodeSearchPanel,key:"Ctrl+G"}];return function(selection){var button=selection.selectAll("button").data(buttons).enter().append("button").attr("tabindex",-1).attr("class",function(d){return d.id}).on("click.control",function(d){d.action()}).call(bootstrap.tooltip().placement("left").html(true).title(function(d){return iD.ui.tooltipHtml(d.title,d.key)}));button.append("span").attr("class",function(d){return d.id+" icon"});var keybinding=d3.keybinding("NodeSearchControl");buttons.forEach(function(b){keybinding.on(b.key,function(){d3.event.stopPropagation();d3.event.preventDefault();b.action()})});d3.select(document).call(keybinding)}};;;;;(function(iD){iD.ui.NodeSearchPanel=function(context,selection){this.dispatch=d3.dispatch("close");this.selection=selection;this.context=context;this.entities=[];return d3.rebind(this,this.dispatch,"on")};var colorKeyMap={1:"#ff0000",2:"#00ff00",3:"#0000ff"};_.assign(iD.ui.NodeSearchPanel.prototype,{initPanel:function(){var selection=this.selection,self=this;var $panelBox=selection.selectAll("div.node-search-panel").data([0]);var $newPanelBox=$panelBox.enter().append("div").attr("class","node-search-panel common-dialog");$newPanelBox.append("div").attr("class","tl-close").html("&times;").on("click",function(){self.hide();self.dispatch.close()});;$newPanelBox.append("div").attr("class","panel-title");$newPanelBody=$newPanelBox.append("div").attr("class","panel-body");this.initBody($newPanelBody);this.$panelBox=d3.select($panelBox.node());this.$panelTitle=this.$panelBox.select("div.panel-title").text("\u89E3\u6790\u5750\u6807\u5B9A\u4F4D");this.$panelBody=this.$panelBox.select("div.panel-body");this.$inputArea=this.$panelBody.select("textarea.coord-list-input");this.$msgBox=this.$panelBody.select("div.msg_box");this.initPos()},statMsg:function(str){this.$msgBox.html(str)},searchParsedNodes:function(){var self=this;var coords=self.formatInputArea();self.addEntities2Map(coords)},addEntities2Map:function(coords){if(!coords||!coords.length){return}var self=this;self.clearEntities2Map();var locArr=[];for(var i in coords){var coord=coords[i].split(/[,，]/);if(1>=coord.length){continue}else if(2==coord.length){coord[2]=0}else if(4<coord.length){coord=coord.slice(0,4)}var y=Number(coord[0]);coord[0]=Number(coord[1]);coord[1]=y;if(coord[2]){coord[2]=Number(coord[2])}if(coord[3]){coord[3]=Number(coord[3])}locArr.push(coord)}if(locArr.length){self.entities=createMarkDatum(self.context,locArr);self.parseEntities2BestMap();self.showEntitiesInfoList();self.context.event.entityedite({entitys:[]})}},clearEntities2Map:function(){var self=this;if(!self.entities||!self.entities.length){return}var actions=[];for(var i in self.entities){var entity=self.entities[i];actions.push(iD.actions.DeleteNode(entity.id))}actions.push(t("operations.delete.annotation.point"));try{self.context.replace.apply(this,actions);self.context.undo()}catch(e){}self.entities.length=0},formatInputArea:function(){var self=this;var $input=self.$inputArea;var str=$input.property("value");str=str.trim();var coords;if(-1<str.indexOf(";")||-1<str.indexOf("\uFF1B")){coords=str.split(/[\n;；]+/)}else{coords=str.split(/\n+/)}if(!coords.length||!str){return}var endReg=/[,，]$/;coords=_.map(coords,function(value){if(value){if(endReg.test(value)){value.replace(endReg,"")}return value.replace(/\s+/,"")}});$input.property("value",coords.join("\n"));return coords},parseEntities2BestMap:function(){var self=this;if(!self.entities||!self.entities.length){return}var graph=self.context.graph(),context=self.context;var selExtent=iD.geo.Extent();self.entities.forEach(function(entity){selExtent=selExtent.extend(entity.extent(graph))});var _expend=0.000125;var map=context.map();if(0<=selExtent.area()){if(parseInt(map.extentZoom(selExtent))<context.options.editableLevel){map.center(self.entities[0].loc);map.zoom(context.options.editableLevel)}else{map.extent(selExtent)}}else{if(map.zoom()<context.options.editableLevel){map.zoom(context.options.editableLevel)}map.center(selExtent.center())}},initBody:function($body){var self=this;$body.attr("tabindex",1);var $inputArea=$body.append("textarea").attr("class","coord-list-input").attr("row",10).style({resize:"none",height:"212px"}).on("mousedown",function(){var event=d3.event;event.stopPropagation()});var $searchBtn=$body.append("button").attr("class","search_btn button blue").html("\u786E\u5B9A").on("click",function(){self.searchParsedNodes()});var $clearBtn=$body.append("button").attr("class","clear_btn button gray").html("\u6E05\u7A7A\u5730\u56FE").on("click",function(){self.clearEntities2Map()});$body.append("div").text("\u4EE5\",\"\u5206\u9694\uFF0C\u53C2\u6570\u4E3A \u7EAC\u5EA6\uFF0C\u7ECF\u5EA6\uFF0C\u9AD8\u7A0B\uFF0C\u989C\u8272\u6837\u5F0F \u2014\u2014 \u6362\u884C\u6216\";\"\u4EE3\u8868\u591A\u6761\u4FE1\u606F");$body.append("div").attr("class","color-list").selectAll("div.color-item").data(_.keys(colorKeyMap)).enter().append("div").attr("class","color-item").html(function(key){var result="";var color=colorKeyMap[key];if(!color){return result}result+="<span>"+key+"</span>";result+="<span style=\"background-color: "+color+";\"></span>";return result});$body.append("div").attr("class","msg_box");$body.selectAll("input,select").on("mousedown",function(){d3.event.stopPropagation()})},initPos:function(){var self=this,surfaceRect=this.selection.node().getBoundingClientRect(),panelBoxRect=this.$panelBox.node().getBoundingClientRect();var boxPosition=[(surfaceRect.width-panelBoxRect.width)/2,(surfaceRect.height-panelBoxRect.height)/2];this.$panelBox.style({right:"auto",bottom:"auto",top:0,left:0});iD.util.setTransform(this.$panelBox,boxPosition[0],boxPosition[1]);var behavior=iD.behavior.drag().surface(this.selection).on("start",function(){}).on("move",function(){var delta=d3.event.delta;boxPosition[0]+=delta[0];boxPosition[1]+=delta[1];iD.util.setTransform(self.$panelBox,boxPosition[0],boxPosition[1])}).on("end",function(){});this.$panelBox.call(behavior)},showEntitiesInfoList:function(){var self=this;var $body=d3.select("body");var $panel=$body.selectAll("div#node-search-result-div");if(!$panel.node()){$panel=$panel.data([0]).enter().append("div").attr("id","node-search-result-div");$panel.append("div").attr("class","history-list")}$panel.style("display","block");var _count=1;var entityArr=self.entities.filter(function(n){return self.context.graph().hasEntity(n.id)});if(!entityArr.length){self.hideEntitiesInfoList();return}var $list=$panel.select("div.history-list");var $items=$list.selectAll("div.list-item").data(entityArr);$items.enter().append("div").attr("class","list-item").each(function(node){var $this=d3.select(this);var locations=node.loc;var color=colorKeyMap[node.tags.colortype]||"#333";$this.html(`
	    				<div class="item-prefix" style="color: ${color};">${_count}</div>
	    				<div class="item-left">
	    					<p>${locations[0]||"0"}</p>
	    					<p>${locations[1]||"0"}</p>
	    					<p>${locations[2]||"0"}</p>
	    				</div>
	    				<button type="button">定位</button>
	    				`);_count++});$items.exit().remove();$items.selectAll("button").on("click.pic-player",function(){var node=this.parentNode.__data__;var map=self.context.map(),context=self.context;if(map.zoom()<context.options.editableLevel){map.zoom(context.options.editableLevel)}map.center([node.loc[0],node.loc[1]]);context.graph().hasEntity(node.id)&&map.lightEntity(node.id)})},hideEntitiesInfoList:function(){var self=this;var $panel=d3.select("div#node-search-result-div");$panel.style("display","none")},show:function(){var self=this;if(!self.$panelBox){self.initPanel()}self.$panelBox.classed("hidden",false);function refreshEntityInfo(){self.showEntitiesInfoList()}let his=self.context.history();his.on("change.node_search",refreshEntityInfo);his.on("undone.node_search",refreshEntityInfo);his.on("redone.node_search",refreshEntityInfo);try{self.$panelBody.node().focus()}catch(e){console.warn(e)}self.showEntitiesInfoList()},hide:function(){var self=this;self.$panelBox.classed("hidden",true);self.context.history().on("change.node_search",null)}});function createPoint(loc,i){var coords=[loc[0],loc[1],loc[2]||0];var node=iD.Node({_type:iD.data.DataType.SEARCH_POINT,tags:{name_chn:"\u641C\u7D22\u7ED3\u679C\u70B9",x_coord:coords[0].toString(),y_coord:coords[1].toString(),z_coord:coords[2].toString(),colortype:loc[3]||1},loc:coords});if(i){node.tags.index=i}return node}function createMarkDatum(context,geomList){var entities=[];var actions=[];for(var i=0,len=geomList.length;i<len;i++){var node=createPoint(geomList[i],i+1);entities.push(node);actions.push(iD.actions.AddEntity(node))}actions.push(t("operations.add.annotation.point"));context.perform.apply(this,actions);return entities}})(iD);;;iD.ui.EditCheckTagControl=function(context){var panel=null;var taskid;function showPanel(){if(!panel){panel=new iD.ui.EditCheckTagPanel(context,context.container())}if(taskid&&iD.Task.d.task_id!=taskid){panel.clearTabs()}taskid=iD.Task.d.task_id;panel.show()}var buttons=[{id:"editcheck-tag-control",title:"\u8D28\u68C0\u8868\u683C",action:showPanel,key:"Ctrl+E"}];return function(selection){var button=selection.selectAll("button").data(buttons).enter().append("button").attr("tabindex",-1).attr("class",function(d){return d.id}).on("click.control",function(d){d.action()}).call(bootstrap.tooltip().placement("left").html(true).title(function(d){return iD.ui.tooltipHtml(d.title,d.key)}));button.append("span").attr("class","text-fill").text(function(d){var str=d.title;for(var key in d.style){this.style[key]=d.style[key]}return str.substring(0,d.titleNum||4)});var keybinding=d3.keybinding("EditCheckTagControl");buttons.forEach(function(b){keybinding.on(b.key,function(){d3.event.stopPropagation();d3.event.preventDefault();b.action()})});d3.select(document).call(keybinding)}};;;;;(function(iD){iD.ui.EditCheckTagPanel=function(context,selection){this.dispatch=d3.dispatch("close");this.selection=selection;this.context=context;return d3.rebind(this,this.dispatch,"on")};var colorKeyMap={1:"#ff0000",2:"#00ff00",3:"#0000ff"};_.assign(iD.ui.EditCheckTagPanel.prototype,{__rowClick:false,initPanel:function(){var selection=this.selection,self=this;var $panelBox=selection.selectAll("div.editcheck-tag-panel").data([0]);var $newPanelBox=$panelBox.enter().append("div").attr("class","editcheck-tag-panel common-dialog");$newPanelBox.append("div").attr("class","tl-close").html("&times;").on("click",function(){self.hide();self.dispatch.close()});;this.$panelBox=d3.select($panelBox.node());this.$panelTitle=this.$panelBox.append("div").attr("class","panel-title").text("\u8D28\u68C0\u8868\u683C");this.$panelBody=this.$panelBox.append("div").attr("class","panel-body");var $tabTabs=this.$panelBody.append("div").attr("class","tab-tablist");this.$tabList=$tabTabs.append("ul").attr("class","cf nav nav-tabs");this.$tabContent=this.$panelBody.append("div").attr("class","tab-content");this.$bottomBtnList=this.$panelBody.append("div").attr("class","buttom-btnlist");this.listTabs=[];this.initBody(this.$panelBody);this.initPos();this.initEvent();this.$selectModel;this.craeteSelectModelName()},initBody:function($body){var self=this;$body.attr("tabindex",1);var $btnList=self.$bottomBtnList;var $searchBtn=$btnList.append("button").attr("class","button blue").html("\u67E5\u8BE2\u6A21\u578B").on("click",function(){self.$selectModel.classed("hide",false)})},initEvent:function(){var self=this;self.$panelBox.on("mousedown.editcheck-tag-panel",function(){checkMenu(d3.event)});self.$panelBody.on("mousedown.editcheck_tag_panel",function(){var evt=d3.event;evt.stopImmediatePropagation();checkMenu(evt);return false});var context=this.context;context.event.on("selected.editcheck_tag_panel",function(entities){if(!self.isVisible()||self.__rowClick){self.__rowClick=false;return}if(!entities||1!=entities.length||!entities[0].modelName){return}var d=entities[0];self.locateTabEntity(d.modelName,d.id,false)});function checkMenu(evt){var $menu=self.$panelBody.select(".tab-pane .ect-contextmenu");if(!$menu.node())return;var rect=$menu.node().getBoundingClientRect();if(!rect)return;var x=evt.clientX,y=evt.clientY;if(x<rect.left||x>rect.right||y<rect.top||y>rect.bottom){self.closeContextMenu()}}},craeteSelectModelName:function(){var self=this;var modelNames=iD.ModelEntitys;var $selectModel=self.$panelBox.append("div").attr("class","panel-select editcheck-tag-panel hide");$selectModel.append("div").attr("class","panel-title").text("\u9009\u62E9\u6A21\u578B\u540D\u79F0");self.$selectModel=$selectModel;var select=$selectModel.append("select").attr("class","value selectmodel").style("padding","5px 10px");var optionData=[];for(var i in modelNames){optionData.push({name:modelNames[i]._modelName,value:modelNames[i]._modelName})}select.selectAll("option").data(optionData).enter().append("option").attr("value",function(o){return o.value}).attr("title",function(o){return o.name}).text(function(o){return o.name});var $btn=$selectModel.append("div").attr("class","buttom-btnlist").style("padding","5px 10px");$btn.append("button").attr("class","button blue").html("\u786E\u5B9A").on("click",function(){var mname=select.value();$selectModel.classed("hide",true);self.createTab(iD.data.DataType[mname]||mname)});$btn.append("button").attr("class","button blue").html("\u53D6\u6D88").on("click",function(){$selectModel.classed("hide",true)})},createTab:function(modelName){var old;this.listTabs.forEach(d=>{if(old)return;if(modelName&&d.modelName==modelName){old=d;return}});if(old){old.show();old.refresh();return old}var item=new TabItem(this,modelName);this.listTabs.push(item);item.show();item.refresh();return item},initPos:function(){var self=this,surfaceRect=this.selection.node().getBoundingClientRect(),panelBoxRect=this.$panelBox.node().getBoundingClientRect();var boxPosition=[(surfaceRect.width-panelBoxRect.width)/2,(surfaceRect.height-panelBoxRect.height)/2];boxPosition[0]=parseInt(boxPosition[0]);boxPosition[1]=parseInt(boxPosition[1]);this.$panelBox.style({right:"auto",bottom:"auto",top:0,left:0});iD.util.setTransform(this.$panelBox,boxPosition[0],boxPosition[1]);var behavior=iD.behavior.drag().surface(this.selection).on("start",function(){}).on("move",function(){var delta=d3.event.delta;boxPosition[0]+=delta[0];boxPosition[1]+=delta[1];iD.util.setTransform(self.$panelBox,boxPosition[0],boxPosition[1])}).on("end",function(){});this.$panelBox.call(behavior)},show:function(){var self=this;if(!self.$panelBox){self.initPanel()}self.$panelBox.classed("hidden",false)},isVisible:function(){return this.$panelBox&&this.$panelBox.size()&&!this.$panelBox.classed("hidden")||false},hide:function(){var self=this;self.__rowClick=false;self.$panelBox.classed("hidden",true);self.closeContextMenu()},clearTabs:function(){this.listTabs.forEach(item=>item.destory());this.listTabs=[]},lightEntity:function(ids,fromClick){var context=this.context,graph=context.graph();if(!_.isArray(ids)){ids=[ids]}var sids=[],suppressMenu=false;ids.forEach(id=>{var entity=graph.hasEntity(id);if(!entity)return;if(entity instanceof iD.Relation){if(entity.modelName===iD.data.DataType.R_DIVIDER_DREF){sids.push(..._.pluck(entity.members,"id"))}else{sids.push(id);suppressMenu=true}}else{sids.push(id)}});var bound;sids.forEach(id=>{var entity=graph.entity(id);var _bound=entity.extent&&entity.extent(graph);if(!bound)bound=_bound;else bound.extend(_bound)});var editZoom=context.options.editableLevel;if(bound){var map=context.map();map.center(bound.center());var newZoom=parseInt(map.extentZoom(bound));if(newZoom<editZoom){newZoom=editZoom}if(newZoom!=map.zoom()){map.zoom(newZoom)}}if(_.isEqual(context.selectedIDs(),sids)){this.__rowClick=false;return}this.__rowClick=true;context.enter(iD.modes.Select(context,sids,null,true).suppressMenu(suppressMenu).newFeature(false))},locateTabEntity:function(modelName,entityid,toSelected=true){var item=this.createTab(modelName);item.locateEntityRow(entityid,toSelected);toSelected&&entityid&&this.lightEntity(entityid)},closeContextMenu:function(){this.listTabs.forEach(item=>{item.rowRightMenu(false)})}});function TabItem(panel,modelName){this.panel=panel;this.$tabList=this.panel.$tabList;this.$tabContent=this.panel.$tabContent;this.modelName=modelName;this.sortField={name:"id",sort:"asc"};var dispatch=d3.dispatch("destory","tabclick","sortrow","rowclick","rowcontextmenu");this.event=dispatch;this.$tab;this.$pane;this._initTab();this._initTabContent();this.initEvent();this.$tab.classed("active",false);this.$pane.classed("active",false)}_.assign(TabItem.prototype,{_initTab:function(){var self=this;var $list=this.$tabList;var modelName=this.modelName;var domid="_ecttab_"+modelName;var $tab=$list.select("#"+domid);if(!$tab.size()){$tab=$list.append("li").attr("id",domid).attr("class","active")}this.$tab=$tab;this.renderTab()},renderTab:function(){var self=this;var $tab=this.$tab;if(!$tab||!$tab.size()){return}$tab.html("");var modelName=this.modelName;$tab.append("a").attr("href","javascript:void(0)").text(modelName||"").on("click",function(){self.event.tabclick();return});$tab.append("div").attr("class","tab-close").html("&times;").on("click",function(){self.event.destory();return false})},_initTabContent:function(){var $list=this.$tabContent;var modelName=this.modelName;var domid="_ectpanel_"+modelName;var $pane=$list.select("#"+domid);if(!$pane.size()){$pane=$list.append("div").attr("id",domid).attr("class","tab-pane active")}this.$pane=$pane;this.renderTabContent()},renderTabContent:function(){var self=this;var $pane=this.$pane;if(!$pane||!$pane.size()){return}$pane.html("");var modelName=this.modelName;var model=iD.ModelEntitys[modelName];if(!model){return}var fieldList=model.getFields(model.getGeoType())||[];fieldList.unshift({fieldName:"id",fieldTitle:"ID"});var entities=this.entities||[];if(modelName===iD.data.DataType.DIVIDER){fieldList.push({fieldName:iD.data.DataType.DIVIDER_ATTRIBUTE,fieldTitle:"\u9053\u8DEF\u5206\u9694\u7EBF\u5C5E\u6027\u53D8\u5316\u70B9"});fieldList.push({fieldName:iD.data.DataType.LANE_ATTRIBUTE,fieldTitle:"\u8F66\u9053\u5C5E\u6027\u53D8\u5316\u70B9"})}var context=this.panel.context,graph=context.graph();var trDataList=_.map(entities,function(d){var tags=_.extend({},d.tags);tags.id=Number(iD.Entity.id.toOSM(d.id));if(modelName===iD.data.DataType.DIVIDER){var daList=graph.parentRelations(d,iD.data.DataType.DIVIDER_ATTRIBUTE),laList=graph.parentRelations(d,iD.data.DataType.LANE_ATTRIBUTE);tags[iD.data.DataType.DIVIDER_ATTRIBUTE]=daList.length||0;tags[iD.data.DataType.LANE_ATTRIBUTE]=laList.length||0}else if(modelName===iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION){tags.VEHICLE=iD.util._Util._getCarNamesByHexadecimal(tags.VEHICLE||"80000000");tags.TIME=iD.convertGDFToInfo(tags.TIME||"");tags.WEATHER=iD.util._Util._getWeatherNamesByCode(tags.WEATHER);if(tags.VEHICLE&&tags.VEHICLE.length){tags.VEHICLE=_.pluck(tags.VEHICLE,"label").join(",")}else{tags.VEHICLE=""}if(tags.TIME&&tags.TIME.timeRange){tags.TIME=_.map(tags.TIME.timeRange,function(t){return t.start+" - "+t.end}).join("\u3001")}else{tags.TIME=""}if(tags.WEATHER&&tags.WEATHER.length){tags.WEATHER=_.pluck(tags.WEATHER,"label").join(",")}else{tags.WEATHER=""}}return{id:d.id,tags:tags}});var $wrap=$pane.append("div").attr("class","table-wrap clearfix");var $tableHeader=$wrap.append("div").attr("class","table-headwrap").append("div").attr("class","table table-bordered table-header");var $table=$wrap.append("div").attr("class","table-bodywrap").append("div").attr("class","table table-bordered table-hover");$tableHeader.append("div").attr("class","tr").selectAll(".th").data(fieldList).enter().append("div").attr("class","th").text(function(d){return d.fieldName||""}).attr("data-field",function(d){return d.fieldName||""}).on("click.ect-panel",function(d){var sort="asc",fieldName=d.fieldName;if(self.sortField.name===fieldName){var oldSort=self.sortField.sort;sort=["asc","desc"][Number("asc"==oldSort)]}self.event.sortrow(fieldName,sort)});var $trList=$table.selectAll(".tr").data(trDataList).enter().append("div").attr("class","tr").on("click.ect-panel",function(d,idx){self.event.rowclick.call(this,d,idx)}).on("contextmenu.ect-panel",function(d,idx){self.event.rowcontextmenu.call(this,d,idx)});$trList.selectAll(".td").data(function(d,index){var fieldNames=_.map(fieldList,f=>f.fieldName||false);fieldNames=_.compact(fieldNames);return fieldNames.map((name,idx)=>{let fvalue=d.tags[name];fvalue=null==fvalue?"":fvalue;return{name:name,value:fvalue,entityid:d.id,row:index,col:idx}})}).enter().append("div").attr("class","td").text(function(d){var entity=context.hasEntity(d.entityid);if(entity&&entity.modelName==iD.data.DataType.ROAD_ATTRIBUTE){if("VALUE"==d.name){return getSubTypeText(d,this)}}else if("SUBTYPE"==d.name){return getSubTypeText(d,this)}return getSelectText(d)});function getSubTypeText(d,tdEle){var typeData=$(tdEle).parent().children().toArray().map(function(td){var sd=td.__data__;if(sd&&"TYPE"==sd.name){return sd}});typeData=_.compact(typeData)[0];if(!typeData)return"";var $thList=$tableHeader.selectAll(".tr .th");var model=$thList[0][d.col].__data__;var f=$thList[0][typeData.col].__data__;if(!f||!model)return"";var typeResult=getSelectValue(f,typeData.value,"value");if(!typeResult.id){return""}var result=getSubTypeList(model,typeResult.id,"parentId");var text="";for(var v of result){if(d.value+""==v.value+""){text=v.name||v.value}}return text||d.value}function getSubTypeList(model,value,keyName){if(!keyName)keyName="parentId";var result=[];if(model&&model.fieldInput&&model.fieldInput.values){for(let v of model.fieldInput.values){if(null!=v[keyName]&&v[keyName]+""==value+""){result.push(v)}}}return result}function getSelectValue(model,value,keyName){if(!keyName)keyName="value";var result={};if(model&&model.fieldInput&&model.fieldInput.values){for(let v of model.fieldInput.values){if(null!=v[keyName]&&v[keyName]+""==value+""){result=v;break}}}return result}function getSelectText(d){var model=$tableHeader.selectAll(".tr .th")[0][d.col];if(model)model=model.__data__;var result=getSelectValue(model,d.value,"value");return result.name||result.value||d.value}var wd={};d3.select($trList.node()).selectAll(".td").each(function(d){var $this=$(this);var width=$this.outerWidth();if(100>width){width=100}var th=$tableHeader.selectAll(".tr .th")[0][d.col];width=_.max([$(th).outerWidth(),width]);wd[d.name]=width}).each(function(d){var width=wd[d.name]+"px";this.style.width=width;this.style["min-width"]=width});$tableHeader.selectAll(".tr .th").each(function(d){var width=wd[d.fieldName]+"px";this.style.width=width;this.style["min-width"]=width});this.event.sortrow(this.sortField.name,this.sortField.sort)},refreshEntities:function(){var modelName=this.modelName;var context=this.panel.context;var entities=context.intersects(iD.geo.Extent([-Infinity,-Infinity],[Infinity,Infinity]));entities=entities.filter(function(d){return d.modelName&&d.tags&&d.modelName===modelName}).sort(function(d1,d2){return Number(iD.Entity.id.toOSM(d1.id))-Number(iD.Entity.id.toOSM(d2.id))});this.entities=entities},refresh:function(){this.refreshEntities();this.renderTab();this.renderTabContent()},show:function(only=true){var $tablist=$(this.panel.$tabList.node()).closest(".tab-tablist");if($tablist.length&&this.$tab.node()){var tablist=$tablist[0],li=this.$tab.node();tablist.scrollLeft=li.offsetLeft-tablist.offsetWidth+li.offsetWidth}if(this.$pane.node()&&!this.$pane.classed("active")){this.$pane.node().scrollLeft=0}this.$tab.classed("active",true);this.$pane.classed("active",true);if(!only){return}this.panel.listTabs.forEach(item=>{if(item!=this){item.hide()}})},isVisible:function(){return this.$tab.classed("active")&&this.$pane.classed("active")},hide:function(){this.$tab.classed("active",false);this.$pane.classed("active",false)},initEvent:function(){var self=this;var event=self.event;var panel=this.panel;var context=this.panel.context;var ns="__"+self.modelName;event.on("destory."+ns,function(){var index=panel.listTabs.indexOf(self);self.indexOut();self.destory();var newtab=panel.listTabs[index]||panel.listTabs[index-1]||panel.listTabs[0];if(newtab){newtab.show()}});event.on("tabclick."+ns,function(){if(self.isVisible())return false;self.show()});event.on("rowclick."+ns,function(d){self.panel._fromClick=true;self.panel.lightEntity(d.id);$(this).addClass("active").siblings().removeClass("active")});event.on("rowcontextmenu."+ns,function(d){var evt=d3.event;var graph=context.graph();var rel=graph.hasEntity(d.id);if(!rel||!(rel instanceof iD.Relation)||!rel.members||!rel.members.length){return}self.rowRightMenu(evt,{element:this,entity:rel});$(this).addClass("active").siblings().removeClass("active");evt.preventDefault()});event.on("sortrow."+ns,function(fieldName,sort="",useOrder=false){if(!self.isVisible()||!self.$pane||!self.$pane.size())return false;var $thList=self.$pane.selectAll(".table-headwrap .th");var $trList=self.$pane.selectAll(".table-bodywrap .tr");if($thList.filter(".sort").size()&&self.sortField.name===fieldName&&self.sortField.sort===sort){return}function returnNum(num){return"asc"===sort?num:"desc"===sort?-num:0}$trList.sort(function(d1,d2){var v1=d1.tags[fieldName]||"",v2=d2.tags[fieldName]||"";var nv1=Number(v1),nv2=Number(v2);if(isNaN(nv1)||isNaN(nv2)){return returnNum(v1.localeCompare(v2))}else{return returnNum(nv1-nv2)}});self.sortField.name=fieldName;self.sortField.sort=sort;$thList.filter(".sort").classed("sort",false);$thList.filter("[data-field="+fieldName+"]").classed("sort "+sort,true)})},destory:function(){this.$tab.remove();this.$pane.remove();this.$tab=undefined;this.$pane=undefined;this.$tabList=undefined;this.$tabContent=undefined;this._$contextMenu&&this._$contextMenu.remove();this._$contextMenu=undefined;this.panel=undefined;this.event=undefined;this._destory=true},indexOut:function(){var listTabs=this.panel.listTabs;var selfIdx=listTabs.indexOf(this);if(-1!=selfIdx){listTabs.splice(selfIdx,1)}},locateEntityRow:function(entityid){var self=this;var $body=self.$pane.selectAll(".table-bodywrap");if(!self.isVisible()||!$body.node()){return}var $tr=$body.selectAll(".tr").filter(d=>{return d.id===entityid});$($tr.node()).addClass("active").siblings().removeClass("active");if($tr.node()){var offsetTop=$tr.node().offsetTop;$body.node().scrollTop=offsetTop}},_$contextMenu:null,rowRightMenu:function(e,opts={}){var self=this;self._$contextMenu&&self._$contextMenu.remove();self._$contextMenu=null;if(false===e){return}var root=opts.root&&1==opts.root.nodeType?opts.root:self.$pane.node();var element=opts.element,entity=opts.entity;if(!root)return;var maxHeight=root.offsetHeight,maxWidth=root.offsetWidth;var $root=d3.select(root);var $menu=$root.selectAll("div.ect-contextmenu").data([entity.id]).enter().append("div").attr("class","ect-contextmenu scroll-small");$menu.append("div").attr("class","menu-title").text("members");$menu.append("ul").attr("class","nav").selectAll("li").data(entity.members).enter().append("li").html(d=>{return"<span>"+iD.Entity.id.toOSM(d.id)+"</span><small>"+(d.modelName||"")+"</small>"}).on("click",d=>{self.panel.locateTabEntity(d.modelName,d.id,true);self.rowRightMenu(false)});var clickOffset=d3.mouse(root);var cx=clickOffset[0],cy=clickOffset[1];var top=left=right=bottom="auto";var height=$menu.node().offsetHeight,width=$menu.node().offsetWidth;if(cy+height>=maxHeight){bottom=0+"px"}else{top=cy+"px"}if(cx+width>=maxWidth){right=0+"px"}else{left=cx+"px"}$menu.style({top:top,left:left,right:right,bottom:bottom});self._$contextMenu=$menu}});var $textLabel;function _createTextCom(){if($textLabel)return;$textLabel=$("<div>").css({color:"black","white-space":"nowrap",top:0,left:0,position:"fixed",display:"block",visibility:"visible"}).appendTo("body")}function _removeTextCom(){if(!$textLabel)return;$textLabel.remove();$textLabel=undefined}function textWidth(text){if(!$textLabel)return;$textLabel.text(text);return $text.width()}})(iD);;;iD.ui.TrackLegend=function(context){var headDatas=[["\u989C\u8272","\u8D28\u91CF"]];var tableDatas=[["green","1"],["cyan","2"],["blue","3"],["purple","4"],["magenta","5"],["red","6"],["grey","Unprocessed"]];return function(selection){var $table=selection.selectAll("table").data([0]).enter().append("table").attr("class","table");var $thead=$table.append("thead");var $tbody=$table.append("tbody");$thead.selectAll("tr").data(headDatas).enter().append("tr").selectAll("th").data(d=>d).enter().append("th").text(d=>d);$tbody.selectAll("tr").data(tableDatas).enter().append("tr").selectAll("td").data(d=>d).enter().append("td").html(function(d,idx){if(0===idx){return`<div class="legend-color" style="background-color: ${d};"></div>`}return d});var sideWidth=d3.select("#rightmenu-tools").node().offsetWidth;var domWidth=selection.node().offsetWidth;selection.style("right",sideWidth-domWidth+"px");var $btn=selection.selectAll("div.legend-toggle").data([0]).enter().append("div").attr("class","legend-toggle");$btn.append("span").text("\u8F68\u8FF9\u56FE\u4F8B");var $arrow=$btn.append("span").attr("class","glyphicon glyphicon-chevron-left");$btn.on("click",function(){var $trans=selection.transition().ease("liner").duration(200);$arrow.classed({"glyphicon-chevron-left":false,"glyphicon-chevron-right":false});if(selection.classed("active")){selection.classed("active",false);$arrow.classed("glyphicon-chevron-left",true);domWidth=selection.node().offsetWidth;$trans.style("right",sideWidth-domWidth+"px")}else{selection.classed("active",true);$arrow.classed("glyphicon-chevron-right",true);$trans.style("right",sideWidth+"px")}})}};;;iD.topo={};iD.topo.handle=function(){var topoEntity=iD.TopoEntity();var topoTools={};topoTools[iD.data.DataType.NODEINFO]=iD.topo.NodeSaat();topoTools[iD.data.DataType.NODECONN]=iD.topo.NodeMaat();topoTools[iD.data.DataType.C_NODEINFO]=iD.topo.CrossSaat();topoTools[iD.data.DataType.C_NODECONN]=iD.topo.CrossMaat();topoTools[iD.data.DataType.C_NODECONN]=iD.topo.CrossMaat();topoTools[iD.data.DataType.C_NODECONN]=iD.topo.CrossMaat();topoTools[iD.data.DataType.R_DIVIDER_DREF]=iD.topo.RDividerDref();topoTools[iD.data.DataType.DIVIDER_ATTRIBUTE]=iD.topo.DividerAttribute();topoTools[iD.data.DataType.LANE_ATTRIBUTE]=iD.topo.LaneAttribute();topoTools[iD.data.DataType.DIVIDER_NODE]=iD.topo.DividerNode();var handle={};handle.roadMerge=function(graph,way,wayA,wayB,midNode){var crossNodeM=topoEntity.getRoadCrossByNode(graph,midNode.id);var crossNodeS=topoEntity.getRoadCrossByNode(graph,way.nodes[0]);var crossNodeE=topoEntity.getRoadCrossByNode(graph,way.nodes[way.nodes.length-1]);var parentRelations=graph.parentRelations(wayA);parentRelations.forEach(function(relation){if(topoTools[relation.modelName]){graph=topoTools[relation.modelName].roadMerge(graph,way,wayA,wayB,relation,midNode,crossNodeM,crossNodeS,crossNodeE)}});parentRelations=graph.parentRelations(wayB);parentRelations.forEach(function(relation){if(topoTools[relation.modelName]){graph=topoTools[relation.modelName].roadMerge(graph,way,wayA,wayB,relation,midNode,crossNodeM,crossNodeS,crossNodeE)}});return graph};handle.break=function(context,graph,way,wayA,wayB,node,fromDA){var parentRelations=graph.parentRelations(way);if(way.modelName==iD.data.DataType.ROAD){parentRelations.forEach(function(relation){if(topoTools[relation.modelName]){graph=topoTools[relation.modelName].break(context,graph,way,wayA,wayB,relation)}});graph=topoTools[iD.data.DataType.NODEINFO].breakNode(graph,node,wayA,wayB,way,context);graph=topoTools[iD.data.DataType.NODECONN].breakNode(graph,node,wayA,wayB,way,context)}else if(way.modelName==iD.data.DataType.DIVIDER){parentRelations.forEach(function(relation){if(topoTools[relation.modelName]){graph=topoTools[relation.modelName].break(context,graph,way,wayA,wayB,relation,node)}});graph=topoTools[iD.data.DataType.DIVIDER_NODE].breakNode(graph,node,wayA,wayB,way,context,fromDA)}return graph};handle.autoCompleteNodeTopo=function(graph,nodeID){for(key in topoTools){graph=topoTools[key].autoCompleteNodeTopo(graph,nodeID)}return graph};handle.roadIntersect=function(graph,nodesArr,oldWays){function isHighWayModel(oldWays){for(var i=0;i<oldWays.length;i++){if(oldWays[i].modelName!==iD.data.DataType.ROAD){return false}}return true}if(isHighWayModel(oldWays)){for(key in topoTools){graph=topoTools[key].roadIntersect(graph,nodesArr,oldWays)}}return graph};handle.topoSplit=function(graph,entityA,entityB,way){for(var key in topoTools){graph=topoTools[key].topoSplit(graph,entityA,entityB,way)}return graph};handle.create=function(graph,way){if(!_.include([iD.data.DataType.ROAD,iD.data.DataType.ROAD_NODE],way.modelName)){return graph}var fromNode=graph.entity(way.nodes[0]);var toNode=graph.entity(way.nodes[way.nodes.length-1]);var maintainNew=function(node){graph=topoTools[iD.data.DataType.NODEINFO].roadCreate(graph,node.id);graph=topoTools[iD.data.DataType.NODECONN].roadCreate(graph,node.id);graph=topoTools[iD.data.DataType.C_NODEINFO].roadCreate(graph,node.id);graph=topoTools[iD.data.DataType.C_NODEINFO].roadCreate(graph,node.id)};maintainNew(fromNode);maintainNew(toNode);return graph};handle.roadCrossEdit=function(graph,nodeiD){if(nodeiD){for(key in topoTools){let item=topoTools[key];if(item&&item.roadCrossEdit){graph=item.roadCrossEdit(graph,graph.entity(nodeiD))}}}return graph};handle.nodeMerge=function(context,graph,nodeA,nodeB){if(nodeA.isRoadNode()){var topoEntity=iD.TopoEntity();var crossNodeIdA=topoEntity.isInCrossNode(graph,nodeA.id);var crossNodeIdB=topoEntity.isInCrossNode(graph,nodeB.id);for(var key in topoTools){graph=topoTools[key].nodeMerge(context,graph,nodeA,nodeB)}if(crossNodeIdA&&crossNodeIdB){for(var key in topoTools){graph=topoTools[key].crossNodeMerge(graph,graph.entity(crossNodeIdA),graph.entity(crossNodeIdB))}if(crossNodeIdA==crossNodeIdB){graph=iD.actions.RoadCrossModify([crossNodeIdB,nodeA.id])(graph)}else{var crossNodeA=graph.entity(crossNodeIdA);var nodeIds=[];crossNodeA.members.forEach(function(member){nodeIds.push(member.id)});graph=iD.actions.DeleteNode(crossNodeIdA)(graph);nodeIds.forEach(function(nodeId){graph=iD.actions.RoadCrossModify([crossNodeIdB,nodeId])(graph)})}}else if(crossNodeIdA){graph=iD.actions.RoadCrossModify([crossNodeIdA,nodeB.id])(graph)}else if(crossNodeIdB){graph=this.roadCrossEdit(graph,crossNodeIdB)}}else{for(var key in topoTools){graph=topoTools[key].nodeMerge(context,graph,nodeA,nodeB)}}return graph};handle.nodeMove=function(context,graph,node){for(var key in topoTools){graph=topoTools[key].nodeMove(context,graph,node)}return graph};handle.roadModify=function(graph,way){return graph};return handle};;iD.topo.RoadNode=function(){};;iD.topo.CrossMaat=function(){var topoCrossMaat={};topoCrossMaat.roadMerge=function(graph,way,wayA,wayB,rel,midNode,crossNodeM,crossNodeS,crossNodeE){if(crossNodeS&&crossNodeE&&crossNodeS.id==crossNodeE.id){return graph}var fromMember=rel.memberByRole(iD.data.RoleType.FROAD_ID);var toMember=rel.memberByRole(iD.data.RoleType.TROAD_ID);var nodeMember=rel.memberByRole(iD.data.RoleType.C_NODE_ID);if(fromMember&&toMember){if(crossNodeS&&nodeMember.id==crossNodeS.id||crossNodeE&&nodeMember.id==crossNodeE.id){if(fromMember.id==wayA.id||fromMember.id==wayB.id){fromMember.id=way.id;rel=rel.updateMember(fromMember,fromMember.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel)}if(toMember.id==wayA.id||toMember.id==wayB.id){toMember.id=way.id;rel=rel.updateMember(toMember,toMember.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel)}}}return graph.replace(rel)};topoCrossMaat.break=function(context,graph,way,wayA,wayB,rel){let topoEntity=iD.TopoEntity();var fromRoadMember=rel.memberByRole(iD.data.RoleType.FROAD_ID);var toRoadMember=rel.memberByRole(iD.data.RoleType.TROAD_ID);var RoadCrossMember=rel.memberByRole(iD.data.RoleType.C_NODE_ID);var roadCrossEntity=graph.entity(RoadCrossMember.id);let cmembers=topoEntity.getCrossNodeMembers(graph,roadCrossEntity.id);var nodeMembers=[];for(var k=0;k<cmembers.length;k++){nodeMembers[k]=cmembers[k].id}var wayNodesLength=way.nodes.length;if(fromRoadMember&&nodeMembers&&fromRoadMember.id==way.id){if(!(-1==nodeMembers.indexOf(way.nodes[0]))){fromRoadMember.id=wayA.id}else if(!(-1==nodeMembers.indexOf(way.nodes[wayNodesLength-1]))){fromRoadMember.id=wayB.id};rel.tags=iD.util.tagExtend.updateTaskTag(rel);rel=rel.updateMember(fromRoadMember,0)}if(toRoadMember&&nodeMembers&&toRoadMember.id==way.id){if(!(-1==nodeMembers.indexOf(way.nodes[0]))){toRoadMember.id=wayA.id}else if(!(-1==nodeMembers.indexOf(way.nodes[wayNodesLength-1]))){toRoadMember.id=wayB.id};rel.tags=iD.util.tagExtend.updateTaskTag(rel);rel=rel.updateMember(toRoadMember,2)}graph=graph.replace(rel);return graph};topoCrossMaat.autoCompleteNodeTopo=function(graph,nodeID){graph=createFullCrossMaat(graph,nodeID);return graph};topoCrossMaat.roadIntersect=function(graph,nodesArr,oldWays){var isInnerWay=function(way){var topoEntity=iD.TopoEntity();var crossNodeIdA=topoEntity.isInCrossNode(graph,way.nodes[0]);var crossNodeIdB=topoEntity.isInCrossNode(graph,way.nodes[way.nodes.length-1]);if(false!==crossNodeIdA&&false!==crossNodeIdB&&crossNodeIdA==crossNodeIdB){return way}return false};oldWays.forEach(function(way){var innerWay=isInnerWay(way);if(false!==innerWay){nodesArr.forEach(function(node){graph=createFullCrossMaat(graph,node.id)})}});return graph};topoCrossMaat.topoSplit=function(graph,entityA,entityB,wayId){var graph=createFullCrossMaat(graph,entityB.id);var graph=createFullCrossMaat(graph,entityA.id);return graph};topoCrossMaat.roadCreate=function(graph,nodeId){var graph=createFullCrossMaat(graph,nodeId);return graph};topoCrossMaat.roadCrossEdit=function(graph,node){return createFullCrossMaat(graph,node.id)};topoCrossMaat.crossNodeMerge=function(graph,crossNodeA,crossNodeB){if(crossNodeA&&crossNodeB){graph.parentRelations(crossNodeA).forEach(function(rel){if(rel.modelName==iD.data.DataType.C_NODE){var member=rel.memberByRole(iD.data.RoleType.ROAD_NODE_ID);member.id=crossNodeB.id;rel=rel.updateMember(member,member.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel);graph=graph.replace(rel)}})}return graph};topoCrossMaat.nodeMerge=function(context,graph,nodeA,nodeB){return graph};topoCrossMaat.nodeMove=function(context,graph,node){return graph};function createFullCrossMaat(graph,nodeId){var topoEntity=iD.TopoEntity();var crossNodeId=topoEntity.isInCrossNode(graph,nodeId);var connectWayIDs=findConnectWaysArrByNode(graph,crossNodeId);if(false!==crossNodeId&&false!==connectWayIDs){connectWayIDs.forEach(function(wayId){graph=createCMaatByCNode(graph,wayId,crossNodeId,connectWayIDs)})}if(false!==crossNodeId&&false==connectWayIDs){graph=createCMaatByCNode(graph,connectWayIDs,crossNodeId,connectWayIDs)}return graph}function findConnectWaysArrByNode(graph,crossNodeId){var isInArray=function(array,element){if(array&&element){for(var i in array){if(array[i]==element){return true}}}return false};var isInnerWay=function(array,way){if(isInArray(array,way.nodes[0])&&isInArray(array,way.nodes[way.nodes.length-1])){return true}return false};let topoEntity=iD.TopoEntity();if(false!=crossNodeId){var roadCrossMembers=topoEntity.getCrossNodeMembers(graph,crossNodeId);var innerNodeIds=[];var connectWayIDs=new Array;roadCrossMembers.forEach(function(member){innerNodeIds.push(member.id)});innerNodeIds.forEach(function(innerNodeId){var innerNodeEntity=graph.entity(innerNodeId);var ways=graph.parentWays(innerNodeEntity);ways.forEach(function(way){if(!isInArray(connectWayIDs,way.id)&&!isInnerWay(innerNodeIds,way)){if(!way.isOneRoadCrossWay()){connectWayIDs.push(way.id)}}})});if(0==connectWayIDs.length){return false}else{return connectWayIDs}}return false}function createCMaatByCNode(graph,wayId,nodeId,newCrossMaatWaysId){var node=graph.entity(nodeId);var isInArray=function(array,element){for(var i in array){if(array[i].toString()==element.toString()){return true}}return false};var parentRelation=graph.parentRelations(node);var adjoinWayIds=new Array;if(0!=parentRelation.length){parentRelation.forEach(function(relation){if(relation.modelName==iD.data.DataType.C_NODECONN){var from_roadId=relation.memberByRole(iD.data.RoleType.FROAD_ID).id;var to_roadId=relation.memberByRole(iD.data.RoleType.TROAD_ID).id;if(!isInArray(newCrossMaatWaysId,from_roadId)||!isInArray(newCrossMaatWaysId,to_roadId)){var secondRels=graph.parentRelations(relation);secondRels.forEach(function(secondRel){graph=graph.remove(secondRel)});graph=graph.remove(relation)}else if(wayId==from_roadId||wayId==to_roadId){var fromToWaysArr=[from_roadId,to_roadId];if(!isInArray(adjoinWayIds,fromToWaysArr)){adjoinWayIds.push(fromToWaysArr)}}}})}if(newCrossMaatWaysId){newCrossMaatWaysId.forEach(function(newWayId){var newFromToWayArr1=[wayId,newWayId];var newFromToWayArr2=[newWayId,wayId];if(wayId==newWayId){if(!isInArray(adjoinWayIds,newFromToWayArr1)){graph=createNewCrossMaat(graph,wayId,newWayId,nodeId)}}else{if(!isInArray(adjoinWayIds,newFromToWayArr1)){graph=createNewCrossMaat(graph,wayId,newWayId,nodeId)}if(!isInArray(adjoinWayIds,newFromToWayArr2)){graph=createNewCrossMaat(graph,newWayId,wayId,nodeId)}}})}return graph}function addCorssMaatForNode(graph,way,node){var isInArray=function(array,element){for(var i in array){if(array[i]==element){return true}}return false};var nodeParentRelation=graph.parentRelations(node);var adjoinWayIds=new Array;if(0!=nodeParentRelation.length){nodeParentRelation.forEach(function(relation){if(relation.modelName==iD.data.DataType.C_NODECONN){var from_roadId=relation.memberByRole(iD.data.RoleType.FROAD_ID).id;if(!isInArray(adjoinWayIds,from_roadId)){adjoinWayIds.push(from_roadId)}var to_roadId=relation.memberByRole(iD.data.RoleType.TROAD_ID).id;if(!isInArray(adjoinWayIds,to_roadId)){adjoinWayIds.push(to_roadId)}}});for(var i in adjoinWayIds){graph=createNewCrossMaat(graph,adjoinWayIds[i],way.id,node.id);graph=createNewCrossMaat(graph,way.id,adjoinWayIds[i],node.id)}}return graph};function createNewCrossMaat(graph,sWayId,eWayId,nWayId){var crossMaatMember=[{id:sWayId,role:iD.data.RoleType.FROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD},{id:nWayId,role:iD.data.RoleType.C_NODE_ID,type:iD.data.GeomType.NODE,modelName:iD.data.DataType.C_NODE},{id:eWayId,role:iD.data.RoleType.TROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD}];var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.C_NODECONN);var layerId=currentLayer.id;var crossMaatRelations=iD.Relation({members:crossMaatMember,modelName:iD.data.DataType.C_NODECONN,layerId:layerId});crossMaatRelations.setTags(iD.util.getDefauteTags(crossMaatRelations,currentLayer));crossMaatRelations=iD.util.tagExtend.updateAcceTagOfCMaat(graph,crossMaatRelations);graph=graph.replace(crossMaatRelations);return graph}return topoCrossMaat};;iD.topo.CrossMaatPath=function(){};;iD.topo.CrossRule=function(){};;iD.topo.CrossSaat=function(){var topoCrossSaat={};topoCrossSaat.roadMerge=function(graph,way,wayA,wayB,rel,midNode,crossNodeM,crossNodeS,crossNodeE){var nodeMember=rel.memberByRole(iD.data.RoleType.C_NODE_ID);if(crossNodeM&&crossNodeM!=crossNodeS&&crossNodeM!=crossNodeE){if(nodeMember.id==crossNodeM.id){return graph}}var flag=false;graph.parentRelations(way).forEach(function(wayRel){if(wayRel.modelName==iD.data.DataType.C_NODEINFO){var hasNodeMember=wayRel.memberByRole(iD.data.RoleType.C_NODE_ID);if(hasNodeMember.id==nodeMember.id){flag=true}}});if(!flag){var member=rel.memberByRole(iD.data.RoleType.ROAD_ID);if(member){member.id=way.id;rel=rel.updateMember(member,member.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel)}}return graph.replace(rel)};topoCrossSaat.break=function(context,graph,way,wayA,wayB,rel){let topoEntity=iD.TopoEntity();var node=graph.entity(wayB.nodes[0]);var roadMember=rel.memberByRole(iD.data.RoleType.ROAD_ID);var RoadCrossMember=rel.memberByRole(iD.data.RoleType.C_NODE_ID);var roadCrossEntity=graph.entity(RoadCrossMember.id);let cmembers=topoEntity.getCrossNodeMembers(graph,roadCrossEntity.id);var nodeMembers=[];for(var k=0;k<cmembers.length;k++){nodeMembers[k]=cmembers[k].id}var wayNodesLength=way.nodes.length;if(!(0==wayNodesLength)&&roadMember&&nodeMembers){if(!(-1==nodeMembers.indexOf(way.nodes[0]))&&roadMember.id==way.id){roadMember.id=wayA.id}if(!(-1==nodeMembers.indexOf(way.nodes[wayNodesLength-1]))&&roadMember.id==way.id){roadMember.id=wayB.id}}rel=rel.updateMember(roadMember,roadMember.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel);graph=graph.replace(rel);return graph};topoCrossSaat.autoCompleteNodeTopo=function(graph,nodeID){graph=createFullCrossSaat(graph,nodeID);return graph};topoCrossSaat.roadIntersect=function(graph,nodesArr,oldWays){nodesArr.forEach(function(node){graph=createFullCrossSaat(graph,node.id)});return graph};topoCrossSaat.topoSplit=function(graph,entityA,entityB,wayId){graph=createFullCrossSaat(graph,entityB.id);graph=createFullCrossSaat(graph,entityA.id);return graph};topoCrossSaat.roadCreate=function(graph,nodeId){graph=createFullCrossSaat(graph,nodeId);return graph};topoCrossSaat.roadCrossEdit=function(graph,node){return createFullCrossSaat(graph,node.id)};topoCrossSaat.crossNodeMerge=function(graph,crossNodeA,crossNodeB){if(crossNodeA&&crossNodeB){graph.parentRelations(crossNodeA).forEach(function(rel){if(rel.modelName==iD.data.DataType.C_NODEINFO){var member=rel.memberByRole(iD.data.RoleType.C_NODE_ID);member.id=crossNodeB.id;rel=rel.updateMember(member,member.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel);graph=graph.replace(rel)}})}return graph};topoCrossSaat.nodeMerge=function(context,graph,nodeA,nodeB){return graph};topoCrossSaat.nodeMove=function(context,graph,node){return graph};function createFullCrossSaat(graph,nodeId){var isInArray=function(array,element){if(array&&element){for(var i in array){if(array[i]==element){return true}}}return false};var isInnerWay=function(array,way){if(isInArray(array,way.nodes[0])&&isInArray(array,way.nodes[way.nodes.length-1])){return true}return false};var topoEntity=iD.TopoEntity();var crossNodeId=topoEntity.isInCrossNode(graph,nodeId);if(false!=crossNodeId){var roadCross=graph.entity(crossNodeId);var roadCrossMembers=topoEntity.getCrossNodeMembers(graph,crossNodeId);var innerNodeIds=[];var connectWayIDs=new Array;roadCrossMembers.forEach(function(member){innerNodeIds.push(member.id)});innerNodeIds.forEach(function(innerNodeId){var innerNodeEntity=graph.entity(innerNodeId);var ways=graph.parentWays(innerNodeEntity);ways.forEach(function(way){if(!isInArray(connectWayIDs,way.id)){if(!way.isOneRoadCrossWay()){connectWayIDs.push(way.id)}}})});var parentRelations=graph.parentRelations(roadCross,iD.data.DataType.C_NODEINFO);var oldCrossSaatWayIds=new Array;parentRelations.forEach(function(relation){if(relation.modelName==iD.data.DataType.C_NODEINFO){if(!isInArray(connectWayIDs,relation.memberByRole(iD.data.RoleType.ROAD_ID).id)){graph=graph.remove(relation)}else{oldCrossSaatWayIds.push(relation.memberByRole(iD.data.RoleType.ROAD_ID).id)}}});connectWayIDs.forEach(function(newWayId){if(!isInArray(oldCrossSaatWayIds,newWayId)){graph=createNewSaat(graph,newWayId,crossNodeId)}});parentRelations=graph.parentRelations(roadCross);parentRelations.forEach(function(relation){if(relation.modelName==iD.data.DataType.C_NODEINFO){var roadMember=relation.memberByRole(iD.data.RoleType.ROAD_ID);if(isInnerWay(innerNodeIds,graph.entity(roadMember.id))){relation=relation.mergeTags({INNERARC:"1"});var newWay=graph.entity(roadMember.id);newWay=newWay.mergeTags({FORM_WAY:"2"});newWay.tags=iD.util.tagExtend.updateTaskTag(newWay);graph=graph.replace(newWay)}else{relation=relation.mergeTags({INNERARC:"0"});relation.tags=iD.util.tagExtend.updateTaskTag(relation)}graph=graph.replace(relation)}})}return graph}function createNewSaat(graph,wayId,nodeId){var crossSaatMember=[{id:wayId,role:iD.data.RoleType.ROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD},{id:nodeId,role:iD.data.RoleType.C_NODE_ID,type:iD.data.GeomType.NODE,modelName:iD.data.DataType.C_NODE}];var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.C_NODEINFO);let layerId=currentLayer.id;var crossSaatRelations=iD.Relation({modelName:iD.data.DataType.C_NODEINFO,tags:iD.util.getDefauteTags(iD.data.DataType.C_NODEINFO,currentLayer),members:crossSaatMember,layerId:layerId});graph=graph.replace(crossSaatRelations);return graph};return topoCrossSaat};;iD.topo.DividerAttribute=function(){var dividerAttribute={};dividerAttribute.roadMerge=function(graph,way,wayA,wayB,rel,midNode,crossNodeM,crossNodeS,crossNodeE){return graph};dividerAttribute.break=function(context,graph,way,wayA,wayB,rel,midNode){let m=rel.memberByRole(iD.data.RoleType.DIVIDER_ID);let nodeId=rel.memberByRole(iD.data.RoleType.DIVIDER_NODE_ID).id;if(wayA.nodes.includes(nodeId)){if(nodeId==midNode.id){rel=rel.replaceMember(way,wayB)}else{rel=rel.replaceMember(way,wayA)}rel.tags=iD.util.tagExtend.updateTaskTag(rel);graph=graph.replace(rel)}else{graph=iD.actions.DeleteRelation(rel.id)(graph)}return graph};dividerAttribute.autoCompleteNodeTopo=function(graph,nodeID){return graph};dividerAttribute.roadIntersect=function(graph,nodesArr,oldWays){return graph};dividerAttribute.topoSplit=function(graph,entityA,entityB,wayId){return graph};dividerAttribute.roadCreate=function(graph,nodeId){return graph};dividerAttribute.roadCrossEdit=function(graph,node){return graph};dividerAttribute.crossNodeMerge=function(graph,crossNodeA,crossNodeB){return graph};dividerAttribute.nodeMerge=function(context,graph,nodeA,nodeB){return graph};dividerAttribute.nodeMove=function(context,graph,node){return graph};return dividerAttribute};;iD.topo.DividerNode=function(){dividerNode={};dividerNode.roadMerge=function(graph,way,wayA,wayB,rel){return graph};dividerNode.topoSplit=function(graph,entityA,entityB,way){return graph};dividerNode.breakNode=function(graph,node,wayA,wayB,way,context,fromDA){if(fromDA)return graph;let nodes=wayB.nodes;let defauteTag=iD.util.getDefauteTags(node);let _node;for(let i=0;i<nodes.length;i++){_node=graph.entity(nodes[i]);if(_node.id!=node.id){graph=graph.replace(_node.mergeTags(defauteTag))}}return graph};dividerNode.autoCompleteNodeTopo=function(graph,nodeID){return graph};dividerNode.roadIntersect=function(graph,nodesArr,oldWays){return graph};dividerNode.roadCreate=function(graph,nodeId){return graph};dividerNode.roadCrossEdit=function(graph,node){return graph};dividerNode.crossNodeMerge=function(graph,crossNodeA,crossNodeB){return graph};dividerNode.nodeMerge=function(context,graph,nodeA,nodeB){return graph};dividerNode.nodeMove=function(context,graph,node){return graph};return dividerNode};;iD.topo.LaneAttribute=function(){var laneAttribute={};laneAttribute.roadMerge=function(graph,way,wayA,wayB,rel,midNode,crossNodeM,crossNodeS,crossNodeE){return graph};laneAttribute.break=function(context,graph,way,wayA,wayB,rel,midNode){let m=rel.memberByRole(iD.data.RoleType.DIVIDER_ID);let nodeId=rel.memberByRole(iD.data.RoleType.DIVIDER_NODE_ID).id;if(wayA.nodes.includes(nodeId)){if(nodeId==midNode.id){rel=rel.replaceMember(way,wayB)}else{rel=rel.replaceMember(way,wayA)}rel.tags=iD.util.tagExtend.updateTaskTag(rel);graph=graph.replace(rel)}else{graph=iD.actions.DeleteRelation(rel.id)(graph)}return graph};laneAttribute.autoCompleteNodeTopo=function(graph,nodeID){return graph};laneAttribute.roadIntersect=function(graph,nodesArr,oldWays){return graph};laneAttribute.topoSplit=function(graph,entityA,entityB,wayId){return graph};laneAttribute.roadCreate=function(graph,nodeId){return graph};laneAttribute.roadCrossEdit=function(graph,node){return graph};laneAttribute.crossNodeMerge=function(graph,crossNodeA,crossNodeB){return graph};laneAttribute.nodeMerge=function(context,graph,nodeA,nodeB){return graph};laneAttribute.nodeMove=function(context,graph,node){return graph};return laneAttribute};;iD.topo.RDividerDref=function(){var rDividerDref={};rDividerDref.roadMerge=function(graph,way,wayA,wayB,rel,midNode,crossNodeM,crossNodeS,crossNodeE){return graph};rDividerDref.break=function(context,graph,way,wayA,wayB,rel){graph=graph.remove(rel);return graph};rDividerDref.autoCompleteNodeTopo=function(graph,nodeID){return graph};rDividerDref.roadIntersect=function(graph,nodesArr,oldWays){return graph};rDividerDref.topoSplit=function(graph,entityA,entityB,wayId){return graph};rDividerDref.roadCreate=function(graph,nodeId){return graph};rDividerDref.roadCrossEdit=function(graph,node){return graph};rDividerDref.crossNodeMerge=function(graph,crossNodeA,crossNodeB){return graph};rDividerDref.nodeMerge=function(context,graph,nodeA,nodeB){return graph};rDividerDref.nodeMove=function(context,graph,node){return graph};return rDividerDref};;iD.topo.NodeMaat=function(){var topoNodeMaat={};topoNodeMaat.roadMerge=function(graph,way,wayA,wayB,rel,midNode,crossNodeM,crossNodeS,crossNodeE){var fromMember=rel.memberByRole(iD.data.RoleType.FROAD_ID);var toMember=rel.memberByRole(iD.data.RoleType.TROAD_ID);var nodeMember=rel.memberByRole(iD.data.RoleType.ROAD_NODE_ID);if(fromMember&&toMember){if(midNode.id!=nodeMember.id){if(fromMember.id==wayA.id||fromMember.id==wayB.id){fromMember.id=way.id;rel=rel.updateMember(fromMember,fromMember.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel)}if(toMember.id==wayA.id||toMember.id==wayB.id){toMember.id=way.id;rel=rel.updateMember(toMember,toMember.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel)}}}return graph.replace(rel)};topoNodeMaat.break=function(context,graph,way,wayA,wayB,rel){var fromRoadMember=rel.memberByRole(iD.data.RoleType.FROAD_ID);var toRoadMember=rel.memberByRole(iD.data.RoleType.TROAD_ID);var noadMember=rel.memberByRole(iD.data.RoleType.ROAD_NODE_ID);var wayNodesLength=way.nodes.length;if(fromRoadMember&&noadMember&&noadMember.id==way.nodes[0]&&fromRoadMember.id==way.id){fromRoadMember.id=wayA.id}else if(fromRoadMember&&noadMember&&noadMember.id==way.nodes[wayNodesLength-1]&&fromRoadMember.id==way.id){fromRoadMember.id=wayB.id};rel=rel.updateMember(fromRoadMember,0);if(toRoadMember&&noadMember&&noadMember.id==way.nodes[0]&&toRoadMember.id==way.id){toRoadMember.id=wayA.id}else if(toRoadMember&&noadMember&&noadMember.id==way.nodes[wayNodesLength-1]&&toRoadMember.id==way.id){toRoadMember.id=wayB.id};rel=rel.updateMember(toRoadMember,2);rel.tags=iD.util.tagExtend.updateTaskTag(rel);graph=graph.replace(rel);return graph};topoNodeMaat.breakNode=function(graph,node,wayA,wayB,way,context){graph=createNewMaat(graph,wayA.id,wayB.id,node.id);graph=createNewMaat(graph,wayB.id,wayA.id,node.id);graph=createNewMaat(graph,wayA.id,wayA.id,node.id);graph=createNewMaat(graph,wayB.id,wayB.id,node.id);return graph};topoNodeMaat.autoCompleteNodeTopo=function(graph,nodeID){graph=createFullNodeMaat(graph,nodeID);return graph};topoNodeMaat.roadIntersect=function(graph,nodesArr,oldWays){nodesArr.forEach(function(node){graph=createFullNodeMaat(graph,node.id)});return graph};topoNodeMaat.topoSplit=function(graph,entityA,entityB,wayId){graph=createFullNodeMaat(graph,entityB.id);graph=createFullNodeMaat(graph,entityA.id);return graph};topoNodeMaat.roadCreate=function(graph,nodeId){graph=createFullNodeMaat(graph,nodeId);return graph};topoNodeMaat.roadCrossEdit=function(graph,node){return graph};topoNodeMaat.crossNodeMerge=function(graph,crossNodeA,crossNodeB){return graph};topoNodeMaat.nodeMerge=function(context,graph,nodeA,nodeB){if(nodeA.isRoadNode()&&nodeB.isRoadNode()){graph.parentRelations(nodeA).forEach(function(rel){if(rel.modelName==iD.data.DataType.NODECONN){var member=rel.memberByRole(iD.data.RoleType.ROAD_NODE_ID);member.id=nodeB.id;rel=rel.updateMember(member,member.index);graph=graph.replace(rel)}});return createFullNodeMaat(graph,nodeB.id)}else{return graph}};topoNodeMaat.nodeMove=function(context,graph,node){return graph};function createFullNodeMaat(graph,nodeId){var connectWays=graph.parentWays(graph.entity(nodeId));connectWays.forEach(function(way){if(!way.isOneRoadCrossWay()){graph=createFullWayNodeMaat(graph,way.id,nodeId)}});return graph}function createFullWayNodeMaat(graph,wayId,nodeId){var node=graph.entity(nodeId);var connectWays=graph.parentWays(node);var isInArray=function(array,element){if(array&&element){for(var i in array){if(array[i].toString()==element.toString()){return true}}}return false};var newNodeMaatWaysId=new Array;connectWays.forEach(function(connectWay){if(!connectWay.isOneRoadCrossWay()){newNodeMaatWaysId.push(connectWay.id)}});var parentRelation=graph.parentRelations(node);var adjoinWayIds=new Array;parentRelation.forEach(function(relation){if(relation.modelName==iD.data.DataType.NODECONN){var from_roadId=relation.memberByRole(iD.data.RoleType.FROAD_ID).id;var to_roadId=relation.memberByRole(iD.data.RoleType.TROAD_ID).id;if(!isInArray(newNodeMaatWaysId,from_roadId)||!isInArray(newNodeMaatWaysId,to_roadId)){var secondRels=graph.parentRelations(relation);secondRels.forEach(function(secondRel){graph=graph.remove(secondRel)});graph=graph.remove(relation)}else if(wayId==from_roadId||wayId==to_roadId){var fromToWaysArr=[from_roadId,to_roadId];if(!isInArray(adjoinWayIds,fromToWaysArr)){adjoinWayIds.push(fromToWaysArr)}}}});newNodeMaatWaysId.forEach(function(newWayId){var newFromToWayArr1=[wayId,newWayId];var newFromToWayArr2=[newWayId,wayId];if(wayId==newWayId){if(!isInArray(adjoinWayIds,newFromToWayArr1)){graph=createNewMaat(graph,wayId,newWayId,nodeId)}}else{if(!isInArray(adjoinWayIds,newFromToWayArr1)){graph=createNewMaat(graph,wayId,newWayId,nodeId)}if(!isInArray(adjoinWayIds,newFromToWayArr2)){graph=createNewMaat(graph,newWayId,wayId,nodeId)}}});return graph}function addNodeMaatForNode(graph,way,node){var isInArray=function(array,element){for(var i in array){if(array[i]==element){return true}}return false};var nodeParentRelation=graph.parentRelations(node);var adjoinWayIds=new Array;if(0!=nodeParentRelation.length){nodeParentRelation.forEach(function(relation){if(relation.modelName==iD.data.DataType.NODECONN){var from_roadId=relation.memberByRole(iD.data.RoleType.FROAD_ID).id;if(!isInArray(adjoinWayIds,from_roadId)){adjoinWayIds.push(from_roadId)}var to_roadId=relation.memberByRole(iD.data.RoleType.TROAD_ID).id;if(!isInArray(adjoinWayIds,to_roadId)){adjoinWayIds.push(to_roadId)}}});for(var i in adjoinWayIds){graph=createNewMaat(graph,adjoinWayIds[i],way.id,node.id);graph=createNewMaat(graph,way.id,adjoinWayIds[i],node.id)}}return graph};function createNewMaat(graph,sWayId,eWayId,nWayId){var nodeMaatMember=[{id:sWayId,role:iD.data.RoleType.FROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD},{id:nWayId,role:iD.data.RoleType.ROAD_NODE_ID,type:iD.data.GeomType.NODE,modelName:iD.data.DataType.ROAD_NODE},{id:eWayId,role:iD.data.RoleType.TROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD}];var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.NODECONN);let layerId=currentLayer.id;var nodeMaatRelations=iD.Relation({tags:iD.util.getDefauteTags(iD.data.DataType.NODECONN,currentLayer),modelName:iD.data.DataType.NODECONN,members:nodeMaatMember,layerId:layerId});nodeMaatRelations=iD.util.tagExtend.updateAcceTagOfNMaat(graph,nodeMaatRelations);graph=graph.replace(nodeMaatRelations);return graph}return topoNodeMaat};;iD.topo.NodeMaatPath=function(){};;iD.topo.NodeRule=function(){};;iD.topo.NodeSaat=function(){var topoNodeSaat={};topoNodeSaat.roadMerge=function(graph,way,wayA,wayB,rel,midNode,crossNodeM,crossNodeS,crossNodeE){var member=rel.memberByRole(iD.data.RoleType.ROAD_ID);var nodeMember=rel.memberByRole(iD.data.RoleType.ROAD_NODE_ID);if(nodeMember.id!=midNode.id){member.id=way.id;rel=rel.updateMember(member,member.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel)}return graph.replace(rel)};topoNodeSaat.break=function(context,graph,way,wayA,wayB,rel){var roadMember=rel.memberByRole(iD.data.RoleType.ROAD_ID);var noadMember=rel.memberByRole(iD.data.RoleType.ROAD_NODE_ID);var wayNodesLength=way.nodes.length;if(!(0==wayNodesLength)){if(roadMember&&noadMember&&noadMember.id==way.nodes[0]&&roadMember.id==way.id){roadMember.id=wayA.id}else if(roadMember&&noadMember&&noadMember.id==way.nodes[wayNodesLength-1]&&roadMember.id==way.id){roadMember.id=wayB.id};};rel=rel.updateMember(roadMember,roadMember.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel);graph=graph.replace(rel);return graph};topoNodeSaat.breakNode=function(graph,node,wayA,wayB,way,context){graph=createNewSaat(graph,wayA.id,node.id);graph=createNewSaat(graph,wayB.id,node.id);return graph};topoNodeSaat.autoCompleteNodeTopo=function(graph,nodeID){graph=createFullNodeSaat(graph,nodeID);return graph};topoNodeSaat.roadIntersect=function(graph,node,oldWays){return graph};topoNodeSaat.topoSplit=function(graph,entityA,entityB,wayId){graph=createFullNodeSaat(graph,entityB.id);graph=createFullNodeSaat(graph,entityA.id);return graph};topoNodeSaat.roadCreate=function(graph,nodeId){graph=createFullNodeSaat(graph,nodeId);return graph};topoNodeSaat.roadCrossEdit=function(graph,node){return graph};topoNodeSaat.crossNodeMerge=function(graph,crossNodeA,crossNodeB){return graph};topoNodeSaat.nodeMerge=function(context,graph,nodeA,nodeB){if(nodeA.isRoadNode()&&nodeB.isRoadNode()){graph.parentRelations(nodeA).forEach(function(rel){if(rel.modelName==iD.data.DataType.NODEINFO){var member=rel.memberByRole(iD.data.RoleType.ROAD_NODE_ID);member.id=nodeB.id;rel=rel.updateMember(member,member.index);rel.tags=iD.util.tagExtend.updateTaskTag(rel);graph=graph.replace(rel)}});return createFullNodeSaat(graph,nodeB.id)}else{return graph}};topoNodeSaat.nodeMove=function(context,graph,node){return graph};function createFullNodeSaat(graph,nodeId){var isInArray=function(array,element){if(array&&element){for(var i in array){if(array[i]==element){return true}}}return false};var node=graph.entity(nodeId);var ways=graph.parentWays(node);var newNodeSaatWayIds=new Array;ways.forEach(function(way){if(!way.isOneRoadCrossWay()){newNodeSaatWayIds.push(way.id)}});var parentRelations=graph.parentRelations(node);var oldNodeSaatWayIds=new Array;parentRelations.forEach(function(relation){if(relation.modelName==iD.data.DataType.NODEINFO){if(!isInArray(newNodeSaatWayIds,relation.memberByRole(iD.data.RoleType.ROAD_ID).id)){graph=graph.remove(relation)}else{relation.tags=iD.util.tagExtend.updateTaskTag(relation);graph=graph.replace(relation);oldNodeSaatWayIds.push(relation.memberByRole(iD.data.RoleType.ROAD_ID).id)}}});newNodeSaatWayIds.forEach(function(newWayId){if(!isInArray(oldNodeSaatWayIds,newWayId)){graph=createNewSaat(graph,newWayId,nodeId)}});return graph}function createNewSaat(graph,wayId,nodeId){var nodeSaatMember=[{id:wayId,role:iD.data.RoleType.ROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD},{id:nodeId,role:iD.data.RoleType.ROAD_NODE_ID,type:iD.data.GeomType.NODE,modelName:iD.data.DataType.ROAD_NODE}];var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.NODEINFO);let layerId=currentLayer.id;var nodeSaatRelations=iD.Relation({modelName:iD.data.DataType.NODEINFO,members:nodeSaatMember,tags:iD.util.getDefauteTags(iD.data.DataType.NODEINFO,currentLayer),layerId:layerId});graph=graph.replace(nodeSaatRelations);return graph};return topoNodeSaat};;iD.topo.RoadCross=function(){};;iD.topo.RoadRule=function(){topoRoadRule={};topoRoadRule.roadMerge=function(graph,way,wayA,wayB,rel){var roadMember=rel.memberByRole(iD.data.RoleType.ROAD_ID);if(roadMember&&(roadMember.id==wayA.id||roadMember.id==wayB.id)){roadMember.id=way.id}rel=rel.updateMember(roadMember,member.index);return graph.replace(rel)};topoRoadRule.break=function(context,graph,way,wayA,wayB,rel){var roadMember=rel.memberByRole(iD.data.RoleType.ROAD_ID);if(roadMember&&roadMember.id==way.id){roadMember.id=wayA.id}rel=rel.updateMember(roadMember,0);graph=graph.replace(rel);graph=topoRoadRule.createNewRoadRule(graph,wayB.id);return graph};topoRoadRule.topoSplit=function(graph,entityA,entityB,way){return graph};topoRoadRule.createNewRoadRule=function(graph,wayId){return graph};return topoRoadRule};;iD.TopoEntity=function(){var topoEntity={};topoEntity.isInCrossNode=function(graph,nodeId){var result=false;var parentRelation=graph.parentRelations(graph.entity(nodeId),iD.data.DataType.R_C_NODE_ROAD_NODE);parentRelation.forEach(function(relation){let members=relation.members;members.forEach(member=>{if(member.modelName==iD.data.DataType.C_NODE){result=member.id}})});return result};topoEntity.getCrossNodeMembers=function(graph,crossId){var result=false;var parentRelation=graph.parentRelations(graph.entity(crossId),iD.data.DataType.R_C_NODE_ROAD_NODE);if(1<parentRelation.length){console.warn("cross:",crossId,"\u5B58\u5728\u591A\u4E2Arelations")}if(1==parentRelation.length){let relation=parentRelation[0];let members=relation.members;result=[];members.forEach(member=>{if(member.modelName!=iD.data.DataType.C_NODE){result.push(member)}})};return result};topoEntity.getRoadCrossByNode=function(graph,nodeId){var result=false;var parentRelation=graph.parentRelations(graph.entity(nodeId),iD.data.DataType.R_C_NODE_ROAD_NODE);parentRelation.forEach(function(relation){let members=relation.members;members.forEach(member=>{if(member.modelName==iD.data.DataType.C_NODE){result=graph.entity(member.id)}})});return result};topoEntity.getRoadIsInCrossParentWaysNum=function(entity,graph){var flag=false;var crossNodeId=topoEntity.isInCrossNode(graph,entity.id);if(crossNodeId){var parentWays=graph.parentWays(entity);var wayCounts=0;for(var i=0;i<parentWays.length;i++){if(parentWays[i].modelName==iD.data.DataType.ROAD)wayCounts++}return wayCounts}return 0};return topoEntity};;;iD.topo.check=function(){var handle={};var displayFlag=true;var nodeCheck=function(graph,entity){var wayArr=[];graph.parentWays(entity).forEach(function(way){if(!way.isOneRoadCrossWay()){wayArr.push(way.id)}});var nodeMaatMap={};for(var i=0;i<wayArr.length;i++){for(var j=0;j<wayArr.length;j++){nodeMaatMap[wayArr[i]+"-"+entity.id+"-"+wayArr[j]]=1}}var nodeSaatMap={};for(var i=0;i<wayArr.length;i++){nodeSaatMap[wayArr[i]+"-"+entity.id]=1}graph.parentRelations(entity).forEach(function(rel){if(rel.modelName==iD.data.DataType.NODECONN){var fromMember=rel.memberByRole(iD.data.RoleType.FROAD_ID);var toMember=rel.memberByRole(iD.data.RoleType.TROAD_ID);var nodeMember=rel.memberByRole(iD.data.RoleType.ROAD_NODE_ID);if(1==nodeMaatMap[fromMember.id+"-"+nodeMember.id+"-"+toMember.id]){nodeMaatMap[fromMember.id+"-"+nodeMember.id+"-"+toMember.id]=0}else{nodeMaatMap[fromMember.id+"-"+nodeMember.id+"-"+toMember.id]=2}}});var flag=true;for(var key in nodeSaatMap){if(1==nodeSaatMap[key]||2==nodeSaatMap[key]){flag=false}}for(var key in nodeMaatMap){if(1==nodeMaatMap[key]||2==nodeMaatMap[key]){flag=false}}if(!flag){console.log("Check node topo error");for(var key in nodeSaatMap){if(1==nodeSaatMap[key]){console.log("\u7F3A\u5C11 NODEINFO:"+key)}else if(2==nodeSaatMap[key]){console.log("\u591A\u4F59 NODEINFO:"+key)}}for(var key in nodeMaatMap){if(1==nodeMaatMap[key]){console.log("\u7F3A\u5C11 nodemaat:"+key)}else if(2==nodeMaatMap[key]){console.log("\u591A\u4F59 nodemaat:"+key)}}}return flag};var walkEnterCheck=function(graph,entity,context){function hasSameRel(arr){var result=[],hash={};function getJointName(rel){var walkEnterMember=rel.memberByRole(iD.data.RoleType.WALKENTER);var highWayMember=rel.memberByRole(iD.data.RoleType.ROAD_ID);var str=walkEnterMember.id+highWayMember.id;return str}for(var i=0,elem;i<arr.length&&null!=(elem=getJointName(arr[i]));i++){if(!hash[elem]){result.push(arr[i]);hash[elem]=true}}if(result.length==arr.length)return false;return true}var str=undefined;var highWays=iD.util.walkExtend().getHighWaysWithFilterBBox(context,0.1,entity);var highWayIDs=[];highWays.forEach(function(highWay){if(highWay.isNaviType()){highWayIDs.push(highWay.id)}});var relations=graph.parentRelations(entity).filter(function(rel){if(rel.modelName==iD.data.DataType.RELWKETROAD){return true}return false});if(hasSameRel(relations)){str="\u6B65\u5BFC\u70B9"+entity.id+"\u4E0E\u9053\u8DEF\u7684\u5173\u7CFB\u5B58\u5728\u91CD\u590D\u5173\u7CFB,\u8BF7\u786E\u8BA4";return str}for(var i=0;i<relations.length;i++){var highWayMember=relations[i].memberByRole(iD.data.RoleType.ROAD_ID);var index=highWayIDs.indexOf(highWayMember.id);if(-1==index){str="\u5B58\u5728\u591A\u4F59\u7684\u6B65\u5BFC\u70B9"+entity.id+"\u4E0E\u9053\u8DEF"+highWayMember.id+"\u7684\u5173\u7CFB";return str}else{highWayIDs.splice(index,1)}}if(0<highWayIDs.length){str="\u6B65\u5BFC\u70B9"+entity.id+"\u76840.1\u7C73\u8303\u56F4\u5185\u5B58\u5728\u4E0D\u5173\u8054\u7684\u884C\u4EBA\u53EF\u901A\u884C\u9053\u8DEF"+highWayIDs}return str};var RoadCrossCheck=function(context,entity){var flag=true;context.graph().parentRelations(entity).forEach(function(rel){if(!flag){return}if(rel.modelName==iD.data.DataType.R_C_NODE_ROAD_NODE){var roadNodes=rel.members.filter(function(m){return m.modelName==iD.data.DataType.ROAD_NODE});if(!iD.util.roadCrossExtend.isUnicomOfArr(_.pluck(roadNodes,"id"),context)){flag=false}}});return flag};var parentCrossNode=function(graph,entity){var crossNode;graph.parentRelations(entity).forEach(function(rel){if(rel.modelName==iD.data.Constant.C_NODE){crossNode=rel}});return crossNode};handle.mainCheck=function(graph,entity,context){var str=undefined;var flag=true;if(entity instanceof iD.Node&&entity.isWalkEnter()){var errMsg=walkEnterCheck(graph,entity,context);if(errMsg!=undefined){return errMsg}}else if(entity instanceof iD.Node&&entity.isRoadNode()){if(!nodeCheck(graph,entity)){flag=false}var crossNode=parentCrossNode(graph,entity);if(crossNode&&!RoadCrossCheck(context,crossNode)){flag=false}}else if(entity instanceof iD.Node&&entity.isRoadCross()){if(!RoadCrossCheck(context,entity)){flag=false}}else if(entity instanceof iD.Way&&entity.modelName==iD.data.DataType.HIGHWAY){if(!nodeCheck(graph,graph.entity(entity.nodes[0]))){flag=false}if(!nodeCheck(graph,graph.entity(entity.nodes[entity.nodes.length-1]))){flag=false}var crossNodeA=parentCrossNode(graph,graph.entity(entity.nodes[0]));if(crossNodeA&&!RoadCrossCheck(context,crossNodeA)){flag=false}var crossNodeB=parentCrossNode(graph,graph.entity(entity.nodes[entity.nodes.length-1]));if(crossNodeA&&crossNodeB&&crossNodeA.id==crossNodeB.id){}else if(crossNodeB){if(crossNodeB&&!RoadCrossCheck(context,crossNodeB)){flag=false}}}if(!flag&&displayFlag){displayFlag=false}if(!flag){str="Topo\u68C0\u67E5\u53D1\u73B0\u9519\u8BEF:"+entity.id+" datatype:"+entity.modelName;console.warn("Topo\u68C0\u67E5\u53D1\u73B0\u9519\u8BEF:"+entity.id+" datatype:"+entity.modelName)}return str};return handle};;iD.topo.RelWketRoad=function(){var topoRelWketRoad={};topoRelWketRoad.roadMerge=function(graph,way,wayA,wayB,rel,midNode,crossNodeM,crossNodeS,crossNodeE){var members=rel.members;members.forEach(function(member){if(member.id==wayA.id||member.id==wayB.id){member.id=way.id;rel=rel.updateMember(member,member.index)}});return graph.replace(rel)};topoRelWketRoad.break=function(context,graph,way,wayA,wayB,relation){var walkEnterMember=relation.memberByRole(iD.data.RoleType.WALKENTER);var highWayMember=relation.memberByRole(iD.data.RoleType.ROAD_ID);var walkEnter=graph.entity(walkEnterMember.id);var distanceA=iD.util.slopExtend.getDisBetPointAndWay(walkEnter,wayA,graph);var distanceB=iD.util.slopExtend.getDisBetPointAndWay(walkEnter,wayB,graph);if(distanceA<distanceB){highWayMember.id=wayA.id}else{highWayMember.id=wayB.id}relation=relation.updateMember(highWayMember,highWayMember.index);graph=graph.replace(relation);return graph};topoRelWketRoad.breakNode=function(graph,node,wayA,wayB,way,context){var navitypeArr=["0","1","4","5"];var navitype=way.tags.navitype;var loc=node.loc;if(-1<navitypeArr.indexOf(navitype)){var distance=0.000001,walkEnterArr=[];var loc1=[loc[0]-distance,loc[1]-distance];var loc2=[loc[0]+distance,loc[1]+distance];var bbox=[loc1,loc2];var all=context.intersects(bbox);all.forEach(function(entity){if(entity instanceof iD.Node&&entity.modelName==iD.data.DataType.WALKENTER){graph=iD.actions.CreateRelWketRoad(entity.id,wayA.id);graph=iD.actions.CreateRelWketRoad(entity.id,wayB.id)}})}return graph};topoRelWketRoad.breakWalkEnter=function(graph,node,wayA,wayB,way,context){var connectedIDS=walkEnterProcess(node.loc,context);function isUniqueRel(node,connectedID){var relations=graph.parentRelations(node);for(var i=0;i<relations.length;i++){var nodeId=relations[i].memberByRole(iD.data.RoleType.WALKENTER).id;var roadId=relations[i].memberByRole(iD.data.RoleType.ROAD_ID).id;if(node.id==nodeId&&connectedID==roadId){return false}}return true}connectedIDS.forEach(function(connectedID){if(isUniqueRel(node,connectedID)){graph=createNewRelWketRoad(graph,node.id,connectedID)}});function walkEnterProcess(loc,context){var graph=context.graph();var distance=0.000001,highwaysArr=[];var loc1=[loc[0]-distance,loc[1]-distance];var loc2=[loc[0]+distance,loc[1]+distance];var bbox=[loc1,loc2];var all=context.intersects(bbox);all.forEach(function(entity){if(entity instanceof iD.Way&&entity.modelName==iD.data.DataType.HIGHWAY){highwaysArr.push(entity)}});var navitypeArr=["0","1","4","5"];var selectedIDS=[],highlightIDS=[];for(var i=0;i<highwaysArr.length;i++){var navitype=highwaysArr[i].tags.navitype;if(-1<navitypeArr.indexOf(navitype)){selectedIDS.push(highwaysArr[i].id)}else{highlightIDS.push(highwaysArr[i].id)}}if(0==highwaysArr.length)return[];if(0==selectedIDS.length){Dialog.alert("\u8282\u70B9\u8FDE\u63A5\u5747\u4E3A\u975E\u884C\u4EBA\u53EF\u901A\u884C\u9053\u8DEF\uFF0C\u4E0D\u80FD\u5173\u8054\uFF01");return[]}else if(selectedIDS.length!=highwaysArr.length){Dialog.alert("\u5B58\u5728\u975E\u884C\u4EBA\u53EF\u901A\u884C\u9053\u8DEF\uFF0C\u53EA\u4E0E\u9664\u5176\u4EE5\u5916\u7684\u9053\u8DEF\u5173\u8054\uFF01");context.surface().selectAll(iD.util.entityOrMemberSelector(highlightIDS,context.graph())).classed("selected",true);return selectedIDS}else{return selectedIDS}}return graph};topoRelWketRoad.roadIntersect=function(graph,nodesArr,oldWays){return graph};topoRelWketRoad.topoSplit=function(graph,entityA,entityB,wayId){return graph};topoRelWketRoad.waklroadCreate=function(graph,walkenterId,entityId){function isUniqueRel(node,connectedID){var relations=graph.parentRelations(node);for(var i=0;i<relations.length;i++){var nodeId=relations[i].memberByRole(iD.data.RoleType.WALKENTER).id;var roadId=relations[i].memberByRole(iD.data.RoleType.ROAD_ID).id;if(node.id==nodeId&&connectedID==roadId){return false}}return true}function selectElements(){editor.context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,editor.context.graph())).classed("selected",true)}var entity=graph.entity(entityId);if(entity instanceof iD.Way&&entity.modelName==iD.data.DataType.HIGHWAY){if("2"==entity.tags.navitype||"3"==entity.tags.navitype||"6"==entity.tags.navitype||"7"==entity.tags.navitype){Dialog.alert("\u975E\u884C\u4EBA\u53EF\u901A\u884C\u9053\u8DEF\uFF0C\u4E0D\u80FD\u5173\u8054\uFF01")}else{if(isUniqueRel(editor.context.graph().entity(walkenterId),entityId)){graph=createNewRelWketRoad(graph,walkenterId,entityId)}}}else if(entity instanceof iD.Node){var highWays=graph.parentWays(entity);var highLightIds=[];highWays.forEach(function(highWay){if("2"==highWay.tags.navitype||"3"==highWay.tags.navitype||"6"==highWay.tags.navitype||"7"==highWay.tags.navitype){highLightIds.push(highWay.id)}else{if(isUniqueRel(editor.context.graph().entity(walkenterId),entityId)){graph=createNewRelWketRoad(graph,walkenterId,highWay.id)}}})}if("undefined"!=typeof highLightIds&&""!=highLightIds){if(0!=highLightIds.length&&highLightIds.length==highWays.length){Dialog.alert("\u8282\u70B9\u8FDE\u63A5\u5747\u4E3A\u975E\u884C\u4EBA\u53EF\u901A\u884C\u9053\u8DEF\uFF0C\u4E0D\u80FD\u5173\u8054\uFF01")}else if(0!=highLightIds.length&&highLightIds.length!=highWays.length){Dialog.alert("\u5B58\u5728\u975E\u884C\u4EBA\u53EF\u901A\u884C\u9053\u8DEF\uFF0C\u53EA\u4E0E\u9664\u5176\u4EE5\u5916\u7684\u9053\u8DEF\u5173\u8054\uFF01");editor.context.map().on("drawn.select",selectElements);selectElements()}}return graph};topoRelWketRoad.roadCrossEdit=function(graph,node){return graph};topoRelWketRoad.crossNodeMerge=function(graph,crossNodeA,crossNodeB){return graph};topoRelWketRoad.nodeMerge=function(context,graph,nodeA,nodeB){if(nodeA.isWalkEnter()&&nodeB.isWalkEnter()){graph=this.nodeMove(context,graph,nodeB);return graph}return graph};topoRelWketRoad.nodeMove=function(context,graph,node){if(node.isWalkEnter()){var highWays=iD.util.walkExtend().getHighWaysWithFilterBBox(context,0.1,node);var highWayIds=[];highWays.forEach(function(way){if(way.isNaviType()){highWayIds.push(way.id)}});var relHighWayIds=[];var delRels=[];graph.parentRelations(node).forEach(function(rel){if(iD.data.DataType.RELWKETROAD==rel.modelName){var roadId=rel.memberByRole(iD.data.RoleType.ROAD_ID).id;if(-1==highWayIds.indexOf(roadId)){delRels.push(rel)}else{highWayIds.splice(highWayIds.indexOf(roadId),1)}}});delRels.forEach(function(rel){graph=graph.remove(rel)});highWayIds.forEach(function(wayid){graph=createNewRelWketRoad(graph,node.id,wayid)})}return graph};function getAllWalkEnterRelWayIds(graph,node){var wayIds=[];graph.parentRelations(node).forEach(function(rel){if(iD.data.DataType.RELWKETROAD==rel.modelName){var roadId=rel.memberByRole(iD.data.RoleType.ROAD_ID).id;wayIds.push(roadId)}})}function createNewRelWketRoad(graph,walkenterId,highwayId){var Members=[{id:walkenterId,role:"walkenter",type:"WalkEnter"},{id:highwayId,role:"road",type:"Highway"}];var layers=iD.Layers;var currentLayer=layers.getLayer();var relation=iD.Relation({members:Members,layerId:currentLayer.id});graph=graph.replace(relation);return graph}return topoRelWketRoad};;iD.topo.WalkZlevel=function(){var topoWalkZlevel={};topoWalkZlevel.roadMerge=function(graph,way,wayA,wayB,rel,midNode,crossNodeM,crossNodeS,crossNodeE){var members=rel.members;members.forEach(function(member){if(member.id==wayA.id||member.id==wayB.id){member.id=way.id;rel=rel.updateMember(member,member.index)}});return graph.replace(rel)};topoWalkZlevel.break=function(context,graph,way,wayA,wayB,rel){return graph};topoWalkZlevel.autoCompleteNodeTopo=function(graph,nodeID){return graph};topoWalkZlevel.roadIntersect=function(graph,nodesArr,oldWays){return graph};topoWalkZlevel.topoSplit=function(graph,entityA,entityB,wayId){return graph};topoWalkZlevel.roadCreate=function(graph,nodeId){return graph};topoWalkZlevel.roadCrossEdit=function(graph,node){return graph};topoWalkZlevel.crossNodeMerge=function(graph,crossNodeA,crossNodeB){return graph};topoWalkZlevel.nodeMerge=function(context,graph,nodeA,nodeB){return graph;var that=this;graph.parentWays(nodeA).forEach(function(way){graph=that.roadModify(graph,way)});return graph};topoWalkZlevel.nodeMove=function(context,graph,node){var that=this;graph.parentWays(node).forEach(function(way){graph=that.roadModify(graph,way)});return graph};topoWalkZlevel.roadModify=function(graph,way){var zlevels=way.getWalkZlevel(graph);zlevels.forEach(function(zlevel){var members=zlevel.members;if(2==members.length){var firstWay=graph.entity(members[0].id);var secondWay=graph.entity(members[1].id);var lineCalute=iD.util.LineCalCulate();var locs=lineCalute.getIntersectLoc(firstWay.getNodes(),secondWay.getNodes(),graph);if(0<locs.length){graph=graph.replace(zlevel.move(locs))}else{graph=graph.remove(zlevel)}}});return graph};return topoWalkZlevel};;;;(function(iD){var walkLinkDirectionFlag=false;iD=iD||{};iD.WalkLinkDirection={getWalkLinkDirection:function(){return walkLinkDirectionFlag},changeWalkLinkDirection:function(){if(true==walkLinkDirectionFlag)walkLinkDirectionFlag=false;else{walkLinkDirectionFlag=true}}}})(iD);;;;;(function(iD){var adasRoads=[];var dispatch=d3.dispatch("addAdaRoad");iD=iD||{};iD.Adas={dispatch:dispatch,isAdasRoad:function(id){var res=true;adasRoads.forEach(function(roadId){if(id==roadId){res=false}});return res},addAdaRoad:function(ids){for(var i=0;i<ids.length;i++){if(this.isAdasRoad(ids[i])){adasRoads.push(ids[i])}}},getAdasRoads:function(){return adasRoads},resertAdasRoads:function(){adasRoads=[]}};d3.rebind(iD.Adas,dispatch,"on")})(iD);;;;;(function(iD){var roles=[{id:[100101,100103],classes:1,role:"work"},{id:[100102,100104],classes:1,role:"check"},{id:[100501,100503],classes:5,role:"work"},{id:[100502,100504],classes:5,role:"check"},{id:[100201,100203],classes:2,role:"work"},{id:[100202,100204],classes:2,role:"check"},{id:[100505,100507],classes:5,role:"work"},{id:[100506,100508],classes:5,role:"check"},{id:[100000],classes:1,role:"admin"}];var ROLE={MANAGER:"Manager",SURVEY:"survey",RECOGNITION:"rec",TRADITIONALEDIT:"sdEdit",FUSION:"fusion",EDIT:"edit",EDIT_CHECK:"edit_check",IMAGE_TAG:"tag_select",AUDIT:"audit",VERIFY:"verify",WORK:"work",CHECK:"check",LINE_WORKER:"LinearWork",LINE_CHECKER:"LinearCheck"};function isRoleAuth(roleName){var user=iD.User.getInfo();if(!user){return false}var arr=user.authorities||[];for(var i in arr){var item=arr[i];if(item&&item.authority==roleName){return true}}return false}function isAuthManager(){var user=iD.User.getInfo();if(!user){return false}return user.authorities==undefined||isRoleAuth(ROLE.MANAGER)}var dispatch=d3.dispatch("login","logout","error","dvr");function post(url,data,callback){var formData=[];for(var field in data){formData.push(field+"="+data[field])}data=formData.join("&");d3.json(url).header("Content-Type","application/x-www-form-urlencoded").post(data,function(error,data){if(error||!data.result){var error=error&&JSON.parse(error.response)||"\u7528\u6237\u540D\u5BC6\u7801\u9519\u8BEF";dispatch.error(error);return}callback(data)})}iD=iD||{};iD.User={_info:{},_urlTaskIsEnter:false,isOauthLogin:true,dispatch:dispatch,getInfo:function(){if(this._info.username){return this._info}return false},login:function(username,password,callback){var _self=this;if(!_self.isOauthLogin){var userInfo=this.getInfo();if(this.getInfo()&&userInfo.username==username){dispatch.login(_self._info);callback&&callback(_self._info);return}var url=iD.config.URL.kus+"user/login?";post(url,{username:username,password:password},function(data){var result=data.result;_self._info={roleid:100101,role:"role",username:result.username,userid:result.userId,userId:result.userId};Object.assign(_self._info,data.result);iD.util.parse2SystypeParam();dispatch.login({})})}else{if(_self._info){dispatch.login(_self._info);iD.util.parse2SystypeParam()}}},logout:function(callback){var _self=this;if(!_self.isOauthLogin){if(!this.getInfo()){return}var url=iD.config.URL.kus+"/logout";var token=this.getInfo().token;iD.util.cookie.removeItem("token");callback&&callback()}else{d3.json(iD.config.URL.kd_auth_server+"logout").get(function(error,data){self._info=null;oAuthLoginPage()})}},getRole:function(){var id=this.getInfo().roleid;id=parseInt(id,10);for(var i=0,len=roles.length;i<len;i++){if(-1!==roles[i].id.indexOf(id)){return roles[i]}}},_oauthLogin:function(data,callback){var _self=this;var userInfo=this.getInfo();if(userInfo){var urlTaskid=iD.url.getUrlParam("taskID");if(!urlTaskid){setTimeout(function(){dispatch.login(userInfo)},500)}return}if(!data){return}var principal=data.principal||{};var _self=iD.User;_self._info={roleid:100101,role:"role",username:principal.username,userId:principal.userId,userid:principal.userId,authorities:principal.authorities||[]};iD.util.parse2SystypeParam()},isAuditRole:function(){return isRoleAuth(ROLE.AUDIT)},isVerifyRole:function(){return isRoleAuth(ROLE.VERIFY)},isWorkRole:function(){return isRoleAuth(ROLE.WORK)||this.isLineWorkRole()},isCheckRole:function(){return isRoleAuth(ROLE.CHECK)||this.isLineCheckRole()},isLinearRole:function(){return this.isLineWorkRole()||this.isLineCheckRole()},isLineWorkRole:function(){return isRoleAuth(ROLE.LINE_WORKER)},isLineCheckRole:function(){return isRoleAuth(ROLE.LINE_CHECKER)},isFusionRole:function(){return this.isWorkRole()},isEditRole:function(){return this.isWorkRole()},isManagerRole:function(){return false},isRecognitionRole:function(){return false},isTraditionalEditRole:function(){return isRoleAuth(ROLE.TRADITIONALEDIT)},isSurveyRole:function(){return false},isEditCheckRole:function(){return this.isCheckRole()||this.isVerifyRole()},isEditCheckSystemAndRole:function(){return this.isCheckRole()||this.isVerifyRole()},isImageTagRole:function(){return this.isCheckRole()||this.isVerifyRole()},isAnalysisTagRole:function(){return this.isCheckRole()},isMultiBatchesRole:function(){return this.isAuditRole()||this.isLineWorkRole()||this.isLineCheckRole()},authEditSave:function(){return this.isAuditRole()||this.isWorkRole()||this.isCheckRole()||this.isVerifyRole()||this.isLinearRole()},authQueryTag:function(){return this.isAuditRole()||this.isWorkRole()||this.isCheckRole()||this.isVerifyRole()||this.isLinearRole()},authTrail:function(){return true},authTrailPicture:function(){return true},authTrailIdentify:function(){return true},authTrailDraw:function(){return true},authCheckReportForm:function(){return true},authCheckResultHandle:function(){return true},authCheckTrigger:function(){return true}};var ouc={user:null,oauth2User:function(){return iD.config.URL.kd_auth_server},clientId:"client",clientSecret:"secret",tokenKey:"utoken",tokenExpiresKey:"utoken_expires",tokenName:"utoken_name",tokenDomain:function(){var domain="";domain=location.hostname;return domain}(),_cookie:function(key,value,expires){if(!$.cookie){return null}var result=null;if(null==value&&null==expires){result=$.cookie(key);if(!isNotNull(result)||"null"===(""+result).toLocaleLowerCase()){this._cookie(key,null,-1)}}else{if(null==expires||-1==expires){expires=24*(60*(60*-1))}expires=parseInt(expires);expires=this.getTimezoneDate(expires);result=$.cookie(key,value||"",{domain:this.tokenDomain,path:"/",expires:expires})}return result},tokenCookie:function(value,expires){return this._cookie(this.tokenKey,value,expires)},timeCookie:function(value,expires){return this._cookie(this.tokenExpiresKey,value,expires)},nameCookie:function(value,expires){return this._cookie(this.tokenName,value,expires)},getTimezoneDate:function(expiresSec,isadd){if(null==isadd){isadd=true}var expires=null;if(isadd){expires=new Date(new Date().getTime()+1000*expiresSec)}else{expires=new Date(1000*expiresSec)}var date=expires;return date},_logout:function(){this.tokenCookie(null,-1);this.timeCookie(null,-1);this.nameCookie(null,-1);this.user=null;_renderUserHtml&&_renderUserHtml()},_loginPage:function(path){$.oauth2Client.begin({authorizeUrl:ouc.oauth2User()+"oauth/authorize",clientId:ouc.clientId,redirectUri:path||getNoHashUrl()})}};function getNoSearchUrl(){return window.location.origin+window.location.pathname}function getNoHashUrl(){return window.location.href.split("#")[0]}function isNotNull(str){return null!=str&&""!=$.trim(str)}function oAuthLoginPage(){var url=window.location.href;var codeReg=/&code=[^&#]*|&{0}code=[^&#]*&?/g;ouc._loginPage(url.replace(codeReg,""))}iD.User.checkUserLoginStatus=function(){var self=this;if(self.isOauthLogin){d3.json(iD.config.URL.kd_auth_server+"user").get(function(error,data){if(!data){oAuthLoginPage();return}iD.User._oauthLogin(data)})}};d3.rebind(iD.User,dispatch,"on")})(iD);;;var hexcase=0;var b64pad="";var chrsz=8;iD.User.MD5=function(s){return hex_md5(s)};function hex_md5(s){return binl2hex(core_md5(str2binl(s),s.length*chrsz))}function b64_md5(s){return binl2b64(core_md5(str2binl(s),s.length*chrsz))}function str_md5(s){return binl2str(core_md5(str2binl(s),s.length*chrsz))}function hex_hmac_md5(key,data){return binl2hex(core_hmac_md5(key,data))}function b64_hmac_md5(key,data){return binl2b64(core_hmac_md5(key,data))}function str_hmac_md5(key,data){return binl2str(core_hmac_md5(key,data))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc")}function core_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function core_hmac_md5(key,data){var bkey=str2binl(key);if(16<bkey.length)bkey=core_md5(bkey,key.length*chrsz);var ipad=Array(16),opad=Array(16);for(var i=0;16>i;i++){ipad[i]=909522486^bkey[i];opad[i]=1549556828^bkey[i]}var hash=core_md5(ipad.concat(str2binl(data)),512+data.length*chrsz);return core_md5(opad.concat(hash),512+128)}function safe_add(x,y){var lsw=(65535&x)+(65535&y);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|65535&lsw}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}function str2binl(str){var bin=Array();var mask=(1<<chrsz)-1;for(var i=0;i<str.length*chrsz;i+=chrsz)bin[i>>5]|=(str.charCodeAt(i/chrsz)&mask)<<i%32;return bin}function binl2str(bin){var str="";var mask=(1<<chrsz)-1;for(var i=0;i<32*bin.length;i+=chrsz)str+=String.fromCharCode(bin[i>>5]>>>i%32&mask);return str}function binl2hex(binarray){var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var str="";for(var i=0;i<4*binarray.length;i++){str+=hex_tab.charAt(15&binarray[i>>2]>>8*(i%4)+4)+hex_tab.charAt(15&binarray[i>>2]>>8*(i%4))}return str}function binl2b64(binarray){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var str="";for(var i=0;i<4*binarray.length;i+=3){var triplet=(255&binarray[i>>2]>>8*(i%4))<<16|(255&binarray[i+1>>2]>>8*((i+1)%4))<<8|255&binarray[i+2>>2]>>8*((i+2)%4);for(var j=0;4>j;j++){if(8*i+6*j>32*binarray.length)str+=b64pad;else str+=tab.charAt(63&triplet>>6*(3-j))}}return str};;var cache;try{cache=JSON.parse(localStorage.getItem("unc"))||[]}catch(e){cache=[]}iD.UsernameCache={_cache:cache,push:function(username){var cache=this._cache;cache.forEach(function(value,index){if(value===username){cache.splice(index,1);return}});if(5<=cache.length){var cache=cache.slice(0,4)}cache.unshift(username);try{localStorage.setItem("unc",JSON.stringify(cache))}catch(e){}},search:function(key){var cache=this._cache;return cache.filter(function(item){if(item&&0===item.indexOf(key)){return true}})}};iD.User.on("login.usernamecache",function(){var username=iD.User.getInfo().username;iD.UsernameCache.push(username)});;;;;(function(iD){iD=iD||{};var TASK_STATUS={CREATE:1,ASSIGN:5,EDIT:10,CHECKING:15,CHECKED:20,SUBMITED:25};var QC_TASK_STATUS={CREATED:0,UNDISPATCHED:1,DISPATCHED:5,STARTED:10,END:100};var defaultStatus={task:[TASK_STATUS.ASSIGN,TASK_STATUS.EDIT,TASK_STATUS.CHECKING,TASK_STATUS.CHECKED,TASK_STATUS.SUBMITED],qc:[QC_TASK_STATUS.DISPATCHED,QC_TASK_STATUS.STARTED]};var paramsMap={task:{status:"taskstatus",userid:"userID",taskid:"taskID",transid:"transID"},qc:{status:"qc_status",userid:"qc_userid",classes:"task_classes",rate:"qc_rate",taskid:"task_id",transid:"trans_id",id:"qc_id",result:"qc_result"}};var request=function(url,callback,message){message=message||"\u6B63\u5728\u53D1\u9001\u8BF7\u6C42";var loading=iD.ui.Loading(iD.User.context).message(message).blocking(true);iD.User.context.container().call(loading);var systype=iD.util.urlParamSystemType();var d=url,bodyParam;if(_.isObject(d)){url=d.url;if(d.bodyParam){bodyParam=d.bodyParam}}if(_.isObject(bodyParam)){d3.json(url).header("Content-Type","application/json;charset=UTF-8").post(JSON.stringify(bodyParam),function(error,data){loading.close();if(error){Dialog.alert("\u4EFB\u52A1\u5E73\u53F0\u670D\u52A1\u65E0\u54CD\u5E94\uFF0C\u8BF7\u91CD\u8BD5");return}callback(data)});return}d3.json(url,function(error,data){loading.close();if(error){Dialog.alert("\u4EFB\u52A1\u5E73\u53F0\u670D\u52A1\u65E0\u54CD\u5E94\uFF0C\u8BF7\u91CD\u8BD5");return}callback(data)})};var makeRequestUrl=function(type,path,params){if(!iD.User.getInfo()){Dialog.alert("not login");return}var map=paramsMap[type]||"task";var url=iD.config.URL.kts+"task/queryforTypeAndUser/"+type+"/"+path+"?";var arr=[];if(!params["userid"]){params["userid"]=iD.User.getInfo().userid}for(var param in params){var key=map[param];if(key){arr.push(key+"="+params[param])}}return url+arr.join("&")};var dispatch=d3.dispatch("start","afterget","restore","finish");var currentDetail;iD.Task={tasks:[],dispatch:dispatch,_type:"work",TASK_STATUS:TASK_STATUS,QC_TASK_STATUS:QC_TASK_STATUS,setType:function(type){this._type=type},dbCode:function(batch){var result="";if(batch){result=iD.config.batchDbCode[batch]||"fusion"}return result||iD.Task.d&&iD.Task.d.tags.dbCode||"fusion"},taskId:function(batch){var btaskid="";if(batch){btaskid=batch.split(/[-_]/)[0]}var taskid=iD.Task.d&&(iD.Task.d.task_id||iD.Task.d.tags.taskId);return btaskid||taskid||""},getOne:function(index){return this.tasks[index]},removeOne:function(index){this.tasks.splice(index,1)},editBatchs:function(){return _.difference(iD.config.taskBatch,this.sourceBatchs(),this.compareBatchs())},sourceBatchs:function(){var batch=iD.Task.d&&iD.Task.d.tags.multiSourceBatchs;if(batch)return batch.split(",");return[]},compareBatchs:function(){var batch=iD.Task.d&&iD.Task.d.tags.compareBatch;if(batch)return batch.split(",");return[]},get:function(status,callback){if("function"===typeof status){callback=status;status=defaultStatus[this._type].join(",")}var self=this;self.getTaskDataList(function(tasks){self.tasks=tasks;dispatch.afterget(tasks)})},refreshTaskData:function(callback){var self=this;var oldTask=iD.Task.d;var taskList=[];oldTask&&taskList.push(oldTask);self.getTaskDataList(function(tasks){taskList.push(...tasks.filter(d=>!oldTask||d.task_id!=oldTask.task_id));self.tasks=taskList;callback&&callback(self.tasks)})},getTaskDataList:function(callback){var self=this;var tasks=[];var username=iD.User.getInfo().username;var param={includeProcessVariables:true,size:100,sort:"createTime",order:"desc",assignee:username};var isReset="true"==iD.url.getUrlParam("reset");var urlTrackIds=iD.url.getUrlParam("trackIds")||"";var url;if(7==window._systemType){delete param.assignee;var userType=iD.url.getUrlParam("user_type");var keyLike="SetTrackParameters";var userTypeKeyName;userTypeKeyName="assignee";if("1"==userType){userTypeKeyName="assignee"}else if("2"==userType){userTypeKeyName="involvedUser"}param[userTypeKeyName]=username;param.taskDefinitionKey=keyLike;url=iD.config.URL.kts+"runtime/tasks?"+iD.util.parseParam2String(param)}else{url=iD.config.URL.kts+"runtime/tasks?"+iD.util.parseParam2String(param)}var history=iD.util.urlParamHistory();var task_id=iD.url.getUrlParam("taskID");if(history){var url=iD.config.URL.kts+"history/historic-process-instances?includeProcessVariables=true";if(task_id){url+="&businessKey="+task_id}}if(iD.util.isLocateTrackPointUrl()){var url=iD.config.URL.kts+"history/historic-process-instances?includeProcessVariables=true";if(task_id){url+="&businessKey="+task_id}}request(url,function(data){let tflag=true;if(data.error){tflag=false}else if(null!=data.code&&"0"!=data.code){tflag=false}else if(!data.data){tflag=false}if(tflag){if(history&&task_id){data.data=data.data.length&&data.data.splice(0,1)||[]}data.data.forEach(function(d){d.variables=d.variables||[];d.tags={};for(var i in d.variables){var item=d.variables[i];if(item.name){d.tags[item.name]=item.value||""}}d.range=d.tags.range||"";d.bounds=d.tags.bounds||"";if(isReset&&urlTrackIds){d.tags.trackIds=urlTrackIds}let bounds,range;if(d.bounds){range=wkx.Geometry.parse(d.range).toGeoJSON();bounds=d.bounds.split(",");bounds=[[+bounds[0],+bounds[1]],[+bounds[2],+bounds[3]]]}var temp={chk_status:0,task_status:1,range,bounds,task_id:parseInt(d.tags.taskId),cli_desc:d.tags.taskName||"",task_classes:1,basic_data_type:"",tags:d.tags,protoData:d};tasks.push(temp)});callback&&callback(tasks)}})},start:function(task_id,trans_id,callback){if("qc"===this._type){return}var self=this;var url=makeRequestUrl(this._type,"open.do",{taskid:task_id,transid:trans_id});request(url,function(data){self.tasks.forEach(function(ele,index){if(ele.task_id==task_id){self.tasks[index].task_status=data.task_status}});callback&&callback(data)},"\u6B63\u5728\u5F00\u59CB\u4EFB\u52A1")},submit:function(params,callback){var self=this;var url=makeRequestUrl(this._type,"submit.do",params);request(url,function(data){self.tasks.forEach(function(ele,index){if(ele.task_id==params.taskid){self.tasks[index].task_status=TASK_STATUS.SUBMITED}});callback&&callback(data)},"\u6B63\u5728\u63D0\u4EA4\u4EFB\u52A1")},order:function(){var currentEditTask=this.working;if(!currentEditTask){return}var index=_.findIndex(this.tasks,function(task){return task.task_id===currentEditTask.task_id});if(0<index){var temp=this.tasks.splice(index,1);delete temp._index;this.d._index=0;this.tasks.unshift(temp[0])}}};Object.defineProperty(iD.Task,"working",{get:function(){return currentDetail},set:function(value){currentDetail=value;try{localStorage.setItem("d",JSON.stringify(value))}catch(e){}}});iD.User.on("login.task",function(){var role=iD.User.getRole().role;var type="check"===role?"qc":"task";iD.Task.setType(type)});d3.rebind(iD.Task,dispatch,"on");iD.Task.on("finish.autoCheck",function(task_id){iD.Task.tasks.forEach(function(d){if(d.task_id==task_id)d.chk_status=0})})})(iD);;;;;(function(iD){iD=iD||{};var layer_check_list={NODE:iD.data.Constant.ROADNODE,CROSS:iD.data.Constant.C_NODE,REL_CROSS_NODE:"RoadNode",REL_N_MAAT:"NodeMaat",REL_C_MAAT:"CrossMaat",SAPA:"Sapa",ZLEVEL:"ZLevel",PLACE_NAME:"PlaceName",FORBID_INFO:"ForbidInfo",FORBID_INFO_C:"ForbidInfoC",TURN_GUIDANCE:"TurnGuidance",REL_N_SAAT:"NODEINFO",REL_C_SAAT:"C_NODEINFO",ROAD_RULE:"RoadRule"};iD.Check={startCheck:function(taskId,transId,callback){var self=this;if(!iD.User.getInfo()){console.error("not login");return}var WS=iD.Service.WS;WS.send("check","userID="+iD.User.getInfo().userid+"&transID="+transId+"&taskID="+taskId);WS.on("check",function(d){callback(d)})},startCheck2:function(taskId,transId,callback){if(!iD.User.getInfo()){console.error("not login");return}var url=iD.config.URL.gts_url+"/task/autocheck.do?userID="+iD.User.getInfo().userid+"&transID="+transId+"&taskID="+taskId;return d3.json(url,function(error,data){var msg="";if(error){msg="\u8C03\u7528\u81EA\u68C0\u670D\u52A1\u5931\u8D25\u3002";console.error(msg)}else if(data&&0!=data.status){msg=data.desc;console.error(msg)}else if(data.chk_trans_id&&data.chk_trans_id){iD.Task.d.chk_trans_id=data.chk_trans_id;iD.Task.working.chk_trans_id=data.chk_trans_id}callback&&callback(msg)})},updateReport:function(task,report,rptId,status){var report_status=[{rep_id:parseInt(rptId),chk_id:report.chk_id,err_id:report.err_id,status:parseInt(status),layer:report.layer,feat_id:parseInt(report.ID),reason:""}];JSON.stringify();var url=iD.config.URL.chk_url+"/update_report_status?trans_id="+task.chk_trans_id+"&report_status="+JSON.stringify(report_status);d3.json(url).post()},checkReport:function(context,msg){if(!iD.reports)return true;for(var i in iD.reports){if(0==iD.reports[i].status){Dialog.alert(msg);return false}}return true},lightEntity:function(context,report){var layers=iD.config.allLayerIds,ids=[],reportId;if("object"==typeof report.ext_info&&"undefined"!=typeof report.ext_info.id_locate){reportId=report.ext_info.id_locate}else{reportId=report.ID}for(var i in layers){ids.push("w"+layers[i]+"_"+reportId);ids.push("n"+layers[i]+"_"+reportId)}try{if(!report.x||!report.y){console.warn("\u62A5\u544A\u7ECF\u5EA6\u3001\u7EF4\u5EA6\u6570\u636E\u4E0D\u6B63\u786E\uFF0Cx="+report.x+",y="+report.y+",\u65E0\u6CD5\u5B9A\u4F4D\u3002");return}var loc=[report.x,report.y];context.map().center(loc);for(var i in ids){editor.lightEntity(ids[i])}}catch(e){}}}})(iD);;;;;(function(){iD.Service=iD.Service||{}})();;;iD.Static=iD.Static||{};iD.Static.fusionMoreLayers=true;iD.Static.defaultResource={name:"\u5E95\u56FE\u5C42",children:[{type:"Map",name:"\u5730\u56FE",event:"background",unique:"background",display:false,children:[],action:[]},{type:"wms",name:"\u5F71\u50CF",event:"background",unique:"background",display:false,children:[],action:[]},{type:"mapbox",name:"mapbox",event:"background",unique:"background",display:false,children:[],action:[]},{type:"google",name:"Google",event:"background",unique:"background",display:false,children:[],action:[]},{type:"meshWms",name:"\u56FE\u5E45\u53F7",event:"tag",display:false,children:[],action:[]},{type:"pic",name:"\u8F68\u8FF9",display:true,children:[],action:[]}]};iD.Static.fusionModels=[iD.data.DataType.C_NODE,iD.data.DataType.ROAD_NODE,iD.data.DataType.R_C_NODE_ROAD_NODE,iD.data.DataType.ROAD,iD.data.DataType.C_NODECONN,iD.data.DataType.NODECONN,iD.data.DataType.C_TRAFFICRULE,iD.data.DataType.TRAFFICRULE,iD.data.DataType.TURN_GUIDANCE,iD.data.DataType.C_NODEINFO,iD.data.DataType.NODEINFO,iD.data.DataType.C_LANEINFO,iD.data.DataType.LANEINFO,iD.data.DataType.ROAD_ATTRIBUTE,iD.data.DataType.R_ROAD_RA,iD.data.DataType.R_ROAD_DIVIDER,iD.data.DataType.DIVIDER,iD.data.DataType.R_DIVIDER_DREF,iD.data.DataType.DIVIDER_NODE,iD.data.DataType.DIVIDER_ATTRIBUTE,iD.data.DataType.JUNCTION,iD.data.DataType.R_DIVIDER_JUNCTION,iD.data.DataType.OBJECT_PL,iD.data.DataType.OBJECT_PL_NODE,iD.data.DataType.R_DIVIDER_OPL,iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION,iD.data.DataType.LAMPPOST,iD.data.DataType.R_LAMPPOST_LREF,iD.data.DataType.OBJECT_PT,iD.data.DataType.R_OPT_OPT,iD.data.DataType.OBJECT_PG,iD.data.DataType.OBJECT_PG_NODE,iD.data.DataType.R_DIVIDER_OPG,iD.data.DataType.TRAFFICSIGN,iD.data.DataType.TRAFFICSIGN_NODE,iD.data.DataType.BRIDGE,iD.data.DataType.BRIDGE_NODE,iD.data.DataType.LIMITHEIGHT,iD.data.DataType.R_DIVIDER_LH,iD.data.DataType.R_BRIDGE_LH,iD.data.DataType.TRAFFICLIGHT,iD.data.DataType.R_TRAFFICLIGHT_TREF,iD.data.DataType.R_DIVIDER_TL,iD.data.DataType.MEASUREINFO,iD.data.DataType.OBJECT_PG,iD.data.DataType.OBJECT_PG_NODE,iD.data.DataType.TRAFFICSIGN,iD.data.DataType.TRAFFICSIGN_NODE];iD.Static.fusionDivider={elements:{name:"\u6570\u636E\u5C42",children:[{type:"dividerLine",name:"\u878D\u5408\u6210\u679C",event:"roadEdit",display:true,editable:true,tagReadOnly:false,children:iD.Static.fusionModels,action:["add-road","add-roadcross","add-junction"]}]},resource:iD.Static.defaultResource};iD.Static.identify={elements:{name:"\u6570\u636E\u5C42",children:[]},resource:iD.Static.defaultResource};iD.Static.defaultRoadModels=[iD.data.DataType.C_NODE,iD.data.DataType.ROAD_NODE,iD.data.DataType.R_C_NODE_ROAD_NODE,iD.data.DataType.ROAD,iD.data.DataType.C_NODECONN,iD.data.DataType.NODECONN,iD.data.DataType.C_TRAFFICRULE,iD.data.DataType.TRAFFICRULE,iD.data.DataType.TURN_GUIDANCE,iD.data.DataType.C_NODEINFO,iD.data.DataType.NODEINFO,iD.data.DataType.C_LANEINFO,iD.data.DataType.LANEINFO,iD.data.DataType.ROAD_ATTRIBUTE,iD.data.DataType.R_ROAD_RA,iD.data.DataType.R_ROAD_DIVIDER];iD.Static.defaultDividerModels=[iD.data.DataType.DIVIDER,iD.data.DataType.R_DIVIDER_DREF,iD.data.DataType.DIVIDER_NODE,iD.data.DataType.DIVIDER_ATTRIBUTE,iD.data.DataType.JUNCTION,iD.data.DataType.R_DIVIDER_JUNCTION,iD.data.DataType.OBJECT_PL,iD.data.DataType.OBJECT_PL_NODE,iD.data.DataType.R_DIVIDER_OPL,iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION,iD.data.DataType.LAMPPOST,iD.data.DataType.R_LAMPPOST_LREF,iD.data.DataType.OBJECT_PT,iD.data.DataType.R_OPT_OPT,iD.data.DataType.OBJECT_PG,iD.data.DataType.OBJECT_PG_NODE,iD.data.DataType.R_DIVIDER_OPG,iD.data.DataType.TRAFFICSIGN,iD.data.DataType.TRAFFICSIGN_NODE,iD.data.DataType.BRIDGE,iD.data.DataType.BRIDGE_NODE,iD.data.DataType.LIMITHEIGHT,iD.data.DataType.R_DIVIDER_LH,iD.data.DataType.R_BRIDGE_LH,iD.data.DataType.TRAFFICLIGHT,iD.data.DataType.R_TRAFFICLIGHT_TREF,iD.data.DataType.R_DIVIDER_TL,iD.data.DataType.MEASUREINFO];iD.Static.defaultEditCheckModels=[iD.data.DataType.CHECK_TAG];iD.Static.defaultAnalysisTagModels=[iD.data.DataType.ANALYSIS_TAG];iD.Static.defaultQuestionTagModels=[iD.data.DataType.QUESTION_TAG];iD.Static.defaultImageTagModels=[iD.data.DataType.IMAGE_TAG];iD.Static.defaultPGModels=[iD.data.DataType.OBJECT_PG,iD.data.DataType.OBJECT_PG_NODE,iD.data.DataType.TRAFFICSIGN,iD.data.DataType.TRAFFICSIGN_NODE];iD.Static.playerConstant={INTERSECTION:"intersection",POLYLINE:"polyline",POLYGONE:"polygone",ADD_DIVIDER:"addDivider",ADD_OBJECT_PL:"addObjectPL",ADD_OBJECT_PG:"addObjectPG",POINT:"point",POLYLINE_ADD_NODE:"polylineAddNode",TELEGRAPH_POLE:"telegraphPole",TELEGRAPH_LAMP_HOLDER:"telegraphLampHolder",ADD_BOARD:"addboard",ADD_BOARD_POLYGON:"addboardPolygon",ADD_GROUND_AREA:"addGroundArea",MOVE_LINE:"MOVE_LINE",BATCH_BREAK_DREF:"batchBreakDref",BRIDGE_BOTTOM_LINE:"bridgeBottomLine",MARK_VECTOR_POINT:"markVectorPoint",ADD_TRAFFICLIGHT:"addTrafficLight",ADD_CHECK_TAG_POINT:"addCheckTagPoint",ADD_IMAGE_TAG_POINT:"addImageTagPoint",ADD_ANALYSIS_TAG_POINT:"addAnalysisTagPoint",ADD_QUESTION_TAG_POINT:"addQuestionTagPoint",ADD_CONTROL_POINT:"addControlPoint",ADD_ROAD_ATTRIBUTE:"addRoadAttribute",ADD_DIVIDER_POLYGON:"addDividerPolygon",TOOL_EPLILINE_CROSS:"tool_epliline_cross"};iD.Static.editDividerBtns=[iD.Static.playerConstant.ADD_DIVIDER,iD.Static.playerConstant.POLYLINE_ADD_NODE,iD.Static.playerConstant.BATCH_BREAK_DREF,iD.Static.playerConstant.MOVE_LINE,iD.Static.playerConstant.ADD_ROAD_ATTRIBUTE,iD.Static.playerConstant.BRIDGE_BOTTOM_LINE,"default",iD.Static.playerConstant.INTERSECTION,iD.Static.playerConstant.TOOL_EPLILINE_CROSS];iD.Static.editOtherBtns=[iD.Static.playerConstant.ADD_OBJECT_PL,iD.Static.playerConstant.POLYLINE_ADD_NODE,iD.Static.playerConstant.MOVE_LINE,iD.Static.playerConstant.ADD_OBJECT_PG,iD.Static.playerConstant.ADD_GROUND_AREA,iD.Static.playerConstant.ADD_DIVIDER_POLYGON,iD.Static.playerConstant.ADD_BOARD_POLYGON,iD.Static.playerConstant.ADD_BOARD,iD.Static.playerConstant.ADD_CONTROL_POINT,iD.Static.playerConstant.TELEGRAPH_POLE,iD.Static.playerConstant.TELEGRAPH_LAMP_HOLDER,iD.Static.playerConstant.ADD_TRAFFICLIGHT,"default",iD.Static.playerConstant.INTERSECTION,iD.Static.playerConstant.TOOL_EPLILINE_CROSS];iD.Static.default={elements:{name:"\u6570\u636E\u5C42",children:[{type:"road",name:"\u9053\u8DEF\u53CA\u8DEF\u53E3",event:"roadEdit",display:true,editable:true,tagReadOnly:false,children:iD.Static.defaultRoadModels,action:["add-road","add-roadcross"]},{type:"divider",name:"\u9053\u8DEF\u5206\u5272\u7EBF",event:"roadEdit",display:true,editable:true,tagReadOnly:false,children:iD.Static.defaultDividerModels,action:["add-junction"]},{type:"checktag",name:"\u8D28\u68C0\u6807\u8BB0",event:"roadEdit",display:true,editable:true,tagReadOnly:false,picdatas:[iD.Static.defaultEditCheckModels],children:iD.Static.defaultEditCheckModels,action:["add-point-checktag"]},{type:"analysistag",name:"\u5206\u6790\u6807\u8BB0",event:"roadEdit",display:true,editable:true,tagReadOnly:false,picdatas:[iD.Static.defaultAnalysisTagModels],children:iD.Static.defaultAnalysisTagModels,action:[]}]},resource:iD.Static.defaultResource};iD.Static.default_layers={elements:{name:"\u6570\u636E\u5C42",children:[{type:"analysistag",id:"analysistag",name:"\u5206\u6790\u6807\u8BB0",event:"roadEdit",display:true,editable:false,children:iD.Static.defaultAnalysisTagModels,picdatas:[iD.Static.playerConstant.ADD_ANALYSIS_TAG_POINT,"default"],action:[]},{type:"checktag",id:"checktag",name:"\u8D28\u68C0\u6807\u8BB0",event:"roadEdit",display:true,editable:false,tagReadOnly:false,children:iD.Static.defaultEditCheckModels,picdatas:[iD.Static.playerConstant.ADD_CHECK_TAG_POINT,"default"],action:[]},{type:"questiontag",id:"questiontag",name:"\u95EE\u9898\u8BB0\u5F55\u6807\u8BB0",event:"roadEdit",display:true,editable:true,picdatas:[iD.Static.playerConstant.ADD_QUESTION_TAG_POINT,"default"],children:iD.Static.defaultQuestionTagModels,action:[]}]},resource:iD.Static.defaultResource};iD.Static.traditionalEdit={elements:{name:"\u6570\u636E\u5C42",children:[{type:"poi",name:"POI",event:"pointEdit",display:true,editable:true,tagReadOnly:false,children:[iD.data.DataType.POI],action:["add-poi"]},{type:"textMakr",name:"\u6807\u6CE8",event:"pointEdit",display:true,editable:true,tagReadOnly:false,children:[iD.data.DataType.TEXT_MARK],action:["add-text-mark"]},{type:"landCoverArea",name:"\u9762",event:"pointEdit",display:true,editable:true,tagReadOnly:false,children:[iD.data.DataType.LANDCOVERAREA],action:["add-land-cover-area"]}]},resource:iD.Static.defaultResource};iD.Static.imagetagEdit={elements:{name:"\u6570\u636E\u5C42",children:[{type:"imagetag",name:"\u56FE\u50CF\u6807\u8BB0",event:"roadEdit",display:true,editable:true,tagReadOnly:false,children:iD.Static.defaultImageTagModels,action:[]}]},resource:iD.Static.defaultResource};var cache={};function fusionLayersConfig(batchs){let elements={name:"\u6570\u636E\u5C42",children:[]};let _colorCount=0;let _hasEditOnly=false;function filterSimilarColor(){return iD.Static.layersInfo.randomColor.get()}function createChildren(_batch="",opts){let b=_batch.replace(/_/g,"-");opts=opts||{};let ctype=b+"dividerLine";let oldElements=iD.Static.layersInfo.getElements()||{};let color,useEditColor=opts.hasOwnProperty("useEditColor")?opts.useEditColor:true;if(!useEditColor&&b&&batchs&&1<batchs.length){if(!iD.Static.layersInfo.cacheColor[ctype]){color=filterSimilarColor()}else{color=iD.Static.layersInfo.cacheColor[ctype]}color=iD.Static.layersInfo.cacheColor[ctype]=color}let picdatas=_.uniq([].concat(iD.Static.editDividerBtns).concat(iD.Static.editOtherBtns));if(picdatas.indexOf("default")){picdatas=_.without(picdatas,"default");picdatas.push("default")}if(iD.Task.d){let sceneCode=iD.Task.d.tags.sceneCode;if(sceneCode==iD.data.sceneCode.HD_DATA_LANE){picdatas=iD.Static.editDividerBtns}else if(sceneCode==iD.data.sceneCode.HD_DATA_LO){picdatas=iD.Static.editOtherBtns}}return{type:ctype,layerId:b+iD.data.DataType.DIVIDER,name:opts.baseName||b+"\u878D\u5408\u6210\u679C",event:"roadEdit",display:opts.hasOwnProperty("display")?opts.display:true,editable:opts.hasOwnProperty("editable")?opts.editable:true,editOnly:true,tagReadOnly:false,children:[b+iD.data.DataType.DIVIDER],picdatas:picdatas,action:["add-divider","add-road","add-roadcross","add-junction"],defaultColor:color,useEditColor:useEditColor,batch:b.replace(/-/g,"_")}}if(iD.Task.d){var compareBatch=iD.Task.compareBatchs()[0];var sourceBatchs=iD.Task.sourceBatchs()}var editBatchs=[],sBatchs=[];batchs.forEach(function(batch){if(batch==compareBatch){return}else if(_.include(sourceBatchs,batch)){sBatchs.push(batch);return}editBatchs.push(batch)});var sortBatchs=editBatchs.concat(sBatchs);if(compareBatch)sortBatchs.push(compareBatch);iD.Task.d&&sortBatchs.forEach(function(batch=""){let b=batch.replace(/_/g,"-");let opts={baseName:b+"\u878D\u5408\u6210\u679C",editable:true,display:true,useEditColor:true};if(batch==compareBatch){opts={baseName:b+"\u5BF9\u6BD4\u5C42",editable:undefined,display:false,useEditColor:false}}if(_.include(sBatchs,batch)){opts={baseName:b+"\u6765\u6E90\u5C42",editable:undefined,display:false,useEditColor:false}}if(1==editBatchs.length&&editBatchs[0]==batch){if(!iD.config.isMultiBatchesMode()){opts.baseName=opts.baseName.replace(b,"")}}if(!iD.User.isWorkRole()){opts.editable=undefined}if(_hasEditOnly&&opts.editable!=undefined){opts.editable=false}let layer=createChildren(b,opts);if(layer.editOnly&&true==layer.editable){_hasEditOnly=true}for(let dlay of iD.Layers.getLayers()){if(dlay.batch&&layer.batch==dlay.batch){dlay.display=layer.display;dlay.editable=layer.editable;dlay.id=layer.layerId}}elements.children.push(layer)});var editIndex=editBatchs.length;if(0==batchs.length){let layer=createChildren();if(!iD.User.isWorkRole()){layer.editable=undefined}elements.children.push(layer);if(1==iD.Layers.getLayers().length){var dlay=iD.Layers.getLayers()[0];dlay.display=layer.display;dlay.editable=layer.editable;dlay.id=layer.layerId}editIndex=0}if(iD.User.isLinearRole()){_.each(elements.children,function(d){if(d.action&&d.action.length&&-1<d.action.indexOf("add-divider")){d.action=["add-divider"]}})}if(7==window._systemType){return elements}var ischecker=iD.User.isCheckRole();var children=iD.Static.default_layers.elements.children;let questiontag=_.filter(children,{id:"questiontag"});if(questiontag[0]){questiontag[0].editable=true;elements.children.push(questiontag[0])}if(!iD.User.isAuditRole()){let checktag=_.filter(children,{id:"checktag"});if(checktag[0]){checktag[0].editable=ischecker?true:false;checktag[0].action=["add-point-checktag"];elements.children.push(checktag[0])}}if(!iD.User.isLinearRole()){let analysistag=_.filter(children,{id:"analysistag"});if(analysistag[0]){analysistag[0].editable=ischecker?true:false;elements.children.push(analysistag[0])}}return elements}function dividerLayersConfig(batchs,isWork,isCheck){let elements={name:"\u6570\u636E\u5C42",children:[]};function createChildren(b=""){let _roadModels=iD.Static.defaultRoadModels.map(m=>b+m);let _dividerModels=iD.Static.defaultDividerModels.map(m=>b+m);let _editCheckModels=iD.Static.defaultEditCheckModels.map(m=>b+m);let _analysisTagModels=iD.Static.defaultAnalysisTagModels.map(m=>b+m);_roadModels.push(..._dividerModels);return[{type:b+"road",name:b+"\u9053\u8DEF\u53CA\u8DEF\u53E3",event:"roadEdit",display:true,editable:isWork?undefined:false,children:_roadModels,action:["add-road","add-roadcross","add-junction"]},{type:b+"checktag",name:b+"\u8D28\u68C0\u6807\u8BB0",event:"roadEdit",display:true,editable:isCheck?true:undefined,children:_editCheckModels,action:["add-point-checktag"]},{type:"analysistag",name:"\u5206\u6790\u6807\u8BB0",event:"roadEdit",display:true,editable:true,tagReadOnly:false,children:_analysisTagModels,action:[]}]}batchs.forEach(function(b){let _batch=b.replace(/_/g,"-");let layers=createChildren(_batch);for(let layer of layers){for(let layerid of layer.children){let lay=iD.Layers.getLayerById(layerid);if(lay){lay.display=layer.display;lay.editable=layer.editable}}elements.children.push(layer)}});if(0==batchs.length){var layers=createChildren();elements.children=layers;for(let layer of layers){for(let layerid of layer.children){let lay=iD.Layers.getLayerById(layerid);if(lay){lay.display=layer.display;lay.editable=layer.editable}}}}return elements.children}function systemToElements(){var dataLayers=iD.Static.default_layers;var user={};user.authorities=[{authority:"work"}];dataLayers.elements=fusionLayersConfig(iD.config.taskBatch);var elementChildren=dataLayers&&dataLayers.elements&&dataLayers.elements.children||[];var resourceChildren=dataLayers&&dataLayers.resource&&dataLayers.resource.children||[];var tagtypes=["checktag","imagetag","analysistag"];var history=iD.util.urlParamHistory();for(var i in elementChildren){var item=elementChildren[i];var oldEditable=item.editable;item._parentType="elements";if(history||iD.User.isAuditRole()){item.editable=undefined}else if(iD.User.isWorkRole()){if(_.include(tagtypes,item.type)){item.editable=undefined}}else if(iD.User.isCheckRole()||iD.User.isVerifyRole()){if(!_.include(tagtypes,item.type)){item.editable=undefined}}if("analysistag"==item.type||"questiontag"==item.type){item.editable=oldEditable}}for(var i in resourceChildren){var item=resourceChildren[i];if(!item){continue}item._parentType="resource";if("pic"===item.type){if(!iD.User.authTrail()){item.display=false}resourceChildren.splice(i,1)}}if(history){var s=d3.$("#KDSEditor-bar button.save");s.style("visibility","visible")}for(var layer of elementChildren){iD.Static.layersInfo._elements[layer.type]=layer}return dataLayers}iD.Static.actionRole={work:["AddRoad","AddIsland","AddDivider","AddLine","AddJunction","AddRoadCross","AddCutDivider","AddArea","AddPoint","AddTextMark","AddPoi","AddLandCoverArea","AddBoardArea","AddPointCheckTag"],check:[],admin:[]};iD.Static.layersInfo={_elements:{},cacheColor:{},randomColor:iD.util.randomColorList(),initElements:function(){iD.Static.layersInfo._elements={};if(iD.Task.d){iD.Static.layersInfo.randomColor.reset();iD.Static.layersInfo.cacheColor={}}},getDataElements:function(){},getResourceElements:function(){var resource=systemToElements();return resource},_getType:function(dataType){for(var type in this._elements){var info=this._elements[type];if(-1!==info.children.indexOf(dataType)){return type}}},getElements:function(){return this._elements},getElementByChildrenName:function(name){let self=this;if(!name){return}for(let key in self._elements){let lay=self._elements[key];if(_.include(lay.children,name)){return lay}}},isDisplay:function(dataType){return dataType&&this._elements[this._getType(dataType)]?this._elements[this._getType(dataType)].display:true},isEditable:function(dataType){return dataType&&this._elements[this._getType(dataType)]?this._elements[this._getType(dataType)].editable:true},setStatus:function(type,status,bool){if(!this._elements[type]){return}this._elements[type][status]=bool;this._elements[type].children&&this._elements[type].children.forEach(function(value){var layer=iD.Layers.getLayerByName(value);if(layer){layer[status]=bool}})},setLayerStatus:function(type,status,bool){let d=this._elements[type];if(!d||_.isEmpty(d.children)||!status){console.warn("\u56FE\u5C42\u5F00\u5173\u5207\u6362\u9519\u8BEF");return}let children=d.children;for(let i=0,len=children.length;i<len;i++){let layer=iD.Layers.getLayerById(children[i]);if(!layer){layer=iD.Layers.getLayerByName(children[i])}if(!layer){console.log("\u6CA1\u6709\u627E\u5230\u5BF9\u5E94\u77E2\u91CF\u56FE\u5C42",children[i]);continue}if("editable"==status){layer[status]=layer[status]!=undefined?bool:layer[status];iD.Layers.setLayerEditable(layer,bool)}else{layer[status]=bool;iD.Layers.setLayerDisplay(layer,bool)}}if("editable"==status){var ov=this._elements[type][status];this._elements[type][status]=ov!=undefined?bool:ov}else{this._elements[type][status]=bool}},getElementStatus:function(type,status){return this._elements[type][status]},toggleStatus:function(d,status){var self=this;if(!d||_.isEmpty(d.children)||!status){console.warn("\u56FE\u5C42\u5F00\u5173\u5207\u6362\u9519\u8BEF");return}self.setLayerStatus(d.type,status,!self._elements[d.type][status]);if("editable"===status&&self._elements[d.type].editOnly){let eleList=_.values(self._elements).filter(function(ele){return ele.type!=d.type&&true==ele.editOnly});eleList.forEach(function(ele){self.setLayerStatus(ele.type,status,false)})}}};;iD.User.on("login.initmap",function(){var dataLayer=new DataLayer({id:iD.config.getLayerId("Highway"),editable:true,display:true,split:true,type:"road",name:"\u5BFC\u822A\u56FE\u5C42"});var dividerLayer=new DataLayer({id:iD.config.getLayerId("DIVIDER"),editable:true,display:true,split:true,type:"road",name:"\u9AD8\u7CBE"});var dataLayer=new DataLayer({id:iD.config.getLayerId("Bnd"),editable:true,display:true,isTF:true,type:"area",name:"\u56FE\u5E45\u8FB9\u6846",style:{fill:"rgb(255, 255, 255, 0),'opacity':'0'",stroke:"blue"}});var dataLayer=new DataLayer({id:iD.config.getLayerId("QC_TAG"),editable:true,display:true,type:"point",name:"\u54C1\u63A7\u6807\u7B7E",visible:false});var Map=new TileLayer({name:"\u5730\u56FE",type:"tms",description:"kd map",url:iD.config.BG_URL.kd_map,zooms:[0,22],id:"Map",order:3,visible:false,exclusiveIds:["wms","google","mapbox"],isOverlay:false});editor.addTileLayer(Map);var wmstile=new TileLayer({name:"bing\u5F71\u50CF",type:"bing",url:iD.config.BG_URL.kd_picture,zooms:[0,22],id:"wms",exclusiveIds:["Map","google","mapbox"],visible:false});editor.addTileLayer(wmstile);var google=new TileLayer({name:"google",type:"tms",url:iD.config.BG_URL.google,zooms:[0,22],id:"google",exclusiveIds:["Map","wms","mapbox"],visible:false});editor.addTileLayer(google);var mapbox=new TileLayer({name:"mapbox",type:"tms",url:iD.config.BG_URL.mapbox,zooms:[0,22],id:"mapbox",exclusiveIds:["Map","wms","google"],visible:false});editor.addTileLayer(mapbox);var meshWms=new Overlayer({name:"\u56FE\u5E45\u53F7",type:"tms",url:iD.config.URL.wms_mesh_url,zooms:[10,22],id:"meshWms",order:4,visible:false});editor.addOverlayer(meshWms);var panoLayer=new Overlayer({name:"\u8857\u666F",type:"tms",url:"",zooms:[0,22],id:"pano",visible:false})});;iD.ui.LeftBarElement={};iD.ui.LeftBar=function(context){var navtab=iD.ui.NavTab(context);function leftBar(selection){var openCloseLeftBar=function(){var self=d3.select(".toggle");var close=selection.classed("close");selection.classed("close",!close);setTimeout(function(){var selection=d3.select("#map");context.map().closeTabDimensions(selection.dimensions());editor.setZoom(editor.getZoom()+1,true);editor.setZoom(editor.getZoom()-1,true)},500)};navtab.on("active.leftbar",function(){var close=selection.classed("close");if(close){}});selection.call(iD.ui.LeftBarUserPane(context));selection.call(iD.ui.LeftBarControl(context));iD.User.on("login.leftbar",function(){var data=iD.User.getInfo();if(!data){return}var role=iD.User.getRole();d3.select("body").classed(role.role,true).attr("role",role.role);selection.classed("login",true);selection.call(navtab)});context.connection().on("modelEntityLoaded.layermanager",function(){iD.ui.LeftBarElement.isModelEntityLoaded=true})}return leftBar};;iD.ui.LeftBarControl=function(context){var classNames=["glyphicon-chevron-left","glyphicon-chevron-right"];var classes={show:classNames[0],hide:classNames[1]};var $control,$icon,$selection;function show(){if(!$selection||!$selection.size()){return}$icon.classed(classNames.join(" "),false).classed(classes.show,true);$selection.style({position:"fixed",top:0,left:0})}function hide(){if(!$selection||!$selection.size()){return}$icon.classed(classNames.join(" "),false).classed(classes.hide,true);$selection.style({position:"fixed",top:0,left:-$selection.node().offsetWidth+"px"})}var leftBarControl=function(selection){$selection=selection;$control=selection.append("div").attr("id","leftbar-visible-control");$icon=$control.append("span").attr("class","glyphicon glyphicon-chevron-right");$control.on("click.leftbar-control",function(){if($icon.classed(classes.show)){hide()}else if($icon.classed(classes.hide)){show()}})};iD.ui.LeftBarControl.show=show;iD.ui.LeftBarControl.hide=hide;return leftBarControl};;iD.ui.LeftBarUserPane=function(context){var User=iD.User;var leftBarUserPane=function(selection){var userPane=selection.append("div").attr("id","user");var body=userPane.append("div").attr("class","body");body.call(iD.ui.LoginPane(context));User.on("login.leftbaruserpane",function(data){body.remove()})};return leftBarUserPane};;iD.ui.UsernameDropdown=function(context){var User=iD.User;var Dropdown=function(selection,dispatch){var currentActive=0;var length=0;var items;dispatch.on("dropdown",function(data){selection.selectAll("div").remove();selection.classed("show",true);var content=selection.selectAll("div.dropdown-item").data(data);items=content.enter().append("div").classed("dropdown-item",true).text(function(d){return d}).classed("active",function(d,i){return 0===i});length=items[0].length;items.on("mouseenter",function(d,i){items.classed("active",false);d3.select(this).classed("active",true);currentActive=i}).on("mousedown",function(d){dispatch.username(d)});content.exit().remove()});dispatch.on("dropdownoff",function(){selection.classed("show",false);selection.selectAll("div").remove()});dispatch.on("key",function(key){switch(key){case 13:var username=d3.select(items[0][currentActive]).data()[0];dispatch.username(username);break;case 38:currentActive--;if(0>currentActive){currentActive=length-1}items.classed("active",false);d3.select(items[0][currentActive]).classed("active",true);break;case 40:currentActive++;if(currentActive>=length){currentActive=0}items.classed("active",false);d3.select(items[0][currentActive]).classed("active",true);break;default:break;}})};return Dropdown};;iD.ui.LoginPane=function(context){var User=iD.User;var dispatch=d3.dispatch("dropdown","dropdownoff","username","key");var Dropdown=iD.ui.UsernameDropdown(context);var loginPane=function(selection){var form={};selection.append("div").attr("class","login-logo");selection.append("h3").attr("class","title").text("  ");form.username=selection.append("input").attr("class","username").attr("placeholder","\u5DE5\u4F5C\u8D26\u53F7");var dropdown=selection.append("div").classed("dropdown",true).call(Dropdown,dispatch);form.password=selection.append("input").attr("class","password").attr("type","password").attr("placeholder","\u5BC6\u7801");form.errorInfo=selection.append("div").attr("class","error-info");form.errorInfo.append("span").attr("class","error-logo").text("!");form.errorMessage=form.errorInfo.append("span");form.submit=selection.append("button").text("\u767B\u5F55");form.username.on("input",function(){var value=this.value;var cache=iD.UsernameCache.search(value);dispatch.dropdown(cache)}).on("focus",function(){var value=this.value;var cache=iD.UsernameCache.search(value);dispatch.dropdown(cache)}).on("blur",function(){dispatch.dropdownoff()}).on("keydown",function(){var key=d3.event.keyCode;dispatch.key(key)});form.password.on("keydown",function(){if(13===d3.event.keyCode){var username=form.username.value();var password=form.password.value();User.login(username,password)}});form.submit.on("click",function(){var username=form.username.value();var password=form.password.value();User.login(username,password)});dispatch.on("username",function(username){form.username.value(username);dispatch.dropdownoff()});User.on("error.loginpane",function(message){form.errorInfo.classed("show",true);form.errorMessage.text(message)});var urlTaskid=iD.url.getUrlParam("taskID");if(urlTaskid){User._urlTaskIsEnter=false;setTimeout(function(){User.login("admin","admin")},500)}};return d3.rebind(loginPane,dispatch,"on")};;;iD.ui.UserDropdown=function(context){var User=iD.User;var UserDropdown=function(selection){var user=User.getInfo();if(!user.username){console.error("not login");return}var button=selection.append("div").attr("class","dropdown");button.append("span").text(user.truename).attr("class","name");button.append("span").attr("class","caret");button.on("click",function(){selection.classed("open",!selection.classed("open"))});var ul=selection.append("ul").attr("class","dropdown-menu");var contents=[{title:user.username||"\u65E0\u7528\u6237\u540D"},{title:"\u9000\u51FA\u767B\u5F55",cb:function(){User.logout(function(){location.reload()})}}];var lis=ul.selectAll("li").data(contents).enter().append("li").text(function(d){return d.title});lis.on("click",function(d){d.cb&&d.cb()})};return UserDropdown};;iD.ui.tabs={};iD.ui.NavTab=function(context){var dispatch=d3.dispatch("active","default");var User=iD.User;var keybinding=d3.keybinding("navtab");var data=[{name:"element",title:"\u5C5E\u6027",toggle:"element",key:"2"}];var navTab=function(selection){var wrapper=selection.append("div").attr("class","navtab");var nav=wrapper.append("ul").attr("class","nav");var lis=nav.selectAll("li").data(data).enter().append("li").text(function(d){return d.title}).attr("toggle",function(d){return d.toggle}).attr("class",function(d){var selection=this;keybinding=keybinding.on(d.key,function(){dispatch.active.call(selection,d)});return"item-"+d.toggle}).style("width",function(){return 100/data.length+"%"});var content=wrapper.append("div").attr("class","nav-content");var items=content.selectAll(".item").data(data).enter().append("div").attr("class",function(d){return"item item-"+d.toggle});d3.select(document).call(keybinding);dispatch.on("active.navtab",function(d){var self=d3.select(this);if(self.classed("active")){return}var toggle=self.attr("toggle");lis.classed("active",false);items.classed("active",false);self.classed("active",true);items.select(function(d){var that=d3.select(this);if(d.toggle===toggle){if(!that.classed("fill")){that.classed("fill",true);iD.ui.tabs[toggle]=iD.ui.tabs[toggle]||iD.ui.LeftBarElement[toggle](context);that.call(iD.ui.tabs[toggle])}return this}}).classed("active",true)});lis.on("click",dispatch.active);lis.each(function(d){dispatch.active.call(this,d)});lis.select(function(d){if("task"===d.toggle){dispatch.active.call(this,d);return}});if(data[0]&&"task"!=data[0].toggle){iD.Task.get()}};return d3.rebind(navTab,dispatch,"on","active")};;iD.ui.LeftBarElement.task=function(context){var dispatch=d3.dispatch("task","refreshTasks");var Task=iD.Task;var taskDetail=iD.Task.current=iD.ui.LeftBarElement.TaskDetail(context);var headData=["","\u4EFB\u52A1",""];var task=function(selection){var info=selection.append("div").classed("empty",true).classed("hide",true);info.append("div");info.append("div").text("\u7A7A\u7A7A\u5982\u4E5F\uFF0C\u5FEB\u5FEB\u70B9\u51FB\u9886\u53D6\u4EFB\u52A1\u5237\u65B0\u4EFB\u52A1\u5217\u8868\u5427");var table=selection.append("table").attr("class","task-table");var detailWrapper=selection.append("div").attr("class","detail-warpper");var tbody=table.append("tbody");var drawTable=function(){tbody.selectAll("tr").remove();info.classed("hide",true);tasks=Task.tasks;table.classed("hide",0===tasks.length);var role=iD.User.getRole().role;if(0<tasks.length){var trs=tbody.selectAll("tr").data(tasks).enter().append("tr");var isRed=false;trs.each(function(d,i){var tr=d3.select(this);if("work"===role){if(Task.working&&Task.working.task_id===d.task_id){tr.classed("working",true)}else if(d.chk_status){tr.classed("warning",true)}else if(d.task_status>Task.TASK_STATUS.ASSIGN){tr.classed("editing",true)}}tr.append("td").text("").classed("icon",true);tr.append("td").text(d.task_id);tr.append("td").text(d.cli_desc);tr.append("td").classed("go-detail",true);if(Task.d&&i===Task.d._index){trs.classed("active",false);tr.classed("active",true)}if(d.chk_status){isRed=true}});var $detail=trs.selectAll(".go-detail").on("click",function(d,_,i){d3.event.stopPropagation();enterDetail(i)});d3.select(".nav .item-task").classed("red",isRed)}else{info.classed("hide",false)}var task_id=iD.url.getUrlParam("taskID");if(!iD.User._urlTaskIsEnter){tbody.selectAll("tr").each(function(d){iD.User._urlTaskIsEnter=true;var $tr=d3.select(this);if(d&&task_id&&d.task_id==task_id){$tr.select("td.go-detail").trigger("click")}return false})}};dispatch.on("refreshTasks",function(){Task.get(drawTable)});dispatch.refreshTasks();iD.Task.on("restore",function(){try{iD.Task.working=JSON.parse(localStorage.getItem("d"))}catch(e){Dialog.alert("\u83B7\u53D6\u7F13\u5B58\u5931\u8D25");localStorage.removeItem("d");context.history().clearSaved();return}if(!iD.Task.working){Dialog.alert("\u83B7\u53D6\u7F13\u5B58\u5931\u8D25");localStorage.removeItem("d");context.history().clearSaved();return}var index=_.findIndex(iD.Task.tasks,function(task){return task.task_id===iD.Task.working.task_id});if(0<=index){enterDetail(index)}else{Dialog.alert("\u4EFB\u52A1\u4E0D\u5B58\u5728\uFF0C\u6062\u590D\u5931\u8D25");localStorage.removeItem("d");context.history().clearSaved();delete iD.Task.working}});taskDetail.on("back",function(){context.enter(iD.modes.Browse(context));detailWrapper.selectAll("*").remove();selection.classed("status-detail",false);d3.select(".nav-content .item-element").classed("show",false);drawTable()});taskDetail.on("pre",function(index){if(0>index){return}detailWrapper.call(taskDetail,Task.getOne(index),index)});taskDetail.on("next",function(index){if(index>Task.tasks.length-1){return}detailWrapper.call(taskDetail,Task.getOne(index),index)});function enterDetail(index){d3.select(".nav-content .item-element").classed("show",true);iD.ui().reportform.showBtn();detailWrapper.call(taskDetail,iD.Task.tasks[index],index)}};var result=d3.rebind(task,dispatch,"on","refreshTasks");return result};;;iD.ui.LeftBarElement.TaskDetail=function(context){var dispatch=d3.dispatch("back","pre","next","submit","start","check","enter","afterStart","qcstart","afterQCStart");var Task=iD.Task;var TASK_STATUS=Task.TASK_STATUS;var QC_TASK_STATUS=Task.QC_TASK_STATUS;var taskDetail=function(selection,data,index){context.enter(iD.modes.Browse(context));if(0===d3.select(".KDSEditor-button-wrap .save.disabled").size()&&data.task_id!==Task.working.task_id){Dialog.confirm("\u662F\u5426\u4FDD\u5B58\u4E4B\u524D\u64CD\u4F5C? ",function(){context.enter(iD.modes.Save(context,t("save.title"),function(){draw(selection,data,index)},function(){context.history().popAll();draw(selection,data,index)}))},function(){context.history().popAll();draw(selection,data,index)})}else{draw(selection,data,index)}};function updataLayerUrl(layerid,data){if("1"==data.task_classes&&"undefined"!=typeof data.adam_id&&0<data.adam_id.length){var layer=editor.getOverLayerByID(layerid);var url=layer.url.split("&dataWhereCondition=adam_id=")[0];url+="&dataWhereCondition=adam_id='"+data.adam_id+"'";layer.setOptions({editor:editor,url:url})}}function draw(selection,data,index){updataLayerUrl(iD.refLayer.user_feed_back,data);selection.selectAll("*").remove();d3.select(".item.item-task").classed("status-detail",true);Task.d=_.extend(data,{_index:index});context.ui().layermanager.update();iD.Static.layersInfo.initElements();selection.data([data]);var header=selection.append("div").attr("class","header");var back=header.append("span").attr("class","back").text("\u8FD4\u56DE\u5217\u8868").on("click",dispatch.back);var pre=header.selectAll("pre").data([index-1]).enter().append("span").attr("class","pre").classed("disabled",function(d){return 0>d?true:false}).text("\u4E0A\u4E00\u4EFB\u52A1").on("click",dispatch.pre);var next=header.selectAll("next").data([index+1]).enter().append("span").attr("class","next").classed("disabled",function(d){return d>Task.tasks.length-1?true:false}).text("\u4E0B\u4E00\u4EFB\u52A1").on("click",dispatch.next);var role=d3.select("body").attr("role");var scroller=selection.append("div").classed("scroller",true);var taskAttrWrapper=scroller.append("div").classed("taskattr-wrapper",true).call(iD.ui.LeftBarElement.dropdownMaker(),"\u4EFB\u52A1\u5C5E\u6027");taskAttrWrapper.call(iD.ui.LeftBarElement.TaskAttr(context,dispatch),data,index);var buttons=selection.append("div").attr("class","button-group").classed(role,true);function afterStart(){d3.selectAll("#changeQualityStatus").attr("disabled",null);buttons.select(".start").remove();Task.order()}function afterQCStart(){d3.selectAll("#changeQualityStatus").attr("disabled",null);buttons.select(".start").remove();var checkPass=buttons.append("button").attr("class","pass").attr("result",1).text("\u54C1\u63A7\u5408\u683C");var checkFail=buttons.append("button").attr("class","fail").attr("result",2).text("\u54C1\u63A7\u4E0D\u5408\u683C");buttons.selectAll("button").on("click",function(){if(document.getElementById("qcBoxDiv")){Dialog.alert("\u8BF7\u5148\u5C06\u8F93\u5165\u6846\u4E2D\u5185\u5BB9\u4FDD\u5B58");return}if(d3.event&&"pass"==d3.event.target.className&&data._reports_status){Dialog.alert("\u975E\u8BEF\u62A5\u4E0D\u5141\u8BB8\u54C1\u63A7\u5408\u683C");return}var result=d3.select(this).attr("result");if(d3.selectAll(".KDSEditor-button-wrap .save").classed("disabled")){save()}else{context.enter(iD.modes.Save(context,t("save.title"),save))}function save(){Task.submit({result:result,transid:data.trans_id,taskid:data.task_id,id:data.qc_id},function(data){if("0"==data.status){Dialog.alert("\u4EFB\u52A1\u5DF2\u63D0\u4EA4");if(/active/i.test(d3.select(".layer-manager-pane.KDSEditor-pane .dropdown-menu .item-tag i").attr("class"))){d3.select(".layer-manager-pane.KDSEditor-pane .dropdown-menu .item-tag i").trigger("click")}}else{Dialog.alert(data.desc)}if(data.qc_status==QC_TASK_STATUS.END){Task.removeOne(index)}dispatch.back()})}})}dispatch.on("afterStart",afterStart);dispatch.on("afterQCStart",afterQCStart);var connection=context.connection();connection.on("loading.start",function(){});connection.on("loaded.start",function(){});dispatch.start();context.editArea(iD.Task.d.range);context.map().drawTansactionEntity();context.ui().sidebar.update(data);context.ui().layermanager.update();context.variable.firstInZoomLevel=context.map().zoom()}return d3.rebind(taskDetail,dispatch,"on")};;;iD.ui.LeftBarElement.element=function(context){var context;var element=function(selection){selection.selectAll("div").remove();selection.append("div").attr("id","KDSEditor-sidebar").call(context.ui().sidebar)};return element};;;iD.ui.LeftBarElement.dropdownMaker=function(){var maker=function(selection,title){selection.classed("dropdown-maker",true);var header=selection.append("div").classed("head",true).text(title);header.on("click",function(){selection.classed("close",!selection.classed("close"))});selection.append("div").classed("body",true)};return maker};;iD.ui.LeftBarElement.TaskAttr=function(context,dispatch){var Task=iD.Task;var TASK_STATUS=Task.TASK_STATUS;var form={};var labels={1:[{title:"\u4EFB\u52A1ID",name:"task_id"}],2:[{title:"\u4EFB\u52A1ID",name:"task_id"},{title:"\u4FE1\u606F\u70B9\u540D\u79F0",name:"vip_name"},{title:"\u4EFB\u52A1\u7C7B\u578B",name:"task_classes",map:{1:"\u7528\u6237\u53CD\u9988",2:"\u91CD\u70B9\u5DE5\u7A0B"}},{title:"\u4F18\u5148\u7EA7",name:"basic_priority"},{title:"\u901A\u8F66\u72B6\u6001",name:""}],5:[{title:"\u4EFB\u52A1ID",name:"task_id"},{title:"\u4EFB\u52A1\u7C7B\u578B",name:"task_classes",map:{1:"\u7528\u6237\u53CD\u9988",2:"\u91CD\u70B9\u5DE5\u7A0B",5:"\u6B65\u5BFC\u4EFB\u52A1"}},{title:"\u9519\u8BEF\u7C7B\u578B",name:"cli_error"},{title:"\u4FEE\u6539\u65B9\u6848",name:"cli_modify"},{title:"\u4F18\u5148\u7EA7",name:"basic_priority"},{title:"\u8C03\u67E5\u4EBA",name:"cli_worker"},{title:"\u53CD\u9988\u65F6\u95F4",name:"cli_time"}],7:[{title:"\u4EFB\u52A1ID",name:"task_id"},{title:"\u4EFB\u52A1\u7C7B\u578B",name:"task_classes",map:{1:"\u7528\u6237\u53CD\u9988",2:"\u91CD\u70B9\u5DE5\u7A0B",7:"\u5168\u91CF\u68C0\u67E5"}},{title:"\u4F18\u5148\u7EA7",name:"basic_priority"}]};var taskAttr=function(selection,data,index){var body=selection.select(".body");var lines=body.selectAll("div").data(labels[data["task_classes"]]).enter().append("div").attr("class","attr clearfix");lines.each(function(d,i){var line=d3.select(this);var key=line.append("div").text(d.title);var value=line.append("div").text(function(d){var name=d.name&&data[d.name]?data[d.name]:"";if(d.map&&name){name=d.map[name]}return name})});iD.Task.current.on("start",function(){function autoSave(){var history=context.history();if(history.hasChanges()){Dialog.confirm("\u60A8\u5DF2\u957F\u65F6\u95F4\u6CA1\u6709\u4FDD\u5B58\u6570\u636E\u4E86\uFF0C\u662F\u5426\u4FDD\u5B58\uFF1F",function(){context.enter(iD.modes.Save(context,"auto saving"))})}}var autoSaveTime=0;window.clearInterval(autoSaveTime);autoSaveTime=window.setInterval(autoSave,900000);context.enter(iD.modes.Browse(context));if(16>context.variable.firstInZoomLevel){}if(5===data.task_status){Task.start(data.task_id,data.trans_id,function(){iD.Task.working=data;dispatch.afterStart();iD.Task.dispatch.start()})}else{iD.Task.working=data;dispatch.afterStart();iD.Task.dispatch.start()}});iD.Task.current.on("submit",function(){if(!iD.Task.working.chk_trans_id){Dialog.alert("\u5C1A\u672A\u63D0\u4EA4\u81EA\u52A8\u68C0\u67E5\uFF0C\u4E0D\u80FD\u63D0\u4EA4\u4EFB\u52A1");return}if(!iD.Check.checkReport(context,"\u81EA\u68C0\u9519\u8BEF\u9879\u5C1A\u672A\u4FEE\u6539\u5B8C\u6210\uFF0C\u4E0D\u80FD\u63D0\u4EA4\u4EFB\u52A1\u3002"))return;Dialog.confirm("\u786E\u8BA4\u63D0\u4EA4\u4EFB\u52A1\u4E48?",function(){if(d3.selectAll(".KDSEditor-button-wrap .save").classed("disabled")){submit()}else{context.enter(iD.modes.Save(context,t("save.title"),submit))}});function submit(){Task.submit({taskid:data.task_id,transid:data.trans_id},function(data){Dialog.alert(data.desc);if(30==data.task_status){Task.removeOne(0);delete Task.d;delete Task.working;context.map().drawTansactionEntity();editor.setZoom(18);editor.setCenter([116.3974,39.908288])}dispatch.back()})}})};return taskAttr};;iD.ui.intro=function(context){var step;function intro(selection){context.enter(iD.modes.Browse(context));var history=context.history().toJSON(),hash=window.location.hash,background=context.background().baseLayerSource(),opacity=d3.select(".background-layer").style("opacity"),loadedTiles=context.connection().loadedTiles(),baseEntities=context.history().graph().base().entities,introGraph;context.connection().toggle(false).flush();context.history().reset();introGraph=JSON.parse(iD.introGraph);for(var key in introGraph){introGraph[key]=iD.Entity(introGraph[key])}context.history().merge(d3.values(iD.Graph().load(introGraph).entities));context.background().bing();var savebutton=d3.select("#KDSEditor-bar button.save"),save=savebutton.on("click");savebutton.on("click",null);context.inIntro(true);d3.select(".background-layer").style("opacity",1);var curtain=d3.curtain();selection.call(curtain);function reveal(box,text,options){options=options||{};if(text)curtain.reveal(box,text,options.tooltipClass,options.duration);else curtain.reveal(box,"","",options.duration)}var steps=["navigation","point","area","line","startEditing"].map(function(step,i){var s=iD.ui.intro[step](context,reveal).on("done",function(){entered.filter(function(d){return d.title===s.title}).classed("finished",true);enter(steps[i+1])});return s});steps[steps.length-1].on("startEditing",function(){curtain.remove();navwrap.remove();d3.select(".background-layer").style("opacity",opacity);context.connection().toggle(true).flush().loadedTiles(loadedTiles);context.history().reset().merge(d3.values(baseEntities));context.background().baseLayerSource(background);if(history)context.history().fromJSON(history);window.location.replace(hash);context.inIntro(false);d3.select("#KDSEditor-bar button.save").on("click",save)});var navwrap=selection.append("div").attr("class","intro-nav-wrap KDSEditor-fillD");var buttonwrap=navwrap.append("div").attr("class","joined").selectAll("button.step");var entered=buttonwrap.data(steps).enter().append("button").attr("class","step").on("click",enter);entered.append("div").attr("class","KDSEditor-icon KDSEditor-icon-pre-text apply");entered.append("label").text(function(d){return t(d.title)});enter(steps[0]);function enter(newStep){if(step){step.exit()}context.enter(iD.modes.Browse(context));step=newStep;step.enter();entered.classed("active",function(d){return d.title===step.title})}}return intro};iD.ui.intro.pointBox=function(point,context){var rect=context.surfaceRect();point=context.projection(point);return{left:point[0]+rect.left-30,top:point[1]+rect.top-50,width:60,height:70}};iD.ui.intro.pad=function(box,padding,context){if(box instanceof Array){var rect=context.surfaceRect();box=context.projection(box);box={left:box[0]+rect.left,top:box[1]+rect.top}}return{left:box.left-padding,top:box.top-padding,width:(box.width||0)+2*padding,height:(box.width||0)+2*padding}};;;iD.ui.Attribution=function(context){var selection;function attribution(data,klass){var div=selection.selectAll("."+klass).data([0]);div.enter().append("div").attr("class",klass);var background=div.selectAll(".attribution").data(data,function(d){return d.name()});background.enter().append("span").attr("class","attribution").each(function(d){if(d.terms_html){d3.select(this).html(d.terms_html);return}var source=d.terms_text||d.id||d.name();if(d.logo){source="<img class=\"source-image\" src=\""+context.imagePath(d.logo)+"\">"}if(d.terms_url){d3.select(this).append("a").attr("href",d.terms_url).attr("target","_blank").html(source)}else{d3.select(this).text(source)}});background.exit().remove();var copyright=background.selectAll(".copyright-notice").data(function(d){var notice=d.copyrightNotices(context.map().zoom(),context.map().extent());return notice?[notice]:[]});copyright.enter().append("span").attr("class","copyright-notice");copyright.text(String);copyright.exit().remove()}function update(){attribution([context.background().baseLayerSource()],"base-layer-attribution");attribution(context.background().overlayLayerSources().filter(function(s){return s.validZoom(context.map().zoom())}),"overlay-layer-attribution")}return function(select){selection=select;context.background().on("change.attribution",update);context.map().on("move.attribution",_.throttle(update,400,{leading:false}));update()}};;;iD.ui.RadialMenu=function(context,operations,newSelect){var menu,center=[0,0],tooltip;var radialDrag_behavior=iD.behavior.drag().on("start",function(){}).on("move",function(d){var delta=d3.event.delta;var self=d3.select(this);var trans=self.attr("transform")?d3.transform(self.attr("transform")).translate:[0,0];var transx=trans[0];var transy=trans[1];transx+=delta[0];transy+=delta[1];var translate_move=[transx,transy];self.attr("transform","translate("+translate_move+")")}).on("end",function(){var self_translate=d3.transform(d3.select(this).attr("transform")).translate;localStorage.setItem("transform_radialMenu",self_translate)});var radialMenu=function(selection){var selTarget=iD.select&&iD.select.__data__,selIds=context.selectedIDs();if(!iD.Task.working||iD.Task.working.task_id!==iD.Task.d.task_id){return}if(!selTarget&&selIds&&selIds.length){for(var i=0,len=selIds.length;i<len;i++){if(context.hasEntity(selIds[i])){selTarget=context.entity(selIds[i]);break}}}if(!selTarget){return}if(!selTarget.tags){return}var layerType=selTarget.modelName;if(!operations.length)return;selection.node().parentNode.focus();function click(operation){d3.event.stopPropagation();if(operation.disabled())return;operation(center);radialMenu.close()}menu=selection.append("g").attr("class","radial-menu").attr("transform","translate("+center+")").attr("opacity",0);menu.transition().attr("opacity",1);menu.call(radialDrag_behavior);var r=60,a=Math.PI/4,a0=-Math.PI/4,a1=a0+(operations.length-1)*a;menu.append("path").attr("class","radial-menu-background").attr("d","M"+r*Math.sin(a0)+","+r*Math.cos(a0)+" A"+r+","+r+" 0 "+(5<operations.length?"1":"0")+",0 "+(r*Math.sin(a1)+1e-3)+","+(r*Math.cos(a1)+1e-3)).attr("stroke-width",50).attr("stroke-linecap","round");var button=menu.selectAll().data(operations).enter().append("g").attr("transform",function(d,i){return"translate("+r*Math.sin(a0+i*a)+","+r*Math.cos(a0+i*a)+")"});button.append("circle").attr("class",function(d){return"radial-menu-item radial-menu-item-"+d.id}).attr("r",13).classed("disabled",function(d){return d.disabled()}).on("click",click).on("mousedown",mousedown).on("mouseover",mouseover).on("mouseout",mouseout);button.append("use").attr("transform","translate(-10, -10)").attr("clip-path","url(#clip-square-20)").attr("xlink:href",function(d){return"#icon-operation-"+(d.disabled()?"disabled-":"")+d.id});tooltip=d3.select(document.body).append("div").attr("class","tooltip-inner radial-menu-tooltip");function mousedown(){d3.event.stopPropagation()}function mouseover(d,i){var rect=context.surfaceRect(),angle=a0+i*a,top=rect.top+(r+25)*Math.cos(angle)+center[1]+"px",left=rect.left+(r+25)*Math.sin(angle)+center[0]+"px",bottom=rect.height-(r+25)*Math.cos(angle)-center[1]+"px",right=rect.width-(r+25)*Math.sin(angle)-center[0]+"px";tooltip.style("top",null).style("left",null).style("bottom",null).style("right",null).style("display","block").html(iD.ui.tooltipHtml(d.tooltip(),d.keys[0]));if(0===i){tooltip.style("right",right).style("top",top)}else if(4<=i){tooltip.style("left",left).style("bottom",bottom)}else{tooltip.style("left",left).style("top",top)}}function mouseout(){tooltip.style("display","none")}};radialMenu.close=function(){if(menu){menu.style("pointer-events","none").transition().attr("opacity",0).remove()}if(tooltip){tooltip.remove()}};radialMenu.center=function(_){if(!arguments.length)return center;center=_;if(menu){menu.attr("transform","translate("+center+")")}return radialMenu};return radialMenu};;;iD.ui.Inspector=function(context){var entityEditor=iD.ui.EntityEditor(context),state="select",entityID,newFeature=false;function inspector(selection){var entity=context.entity(entityID);selection.classed("KDSEditor-inspector-disabled",true);entityEditor.state(state).entityID(entityID);var $wrap=selection.selectAll(".KDSEditor-panewrap").data([0]);var $enter=$wrap.enter().append("div").attr("class","KDSEditor-panewrap");$enter.append("div").attr("class","entity-editor-pane KDSEditor-pane");$wrap.select(".entity-editor-pane").call(entityEditor)}inspector.state=function(_){if(!arguments.length)return state;state=_;entityEditor.state(state);return inspector};inspector.entityID=function(_){if(!arguments.length)return entityID;entityID=_;return inspector};inspector.newFeature=function(_){if(!arguments.length)return newFeature;newFeature=_;return inspector};return inspector};;;iD.ui.modal=function(selection,blocking,nodeID,context){var previous=selection.select("div.modal");var animate=previous.empty();var event=d3.dispatch("clickclose","click","close");previous.transition().duration(200).style("opacity",0).remove();var shaded=selection.append("div").attr("class","shaded").style("opacity",0);function hasTagDesc(){var role=iD.User.getRole().role;var delDiv=document.getElementById("qcBoxDiv");if("check"==role&&null!=delDiv){var node=context.graph().entity(nodeID);var desc=node.tags.tag_desc;var tag_desc_info=desc.replace(/(^\s*)|(\s*$)/g,"");if("undefined"==tag_desc_info||""==tag_desc_info||!tag_desc_info){context.perform(iD.actions.DeleteNode(nodeID))}}}function canClose(){var div=document.getElementById("adasPw");if(null!=div){return false}return true}shaded.clickclose=function(){if(!canClose){hasTagDesc();event.close();shaded.transition().duration(200).style("opacity",0).remove();modal.transition().duration(200).style("top","0px");keybinding.off()}};shaded.close=function(){hasTagDesc();shaded.transition().duration(200).style("opacity",0).remove();modal.transition().duration(200).style("top","0px");keybinding.off()};var keybinding=d3.keybinding("modal").on("\u232B",shaded.close).on("\u238B",shaded.close);d3.select(document).call(keybinding);var modal=shaded.append("div").attr("class","modal KDSEditor-fillL KDSEditor-col6");shaded.on("click.remove-modal",function(){if(d3.event.target===this&&!blocking)shaded.clickclose()});modal.append("button").attr("class","close").on("click",function(){if(!blocking)shaded.close()}).append("div").attr("class","KDSEditor-icon close");modal.append("div").attr("class","KDSEditor-content");if(animate){shaded.transition().style("opacity",1);modal.style("top","0px").transition().duration(200).style("top","40px")}else{shaded.style("opacity",1)}return d3.rebind(shaded,event,"on")};;;iD.ui.cmd=function(code){if("mac"===iD.detect().os)return code;var replacements={"⌘":"Ctrl","⇧":"Shift","⌥":"Alt","⌫":"Backspace","⌦":"Delete"},keys=[];if("win"===iD.detect().os){if("\u2318\u21E7Z"===code)return"Ctrl+Shift+Z"}for(var i=0;i<code.length;i++){if(code[i]in replacements){keys.push(replacements[code[i]])}else{keys.push(code[i])}}return keys.join("+")};;;iD.ui.Success=function(context){var event=d3.dispatch("cancel"),changeset;function success(selection){var message=(changeset.comment||t("success.edited_osm")).substring(0,130)+" "+context.connection().changesetURL(changeset.id);var header=selection.append("div").attr("class","KDSEditor-header KDSEditor-fillL");header.append("button").attr("class","KDSEditor-fr").append("span").attr("class","KDSEditor-icon close").on("click",function(){event.cancel(success)});header.append("h3").text(t("success.just_edited"));var body=selection.append("div").attr("class","body save-success fillL");body.append("p").html(t("success.help_html"));var changesetURL=context.connection().changesetURL(changeset.id);body.append("a").attr("class","button KDSEditor-col12 osm").attr("target","_blank").attr("href",changesetURL).text(t("success.view_on_osm"));var sharing={facebook:"https://facebook.com/sharer/sharer.php?u="+encodeURIComponent(changesetURL),twitter:"https://twitter.com/intent/tweet?source=webclient&text="+encodeURIComponent(message),google:"https://plus.google.com/share?url="+encodeURIComponent(changesetURL)};body.selectAll(".button.social").data(d3.entries(sharing)).enter().append("a").attr("class",function(d){return"button social KDSEditor-col4 "+d.key}).attr("target","_blank").attr("href",function(d){return d.value}).call(bootstrap.tooltip().title(function(d){return t("success."+d.key)}).placement("bottom"))}success.changeset=function(_){if(!arguments.length)return changeset;changeset=_;return success};return d3.rebind(success,event,"on")};;;iD.ui.Loading=function(context){var message="",blocking=false,modal;var loading=function(selection){modal=iD.ui.modal(selection,blocking);var loadertext=modal.select(".KDSEditor-content").classed("loading-modal",true).append("div").attr("class","modal-section KDSEditor-fillL");loadertext.append("img").attr("class","loader").attr("src",context.imagePath("loader-white.gif"));loadertext.append("h3").text(message);modal.select("button.close").attr("class","hide");return loading};loading.message=function(_){if(!arguments.length)return message;message=_;return loading};loading.blocking=function(_){if(!arguments.length)return blocking;blocking=_;return loading};loading.close=function(){modal.remove()};return loading};;;iD.ui.Background=function(context){var key="b";function background(selection){function update(){}var content=selection.append("div").attr("class","KDSEditor-fillL map-overlay col3 content hide1"),tooltip=bootstrap.tooltip().placement("left").html(true).title(iD.ui.tooltipHtml(t("background.description"),key));function hide(){setVisible(false)}function toggle(){if(d3.event)d3.event.preventDefault();tooltip.hide(button);setVisible(!button.classed("active"))}function setVisible(show){if(show!==shown){button.classed("active",show);shown=show;var buttonWidth=selection.node().offsetWidth;var outPanelWidth=300+buttonWidth;if(show){selection.on("mousedown.background-inside",function(){return d3.event.stopPropagation()});content.style("display","block").style("right",-outPanelWidth+"px").transition().duration(200).style("right",buttonWidth+"px")}else{content.style("display","block").style("right",buttonWidth+"px").transition().duration(200).style("right",-outPanelWidth+"px").each("end",function(){d3.select(this).style("display","none")});selection.on("mousedown.background-inside",null)}}}var button=selection.append("button").attr("tabindex",-1).on("click",toggle).call(tooltip),shown=false;button.append("span").attr("class","KDSEditor-icon layers light");content.call(context.ui().layermanager);context.surface().on("mousedown.background-outside",hide);context.container().on("mousedown.background-outside",hide)}return background};;;iD.ui.TagsClone=function(context,flag){var owner_ship="OWNER_SHIP";var src_flag="SRC_FLAG";var isAttrTask=true;var event=d3.dispatch("tags_cpoy"),selectedIDs,originalTags={},copyTags={};var tipUtil=iD.ui.TipUtil(context);var taskClass=iD.Task.d.task_classes;if(7==iD.Task.d.task_type){taskClass="attrtask"}var copyConfig={default:{displayedNames:["\u9053\u8DEF\u540D\u79F0","\u9053\u8DEF\u522B\u540D/\u66FE\u7528\u540D","\u9053\u8DEF\u7B49\u7EA7","\u9053\u8DEF\u6240\u6709","\u9053\u8DEF\u6784\u6210","FOW","\u9053\u8DEF\u884C\u9A76\u65B9\u5411","\u529F\u80FD\u7B49\u7EA7","LC1","LC2","\u9053\u8DEF\u7C7B\u578B","\u9053\u8DEF\u72B6\u6001","\u6536\u8D39\u9053\u8DEF","\u5E73\u5747\u8F66\u9053\u6570","\u6570\u636E\u6765\u6E90","\u9053\u8DEF\u5BBD\u5EA6","\u6536\u8D39\u9053\u8DEF","\u6389\u5934\u4E13\u7528\u9053\u8DEF","\u6B65\u884C\u901A\u884C\u72B6\u6001","\u6E32\u67D3\u5206\u7EA7","\u8D27\u8F66\u7981\u6B62\u4FE1\u606F"],displayedIds:["NAME_CHN","ALIAS_CHN","ROAD_CLASS","OWNER_SHIP","FORM_WAY","FOW","DIRECTION","FC","LC_1","LC_2","LINK_TYPE","STATUS","TOLL","AVE_LANES","SRC_FLAG","WIDTH","TOLL","U_LINE","NAVITYPE","REND_CLASS"]},6:{displayedNames:["\u9053\u8DEF\u540D\u79F0","\u9053\u8DEF\u522B\u540D/\u66FE\u7528\u540D","\u9053\u8DEF\u7B49\u7EA7","\u9053\u8DEF\u6240\u6709","\u9053\u8DEF\u6784\u6210","FOW","\u9053\u8DEF\u884C\u9A76\u65B9\u5411","\u529F\u80FD\u7B49\u7EA7","LC1","LC2","\u9053\u8DEF\u7C7B\u578B","\u9053\u8DEF\u72B6\u6001","\u6536\u8D39\u9053\u8DEF","\u5E73\u5747\u8F66\u9053\u6570","\u6570\u636E\u6765\u6E90","\u9053\u8DEF\u5BBD\u5EA6","\u6536\u8D39\u9053\u8DEF","\u6389\u5934\u4E13\u7528\u9053\u8DEF","\u6B65\u884C\u901A\u884C\u72B6\u6001","\u6E32\u67D3\u5206\u7EA7","\u8D27\u8F66\u7981\u6B62\u4FE1\u606F"],displayedIds:["name_chn","alias_chn","road_class","OWNER_SHIP","form_way","fow","direction","fc","lc_1","lc_2","link_type","status","toll","ave_lanes","SRC_FLAG","width","toll","u_line","navitype","rend_class"]},attrtask:{displayedNames:["\u901A\u884C\u65B9\u5411","\u9053\u8DEF\u540D\u79F0","\u9053\u8DEF\u62FC\u97F3","\u9053\u8DEF\u82F1\u6587\u540D\u79F0","\u9053\u8DEF\u522B\u540D","\u9053\u8DEF\u522B\u540D\u62FC\u97F3","\u9053\u8DEF\u522B\u540D\u82F1\u6587\u540D\u79F0","\u9053\u8DEF\u8DEF\u7EBF\u7F16\u53F7","\u9053\u8DEF\u7B49\u7EA7","\u529F\u80FD\u7B49\u7EA7FC","\u9053\u8DEF\u6784\u6210","\u9053\u8DEF\u7C7B\u578B","\u8F66\u9053\u6570","\u9053\u8DEF\u5BBD\u5EA6","\u6536\u8D39\u9053\u8DEF","\u9053\u8DEF\u72B6\u6001","\u9053\u8DEF\u6240\u6709","\u662F\u5426\u9AD8\u67B6\u9053\u8DEF","\u9053\u8DEF\u6240\u5728\u884C\u653F\u533A\u5212\u4EE3\u7801","\u5E02\u533A\u9053\u8DEF\u6807\u5FD7","\u6389\u5934\u4E13\u7528\u9053\u8DEF","\u6570\u636E\u6765\u6E90","\u9053\u8DEF\u94FA\u8BBE\u72B6\u6001","\u5B9E\u65F6\u8DEF\u51B5\u7B49\u7EA7","\u9053\u8DEF\u8DEF\u8FB9\u505C\u8F66\u5C5E\u6027\u6807\u8BC6","\u6E32\u67D3\u7B49\u7EA7","\u8F85\u8DEF\u6807\u8BC6","\u51FA\u5165\u53E3\u6807\u8BC6","\u533A\u57DF\u5F52\u5C5E","\u4F5C\u4E1A\u5458","\u751F\u4EA7\u53C2\u8003\u8D44\u6599","\u53C2\u8003\u8D44\u6599\u65F6\u6548","\u6807\u8BC6"],displayedIds:["DIRECTION","NAME_CHN","NAME_PY","NAME_ENG","ALIAS_CHN","ALIAS_PY","ALIAS_ENG","ROUTE_NO","ROAD_CLASS","FC","FORM_WAY","LINK_TYPE","S_LANES","WIDTH","TOLL_FLAG","STATUS","OWNER_SHIP","OVER_HEAD","AD_CODE","URBAN","U_LINE","SRC_FLAG","PAVER","T_TRLAYER","ROAD_PARK","REND_CLAS_S","SIDEROAD","RAMP","AREA_FLAG","OPERATOR","SOURCE","SDATE","FLAG"],selectAllIds:["NAME_CHN","ALIAS_CHN","FNAME_CHN","ROAD_CLASS","OWNER_SHIP","PARKING_RD","FORM_WAY","DIRECTION","AVE_LANES","LANE_WIDE","WIDTH","FOW","FC","LC_1","LC_2","LINK_TYPE","STATUS","TOLL","OVER_HEAD","PAVER","U_LINE","SRC_FLAG","AD_CODE","SIDEROAD","RAMP","NAVITYPE","VERIFYUSER","VERIFYTIME"],defaultIds:["DIRECTION","NAME_CHN","NAME_PY","ALIAS_CHN","ALIAS_PY","ROAD_CLASS","LINK_TYPE","OWNER_SHIP","FC","S_LANES","FORM_WAY","WIDTH","STATUS","SRC_FLAG"],ruleChange:{ave_lanes:"0",lane_wide:"0",width:"0"}},furniture:{displayedNames:["\u9053\u8DEF\u8BBE\u65BD\u7C7B\u578B","\u8F85\u52A9\u8BF4\u660E\u4FE1\u606F","\u9644\u52A0\u6587\u5B57\u4FE1\u606F","\u6570\u636E\u6765\u6E90","\u533A\u95F4\u9650\u901F\u7684\u65F6\u95F4\u9650\u5236","\u533A\u95F4\u9650\u901F\u7684\u5929\u6C14\u9650\u5236","\u533A\u95F4\u9650\u901F\u7684\u8F66\u8F86\u7C7B\u578B","\u5B63\u8282\u6027\u4EA4\u901A\u9650\u5236\u7C7B\u578B","\u8282\u5047\u65E5\u4EA4\u901A\u9650\u5236\u7C7B\u578B","\u53EF\u53D8\u9650\u901F\u724C\u7684\u4F4D\u7F6E"],displayedIds:["type","info","rf_text","SRC_FLAG","rule_time","weather","vehicle","season","holiday","rf_pos"]},WalkEnter:{displayedNames:["\u8BBE\u65BD\u540D\u79F0","\u5C42\u7EA7","\u8D44\u6599\u6765\u6E90"],displayedIds:["name_chn","loc_type","src"]},WalkLink:{displayedNames:["\u8BBE\u65BD\u540D\u79F0","\u8BBE\u65BD\u7C7B\u578B","\u7269\u7406\u5F62\u6001","\u662F\u5426\u6536\u8D39","\u906E\u6321\u6807\u8BC6","\u5EFA\u8BBE\u72B6\u6001","\u901A\u884C\u65B9\u5411","\u5761\u5EA6\u8D8B\u52BF","\u95E8\u7981\u7C7B\u578B","\u9053\u8DEF\u6240\u6709","\u5141\u8BB8\u901A\u884C\u65F6\u95F4","\u901A\u884C\u72B6\u6001","\u5907\u6CE8\u4FE1\u606F","\u8D44\u6599\u6765\u6E90","\u7EFF\u9053\u6807\u8BC6","\u9A91\u884C\u7B49\u7EA7","\u9A91\u884C\u65B9\u5411","\u533A\u57DF\u6807\u8BC6"],displayedIds:["name_chn","wf_type","link_type","istoll","covered","constatus","direction","slope","block_type","ownership","arule_time","navitype","note","src","greenway","bicycle","bi_dir","area_flag"]},WalkArea:{displayedNames:["\u8BBE\u65BD\u540D\u79F0","\u8BBE\u65BD\u7C7B\u578B","\u5C01\u95ED\u6807\u8BC6","\u8D44\u6599\u6765\u6E90"],displayedIds:["name_chn","wf_type","srca","src"]},lanepoint:{displayedNames:["\u8F66\u9053\u6570","\u5DE6\u4FA7\u53D8\u5316","\u53F3\u4FA7\u53D8\u5316","\u5DE6\u4FA7\u8FB9\u7F18\u7C7B\u578B","\u53F3\u4FA7\u8FB9\u7F18\u7C7B\u578B","\u5206\u5272\u7EBF\u7C7B\u578B","\u5206\u5272\u7EBF\u989C\u8272"],displayedIds:["lane_nums","change_l","change_r","bound_l","bound_r","div_type","div_clr"]}};function getTags(){if(flag==iD.data.DataType.ROAD){return getHighWayTags()}}function getLanePointTags(){if(!selectedIDs)return{};let copyLanePointID=localStorage.getItem("tags_copy_lanePoint"),lanePointEntity=context.entity(copyLanePointID),displayTags=[];let displayedIds=copyConfig["lanepoint"].displayedIds,displayedNames=copyConfig["lanepoint"].displayedNames;displayTags.push({id:31,name:"\u5168\u9009",data_value:""});for(let i=0;i<displayedIds.length;i++){for(let key in lanePointEntity.tags){if(displayedIds[i]==key){displayTags.push({id:key,data_value:lanePointEntity.tags[key],name:displayedNames[i]})}}}displayTags.push({id:"lanepoint_lane",name:"\u8F66\u9053\u5BF9\u8C61",data_value:""});return displayTags}function getWalkTags(datatype){if(!selectedIDs)return{};var copyWalkID;switch(datatype){case iD.data.DataType.WALKENTER:copyWalkID=localStorage.getItem("tags_copy_walkEnter");break;case iD.data.DataType.WALKLINK:copyWalkID=localStorage.getItem("tags_copy_walkLink");break;case iD.data.DataType.WALKAREA:copyWalkID=localStorage.getItem("tags_copy_walkArea");break;}var displayedIds=copyConfig[datatype].displayedIds,displayedNames=copyConfig[datatype].displayedNames,displayTags=[];var copyWalkEntity=context.entity(copyWalkID);displayTags.push({id:31,name:"\u5168\u9009",data_value:""});for(var i=0;i<displayedIds.length;i++){for(var key in copyWalkEntity.tags){if(displayedIds[i]==key){displayTags.push({id:key,data_value:copyWalkEntity.tags[key],name:displayedNames[i]})}}}return displayTags}function getRoadFurnitureTags(){if(!selectedIDs)return{};var copyFurnitureID=localStorage.getItem("s_map_editor_copy_wayId"),furnitureEntity=context.entity(copyFurnitureID),displayTags=[];var displayedIds=copyConfig["furniture"].displayedIds,displayedNames=copyConfig["furniture"].displayedNames;displayTags.push({id:31,name:"\u5168\u9009",data_value:""});for(var i=0;i<displayedIds.length;i++){for(var key in furnitureEntity.tags){if(displayedIds[i]==key){displayTags.push({id:key,data_value:furnitureEntity.tags[key],name:displayedNames[i]})}}}return displayTags}function getHighWayTags(){if(!selectedIDs)return{};var first=localStorage.getItem("s_map_editor_copy_wayId"),copyWay=context.entity(first);var displayedIds=[],displayedNames=[],displayTags=[];copyTags=copyWay.tags;if(!isAttrTask){displayTags.push({id:31,name:"\u5168\u9009",data_value:""})}if(isAttrTask){displayedIds=copyConfig["attrtask"].displayedIds;displayedNames=copyConfig["attrtask"].displayedNames}else{displayedIds=copyConfig["default"].displayedIds;displayedNames=copyConfig["default"].displayedNames}for(var i=0;i<displayedIds.length;i++){var roadruleArr=[];if("roadrule"==displayedIds[i]){let rels=editor.context.graph().parentRelations(copyWay);rels.map(rel=>{if(rel.modelName==iD.data.DataType.ROADRULE){roadruleArr.push(rel)}});displayTags.push({id:displayedIds[i],data_value:JSON.stringify(roadruleArr),name:displayedNames[i]});continue}for(var key in copyWay.tags){if(displayedIds[i]==key){displayTags.push({id:key,data_value:copyWay.tags[key],name:displayedNames[i]})}}}return displayTags}function forceLinage(tags){var d={};if(tags.status&&("2"==tags.status||"4"==tags.direction||"17"==tags.form_way)){d.fc="6";d.lc_1="0";d.lc_2="0"}if(tags.link_type&&"1"==tags.link_type&&"0"==tags.navitype){d.road_class="45000"}if(tags.link_type&&"5"==tags.link_type&&"0"==tags.navitype){d.road_class="49"}if(tags.form_way&&("17"==tags.form_way||"59"==tags.form_way)){d.road_class="47000"}if(tags.link_type&&"1"==tags.link_type){d.direction="1";d.fow="-1"}if(tags.direction&&"4"==tags.direction){d.form_way="15";d.link_type="0";d[owner_ship]="0";d.status="0";d.ave_lanes="1";d.width="3"}if(tags.link_type&&"1"==tags.link_type){d.form_way="15";d.toll="0";d.ave_lanes="1";d.width="3"}if(tags.status&&"2"==tags.status){d.toll="0"}if(tags.road_class&&("41000"==tags.road_class||"43000"==tags.road_class)){d[owner_ship]="0";d.paver="2"}if(tags.form_way&&"59"==tags.form_way){d[owner_ship]="1"}if(tags.form_way&&"4"==tags.form_way){d.fow="4"}if(tags.form_way&&"5"==tags.form_way){d.fow="12"}if(tags.direction&&"4"==tags.direction&&tags.road_class&&"100"!=tags.road_class){d.fow="14"}if(tags.parking_rd&&("3"==tags.parking_rd||"4"==tags.parking_rd)){d.fow="7"}if(tags.navitype&&("0"==tags.navitype||"1"==tags.navitype||"2"==tags.navitype||"3"==tags.navitype)){if(!(tags.road_class&&"49"==tags.road_class&&tags.navitype&&"1"==tags.navitype)){if("41000"==tags.road_class||"43000"==tags.road_class||tags.form_way&&("3"==tags.form_way||"8"==tags.form_way||"9"==tags.form_way||"10"==tags.form_way||"13"==tags.form_way||"14"==tags.form_way)||tags[owner_ship]&&"3"==tags[owner_ship]&&"4"==tags[owner_ship]||"1"==tags.u_line){d.navitype="2"}}else{d.navitype="0"}}if(tags.direction&&"2"==tags.direction){d.p_lanes=tags.ave_lanes;d.n_lanes="0"}if(tags.direction&&"3"==tags.direction){d.n_lanes=tags.ave_lanes;d.p_lanes="0"}if(tags.direction&&("1"==tags.direction||"4"==tags.direction)){d.ave_lanes="1";d.p_lanes="1";d.n_lanes="1"}return d}function linkageAttribute(selectedTags){var owner_ship=iD.data.Tags.OWNERSHIP;if(isAttrTask){if(selectedTags[src_flag+"_merge"]!=undefined){var originalSrcFlag=iD.util.toRevBinary32(originalTags[src_flag]);var copyWaySrcFlag=iD.util.toRevBinary32(copyTags[src_flag]);var arr=[];for(var i=0;32>i;i++){if("1"==originalSrcFlag.charAt(i)||"1"==copyWaySrcFlag.charAt(i)){arr.push(i)}}selectedTags[src_flag]=iD.util.srcFlagBuild(arr).toString();delete selectedTags[src_flag+"_merge"]}}else if(iD.Task.working.task_classes==iD.data.TaskClass.BASEROAD){if("undefined"!=typeof selectedTags.direction&&"4"==selectedTags.direction){selectedTags.fow="14";selectedTags.status="0";selectedTags.link_type="0";selectedTags[owner_ship]="0";selectedTags.ave_lanes="1";selectedTags.width="3";selectedTags.fc="6";selectedTags.lc_1="0";selectedTags.lc_2="0"}if("undefined"!=typeof selectedTags.form_way&&"4"==selectedTags.form_way){selectedTags.fow="4"}if("undefined"!=typeof selectedTags.link_type&&"1"==selectedTags.link_type){if("0"==originalTags["navitype"]){selectedTags.ave_lanes="1";selectedTags.width="3";selectedTags.form_way="15";selectedTags.direction="1";selectedTags.road_class="45000";selectedTags.fow="-1"}else if("1"==originalTags["navitype"]){selectedTags.ave_lanes="1";selectedTags.width="3";selectedTags.form_way="15";selectedTags.direction="1";selectedTags.road_class="49";selectedTags.fow="-1"}}if("undefined"!=typeof selectedTags.road_class){if("41000"!=originalTags.road_class&&"43000"!=originalTags.road_class&&("41000"==selectedTags.road_class||"43000"==selectedTags.road_class)){selectedTags.lane_wide="3.50";var width;if("undefined"!=typeof selectedTags.ave_lanes){width=3.5*selectedTags.ave_lanes}else{width=3.5*originalTags.ave_lanes}width=width.toFixed(1).toString();selectedTags.width=width}else if(("41000"==originalTags.road_class||"43000"==originalTags.road_class)&&"41000"!=selectedTags.road_class&&"43000"!=selectedTags.road_class){selectedTags.lane_wide="3.00";var width;if("undefined"!=typeof selectedTags.ave_lanes){width=3.5*selectedTags.ave_lanes}else{width=3.5*originalTags.ave_lanes}width=width.toFixed().toString();selectedTags.width=width}}if("undefined"!=typeof selectedTags.direction){var ave_lanes;if("undefined"!=typeof selectedTags.ave_lanes){ave_lanes=selectedTags.ave_lanes}else{ave_lanes=originalTags.ave_lanes}if("2"==selectedTags.direction){selectedTags.p_lanes=ave_lanes;selectedTags.n_lanes="0"}else if("3"==selectedTags.direction){selectedTags.n_lanes=ave_lanes;selectedTags.p_lanes="0"}else if(("1"==selectedTags.direction||"4"==selectedTags.direction)&&"1"==ave_lanes){selectedTags.p_lanes="1";selectedTags.n_lanes="1"}}if("undefined"!=typeof selectedTags.parking_rd&&("4"==selectedTags.parking_rd||"5"==selectedTags.parking_rd)){selectedTags.fow="7"}}else{var roadClass=selectedTags["road_class"];if(""==roadClass){selectedTags["fc"]=originalTags.fc;selectedTags["lc_1"]=originalTags.lc_1;selectedTags["lc_2"]=originalTags.lc_2}}return selectedTags}function tagsClone(selection){var modal=iD.ui.modal(selection);modal.select(".modal").attr("class","modal-splash modal KDSEditor-col6");modal.select("button.close").attr("class","hide");var cloneTagsDiv=modal.append("div").attr("class","cloneTagsDiv").attr("id","cloneTagsDiv");var cloneTags=d3.select(".cloneTagsDiv");var restriction=cloneTags.append("div").attr("class","cloneTags").attr("id","cloneTags");var titleTable=restriction.append("table").attr("class","cloneAttr-title-table").attr("id","cloneAttr-title-table").attr("cellspacing","0");var tbody=titleTable.append("tbody");var tr=tbody.append("tr");tr.append("td").attr("class","cloneAttr-title-content-td").text("\u5C5E\u6027\u7C98\u8D34");tr.append("td").attr("class","cloneAttr-title-close-td").on("click",function(){btnClose()}).append("span").attr("class","cloneAttr-title-close-span").text("\xD7");var wrap=restriction.append("div");drawTagsDetail();if(isAttrTask){d3.select("#cloneTags").style("width","550px");d3.selectAll(".cloneTagsDiv .rule-list-info .item-type").style("width","33%")}function drawTagsDetail(){var items=wrap.html("");var carRule=items.append("div").attr("class","rule-list-info");var cbList=carRule.selectAll(".item-type").data(getTags(),function(d){return d.id});var cbEnter=cbList.enter().append("div").attr("class","item-type");cbEnter.append("input").attr("type","checkbox").attr("class","car-value");cbEnter.append("label").attr("class","car-name").style("position","relative").style("margin-left","-54px");cbEnter.select("input.car-value").property("checked",function(d){if(isAttrTask){var defaultIds=copyConfig["attrtask"].defaultIds;if(copyConfig["attrtask"].defaultIds){for(var i=0;i<defaultIds.length;i++){if(defaultIds[i]==d.id){return true}}return false}}return true}).on("change",tagChange).attr("data-value",function(d){return d.data_value}).property("value",function(d){return d.id});cbEnter.select("label.car-name").html(function(d){return d.name});var bottom=items.append("div").attr("class","clone-button-content").style("float","right");if(isAttrTask){bottom.append("input").attr("type","button").attr("class","attrButton").on("click",function(){var selectAllIds=copyConfig["attrtask"].selectAllIds;d3.selectAll(".cloneTagsDiv .rule-list-info .item-type .car-value").property("checked",function(d){var res=false;selectAllIds.forEach(function(id){if(d.id==id){res=true;return}});return res})}).property("value","\u4E3B\u8981");bottom[0][0].append(" ");bottom.append("input").attr("type","button").attr("class","attrButton").on("click",function(){var selectAllIds=copyConfig["attrtask"].displayedIds;d3.selectAll(".cloneTagsDiv .rule-list-info .item-type .car-value").property("checked",function(d){var res=false;selectAllIds.forEach(function(id){if(d.id==id){res=true;return}});return res})}).property("value","\u5168\u9009");bottom[0][0].append(" ");bottom.append("input").attr("type","button").attr("class","attrButton").on("click",function(){d3.selectAll(".cloneTagsDiv .rule-list-info .item-type .car-value")[0].forEach(item=>{if("roadrule"!==item.value){d3.select(item).property("checked",false)}})}).property("value","\u53D6\u6D88\u5168\u9009");bottom[0][0].append(" ");bottom.append("input").attr("type","button").attr("class","attrButton").on("click",btnEditRule).property("value","\u786E\u5B9A");bottom[0][0].append(" ");bottom.append("input").attr("type","button").attr("class","attrButton").on("click",btnClose).property("value","\u53D6\u6D88")}else{bottom.append("input").attr("type","button").attr("class","clone-ok").on("click",btnEditRule).property("value","\u786E\u5B9A");bottom[0][0].append(" ");bottom.append("input").attr("type","button").attr("class","clone-cancel").on("click",btnClose).property("value","\u53D6\u6D88")}}function tagChange(d){if(isAttrTask){var ruleChange=copyConfig["attrtask"].ruleChange}var tags=_.without(_.map(getTags(),function(item){return item.id}),31),inputs=d3.selectAll("input.car-value"),selectedIds=[];if("roadrule"===d.id&&this.checked){inputs.filter(item=>{return"roadrule"!==item.id}).property("checked",false)}else if("roadrule"!==d.id&&this.checked){inputs.filter(item=>{return"roadrule"===item.id}).property("checked",false);if(31==d.id){inputs.filter(item=>{return"roadrule"!==item.id}).property("checked",true)}}else if(31===d.id){inputs.filter(function(item){return item.id!==d.id}).property("checked",this.checked)}else if(isAttrTask&&ruleChange[d.id]){var res=this.checked;inputs.property("checked",function(item){if(ruleChange[item.id]){return res}})}else{var allTagObj=inputs.filter(function(item){return 31===item.id});allTagObj.property("checked",false)}}function btnEditRule(){var selectedTags={},roadRuleValue="";let selLaneObject=false;d3.selectAll("input.car-value").each(function(d){if(this.checked&&"roadrule"===d.id){roadRuleValue=d.data_value}else if(this.checked&&31!==d.id&&"lanepoint_lane"!=d.id){selectedTags[d.id]=d.data_value}else if(this.checked&&"lanepoint_lane"===d.id){selLaneObject=true}});var actions=[],dlgPromp=false;let lanePointRelations=[];for(let i=0,l=selectedIDs.length;i<l;i++){let selectedID=selectedIDs[i];var graph=context.graph();var way=graph.entity(selectedID);originalTags=way.tags;var selTags=_.clone(selectedTags);if(way.modelName==iD.data.DataType.HIGHWAY){var tags=way.tags;for(var key in tags){if(0==key.indexOf("alias_chn")&&"alias_chn"!=key){delete tags[key]}}selTags=linkageAttribute(selTags);if("undefined"!=typeof selTags[owner_ship]&&"1"==selTags[owner_ship]&&"undefined"!=typeof way.tags.road_class&&0<=["41000","42000","43000","44000","51000","52000"].indexOf(way.tags.road_class)){dlgPromp=true}}var annotation=t("operations.clone_tags.annotation.road");if(way.modelName==iD.data.DataType.ROADFURNITURE){annotation=t("operations.clone_furniture.annotation.road")}if(way.modelName===iD.data.DataType.LANEPOINT&&selLaneObject){annotation=t("operations.clone_lanePoint.annotation.lanePoint");let copyLanePointID=localStorage.getItem("tags_copy_lanePoint"),lanePointEntity=context.entity(copyLanePointID);let copyLane=context.graph().parentRelations(lanePointEntity,iD.data.DataType.LANE);if(copyLane){let srcLane=context.graph().parentRelations(way,iD.data.DataType.LANE);for(let k=0;k<srcLane.length;++k){lanePointRelations.push(iD.actions.DeleteRelation(srcLane[k].id))}if(selTags.lane_nums){for(let k=0;k<copyLane.length;++k){let laneType=copyLane[k].tags.lane_type;let laneNo=copyLane[k].tags.lane_no;lanePointRelations.push(iD.actions.CreateLane(context,way,{},laneNo,laneType))}}else{for(let k=0;k<srcLane.length;++k){let srcLaneNo=srcLane[k].tags.lane_no;for(let h=0;h<copyLane.length;++h){let laneType=copyLane[h].tags.lane_type;let copyLaneNo=copyLane[h].tags.lane_no;if(srcLaneNo==copyLaneNo){lanePointRelations.push(iD.actions.CreateLane(context,way,{},copyLaneNo,laneType));break}}}}}}if(2>Object.keys(selTags).length&&!canPasteRoadRule(way,roadRuleValue)&&way.modelName!==iD.data.DataType.LANEPOINT){return}actions.push({way:way,note:annotation,tags:selTags});pasteRoadRule(way,roadRuleValue)}function canPasteRoadRule(way,roadRuleValue){if(""==roadRuleValue||way.modelName!=iD.data.DataType.HIGHWAY){btnClose();return false}let copyWayId=localStorage.getItem("s_map_editor_copy_wayId");let copyWay=context.graph().entity(copyWayId);if(0!=context.graph().parentRelations(way,iD.data.DataType.ROADRULE).length){btnClose();DialogEx.message(MsgSrc.WEB,"\u88AB\u9009\u4E2D\u9053\u8DEF\u4E2D\u5B58\u5728\u8D27\u8F66\u7981\u6B62\u4FE1\u606F\uFF0C\u4E0D\u80FD\u8FDB\u884C\u7C98\u8D34\uFF01");return false}if("4"==way.tags.direction||"4"==copyWay.tags.direction){btnClose();DialogEx.message(MsgSrc.WEB,"\u590D\u5236\u6216\u7C98\u8D34\u7684\u9053\u8DEF\u4E2D\u5B58\u5728\u53CC\u5411\u7981\u884C\u7684\u9053\u8DEF\uFF0C\u4E0D\u80FD\u8FDB\u884C\u7C98\u8D34\uFF01");return false}return true}function pasteRoadRule(way,roadRuleValue){if(way.modelName!=iD.data.DataType.HIGHWAY||""==roadRuleValue)return;let copyWayId=localStorage.getItem("s_map_editor_copy_wayId");let copyWay=context.graph().entity(copyWayId);let newRoadRuleArr=JSON.parse(roadRuleValue);newRoadRuleArr.map(rule=>{let roadRuleMember=[{id:way.id,role:"road",type:"Highway"}];let validKeys=["rule_type","rule_flag","vehicle","rule_time","holiday","season","truck_load","truck_axle","truck_wt","yellow","datatype"];let pasteTags={};validKeys.map(item=>{pasteTags[item]=rule.tags[item]});if("1"==copyWay.tags.direction&&"2"==way.tags.direction){pasteTags["dir"]="1"}else if("1"==copyWay.tags.direction&&"3"==way.tags.direction){pasteTags["dir"]="2"}else if(-1!=["2","3"].indexOf(copyWay.tags.direction)&&"1"==way.tags.direction){pasteTags["dir"]="0"}else if("1"==copyWay.tags.direction&&"1"==way.tags.direction){pasteTags["dir"]=rule.tags["dir"]}else if(-1!=["2","3"].indexOf(copyWay.tags.direction)&&-1!=["2","3"].indexOf(way.tags.direction)){switch(way.tags.direction){case"2":pasteTags["dir"]="1";break;case"3":pasteTags["dir"]="2";break;}}context.replace(iD.actions.AddEntity(iD.Relation({tags:pasteTags,members:roadRuleMember,layerId:rule.layerId})))})}function doAction(){var item=actions[0];item.way=item.way.mergeTags(item.tags);context.perform(iD.actions.AddEntity(item.way),item.note);for(var i=1;i<actions.length;i++){item=actions[i];if(item.way){item.way=item.way.mergeTags(item.tags);context.replace(iD.actions.AddEntity(item.way),item.note)}}if(0<lanePointRelations.length){context.perform.apply(this,lanePointRelations)}}function okAction(){var item=actions[0];delete item.tags[owner_ship];item.way=item.way.mergeTags(item.tags);context.perform(iD.actions.AddEntity(item.way),item.note);for(var i=1;i<actions.length;i++){item=actions[i];if(item.way){delete item.tags[owner_ship];item.way=item.way.mergeTags(item.tags);context.replace(iD.actions.AddEntity(item.way),item.note)}}}if(0<actions.length||0<lanePointRelations.length){if(dlgPromp){DialogEx.confirm(MsgSrc.WEB,"\u9053\u8DEF\u6240\u6709\u4E3A\u5185\u90E8\u9053\u8DEF\uFF0C\u4E0E\u5F53\u524D\u6240\u9009\u9053\u8DEF\u7B49\u7EA7\u51B2\u7A81\uFF0841\u300142\u300143\u300144\u300151\u300152\uFF09\uFF0C\u662F\u5426\u53D6\u6D88\u9053\u8DEF\u6240\u6709\u52FE\u9009\u9879\u5E76\u7C98\u8D34\u5176\u4ED6\u5C5E\u6027?",okAction,doAction)}else{doAction()}}btnClose()}function btnClose(){modal.close()}new tipUtil.dragDrop({target:document.getElementById("cloneTags"),bridge:document.getElementById("cloneAttr-title-table")})};tagsClone.selectedIDs=function(_){if(!arguments.length)return selectedIDs;selectedIDs=_;return tagsClone};return d3.rebind(tagsClone,event,"on")};;;;iD.opendialog=d3.widget("opendialog",{options:{appendTo:"body",autoOpen:true,buttons:[],closeOnEscape:true,draggable:true,resizable:false,minbtn:true,maxbtn:true,closebtn:true,onTask:false,onlayResizeTop:false,resizeMinHeight:0,resizeMaxHeight:0,width:300,height:300,modal:false,title:null,content:null,tagEntities:[],position:{of:window,at:"center middle",my:"center middle"},destroyOnClose:true,beforeClose:null,close:null,open:null,onDragEnd:_.noop,onDrag:_.noop},mouseOptions:{draging:false},currentEntity:null,_create:function(){this.uiAppendTo=d3.$(this.options.appendTo);if(0!=d3.selectAll(".opendialog").size()){d3.selectAll(".opendialog").remove()}this._createWrapper();this._createTitlebar();this._createContent();this._createBottomButton();this._createEdgeAndAngle()},_createWrapper:function(){this.uiDialog=this.uiAppendTo.append("div");this._addClass(this.uiDialog,"opendialog");this.uiDialog.style("left",(document.documentElement.clientWidth-this.uiDialog[0][0].offsetWidth)/2+"px");this.uiDialog.style("top",(document.documentElement.clientHeight-this.uiDialog[0][0].offsetHeight)/2+"px");this.uiDialog.style("width",this.options.width+53+"px");this.uiDialog.style("height",this.options.height+66+"px")},_createTitlebar:function(){var self=this;this.uiDialogTitle=this.uiDialog.append("div").on("mousedown",function(event){if(self.options.draggable){var event=event||window.event;var disX=event.clientX-self.uiDialog[0][0].offsetLeft;var disY=event.clientY-self.uiDialog[0][0].offsetTop;self.mouseOptions.draging=true;this.onfocus=function(){this.blur()};(event||window.event).cancelBubble=true;d3.select("body").on("mousemove.title",function(event){if(!self.mouseOptions.draging)return;var event=event||window.event;var iL=event.clientX-disX;var iT=event.clientY-disY;var maxL=document.documentElement.clientWidth-self.uiDialog[0][0].offsetWidth;var maxT=document.documentElement.clientHeight-self.uiDialog[0][0].offsetHeight;0>=iL&&(iL=0);0>=iT&&(iT=0);iL>=maxL&&(iL=maxL);iT>=maxT&&(iT=maxT);self.uiDialog.style("left",iL+"px");self.uiDialog.style("top",iT+"px");return false});d3.select("body").on("mouseup.title",function(){if(!self.mouseOptions.draging)return;self.mouseOptions.draging=false;d3.select("body").on("mousemove.title",null);d3.select("body").on("mouseup.title",null)})}});this._addClass(this.uiDialogTitle,"title");var _title=this.uiDialogTitle.append("h2").text(this.options.title);var _titlebtn=this.uiDialogTitle.append("div");if(this.options.minbtn){_titlebtn.append("a").attr("href","javascript:;").attr("class","min").attr("title","\u6700\u5C0F\u5316").on("click",function(){self._minAndCloseBtnCallback(self)})}if(this.options.maxbtn){_titlebtn.append("a").attr("class","max").attr("href","javascript:;").attr("title","\u6700\u5927\u5316").on("click",function(){self.uiDialog.style("top",0);self.uiDialog.style("left",0);self.uiDialog.style("width",document.documentElement.clientWidth-2+"px");self.uiDialog.style("height",document.documentElement.clientHeight-2+"px");this.style.display="none";d3.select(".revert").style("display","block")})}_titlebtn.append("a").attr("class","revert").attr("href","javascript:;").attr("title","\u8FD8\u539F").on("click",function(){self.uiDialog.style("width",self.options.width+53+"px");self.uiDialog.style("height","auto"==self.options.height?self.options.height:self.options.height+50+"px");self.uiDialog.style("left",(document.documentElement.clientWidth-self.uiDialog[0][0].offsetWidth)/2+"px");self.uiDialog.style("top",(document.documentElement.clientHeight-self.uiDialog[0][0].offsetHeight)/2+"px");this.style.display="none";d3.select(".max").style("display","block")});if(this.options.closebtn){_titlebtn.append("a").attr("class","close").attr("href","javascript:;").attr("title","\u5173\u95ED").on("click",function(){self.uiDialog.remove();editor.context.enter(iD.modes.Browse(editor.context))})}},_createEdgeAndAngle:function(){var oL=this.uiDialog.append("div").attr("class","resizeL");var oT=this.uiDialog.append("div").attr("class","resizeT");var oR=this.uiDialog.append("div").attr("class","resizeR");var oB=this.uiDialog.append("div").attr("class","resizeB");var oLT=this.uiDialog.append("div").attr("class","resizeLT");var oTR=this.uiDialog.append("div").attr("class","resizeTR");var oBR=this.uiDialog.append("div").attr("class","resizeBR");var oLB=this.uiDialog.append("div").attr("class","resizeLB");if(this.options.resizable){this._resize(this.uiDialog,oLT,true,true,false,false);this._resize(this.uiDialog,oTR,false,true,false,false);this._resize(this.uiDialog,oBR,false,false,false,false);this._resize(this.uiDialog,oLB,true,false,false,false);this._resize(this.uiDialog,oL,true,false,false,true);this._resize(this.uiDialog,oT,false,true,true,false);this._resize(this.uiDialog,oR,false,false,false,true);this._resize(this.uiDialog,oB,false,false,true,false)}},_createContent:function(){this.uiDialog.append("div").attr("class","content").html(this.options.content)},_createBottomButton:function(){var self=this;var bbutton=this.uiDialog.append("div").attr("class","button").style("width",this.options.width+53+"px");bbutton.append("div").html("<<").attr("title","\u4E0A\u4E00\u4E2A").on("click",function(){var tagEntities=self._getEntities();var currentEntityId=self.uiDialog.select(".title h2").html();var index={i:-1,pre:-1};for(var i=0;i<tagEntities.length;i++){if(currentEntityId==tagEntities[i].id){index.i=i;index.pre=i-1}}var entity=tagEntities[index.pre];if(!entity){entity=tagEntities[index.i]}editor.context.ui().openDialog.showTag([entity]);editor.setCenter(entity.loc);editor.context.enter(iD.modes.Select(editor.context,[entity.id],null,true))});bbutton.append("div").style("right",0).html(">>").attr("title","\u4E0B\u4E00\u4E2A").on("click",function(){var tagEntities=self._getEntities();var currentEntityId=self.uiDialog.select(".title h2").html();var index={i:-1,next:-1};for(var i=0;i<tagEntities.length;i++){if(currentEntityId==tagEntities[i].id){index.i=i;index.next=i+1}}var entity=tagEntities[index.next];if(!entity){entity=tagEntities[index.i]}editor.context.ui().openDialog.showTag([entity]);editor.setCenter(entity.loc);editor.context.enter(iD.modes.Select(editor.context,[entity.id],null,true))})},_getEntities:function(){var modelNames=[iD.data.DataType.ANALYSIS_TAG,iD.data.DataType.QUESTION_TAG],tagEntities=[];var entities=editor.context.intersects(iD.geo.Extent([-Infinity,-Infinity],[Infinity,Infinity]));for(var i=0;i<entities.length;i++){var e=entities[i];if(-1!=_.indexOf(modelNames,e.modelName)){tagEntities.push(e)}}return tagEntities},_minAndCloseBtnCallback:function(){var dialog=d3.select(".opendialog"),self=this;dialog.style("display","none");this.uiAppendTo.append("a").attr("class","open").attr("href","javascript:;").attr("title","\u8FD8\u539F").on("click",function(){dialog.style("display","block");this.remove()})},_destroy:function(){this._keybinding.off();this.uiDialog.remove();if(this.options.resizable){this._off(this.document,"mouseup.dialogresizable");this._off(this.document,"mousemove.dialogresizable")}this._destroyOverlay()},_resize:function(oParent,handle,isLeft,isTop,lockX,lockY){var self=this,disX,disY,iParentTop,iParentLeft,iParentWidth,iParentHeight;handle.on("mousedown",function(event){var event=event||window.event;disX=event.clientX-handle[0][0].offsetLeft;disY=event.clientY-handle[0][0].offsetTop;iParentTop=oParent[0][0].offsetTop;iParentLeft=oParent[0][0].offsetLeft;iParentWidth=oParent[0][0].offsetWidth;iParentHeight=oParent[0][0].offsetHeight;self.mouseOptions.draging=true;d3.select("body").on("mousemove.resize",function(event){if(!self.mouseOptions.draging)return;var event=event||window.event;var iL=event.clientX-disX;var iT=event.clientY-disY;var maxW=document.documentElement.clientWidth-oParent[0][0].offsetLeft-2;var maxH=document.documentElement.clientHeight-oParent[0][0].offsetTop-2;var iW=isLeft?iParentWidth-iL:handle[0][0].offsetWidth+iL;var iH=isTop?iParentHeight-iT:handle[0][0].offsetHeight+iT;isLeft&&oParent.style("left",iParentLeft+iL+"px");isTop&&oParent.style("top",iParentTop+iT+"px");iW<self.options.width+53&&(iW=self.options.width+53);iW>maxW&&(iW=maxW);lockX||oParent.style("width",iW+"px");iH<self.options.height+50&&(iH=self.options.height+50);iH>maxH&&(iH=maxH);lockY||oParent.style("height",iH+"px");if(isLeft&&iW==self.options.width||isTop&&iH==self.options.height)self.mouseOptions.draging=false;self.uiDialog.select(".button").style("width",iW+"px");return false});d3.select("body").on("mouseup.resize",function(){if(!self.mouseOptions.draging)return;self.mouseOptions.draging=false;d3.select("body").on("mousemove.resize",null);d3.select("body").on("mouseup.resize",null)})});return false}});;;iD.ui.Modes=function(context){var modes=[iD.modes.AddPoint(context),iD.modes.AddLine(context),iD.modes.AddArea(context)];return function(selection){var buttons=selection.selectAll("button.add-button").data(modes);buttons.enter().append("button").attr("tabindex",-1).attr("class",function(mode){return mode.id+" add-button KDSEditor-col4"}).on("click.mode-buttons",function(mode){if(mode.id===context.mode().id){context.enter(iD.modes.Browse(context))}else{context.enter(mode)}}).call(bootstrap.tooltip().placement("bottom").html(true).title(function(mode){return iD.ui.tooltipHtml(mode.description,mode.key)}));context.map().on("move.modes",_.debounce(update,500));context.ui().layermanager.on("nodisplay.modes",function(d){var bb=false;buttons.each(function(o){if(d3.select(this).classed("active"))bb=true});if(bb){alert("\u8BF7\u9000\u51FA\u7F16\u8F91\u64CD\u4F5C\u6A21\u5F0F")}context.barButtonActive2=bb});context.on("enter.modes",update);update();buttons.append("span").attr("class",function(mode){return mode.id+" KDSEditor-icon KDSEditor-icon-pre-text"});buttons.append("span").attr("class","label").text(function(mode){return mode.title});context.on("enter.editor",function(entered){var layer=context.layers().getLayer();if(layer&&layer.isRoad())return;if("road"!=entered.type){buttons.classed("active",function(mode){return entered.button===mode.button})}context.container().classed("mode-"+entered.id,true)});context.on("exit.editor",function(exited){outDrawLineMode();context.container().classed("mode-"+exited.id,false)});function outDrawLineMode(){var layer=context.layers().getLayer();if(layer&&layer.isRoad()&&context.__road_line_btn___){context.__road_line_btn___.classed("active",false);context.__road_line_btn___=null;delete context.__road_line_btn___}}var keybinding=d3.keybinding("mode-buttons");modes.forEach(function(m){keybinding.on(m.key,function(){buttons.each(function(o){if(m.button===o.button&&!d3.select(this).property("disabled")){if(context.editable())context.enter(m)}})})});d3.select(document).call(keybinding);function update(){var currLayer=context.layers().getLayer();if(context.map().editable()){buttons.each(function(o){var b=true;if(currLayer&&currLayer.type==o.button){b=false}d3.select(this).property("disabled",b)})}else{buttons.property("disabled",true)}setButtonVisible()}function setButtonVisible(){var currLayer=context.layers().getLayer();buttons.each(function(){if(this.disabled)this.style.display="none";else this.style.display="block";this.style.width="43px";if(currLayer&&currLayer.isArea())this.style.width="42px";this.parentNode.style.width="53px";this.style.borderRadius="4px 4px 4px 4px"})}}};;;iD.ui.Help=function(context){var key="h";var docKeys=["help.help","help.editing_saving","help.roads","help.gps","help.imagery","help.addresses","help.inspector","help.buildings","help.relations"];var docs=docKeys.map(function(key){var text=t(key);return{title:text.split("\n")[0].replace("#","").trim(),html:marked(text.split("\n").slice(1).join("\n"))}});function help(selection){var shown=false;function hide(){setVisible(false)}function toggle(){if(d3.event)d3.event.preventDefault();tooltip.hide(button);setVisible(!button.classed("active"))}function setVisible(show){if(show!==shown){button.classed("active",show);shown=show;if(show){pane.style("display","block").style("right","-500px").transition().duration(200).style("right","0px")}else{pane.style("right","0px").transition().duration(200).style("right","-500px").each("end",function(){d3.select(this).style("display","none")})}}}function clickHelp(d,i){pane.property("scrollTop",0);doctitle.text(d.title);body.html(d.html);body.selectAll("a").attr("target","_blank");menuItems.classed("selected",function(m){return m.title===d.title});nav.html("");if(0<i){var prevLink=nav.append("a").attr("class","previous").on("click",function(){clickHelp(docs[i-1],i-1)});prevLink.append("span").attr("class","KDSEditor-icon back blue");prevLink.append("span").text(docs[i-1].title)}if(i<docs.length-1){var nextLink=nav.append("a").attr("class","next").on("click",function(){clickHelp(docs[i+1],i+1)});nextLink.append("span").text(docs[i+1].title);nextLink.append("span").attr("class","KDSEditor-icon forward blue")}}function clickWalkthrough(){d3.select(document.body).call(iD.ui.intro(context));setVisible(false)}var tooltip=bootstrap.tooltip().placement("left").html(true).title(iD.ui.tooltipHtml(t("help.title"),key));var button=selection.append("button").attr("tabindex",-1).on("click",toggle).call(tooltip);button.append("span").attr("class","KDSEditor-icon help light");var pane=context.container().select(".help-wrap");var toc=pane.append("ul").attr("class","toc");var menuItems=toc.selectAll("li").data(docs).enter().append("li").append("a").text(function(d){return d.title}).on("click",clickHelp);toc.append("li").attr("class","walkthrough").append("a").text(t("splash.walkthrough")).on("click",clickWalkthrough);var content=pane.append("div").attr("class","left-content");var doctitle=content.append("h2").text(t("help.title"));var body=content.append("div").attr("class","body");var nav=content.append("div").attr("class","nav");clickHelp(docs[0],0);var keybinding=d3.keybinding("help").on(key,toggle);d3.select(document).call(keybinding);context.surface().on("mousedown.help-outside",hide);context.container().on("mousedown.b.help-outside",hide);pane.on("mousedown.help-inside",function(){return d3.event.stopPropagation()})}return help};;;iD.ui.ZoomLevel=function(map){return function(selection){var button=selection.append("button").attr("tabindex",-1).attr("title",t("zoom_level.title")).call(bootstrap.tooltip().placement("left"));var level=button.append("span").attr("class","zoomlevel");function update(){level.html(map.zoom())}update();map.on("move.zoomlevel",update)}};;;iD.ui.LayerManager=function(context){var dispatch=d3.dispatch("change","setting","nodisplay","sublayerlist","video","tag","pano","background","hotspot","pic","walkEdit","roadEdit","pointEdit"),modelEntityLoaded=false,selection;function dispatchPic(d){return true}function drawList(selection,subConfigLayers){var root={};var staticLayers=subConfigLayers?subConfigLayers:getStaticLayers();if(!staticLayers){return}for(var rootLayer in staticLayers){var layerData=staticLayers[rootLayer];var layer=selection.append("div").attr("class","root");layer.append("div").text(function(d){return d.name}).classed("dropdown",true).on("click",function(d){var root=d3.select(this.parentNode);root.classed("close",!root.classed("close"))});var menu=layer.append("ul").classed("dropdown-menu",true);var sublayers=false;var sublayersObject=null;var items=menu.selectAll(".item").data(layerData.children).enter().append("li").attr("class",function(d){if(d.subLayer){sublayers=d.subLayer;sublayersObject=d3.select(this);return"item subItem"+d.type}else{return"item item-"+d.type}}).text(function(d){return d.name});if(sublayers){sublayersObject.call(layerManager,sublayers)}var colorDiv=items.filter(function(d){if(d.subLayer){return false}else{return true}}).append("div").attr("class","default-color").each(function(d){if(d.defaultColor){this.style["background-color"]=d.defaultColor}});var displayButton=items.filter(function(d){if(d.subLayer){return false}else{return true}}).append("i").attr("class","display").classed("active",function(d){return d.display});var editButton=items.filter(function(d){return d.editable!==undefined}).append("i").attr("class","edit").classed("active",function(d){return d.editable});displayButton&&displayButton.on("click",function(d){if(d.disable){return}if("pic"===d.type){if(!iD.User.authTrail()){Dialog.alert(t("permission.trail_no_display"));return}}var type=d.type;var trigger;var picTrigger;if("pic"===type){picTrigger=dispatchPic(d);if(!picTrigger){return}}if("pic"==d.type){if(0<d3.select(".item-pic .active").size()){d.display=false}else{d.display=true}}else if("elements"==d._parentType){iD.Static.layersInfo.toggleStatus(d,"display");d.display=iD.Static.layersInfo.getElementStatus(d.type,"display");if(!d.display){let $editBtn=d3.select(this.parentNode).selectAll("i.edit");iD.Static.layersInfo.setLayerStatus(d.type,"editable",false);d.editable=iD.Static.layersInfo.getElementStatus(d.type,"editable");$editBtn.classed("active",d.editable)}}else{d.display=!d.display}d3.select(this).classed("active",d.display);context.enter(iD.modes.Browse(context));dispatch.change(d);if(trigger){var id=iD.Task.d.basic_id;dispatch.video(id,d.display)}if(picTrigger){dispatch.pic(iD.Task.d,d.display)}}).on("click.event",function(d){if("pic"===d.type){if(!iD.User.authTrail()){return}}if(d.event){dispatch[d.event](d.type,d.display)}if(d.unique&&d.display){displayButton.filter(function(cur){return d.unique===cur.unique&&d.type!==cur.type}).classed("active",function(cur){cur.display=false;return false})}});editButton&&editButton.on("click",function(d){if(!iD.Task.d){Dialog.alert("\u672A\u9009\u62E9\u4EFB\u52A1\uFF0C\u65E0\u6CD5\u7F16\u8F91");return}var type=d.type;context.enter(iD.modes.Browse(context));let $editBtns=d3.select(this.parentNode.parentNode).selectAll("li.item i.edit");iD.Static.layersInfo.toggleStatus(d,"editable");d.editable=iD.Static.layersInfo.getElementStatus(d.type,"editable");d3.select(this).classed("active",d.editable);if("elements"==d._parentType){if(d.editable&&!d.display){let $displayBtn=d3.select(this.parentNode).selectAll("i.display");iD.Static.layersInfo.setLayerStatus(d.type,"display",true);d.display=iD.Static.layersInfo.getElementStatus(d.type,"display");$displayBtn.classed("active",d.display)}}dispatch.change(d);var _selfBtn=this;if(d.editOnly){$editBtns.filter(function(){return this!=_selfBtn}).each(function(_d){_d.editable=iD.Static.layersInfo.getElementStatus(_d.type,"editable");d3.select(this).classed("active",_d.editable)})}if(d.event){dispatch[d.event](d,d.display)}})}}function layerManager(selection,subConfigLayers){let $container=selection.append("div").attr("class","background-container").data([0]);drawList($container,subConfigLayers);dispatch.change();iD.User.on("dvr",function(){var ele=d3.select(".item-video");var data=ele.data();data.display=false;ele.data([data]);ele.classed("active",false);dispatch.video(null,false);dispatch.pic(iD.Task&&iD.Task.d,true)})};function getStaticLayers(){if(!iD.Static)return;var layers=_.clone(iD.Static.layersInfo.getResourceElements(),true);var data=iD.Task.d;var temp=layers.resource.children;var role=iD.User.getRole().role;if(data){var type=data.basic_data_type;if(-1===type.indexOf("DVR")){parse("video")}}function parse(key){var index=-1;temp.forEach(function(ele,i){if(ele.type===key){index=i;return}});if(0<=index){temp.splice(index,1)}}return layers}layerManager.initialization=async function(){d3.selectAll(".map-controls .background-container .root").remove();await iD.config.loadTaskBatch(iD.Task.d).then(data=>{})};layerManager.redrawLayerList=function(){drawList(d3.select(".map-controls .background-container"))};layerManager.update=function(){dispatch.change()};return d3.rebind(layerManager,dispatch,"on")};;;iD.ui.PoiSearch=function(context){return function(selection){var pagingOpt={pageSize:10,pageIndex:1,keyword:"",total:0,count:0};selection.paging=function(keyword){rPanel.style("display","block");function done(data){re_list.select("ul").selectAll("li").remove();if("E1"==data.status){re_list.select("ul").append("li").append("a").html("\u65E0\u76F8\u5173\u6570\u636E");pagingOpt.pageIndex=1;pagingOpt.total=0;pagingOpt.count=0;setIndex(pagingOpt.pageIndex);return}else if(data.error){re_list.select("ul").append("li").append("a").html("\u67E5\u8BE2\u9519\u8BEF");pagingOpt.pageIndex=1;pagingOpt.total=0;pagingOpt.count=0;setIndex(pagingOpt.pageIndex);return}pagingOpt.total=data.total||pagingOpt.total;setIndex(pagingOpt.pageIndex);r_ul.selectAll("li").data(data.list).enter().append("li").append("a").html(function(d){return d.name}).attr("title",function(d){return d.name}).on("click",function(d){context.map().center([d.x,d.y])})}context.connection().searchPoiURL(iD.store.url.searchpoi,pagingOpt,done)};selection.append("input").on("keydown",function(){if(13===d3.event.keyCode&&this.value){var fb=pagingOpt.keyword!=this.value,ftex=rPanel.style("display");if(fb||!fb&&"none"===ftex){pagingOpt.pageIndex=1;pagingOpt.total=0;pagingOpt.count=0;pagingOpt.keyword=this.value;selection.paging()}}});selection.append("div").attr("class","img-search-mark");var rPanel=selection.append("div").attr("class","poi-search-results-panel");var stt=rPanel.append("div").attr("class","search_title");stt.append("p").html("\u641C\u7D22\u7ED3\u679C");stt.append("a").attr({href:"#",class:"close_two"}).on("click",function(){rPanel.style("display","none")});var re_list=rPanel.append("div").attr("class","results_list");var r_ul=re_list.append("ul");var paging=rPanel.append("div").attr("class","search_page");var pagemode=["home_page","pre_page","paging_num__tip","next_page","end_page"];paging.append("ul").selectAll("li").data(pagemode).enter().append("li").append("a").attr("href","#").attr("class",function(d){return d});paging.select(".home_page").on("click",function(){if(1==pagingOpt.pageIndex)return fasle;pagingOpt.pageIndex=1;selection.paging();setIndex(pagingOpt.pageIndex);return false});paging.select(".pre_page").on("click",function(){if(1<pagingOpt.pageIndex){pagingOpt.pageIndex--;selection.paging();setIndex(pagingOpt.pageIndex)}return false});paging.select(".next_page").on("click",function(){if(pagingOpt.pageIndex>=pagingOpt.count)return;pagingOpt.pageIndex++;selection.paging();setIndex(pagingOpt.pageIndex);return false});paging.select(".end_page").on("click",function(){if(pagingOpt.pageIndex==pagingOpt.count)return;pagingOpt.pageIndex=pagingOpt.count;selection.paging();setIndex(pagingOpt.count);return false});function setIndex(i){pagingOpt.count=Math.ceil(pagingOpt.total/pagingOpt.pageSize);if(!pagingOpt.count){i=0}paging.select(".paging_num__tip").html(i+"/"+pagingOpt.count);return false}}};;;iD.ui.Notice=function(context){return function(selection){var div=selection.append("div").attr("class","notice");var button=div.append("button").attr("class","zoom-to notice").on("click",function(){var zoomv=context.map().editableLevel();context.map().zoom(zoomv)});button.append("span").attr("class","KDSEditor-icon zoom-in-invert");button.append("span").attr("class","label").text(t("zoom_in_edit"));function disableTooHigh(){div.style("display",context.map().editable()?"none":"block")}context.map().on("move.notice",_.debounce(disableTooHigh,500));disableTooHigh()}};;;iD.ui.flash=function(selection){var modal=iD.ui.modal(selection);modal.select(".modal").classed("modal-flash",true);modal.select(".KDSEditor-content").classed("modal-section",true).append("div").attr("class","description");modal.on("click.flash",function(){modal.remove()});setTimeout(function(){modal.remove();return true},1500);return modal};;;iD.ui.Save=function(context){var history=context.history(),key=iD.ui.cmd("\u2318S");function saving(){return"save"===context.mode().id&&iD.modes.Save.isSaving()}function save(t){d3.event.preventDefault();if(!saving()&&history.hasChanges()){if(!iD.User.authEditSave()){return}var prelayer=context.layers().getLayer();if(prelayer&&prelayer.isRoad()&&prelayer.split){var graph=context.graph();changes=context.history().changes(iD.actions.DiscardTags(context.history().difference())),created=[].concat(changes["created"]),modified=[].concat(changes["modified"]);var vertexs=[],lines=[],totals=created.concat(modified),filter={},enty,geotory;totals.forEach(function(v){geotory=v.geometry(graph);if("line"===geotory){v.nodes.forEach(function(n){enty=graph.entity(n);if(3<=graph.parentWays(enty).length){!filter[enty.id]&&vertexs.push(enty);filter[enty.id]=true}})}else if("vertex"===geotory&&3<=graph.parentWays(v).length){!filter[v.id]&&vertexs.push(v);filter[v.id]=true}});vertexs=vertexs.filter(function(v){if(MapSheet.isPointOnRectSide(v.loc,context))return true;return false});context.enter(iD.modes.Save(context,t))}else{context.enter(iD.modes.Save(context,t))}}}context.ui().layermanager.on("change.save",function(d,type){var prelayer=context.layers().getLayer();if("display"===type&&(prelayer&&d.type===prelayer.type&&d.editable||!prelayer)){save("layermanager")}var bb="";context.undo_redo_buttons&&context.undo_redo_buttons.each(function(){bb+=d3.select(this).classed("disabled")});if("truefalse"===bb){context.flush()};});return function(selection){var tooltip=bootstrap.tooltip().placement("bottom").html(true).title(iD.ui.tooltipHtml(t("save.no_changes"),key));var button=selection.append("button").attr("class","save KDSEditor-col12 disabled").attr("tabindex",-1).on("click",save).call(tooltip);button.append("span").attr("class","label").text(t("save.title"));var keybinding=d3.keybinding("undo-redo").on(key,save);d3.select(document).call(keybinding);var numChanges=0;context.history().on("change.save",function(){var _=history.difference().summary().length;if(_===numChanges)return;numChanges=_;var noAuth=false;var tooltipText;if(!iD.User.authEditSave()){numChanges=0;noAuth=true;tooltipText=t("permission.edit_no_save")}else{tooltipText=t(0<numChanges?"save.help":"save.no_changes")}tooltip.title(iD.ui.tooltipHtml(tooltipText,key));button.classed("disabled",0===numChanges).classed("has-count",0<numChanges);button.property("disabled",saving());button.select("span.count").text(numChanges)});context.on("enter.save",function(){button.property("disabled",saving());if(saving()){button.call(tooltip.hide)}})}};;;iD.ui.Scale=function(context){var projection=context.projection,imperial="en-us"===iD.detect().locale.toLowerCase(),maxLength=180,tickHeight=8;function scaleDefs(loc1,loc2){var lat=(loc2[1]+loc1[1])/2,conversion=imperial?3.28084:1,dist=iD.geo.lonToMeters(loc2[0]-loc1[0],lat)*conversion,scale={dist:0,px:0,text:""},buckets,i,val,dLon;if(imperial){buckets=[5280000,528000,52800,5280,500,50,5,1]}else{buckets=[5000000,500000,50000,5000,500,50,5,1]}for(i=0;i<buckets.length;i++){val=buckets[i];if(dist>=val){scale.dist=Math.floor(dist/val)*val;break}}dLon=iD.geo.metersToLon(scale.dist/conversion,lat);scale.px=Math.round(projection([loc1[0]+dLon,loc1[1]])[0]);if(imperial){if(5280<=scale.dist){scale.dist/=5280;scale.text=String(scale.dist)+" mi"}else{scale.text=String(scale.dist)+" ft"}}else{if(1000<=scale.dist){scale.dist/=1000;scale.text=String(scale.dist)+" km"}else{scale.text=String(scale.dist)+" m"}}return scale}function update(selection){var dims=context.map().dimensions(),loc1=projection.invert([0,dims[1]]),loc2=projection.invert([maxLength,dims[1]]),scale=scaleDefs(loc1,loc2);selection.select("#scalepath").attr("d","M0.5,0.5v"+tickHeight+"h"+scale.px+"v-"+tickHeight);selection.select("#scaletext").attr("x",scale.px/2.8).attr("y",tickHeight-5).text(scale.text)}return function(selection){var g=selection.append("svg").attr("id","scale").append("g").attr("transform","translate(10,15)");g.append("path").attr("id","scalepath");g.append("text").attr("id","scaletext");update(selection);context.map().on("move.scale",function(){update(selection)})}};;;iD.ui.Geolocate=function(map,context){function click(){if(!iD.Task||!iD.Task.d){return}var extent=iD.geo.Extent(iD.Task.d.bounds);var newZoom=parseInt(map.extentZoom(extent));if(newZoom<context.options.editableLevel){map.centerZoom(extent.center(),context.options.editableLevel)}else{map.extent(extent)}}function error(){}return function(selection){if(!navigator.geolocation)return;var button=selection.append("button").attr("tabindex",-1).attr("title",t("geolocate.title")).on("click",click).call(bootstrap.tooltip().placement("left"));button.append("span").attr("class","KDSEditor-icon geolocate light")}};;;iD.ui.Splash=function(context){return function(selection){if(context.storage("sawSplash"))return;context.storage("sawSplash",true);var modal=iD.ui.modal(selection);modal.select(".modal").attr("class","modal-splash modal KDSEditor-col6");var introModal=modal.select(".KDSEditor-content").append("div").attr("class","KDSEditor-fillL");introModal.append("div").attr("class","modal-section cf").append("h3").text(t("splash.welcome"));introModal.append("div").attr("class","modal-section").append("p").html(t("splash.text",{version:iD.version,website:"<a href=\"http://ideditor.com/\">ideditor.com</a>",github:"<a href=\"https://github.com/openstreetmap/iD\">github.com</a>"}));var buttons=introModal.append("div").attr("class","modal-actions cf");buttons.append("button").attr("class","KDSEditor-col6 walkthrough").text(t("splash.walkthrough")).on("click",function(){d3.select(document.body).call(iD.ui.intro(context));modal.close()});buttons.append("button").attr("class","KDSEditor-col6 start").text(t("splash.start")).on("click",modal.close);modal.select("button.close").attr("class","hide")}};;;iD.ui.Spinner=function(context){var connection=context.connection();return function(selection){var img=selection.append("img").attr("id","KDSEditor-spinner-loading").attr("src",context.imagePath("loader-black.gif")).style("opacity",0);connection.on("loading.spinner",function(){img.transition().style("opacity",1)});connection.on("loaded.spinner",function(){img.transition().style("opacity",0)})}};;;iD.ui.Restore=function(context){return function(selection){if(!context.history().lock()||!context.history().restorableChanges())return;var userName;if(iD.Task.d){userName="iD_"+iD.Task.d.task_id+"_"+iD.User.getInfo().username}else{return}if(!context.storage(userName)){return}var modal=iD.ui.modal(selection);modal.select(".modal").attr("class","modal KDSEditor-fillL KDSEditor-col6");var introModal=modal.select(".KDSEditor-content");introModal.attr("class","cf");introModal.append("div").attr("class","modal-section").append("h3").text(t("restore.heading"));introModal.append("div").attr("class","modal-section").append("p").text(t("restore.description"));var buttonWrap=introModal.append("div").attr("class","modal-actions cf");var restore=buttonWrap.append("button").attr("class","restore KDSEditor-col6").text(t("restore.restore")).on("click",function(){context.history().restore();modal.remove();iD.Task.dispatch.restore()});buttonWrap.append("button").attr("class","reset KDSEditor-col6").text(t("restore.reset")).on("click",function(){context.history().clearSaved();modal.remove();delete iD.Task.working;localStorage.removeItem("d")});restore.node().focus()}};;;iD.ui.Lasso=function(context){var box,group,a=[0,0],b=[0,0];function lasso(selection){context.container().classed("lasso",true);group=selection.append("g").attr("class","lasso hide");box=group.append("rect").attr("class","lasso-box");group.call(iD.ui.Toggle(true))}function topLeft(d){return"translate("+Math.min(d[0][0],d[1][0])+","+Math.min(d[0][1],d[1][1])+")"}function width(d){return Math.abs(d[0][0]-d[1][0])}function height(d){return Math.abs(d[0][1]-d[1][1])}function draw(){if(box){box.data([[a,b]]).attr("transform",topLeft).attr("width",width).attr("height",height)}}lasso.a=function(_){if(!arguments.length)return a;a=_;draw();return lasso};lasso.b=function(_){if(!arguments.length)return b;b=_;draw();return lasso};lasso.close=function(){if(group){group.call(iD.ui.Toggle(false,function(){d3.select(this).remove()}))}context.container().classed("lasso",false)};return lasso};;;iD.ui.Toggle=function(show,callback){return function(selection){selection.style("opacity",show?0:1).classed("hide",false).transition().style("opacity",show?1:0).each("end",function(){d3.select(this).classed("hide",!show);if(callback)callback.apply(this)})}};;;iD.ui.UndoRedo=function(context){var commands=[{id:"undo",cmd:iD.ui.cmd("\u2318Z"),action:function(){if(!saving())context.undo()},annotation:function(){return context.history().undoAnnotation()}},{id:"redo",cmd:iD.ui.cmd("\u2318\u21E7Z"),action:function(){if(!saving())context.redo()},annotation:function(){return context.history().redoAnnotation()}}];function saving(){return"save"===context.mode().id&&iD.modes.Save.isSaving()||"RoadCrossModify"===context.mode().id}return function(selection){var tag;var tooltip=bootstrap.tooltip().placement("bottom").html(true).title(function(d){return iD.ui.tooltipHtml(d.annotation()?t(d.id+".tooltip",{action:d.annotation()}):t(d.id+".nothing"),d.cmd)});var qcTagCnt=function(){var role=iD.User.getRole().role;if("check"==role){}};var updateTopo=function(){var changes=context.history().changes(iD.actions.DiscardTags(context.history().difference()));var createData=changes.created;createData.forEach(function(entity){if(entity instanceof iD.Way){context.replace(iD.actions.AddRoad(entity.id),t("modes.add_road.description"))}if(entity instanceof iD.Way&&entity.tags.isnewwalklink){context.replace(iD.actions.AddWalkRoad(entity.id),t("modes.add_road.description"))}})};var buttons=selection.selectAll("button").data(commands).enter().append("button").attr("class","KDSEditor-col6 disabled").on("click",function(d){d.action();qcTagCnt();updateTopo()}).call(tooltip);buttons.append("div").classed("for-border",true).append("span").attr("class",function(d){return"KDSEditor-icon "+d.id});var keybinding=d3.keybinding("undo").on(commands[0].cmd,function(){d3.event.preventDefault();commands[0].action();qcTagCnt();updateTopo()}).on(commands[1].cmd,function(){d3.event.preventDefault();commands[1].action();qcTagCnt();updateTopo()});d3.select(document).call(keybinding);context.history().on("change.undo_redo",update);context.on("enter.undo_redo",update);function update(){buttons.property("disabled",saving()).classed("disabled",function(d){return!d.annotation()}).each(function(){var selection=d3.select(this);if(selection.property("tooltipVisible")){selection.call(tooltip.show)}});context.undo_redo_buttons=buttons}}};;;iD.ui.TaskList=function(context){function updateTaskLayer(){let resources=iD.Static.layersInfo.getResourceElements().resource.children;for(resource of resources){if("background"===resource.unique){context.background().layerVisible(resource.type,resource.display)}}}async function layerChange(){d3.select("div.editcheck-tag-panel").classed("hidden",true);await context.ui().layermanager.initialization();iD.Static.layersInfo.initElements();context.ui().layermanager.redrawLayerList();await iD.config.resetDataLayer();context.ui().layermanager.update();iD.User.dispatch.dvr();iD.ui().reportform.showBtn();context.container().call(iD.ui.Restore(context));updateTaskLayer()}function update(data,$button){d3.select(".task-list .dropdown-menu .task-table").selectAll("tr").remove();var maxL=-1;if(iD.User.isWorkRole()){maxL=3}else if(iD.User.isCheckRole()||iD.User.isVerifyRole()||iD.User.isAuditRole()){maxL=30}if(0<maxL&&data&&data.length>=maxL){$button.select(".task-receive").property("disabled","disabled")}var trs=d3.select(".task-list .dropdown-menu .task-table").selectAll("tr").data(data).enter().append("tr");trs.each(function(d,i){var tr=d3.select(this);tr.append("td").attr("title",d.task_id).text(d.task_id);let typeName="";switch(d.protoData.taskDefinitionKey){case"ManualEdit":typeName="\u7F16\u8F91";break;case"ManualEditAutoCheckHandle":typeName="\u68C0\u67E5";break;case"FusionHandle":typeName="\u878D\u5408";break;case"FusionHandleAutoCheckHandle":typeName="\u68C0\u67E5";break;case"ManualCheckEdit":typeName="\u8D28\u68C0";break;case"sdEdit":typeName="\u4F20\u7EDF";break;case"RecHandle":typeName="\u8BC6\u522B";break;case"SelectHandle":typeName="\u56FE\u50CF\u9009\u53D6";break;}if(typeName){typeName="["+typeName+"] "}tr.append("td").attr("title",typeName+d.cli_desc).text(typeName+d.cli_desc)});trs.on("click",function(d,i){if(iD.Task.d&&d.task_id==iD.Task.d.task_id){return}let history=context.history();if(history.hasChanges()){if(window.confirm(t("save.clear_sure"))){context.enter(iD.modes.Browse(context));context.flush()}else{return}}else{context.enter(iD.modes.Browse(context));context.flush()}iD.Task.d=_.extend(d,{_index:i});iD.Task.working=d;context.editArea(iD.Task.d.range);context.map().drawTansactionEntity();context.ui().sidebar.update(data);context.variable.firstInZoomLevel=context.map().zoom();$button.select("button.nowtask").text(d.task_id);$button.classed("open",false);if(context.variable.autoSaveTime){window.clearInterval(context.variable.autoSaveTime)}context.localStorageClean();layerChange();context.variable.isOpenSaveDialog=false;context.variable.autoSaveTime=window.setInterval(context.autoSave,900000);iD.util.taskUpdateScene(context)});var task_id=iD.url.getUrlParam("taskID");if(!iD.User._urlTaskIsEnter){trs.each(function(d){var $tr=d3.select(this);if(d&&task_id&&d.task_id==task_id){$tr.trigger("click");iD.User._urlTaskIsEnter=true;$button.classed("open",false)}return false})}}return function(selection,contents){var tag;var button=selection.append("div").attr("class","btn-group task-list");button.append("button").attr("class","btn btn-default nowtask dropdown-toggle").attr("data-toggle","dropdown").attr("aria-expanded","false");button.select("button.nowtask").append("span").text("\u4EFB\u52A1\u5217\u8868").attr("class","caret");button.append("button").attr("class","btn btn-default task-receive").text("\u9886\u53D6\u4EFB\u52A1");if(7==window._systemType||iD.util.isLocateTrackPointUrl()){button.select("button.task-receive").property("disabled","disabled")}button.select("button.nowtask").on("click",function(){selection.select(".btn-group").classed("open",!selection.select(".btn-group").classed("open"))});button.select("button.task-receive").on("click",function(){d3.json(iD.config.URL.kts+"task/claim?user="+iD.User.getInfo().username).get(function(error,data){if(error||data&&"0"!=data.code){Dialog.alert(data&&data.message||"\u9886\u53D6\u4EFB\u52A1\u5931\u8D25\u3002");return}iD.Task.refreshTaskData(function(tasks){update(tasks,button);Dialog.sidebarAlert("\u9886\u53D6\u4EFB\u52A1\u6210\u529F\u3002")})})});var ul=button.append("ul").attr("class","dropdown-menu").attr("role","menu");var table=ul.append("table").attr("class","task-table");iD.Task.on("afterget.task_list",function(data){update(data,button)})}};;iD.ui.RoadCrossing=function(context){return function(selection){var modes=[];var role=d3.select("body").attr("role")||"work";selection.classed(role+"er-action",true);iD.Static&&iD.Static.actionRole[role].forEach(function(value){let subMode=iD.modes[value](context);subMode&&modes.push(subMode)});var buttons=selection.selectAll("button").data(modes).enter().append("button").attr("class","KDSEditor-col6-1").attr("id",function(d){return d.id}).on("click",function(d){var is_active=d3.select(this).classed("active");context.enter(iD.modes.Browse(context));if(!is_active){buttons.classed("active",false);context.enter(d)}d3.select(this).classed("active",!is_active)}).call(bootstrap.tooltip().placement("bottom").html(true).title(function(d){return iD.ui.tooltipHtml(d.description,d.key)}));buttons.append("div").classed("for-border",true).append("span").attr("class",function(d){return"KDSEditor-icon "+d.id});var keybinding=d3.keybinding("road_crossing");modes.forEach(function(m){keybinding.on(m.key,function(){buttons.each(function(o){if(m.button===o.button&&!d3.select(this).property("disabled")){if(context.editable()&&iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id)context.enter(m)}})})});d3.select(document).call(keybinding);context.ui().layermanager.on("change.road_crossing",function(d,type){if(d&&"elements"==d._parentType){context.map().redraw()}update(d)});context.ui().layermanager.on("nodisplay.road_crossing",function(d){var bb=buttons.classed("active");if(bb){alert("\u8BF7\u9000\u51FA\u7F16\u8F91\u64CD\u4F5C\u6A21\u5F0F")}context.barButtonActive1=bb});context.on("enter.road_crossing",function(entered){buttons.classed("active",function(mode){if(entered.drawroad&&entered.drawroad===mode.button){return true}else{return entered.button===mode.button}});inDrawLineMode()});context.on("exit.road_crossing",function(exited){context.container().classed("mode-"+exited.id,false)});context.event.on("change_scene.road_crossing",function(){update()});iD.Task&&iD.Task.on("start",function(){update()});context.map().on("move.road_crossing",_.debounce(update,500));function inDrawLineMode(){var layer=context.layers().getLayer(),cMode=context.mode();if("draw-line"===cMode.id&&layer&&layer.isRoad()){buttons.each(function(b){var btn=d3.select(this);if("add-road"===b.id){btn.classed("active",true);context.__road_line_btn___=btn}})}}var dividerActionIds=["add-divider","add-road","add-roadcross","add-junction"];var otherActionIds=[];function update(d){if(!iD.Task||!iD.Task.working||iD.Task.working.task_id!=iD.Task.d.task_id||!context.map().editable()){buttons.classed("hide",true);var qcalltag=d3.select(".allqctag_cnt");qcalltag.classed("hide",true);return}var elements=iD.Static.layersInfo.getElements();buttons.classed("hide",true);let layer;for(var key in elements){var value=elements[key];if(value){var actions=value.action;var curButtons=buttons.filter(function(d){var flag=-1!==actions.indexOf(d.id);if(!flag)return flag;if(!context.variable.edit.editDivider){if(-1<dividerActionIds.indexOf(d.id)){return false}}else if(!context.variable.edit.editOther){if(-1<otherActionIds.indexOf(d.id)){return false}}return flag});layer=context.layers().getLayerById(value.children[0]);if(layer&&layer.editable){curButtons.classed("hide",false)}}}}function setButtonVisible(){buttons.each(function(){if(this.disabled)this.style.display="none";else this.style.display="block"})}update()}};;;iD.ui.Zoom=function(context){var zooms=[{id:"zoom-in",title:t("zoom.in"),action:context.zoomIn,key:"+"},{id:"zoom-out",title:t("zoom.out"),action:context.zoomOut,key:"-"}];return function(selection){var button=selection.selectAll("button").data(zooms).enter().append("button").attr("tabindex",-1).attr("class",function(d){return d.id}).on("click.uizoom",function(d){d.action()}).call(bootstrap.tooltip().placement("left").html(true).title(function(d){return iD.ui.tooltipHtml(d.title,d.key)}));button.append("span").attr("class",function(d){return d.id+" icon"});var keybinding=d3.keybinding("zoom").on("+",function(){context.zoomIn()}).on("=",function(){context.zoomIn()}).on("-",function(){context.zoomOut()}).on("\u21E7=",function(){context.zoomIn()}).on("dash",function(){context.zoomOut()}).on("\u21E7"+"plus",function(){context.zoomIn()});d3.select(document).call(keybinding)}};;;iD.ui.ViewModeChange=function(context,$mapContent,$picplayer,$allWrap){var modeClasses=["model-pos-left","model-pos-right"];var layoutClasses=["layout-7_3","layout-6_4","layout-5_5","layout-10"];var zooms=[{id:"view-mode-attribute",title:"\u5C5E\u6027\u7F16\u8F91",action:function(){changeModeDom(1)}},{id:"view-mode-element",title:"\u8981\u7D20\u7F16\u8F91",action:function(){changeModeDom(2)}},{id:"view-layout-7_3",title:"7/3 \u6BD4\u4F8B",style:{"line-height":2.4},action:function(){changeModeLayoutStyle(1)}},{id:"view-layout-6_4",title:"6/4 \u6BD4\u4F8B",style:{"line-height":2.4},action:function(){changeModeLayoutStyle(2)}},{id:"view-layout-5_5",title:"5/5 \u6BD4\u4F8B",style:{"line-height":2.4},action:function(){changeModeLayoutStyle(3)}}];if(7==window._systemType){zooms.push({id:"view-mode-picRightBody",title:"\u6838\u7EBF\u5BF9\u6BD4",action:function(){if(iD.picUtil.player){var player=iD.picUtil.player;if(!player.checkRightBodyShown()){changeModeLayoutStyle(3);player.showRightBody()}else{player.hideRightBody()}}}})}function changeModeDom(type){var mainClass=modeClasses[0];var smallClass=modeClasses[1];var mainMode={};mainMode[mainClass]=true;mainMode[smallClass]=false;var smallMode={};smallMode[mainClass]=false;smallMode[smallClass]=true;if(1==type){$mapContent.classed(mainMode);$picplayer.classed(smallMode)}else if(2==type){$picplayer.classed(mainMode);$mapContent.classed(smallMode)}}function changeModeLayoutStyle(type){var index=(type||0)-1;if(-1==index){return}var arr=[false,false,false,false];arr[index]=true;$allWrap.classed(_.zipObject(layoutClasses,arr));iD.picUtil.player&&iD.picUtil.player.hideRightBody();iD.svg.Pic.dataMgr.pic&&iD.svg.Pic.dataMgr.pic.resetSize()}return function(selection){var button=selection.selectAll("button").data(zooms).enter().append("button").attr("tabindex",-1).attr("class",function(d){return d.id}).on("click.uizoom",function(d){d.action();d3.select(window).trigger("resize")}).call(bootstrap.tooltip().placement("left").html(false).title(function(d){return d.title}));button.append("span").attr("class","text-fill").text(function(d){var str=d.title;for(var key in d.style){this.style[key]=d.style[key]}return str.substring(0,d.titleNum||4)})}};;;iD.effects=iD.effects||{};iD.effects.WalkFT=function(context){var effect={id:"walkFT",button:"walkFT",title:"",description:t("effects.walkFT.description"),key:"Shift+V",apply:function(context){iD.WalkLinkDirection.changeWalkLinkDirection();context.map().dimensions(context.map().dimensions())}};return effect};;;iD.effects=iD.effects||{};iD.effects.DividerArea=function(context){var dividerAreaParamList=[];var effect={id:"divider-area",button:"dividerarea",title:t("effects.dividerArea.title"),iconText:"LG",description:t("effects.dividerArea.description"),key:"Shift+T",enable:false,apply:function(context,open,selectedids){var self=this;self.enable=null==open?false:open;dividerAreaParamList.length=0;var graph=context.graph();var selectedids=selectedids||context.selectedIDs();if(!self.enable||1!=selectedids.length){refreshMap();return}var divider=context.entity(selectedids[0]);if(divider.modelName!=iD.data.DataType.DIVIDER){refreshMap();return}var divdierNo=parseInt(divider.tags.DIVIDER_NO);if(isNaN(divdierNo)||0>divdierNo){refreshMap();return}var dividerRelations=graph.parentRelations(divider,iD.data.DataType.R_DIVIDER_DREF);if(0==dividerRelations.length||"1"!=divider.tags.R_LINE){refreshMap();return}var entityList=getDirectionDividers(divider);var getDrefRLine=getDrefRelationsRLineFunc();for(let idx in dividerRelations){let rel=dividerRelations[idx];let rlineMap={};for(let i in rel.members){let dv=context.hasEntity(rel.members[i].id);if(!dv||dv.id==divider.id){continue}let dvList=getDirectionDividers(dv,divider.tags.DIRECTION,false);if(dvList[0]&&dvList[0].length){for(let j in dvList[0]){let dvitem=dvList[0][j];let itemRLines=getDrefRLine(dvitem);itemRLines.length&&entityList[0].push(...itemRLines)}}if(dvList[2]&&dvList[2].length){for(let j in dvList[2]){let dvitem=dvList[2][j];let itemRLines=getDrefRLine(dvitem);itemRLines.length&&entityList[2].push(...itemRLines)}}}}var resultList=[];for(let idx in entityList){let entityArr=entityList[idx];for(let arrIdx in entityArr){let entity=entityArr[arrIdx];if(!entity){continue}let entityNo=parseInt(entity.tags.DIVIDER_NO);if(isNaN(entityNo)||0>entityNo){continue}let relations=graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_DREF);relations=[relations[0]];let noMaxEntity;for(let i in relations){let rel=relations[i];for(let j in rel.members){let dv=rel.members[j];dv=context.hasEntity(dv.id);if(!dv||dv.id==entity.id){continue}let dvNo=parseInt(dv.tags.DIVIDER_NO);if(isNaN(dvNo)||0>dvNo){continue}if(!noMaxEntity){noMaxEntity=dv}let maxNo=parseInt(noMaxEntity.tags.DIVIDER_NO);if(dvNo>=maxNo){noMaxEntity=dv}}}if(!noMaxEntity){continue}let isForward="3"!=entity.tags.DIRECTION;let param={forward:isForward,index:idx,entity:entity,nextEntity:noMaxEntity,nodes:[]};if(isForward){param.nodes.push(...graph.childNodes(entity))}else{param.nodes.push(..._.clone(graph.childNodes(entity)).reverse())}let rel=relations[0];if(rel&&2<rel.members.length){let dvs=[];for(let midx in rel.members){let dv=rel.members[midx];dv=context.hasEntity(dv.id);if(!dv){continue}if(dv.id==entity.id){continue}else if(dv.id==noMaxEntity.id){continue}else if(isNaN(parseInt(dv.tags.DIVIDER_NO))){continue}dvs.push(dv)}dvs.sort(function(dv1,dv2){return parseInt(dv1.tags.DIVIDER_NO)-parseInt(dv2.tags.DIVIDER_NO)});for(let dvidx in dvs){let dv=dvs[dvidx];let lastNode=context.hasEntity(dv.nodes[isForward?dv.nodes.length-1:0]);lastNode&&param.nodes.push(lastNode)}if(isForward){param.nodes.push(..._.clone(graph.childNodes(noMaxEntity)).reverse())}else{param.nodes.push(...graph.childNodes(noMaxEntity))}dvs.reverse();for(let dvidx in dvs){let dv=dvs[dvidx];let lastNode=context.hasEntity(dv.nodes[isForward?0:dv.nodes.length-1]);lastNode&&param.nodes.push(lastNode)}}else{if(isForward){param.nodes.push(..._.clone(graph.childNodes(noMaxEntity)).reverse())}else{param.nodes.push(...graph.childNodes(noMaxEntity))}}param.nodes.push(param.nodes[0]);resultList.push(param)}}var resultMap={};resultList=resultList.filter(function(item){let flag=resultMap[item.entity.id]==undefined;resultMap[item.entity.id]=true;return flag});dividerAreaParamList=resultList;refreshMap()}};function getDrefRelationsRLineFunc(){var cache={};return function(entity){var result=[];var graph=context.graph();var relations=graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_DREF);for(let i in relations){let rel=relations[i];for(let j in rel.members){let dv=context.hasEntity(rel.members[j].id);if(!dv){continue}if("1"==dv.tags.R_LINE&&cache[dv.id]==undefined){result.push(dv);cache[dv.id]=true}}}return result}}function refreshMap(){context.map().dimensions(context.map().dimensions())}function getDirectionDividers(entity,directionParam,isRLine){isRLine=null==isRLine?true:isRLine;var entityList=[[],[entity],[]];var dirParam=getDirectionNodeParam(entity,directionParam);var prevNode=dirParam.firstNode,nextNode=dirParam.lastNode;var isForward=dirParam.isForward;if(!prevNode||!nextNode){return entityList}var graph=context.graph();var prevEntities=graph.parentWays(context.entity(prevNode));var nextEntities=graph.parentWays(context.entity(nextNode));entityList[0]=prevEntities.filter(function(d){let flag=d.id!=entity.id;if(flag){let param=getDirectionNodeParam(d);flag=param.lastNode==prevNode}if(isRLine&&flag){flag="1"==d.tags.R_LINE}return flag});entityList[2]=nextEntities.filter(function(d){let flag=d.id!=entity.id;if(flag){let param=getDirectionNodeParam(d);flag=param.firstNode==nextNode}if(isRLine&&flag){flag="1"==d.tags.R_LINE}return flag});return entityList}function getDirectionNodeParam(entity,directionParam){let firstNode,lastNode,isForward;switch(directionParam||entity.tags.DIRECTION){case"":case"1":case"2":firstNode=entity.nodes[0];lastNode=entity.nodes[entity.nodes.length-1];isForward=true;break;case"3":firstNode=entity.nodes[entity.nodes.length-1];lastNode=entity.nodes[0];isForward=false;break;}return{firstNode,lastNode,isForward}}context.event.on("selected.effect-dividerArea",function(selectedEntities){effect.enable&&effect.apply.call(effect,context,effect.enable,_.pluck(selectedEntities,"id"))});context.map().on("drawn.effect-dividerArea",function(param){if(!param.full){return}var surface=context.map().surface;surface.select(".layer-divider_effectareas").html("");if(!effect.enable){return}var pathFun=function(item){let polygon=true;let round=iD.svg.Round().stream,projection=context.projection,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return polygon?project(round(output)):project(clip(round(output)))}});let coordinates=_.pluck(item.nodes,"loc");let geoJson={type:"Polygon",coordinates:[coordinates]};return path(geoJson)};var filter=function(){return true};var areas=dividerAreaParamList;areas=areas.filter(function(item){return null!=item});var data={shadow:areas,stroke:areas,fill:areas};var areagroup=surface.select(".layer-divider_effectareas").selectAll("g.areagroup").data(["fill","shadow","stroke"]);areagroup.enter().append("g").attr("class",function(d){return"layer areagroup area-"+d});var paths=areagroup.selectAll("path").filter(filter).data(function(layer){return data[layer]});paths.enter().append("path").each(function(item){var entity=item.entity;var layer=this.parentNode.__data__;var effectClass="effectarea-"+item.index;this.setAttribute("class",effectClass+" "+entity.type+" area "+layer)});paths.attr("d",pathFun);paths.exit().remove();areagroup.exit().remove()});return effect};;;iD.effects=iD.effects||{};iD.effects.DividerDrefMemberArea=function(context){var dividerAreaParamList=[];var effect={id:"dividerdref-memberarea",button:"dividerdref-memberarea",title:t("effects.dividerDrefMemberArea.title"),iconText:"DG",description:t("effects.dividerDrefMemberArea.description"),key:"Shift+Y",enable:false,apply:function(context,open,selectedids){var self=this,graph=context.graph();self.enable=null==open?false:open;dividerAreaParamList.length=0;if(!self.enable){refreshMap();return}var allDrefs=[];context.intersects(iD.geo.Extent([-Infinity,-Infinity],[Infinity,Infinity])).filter(function(entity){if(entity instanceof iD.Relation&&entity.modelName==iD.data.DataType.R_DIVIDER_DREF){allDrefs.push(entity)}});if(!allDrefs.length){return}allDrefs.forEach(function(r){var dividers=_.map(_.pluck(r.members,"id"),context.entity);var numberMap={};var numberList=dividers.map(function(d){var val=d.tags.DIVIDER_NO;if(null==val||""==val){return false}val=Number(val);numberMap[val]=d;return val}).filter(val=>{return false!==val});if(2>numberList.length){return}var minNum=_.min(numberList),maxNum=_.max(numberList);var begin,end,steps=[],_count=0;for(var num=minNum;num<=maxNum+1;num++){let divider=numberMap[num];_count++;if(1==_count){if(!numberMap[num+1]){continue}}if(!divider){if(begin&&end&&begin.id!=end.id){steps.pop();var nodes=getAreaNodes(graph,begin,end,steps);if(4<=nodes.length){dividerAreaParamList.push({entity:r,nodes:nodes})}begin=end=null;steps.length=0}continue}if(begin){steps.push(divider)}else{begin=divider}end=divider}});refreshMap()}};function getAreaNodes(graph,begin,end,steps){var nodes=[];nodes.push(...graph.childNodes(begin));var midList=_.clone(steps);for(var d of midList){var e=graph.hasEntity(_.last(d.nodes));if(e)nodes.push(e)}var endNodes=_.clone(graph.childNodes(end));endNodes.reverse();nodes.push(...endNodes);midList.reverse();for(var d of midList){var e=graph.hasEntity(_.first(d.nodes));if(e)nodes.push(e)}nodes.length&&nodes.push(nodes[0]);return nodes}function refreshMap(){context.map().dimensions(context.map().dimensions())}context.map().on("drawn.effect-dividerDrefMemberArea",function(param){if(!param.full){return}var surface=context.map().surface;surface.select(".layer-dref_memberareas").html("");if(!effect.enable||!dividerAreaParamList.length){return}var pathFun=function(item){let polygon=true;let round=iD.svg.Round().stream,projection=context.projection,clip=d3.geo.clipExtent().extent(projection.clipExtent()).stream,project=projection.stream,path=d3.geo.path().projection({stream:function(output){return polygon?project(round(output)):project(clip(round(output)))}});let coordinates=_.pluck(item.nodes,"loc");let geoJson={type:"Polygon",coordinates:[coordinates]};return path(geoJson)};var filter=function(){return true};var areas=dividerAreaParamList;areas=areas.filter(function(item){return null!=item});var data={shadow:areas,stroke:areas,fill:areas};var areagroup=surface.select(".layer-dref_memberareas").selectAll("g.areagroup").data(["fill","shadow","stroke"]);areagroup.enter().append("g").attr("class",function(d){return"layer areagroup area-"+d});var paths=areagroup.selectAll("path").filter(filter).data(function(layer){return data[layer]});paths.enter().append("path").each(function(item){var entity=item.entity;var layer=this.parentNode.__data__;var effectClass="effectarea-"+(item.index||0);this.setAttribute("class",effectClass+" "+entity.type+" area "+layer)});paths.attr("d",pathFun);paths.exit().remove();areagroup.exit().remove()});return effect};;;iD.effects=iD.effects||{};iD.effects.labelField=function(context){var effect={id:"label-field",button:"label-field",title:t("effects.labelField.title"),iconText:"LB",description:t("effects.labelField.description"),key:"Shift+R",enable:false,apply:function(context,open,selectedids){var self=this,graph=context.graph();self.enable=null==open?false:open;var LABEL_FILTERS=iD.labels.effectEntityFilter;LABEL_FILTERS.remove(iD.data.DataType.DIVIDER);if(!self.enable){refreshMap();return}LABEL_FILTERS.set(iD.data.DataType.DIVIDER,function(entity){if(!entity||entity.modelName!=iD.data.DataType.DIVIDER){return false}return{name:"DIVIDER_NO",value:entity.tags.DIVIDER_NO}});refreshMap()}};function refreshMap(){context.map().dimensions(context.map().dimensions())}return effect};;;iD.effects=iD.effects||{};iD.effects.wayDirection=function(context){var allWays=[];var effect={id:"way-direction",button:"way-direction",title:t("effects.wayDirection.title"),iconText:"WD",description:t("effects.wayDirection.description"),key:"Shift+D",enable:false,apply:function(context,open,selectedids){var self=this,graph=context.graph();self.enable=null==open?false:open;allWays.length=0;if(!self.enable){refreshMap();return}context.intersects(iD.geo.Extent([-Infinity,-Infinity],[Infinity,Infinity])).filter(function(entity){if(entity.modelName&&"line"===entity.geometry(graph)){allWays.push(entity)}});refreshMap()}};function refreshMap(){context.map().dimensions(context.map().dimensions())}function markerNodePath(selection,style){if("image"===style){selection.attr("class",style).attr("x",-12).attr("y",-12).attr("width",25).attr("height",25).attr("xlink:href",function(d){return"first"===d.tags.node?context.imagePath("pointa.png"):context.imagePath("pointb.png")})}}function transps(){var result={};for(var way of allWays){var trans=iD.Transportation().newTransportations(context.graph().entity(way.first()),context.graph().entity(way.last()),way.tags.DIRECTION)||{};_.extend(result,trans)}return result}context.map().on("drawn.effect-wayDirection",function(param){if(!param.full){return}var surface=context.map().surface;surface.select(".layer-way_direction").html("");if(!effect.enable||!allWays.length){return}var projection=context.projection;var groups=surface.select(".layer-way_direction").selectAll("g.traffic_node").data(_.values(transps()),function(d){return d.id});var group=groups.enter().append("g").attr("class",function(d){return"node point traffic_node "+d.id}).sort(function(d1,d2){if(d1.tags.node===d2.tags.node){return 0}if("first"==d1.tags.node){return-1}if("last"==d1.tags.node){return 1}return 0});group.append("image").call(markerNodePath,"image");groups.attr("transform",iD.svg.PointTransform(projection)).call(iD.svg.TagClasses());groups.exit().remove()});return effect};;;iD.effects=iD.effects||{};iD.effects.laneHighlight=function(context){var effect={id:"lane-highlight",button:"lanehighlight",title:t("effects.laneHighlight.title"),iconText:"LA",description:t("effects.laneHighlight.description"),key:"Shift+E",enable:false,apply:function(context,open){var dividerName=iD.data.DataType.DIVIDER;var layers=context.layers().getLayersByModelName(dividerName);var self=this;self.enable=null==open?false:open;context.variable.isLaneHighlight=self.enable;var layer;for(let i=0;i<layers.length;i++){layer=layers[i];var optionObj={style:function(entity){return{};if(entity.modelName!=iD.data.DataType.DIVIDER){return{stroke:null}}var graph=context.graph();var relations=graph.parentRelations(entity,iD.data.DataType.LANE_ATTRIBUTE);var effectColor=null;if(self.enable){if(0<relations.length){effectColor="#ff0000"}else{effectColor="#0000FF"}return{stroke:effectColor}}else{return{stroke:null}}}};optionObj.nodeDomStyleMap=layer.nodeDomStyleMap||{};optionObj.nodeDomStyleMap[iD.data.DataType.LANE_ATTRIBUTE]=function(entity,gdom){if(entity.modelName!=iD.data.DataType.DIVIDER_NODE){return}var $g=d3.select(gdom);$g.selectAll("rect.lane_attribute").remove();$g.selectAll("*").style("display",null);if(!self.enable){$g.classed("lane_attr",false);domStyleDA($g);return}var graph=context.graph();var relations=graph.parentRelations(entity,iD.data.DataType.LANE_ATTRIBUTE);if(!relations.length){$g.classed("lane_attr",false);domStyleDA($g);return}$g.classed("lane_attr",true);$g.selectAll("*").each(function(){var $this=d3.select(this);if($this.classed("shadow"))return;if($this.classed("fill"))return;if($this.classed("divider_attribute"))return;$this.style("display","none")});$g.insert("rect",".stroke").classed({lane_attribute:true}).attr({x:-7,y:-7,width:14,height:14}).style({fill:"rgb(0, 248, 255)",stroke:"rgb(0, 81, 255)","stroke-width":1});domShadow($g)};layer.setOptions(optionObj)}function domStyleDA($g){domShadow($g);if(!$g.classed("divider_attr")){return}$g.selectAll("*").each(function(){var $this=d3.select(this);if($this.classed("shadow"))return;if($this.classed("fill"))return;if($this.classed("divider_attribute"))return;$this.style("display","none")})}function domShadow($g){var r=7.5;if($g.classed("divider_attr")){r=8.5}if($g.classed("lane_attr")){r=11.5}r&&$g.select("circle.shadow").attr("r",r)}function clearRenderFun(){var layer;for(let i=0;i<layers.length;i++){layer=layers[i];if(!self.enable&&layer.nodeDomStyleMap&&layer.nodeDomStyleMap[iD.data.DataType.LANE_ATTRIBUTE]){delete layer.nodeDomStyleMap[iD.data.DataType.LANE_ATTRIBUTE]}}}context.map().dimensions(context.map().dimensions());!self.enable&&clearRenderFun()}};return effect};;;iD.effects=iD.effects||{};iD.effects.dividerAttrHighlight=function(context){var effect={id:"divider-attr-highlight",button:"dividerAttrHighlight",title:t("effects.dividerAttrHighlight.title"),iconText:"DA",description:t("effects.dividerAttrHighlight.description"),key:"Shift+T",enable:false,apply:function(context,open){var dividerName=iD.data.DataType.DIVIDER;var layers=context.layers().getLayersByModelName(dividerName);var self=this;self.enable=null==open?false:open;context.variable.isDividerAttrHighlight=self.enable;var layer;for(let i=0;i<layers.length;i++){layer=layers[i];if(!self.enable&&layer.nodeDomStyleMap&&layer.nodeDomStyleMap[iD.data.DataType.DIVIDER_ATTRIBUTE]){delete layer.nodeDomStyleMap[iD.data.DataType.DIVIDER_ATTRIBUTE]}var optionObj={};optionObj.nodeDomStyleMap=layer.nodeDomStyleMap||{};optionObj.nodeDomStyleMap[iD.data.DataType.DIVIDER_ATTRIBUTE]=function(entity,gdom){if(entity.modelName!=iD.data.DataType.DIVIDER_NODE){return}var $g=d3.select(gdom);$g.selectAll("circle.divider_attribute").remove();$g.selectAll("*").style("display",null);if(!self.enable){$g.classed("divider_attr",false);domStyleLA($g);return}var graph=context.graph();var relations=graph.parentRelations(entity,iD.data.DataType.DIVIDER_ATTRIBUTE);if(!relations.length){$g.classed("divider_attr",false);domStyleLA($g);return}$g.classed("divider_attr",true);$g.selectAll("*").each(function(){var $this=d3.select(this);if($this.classed("shadow"))return;if($this.classed("fill"))return;if($this.classed("lane_attribute"))return;$this.style("display","none")});$g.insert("circle",".fill").classed({divider_attribute:true}).attr({cx:0,cy:0,r:5}).style({fill:"rgb(255, 0, 0)",stroke:"rgb(120, 0, 0)","stroke-width":1});domShadow($g)};layer.setOptions(optionObj)}function domStyleLA($g){domShadow($g);if(!$g.classed("lane_attr")){return}$g.selectAll("*").each(function(){var $this=d3.select(this);if($this.classed("shadow"))return;if($this.classed("fill"))return;if($this.classed("lane_attribute"))return;$this.style("display","none")})}function domShadow($g){var r=7.5;if($g.classed("divider_attr")){r=8.5}if($g.classed("lane_attr")){r=11.5}r&&$g.select("circle.shadow").attr("r",r)}function clearRenderFun(){var layer;for(let i=0;i<layers.length;i++){layer=layers[i];if(!self.enable&&layer.nodeDomStyleMap&&layer.nodeDomStyleMap[iD.data.DataType.DIVIDER_ATTRIBUTE]){delete layer.nodeDomStyleMap[iD.data.DataType.DIVIDER_ATTRIBUTE]}}}context.map().dimensions(context.map().dimensions());!self.enable&&clearRenderFun()}};return effect};;;iD.effects=iD.effects||{};iD.effects.breakNodeHighlight=function(context){var effect={id:"breaknode-highlight",button:"breaknode-highlight",title:t("effects.breakNodeHighlight.title"),iconText:"BN",description:t("effects.breakNodeHighlight.description"),key:"Shift+B",enable:false,apply:function(context,open){var layerMName=iD.data.DataType.DIVIDER_NODE;var layers=context.layers().getLayersByModelName(layerMName);var self=this;self.enable=null==open?false:open;context.variable.isBreakNodeHighlight=self.enable;var layer;for(let i=0;i<layers.length;i++){layer=layers[i];var optionObj={};optionObj.nodeDomStyle=function(entity,gdom){if(entity.modelName!=iD.data.DataType.DIVIDER_NODE){return}var $g=d3.select(gdom);$g.selectAll("circle.node_breakpoint").remove();$g.selectAll("*").style("display",null);if(!self.enable){$g.classed("breaknode_highligh",false);return}if("4"!=entity.tags.DASHTYPE){$g.classed("breaknode_highligh",false);return}$g.classed("breaknode_highligh",true);$g.selectAll("*").each(function(){var $this=d3.select(this);if($this.classed("shadow"))return;if($this.classed("fill"))return;$this.style("display","none")});$g.insert("circle",".fill").classed({node_breakpoint:true}).attr({cx:0,cy:0,r:5}).style({fill:"rgb(90, 253, 90)",stroke:"rgb(0, 127, 0)","stroke-width":1});$g.select("circle.shadow").attr("r",8.5)};layer.setOptions(optionObj)}function clearRenderFun(){var layer;for(let i=0;i<layers.length;i++){layer=layers[i];if(!self.enable&&layer.nodeDomStyle){delete layer.nodeDomStyle}}}context.map().dimensions(context.map().dimensions());!self.enable&&clearRenderFun()}};return effect};;;iD.effects=iD.effects||{};iD.effects.roadHighlight=function(context){var roadHighlightParamList=[];var effect={id:"road-highlight",button:"roadhighlight",title:t("effects.roadHighlight.title"),iconText:"RA",description:t("effects.roadHighlight.description"),key:"Shift+E",enable:false,apply:function(context,open){var nodeName=iD.data.DataType.ROAD;var nodes=context.layers().getCurrentModelEnableLayer(nodeName);if(!nodes)return;var self=this;self.enable=null==open?false:open;var roadObj={style:function(entity){var graph=context.graph();var relations=graph.parentRelations(entity,iD.data.DataType.R_ROAD_RA);var effectColor=null;if(self.enable){if(0<relations.length){effectColor="#000000"}else{effectColor="#FFFFFF"}return{stroke:effectColor}}else{return{stroke:null}}}};nodes.setOptions(roadObj);context.map().dimensions(context.map().dimensions())}};return effect};;;iD.effects=iD.effects||{};iD.effects.Default=function(context){var effect={id:"default",button:"default",title:"",description:"",key:"Shift+D",apply:function(context){}};return effect};;;iD.effects=iD.effects||{};iD.effects.ShapePoint=function(context){var effect={id:"shape-point",button:"shapepoint",title:t("effects.shapepoint.title"),iconText:"SP",description:t("effects.shapepoint.description"),key:"Shift+S",enable:false,apply:function(context,open,selectedids){var self=this;self.enable=null==open?false:open;context.variable.showShapePoint=false;if(self.enable){context.variable.showShapePoint=true}refreshMap()}};function refreshMap(){context.map().dimensions(context.map().dimensions())}return effect};;;iD.ui.Effects=function(context){var defaultEffects=iD.effects.Default(context);var ladaEffect=[iD.effects.laneHighlight(context),iD.effects.dividerAttrHighlight(context)];var originEffects=[iD.effects.DividerArea(context),ladaEffect[0],ladaEffect[1],iD.effects.roadHighlight(context),iD.effects.DividerDrefMemberArea(context),iD.effects.labelField(context),iD.effects.wayDirection(context),iD.effects.ShapePoint(context),iD.effects.breakNodeHighlight(context)];return function(selection){var effects=originEffects;function effectIsMulti(d){var isLaDa=false;var la=ladaEffect[0],da=ladaEffect[1];if(d==la){isLaDa=buttons.filter("#effects-"+da.id).classed("active")&&da.enable}else if(d==da){isLaDa=buttons.filter("#effects-"+la.id).classed("active")&&la.enable}return isLaDa}var buttons=selection.selectAll("button").data(effects).enter().append("button").attr("class","KDSEditor-col6-1").attr("id",function(d){return"effects-"+d.id}).on("click",function(d){var is_active=d3.select(this).classed("active");var elements=iD.Static.layersInfo.getElements();if("navitype"==d.id&&!elements.road.display&&!is_active){d3.select(".layer-manager-pane.KDSEditor-pane .dropdown-menu .item-road i").trigger("click")}var isMult=effectIsMulti(d);!isMult&&_closeAllEffects(d);if(!is_active){d3.select(this).classed("active",!is_active);d.enable=true;d.apply(context,true)}else{d3.select(this).classed("active",!is_active);defaultEffects.apply(context);d.apply(context,false)}context.event.changeeffect(d.id,d.enable)}).call(bootstrap.tooltip().placement("bottom").html(true).title(function(d){return iD.ui.tooltipHtml(d.description,d.key)}));buttons.append("div").classed("for-border",true).append("span").attr("class",function(d){return"KDSEditor-icon "+d.id+(d.iconText?" icon-text":"")}).text(function(d){return d.iconText||""});var keybinding=d3.keybinding("effects");effects.forEach(function(m){keybinding.on(m.key,function(){buttons.each(function(o){if(m.button===o.button&&!d3.select(this).property("disabled")){var isMult=effectIsMulti(o);if(isMult){buttons.each(function(d){return!_.pluck(ladaEffect,"button").include(d.button)}).classed("active",false)}else{buttons.classed("active",false)}!isMult&&_closeAllEffects(m);d3.select(this).classed("active",true);m.apply(context,true)}})})});function _closeAllEffects(openedEf){for(var i in effects){var ef=effects[i];if(ef&&ef!==openedEf){ef.enable=false;ef.apply(context,ef.enable)}}buttons.each(function(d){if(d==openedEf){return}d3.select(this).classed("active",d.enable)})}d3.select(document).call(keybinding);var defaultkeybinding=d3.keybinding("defaulteffects");defaultkeybinding.on(defaultEffects.key,function(){buttons.classed("active",false);defaultEffects.apply(context)});d3.select(document).call(defaultkeybinding);defaultEffects.apply(context);iD.Task.on("start",function(){update()});context.ui().layermanager.on("change.effects",function(){update()});function update(){return;var elements=iD.Static.layersInfo.getElements();var visiable=elements.road.display;buttons.data().forEach(function(obj){if("navitype"!=obj.id&&"walkFT"!=obj.id){var button=d3.select("#"+"effects-"+obj.id);button.classed("hide",!visiable)}});if(false==elements.walk.display){var navitypeButton=d3.select("#effects-navitype");navitypeButton.classed("hidden",true);var walkFTButton=d3.select("#effects-walkFT");walkFTButton.classed("hidden",true)}if(true==elements.walk.display){var navitypeButton=d3.select("#effects-navitype");navitypeButton.classed("hidden",false);var walkFTButton=d3.select("#effects-walkFT");walkFTButton.classed("hidden",false)}}}};;;iD.ui.RawTagMarkEditor=function(context){var event=d3.dispatch("change"),state,selectEntityid,openMap={},clearHtml=false,currentLayer,tagModelName,modelEntity,geoType,fields,intercept=6;var itemTitleMap={[iD.data.DataType.CHECK_TAG]:"\u8D28\u68C0\u6807\u8BB0: ",[iD.data.DataType.IMAGE_TAG]:"\u56FE\u50CF\u6807\u8BB0: "};function rawEditable(d,modelName){if(modelName==iD.data.DataType.CHECK_TAG){if("STATE"==d.fieldName){if(!iD.User.isEditCheckSystemAndRole()){return true}}}return currentLayer&&currentLayer.editable&&"1"!=d.readOnly}function reIntercept(){var width=window.innerWidth;var height=window.innerHeight;intercept=1300<width?6:3;intercept=820>width?1:intercept}function rawTagMarkEditor(selection){modelEntity=iD.ModelEntitys[tagModelName];if(!modelEntity){selection.selectAll(".tag-list").remove();return}geoType=modelEntity.getGeoType();reIntercept();fields=modelEntity.getFields(geoType);if(clearHtml){selection.html("")}selection.call(content);d3.select(window).on("resize.rawTagMarkEditor",function(){reIntercept()})}var selectGroup;function selectGroups(writeTags){selectGroup={};writeTags.forEach(function(t){t.fieldInput.values&&t.fieldInput.values.forEach(function(s){if(s.parentId&&!selectGroup[s.parentId]){selectGroup[s.parentId]=[]}if(selectGroup[s.parentId]){selectGroup[s.parentId].push({name:s.name,value:s.value})}})})}function getWriteReadTags(entityid){var entity=context.entity(entityid);var tags=entity.tags||{};var _tags=[];var parentId=false;_(fields).each(function(field){var _name=field.fieldName||"",_title=field.fieldTitle||_name;var _value=tags[_name]||"";field.title=_title;field.value=_value;_tags.push(field)});var entries=_tags;var _writeTags=_.filter(entries,function(d){return"0"!=d.display;return"0"===d.readOnly}),_readonlyTags=_.filter(entries,function(d){return"1"===d.readOnly});return{write:_writeTags,readonly:_readonlyTags}}function _renderRaw($tagListRaw){var $titleWrap=$tagListRaw.selectAll("div").data([0]);$titleWrap=$titleWrap.enter().append("div").attr("class","raw-title-wrap");var $titleText=$titleWrap.selectAll("span").data([0]);$titleText=$titleText.enter().append("span").attr("class","tagmark-title").attr("title",function(){var d=this.parentNode.parentNode.__data__;let entity=context.entity(d);let eid=_.last((entity.id||"").split(iD.Entity.id.delimiter))||entity.id;let titleText=(itemTitleMap[tagModelName]||"\u6807\u8BB0: ")+(entity.tags.NAME||eid);d3.select(this).text(titleText);return titleText});$titleText.on("click.tagmark",function(){let $parent=d3.select(this.parentNode.parentNode);let datum=$parent.datum();if($parent.classed("in")){$parent.classed("in",false);openMap[datum]=false}else{$parent.classed("in",true);openMap[datum]=true}});if(!currentLayer||!currentLayer.display){return}let $locate=$titleWrap.selectAll("div").data([1]);$locate=$locate.enter().append("div").attr("class","tagmark-icon-locate").attr("title","\u4F4D\u7F6E\u5B9A\u4F4D").style("background-image","url(\""+context.imagePath("cursor-draw2x.png")+"\")");$locate.on("click.tagmark",function(d){var d=this.parentNode.parentNode.__data__;let datum=context.hasEntity(d);if(!datum){return}var player=iD.picUtil.player;if(datum.tags.TRACKPOINTID&&player&&player._zrender){player.locateTrackPointToPlayer(datum.tags.TRACKPOINTID,datum.tags.TRACKID)}if(datum.extent){context.extent(datum.extent());context.map().zoom(20);context.enter(iD.modes.Select(context,[datum.id]).suppressMenu(false).newFeature(false))}})}function content($wrap){var tagEntityList=context.intersects(iD.geo.Extent([-Infinity,-Infinity],[Infinity,Infinity])).map(function(entity){if(entity.modelName==tagModelName){return entity}});tagEntityList=_.compact(tagEntityList);if(tagEntityList.length){currentLayer=iD.Layers.getLayer(tagEntityList[0].layerId,tagEntityList[0].modelName)}var entityidList=_.pluck(tagEntityList,"id");entityidList.sort(function(a,b){return 1*iD.Entity.id.toOSM(a)-1*iD.Entity.id.toOSM(b)});var $items=$wrap.selectAll("div.tag-list-raw").data(entityidList);$tagListRaw=$items.enter().append("div").attr("class","tag-list-raw collpase").each(function(d){d3.select(this).call(_renderRaw,d);d3.select(this).call(drawWriteTags,d)});$items.exit().remove();$wrap.selectAll("div.tag-list-raw").each(function(){var $item=d3.select(this);var entityid=$item.datum();if(!entityid){return}var entity=context.hasEntity(entityid);var lay=entity&&iD.Layers.getLayer(entity.layerId);var $list=$item.select("ul.tag-list");$list.classed("no-pointer-events",false);if(lay&&lay.tagReadOnly||entity&&!iD.util.entityInPlyGon(entity,context)){$list.classed("no-pointer-events",true)}});let tempOpen={};$items.each(function(d){if(d==selectEntityid){d3.select(this).classed("selected",true)}else{d3.select(this).classed("selected",false)}if(openMap[d]){tempOpen[d]=true;d3.select(this).classed("in",true)}});openMap=tempOpen;function selectValueChange(d){if(!d){d=d3.event.target.parentNode.__data__}var tag={};tag[d.fieldName]=this.options[this.selectedIndex].value;let entityid=$(this).closest(".tag-list-raw")[0].__data__;var entity=context.hasEntity(entityid);event.change(tag,entityid);context.event["entityedite"]&&context.event["entityedite"]({entitys:[entityid]})}function keyValueChange(d){var that=this,_currentObj=d3.select(that),_value=that.value,flag=/^\d+(\.\d+)?$/.test(_value);let entityid=$(this).closest(".tag-list-raw")[0].__data__;context.event["entityedite"]&&context.event["entityedite"]({entitys:[entityid]})}function valueChange(d){var that=this,_currentObj=d3.select(that),_value=that.value;_currentObj.classed("error",false).attr("placeholder","");var tag={};tag[d.fieldName]=_value;let entityid=$(this).closest(".tag-list-raw")[0].__data__;event.change(tag,entityid)}function drawWriteTags(wrapper,id){var entity=context.entity(id);var _writeTags=getWriteReadTags(id).write;let currentLayer=iD.Layers.getLayer(entity.layerId,entity.modelName);let parentId=false;var $list=wrapper.selectAll(".tag-list").data([0]);$list.enter().append("ul").attr("class","tag-list collapse-body");var $items=$list.selectAll("li").data(_writeTags,function(d){return d.id});selectGroups(_writeTags);var $enter=$items.enter().append("li").attr("class","tag-row cf").attr("data-fld",function(d){return d.fieldName});$enter.append("div").attr("class","key-wrap").append("label").attr("class","key KDSEditor-label");var $inputWrapPosition=$enter.append("div").attr("class","input-wrap-position");$inputWrapPosition.each(function(d){var that=this;if("select"===d.fieldInput.type){var select=d3.select(that).append("select").attr("class","value");var subarr=[];d.fieldInput.values&&d.fieldInput.values.filter(function(e){if(!parentId||parentId==e.parentId){subarr.push({name:e.name,value:e.value});parentId=e.parentId}});if(0<subarr.length){var optionData=_.clone(subarr)}else{var optionData=_.clone(d.fieldInput.values)}optionData.unshift({name:"==\u8BF7\u9009\u62E9==",value:"",values:[]});var options=select.selectAll("option").data(optionData).enter().append("option").attr("value",function(o){return o.value}).attr("title",function(o){return o.name}).attr("label",function(o){return iD.util.substring(o.name,8)}).text(function(o){return iD.util.substring(o.name,8)})}else if("selectgroup"===d.fieldInput.type){var select=d3.select(that).append("select").attr("class","value").on("change.selectgroup",function(o){if(!o){return}let selectvalue=this.value;let falg=false;let sublist;o.fieldType.fieldTypeValues.filter(function(e){if(selectvalue==e.value){sublist=_.clone(selectGroup[e.id]);parentId=e.id;if(!sublist){sublist=[]}sublist.unshift({name:"==\u8BF7\u9009\u62E9==",value:"",values:[]})}});var subtypeselect=$list.select("li[data-fld='SUBTYPE']"),subtypeoptionData=_.clone(sublist);subtypeselect.selectAll("option").remove();var suboptions=subtypeselect.select("select").selectAll("option").data(subtypeoptionData).enter().append("option").attr("value",function(o){return o.value}).attr("title",function(o){return o.name}).attr("label",function(o){return iD.util.substring(o.name,8)}).text(function(o){return iD.util.substring(o.name,8)})});var optionData=_.clone(d.fieldInput.values);var selectvalue=d.value;d.fieldInput.values.filter(function(e){if(selectvalue==e.value){parentId=e.id}});var options=select.selectAll("option").data(optionData).enter().append("option").attr("value",function(o){return o.value}).attr("title",function(o){return o.name}).attr("label",function(o){return iD.util.substring(o.name,8)}).text(function(o){return iD.util.substring(o.name,8)})}else{d3.select(that).append("input").property("type","text").attr("class","value KDSEditor-input").attr("maxlength",function(item){return parseInt(item.size||80,10)})}});$items.order();$items.select("label.key").html(function(d){return iD.util.substring(d.title,intercept)}).attr("title",function(d){return d.title});$items.select("input.value").value(function(d){return d.value}).property("title",function(d){return d.value}).property("disabled",function(d){return!rawEditable(d,tagModelName)}).on("change",valueChange).on("keyup",keyValueChange).on("blur",valueChange);$items.select("select.value").on("change.selectvaluechange",selectValueChange).each(function(item){d3.select(this).selectAll("option").each(function(option){d3.select(this).property("selected",option.value==item.value)})}).property("disabled",function(d){return!rawEditable(d,tagModelName)});$items.exit().remove()};}rawTagMarkEditor.state=function(_){if(!arguments.length)return state;state=_;return rawTagMarkEditor};rawTagMarkEditor.selectEntity=function(_){if(!arguments.length)return selectEntityid;selectEntityid=_;return rawTagMarkEditor};rawTagMarkEditor.clearHtml=function(_){if(!arguments.length)return clearHtml;clearHtml=_;return rawTagMarkEditor};rawTagMarkEditor.modelName=function(_){if(!arguments.length)return tagModelName;tagModelName=_;return rawTagMarkEditor};return d3.rebind(rawTagMarkEditor,event,"on")};;;iD.ui.InspectorTagList=function(context,modelName){var entityEditor=iD.ui.EntityEditor(context),rawTagEditor=iD.ui.RawTagMarkEditor(context),state="select",tagModelName=modelName||iD.data.DataType.CHECK_TAG;function inspector(selection,entityid,clearHtml=true){selection.classed("KDSEditor-inspector-disabled",true);var $wrap=selection.selectAll(".KDSEditor-panewrap").data([0]);var $enter=$wrap.enter().append("div").attr("class","KDSEditor-panewrap");$enter.append("div").attr("class","KDSEditor-pane");var $body=$wrap.select(".KDSEditor-pane").selectAll(".KDSEditor-inspector-body").data([0]);$enter=$body.enter().append("div").attr("class","KDSEditor-inspector-body");let modelClass="raw-tml-"+tagModelName.toLowerCase();$enter.append("div").attr("class","KDSEditor-inspector-border raw-taglist-editor KDSEditor-inspector-inner "+modelClass);$body.select("."+modelClass).call(rawTagEditor.modelName(tagModelName).clearHtml(clearHtml).selectEntity(entityid).state(state));rawTagEditor.on("change.inspectorTag",function(tags,id){entityEditor.entityID(id).changeTags(tags)})}inspector.state=function(_){if(!arguments.length)return state;state=_;rawTagEditor.state(state);return inspector};inspector.isMatchType=function(id){return id&&context.hasEntity(id)&&context.entity(id).modelName==tagModelName};return inspector};;;iD.ui.RawTagEditor=function(context){var event=d3.dispatch("change"),state,tags,id,currentLayer,modelEntity,geoType,fields,intercept=6;var currentRoadIndex=0,selectIdsLength=0,selectIds=[];var tagEditors=[iD.ui.TagEditor.RoadTagEditor(context),iD.ui.TagEditor.RoadNodeTagEditor(context),iD.ui.TagEditor.RoadCrossTagEditor(context),iD.ui.TagEditor.PoiTagEditor(context),iD.ui.TagEditor.DividerAttributeTagEditor(context),iD.ui.TagEditor.LaneAttributeTagEditor(context),iD.ui.TagEditor.RoadAttributeTagEditor(context)];_.each(tagEditors,function(editor){editor.on("change",event.change)});function previousRoad(){currentRoadIndex=currentRoadIndex-1;if(1>currentRoadIndex){currentRoadIndex=1;return}var selectid=selectIds[currentRoadIndex-1];d3.select("#currentRoadPageNumber").value(currentRoadIndex);if(d3.event){d3.event._isFromList=true}context.enter(iD.modes.Select(context,[selectid],null,true).newFeature(true))}function nextRoad(){currentRoadIndex=currentRoadIndex+1;if(currentRoadIndex>selectIdsLength){currentRoadIndex=selectIdsLength;return}var selectid=selectIds[currentRoadIndex-1];d3.select("#currentRoadPageNumber").value(currentRoadIndex);if(d3.event){d3.event._isFromList=true}context.enter(iD.modes.Select(context,[selectid],null,true).newFeature(true))}function locationEntity(entity){var selExtent=iD.geo.Extent(),map=context.map(),graph=context.graph();var oldExtentArea=selExtent.area()||1;selExtent=selExtent.extend(entity.extent(graph));if(20>parseInt(map.extentZoom(selExtent))){map.zoom(20)}else{map.extent(selExtent)}}function presetFooter(wrapper,entity){if(_.include([iD.data.DataType.DIVIDER_ATTRIBUTE,iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION],entity.modelName)){return}var data=[];var d3Obj=d3.select("#KDSEditor-sidebar");if(0<d3Obj.size()){let selectIds=d3Obj.attr("data-member-multiselectids")||d3Obj.attr("data-multiselectids");if(selectIds){data.push(selectIds)}}var preset_footer=wrapper.append("div").attr("class","preset-form form-input-field checkselect").attr("id","multiRoadEditor_footer");var roadNav=preset_footer.append("div").attr("class","preset-form form-input-field");selectIds=0<data.length?data[0].split(","):data;if(!selectIds||!selectIds.length){return}var index=_.indexOf(selectIds,entity.id);currentRoadIndex=(index||0)+1;selectIdsLength=selectIds.length;var ul=roadNav.append("nav").append("ul").attr("class","pagination");ul.append("li").append("a").on("click",previousRoad).attr({"aria-label":"Previous",href:"#"}).append("span").attr({"aria-hidden":true}).text("\xAB");var $input=ul.append("li").append("input").attr({"aria-label":"Number",type:"text",id:"currentRoadPageNumber",min:1,max:selectIdsLength}).value(currentRoadIndex);ul.append("li").append("a").attr({href:"#"}).append("span").attr({"aria-hidden":true,id:"currentRoadInfo"}).text("/"+selectIdsLength);ul.append("li").append("a").on("click",nextRoad).attr({"aria-label":"Next",href:"#"}).append("span").attr({"aria-hidden":true}).text("\xBB");roadNav.append("nav").append("ul").attr("class","pagination").append("li").append("a").on("click",_returnHomeList).attr({href:"#"}).text("\u8FD4\u56DE");$input.on("change",_roadPageNumberChange).on("keyup",function(){var evt=d3.event;if(!evt)return false;if(13==evt.keyCode||108==evt.keyCode){_roadPageNumberChange.call(this)}return false});ul.selectAll("li").classed("clearfix",true).style("float","left");locationEntity(entity)}function _roadPageNumberChange(){var num=Number(this.value);var min=Number(this.min),max=Number(this.max);if(isNaN(num)){num=min}if(num<min){num=min}if(num>max){num=max}this.value=num;currentRoadIndex=num-1;nextRoad()}function _returnHomeList(){var d3Obj=d3.select("#KDSEditor-sidebar");if(0<d3Obj.size()){var str=d3Obj.attr("data-multiselectids")||"";if(str.length){selectIds=str.split(",")}}context.enter(iD.modes.Select(context,selectIds).suppressMenu(true))}function reIntercept(){var width=window.innerWidth;var height=window.innerHeight;intercept=1300<width?6:3;intercept=820>width?1:intercept}function rawTagEditor(selection){selection.html("");var $form=selection.selectAll(".preset-form").data([0]);$form.enter().append("div").attr("class","preset-form inspector-inner fillL3");var tagEditorPanes=$form.selectAll(".tag_editor_pane").data(tagEditors);tagEditorPanes.enter().append("div").attr("class","tag_editor_pane");var entity=context.entity(id);var matchedTagEditor=null;tagEditorPanes.each(function(d){var available=!matchedTagEditor&&d.available(entity);if(available){matchedTagEditor=d}var pane=d3.select(this);pane.classed("KDSEditor-inspector-hidden",!available);if(available){pane.call(d,{id:id,tags:tags});pane.on&&pane.on("change.raw_tag_editor",function(){context.event["entityedite"]&&context.event["entityedite"]({entitys:[]})})}});var $tagContent=selection.selectAll(".tag-content").data([0]);$tagContent.enter().append("div").attr("class","tag-content");if(matchedTagEditor){$tagContent.html("");if(d3.select(".preset-form.form-input-field.checkselect").data([0]).empty()){presetFooter(selection,entity)}return}else{currentLayer=context.layers().getLayer(entity.layerId,entity.modelName);modelEntity=iD.ModelEntitys[entity.modelName];if(!modelEntity){selection.selectAll(".tag-list").remove();return}geoType=modelEntity.getGeoType()}reIntercept();fields=modelEntity.getFields(geoType);selection.call(content);d3.select(window).on("resize.rawTagEditor",function(){reIntercept();selection&&content&&selection.call(content)})}var selectGroup;function selectGroups(writeTags){selectGroup={};writeTags.forEach(function(t){t.fieldInput.values&&t.fieldInput.values.forEach(function(s){if(s.parentId&&!selectGroup[s.parentId]){selectGroup[s.parentId]=[]}if(selectGroup[s.parentId]){selectGroup[s.parentId].push({name:s.name,value:s.value})}})})}function content($wrap){var entity=context.hasEntity(id),entries=d3.entries(tags);if(!entity){return}var _tags=[];var parentId=false;_(fields).each(function(field){var _name=field.fieldName||"",_title=field.fieldTitle||_name;var _value=tags[_name]||"";field.title=_title;field.value=_value;_tags.push(field)});entries=_tags;var _writeTags=_.filter(entries,function(d){return"0"!=d.display;return"0"===d.readOnly}),_readonlyTags=_.filter(entries,function(d){return"1"===d.readOnly});$wrap.call(drawWriteTags);function selectValueChange(d){if(!d){d=d3.event.target.parentNode.__data__}var tag={};tag[d.fieldName]=this.options[this.selectedIndex].value;event.change(tag);context.event["entityedite"]&&context.event["entityedite"]({entitys:[id]})}function keyValueChange(d){var that=this,_currentObj=d3.select(that),_value=that.value,flag=/^\d+(\.\d+)?$/.test(_value);context.event["entityedite"]&&context.event["entityedite"]({entitys:[id]})}function valueChange(d){var that=this,_currentObj=d3.select(that),_value=that.value;_currentObj.classed("error",false).attr("placeholder","");var tag={};tag[d.fieldName]=_value;event.change(tag)}function otherValueChange(d){var that=this,_value=d.value;var tag={};tag[d.fieldName]=_value;event.change(tag)}function drawWriteTags(wrapper){var entity=context.entity(id);var $list=wrapper.selectAll(".tag-list").data([0]);$list.enter().append("ul").attr("class","tag-list clearfix");var $items=$list.selectAll("li").data(_writeTags,function(d){return d.id});_writeTags.forEach(function(w){if(w.tags&&"1"==w.tags.R_LINE){isRLine=true}});selectGroups(_writeTags);var $enter=$items.enter().append("li").attr("class","tag-row cf").attr("data-fld",function(d){return d.fieldName});$enter.append("div").attr("class","key-wrap").append("label").attr("class","key KDSEditor-label");var $inputWrapPosition=$enter.append("div").attr("class","input-wrap-position");var defaultNewRelation={vehicle:[{id:31}],type:"0",timeInfo:{timeRange:[{start:"00:00",end:"24:00"}],weather:_.map(iD.ui.RoadRule.Weather.Options,function(item){return _.assign({},item,{name:item.label})})}};$inputWrapPosition.each(function(d){var that=this;var domLi=this.parentNode;if("select"===d.fieldInput.type){var select=d3.select(that).append("select").attr("class","value");var subarr=[];d.fieldInput.values&&d.fieldInput.values.filter(function(e){if(!parentId||parentId==e.parentId){subarr.push({name:e.name,value:e.value});parentId=e.parentId}});if(0<subarr.length){var optionData=_.clone(subarr)}else{if("SUBTYPE"==d.fieldName){var optionData=[]}else{var optionData=_.clone(d.fieldInput.values)}}optionData.unshift({name:"==\u8BF7\u9009\u62E9==",value:"",values:[]});var options=select.selectAll("option").data(optionData).enter().append("option").attr("value",function(o){return o.value}).attr("title",function(o){return o.name}).attr("label",function(o){return iD.util.substring(o.name,8)}).text(function(o){return iD.util.substring(o.name,8)})}else if("selectgroup"===d.fieldInput.type){var select=d3.select(that).append("select").attr("class","value").on("change.selectgroup",function(o){if(!o){return}let selectvalue=this.value;let falg=false;let sublist;o.fieldType.fieldTypeValues.filter(function(e){if(selectvalue==e.value){sublist=_.clone(selectGroup[e.id]);parentId=e.id;if(!sublist){sublist=[]}sublist.unshift({name:"==\u8BF7\u9009\u62E9==",value:"",values:[]})}});var subtypeselect=$list.select("li[data-fld='SUBTYPE']")[0][0]?$list.select("li[data-fld='SUBTYPE']"):$list.select("li[data-fld='VALUE']");var $subselect=subtypeselect.select("select.value");var subselect=$subselect.node();var subValue=subselect.value;var subtypeoptionData=_.clone(sublist);subtypeselect.selectAll("option").remove();var suboptions=subtypeselect.select("select").selectAll("option").data(subtypeoptionData).enter().append("option").attr("value",function(o){return o.value}).attr("title",function(o){return o.name}).attr("label",function(o){return iD.util.substring(o.name,8)}).text(function(o){return iD.util.substring(o.name,8)});if(""!=subValue){var oldV=_.pluck(sublist,"value").filter(function(v){return v.value==subValue})[0];if(!oldV){subselect.value="";$subselect.dispatch("change")}}});var optionData=_.clone(d.fieldInput.values);var selectvalue=d.value;d.fieldInput.values.filter(function(e){if(selectvalue==e.value){parentId=e.id}});var options=select.selectAll("option").data(optionData).enter().append("option").attr("value",function(o){return o.value}).attr("title",function(o){return o.name}).attr("label",function(o){return iD.util.substring(o.name,8)}).text(function(o){return iD.util.substring(o.name,8)})}else if(_.include(["TIME","VEHICLE","WEATHER"],d.fieldName)&&entity.modelName==iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION){var $domLi=d3.select(domLi);$domLi.classed("higher",true);var $label=$domLi.select("label.KDSEditor-label");if("TIME"==d.fieldName&&"text"==d.fieldInput){$domLi.style("height","91px");$label.style("line-height","91px");let $iwp=d3.select(that);var render=iD.ui.RoadRule.TimeRange({limit:5,btns:false});render($iwp);var timeRange=d.value.timeRange&&0!=d.value.timeRange?d.value.timeRange:defaultNewRelation.timeInfo.timeRange;render.val(timeRange);$iwp.selectAll(".hour").style("width","48%").on("change",function(){var timeObj=render.getVal();var time=iD.convertInfoToGDF({timeRange:timeObj});d.value=time;otherValueChange(d)});$iwp.selectAll(".minute").style("width","48%").on("change",function(){var timeObj=render.getVal();var time=iD.convertInfoToGDF({timeRange:timeObj});d.value=time;otherValueChange(d)})}else if("VEHICLE"==d.fieldName&&"text"==d.fieldInput){$domLi.style("height","270px");$label.style("line-height","270px");var render=iD.ui.RoadRule.CarList();let $iwp=d3.select(that);render($iwp);render.on("change",function(){var carSelectedIds=render.getVal();var vehicles=iD.util._Util._createHexadecimalBySelectedCars(carSelectedIds);d.value=vehicles;otherValueChange(d)});var vehicles=d.value||defaultNewRelation.vehicle;render.val(_.map(vehicles,function(item){return item.id}))}else if("WEATHER"==d.fieldName&&"text"==d.fieldInput){$domLi.style("height","150px");$label.style("line-height","150px");let $iwp=d3.select(that);var render=iD.ui.RoadRule.Weather();render($iwp);render.on("change",function(){var weatherBits={sunny:0,rain:0,ice:0,fog:0,wind:0};var weatherVals=render.getVal();var bit="";for(var i=0;i<weatherVals.length;i++){weatherBits[weatherVals[i]]=1}for(var j in weatherBits){var bb=weatherBits[j];bit+=bb}d.value=bit;otherValueChange(d)});var weather=d.value||defaultNewRelation.timeInfo.season;render.val(weather)}else{$domLi.classed("higher",false)}}else{d3.select(that).append("input").property("type","text").attr("class","value KDSEditor-input").attr("maxlength",function(item){return parseInt(item.size||80,10)})}});$items.order();$items.select("label.key").html(function(d){return iD.util.substring(d.title,intercept)}).attr("title",function(d){return d.title});$items.select("input.value").value(function(d){return d.value}).property("title",function(d){return d.value}).property("disabled",function(d){return!currentLayer||!currentLayer.editable||"1"==d.readOnly}).on("change",valueChange).on("keyup",keyValueChange).on("blur",valueChange);$items.select("select.value").on("change.selectvaluechange",selectValueChange).each(function(item){d3.select(this).selectAll("option").each(function(option){d3.select(this).property("selected",option.value==item.value)})}).property("disabled",function(d){return!currentLayer||!currentLayer.editable||"1"==d.readOnly});$items.exit().remove();if(entity&&entity.modelName==iD.data.DataType.DIVIDER_NODE){clearAttribute(wrapper);var isLinear=iD.User.isLinearRole();if(!isLinear){let isRLine=false;let dividerInput=iD.ui.TagEditorInput.relations(context,iD.data.DataType.DIVIDER_ATTRIBUTE);dividerInput.entity(entity);var $dividerRelation=wrapper.selectAll(".tag-divider-attribute").data([0]);$dividerRelation.enter().append("div").attr("class","tag-divider-attribute");var $dividerTitle=$dividerRelation.selectAll(".tag-title").data([0]);$dividerTitle.enter().append("div").attr("class","tag-title");var $dividerContainer=$dividerRelation.selectAll(".tag-container").data([0]);$dividerContainer.enter().append("div").attr("class","tag-container");$dividerContainer.call(dividerInput);dividerInput.on("delete",function(){$dividerContainer.call(dividerInput)});if(!isRLine){let laneInput=iD.ui.TagEditorInput.relations(context,iD.data.DataType.LANE_ATTRIBUTE);laneInput.entity(entity);var $laneRelation=wrapper.selectAll(".tag-lane-attribute").data([0]);$laneRelation.enter().append("div").attr("class","tag-lane-attribute");var $laneTitle=$laneRelation.selectAll(".tag-title").data([0]);$laneTitle.enter().append("div").attr("class","tag-title");var $laneContainer=$laneRelation.selectAll(".tag-container").data([0]);$laneContainer.enter().append("div").attr("class","tag-container");$laneContainer.call(laneInput);laneInput.on("delete",function(){$laneContainer.call(laneInput)})}}}else if(entity&&(entity.modelName==iD.data.DataType.ROAD_NODE||entity.modelName==iD.data.DataType.C_NODE)){}else{clearAttribute(wrapper)}if(d3.select(".preset-form.form-input-field.checkselect").data([0]).empty()){presetFooter(wrapper,entity)}var _index=_.indexOf(selectIds,entity.id);if(selectIds.length){if(-1==_index){d3.select(".preset-form.form-input-field.checkselect").remove()}}};function clearAttribute(wrapper){wrapper.selectAll(".tag-divider-attribute").remove();wrapper.selectAll(".tag-lane-attribute").remove();wrapper.selectAll(".tag-maat-attribute").remove()}}rawTagEditor.state=function(_){if(!arguments.length)return state;state=_;return rawTagEditor};rawTagEditor.tags=function(_){if(!arguments.length)return tags;tags=_;return rawTagEditor};rawTagEditor.entityID=function(_){if(!arguments.length)return id;id=_;return rawTagEditor};return d3.rebind(rawTagEditor,event,"on")};;;iD.ui.openDialog=function(context){var dialogObj=iD.opendialog();function openDialog(){}openDialog.open=function(){var self=this;context.event.on("selected.opendialog",function(entities){if(1!=entities.length)return;self.showTag(entities)})};openDialog.showTag=function(entities){var entity=entities[0],tags=_.clone(entity.tags)};return d3.rebind(openDialog,[],"on")};;iD.ui.TagEditor={readOnly:function(input,readonly){input.property("readOnly",!!readonly).classed("no-pointer-events readonly",!!readonly)},disable:function(input,readonly){input.style("opacity",!!readonly?"0.5":"1");input.property("disabled",!!readonly).classed("no-pointer-events disabled",!!readonly)},toastr:function(selection,msg,opts){opts=opts||{};var $inputWrap=$(selection.node()).closest("div.form-field");if(120>$inputWrap.position().top){opts.placement="bottom"}opts=_.assign({timeout:5000,placement:"top",delay:0},opts);var toolBox=selection.append("div").attr("class","no-pointer-events toastr-box "+(opts.className?opts.className:"")),toolTip=bootstrap.tooltip().title(msg).placement(opts.placement);toolBox.call(toolTip);if(!opts.delay){toolTip.show(toolBox)}else{setTimeout(function(){toolTip.show(toolBox)},opts.delay)}var destroyToolTip=function(){toolTip.destroy(toolBox);toolBox.remove()};setTimeout(destroyToolTip,opts.timeout)},findInputRender:function(fieldTpl,fieldModel,tags){if(fieldTpl.fieldRender){return{type:fieldTpl.fieldRender,render:iD.ui.TagEditorInput[fieldTpl.fieldRender]}}if(!fieldModel){fieldModel={};return}var fieldInput=fieldTpl.inputType||fieldModel.fieldInput;if(_.isString(fieldInput)){fieldInput={type:fieldInput}}var inputRender=null,fieldOpts=null;switch(fieldInput.type){case"text":switch(fieldModel.fieldType){case"varchar":case"integer":inputRender=iD.ui.TagEditorInput.text;break;default:break;}break;case"select":inputRender=iD.ui.TagEditorInput.combo;var comboOpts={};_.each(fieldModel.fieldInput.values,function(opt){comboOpts[opt.value]=opt.name});fieldOpts={strings:{options:comboOpts}};break;case"selectgroup":inputRender=iD.ui.TagEditorInput.selectgroup;break;case"selectgroup2":inputRender=iD.ui.TagEditorInput.selectgroup2;break;default:console.warn("Unknown input type: ",fieldInput);}if(!inputRender){return}return{field:fieldOpts,render:inputRender,type:fieldInput.type}},findUiField:function(opts,fieldName){return"undefined"!=typeof opts.uiFields&&"undefined"!=typeof opts.uiFields[fieldName]?opts.uiFields[fieldName].input:false},renderField:function($field,opts){var fieldTpl=$field.datum(),fieldName=fieldTpl.fieldName,fields=opts.fields||{},tags=opts.tags,fieldModel=fields[fieldName];if(!fieldModel){return}var fieldDispatch=d3.dispatch("change","render");var $fieldWarp=$field.selectAll("div.KDSEditor-form-field-warp").data([fieldTpl]);$fieldWarp.enter().append("div").attr("class","KDSEditor-form-field-warp");$fieldWarp.exit().remove();var inputRender=iD.ui.TagEditor.findInputRender(fieldTpl,fieldModel,tags);if(!inputRender){$field.selectAll("*").remove();return}var fldTag=inputRender.type+"_"+fieldName,oldFldTag=$field.attr("data-fldtag");if(oldFldTag&&oldFldTag!=fldTag){console.warn("Field not match exists html structure",$field);$field.selectAll("*").remove()}$field.attr("data-fldtag",fldTag);var $label=$fieldWarp.selectAll("label.form-label").data([fieldTpl]);$label.enter().append("label").attr("class","form-label KDSEditor-form-label");$label.html(function(d){return fieldTpl.fieldLabel||fieldModel&&fieldModel.fieldTitle||fieldName});var wrap=$label.append("div").attr("class","form-label-button-wrap KDSEditor-form-label-button-wrap");var fieldOpts=_.assign({},opts,{fieldName:fieldName,fieldId:fieldName+"_"+(fieldModel?fieldModel.modelId:opts.layer.modelId),fieldTpl:fieldTpl,fieldModel:fieldModel});$label.attr("for",function(fieldTpl){return"preset-input-"+fieldOpts.fieldId});var uiField=iD.ui.TagEditorInput.UIField(inputRender.render,_.assign({id:fieldOpts.fieldId,key:fieldName,type:inputRender.type,placeholder:function(){return""},t:function(scope,options){return t(scope,options)}},inputRender.field,{fieldModel:fieldModel}),fieldOpts);opts.uiFields=opts.uiFields||{};opts.uiFields[fieldOpts.fieldName]=uiField;var $inpField=$fieldWarp.selectAll(".form-input-field").data([uiField]);$inpField.enter().append("div").attr("class","form-input-field");$inpField.call(uiField.input,fieldOpts);var entityType=opts.entity.modelName;var modelConfig=iD.Layers.getLayer(opts.entity.layerId,opts.entity.modelName);var readOnly=modelConfig&&!modelConfig.editable||!opts.layer.editable||fieldModel&&"undefined"!=typeof fieldModel.readOnly&&"1"===fieldModel.readOnly;var role=d3.select("body").attr("role");if("check"===role){readOnly=true}if(!iD.Task.working||iD.Task.working.task_id!==iD.Task.d.task_id){readOnly=true}uiField.input.readOnly(readOnly);uiField.input.tags(tags);$field.classed("readonly",readOnly).classed("modified",function(){return uiField.modified()}).classed("present",function(){return uiField.present()});uiField.input.on("change.fldv",function(d,eventTriggerType){var multiRoadTagFlag=false;if(0<d3.select("#multiEditor").size()){if(d3.select("#multiEditor")[0][0].checked){multiRoadTagFlag=true}}opts.isMultiRoadTag=0;opts.multiRoadTagFlag=multiRoadTagFlag;if(eventTriggerType){opts.eventTriggerType=eventTriggerType}fieldDispatch.change(d,fieldOpts,$inpField,uiField,opts)});if(fieldTpl.onRender){$field.call(fieldTpl.onRender,fieldOpts,uiField.input)}fieldDispatch.render($field,fieldOpts,uiField.input);return fieldDispatch},renderFieldGrpList:function($fieldList,opts){var fieldGrpDispatch=d3.dispatch("change","render"),grpTpl=$fieldList.datum();var $fields=$fieldList.selectAll(".form-field").data(grpTpl.fields,function(d){return d.fieldName});var $enter=$fields.enter().append("div").attr("class",function(d){return"form-field-"+d.fieldName+" form-field KDSEditor-form-field"});$fields.order().each(function(d){var field=iD.ui.TagEditor.renderField(d3.select(this),opts);if(field){field.on("change.grp",function(){if(grpTpl.onChange){grpTpl.onChange.apply($fieldList,arguments)}if(grpTpl.onValidate){}fieldGrpDispatch.change.apply(fieldGrpDispatch,arguments)})}});$fields.exit().remove();if(grpTpl.onRender){$fieldList.call(grpTpl.onRender,opts)}fieldGrpDispatch.render($fieldList,opts);return fieldGrpDispatch},renderFieldGroups:function(selection,tpl,opts){var fieldGrpsDispatch=d3.dispatch("change","render");var $form=selection,$fieldGroups=$form.selectAll(".field-group").data(tpl.fieldsGroup);var $enter=$fieldGroups.enter().append("div").attr("class","field-group");$enter.append("div").attr("class","field-group-list");function packLockKey(key){return"data-l-"+key}function lock(key){$form.attr(packLockKey(key),1)}function unlock(key){$form.attr(packLockKey(key),null)}function isLocked(key){return!!$form.attr(packLockKey(key))}function clone2(obj){var o,obj;if(obj.constructor==Object){o=new obj.constructor}else{o=new obj.constructor(obj.valueOf())}for(var key in obj){if(o[key]!=obj[key]){if("object"==typeof obj[key]){o[key]=clone2(obj[key])}else{o[key]=obj[key]}}}return o}$fieldGroups.selectAll(".field-group-list").each(function(d){iD.ui.TagEditor.renderFieldGrpList(d3.select(this),opts).on("change.grps",function(){lock("initValidate");var old_sel=clone2(arguments[0]);if(tpl.onChange){tpl.onChange.apply(selection,arguments)}let changeVals=arguments[0];if(tpl.onValidate){changeVals=tpl.onValidate.apply(selection,arguments)}fieldGrpsDispatch.change.apply(fieldGrpsDispatch,arguments);arguments[3].input.tags(_.assign({},arguments[1].tags,changeVals));if(!isLocked("fldChange")){opts.dispatch.change(changeVals,arguments,old_sel,tpl)}unlock("initValidate")})});$fieldGroups.exit().remove();if(tpl.onRender){selection.call(tpl.onRender,opts)}fieldGrpsDispatch.render(selection,opts);if(tpl.onInitValidate&&!isLocked("initValidate")){if("select"==opts.context.mode().id){lock("fldChange");for(var p in opts.uiFields){opts.uiFields[p].input.change();break}unlock("fldChange")}}return fieldGrpsDispatch},createInputValidate:function(){function strLimitIndex(str,maxLen){let limitIndex=str.length;let len=0;for(let i=0;i<str.length;i++){let c=str.charCodeAt(i);let np=0;if(1<=c&&126>=c||65376<=c&&65439>=c){np=1}else{np=2}if(len+np>maxLen){limitIndex=i;break}len+=np}return limitIndex}var numberReg=/^(\d+)/g;var inputValidate={text:function(str,length){str=str==undefined?"":str;if(length!=undefined){str=str.slice(0,strLimitIndex(str,length))}return str},number:function(str,length){str=str==undefined?"":str;let rst=numberReg.exec(str);if(rst&&rst[1]){str=rst[1]}if(length!=undefined){str=str.slice(0,strLimitIndex(str,length))}return Number(str)}};return inputValidate},createTplFieldList:function(modelEntity,displayFields=[]){var fields=modelEntity.getFields(modelEntity.getGeoType());var fieldOptList=[];for(var i in fields){let field=fields[i];if(displayFields.length){if(!_.include(displayFields,field.fieldName)){continue}}if("0"==field.display){continue}let fieldObj={};fieldObj.fieldName=field.fieldName;if("radio"==field.fieldInput){fieldObj.fieldRender="select"}else if(_.isObject(field.fieldInput)){if("mulselect"==field.fieldInput.type){fieldObj.fieldRender="mulselect"}else if("select"==field.fieldInput.type){fieldObj.fieldRender="select"}}else{fieldObj.fieldRender="text"}fieldOptList.push(fieldObj)}return fieldOptList}};iD.ui.TagEditorTpl={};iD.ui.TagEditorInput={UIField:function(inputRender,field,opts){var dispatch=opts.dispatch,context=opts.context,entity=opts.entity,tags=opts.tags;field=_.clone(field);field.input=inputRender(field,context,opts);if(field.input.entity)field.input.entity(entity);field.keys=field.keys||[field.key];field.shown=function(){return"name"===field.id||field.show||_.any(field.keys,function(key){return!!tags[key]})};field.modified=function(){var original=context.graph().base().entities[entity.id];return _.any(field.keys,function(key){return original?tags[key]!==original.tags[key]:tags[key]})};field.revert=function(){var original=context.graph().base().entities[entity.id],t={};field.keys.forEach(function(key){t[key]=original?original.tags[key]:undefined});return t};field.present=function(){return _.any(field.keys,function(key){return tags[key]})};field.remove=function(){var t={};field.keys.forEach(function(key){t[key]=undefined});return t};return field}};;;iD.ui.TagName={};iD.ui.TagName.isObjectEmpty=function(obj){if("object"===typeof obj&&!(obj instanceof Array)){var hasProp=false;for(var prop in obj){hasProp=true;break}return hasProp}return false};iD.ui.TagName.SBC=function(text){return text.replace(/[\x20-\x7e]/g,function($0){return" "==$0?"\u3000":String.fromCharCode($0.charCodeAt(0)+65248)})};iD.ui.TagName.dbc2sbc=function(str){return str.replace(/[\uff01-\uff5e]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)}).replace(/\u3000/g," ")};iD.ui.TagName.getInvalidRoadname=function(str){if(0<str.length){if(0<=str.indexOf(" ")){return"\u7A7A\u683C"}var arr=["\u5F15\u8DEF","\u6389\u5934","\u51FA\u53E3","\u5165\u53E3","\u6865","\u7ACB\u4EA4\u6865","\u8F85\u8DEF"];for(var i=0;i<arr.length;i++){if(str==arr[i]){return arr[i]}}}return undefined};;iD.ui.TagEditorTpl.Road=function(){var flag=false;function isObjectEmpty(obj){if("object"===typeof obj&&!(obj instanceof Array)){var hasProp=false;for(var prop in obj){hasProp=true;break}return hasProp}return false}function adjustTags(d,fieldOpts,$editor,uiField,opts){var originalAdas=fieldOpts.entity.tags.adas;var adasValue={originalValue:originalAdas,newValue:d.adas};if("0"!=originalAdas&&"undefined"!=typeof d.adas&&originalAdas!=d.adas){var adasPasswordTip=iD.ui.AdasPasswordTip(editor.context,passwordRight,passwordWrong,null,adasValue);adasPasswordTip.perform("ADAS\u5B57\u6BB5\u53D6\u503C\u7531\u975E0\u4FEE\u6539\u4E3A\u5176\u4ED6\u503C,\u8BF7\u8F93\u5165\u5BC6\u7801\uFF1A")}else{if(!isObjectEmpty(d)){return firstAdjustTags(d,fieldOpts,$editor,uiField,opts)}else{return normalAdjustTags(d,fieldOpts,$editor,uiField,opts)}}function passwordRight(adasRoads,adasValue){var context=editor.context,slope_src;var newAdasValue=adasValue.newValue;if("0"==newAdasValue){slope_src="0"}else if("1"==newAdasValue){slope_src="1"}else if("2"==newAdasValue){slope_src="2"}else if("3"==newAdasValue){slope_src="3"}else if("4"==newAdasValue){slope_src="4"}else if("5"==newAdasValue){slope_src="5"}else if("6"==newAdasValue){slope_src="6"}else if("7"==newAdasValue){slope_src="7"}else if("8"==newAdasValue){slope_src="1"}var selectedTags={adas:newAdasValue,slope_src:slope_src};var way=opts.entity;if(way){way=way.mergeTags(selectedTags);context.perform(iD.actions.AddEntity(way),"\u66F4\u6539ADAS\u6570\u636E\u6807\u8BC6")}}function passwordWrong(){delete d.adas;return normalAdjustTags(d,fieldOpts,$editor,uiField,opts)}}function firstAdjustTags(d,fieldOpts,$editor,uiField,opts){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD);function uiFieldDisable(fieldName,bool){let readonly=opts.fields[fieldName]&&"1"==opts.fields[fieldName].readOnly;let uiInput=iD.ui.TagEditor.findUiField(opts,fieldName);bool=readonly||bool;if(!currentLayer||!currentLayer.editable){uiInput.disable(true)}else if(readonly&&uiInput.readOnly){uiInput.readOnly(readonly)}else if(uiInput.disable){uiInput.disable(bool)}}var tags=_.extend({},fieldOpts.context.entity(fieldOpts.entity.id).tags,d);if("undefined"!=typeof tags.ROAD_CLASS){if(""==tags.ROAD_CLASS&&""==tags.FC){uiFieldDisable("FC",true)}}if("undefined"!=typeof tags.ROAD_CLASS&&"49"==tags.ROAD_CLASS){uiFieldDisable("FC",true)}else if("undefined"!=typeof tags.ROAD_CLASS&&"49"!=tags.ROAD_CLASS){uiFieldDisable("FC",false)}if("undefined"!=typeof tags.NAME_CHN&&"\u6B65\u884C\u8857"==tags.NAME_CHN){uiFieldDisable("DIRECTION",true)}else if("undefined"!=typeof tags.NAME_CHN&&"\u6B65\u884C\u8857"!=tags.NAME_CHN){uiFieldDisable("DIRECTION",false)}if("undefined"!=typeof tags.NAME_CHN&&"\u6B65\u884C\u8857"==tags.NAME_CHN||"undefined"!=typeof tags.DIRECTION&&"4"==tags.DIRECTION){uiFieldDisable("STATUS",true);uiFieldDisable("FC",true)}else{uiFieldDisable("STATUS",false);uiFieldDisable("FC",false)}if("undefined"!=typeof tags.STATUS&&"2"==tags.STATUS){uiFieldDisable("FC",true)}else{uiFieldDisable("FC",false)}if("undefined"!=typeof tags.LINK_TYPE&&"1"==tags.LINK_TYPE){uiFieldDisable("FORM_WAY",true);uiFieldDisable("DIRECTION",true);uiFieldDisable("STATUS",true)}else if("undefined"!=typeof tags.LINK_TYPE&&"1"!=tags.LINK_TYPE){uiFieldDisable("FORM_WAY",false);uiFieldDisable("DIRECTION",false);uiFieldDisable("STATUS",false)}if("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS||"undefined"!=typeof tags.LINK_TYPE&&"1"==tags.LINK_TYPE||"undefined"!=typeof tags.FORM_WAY&&("3"==tags.FORM_WAY||"4"==tags.FORM_WAY||"5"==tags.FORM_WAY||"7"==tags.FORM_WAY||"8"==tags.FORM_WAY||"11"==tags.FORM_WAY||"12"==tags.FORM_WAY||"13"==tags.FORM_WAY||"14"==tags.FORM_WAY||"16"==tags.FORM_WAY||"53"==tags.FORM_WAY||"56"==tags.FORM_WAY||"58"==tags.FORM_WAY)||"undefined"!=typeof tags.ROAD_CLASS&&("42000"==tags.ROAD_CLASS||"51000"==tags.ROAD_CLASS)){if("undefined"!=typeof tags.OWNER_SHIP&&0!=tags.OWNER_SHIP){}else{uiFieldDisable("OWNER_SHIP",true)}}else{uiFieldDisable("OWNER_SHIP",false)}return d}function normalAdjustTags(d,fieldOpts,$editor,uiField,opts){for(var key in d){if(key!==undefined&&fieldOpts.fields[key]!=undefined){window.primaryKey=key}}var tags=_.extend({},fieldOpts.context.entity(fieldOpts.entity.id).tags,d),errorMsgs=[],warningMsgs=[];function SBC(text){return text.replace(/[\x20-\x7e]/g,function($0){return" "==$0?"\u3000":String.fromCharCode($0.charCodeAt(0)+65248)})}function dbc2sbc(str){return str.replace(/[\uff01-\uff5e]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)}).replace(/\u3000/g," ")}function strInvalid(str){var dst=str.replace(/(^\s*)|(\s*$)/g,"");if("undefined"==dst||""==dst||!dst){return true}return false}function getInvalidRoadname(str){if(0<str.length){if(0<=str.indexOf(" ")){return"\u7A7A\u683C"}var arr=["\u5F15\u8DEF","\u6389\u5934","\u51FA\u53E3","\u5165\u53E3","\u6865","\u7ACB\u4EA4\u6865","\u8F85\u8DEF"];for(var i=0;i<arr.length;i++){if(str==arr[i]){return arr[i]}}}return undefined}function roadNameChanged(name_chn,d,fname_chn,tags){if("undefined"!=typeof name_chn&&-1<d.name_trigger.indexOf("NAME_CHN")){var reg=/#+/;var reg2=/\s+/g;var half=dbc2sbc(name_chn);half=half.replace(reg2,"");if(0<half.length&&reg.test(half)){return"\u5F55\u5165\u975E\u6CD5\u5B57\u7B26\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"}else{var name=SBC(half);if("undefined"!=typeof fname_chn&&0<fname_chn.length&&name==fname_chn){return"\u9053\u8DEF\u540D\u79F0\u66FE\u7528\u540D\u4E00\u81F4\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"}if("undefined"!=typeof tags.DIRECTION&&"4"==tags.DIRECTION){if(""==name){return"\u6B65\u884C\u8857\u4E0D\u5141\u8BB8\u9053\u8DEF\u540D\u79F0\u4E3A\u7A7A"}}if("undefined"!=typeof tags.ROAD_CLASS&&("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS)&&"undefined"!=typeof tags.FORM_WAY&&"1"==tags.FORM_WAY){if(name.indexOf("\u51FA\u53E3")==name.length-2||name.indexOf("\u5165\u53E3")==name.length-2){return"\u522B\u540D\u4E2D\u4E0D\u80FD\u51FA\u73B0\u672B\u5C3E\u5173\u952E\u5B57\u662F\u51FA\u53E3\u6216\u5165\u53E3"}}name=getInvalidRoadname(name);if(name){return"\u9053\u8DEF\u540D\u79F0\u4E0D\u80FD\u4E3A"+name+",\u8BF7\u91CD\u65B0\u8F93\u5165"}else{return"ok"}}}return"null"}function fnameChanged(fname_chn,tags){if("undefined"!=typeof fname_chn){var reg=/#+/;var reg2=/\s+/g;var half=dbc2sbc(fname_chn);half=half.replace(reg2,"");if(0<half.length&&reg.test(half)){return"\u5F55\u5165\u975E\u6CD5\u5B57\u7B26\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"}else{var name=SBC(half);if("undefined"!=typeof tags.NAME_CHN&&0<tags.NAME_CHN.length&&name==tags.NAME_CHN){return"\u9053\u8DEF\u540D\u79F0\u66FE\u7528\u540D\u4E00\u81F4\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"}name=getInvalidRoadname(half);if(name){return"\u66FE\u7528\u540D\u4E0D\u80FD\u4E3A"+name+",\u8BF7\u91CD\u65B0\u8F93\u5165"}else{return"ok"}}}return"null"}function aliasChanged(alias_chn,index,d,fname_chn,tags){var alias="alias_chn"+index;if("undefined"!=typeof alias_chn&&-1<d.name_trigger.indexOf(alias)){var reg=/#+/;var reg2=/\s+/g;var half=dbc2sbc(alias_chn);half=half.replace(reg2,"");if(reg.test(half)){return"\u5F55\u5165\u975E\u6CD5\u5B57\u7B26\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"}else{var name=SBC(half);if("undefined"!=typeof d.NAME_CHN&&0<d.NAME_CHN.length&&name==d.NAME_CHN){return"\u9053\u8DEF\u540D\u79F0\u522B\u540D\u4E00\u81F4\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"}if("undefined"!=typeof fname_chn&&0<fname_chn.length&&name==fname_chn){return"\u522B\u540D\u4E0E\u66FE\u7528\u540D\u4E00\u81F4\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"}if(1==index&&"undefined"!=typeof d.ALIAS_CHN){if(32<d.ALIAS_CHN.length){return"\u522B\u540D\u603B\u957F\u8D85\u8FC732\u4E2A\u5B57\u7B26"}}if("undefined"!=typeof tags.ROAD_CLASS&&("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS)&&"undefined"!=typeof tags.FORM_WAY&&"1"==tags.FORM_WAY){if(name.indexOf("\u51FA\u53E3")==name.length-2||name.indexOf("\u5165\u53E3")==name.length-2){return"\u522B\u540D\u4E2D\u4E0D\u80FD\u51FA\u73B0\u672B\u5C3E\u5173\u952E\u5B57\u662F\u51FA\u53E3\u6216\u5165\u53E3"}}name=getInvalidRoadname(half);if(name){return"\u522B\u540D\u4E0D\u80FD\u4E3A"+name+",\u8BF7\u91CD\u65B0\u8F93\u5165"}else{return"ok"}}}return"null"}if("undefined"!=typeof d.name_trigger){var reval=roadNameChanged(d.NAME_CHN,d,tags.fname_chn,tags);if("ok"==reval){d.NAME_CHN=SBC(d.NAME_CHN.replace(/\s+/g,""))}else if("null"!=reval){errorMsgs.push(reval);delete d.NAME_CHN}delete d.name_trigger}reval=fnameChanged(d.fname_chn,tags);if("ok"==reval){d.fname_chn=SBC(d.fname_chn.replace(/\s+/g,""))}else if("null"!=reval){errorMsgs.push(reval);delete d.fname_chn}if("undefined"!=typeof d.ROAD_CLASS){var obj={41000:["1","4"],42000:["2","4"],43000:["2","4"],44000:["4","1"],45000:["5","1"],47000:["6","0"],51000:["3","2"],52000:["5","1"],53000:["5","1"],54000:["6","0"],49:["6","0"],100:["6","0"]};if(tags.ROAD_CLASS==d.ROAD_CLASS&&""==tags.FC){d.FC=obj[tags["ROAD_CLASS"]][0];d.lc_1=obj[tags["ROAD_CLASS"]][1];d.lc_2=d.lc_1}if("41000"==d.ROAD_CLASS||"43000"==d.ROAD_CLASS){d.paver="2"}}if("undefined"!=typeof d.ROAD_CLASS&&"49"==d.ROAD_CLASS){d.ave_lanes="1";d.lc_1="0";d.lc_2="0";d.FC="6"}if("49"==tags.ROAD_CLASS&&"undefined"!=typeof d.FC&&"6"!=d.FC){errorMsgs.push("\u9053\u8DEF\u7B49\u7EA7\u548C\u529F\u80FD\u7B49\u7EA7\u5173\u8054\uFF0C\u5F53\u9053\u8DEF\u7B49\u7EA7\u4E3A\u5C0F\u8DEF\u65F6\uFF0C\u529F\u80FD\u7B49\u7EA7\u4E3A6\uFF01");delete d.FC}if("undefined"!=typeof d.FORM_WAY){if("1"==d.FORM_WAY||"3"==d.FORM_WAY||"4"==d.FORM_WAY||"8"==d.FORM_WAY||"9"==d.FORM_WAY||"10"==d.FORM_WAY||"11"==d.FORM_WAY||"12"==d.FORM_WAY||"13"==d.FORM_WAY||"14"==d.FORM_WAY){if(2!=tags.DIRECTION&&3!=tags.DIRECTION){errorMsgs.push("\u9053\u8DEF\u6784\u6210\u4E0E\u884C\u9A76\u65B9\u5411\u5173\u8054\uFF0C\u884C\u9A76\u65B9\u5411\u5FC5\u987B\u4E3A\u6B63\u5411\u901A\u884C\u6216\u8005\u9006\u5411\u901A\u884C\uFF01");delete d.FORM_WAY}}else if("17"==d.FORM_WAY){d.ROAD_CLASS="47000";d.lc_1="0";d.lc_2="0";d.FC="6";if(""==tags.WIDTH||"-1"==tags.WIDTH){d.WIDTH="3.0"}}else if("59"==d.FORM_WAY){d.ROAD_CLASS="47000";d.OWNER_SHIP="1";d.fow="3";if(""==tags.FC){d.lc_1="0";d.lc_2="0";d.FC="6"}if(""==tags.WIDTH||"-1"==tags.WIDTH){d.WIDTH="3.0"}}}if("1"==tags.FORM_WAY||"3"==tags.FORM_WAY||"4"==tags.FORM_WAY||"8"==tags.FORM_WAY||"9"==tags.FORM_WAY||"10"==tags.FORM_WAY||"11"==tags.FORM_WAY||"12"==tags.FORM_WAY||"13"==tags.FORM_WAY||"14"==tags.FORM_WAY){if("undefined"!=typeof d.DIRECTION&&2!=d.DIRECTION&&3!=d.DIRECTION){errorMsgs.push("\u9053\u8DEF\u6784\u6210\u4E0E\u884C\u9A76\u65B9\u5411\u5173\u8054\uFF0C\u884C\u9A76\u65B9\u5411\u5FC5\u987B\u4E3A\u6B63\u5411\u901A\u884C\u6216\u8005\u9006\u5411\u901A\u884C\uFF01");delete d.DIRECTION}}if("undefined"!=typeof d.DIRECTION&&"4"==d.DIRECTION&&("undefined"==typeof tags.NAME_CHN||""==tags.NAME_CHN||false==tags.NAME_CHN)){errorMsgs.push("\u884C\u9A76\u65B9\u5411\u4E0E\u9053\u8DEF\u540D\u79F0\u5173\u8054\uFF0C\u884C\u9A76\u65B9\u5411\u4E3A\u53CC\u5411\u7981\u884C\u65F6\u9053\u8DEF\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01");delete d.DIRECTION}if("undefined"!=typeof d.NAME_CHN&&"\u6B65\u884C\u8857"==d.NAME_CHN){d.DIRECTION="4"}if("undefined"!=typeof tags.NAME_CHN&&"\u6B65\u884C\u8857"==tags.NAME_CHN||"undefined"!=typeof tags.DIRECTION&&"4"==tags.DIRECTION){if("undefined"!=typeof d.FC&&"6"!=d.FC){errorMsgs.push("\u9053\u8DEF\u7B49\u7EA7\u88AB\u5F3A\u5173\u8054\uFF0C\u4E0D\u80FD\u4FEE\u6539\uFF01");delete d.FC}if("undefined"!=typeof d.STATUS&&"0"!=d.STATUS){errorMsgs.push("\u9053\u8DEF\u72B6\u6001\u88AB\u5F3A\u5173\u8054\uFF0C\u4E0D\u80FD\u4FEE\u6539\uFF01");delete d.STATUS}}if("undefined"!=typeof d.NAME_CHN&&"\u6B65\u884C\u8857"==d.NAME_CHN||"undefined"!=typeof d.DIRECTION&&"4"==d.DIRECTION){d.STATUS="0";d.ave_lanes="1";d.lane_wide="3";d.WIDTH="3";d.fow="14";d.FC="6";d.lc_1="0";d.lc_2="0"}if("undefined"!=typeof d.STATUS&&"2"==d.STATUS&&"4"==tags.DIRECTION){errorMsgs.push("\u9053\u8DEF\u72B6\u6001\u4E0E\u884C\u9A76\u65B9\u5411\u5173\u8054\uFF0C\u9053\u8DEF\u72B6\u6001\u4E3A\u7981\u6B62\u901A\u884C\u65F6\u884C\u9A76\u65B9\u5411\u4E0D\u80FD\u4E3A\u53CC\u5411\u7981\u884C\uFF01");delete d.STATUS}if("undefined"!=typeof d.DIRECTION&&"4"==d.DIRECTION&&"2"==tags.STATUS){errorMsgs.push("\u9053\u8DEF\u72B6\u6001\u4E0E\u884C\u9A76\u65B9\u5411\u5173\u8054\uFF0C\u9053\u8DEF\u72B6\u6001\u4E3A\u7981\u6B62\u901A\u884C\u65F6\u884C\u9A76\u65B9\u5411\u4E0D\u80FD\u4E3A\u53CC\u5411\u7981\u884C\uFF01");delete d.DIRECTION}if("undefined"!=typeof d.DIRECTION&&"4"!=d.DIRECTION){d.fow="3"}if("undefined"!=typeof d.STATUS&&"2"==d.STATUS){d.FC="6";d.lc_1="0";d.lc_2="0"}if("undefined"!=typeof tags.STATUS&&"2"==tags.STATUS){if("undefined"!=typeof d.FC&&"6"!=d.FC){errorMsgs.push("\u9053\u8DEF\u72B6\u6001\u4E0E\u529F\u80FD\u7B49\u7EA7\u5173\u8054\uFF0C\u9053\u8DEF\u72B6\u6001\u4E3A\u7981\u6B62\u901A\u884C\u65F6\uFF0C\u529F\u80FD\u7B49\u7EA7\u4E3A6\uFF01");delete d.FC}}if("undefined"!=typeof tags.NAME_CHN&&"undefined"!=typeof tags.ALIAS_CHN){if(("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS)&&"1"==tags.FORM_WAY&&"undefined"!=typeof d.NAME_CHN){if(d.NAME_CHN.lastIndexOf("\u51FA\u53E3")==d.NAME_CHN.length-2||d.NAME_CHN.lastIndexOf("\u5165\u53E3")==d.NAME_CHN.length-2){errorMsgs.push("\u9AD8\u901F\u9053\u8DEF\u4E3B\u7EBF,\u540D\u79F0\u4E2D\u4E0D\u80FD\u51FA\u73B0\u672B\u5C3E\u5173\u952E\u5B57\u662F\u201C\u51FA\u53E3\u201D\u6216\u201C\u5165\u53E3\u201D!");delete d.NAME_CHN}}if(("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS)&&"1"==tags.FORM_WAY&&"undefined"!=typeof d.ALIAS_CHN){if(d.ALIAS_CHN.lastIndexOf("\u51FA\u53E3")==d.ALIAS_CHN.length-2||d.ALIAS_CHN.lastIndexOf("\u5165\u53E3")==d.ALIAS_CHN.length-2){errorMsgs.push("\u9AD8\u901F\u9053\u8DEF\u4E3B\u7EBF,\u522B\u540D\u4E2D\u4E0D\u80FD\u51FA\u73B0\u672B\u5C3E\u5173\u952E\u5B57\u662F\u201C\u51FA\u53E3\u201D\u6216\u201C\u5165\u53E3\u201D!");delete d.ALIAS_CHN}}if(("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS)&&"1"==tags.FORM_WAY){}if(("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS)&&"1"==tags.FORM_WAY){}if(("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS)&&"1"==tags.FORM_WAY){}if("undefined"!=typeof tags.NAME_CHN&&(tags.NAME_CHN.lastIndexOf("\u5165\u53E3")==tags.NAME_CHN.length-2||tags.NAME_CHN.lastIndexOf("\u51FA\u53E3")==tags.NAME_CHN.length-2)&&"1"==tags.FORM_WAY){if("undefined"!=typeof d.ROAD_CLASS&&("41000"==d.ROAD_CLASS||"43000"==d.ROAD_CLASS)){errorMsgs.push("\u9AD8\u901F\u9053\u8DEF\u4E3B\u7EBF,\u540D\u79F0\u6216\u522B\u540D\u4E2D\u4E0D\u80FD\u51FA\u73B0\u672B\u5C3E\u5173\u952E\u5B57\u662F\u201C\u51FA\u53E3\u201D\u6216\u201C\u5165\u53E3\u201D");delete d.ROAD_CLASS}}if("undefined"!=typeof tags.NAME_CHN&&(tags.NAME_CHN.lastIndexOf("\u5165\u53E3")==tags.NAME_CHN.length-2||tags.NAME_CHN.lastIndexOf("\u51FA\u53E3")==tags.NAME_CHN.length-2)&&("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS)){if("undefined"!=d.FORM_WAY&&"1"==d.FORM_WAY){errorMsgs.push("\u9AD8\u901F\u9053\u8DEF\u4E3B\u7EBF,\u540D\u79F0\u6216\u522B\u540D\u4E2D\u4E0D\u80FD\u51FA\u73B0\u672B\u5C3E\u5173\u952E\u5B57\u662F\u201C\u51FA\u53E3\u201D\u6216\u201C\u5165\u53E3\u201D");delete d.FORM_WAY}}if("undefined"!=typeof tags.ALIAS_CHN&&(tags.ALIAS_CHN.lastIndexOf("\u5165\u53E3")==tags.ALIAS_CHN.length-2||tags.NAME_CHN.lastIndexOf("\u51FA\u53E3")==tags.NAME_CHN.length-2)&&"1"==tags.FORM_WAY){if("undefined"!=typeof d.ROAD_CLASS&&("41000"==d.ROAD_CLASS||"43000"==d.ROAD_CLASS)){errorMsgs.push("\u9AD8\u901F\u9053\u8DEF\u4E3B\u7EBF,\u540D\u79F0\u6216\u522B\u540D\u4E2D\u4E0D\u80FD\u51FA\u73B0\u672B\u5C3E\u5173\u952E\u5B57\u662F\u201C\u51FA\u53E3\u201D\u6216\u201C\u5165\u53E3\u201D");delete d.ROAD_CLASS}}if("undefined"!=typeof tags.ALIAS_CHN&&(tags.ALIAS_CHN.lastIndexOf("\u5165\u53E3")==tags.ALIAS_CHN.length-2||tags.NAME_CHN.lastIndexOf("\u51FA\u53E3")==tags.NAME_CHN.length-2)&&("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS)){if("undefined"!=d.FORM_WAY&&"1"==d.FORM_WAY){errorMsgs.push("\u9AD8\u901F\u9053\u8DEF\u4E3B\u7EBF,\u540D\u79F0\u6216\u522B\u540D\u4E2D\u4E0D\u80FD\u51FA\u73B0\u672B\u5C3E\u5173\u952E\u5B57\u662F\u201C\u51FA\u53E3\u201D\u6216\u201C\u5165\u53E3\u201D");delete d.FORM_WAY}}}if("41000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS){if("undefined"!=typeof d.FORM_WAY&&"6"==d.FORM_WAY){errorMsgs.push("\u9AD8\u901F\u9053\u8DEF\u7684\u9053\u8DEF\u6784\u6210\u4E0D\u80FD\u4E3A\u5F15\u8DEF\uFF01");delete d.FORM_WAY}}if("6"==tags.FORM_WAY){if("undefined"!=typeof d.ROAD_CLASS&&("41000"==d.ROAD_CLASS||"43000"==d.ROAD_CLASS)){errorMsgs.push("\u9AD8\u901F\u9053\u8DEF\u7684\u9053\u8DEF\u6784\u6210\u4E0D\u80FD\u4E3A\u5F15\u8DEF\uFF01");delete d.ROAD_CLASS}}if("41000"==tags.ROAD_CLASS&&("undefined"==typeof tags.TOLL_FLAG||""==tags.TOLL_FLAG)){d.TOLL_FLAG="1"}if("undefined"!=typeof d.ROAD_CLASS){if("41000"==d.ROAD_CLASS||"43000"==d.ROAD_CLASS){d.lane_wide="3.5";if("undefined"!=typeof tags.ave_lanes&&0<tags.ave_lanes){}}else{d.lane_wide="3";if("undefined"!=typeof tags.ave_lanes&&0<tags.ave_lanes){}}}if("undefined"!=typeof tags.NAME_CHN&&""!=tags.NAME_CHN&&"\u670D\u52A1\u533A"==tags.NAME_CHN.substring(tags.NAME_CHN.length-3,tags.NAME_CHN.length)&&"41000"==tags.ROAD_CLASS&&"undefined"!=typeof d.FORM_WAY){if("5"!=d.FORM_WAY&&"56"!=d.FORM_WAY&&"53"!=d.FORM_WAY&&"58"!=d.FORM_WAY){errorMsgs.push("\u9053\u8DEF\u7B49\u7EA7\u4E3A\u9AD8\u901F\u516C\u8DEF\uFF0C\u4E14\u9053\u8DEF\u540D\u79F0\u540E3\u4E2A\u5B57\u4E3A\u201C\u670D\u52A1\u533A\u201D\u65F6\uFF0C\u9053\u8DEF\u6784\u6210\u987B\u5305\u542B\u201C\u670D\u52A1\u533A\u201D\uFF01");delete d.FORM_WAY}}if("undefined"!=typeof d.ROAD_CLASS&&"41000"==d.ROAD_CLASS){if("5"!=tags.FORM_WAY&&"56"!=tags.FORM_WAY&&"53"!=tags.FORM_WAY&&"58"!=tags.FORM_WAY&&"undefined"!=typeof tags.NAME_CHN&&""!=tags.NAME_CHN&&"\u670D\u52A1\u533A"==tags.NAME_CHN.substring(tags.NAME_CHN.length-3,tags.NAME_CHN.length)){errorMsgs.push("\u9053\u8DEF\u7B49\u7EA7\u4E3A\u9AD8\u901F\u516C\u8DEF\uFF0C\u4E14\u9053\u8DEF\u540D\u79F0\u540E3\u4E2A\u5B57\u4E3A\u201C\u670D\u52A1\u533A\u201D\u65F6\uFF0C\u9053\u8DEF\u6784\u6210\u987B\u5305\u542B\u201C\u670D\u52A1\u533A\u201D\uFF01");delete d.ROAD_CLASS}}if("undefined"!=typeof d.NAME_CHN&&""!=d.NAME_CHN&&"\u670D\u52A1\u533A"==d.NAME_CHN.substring(d.NAME_CHN.length-3,d.NAME_CHN.length)){if("5"!=tags.FORM_WAY&&"56"!=tags.FORM_WAY&&"53"!=tags.FORM_WAY&&"58"!=tags.FORM_WAY&&"41000"==tags.ROAD_CLASS){errorMsgs.push("\u9053\u8DEF\u7B49\u7EA7\u4E3A\u9AD8\u901F\u516C\u8DEF\uFF0C\u4E14\u9053\u8DEF\u540D\u79F0\u540E3\u4E2A\u5B57\u4E3A\u201C\u670D\u52A1\u533A\u201D\u65F6\uFF0C\u9053\u8DEF\u6784\u6210\u987B\u5305\u542B\u201C\u670D\u52A1\u533A\u201D\uFF01");delete d.NAME_CHN}}if("undefined"!=typeof d.FORM_WAY&&("3"==d.FORM_WAY||"8"==d.FORM_WAY||"53"==d.FORM_WAY||"58"==d.FORM_WAY)){if("41000"!=tags.ROAD_CLASS&&"43000"!=tags.ROAD_CLASS){errorMsgs.push("\u9053\u8DEF\u6784\u6210\u4E0E\u9053\u8DEF\u7B49\u7EA7\u5173\u8054\uFF0C \u9053\u8DEF\u6784\u6210\u542BJCT\u65F6\u9053\u8DEF\u7B49\u7EA7\u9700\u4E3A\u9AD8\u901F\u9053\u8DEF/\u57CE\u5E02\u5FEB\u901F\u8DEF!");delete d.FORM_WAY}}if("undefined"!=typeof d.ROAD_CLASS&&"41000"!=d.ROAD_CLASS&&"43000"!=d.ROAD_CLASS){if("3"==tags.FORM_WAY||"8"==tags.FORM_WAY||"53"==tags.FORM_WAY||"58"==tags.FORM_WAY){errorMsgs.push("\u9053\u8DEF\u6784\u6210\u4E0E\u9053\u8DEF\u7B49\u7EA7\u5173\u8054\uFF0C \u9053\u8DEF\u6784\u6210\u542BJCT\u65F6\u9053\u8DEF\u7B49\u7EA7\u9700\u4E3A\u9AD8\u901F\u9053\u8DEF/\u57CE\u5E02\u5FEB\u901F\u8DEF!");delete d.ROAD_CLASS}}if("undefined"!=typeof d.FORM_WAY&&"1"==d.FORM_WAY){if("2"!=tags.DIRECTION&&"3"!=tags.DIRECTION){errorMsgs.push("\u884C\u9A76\u65B9\u5411\u5FC5\u987B\u4E3A\u6B63\u5411\u901A\u884C\u6216\u8005\u9006\u5411\u901A\u884C\uFF01");delete d.FORM_WAY}}if("1"==tags.FORM_WAY){if("undefined"!=typeof d.DIRECTION&&"2"!=d.DIRECTION&&"3"!=d.DIRECTION){errorMsgs.push("\u884C\u9A76\u65B9\u5411\u5FC5\u987B\u4E3A\u6B63\u5411\u901A\u884C\u6216\u8005\u9006\u5411\u901A\u884C\uFF01");delete d.DIRECTION}}if("undefined"!=typeof tags.LINK_TYPE&&"1"==tags.LINK_TYPE){d.ave_lanes="1";d.lane_wide="3";d.WIDTH="3";d.FORM_WAY="15";d.DIRECTION="1";d.STATUS="0";d.fow="-1"}if("1"==tags.LINK_TYPE){if("undefined"!=typeof d.FORM_WAY&&"15"!=d.FORM_WAY){errorMsgs.push("\u9053\u8DEF\u7C7B\u578B\u4E0E\u9053\u8DEF\u7B49\u7EA7\u5173\u8054\uFF0C\u9053\u8DEF\u7C7B\u578B\u4E3A\u8F6E\u6E21\u822A\u7EBF\u65F6\uFF0C\u9053\u8DEF\u6784\u6210\u5FC5\u987B\u4E3A\u666E\u901A\u9053\u8DEF\uFF01");delete d.FORM_WAY}if("undefined"!=typeof d.DIRECTION&&"1"!=d.DIRECTION){errorMsgs.push("\u9053\u8DEF\u7C7B\u578B\u4E0E\u9053\u8DEF\u7B49\u7EA7\u5173\u8054\uFF0C\u9053\u8DEF\u7C7B\u578B\u4E3A\u8F6E\u6E21\u822A\u7EBF\u65F6\uFF0C\u9053\u8DEF\u6784\u6210\u5FC5\u987B\u4E3A\u53CC\u5411\u901A\u884C\uFF01");delete d.DIRECTION}if("undefined"!=typeof d.STATUS&&"0"!=d.STATUS){errorMsgs.push("\u9053\u8DEF\u7C7B\u578B\u4E0E\u9053\u8DEF\u7B49\u7EA7\u5173\u8054\uFF0C\u9053\u8DEF\u7C7B\u578B\u4E3A\u8F6E\u6E21\u822A\u7EBF\u65F6\uFF0C\u9053\u8DEF\u72B6\u6001\u4E3A\u6B63\u5E38\u901A\u884C\uFF01");delete d.STATUS}}if("undefined"!=typeof d.FORM_WAY&&"4"==d.FORM_WAY){if("49"==tags.ROAD_CLASS){errorMsgs.push("\u9053\u8DEF\u7B49\u7EA7\u4E0D\u80FD\u4E3A49\uFF01");delete d.FORM_WAY}}if("undefined"!=typeof tags.FORM_WAY&&"4"==tags.FORM_WAY){if("49"==d.ROAD_CLASS){errorMsgs.push("\u9053\u8DEF\u7B49\u7EA7\u4E0D\u80FD\u4E3A49\uFF01");delete d.ROAD_CLASS}}if("3"==tags.FORM_WAY||"8"==tags.FORM_WAY||"53"==tags.FORM_WAY||"58"==tags.FORM_WAY){if("undefined"!=typeof d.DIRECTION&&"1"==d.DIRECTION){errorMsgs.push("\u9053\u8DEF\u6784\u6210\u4E0EJCT\u76F8\u5173\u65F6\uFF0C\u9053\u8DEF\u65B9\u5411\u4E0D\u80FD\u4E3A\u53CC\u5411\u901A\u884C!");delete d.DIRECTION}}if("undefined"!=typeof d.FORM_WAY&&("3"==d.FORM_WAY||"8"==d.FORM_WAY||"53"==d.FORM_WAY||"58"==d.FORM_WAY)){if("1"==tags.DIRECTION){errorMsgs.push("\u9053\u8DEF\u6784\u6210\u4E0EJCT\u76F8\u5173\u65F6\uFF0C\u9053\u8DEF\u65B9\u5411\u4E0D\u80FD\u4E3A\u53CC\u5411\u901A\u884C!");delete d.FORM_WAY}}if("1"==tags.OWNER_SHIP){if("undefined"!=typeof d.ROAD_CLASS&&("41000"==d.ROAD_CLASS||"42000"==d.ROAD_CLASS||"43000"==d.ROAD_CLASS||"44000"==d.ROAD_CLASS)){errorMsgs.push("\u9053\u8DEF\u6240\u6709\u4E3A\u5185\u90E8\u9053\u8DEF\u65F6,\u9053\u8DEF\u7B49\u7EA7\u4E0D\u80FD\u9AD8\u4E8E\u57CE\u5E02\u6B21\u5E72\u8DEF\u537345000\uFF01");delete d.ROAD_CLASS}}if("undefined"!=typeof d.OWNER_SHIP){if("1"==d.OWNER_SHIP){if("41000"==tags.ROAD_CLASS||"42000"==tags.ROAD_CLASS||"43000"==tags.ROAD_CLASS||"44000"==tags.ROAD_CLASS){errorMsgs.push("\u9053\u8DEF\u6240\u6709\u4E3A\u5185\u90E8\u9053\u8DEF\u65F6,\u9053\u8DEF\u7B49\u7EA7\u4E0D\u80FD\u9AD8\u4E8E\u57CE\u5E02\u6B21\u5E72\u8DEF\u537345000\uFF01");delete d.OWNER_SHIP}}else if("3"==d.OWNER_SHIP||"4"==d.OWNER_SHIP){d.fow="7";d.navitype="2"}}if("41000"==d.ROAD_CLASS||"43000"==d.ROAD_CLASS||"undefined"!=typeof d.LINK_TYPE&&"1"==d.LINK_TYPE||"undefined"!=typeof d.FORM_WAY&&("3"==d.FORM_WAY||"4"==d.FORM_WAY||"5"==d.FORM_WAY||"7"==d.FORM_WAY||"8"==d.FORM_WAY||"11"==d.FORM_WAY||"12"==d.FORM_WAY||"13"==d.FORM_WAY||"14"==d.FORM_WAY||"16"==d.FORM_WAY||"53"==d.FORM_WAY||"56"==d.FORM_WAY||"58"==d.FORM_WAY)||"undefined"!=typeof d.ROAD_CLASS&&("42000"==d.ROAD_CLASS||"51000"==d.ROAD_CLASS)){if("undefined"!=typeof d.OWNER_SHIP&&0!=d.OWNER_SHIP){errorMsgs.push("\u9053\u8DEF\u6240\u6709\u5DF2\u88AB\u5F3A\u5173\u8054\uFF0C\u4E0D\u80FD\u4FEE\u6539");delete d.OWNER_SHIP}else{d.OWNER_SHIP="0"}}if("undefined"!=typeof d.NAME_CHN&&""==d.NAME_CHN){if("undefined"!=typeof tags.ALIAS_CHN&&""!=tags.ALIAS_CHN){errorMsgs.push("\u9053\u8DEF\u522B\u540D\u4E0D\u4E3A\u7A7A\u65F6,\u4E2D\u6587\u540D\u79F0\u4E00\u5B9A\u4E0D\u4E3A\u7A7A\uFF01");delete d.NAME_CHN}}if(opts.multiRoadTagFlag){opts.isMultiRoadTag++;if(1<opts.isMultiRoadTag){return d}}if(0<errorMsgs.length){$editor.call(iD.ui.TagEditor.toastr,errorMsgs.join("<br/>"),{className:"error"})}if(0<warningMsgs.length){$editor.call(iD.ui.TagEditor.toastr,warningMsgs.join("<br/>"),{className:"warning"})}return firstAdjustTags(d,fieldOpts,$editor,uiField,opts)}return{title:"\u9053\u8DEF\u5C5E\u6027\u7F16\u8F91",onValidate:adjustTags,onInitValidate:true,fieldsGroup:[{title:"\u540D\u79F0",fields:[{fieldName:"NAME_CHN",fieldRender:"inputGroup",fieldLabel:"\u4E2D\u6587\u540D\u79F0",fieldOptions:[{name:"ALIAS_CHN",title:"\u9053\u8DEF\u522B\u540D"}]}]}]}};;;iD.ui.TagEditorTpl.RoadNode=function(){return{title:"\u8DEF\u53E3\u5C5E\u6027\u7F16\u8F91",fieldsGroup:[{title:"\u57FA\u672C\u4FE1\u606F",fields:[{fieldName:"NAME_CHN"},{fieldName:"TOLLGATE",fieldRender:"check"}]}],onValidate:function(d,fieldOpts,$editor,uiField,opts){return d}}};;;iD.ui.TagEditorTpl.RoadCross=function(){return{title:"\u7EFC\u5408\u4EA4\u53C9\u70B9\u5C5E\u6027\u7F16\u8F91",fieldsGroup:[{title:"\u57FA\u672C\u4FE1\u606F",fields:[{fieldName:"name_chn"},{fieldName:"spell"}]}],onValidate:function(d,fieldOpts,$editor,uiField,opts){return d}}};;;iD.ui.TagEditorTpl.Poi=function(){return{title:"poi\u5C5E\u6027\u7F16\u8F91",fieldsGroup:[{title:"\u57FA\u672C\u4FE1\u606F",fields:[{fieldName:"DIRECTION",fieldRender:"select"}]}],onValidate:function(d,fieldOpts,$editor,uiField,opts){return d}}};;;iD.ui.TagEditorTpl.DividerAttribute=function(){function isObjectEmpty(obj){if("object"===typeof obj&&!(obj instanceof Array)){var hasProp=false;for(var prop in obj){hasProp=true;break}return hasProp}return false}function adjustTags(d,fieldOpts,$editor,uiField,opts){if(!isObjectEmpty(d)){return firstAdjustTags(d,fieldOpts,$editor,uiField,opts)}else{return normalAdjustTags(d,fieldOpts,$editor,uiField,opts)}}function firstAdjustTags(d,fieldOpts,$editor,uiField,opts){function isUpdateTag(fieldName,value){return d[fieldName]==value&&opts.tags[fieldName]!=value}var tags=_.extend({},fieldOpts.context.entity(fieldOpts.entity.id).tags,d);if(d.VIRTUAL!=undefined){var uiInput=iD.ui.TagEditor.findUiField(opts,"TYPE");uiInput&&uiInput.refreshOption&&uiInput.refreshOption(d)}if("0"==d.VIRTUAL&&null==d.TYPE){d.TYPE=tags.TYPE}if(isUpdateTag("VIRTUAL","1")||isUpdateTag("VIRTUAL","2")||isUpdateTag("VIRTUAL","3")){d.COLOR="0";d.TYPE="0";d.DRIVE_RULE="0";d.MATERIAL="0";d.WIDTH="0"}if(null!=d.TYPE&&"0"==tags.VIRTUAL){if("2"==d.TYPE||"3"==d.TYPE){d.COLOR="1";d.MATERIAL="1";d.WIDTH="1";if("2"==d.TYPE){d.DRIVE_RULE="2"}else if("3"==d.TYPE){d.DRIVE_RULE="1"}}else if("9"==d.TYPE||"10"==d.TYPE){d.COLOR="2";d.MATERIAL="1";d.WIDTH="1";if("9"==d.TYPE){d.DRIVE_RULE="2"}else if("10"==d.TYPE){d.DRIVE_RULE="1"}}else if("1"==d.TYPE){d.COLOR="1";d.MATERIAL="1";d.WIDTH="2";d.DRIVE_RULE="1"}else if("4"==d.TYPE){d.COLOR="3";d.MATERIAL="1";d.WIDTH="3"}else if("5"==d.TYPE){d.COLOR="1";d.MATERIAL="1";d.WIDTH="4";d.DRIVE_RULE="2"}else if("6"==d.TYPE){d.COLOR="1";d.MATERIAL="1";d.WIDTH="1";d.DRIVE_RULE="2"}else if("7"==d.TYPE){d.COLOR="1";d.MATERIAL="1";d.WIDTH="5"}else if("11"==d.TYPE){d.COLOR="1";d.MATERIAL="1";d.WIDTH="6"}else if("8"==d.TYPE){d.COLOR="2";d.MATERIAL="1";d.WIDTH="4";d.DRIVE_RULE="2"}else if("12"==d.TYPE||"13"==d.TYPE){d.COLOR="2";d.MATERIAL="1";d.WIDTH="7";if("12"==d.TYPE){d.DRIVE_RULE="2"}else if("13"==d.TYPE){d.DRIVE_RULE="1"}}else if("14"==d.TYPE||"15"==d.TYPE||"16"==d.TYPE||"17"==d.TYPE){d.MATERIAL="1";d.WIDTH="7";if("14"==d.TYPE||"16"==d.TYPE){d.COLOR="1"}else if("15"==d.TYPE||"17"==d.TYPE){d.COLOR="2"}if("14"==d.TYPE||"15"==d.TYPE){d.DRIVE_RULE="3"}else if("16"==d.TYPE||"17"==d.TYPE){d.DRIVE_RULE="4"}}else if("18"==d.TYPE){d.MATERIAL="1";d.WIDTH="3"}}for(var fieldName in d){if(!d.hasOwnProperty(fieldName)||fieldName==uiField.key)continue;var uiInput=iD.ui.TagEditor.findUiField(opts,fieldName);uiInput&&uiInput.tags&&uiInput.tags(d)}return d}function normalAdjustTags(d,fieldOpts,$editor,uiField,opts){var tags=_.extend({},fieldOpts.context.entity(fieldOpts.entity.id).tags,d),errorMsgs=[],warningMsgs=[];function SBC(text){return text.replace(/[\x20-\x7e]/g,function($0){return" "==$0?"\u3000":String.fromCharCode($0.charCodeAt(0)+65248)})}function dbc2sbc(str){return str.replace(/[\uff01-\uff5e]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)}).replace(/\u3000/g," ")}function strInvalid(str){var dst=str.replace(/(^\s*)|(\s*$)/g,"");if("undefined"==dst||""==dst||!dst){return true}return false}function getInvalidRoadname(str){if(0<str.length){if(0<=str.indexOf(" ")){return"\u7A7A\u683C"}var arr=["\u5F15\u8DEF","\u6389\u5934","\u51FA\u53E3","\u5165\u53E3","\u6865","\u7ACB\u4EA4\u6865","\u8F85\u8DEF"];for(var i=0;i<arr.length;i++){if(str==arr[i]){return arr[i]}}}return undefined}if(opts.multiRoadTagFlag){opts.isMultiRoadTag++;if(1<opts.isMultiRoadTag){return d}}if(0<errorMsgs.length){$editor.call(iD.ui.TagEditor.toastr,errorMsgs.join("<br/>"),{className:"error"})}if(0<warningMsgs.length){$editor.call(iD.ui.TagEditor.toastr,warningMsgs.join("<br/>"),{className:"warning"})}return firstAdjustTags(d,fieldOpts,$editor,uiField,opts)}return{title:"\u8F66\u9053\u5206\u9694\u7EBF\u5C5E\u6027\u53D8\u5316\u70B9",onValidate:adjustTags,onInitValidate:false,fieldsGroup:[{title:"\u57FA\u672C\u4FE1\u606F",fields:[{fieldName:"VIRTUAL",fieldRender:"select",fieldLabel:"\u865A\u62DF\u5206\u9694\u7EBF\u7C7B\u578B"}]}]}};;;iD.ui.TagEditorTpl.LaneAttribute=function(){function isObjectEmpty(obj){if("object"===typeof obj&&!(obj instanceof Array)){var hasProp=false;for(var prop in obj){hasProp=true;break}return hasProp}return false}function adjustTags(d,fieldOpts,$editor,uiField,opts){if(!isObjectEmpty(d)){return firstAdjustTags(d,fieldOpts,$editor,uiField,opts)}else{return normalAdjustTags(d,fieldOpts,$editor,uiField,opts)}}function firstAdjustTags(d,fieldOpts,$editor,uiField,opts){return d}function normalAdjustTags(d,fieldOpts,$editor,uiField,opts){var tags=_.extend({},fieldOpts.context.entity(fieldOpts.entity.id).tags,d),errorMsgs=[],warningMsgs=[];function SBC(text){return text.replace(/[\x20-\x7e]/g,function($0){return" "==$0?"\u3000":String.fromCharCode($0.charCodeAt(0)+65248)})}function dbc2sbc(str){return str.replace(/[\uff01-\uff5e]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)}).replace(/\u3000/g," ")}function strInvalid(str){var dst=str.replace(/(^\s*)|(\s*$)/g,"");if("undefined"==dst||""==dst||!dst){return true}return false}if(opts.multiRoadTagFlag){opts.isMultiRoadTag++;if(1<opts.isMultiRoadTag){return d}}if(0<errorMsgs.length){$editor.call(iD.ui.TagEditor.toastr,errorMsgs.join("<br/>"),{className:"error"})}if(0<warningMsgs.length){$editor.call(iD.ui.TagEditor.toastr,warningMsgs.join("<br/>"),{className:"warning"})}return firstAdjustTags(d,fieldOpts,$editor,uiField,opts)}return{title:"\u8F66\u9053\u5C5E\u6027\u53D8\u5316\u70B9",onValidate:adjustTags,onInitValidate:false,fieldsGroup:[{title:"\u57FA\u672C\u4FE1\u606F",fields:[]}]}};;;iD.ui.TagEditorTpl.RoadAttribute=function(){function isObjectEmpty(obj){if("object"===typeof obj&&!(obj instanceof Array)){var hasProp=false;for(var prop in obj){hasProp=true;break}return hasProp}return false}function adjustTags(d,fieldOpts,$editor,uiField,opts){if(!isObjectEmpty(d)){return firstAdjustTags(d,fieldOpts,$editor,uiField,opts)}else{return normalAdjustTags(d,fieldOpts,$editor,uiField,opts)}}function firstAdjustTags(d,fieldOpts,$editor,uiField,opts){return d}function normalAdjustTags(d,fieldOpts,$editor,uiField,opts){var tags=_.extend({},fieldOpts.context.entity(fieldOpts.entity.id).tags,d),errorMsgs=[],warningMsgs=[];function SBC(text){return text.replace(/[\x20-\x7e]/g,function($0){return" "==$0?"\u3000":String.fromCharCode($0.charCodeAt(0)+65248)})}function dbc2sbc(str){return str.replace(/[\uff01-\uff5e]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)}).replace(/\u3000/g," ")}function strInvalid(str){var dst=str.replace(/(^\s*)|(\s*$)/g,"");if("undefined"==dst||""==dst||!dst){return true}return false}if(opts.multiRoadTagFlag){opts.isMultiRoadTag++;if(1<opts.isMultiRoadTag){return d}}if(0<errorMsgs.length){$editor.call(iD.ui.TagEditor.toastr,errorMsgs.join("<br/>"),{className:"error"})}if(0<warningMsgs.length){$editor.call(iD.ui.TagEditor.toastr,warningMsgs.join("<br/>"),{className:"warning"})}return firstAdjustTags(d,fieldOpts,$editor,uiField,opts)}return{title:"\u9053\u8DEF\u5C5E\u6027\u53D8\u5316\u70B9",onValidate:adjustTags,onInitValidate:false,fieldsGroup:[{title:"\u57FA\u672C\u4FE1\u606F",fields:[{fieldName:"TYPE",fieldRender:"selectgroup",fieldLabel:"\u5C5E\u6027\u7C7B\u578B",fieldLinkGroup:["VALUE"]}]}]}};;;iD.ui.TagEditor.autoassign=iD.ui.TagEditor.autoassign||{};iD.ui.TagEditor.autoassign.road=function(tags){var isNull=function(k){var r=true;if("undefined"!=typeof tags[k]&&""!=tags[k]){r=false}return r};var road_class_lc_fc={41000:["4","1"],42000:["4","2"],43000:["4","2"],44000:["1","4"],45000:["1","5"],47000:["0","6"],51000:["2","3"],52000:["1","5"],53000:["1","5"],54000:["0","6"],49:["0","6"],100:["0","6"]};if(!isNull("link_type")&&"1"==tags["link_type"]){tags["road_class"]="45000";tags["direction"]="1";tags["FORM_WAY"]="15"}if(!isNull("direction")&&"4"==tags["direction"]){tags["FORM_WAY"]="15";tags["link_type"]="0";tags["owner_ship"]="0";tags["status"]="0"}if(!isNull("road_class")&&("41000"==tags["road_class"]||"43000"==tags["road_class"])){tags["owner_ship"]="0";tags["paver"]="2"}if(!isNull("road_class")&&"41000"==tags["road_class"]){tags["toll"]="1"}if(!isNull("road_class")&&isNull("fc")){tags.fc=road_class_lc_fc[tags["road_class"]][1]}if(!isNull("road_class")){tags["lc_1"]=road_class_lc_fc[tags["road_class"]][0];tags["lc_2"]=road_class_lc_fc[tags["road_class"]][0]}if(!isNull("link_type")&&"1"==tags["link_type"]){tags["fow"]="-1"}else if(!isNull("FORM_WAY")&&"4"==tags["FORM_WAY"]){tags["fow"]="4"}else if(!isNull("FORM_WAY")&&"5"==tags["FORM_WAY"]){tags["fow"]="12"}else if(!isNull("direction")&&"4"==tags["direction"]&&!isNull("road_class")&&"100"!=tags["road_class"]){tags["fow"]="14"}else if(!isNull("owner_ship")&&("4"==tags["owner_ship"]||"5"==tags["owner_ship"])){tags["fow"]="7"}else if(!isNull("FORM_WAY")){if("1"==tags["FORM_WAY"]&&!isNull("road_class")&&"41000"==tags["road_class"]){tags["fow"]="1"}else if("1"==tags["FORM_WAY"]&&!isNull("road_class")&&"41000"!=tags["road_class"]){tags["fow"]="2"}else if(0<=["11","12","13","14"].indexOf(tags["FORM_WAY"])){tags["fow"]="103"}else if("7"==tags["FORM_WAY"]){tags["fow"]="11"}else{tags["fow"]="3"}}else{tags["fow"]="3"}if(!isNull("road_class")&&!isNull("FORM_WAY")){if(0<=["47000","54000","49"].indexOf(tags["road_class"])){tags["ave_lanes"]="1"}else if(0>["47000","54000","49"].indexOf(tags["road_class"])&&"16"==tags["FORM_WAY"]){tags["ave_lanes"]="2"}else if("45000"==tags["road_class"]&&"15"==tags["FORM_WAY"]){tags["ave_lanes"]="1"}else if("45000"==tags["road_class"]&&0<=["1","2","4","7"].indexOf(tags["FORM_WAY"])){tags["ave_lanes"]="2"}else if("43000"==tags["road_class"]&&0<=["1","2","4","7","15"].indexOf(tags["FORM_WAY"])){tags["ave_lanes"]="3"}else if(0<=["41000","42000","44000","51000","52000","53000"].indexOf(tags["road_class"])&&0<=["1","2","4","7","15"].indexOf(tags["FORM_WAY"])){tags["ave_lanes"]="2"}else if(0<=["41000","42000","43000","44000","51000","52000","53000"].indexOf(tags["road_class"])&&0<=["5","53","56","58"].indexOf(tags["FORM_WAY"])){tags["ave_lanes"]="1"}else if(0<=["41000","43000"].indexOf(tags["road_class"])&&0<=["3","8"].indexOf(tags["FORM_WAY"])){tags["ave_lanes"]="2"}else if(0<=["41000","43000"].indexOf(tags["road_class"])&&0<=["6","9","10"].indexOf(tags["FORM_WAY"])){tags["ave_lanes"]="1"}else if(0<=["42000","44000","51000","52000","53000"].indexOf(tags["road_class"])&&0<=["3","6","8","9","10","11","12","13","14"].indexOf(tags["FORM_WAY"])){tags["ave_lanes"]="1"}}if(!isNull("link_type")&&"1"==tags["link_type"]){tags["ave_lanes"]="1"}if(!isNull("direction")&&"4"==tags["direction"]){tags["ave_lanes"]="1"}if(!isNull("road_class")&&0<=["41000","43000"].indexOf(tags["road_class"])||!isNull("FORM_WAY")&&0<=["3","8","9","10","13","14"].indexOf(tags["FORM_WAY"])||!isNull("owner_ship")&&0<=["3","4"].indexOf(tags["owner_ship"])||!isNull("u_line")&&"1"==tags["u_line"]){tags["navitype"]="2"}if(!isNull("road_class")&&!isNull("ave_lanes")){if(0<=["41000","43000"].indexOf(tags["road_class"])){var width=3.5*parseInt(tags["ave_lanes"]);tags["width"]=width.toString()}else if(0>["41000","43000"].indexOf(tags["road_class"])){var width=3*parseInt(tags["ave_lanes"]);tags["width"]=width.toString()}else if("45000"==tags["road_class"]&&!isNull("FORM_WAY")&&"15"==tags["FORM_WAY"]&&"1"==tags["ave_lanes"]){tags["width"]="6"}}if(!isNull("link_type")&&"1"==tags["link_type"]){tags["width"]="3"}if(!isNull("direction")&&"4"==tags["direction"]){tags["width"]="3"}if(!isNull("direction")&&!isNull("ave_lanes")){if(0<=["1","4"].indexOf(tags["direction"])){var obj={1:["1","1"],2:["1","1"],3:["2","1"],4:["2","2"],5:["3","2"],6:["3","3"],7:["4","3"],8:["4","4"],9:["5","4"]};if(0<=["1","2","3","4","5","6","7","8","9"].indexOf(tags["ave_lanes"])){tags["p_lanes"]=obj[tags["ave_lanes"]][0];tags["n_lanes"]=obj[tags["ave_lanes"]][1]}}else if("2"==tags["direction"]){tags["p_lanes"]=tags["ave_lanes"];tags["n_lanes"]="0"}else if("3"==tags["direction"]){tags["p_lanes"]="0";tags["n_lanes"]=tags["ave_lanes"]}}return tags};;iD.ui.TagEditor.autocheck=iD.ui.TagEditor.autocheck||{};iD.ui.TagEditor.autocheck.road=function(context,changes){function checkRoadValid(tags){var isNull=function(k){var r=true;if("undefined"!=typeof tags[k]&&""!=tags[k]){r=false}return r};var arr=[];if(isNull("road_class")){arr.push("\u9053\u8DEF\u7B49\u7EA7")}if(isNull("fc")){arr.push("\u529F\u80FD\u7B49\u7EA7")}return arr}function checkPlaceNameValid(tags){var isNull=function(k){var r=true;if("undefined"!=typeof tags[k]&&""!=tags[k]){r=false}return r};var arr=[];if(isNull("name_chn")){arr.push("\u5730\u540D\u4FE1\u606F\u540D\u79F0")}return arr}function checkRealNodeValid(tags){if(modelName==iD.data.DataType.ROADNODE&&"20"==tags.boundary&&"1"==tags.realnode){return 1}else if(modelName==iD.data.DataType.ROADNODE&&"20"==tags.boundary&&"-1"==tags.realnode){return-1}return 0}function checkRealNodeInThreeMeters(entity){if(entity.tags.boundary&&"0"==entity.tags.boundary){var loc=entity.loc,threeMeters=0.000028;var loc1=[loc[0]-threeMeters,loc[1]-threeMeters];var loc2=[loc[0]+threeMeters,loc[1]+threeMeters];var bbox=[loc1,loc2];var all=context.intersects(bbox);var distance=3;for(var i=0;i<all.length;i++){if(all[i]instanceof iD.Way&&all[i].modelName==iD.data.DataType.BND&&2==all[i].nodes.length){if(distance>iD.util.slopExtend.getDisBetPointAndWay(entity,all[i],context.graph())){return true}}}}return false}function checkWalkEnterValid(context,entity){var parentWays=context.graph().parentWays(entity);if("20"==entity.tags.boundary&&2!=parentWays.length){return true}return false}function checkWorkEnterInOneMeters(entity){if(entity.tags.boundary&&"0"==entity.tags.boundary){var loc=entity.loc,oneMeters=0.00001;var loc1=[loc[0]-oneMeters,loc[1]-oneMeters];var loc2=[loc[0]+oneMeters,loc[1]+oneMeters];var bbox=[loc1,loc2];var all=context.intersects(bbox);var distance=1;for(var i=0;i<all.length;i++){if(all[i]instanceof iD.Way&&all[i].modelName==iD.data.DataType.BND&&2==all[i].nodes.length){if(distance>iD.util.slopExtend.getDisBetPointAndWay(entity,all[i],context.graph())){return true}}}}return false}function checkRoadLength(entity){if(3>parseFloat(entity.tags.length)){return true}return false}for(var i=changes.created.length-1;0<=i;i--){var _entity=changes.created[i];if(_entity instanceof iD.Way&&"undefined"!=typeof _entity.tags&&"undefined"!=typeof _entity.modelName&&"Highway"==_entity.modelName){var arr=checkRoadValid(_entity.tags);if(0<arr.length){Dialog.alert("\u9053\u8DEF("+_entity.id+")\u7684\u5C5E\u6027("+arr.join(",")+")\u4E3A\u7A7A, \u4E0D\u80FD\u4FDD\u5B58!");context.enter(iD.modes.Select(context,[_entity.id]).suppressMenu(true));return false}}else if(_entity instanceof iD.Node&&"undefined"!=typeof _entity.tags&&"undefined"!=typeof _entity.modelName&&"PlaceName"==_entity.modelName){}}var created=[].concat(changes["created"]),modified=[].concat(changes["modified"]),deleted=[].concat(changes["deleted"]);var wanted=created.concat(modified);for(var i=wanted.length-1;0<=i;i--){var _entity=wanted[i];if(_entity instanceof iD.Node&&"RoadNode"==_entity.modelName){var flag=checkRealNodeValid(_entity.tags);if(1==flag){Dialog.alert("\u8DE8\u56FE\u5E45\u8FB9\u6846\u70B9("+_entity.id+")\u4E0D\u80FD\u662F\u771F\u5B9E\u8282\u70B9, \u4E0D\u80FD\u4FDD\u5B58!");context.enter(iD.modes.Select(context,[_entity.id]).suppressMenu(true));return false}else if(-1==flag){Dialog.alert("\u8DE8\u56FE\u5E45\u8FB9\u6846\u70B9("+_entity.id+")\u4E0D\u80FD\u662F\u60AC\u6302\u7ED3\u70B9, \u4E0D\u80FD\u4FDD\u5B58!");context.enter(iD.modes.Select(context,[_entity.id]).suppressMenu(true));return false}var isInThreeMeter=checkRealNodeInThreeMeters(_entity);if(isInThreeMeter){Dialog.alert("\u975E\u8FB9\u6846\u8282\u70B9("+_entity.id+")\u5728\u56FE\u5E45\u8FB9\u6846\u7EBF3\u7C73\u4E4B\u5185, \u4E0D\u80FD\u4FDD\u5B58!");context.enter(iD.modes.Select(context,[_entity.id]).suppressMenu(true));return false}}else if(_entity instanceof iD.Node&&_entity.modelName==iD.data.DataType.WALKENTER){var flag=checkWalkEnterValid(context,_entity);if(flag){Dialog.alert("\u5B58\u5728\u8FB9\u6846\u70B9"+_entity.id+"\u4E0D\u662F\u4E8C\u9636\u6B65\u5BFC\u70B9");context.enter(iD.modes.Select(context,[_entity.id]).suppressMenu(true));return false}var isInOneMeter=checkWorkEnterInOneMeters(_entity);if(isInOneMeter){Dialog.alert("\u6B65\u5BFC\u8282\u70B9("+_entity.id+")\u8DDD\u79BB\u56FE\u5E45\u8FB9\u6846\u592A\u8FD1");context.enter(iD.modes.Select(context,[_entity.id]).suppressMenu(true));return false}}else if(_entity instanceof iD.Way&&"Highway"==_entity.modelName){var flag=checkRoadLength(_entity);if(flag){Dialog.alert("\u9053\u8DEF("+_entity.id+")\u957F\u5EA6\u5C0F\u4E8E3\u7C73, \u4E0D\u80FD\u4FDD\u5B58!");context.enter(iD.modes.Select(context,[_entity.id]).suppressMenu(true));return false}}}return true};;iD.ui.TagEditorInput.text=function(field){var event=d3.dispatch("change"),input;function i(selection,opts){input=selection.selectAll("input").data([0]);input.enter().append("input");input.attr("type",field.type).attr("id","preset-input-"+field.id).attr("placeholder",field.placeholder());var fieldModel=opts.fieldModel;if(fieldModel&&fieldModel.fieldSize){input.attr("maxLength",fieldModel.fieldSize)}input.on("blur",change).on("change",change)}function change(){var t={};t[field.key]=input.value()||"";event.change(t)}i.readOnly=function(readonly){input.call(iD.ui.TagEditor.readOnly,readonly)};i.disable=function(disable){input.call(iD.ui.TagEditor.disable,disable)};i.tags=function(tags){var v=tags[field.key]||"";if("NULL"==v)v="";input.value(v)};i.focus=function(){input.node().focus()};i.change=function(t){var t="undefined"!=typeof t?_.extend({},t):{};event.change(t)};return d3.rebind(i,event,"on")};;;iD.ui.TagEditorInput.inputGroup=function(field,context,opts){var event=d3.dispatch("change"),input,nameFldsInputs,nameFldsOptions=opts.fieldTpl.fieldOptions,baseNum=1;var tips=[];_.each(nameFldsOptions,function(v){tips.push(v.title)});tips=tips.join(", ");function i(selection,opts){this._tags=opts.tags;var that=this;input=selection.selectAll("input").data([0]);input.enter().append("input");input.attr("type","text").attr("id","preset-input-"+field.id).attr("class","preset-input").attr("placeholder",field.placeholder());var fieldModel=opts.fieldModel;if(fieldModel&&fieldModel.fieldSize){input.attr("maxLength",fieldModel.fieldSize)}input.on("blur",change(that)).on("change",change(that));var nameAddBtn=selection.selectAll(".roadname-add").data([0]);nameAddBtn.enter().append("button").attr("class","button-input-action roadname-add minor").call(bootstrap.tooltip().title(function(){if(""==input.value()){return"\u586B\u5199\uFF1A"+field.fieldModel.title+"\u540E\u624D\u80FD\u6DFB\u52A0\u9644\u52A0\u5C5E\u6027"}else if(nameFldsInputs.selectAll("div.entry").data().length>=nameFldsOptions.length){return"\u53EA\u80FD\u6DFB\u52A0"+nameFldsOptions.length+"\u6761\u9644\u52A0\u5C5E\u6027"}else{var data=nameFldsInputs.selectAll("div.entry").data();if(_.any(data,function(d){return!d.value||""==d.value})){return"\u8BF7\u5148\u586B\u5199\u5B8C\u5168\u522B\u540D\u3002"}else{return tips}}}).placement("left")).append("span").attr("class","icon KDSEditor-icon plus");nameAddBtn.on("click",addBlank(that));nameAddBtn.classed("hide",false);nameFldsInputs=d3.select(selection.node().parentNode.parentNode).selectAll(".namelist-wrap").data([0]);nameFldsInputs.enter().append("div").attr("class","namelist-wrap localized-wrap")}function getValue(_t,tags){var t={},_t=_t||{},tags=tags||opts.tags;var alias_chn=[];_.each(nameFldsOptions,function(d){if(_t.hasOwnProperty(d.name)){if("undefined"!=typeof _t[d.name]&&""!=_t[d.name]){alias_chn.push(_t[d.name])}}else if(tags[d.name]){alias_chn.push(tags[d.name])}t[d.name]=undefined});t["alias_chn"]=alias_chn.join("|");if("undefined"!=typeof t["alias_chn"]&&""!=t["alias_chn"]){var alias_chn=t["alias_chn"].split("|");for(var len=alias_chn.length,i=0;i<len;i++){t["alias_chn"+createSN(i,alias_chn.length,3)]=alias_chn[i]};}if(tags[opts.fieldTpl.fieldName]){t[opts.fieldTpl.fieldName]=tags[opts.fieldTpl.fieldName]}t["name_chn"]="undefined"!=typeof _t["name_chn"]?_t["name_chn"]:tags["name_chn"];function SBC(text){return text.replace(/[\x20-\x7e]/g,function($0){return" "==$0?"\u3000":String.fromCharCode($0.charCodeAt(0)+65248)})}if("undefined"!=typeof t["alias_chn"]){t["name_chn"]=SBC(t["name_chn"])}if("undefined"!=typeof t["alias_chn1"]){t["alias_chn1"]=SBC(t["alias_chn1"])}if("undefined"!=typeof t["alias_chn2"]){t["alias_chn2"]=SBC(t["alias_chn2"])}if("undefined"!=typeof t["alias_chn3"]){t["alias_chn3"]=SBC(t["alias_chn3"])}var keys=Object.keys(_t);t["name_trigger"]=keys.join(",");return t}function createSN(i,len,max){return max-len+i+1}function addBlank(i){return function(){d3.event.preventDefault();var data=nameFldsInputs.selectAll("div.entry").data();if(_.any(data,function(d){return!d.value||""==d.value})||""==input.value()||data.length>=nameFldsOptions.length){return}data.unshift({name:"alias_chn"+(3-data.length),value:""});nameFldsInputs.call(render,data,i)}}function changeFieldName(wrap,change,i){var d=wrap.datum(),t={};for(var k in change){if(d.name!==change[k]){if(d.name){t[d.name]=undefined}}d.name=change[k];t[change[k]]=d.value;break}if(d.value){event.change(getValue(t,i._tags))}}function changeFieldValue(wrap,i){return function(d){d.value=d3.select(this).value()||"";if(!d.name||!d.value){wrap.call(iD.ui.TagEditor.toastr,"\u672A\u7F16\u8F91\u5B8C\u7684\u65B0\u589E\u9879\u5C06\u81EA\u52A8\u5220\u9664\u3002",{className:"warning"})}if(d.name){var t={};t[d.name]=d.value;event.change(getValue(t,i._tags))}}}function render(selection,data,i){var wraps=selection.selectAll("div.entry").data(data,function(d){return d.name});var innerWrap=wraps.enter().insert("div",":first-child").attr("class","entry");innerWrap.each(function(){var wrap=d3.select(this);var $label=wrap.selectAll("label.form-label").data(["\u522B\u540D"]);$label.enter().append("label").attr("class","form-label KDSEditor-form-label");$label.html(function(d){return d});wrap.append("input").attr("type","text").attr("placeholder","").attr("class","no-top-border namelist-fieldval preset-input");wrap.append("button").attr("class","button-input-action minor remove").append("span").attr("class","icon KDSEditor-icon delete")});wraps.each(function(){var wrap=d3.select(this);wrap.select("input").on("blur",changeFieldValue(wrap,i)).on("change",changeFieldValue(wrap,i));wrap.select("button.remove").on("click",function(d){d3.event.preventDefault();if(d.name){var t={};t[d.name]=undefined;event.change(getValue(t))}})});innerWrap.style("margin-top","0px").style("max-height","0px").style("opacity","0").style("margin-top","10px").style("max-height","240px").style("opacity","1").style("max-height","").style("overflow","visible");wraps.exit().style("max-height","0px").style("opacity","0").style("top","-10px").remove();wraps.select(".namelist-fieldval").value(function(d){return d.value})}function change(i){return function(){var t={};t[field.key]=input.value()||"";event.change(getValue(t,i._tags))}}i.readOnly=function(readonly){input.call(iD.ui.TagEditor.readOnly,readonly);nameFldsInputs.selectAll("input.preset-input").call(iD.ui.TagEditor.readOnly,readonly)};i.disable=function(disable){input.call(iD.ui.TagEditor.disable,disable);nameFldsInputs.selectAll("input.preset-input").call(iD.ui.TagEditor.disable,disable)};i.tags=function(tags){if(tags["alias_chn"]&&"undefined"==typeof tags["alias_chn1"]&&"undefined"==typeof tags["alias_chn2"]&&"undefined"==typeof tags["alias_chn3"]){var alias_chn=tags["alias_chn"].split("|");for(var len=alias_chn.length,i=0;i<len;i++){tags["alias_chn"+createSN(i,alias_chn.length,3)]=alias_chn[i]};}this._tags=tags;input.value(tags[field.key]||"");var nameFlds=[];_.each(nameFldsOptions,function(d){if("undefined"!=typeof tags[d.name]){nameFlds.push({name:d.name,value:tags[d.name]})}});nameFlds.reverse();nameFldsInputs.call(render,nameFlds,this)};i.focus=function(){input.node().focus()};i.change=function(t){var t="undefined"!=typeof t?_.extend({},t):{};event.change(t)};return d3.rebind(i,event,"on")};;;iD.ui.TagEditorInput.relations=function(context,relationModelName){var event=d3.dispatch("change","delete"),vertexID,fromNodeID,relationID,relationRestrictionIDs=[],selectWayID,restrictionGroups=[],restrictionNum=1;var state="select";var eventNS=".rel_"+relationModelName;var rawTagEditor=iD.ui.RawTagEditor(context).on("change"+eventNS,changeTags);var relationVersion;function getRestrictionGroupsIndex(){var index=-1;for(var i=0;i<restrictionGroups.length;i++){var resriction=restrictionGroups[i];if("block"==resriction.style("display")){index=i;break}}return index}function layerEditable(modelName){if(!modelName)return false;var layer=iD.Layers.getCurrentModelEnableLayer(modelName);return layer&&layer.editable}function changeTags(changed){var selectResrictionIndex=getRestrictionGroupsIndex();var isLAR=false;var keys=["TYPE","TIME","VEHICLE","WEATHER"];_.forInRight(changed,function(value,key){var index=_.indexOf(keys,key);isLAR=-1!=index?true:false});if(relationModelName==iD.data.DataType.LANE_ATTRIBUTE&&isLAR){relationID=relationRestrictionIDs[selectResrictionIndex];if(!relationID)return}var entity=context.entity(relationID);tags=_.extend({},entity.tags,changed);var msg="\u66F4\u6539"+Object.keys(changed).toString();if(_.isEmpty(changed)){return}if(!iD.util.tagChanged(entity.tags,changed)){return}var actions_array=[];actions_array.push(iD.actions.ChangeTags(relationID,tags));actions_array.push(msg);context.perform.apply(this,actions_array)}function waysFilter(highways,vertexID){var ways=[];if(!vertexID){return ways}for(var i=0,len=highways.length;i<len;i++){if(highways[i].modelName!=iD.data.DataType.DIVIDER){continue}let direction=highways[i].tags&&highways[i].tags.DIRECTION;if("3"===direction){if(highways[i].last()==vertexID||highways[i].nodes.includes(vertexID)&&highways[i].first()!=vertexID){ways.push(highways[i])}continue}if(highways[i].first()==vertexID||highways[i].nodes.includes(vertexID)&&highways[i].last()!=vertexID){ways.push(highways[i])}}return ways}function restrictions(selection,svgChange){if(!context.hasEntity(vertexID)){restrictions.destroy();return}if(0==selection.node().offsetWidth&&0==selection.node().offsetHeight){restrictions.destroy();return}!svgChange&&clearTagEditor();if(svgChange){selection.selectAll(".preset-input-wrap").remove()}else{clearRestrictionGroups()}var wrap=selection.selectAll(".preset-input-wrap").data([0]);if(svgChange){var enter=wrap.enter().insert("div",":first-child").attr("class","preset-input-wrap")}else{var enter=wrap.enter().append("div").attr("class","preset-input-wrap")}selection.selectAll("div.preset-relation-btns").data([0]).enter().append("div").attr("class","preset-relation-btns clearfix");selection.selectAll("div.preset-input-relation").data([0]).enter().append("div").attr("class","preset-input-relation");if(relationModelName==iD.data.DataType.LANE_ATTRIBUTE&&0==selection.selectAll(".restrictiongroups")[0].length){selection.selectAll("div.restriction_groups").data([0]).enter().append("div").attr("class","restrictiongroups")}enter.append("div").attr("class","restriction-help");enter.append("svg").call(iD.svg.Surface(context)).call(iD.behavior.Hover(context));var graph=context.graph(),vertex=graph.entity(vertexID),highways=graph.parentWays(vertex);var surface=wrap.selectAll("svg"),filter=function(){return true},extent=iD.geo.Extent(),projection=iD.geo.RawMercator(),lines=iD.svg.Lines(projection,context),vertices=iD.svg.Vertices(projection,context),ways=waysFilter(highways,vertexID);var d=wrap.dimensions(),c=[d[0]/2,d[1]/2],z=24;if(1>ways.length){selection.remove()}projection.scale(256*Math.pow(2,z)/(2*Math.PI));var s=projection(vertex.loc);projection.translate([c[0]-s[0],c[1]-s[1]]).clipExtent([[0,0],d]);var relations=graph.parentRelations(vertex,relationModelName),execEffect=false;var laBtn=d3.select("#effects-lane-highlight").classed("active");var daBtn=d3.select("#effects-divider-attr-highlight").classed("active");if(relationModelName==iD.data.DataType.DIVIDER_ATTRIBUTE){if(0!=relations.length&&daBtn){execEffect=true}}else if(relationModelName==iD.data.DataType.LANE_ATTRIBUTE){if(0!=relations.length&&laBtn){execEffect=true}}if(vertex.modelName==iD.data.DataType.DIVIDER_NODE&&"4"==vertex.tags.DASHTYPE){execEffect=true}surface.call(vertices,graph,[vertex],filter,extent,z,execEffect).call(lines,graph,ways,filter,{isThumbnail:true,selectedID:vertexID});surface.on("click"+eventNS,click).on("mouseover"+eventNS,mouseover).on("mouseout"+eventNS,mouseout);surface.selectAll(".selected").classed("selected",false);if(fromNodeID){let filterWay=_.find(ways,function(way){return way.contains(fromNodeID)});filterWay&&selectEntity(filterWay.id)}if(!relationID){clearTagEditor()}else{var r=context.hasEntity(relationID);if(r)relationVersion=r.v;else relationVersion=undefined}mouseout();var isOperate=false;context.history().on("redone"+eventNS,function(){isOperate=true}).on("undone"+eventNS,function(){isOperate=true}).on("change"+eventNS,function(changed){if(isOperate){isOperate=false;var dar=changed&&changed.summary()[0];var changeType=dar&&dar.changeType;dar=dar&&dar.entity;var isself=-1<eventNS.indexOf(iD.data.DataType.LANE_ATTRIBUTE)||-1<eventNS.indexOf(iD.data.DataType.DIVIDER_ATTRIBUTE);if(isself&&dar){restrictions(selection,false)}return}var r=relationID&&context.hasEntity(relationID);if(r){if(changed){var deleteRel=changed.deleted()[0];var dar=_.values(changed.changes())[0];dar=dar&&dar.head||deleteRel;if(!dar){}else if(dar.modelName==iD.data.DataType.DIVIDER_ATTRIBUTE){restrictions(selection,true)}}if(relationVersion==r.v)return}else if(!r){relationVersion=undefined;restrictions(selection,true);return}var fieldChange=false;if(changed){var created=changed.created();if(1==created.length&&created[0].modelName==iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION){fieldChange=true}else{fieldChange=!_.isEmpty(changed.changes())&&!created.length}}restrictions(selection,fieldChange)});context.event.on("changeeffect"+eventNS,render);d3.select(window).on("resize"+eventNS,render);if(!svgChange)showDefaultRelaion(ways);function showDefaultRelaion(ways){var result;graph=context.graph();for(var way of ways){var relations=graph.parentRelations(way,relationModelName);if(!relations.length)continue;var RBR=getRoleByRealations(relations,way,iD.data.RoleType.DIVIDER_ID);if(RBR.exec){result=way;selectEntity(way.id);deleteRelations(way,false);break}}return result}function selectEntity(entityid){surface.selectAll(".selected").classed("selected",false);entityid&&surface.selectAll("."+entityid).classed("selected",true)}function getRoleByRealations(relations,datum,modelName){for(var i=0;i<relations.length;i++){var relation=relations[i];if(relation&&datum&&relation.memberByRole(modelName)){if(datum.id==relation.memberByRole(modelName).id){return{exec:true,relation:relation}}}}return{exec:false}}function click(){var datum=d3.event.target.__data__;if(datum instanceof iD.Way){selectEntity(datum.id);clearTagEditor();var node=context.graph().entity(vertexID);var res=context.graph().parentRelations(node,relationModelName);var RBR=getRoleByRealations(res,datum,iD.data.RoleType.DIVIDER_ID);if(RBR.exec){relationVersion=undefined;clearRestrictionGroups();deleteRelations(datum,false)}else{selection.selectAll(".preset-relation-btns").select("a.res-rel-delete").remove();if(iD.User.isLinearRole()){var _rels=graph.parentRelations(graph.entity(vertexID),relationModelName);if(!_rels.length)return}if(!selection.selectAll("div.preset-input-relation").empty()&&layerEditable(relationModelName)){var info="DA";if(relationModelName==iD.data.DataType.LANE_ATTRIBUTE){info="LA";d3.select(".tag-lane-attribute .preset-input-relation").style("display","none");d3.select(".tag-lane-attribute .restriction-relation-btns").style("display","none")}else{d3.select(".tag-divider-attribute .preset-input-relation").style("display","none")}selection.selectAll(".preset-relation-btns").append("a").attr("class","res-rel-delete").text("\u6DFB\u52A0"+info).on("click"+eventNS,function(){if(relationModelName==iD.data.DataType.LANE_ATTRIBUTE){d3.select(".tag-lane-attribute .preset-input-relation").style("display","block");d3.select(".tag-lane-attribute .restriction-relation-btns").style("display","block")}else{d3.select(".tag-divider-attribute .preset-input-relation").style("display","block")}deleteRelations(datum,true)})}}}}function getEditable(modelName){var entity=context.entity(selectWayID);var lay=iD.Layers.getLayer(entity.layerId);if(lay&&!iD.Layers.getLayerModelEditable(lay,modelName)){return false}return true}function deleteRelations(datum,isAdd){selectWayID=datum.id;fromNodeID=datum.nodes[datum.first()===vertexID?1:datum.nodes.length-2];var rel=getRelation(null,isAdd);render();renderTag();selection.selectAll(".preset-relation-btns").select("a.res-rel-delete").remove();var RBR=getRoleByRealations([rel],datum,iD.data.RoleType.DIVIDER_ID);if(RBR.exec&&!selection.selectAll("div.preset-input-relation").empty()&&layerEditable(relationModelName)){var info="DA";if(relationModelName==iD.data.DataType.LANE_ATTRIBUTE){info="LA";d3.select(".tag-lane-attribute .preset-input-relation").style("display","block")}else{d3.select(".tag-divider-attribute .preset-input-relation").style("display","block")}selection.selectAll(".preset-relation-btns").append("a").attr("class","res-rel-delete").text("\u5220\u9664"+info).on("click"+eventNS,clickDelete)}if(RBR.exec&&relationModelName==iD.data.DataType.LANE_ATTRIBUTE){var rels=graph.parentRelations(rel),relation;for(var i=0;i<rels.length;i++){relation=rels[i];addRestrictionDom();addRestrictionBtn();renderRestrictionTag(relation,i+1);removeRestrictionBtn(restrictionNum);restrictionNum++}if(0!=rels.length||1==restrictionNum){addRestriction();restrictionGroups.slice(0,restrictionGroups.length-1).forEach(function($group,idx){if(0==idx){$group.style("display","block");return}$group.style("display","none")})}}}function addRestrictionDom(){var restrictiongroups=selection.selectAll(".restrictiongroups");var group=restrictiongroups.selectAll("div.restriction_group_"+restrictionNum).data([0]).enter().append("div").attr("class","restrictiongroup_"+restrictionNum);group.selectAll("div.restriction-relation-btns").data([0]).enter().append("div").attr("class","restriction-relation-btns clearfix");let restrictionInputRelation=group.selectAll("div.restriction-input-relation").data([0]).enter().append("div").attr("class","restriction-input-relation").attr("restrictionindex",restrictionNum).style("display","none");restrictionGroups.push(restrictionInputRelation)}function addRestrictionBtn(){if(!getEditable(iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION)){return false}selection.selectAll(".restrictiongroup_"+restrictionNum+" .restriction-relation-btns").append("a").attr("class","res-rel-delete").attr("title","\u6DFB\u52A0\u8F66\u9053\u9650\u5236\u4FE1\u606F\u5173\u7CFB").text("\u6DFB\u52A0\u8F66\u9053\u9650\u5236_"+restrictionNum).on("click"+eventNS,function(){var text=this.text;var num=text.split("_")[1];renderRestrictionTag(null,num,true);removeRestrictionBtn(num);addRestriction()})}function addRestriction(){addRestrictionDom();selection.selectAll(".restrictiongroup_"+restrictionNum+" .restriction-relation-btns").select("a.res-rel-delete").remove();if(!selection.selectAll("div.preset-input-relation").empty()&&layerEditable(iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION)){addRestrictionBtn();restrictionNum++;if(restrictionGroups.length){for(var i=0;i<restrictionGroups.length;i++){if(i==restrictionGroups.length-2){restrictionGroups[i].style("display","block")}else{restrictionGroups[i].style("display","none");selection.selectAll(".tag-lane-attribute .restrictiongroup_"+restrictionGroups[i].attr("restrictionindex")+" .glyphicon").attr("class","glyphicon glyphicon-chevron-up res-rel-delete")}}}}}function removeRestrictionBtn(num){var numArr=[];if(num){numArr.push(num)}else{numArr=_.compact(_.map(selection.selectAll(".restriction-input-relation")[0],function(ele){return ele.getAttribute("restrictionindex")}))}for(let i=0;i<numArr.length;i++){var num=numArr[i];selection.selectAll(".tag-lane-attribute .restrictiongroup_"+num+" .restriction-relation-btns").selectAll("a.res-rel-delete").remove();if(selection.selectAll(".tag-lane-attribute .restrictiongroup_"+num+" div.restriction-relation-btns a").empty()&&layerEditable(iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION)){var $btns=selection.selectAll(".tag-lane-attribute .restrictiongroup_"+num+" .restriction-relation-btns");$btns.append("a").attr("class","glyphicon glyphicon-chevron-down res-rel-delete").attr("restrictionindex",num).on("click"+eventNS,changeListShow);$btns.append("a").attr("class","res-rel-delete").attr("title","\u5220\u9664\u8F66\u9053\u9650\u5236\u4FE1\u606F\u5173\u7CFB").attr("restrictionid",relationRestrictionIDs[num-1]).text("\u5220\u9664\u8F66\u9053\u9650\u5236_"+num).on("click"+eventNS,deleteRestriction)}}}function changeListShow(){var $this=$(this);var num=$this.attr("restrictionindex");var $relationlist=d3.selectAll(".restriction-input-relation")[0];for(var i=0;i<$relationlist.length;i++){var relation=$($relationlist[i]);var relationNum=relation.attr("restrictionindex");if(relationNum==num){if("block"==$relationlist[i].style.display){$relationlist[i].style.display="none";$this.attr("class","glyphicon glyphicon-chevron-up res-rel-delete")}else{$relationlist[i].style.display="block";$this.attr("class","glyphicon glyphicon-chevron-down res-rel-delete")}}else{$relationlist[i].style.display="none";d3.select(".restrictiongroup_"+relationNum).select(".glyphicon").attr("class","glyphicon glyphicon-chevron-up res-rel-delete")}}}function deleteRestriction(){var vertex=graph.entity(vertexID);var way=graph.entity(selectWayID);if(!way||relationModelName==iD.data.DataType.DIVIDER_ATTRIBUTE){return}var g=context.graph();let LArels=g.parentRelations(vertex,iD.data.DataType.LANE_ATTRIBUTE);var RAR=getRoleByRealations(LArels,way,iD.data.RoleType.DIVIDER_ID);if(RAR.exec){var LArelation=RAR.relation;var LAArels=g.parentRelations(LArelation,iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION);var text=this.text;if(text){var entityId=this.getAttribute("restrictionid");var num=text.split("_")[1];var maplist=_.map(LAArels,function(ele){return ele.id});var restrictionindex=_.indexOf(maplist,entityId);var LAArelation=LAArels[restrictionindex];if(LAArelation){context.perform(iD.actions.DeleteMultiple([LAArelation.id],context),t("operations.restriction.help.delete")+" "+iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION);clearRestrictionTagEditor(num)}}else{for(var i=0;i<LAArels.length;i++){var LAArelation=LAArels[i];context.perform(iD.actions.DeleteMultiple([LAArelation.id],context),t("operations.restriction.help.delete")+" "+iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION)}for(var j=0;j<restrictionNum;j++){clearRestrictionTagEditor(j+1)}clearRestrictionGroups()}}}function clickDelete(){let entityid=selectWayID;if(!entityid){return}deleteRestriction();let rel=getRelation();context.perform(iD.actions.DeleteMultiple([rel.id],context),t("operations.restriction.help.delete")+" "+relationModelName);clearTagEditor();event.delete({wayid:selectWayID,nodeid:fromNodeID});context.event.entityedite({entitys:[]});fromNodeID=null;surface.selectAll(".selected").classed("selected",false)}function createNewDividerAttribute(wayId,nodeId,modelName){var isDA=modelName==iD.data.DataType.DIVIDER_ATTRIBUTE;if(modelName==iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION){var g=context.graph();var Rentity=null;var node=g.entity(vertexID);var currentRes=null;var laRel=g.parentRelations(node,iD.data.DataType.LANE_ATTRIBUTE).filter(function(r){return r.memberByIdAndRole(selectWayID,iD.data.RoleType.DIVIDER_ID)})[0];if(laRel){var dividerAttributeMember=[{id:laRel.id,modelName:iD.data.DataType.LANE_ATTRIBUTE,role:iD.data.RoleType["LANEA_ID"],type:iD.data.GeomType.RELATION}]}}else{var dividerAttributeMember=[{id:wayId,modelName:iD.data.DataType.DIVIDER,role:iD.data.RoleType.DIVIDER_ID,type:iD.data.GeomType.WAY},{id:nodeId,modelName:iD.data.DataType.DIVIDER_NODE,role:iD.data.RoleType.DIVIDER_NODE_ID,type:iD.data.GeomType.NODE}]}var currentLayer=iD.Layers.getCurrentModelEnableLayer(modelName);var dividerAttributeRelations=iD.Relation({modelName:modelName,members:dividerAttributeMember,layerId:currentLayer.id});dividerAttributeRelations.setTags(iD.util.getDefauteTags(dividerAttributeRelations,currentLayer));var actions=[iD.actions.AddEntity(dividerAttributeRelations)];var way=context.entity(wayId);var oldDirection=way.tags.DIRECTION;actions.push("\u65B0\u589E\u5173\u7CFB");context.perform.apply(context,actions);context.event.entityedite({entitys:[dividerAttributeRelations.id]});return dividerAttributeRelations};function getRelation(modelName,isAdd){var relation=null;if(!selectWayID||!vertexID){return relation}var graph=context.graph();var vertex=graph.entity(vertexID);var way=graph.entity(selectWayID);if(isAdd){var relations=graph.parentRelations(way,relationModelName)}else{var relations=graph.parentRelations(way,relationModelName)}var RAR=getRoleByRealations(relations,vertex,iD.data.RoleType.DIVIDER_NODE_ID);var wayMember,nodeMember,_tempRealtion;if(RAR.exec){_tempRealtion=RAR.relation;if(modelName){var rels=graph.parentRelations(_tempRealtion,iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION);for(var j=0;j<rels.length;j++){if(rels[j].modelName==modelName){relation=rels[j];break}}}else{wayMember=_tempRealtion.memberByIdAndRole(vertexID,iD.data.RoleType.DIVIDER_NODE_ID);nodeMember=_tempRealtion.memberByIdAndRole(selectWayID,iD.data.RoleType.DIVIDER_ID);if(wayMember&&nodeMember){relation=_tempRealtion}}}var modelConfig=iD.Layers.getLayer(way.layerId,way.modelName);if(!relation&&modelConfig.editable||modelName==iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION){if(isAdd){relation=createNewDividerAttribute(selectWayID,vertexID,modelName||relationModelName)}}return relation}function renderTag(){var wrap=selection.selectAll(".preset-input-relation").html("");wrap.append("div").attr("class","relation-tag-editor");if(!selectWayID||!vertexID){clearTagEditor();return}var relation=getRelation();relationID="";if(!relation){return}relationID=relation.id;let tags=_.extend({},relation.tags);wrap.select(".relation-tag-editor").call(rawTagEditor.entityID(relation.id).tags(tags).state(state))}function renderRestrictionTag(res,num,isAdd){var wrap=selection.selectAll(".restrictiongroup_"+num).selectAll(".restriction-input-relation").html("");wrap.append("div").attr("class","relation-tag-editor");var g=context.graph();var way=context.graph().entity(selectWayID);var relation=res||getRelation(iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION,isAdd);if(!relation){return}relationRestrictionIDs.push(relation.id);let tags=_.extend({},relation.tags);if(res){tags.VEHICLE=iD.util._Util._getCarNamesByHexadecimal(tags.VEHICLE||"80000000");tags.TIME=iD.convertGDFToInfo(tags.TIME||"");tags.WEATHER=iD.util._Util._getWeatherTypesByCode(tags.WEATHER)}wrap.select(".relation-tag-editor").call(rawTagEditor.entityID(relation.id).tags(tags).state(state))}function mouseover(){var datum=d3.event.target.__data__;if(datum instanceof iD.geo.Turn){var graph=context.graph(),presets=context.presets(),preset;if(datum.restriction){preset=presets.match(graph.entity(datum.restriction),graph)}else{preset=presets.item("type/restriction/"+iD.geo.inferRestriction(graph.entity(datum.from.node),graph.entity(datum.via.node),graph.entity(datum.to.node),projection))}wrap.selectAll(".restriction-help").text(t("operations.restriction.help."+(datum.restriction?"toggle_off":"toggle_on"),{restriction:preset.name()}))}}function mouseout(){wrap.selectAll(".restriction-help").text(t("operations."+relationModelName+"relation.help."+(fromNodeID?"toggle":"select")))}function render(){if(context.hasEntity(vertexID)&&relationModelName!=iD.data.DataType.LANE_ATTRIBUTE_RESTRICTION){restrictions(selection,true)}}function clearSvg(){selection.selectAll(".preset-input-wrap").html("")}function clearTagEditor(){selection.selectAll(".preset-relation-btns").html("");selection.selectAll(".preset-input-relation").html("");if(1!=restrictionNum){for(let i=0;i<restrictionNum;i++){clearRestrictionTagEditor(i+1)}}clearRestrictionGroups()}function clearRestrictionGroups(){relationRestrictionIDs=[];restrictionGroups=[];restrictionNum=1;selection.selectAll(".restrictiongroups").html("")}function clearRestrictionTagEditor(num){var group=selection.selectAll(".restrictiongroup_"+num);if(group){group.remove()}}}restrictions.entity=function(_){if(!vertexID||vertexID!==_.id){fromNodeID=null;selectWayID=null;relationID=null;vertexID=_.id}};restrictions.tags=function(){};restrictions.focus=function(){};restrictions.change=function(){};restrictions.destroy=function(){rawTagEditor.on("change"+eventNS,null);context.history().on("redone"+eventNS,null).on("undone"+eventNS,null).on("change"+eventNS,null);context.event.on("changeeffect"+eventNS,null);context.event.on("dragbox"+eventNS,null);context.event.on("selected"+eventNS,null);d3.select(window).on("resize"+eventNS,null)};context.event.on("dragbox"+eventNS,function(d){var isself=[iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.DIVIDER_ATTRIBUTE].includes(relationModelName);if(!isself||!d||!d.entity.length||!context.selectedIDs().length){restrictions.destroy()}});context.event.on("selected"+eventNS,function(arr){var isself=[iD.data.DataType.LANE_ATTRIBUTE,iD.data.DataType.DIVIDER_ATTRIBUTE].includes(relationModelName);if(!isself||!arr||!arr.length||!context.selectedIDs().length){restrictions.destroy()}});return d3.rebind(restrictions,event,"on")};;;iD.ui.TagEditorInput.maat=function(context){var event=d3.dispatch("change"),vertexID,fromNodeID;var state="select";var rawTagEditor=iD.ui.RawTagEditor(context).on("change",changeTags);function changeTags(changed){var entity=context.entity(relationID);tags=_.extend({},entity.tags,changed);var msg="\u66F4\u6539"+Object.keys(changed).toString();if(_.isEmpty(changed)){return}var actions_array=[];actions_array.push(iD.actions.ChangeTags(relationID,tags));actions_array.push(msg);context.perform.apply(this,actions_array)}function waysFilter(highways,vertexID){var ways=[];if(!vertexID){return ways}for(var i=0,len=highways.length;i<len;i++){if(highways[i].modelName!=iD.data.DataType.ROAD){continue}if(highways[i].first()==vertexID||highways[i].last()==vertexID){ways.push(highways[i])}}return ways}function restrictions(selection){var wrap=selection.selectAll(".preset-input-wrap").data([0]);var enter=wrap.enter().append("div").attr("class","preset-input-wrap");enter.append("div").attr("class","restriction-help");enter.append("svg").call(iD.svg.Surface(context)).call(iD.behavior.Hover(context));var intersection=iD.geo.maatIntersection(context.graph(),vertexID),graph=intersection.graph,vertex=graph.entity(vertexID),highways=graph.parentWays(vertex);surface=wrap.selectAll("svg"),filter=function(){return true},extent=iD.geo.Extent(),projection=iD.geo.RawMercator(),lines=iD.svg.Lines(projection,context),vertices=iD.svg.Vertices(projection,context),ways=waysFilter(highways,vertexID);maat=iD.svg.Maat(projection,context);var d=wrap.dimensions(),c=[d[0]/2,d[1]/2],z=21;projection.scale(256*Math.pow(2,z)/(2*Math.PI));var s=projection(vertex.loc);projection.translate([c[0]-s[0],c[1]-s[1]]).clipExtent([[0,0],d]);surface.call(vertices,graph,[vertex],filter,extent,z).call(lines,graph,ways,filter).call(maat,graph,intersection.turns(fromNodeID));surface.on("click.restrictions",click).on("mouseover.restrictions",mouseover).on("mouseout.restrictions",mouseout);surface.selectAll(".selected").classed("selected",false);if(fromNodeID){surface.selectAll("."+_.find(ways,function(way){return way.contains(fromNodeID)}).id).classed("selected",true)}mouseout();context.history().on("change.restrictions",render);d3.select(window).on("resize.restrictions",render);function click(){var datum=d3.event.target.__data__;if(datum instanceof iD.Way){fromNodeID=datum.nodes[datum.first()===vertexID?1:datum.nodes.length-2];render();selection.selectAll(".preset-input-relation").remove()}else if(datum instanceof iD.geo.Maat){var id;if(datum.restriction){id=datum.restriction}else{id=createNewDividerAttribute(datum).id}renderTag(id)}}function renderTag(id){var wrap=selection.selectAll(".preset-input-relation").data([0]);if(!id||!vertexID){wrap.remove();return}var enter=wrap.enter().append("div").attr("class","preset-input-relation");enter.append("div").attr("class","relation-tag-editor");var relation=context.graph().entity(id);relationID="";if(!relation){return}relationID=relation.id;let tags=_.extend({},relation.tags);wrap.select(".relation-tag-editor").call(rawTagEditor.entityID(relation.id).tags(tags).state(state))}function mouseover(){var datum=d3.event.target.__data__;if(datum instanceof iD.geo.Maat){var graph=context.graph(),presets=context.presets(),preset;if(datum.restriction){preset=presets.match(graph.entity(datum.restriction),graph)}else{preset=presets.item("type/restriction/"+iD.geo.inferRestriction(graph.entity(datum.from.node),graph.entity(datum.via.node),graph.entity(datum.to.node),projection))}wrap.selectAll(".restriction-help").text(t("operations.restriction.help."+(datum.restriction?"toggle_off":"toggle_on"),{restriction:preset.name()}))}}function mouseout(){wrap.selectAll(".restriction-help").text(t("operations.restriction.help."+(fromNodeID?"toggle":"select")))}function render(){if(context.hasEntity(vertexID)){restrictions(selection)}}}restrictions.entity=function(_){if(!vertexID||vertexID!==_.id){fromNodeID=null;vertexID=_.id}};restrictions.available=function(entity){return entity.modelName=iD.data.DataType.ROAD_NODE};restrictions.tags=function(){};restrictions.focus=function(){};function createNewDividerAttribute(datum){var dividerAttributeMember=[{id:datum.from.way,modelName:iD.data.DataType.ROAD,role:iD.data.RoleType.FROAD_ID,type:iD.data.GeomType.WAY},{id:datum.via.node,modelName:iD.data.DataType.ROAD_NODE,role:iD.data.RoleType.ROAD_NODE_ID,type:iD.data.GeomType.NODE},{id:datum.to.way,modelName:iD.data.DataType.ROAD,role:iD.data.RoleType.TROAD_ID,type:iD.data.GeomType.WAY}];var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.NODECONN);var dividerAttributeRelations=iD.Relation({modelName:iD.data.DataType.NODECONN,members:dividerAttributeMember,layerId:currentLayer.id});dividerAttributeRelations.setTags(iD.util.getDefauteTags(dividerAttributeRelations,currentLayer));context.perform(iD.actions.AddEntity(dividerAttributeRelations),"\u65B0\u589E\u5173\u7CFB");return dividerAttributeRelations}return d3.rebind(restrictions,event,"on")};;;iD.ui.TagEditorInput.check=function(field){var event=d3.dispatch("change"),options=field.strings&&field.strings.options,values=[],texts=[],value,box,text,label;if(field.fieldModel&&field.fieldModel.fieldInput&&field.fieldModel.fieldInput.values){var fVals=field.fieldModel.fieldInput.values;values=_.pluck(fVals,"value");texts=_.pluck(fVals,"name")}else if(options){for(var k in options){values.push("undefined"===k?undefined:k);texts.push(field.t("options."+k,{default:options[k]}))}}else{values=[undefined,"yes"];texts=[t("inspector.unknown"),t("inspector.check.yes")];if("check"===field.type){values.push("no");texts.push(t("inspector.check.no"))}}var check=function(selection){selection.classed("checkselect","true");label=selection.selectAll(".preset-input-wrap").data([0]);var enter=label.enter().append("label").attr("class","preset-input-wrap");enter.append("input").attr("type","checkbox").attr("id","preset-input-"+field.id);enter.append("span").text(texts[0]).attr("class","value");box=label.select("input").on("click",function(){var t={};t[field.key]=values[(values.indexOf(value)+1)%values.length];event.change(t);d3.event.stopPropagation()});text=label.select("span.value")};check.tags=function(tags){value=tags[field.key];box.property("indeterminate",!value);box.property("checked","yes"===value||"1"===value);text.text(texts[values.indexOf(value)]);label.classed("set",!!value)};check.focus=function(){box.node().focus()};check.change=function(t){var t="undefined"!=typeof t?_.extend({},t):{};event.change(t)};check.readOnly=function(readonly){box.call(iD.ui.TagEditor.readOnly,readonly);label.call(iD.ui.TagEditor.readOnly,readonly)};check.disable=function(disable){box.call(iD.ui.TagEditor.disable,disable);label.call(iD.ui.TagEditor.disable,disable)};return d3.rebind(check,event,"on")};;;iD.ui.TagEditorInput.select=function(field){var event=d3.dispatch("change"),select,allOptionList=[];function i(selection,opts){select=selection.selectAll("select").data([0]);select.enter().append("select");var fieldModel=opts.fieldModel;var optionData=[];if("radio"==fieldModel.fieldInput){let kvs=fieldModel.fieldType&&fieldModel.fieldType.fieldTypeValues||[];for(let i in kvs){optionData.push({name:kvs[i].name,value:kvs[i].value})}}else{optionData=_.clone(fieldModel.fieldInput.values)}optionData.unshift({name:"==\u8BF7\u9009\u62E9==",value:""});allOptionList=optionData;refreshOption(opts.tags||{});select.on("blur",change).on("change",change)}function change(t){var t="undefined"!=typeof t?_.extend({},t):{};t[field.key]=select.value()||undefined;event.change(t)}i.readOnly=function(readonly){select.call(iD.ui.TagEditor.readOnly,readonly)};i.disable=function(disable){select.call(iD.ui.TagEditor.disable,disable)};i.tags=function(tags){var v=tags[field.key]||"";if("NULL"==v)v="";select.value(v)};i.focus=function(){select.trigger("focus")};i.change=function(){select.trigger("change")};i.refreshOption=refreshOption;function refreshOption(tags,func){var optionList=_.cloneDeep(allOptionList);var fieldModel=field.fieldModel;if(func instanceof Function){optionList=func(optionList,tags)}else if(fieldModel.optionFilter instanceof Function){optionList=fieldModel.optionFilter(optionList,tags)}var oldVal=select.value();var newVals=_.pluck(optionList,"value");var options=select.selectAll("option").data(optionList);options.enter().append("option");options.attr("value",function(o){return o.value}).attr("title",function(o){return o.name}).text(function(o){return o.name});options.exit().remove();if(!_.include(newVals,oldVal)){select.value(newVals[0]||"0")}if(tags[field.key]==undefined){tags[field.key]=select.value()}}return d3.rebind(i,event,"on")};;;iD.ui.TagEditorInput.mulselect=function(field){var event=d3.dispatch("change"),selectMuls=[],fieldModel;var mulPoiTypeList;var mulSplitReg=/\B(?=(?:\d{2})+\b)/g;function func(selection,opts){fieldModel=opts.fieldModel;mulPoiTypeList=iD.util.getTagMulDatas_POI_TYPE(fieldModel.fieldInput.values||[]);let $selects=selection.selectAll("select").data([0,1,2]);$selects.enter().append("select");var nowValue=opts.tags[field.key]||fieldModel.value||fieldModel.defaultValue||"";$selects.each(function(selectIndex){selectMuls[selectIndex]=d3.select(this)}).each(function(){refreshSelectOptions(d3.select(this),nowValue)});$selects.on("change",selectMulsChange);function selectMulsChange(){var $this=d3.select(this);var sidx=$this.datum();var maxIdx=selectMuls.length-1;if(sidx<maxIdx){let _count=0;for(let i=sidx;i<maxIdx;i++){_count++;refreshSelectOptions(selectMuls[sidx+_count])}change.call(this)}else if(sidx==maxIdx){change.call(this)}}}function change(t){var t="undefined"!=typeof t?_.extend({},t):{};if(0<selectMuls.length){t[field.key]=selectMuls[selectMuls.length-1].value()||undefined}event.change(t)}function refreshSelectOptions($select,newValue){let sidx=$select.datum();let optionData=[{name:"==\u8BF7\u9009\u62E9==",value:""}];optionData=optionData.concat(_.values(getOptionsBySelectIndex(sidx)));let prevVals=[];if(sidx==selectMuls.length-1){for(let i=0;i<sidx;i++){let prev=selectMuls[i].value();prevVals.push(prev)}}selectMuls.slice(sidx,selectMuls.length).forEach(function(select){let selectDom=select.node();if(selectDom.options.length){select.html(selectDom.options[0].outerHTML)}select.node().value=""});var $options=$select.selectAll("option").data(optionData);$options.enter().append("option").attr("value",function(o){return o.value&&prevVals.join("")+o.value||o.value}).attr("title",function(o){return o.name}).text(function(o){return o.name});$options.exit().remove();if(newValue!=undefined){let nowVals=newValue.split(mulSplitReg);if(0<nowVals.length){$select.node().value=prevVals.join("")+(nowVals[sidx]||"")}}else{if(1<$options.size()){$select.node().value=d3.select($options[0][1]).attr("value")}else{$select.node().value=""}}}function getOptionsBySelectIndex(index){if(0==index){return mulPoiTypeList}else{let result=mulPoiTypeList;for(let i=0;i<index;i++){let prev=selectMuls[i].value();result=result[prev]&&result[prev].children||[]}return result}}func.readOnly=function(readonly){selectMuls.forEach(function(select,idx){select.call(iD.ui.TagEditor.readOnly,readonly)})};func.disable=function(disable){selectMuls.forEach(function(select,idx){select.call(iD.ui.TagEditor.disable,disable)})};func.tags=function(tags){var values=(tags[field.key]||"").split(mulSplitReg);selectMuls.forEach(function(select,idx){let val=values[idx];if(!val){return}if(idx==selectMuls.length-1){select.value(values.join(""))}else{select.value(val)}})};func.focus=function(){selectMuls.forEach(function(select,idx){select.node().focus()})};func.change=function(){selectMuls[selectMuls.length-1].node().change()};return d3.rebind(func,event,"on")};;;iD.ui.TagEditorInput.selectgroup=function(field){var event=d3.dispatch("change"),select,$value,$valueWrap,allOptionList=[],optionMap={},fieldLinkGroup=[];function i(selection,opts){select=selection.selectAll("select").data([0]);select.enter().append("select").attr("class","tpl_input_selectgroup");$valueWrap=selection.selectAll("div.tpl_selectgroup_values").data([0]);$value=$valueWrap.enter().append("div").attr("class","tpl_selectgroup_values tpl-dropdown").append("a").attr("class","tpl_value");var fieldModel=opts.fieldModel;var fieldTpl=opts.fieldTpl;fieldLinkGroup=fieldTpl.fieldLinkGroup||[];var optionData=_.cloneDeep(fieldModel.fieldInput.values);optionData.forEach(d=>{d.key=field.key});optionMap=_.zipObject(_.pluck(optionData,"id"),optionData);allOptionList.push(...optionData);_.each(fieldTpl.fieldLinkGroup,function(fieldName){var fm=opts.fields[fieldName];if(!fm||!fm.fieldInput)return;var optionList=_.cloneDeep(fm.fieldInput.values);optionList.forEach(d=>{d.key=fieldName});_.extend(optionMap,_.zipObject(_.pluck(optionList,"id"),optionList));allOptionList.push(...optionList)});refreshOption(opts.tags||{});select.on("blur",change).on("change",change);$value.on("click.tpl_selectgroup",function(){if(select.property("readOnly")||select.property("disabled")||select.classed("readonly")||select.classed("disabled")){$valueWrap.classed("open",false);return false}$valueWrap.classed("open",!$valueWrap.classed("open"));return false});$(selection.node()).parent().off("mouseleave").on("mouseleave",function(){$valueWrap.classed("open",false);return false});$valueWrap.selectAll("li").on("click",function(){var d=this.__data__;if(!d)return;var tags=getTagsById(d.id);console.log("\u70B9\u51FB\u83DC\u5355",tags);$valueWrap.classed("open",false);$valueWrap.selectAll(".open").classed("open",false);i.tags(tags);i.change();d3.event.stopPropagation();return false});var $jwrap=$($valueWrap.node());$jwrap.find("li").off("mouseenter mouseleave").hover(function(){var $this=$(this);$this.addClass("open").find("li").removeClass("open");var $menu=$this.children("ul.tpl-dropdown-menu");var offset=$this.offset();$menu.css({position:"fixed",left:offset.left+$this.outerWidth(),top:offset.top-$menu.outerHeight()/2})},function(){var $this=$(this);$this.removeClass("open").find("li").removeClass("open")})}function change(t){var t=getSelectedTags();event.change(t)}i.readOnly=function(readonly){$valueWrap.classed("open",false);select.call(iD.ui.TagEditor.readOnly,readonly)};i.disable=function(disable){$valueWrap.classed("open",false);select.call(iD.ui.TagEditor.disable,disable)};i.tags=function(tags){$valueWrap.classed("open",false);select.node().value=getOptionValueByTags(tags);updateDisplayText()};i.focus=function(){$valueWrap.classed("open",false);select.trigger("focus")};i.change=function(){$valueWrap.classed("open",false);select.trigger("change")};i.refreshOption=refreshOption;function refreshOption(tags,func){$valueWrap.classed("open",false);var optionList=_.cloneDeep(allOptionList);var fieldModel=field.fieldModel;if(func instanceof Function){optionList=func(optionList,tags)}else if(fieldModel.optionFilter instanceof Function){optionList=fieldModel.optionFilter(optionList,tags)}var oldVal=select.value();var options=select.selectAll("option").data(optionList);options.enter().append("option");options.attr("value",function(o){return getOptionValueByData(o)}).attr("title",function(o){return o.name}).text(function(o){return o.name});options.exit().remove();var newVals=_.pluck(select.node().options,"value");var menuData=_.groupBy(rootOpts,function(o){return o.parentId||"delete"});delete menuData["delete"];var rootOpts=filterOptionByKey(optionList,field.key);var $menuWrap=renderMenu($valueWrap,rootOpts);for(let fieldName of fieldLinkGroup){var subOpts=filterOptionByKey(optionList,fieldName);$menuWrap=renderSubMenu($menuWrap,subOpts)}if(!_.include(newVals,oldVal)){select.node().value=getOptionValueByTags(tags)}if(tags[field.key]==undefined){_.extend(tags,getSelectedTags())}updateDisplayText()}function getOptionValueByData(o){var list=getTagDataById(o.id,true);var vals=_.map(list,function(d){return d.key+d.value});return vals.join("")}function getOptionValueByTags(tags){var keyList=[field.key].concat(fieldLinkGroup);var result="";for(var i=0;i<keyList.length;i++){var fieldName=keyList[i];if(null==tags[fieldName]||""==tags[fieldName])continue;v=tags[fieldName];result+=fieldName+v}return result}function filterOptionByKey(optionList,fieldName){return optionList.filter(o=>{return o.key==fieldName})}function renderMenu($wrap,dataList){var fieldName=dataList[0].key;var $menuWrap=$wrap.selectAll("ul.tpl-dropdown-menu").data([0]);$menuWrap.enter().append("ul").attr("class","tpl-dropdown-menu").attr("data-field",fieldName).selectAll("li").data(dataList).enter().append("li").append("span").text(function(d){return d.name}).attr("title",function(d){return d.name});return $menuWrap}function renderSubMenu($wrap,dataList){var fieldName=dataList[0].key;var menuData=_.groupBy(dataList,function(o){return o.parentId||"delete"});delete menuData["delete"];$wrap.selectAll("li").each(function(){var $li=d3.select(this);var parent=$li.datum();if(!parent){return}var sublist=menuData[parent.id];if(!sublist||!sublist.length){return}$li.classed("tpl-dropdown",true);var $menuWrap=$li.selectAll("ul.optiongroup-menu").data([0]);$menuWrap.enter().append("ul").attr("class","tpl-dropdown-menu").attr("data-field",fieldName).selectAll("li").data(sublist).enter().append("li").append("span").text(function(d){return d.name}).attr("title",function(d){return d.name})});var $menuWrap=$wrap.selectAll("ul[data-field="+fieldName+"]");return $menuWrap}function updateDisplayText(){$value.text(getSelectedText())}function getSelectedText(){var defVal="\u8BF7\u9009\u62E9...";var selected=select.node().selectedOptions;if(!selected||!selected.length){return defVal}var d=selected[0].__data__;var list=getTagDataById(d.id,true);return _.pluck(list,"name").join(",")||defVal}function getTagDataById(id,reverse){function _fun(id,_tmpList){var list=_tmpList||[];var d=optionMap[id];if(!d.parentId){list.push(d);return list}list.push(d);_fun(d.parentId,list)||[];return list}var result=_fun(id);result.reverse();return result}function getSelectedTags(linked=true){var selected=select.node().selectedOptions;if(!selected||!selected.length){return{}}var d=selected[0].__data__;if(linked){return getLinkTagsById(d.id)}return getTagsById(d.id)}function getTagsById(id){var d=optionMap[id];if(!d.parentId){return{[d.key]:d.value}}var tags=getTagsById(d.parentId)||{};tags[d.key]=d.value;return tags}function getLinkTagsById(id){var tags=getTagsById(id);for(let fieldName of fieldLinkGroup){tags[fieldName]=tags[fieldName]||""}return tags}return d3.rebind(i,event,"on")};;;iD.ui.TagEditorInput.selectgroup2=function(field){var render=iD.ui.TagEditorInput.selectgroup(field);function i(selection,opts){render.call(this,selection,opts);var $wrap=selection.select(".tpl_selectgroup_values");$wrap.classed("list-show",true)}_.extend(i,render);return i};;;iD.ui.TagEditorInput.combo=function(field){var event=d3.dispatch("change"),optstrings=field.strings&&field.strings.options,optarray=field.options,strings={},input;var combobox=d3.combobox();function combo(selection){input=selection.selectAll("input").data([0]);var enter=input.enter().append("input").attr("type","text").attr("id","preset-input-"+field.id);if(optstrings){enter.attr("readonly","readonly")}input.call(combobox).on("change",change).on("blur",change).on("mousedown",function(){var mousedownFunc=d3.select(this.parentNode).selectAll(".combobox-caret").on("mousedown");if(mousedownFunc){mousedownFunc()}}).each(function(){if(optstrings){_.each(optstrings,function(v,k){strings[k]=v});stringsLoaded()}else if(optarray){_.each(optarray,function(k){strings[k]=k.replace(/_+/g," ")});stringsLoaded()}else{iD.taginfo().values({key:field.key},function(err,data){if(!err){_.each(_.pluck(data,"value"),function(k){strings[k]=k.replace(/_+/g," ")});stringsLoaded()}})}});function stringsLoaded(){var keys=_.keys(strings),strs=[],placeholders;combobox.data(keys.map(function(k){var s=strings[k],o={};o.title=o.value=s;if(20>s.length){strs.push(s)}return o}));placeholders=1<strs.length?strs:keys;input.attr("placeholder",field.placeholder()||placeholders.slice(0,3).join(", ")+"...")}}function change(){var optstring=_.find(_.keys(strings),function(k){return strings[k]===input.value()}),value=optstring||input.value().split(";").map(function(s){return s.trim()}).join(";").replace(/\s+/g,"_");if("typeCombo"===field.type&&!value)value="yes";var t={};t[field.key]=value||undefined;var eventSrcType=null;if(d3.event.srcElement.hasAttribute("data-eventSrc")){var element=d3.event.srcElement;eventSrcType=element.getAttribute("data-eventSrc");element.removeAttribute("data-eventSrc")}event.change(t,eventSrcType)}combo.tags=function(tags){var key=tags[field.key],value=strings[key]||key||"";if("typeCombo"===field.type&&"yes"===value.toLowerCase())value="";input.value(value)};combo.focus=function(){input.node().focus()};combo.change=function(t){var t="undefined"!=typeof t?_.extend({},t):{};event.change(t)};combo.readOnly=function(readonly){input.property("disabled",!!readonly).classed("no-pointer-events readonly",!!readonly)};combo.disable=function(readonly){input.style("opacity",!!readonly?"0.5":"1");input.property("disabled",!!readonly).classed("disabled",!!readonly)};return d3.rebind(combo,event,"on")};;;iD.ui.TagEditor.RoadTagEditor=function(context){var dispatch=d3.dispatch("change");function roadTagEditor(selection,opts){var tpl=iD.ui.TagEditorTpl.Road(),tags=opts.tags,entityID=opts.id,entity=context.entity(entityID),currentLayer=iD.Layers.getLayer(entity.layerId),modelEntity=iD.ModelEntitys[entity.modelName],geoType=modelEntity.getGeoType();var fields=modelEntity.getFields(geoType);tpl.fieldsGroup[0].fields=iD.ui.TagEditor.createTplFieldList(modelEntity);var fieldHash={};for(var i=0,len=fields.length;i<len;i++){fieldHash[fields[i].fieldName]=fields[i]}context.container().select(".KDSEditor-inspector-wrap  .KDSEditor-header h3").text(tpl.title);iD.ui.TagEditor.renderFieldGroups(selection,tpl,{layer:currentLayer,dispatch:dispatch,context:context,entity:entity,tags:tags,fields:fieldHash})}roadTagEditor.available=function(entity){return entity instanceof iD.Way&&entity.modelName===iD.data.DataType.ROAD};var noDisplayFields=["","datatype"];function renderOtherFiels(selection,tpl,opts){var preset_form=d3.select(selection[0][0].parentNode);var tags=opts.tags;var fields=opts.fields;var otherFields=[];_.forEach(fields,function(v,k){if(!fieldInTpl(k,tpl)){var field={};field.fieldName=v.fieldName;field.fieldTitle=v.fieldTitle;if(""==v.fieldTitle){field.fieldTitle=v.fieldName}if(_.isObject(v.fieldInput)){var inputObjArray=v.fieldInput;var value=v.value;_.forEach(inputObjArray.values,function(v,i){if(v.value==value){field.fieldValue=v.name}})}else{field.fieldValue=tags[v.fieldName]}var inNoDisplayFlag=0<=noDisplayFields.indexOf(field.fieldName)?true:false;if(!inNoDisplayFlag){otherFields.push(field)}}});var div_wrapper=preset_form.selectAll("div.dropdown-maker").data([0]);var wraper=div_wrapper.enter().append("div").classed("roadTag-wrapper",true).classed("dropdown-maker",true).classed("close",true).on("click",function(){if(0<d3.select(this).attr("class").indexOf("close")){d3.select(this).classed("close",false)}else{d3.select(this).classed("close",true)}});wraper.append("div").classed("head",true).text("\u6D4F\u89C8\u5168\u90E8\u5C5E\u6027");var wraper_body=div_wrapper.selectAll("div.body").data([0]);wraper_body.enter().append("div").classed("body",true).on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault()});div_wrapper.classed("hide",function(){return"select"!=context.mode().id});var update=wraper_body.selectAll("div.body div.attr").data(otherFields,function(d,i){return d.fieldName});var enter=update.enter();var exit=update.exit();var divItem=enter.append("div").attr("class","attr clearfix");divItem.append("div").text(function(d,i){return d.fieldTitle}).attr({class:"left"}).attr("title",function(d,i){return d.fieldTitle});divItem.append("div").attr("class","right");wraper_body.selectAll("div.attr .right").data(otherFields,function(d,i){return d.fieldName}).text(function(d,i){return d.fieldValue});exit.remove()}function fieldInTpl(fieldName,tpl){var isTplflag=false;var fieldGroup=tpl.fieldsGroup;for(var i=0;i<fieldGroup.length;i++){var fieldObj=fieldGroup[i];_.forIn(fieldObj.fields,function(v,i){if(v.fieldName==fieldName){isTplflag=true}})}return isTplflag}return d3.rebind(roadTagEditor,dispatch,"on")};;;iD.ui.TagEditor.RoadNodeTagEditor=function(context){var dispatch=d3.dispatch("change");function roadNodeTagEditor(selection,opts){var tpl=iD.ui.TagEditorTpl.RoadNode(),tags=opts.tags,entityID=opts.id,entity=context.entity(entityID),currentLayer=iD.Layers.getLayer(entity.layerId),modelEntity=iD.ModelEntitys[entity.modelName],geoType=modelEntity.getGeoType();var fields=modelEntity.getFields(geoType);tpl.fieldsGroup[0].fields=iD.ui.TagEditor.createTplFieldList(modelEntity);var fieldHash={};for(var i=0,len=fields.length;i<len;i++){fieldHash[fields[i].fieldName]=fields[i]}context.container().select(".KDSEditor-inspector-wrap  .KDSEditor-header h3").text(tpl.title);iD.ui.TagEditor.renderFieldGroups(selection,tpl,{layer:currentLayer,dispatch:dispatch,context:context,entity:entity,tags:tags,fields:fieldHash})}roadNodeTagEditor.available=function(entity){return entity.isRoadNode&&entity.isRoadNode()};var noDisplayFields=["","datatype"];function renderOtherFiels(selection,tpl,opts){var preset_form=d3.select(selection[0][0].parentNode);var tags=opts.tags;var fields=opts.fields;var otherFields=[];_.forEach(fields,function(v,k){if(!fieldInTpl(k,tpl)){var field={};field.fieldName=v.fieldName;field.fieldTitle=v.fieldTitle;if(""==v.fieldTitle){field.fieldTitle=v.fieldName}if(_.isObject(v.fieldInput)){var inputObjArray=v.fieldInput;var value=v.value;_.forEach(inputObjArray.values,function(v,i){if(v.value==value){field.fieldValue=v.name}})}else{field.fieldValue=tags[v.fieldName]}var inNoDisplayFlag=0<=noDisplayFields.indexOf(field.fieldName)?true:false;if(!inNoDisplayFlag){otherFields.push(field)}}});var div_wrapper=preset_form.selectAll("div.dropdown-maker").data([0]);var wraper=div_wrapper.enter().append("div").classed("roadTag-wrapper",true).classed("dropdown-maker",true).classed("close",true).on("click",function(){if(0<d3.select(this).attr("class").indexOf("close")){d3.select(this).classed("close",false)}else{d3.select(this).classed("close",true)}});wraper.append("div").classed("head",true).text("\u6D4F\u89C8\u5168\u90E8\u5C5E\u6027");var wraper_body=div_wrapper.selectAll("div.body").data([0]);wraper_body.enter().append("div").classed("body",true).on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault()});div_wrapper.classed("hide",function(){return"select"!=context.mode().id});var update=wraper_body.selectAll("div.body div.attr").data(otherFields,function(d,i){return d.fieldName});var enter=update.enter();var exit=update.exit();var divItem=enter.append("div").attr("class","attr clearfix");divItem.append("div").text(function(d,i){return d.fieldTitle}).attr("class","left");divItem.append("div").attr("class","right");wraper_body.selectAll("div.attr .right").data(otherFields,function(d,i){return d.fieldName}).text(function(d,i){return d.fieldValue});exit.remove()}function fieldInTpl(fieldName,tpl){var isTplflag=false;var fieldGroup=tpl.fieldsGroup;for(var i=0;i<fieldGroup.length;i++){var fieldObj=fieldGroup[i];_.forIn(fieldObj.fields,function(v,i){if(v.fieldName==fieldName){isTplflag=true}})}return isTplflag}return d3.rebind(roadNodeTagEditor,dispatch,"on")};;;iD.ui.TagEditor.RoadCrossTagEditor=function(context){var dispatch=d3.dispatch("change");function roadCrossTagEditor(selection,opts){var tpl=iD.ui.TagEditorTpl.RoadCross(),tags=opts.tags,entityID=opts.id,entity=context.entity(entityID),currentLayer=iD.Layers.getLayer(entity.layerId),modelEntity=iD.ModelEntitys[entity.modelName],geoType=modelEntity.getGeoType();if(currentLayer.isRoad()&&currentLayer.typeModelEntity){var _datatype=tags["datatype"]||"";var typeModelEntity=currentLayer.typeModelEntity()[_datatype];if(typeModelEntity){geoType=typeModelEntity.modelId;modelEntity=typeModelEntity.model}else{geoType=""}}var fields=modelEntity.getFields(geoType);tpl.fieldsGroup[0].fields=iD.ui.TagEditor.createTplFieldList(modelEntity);var fieldHash={};for(var i=0,len=fields.length;i<len;i++){fieldHash[fields[i].fieldName]=fields[i]}context.container().select(".KDSEditor-inspector-wrap  .KDSEditor-header h3").text(tpl.title);iD.ui.TagEditor.renderFieldGroups(selection,tpl,{layer:currentLayer,dispatch:dispatch,context:context,entity:entity,tags:tags,fields:fieldHash})}roadCrossTagEditor.available=function(entity){return entity.isRoadCross&&entity.isRoadCross()};var noDisplayFields=["","datatype"];function renderOtherFiels(selection,tpl,opts){var preset_form=d3.select(selection[0][0].parentNode);var tags=opts.tags;var fields=opts.fields;var otherFields=[];_.forEach(fields,function(v,k){if(!fieldInTpl(k,tpl)&&""!=v.fieldTitle){var field={};field.fieldName=v.fieldName;field.fieldTitle=v.fieldTitle;if(""==v.fieldTitle){field.fieldTitle=v.fieldName}if(_.isObject(v.fieldInput)){var inputObjArray=v.fieldInput;var value=v.value;_.forEach(inputObjArray.values,function(v,i){if(v.value==value){field.fieldValue=v.name}})}else{field.fieldValue=tags[v.fieldName]}var inNoDisplayFlag=0<=noDisplayFields.indexOf(field.fieldName)?true:false;if(!inNoDisplayFlag){otherFields.push(field)}}});var div_wrapper=preset_form.selectAll("div.dropdown-maker").data([0]);var wraper=div_wrapper.enter().append("div").classed("roadTag-wrapper",true).classed("dropdown-maker",true).classed("close",true).on("click",function(){if(0<d3.select(this).attr("class").indexOf("close")){d3.select(this).classed("close",false)}else{d3.select(this).classed("close",true)}});wraper.append("div").classed("head",true).text("\u6D4F\u89C8\u5168\u90E8\u5C5E\u6027");var wraper_body=div_wrapper.selectAll("div.body").data([0]);wraper_body.enter().append("div").classed("body",true).on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault()});div_wrapper.classed("hide",function(){return"select"!=context.mode().id});var update=wraper_body.selectAll("div.body div.attr").data(otherFields,function(d,i){return d.fieldName});var enter=update.enter();var exit=update.exit();var divItem=enter.append("div").attr("class","attr clearfix");divItem.append("div").text(function(d,i){return d.fieldTitle}).attr("class","left");divItem.append("div").attr("class","right");wraper_body.selectAll("div.attr .right").data(otherFields,function(d,i){return d.fieldName}).text(function(d,i){return d.fieldValue});exit.remove()}function fieldInTpl(fieldName,tpl){var isTplflag=false;var fieldGroup=tpl.fieldsGroup;for(var i=0;i<fieldGroup.length;i++){var fieldObj=fieldGroup[i];_.forIn(fieldObj.fields,function(v,i){if(v.fieldName==fieldName){isTplflag=true}})}return isTplflag}return d3.rebind(roadCrossTagEditor,dispatch,"on")};;;iD.ui.TagEditor.DividerNodeTagEditor=function(context){var dispatch=d3.dispatch("change");function walkEnterTagEditor(selection,opts){var tags=opts.tags,entityID=opts.id,entity=context.entity(entityID),currentLayer=iD.Layers.getLayer(entity.layerId),modelEntity=iD.ModelEntitys[entity.modelName],geoType=modelEntity.getGeoType();var fields=modelEntity.getFields(geoType);var fieldHash={};for(var i=0,len=fields.length;i<len;i++){fieldHash[fields[i].fieldName]=fields[i]}context.container().select(".KDSEditor-inspector-wrap  .KDSEditor-header h3").text(tpl.title);iD.ui.TagEditor.renderFieldGroups(selection,tpl,{layer:currentLayer,dispatch:dispatch,context:context,entity:entity,tags:tags,fields:fieldHash});renderOtherFiels(selection,tpl,{tags:tags,fields:fieldHash})}walkEnterTagEditor.available=function(entity){return entity instanceof iD.Node&&entity.modelName===iD.data.DataType.DIVIDER_NODE};function renderOtherFiels(selection,tpl,opts){var preset_form=d3.select(selection[0][0].parentNode);var tags=opts.tags;var fields=opts.fields;var otherFields=[];_.forEach(fields,function(v,k){if(!fieldInTpl(k,tpl)){var field={};field.fieldName=v.fieldName;field.fieldTitle=v.fieldTitle;if(""==v.fieldTitle){field.fieldTitle=v.fieldName}if(_.isObject(v.fieldInput)){var inputObjArray=v.fieldInput;var value=v.value;_.forEach(inputObjArray.values,function(v,i){if(v.value==value){field.fieldValue=v.name}})}else{field.fieldValue=tags[v.fieldName]}otherFields.push(field)}});var div_wrapper=preset_form.selectAll("div.dropdown-maker").data([0]);var wraper=div_wrapper.enter().append("div").classed("roadTag-wrapper",true).classed("dropdown-maker",true).classed("close",true).on("click",function(){if(0<d3.select(this).attr("class").indexOf("close")){d3.select(this).classed("close",false)}else{d3.select(this).classed("close",true)}});wraper.append("div").classed("head",true).text("\u6D4F\u89C8\u5168\u90E8\u5C5E\u6027");var wraper_body=div_wrapper.selectAll("div.body").data([0]);wraper_body.enter().append("div").classed("body",true).on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault()});div_wrapper.classed("hide",function(){return"select"!=context.mode().id});var update=wraper_body.selectAll("div.body div.attr").data(otherFields,function(d,i){return d.fieldName});var enter=update.enter();var exit=update.exit();var divItem=enter.append("div").attr("class","attr clearfix");divItem.append("div").text(function(d,i){return d.fieldTitle}).attr("class","left");divItem.append("div").attr("class","right");wraper_body.selectAll("div.attr .right").data(otherFields,function(d,i){return d.fieldName}).text(function(d,i){return d.fieldValue});exit.remove()}function fieldInTpl(fieldName,tpl){return true;var isTplflag=false;var fieldGroup=tpl.fieldsGroup;for(var i=0;i<fieldGroup.length;i++){var fieldObj=fieldGroup[i];_.forIn(fieldObj.fields,function(v,i){if(v.fieldName==fieldName){isTplflag=true}})}return isTplflag}return d3.rebind(walkEnterTagEditor,dispatch,"on")};;;iD.ui.TagEditor.PoiTagEditor=function(context){var dispatch=d3.dispatch("change");function poiTagEditor(selection,opts){var tpl=iD.ui.TagEditorTpl.Poi(),tags=opts.tags,entityID=opts.id,entity=context.entity(entityID),currentLayer=iD.Layers.getLayer(entity.layerId),modelEntity=iD.ModelEntitys[entity.modelName],geoType=modelEntity.getGeoType();var fields=modelEntity.getFields(geoType);tpl.fieldsGroup[0].fields=iD.ui.TagEditor.createTplFieldList(modelEntity);var fieldHash={};for(var i=0,len=fields.length;i<len;i++){fieldHash[fields[i].fieldName]=fields[i]}context.container().select(".KDSEditor-inspector-wrap  .KDSEditor-header h3").text(tpl.title);iD.ui.TagEditor.renderFieldGroups(selection,tpl,{layer:currentLayer,dispatch:dispatch,context:context,entity:entity,tags:tags,fields:fieldHash});renderOtherFiels(selection,tpl,{tags:tags,fields:fieldHash})}poiTagEditor.available=function(entity){return entity.modelName==iD.data.DataType.POI};var noDisplayFields=["","datatype"];function renderOtherFiels(selection,tpl,opts){var preset_form=d3.select(selection[0][0].parentNode);var tags=opts.tags;var fields=opts.fields;var otherFields=[];_.forEach(fields,function(v,k){if(!fieldInTpl(k,tpl)){var field={};field.fieldName=v.fieldName;field.fieldTitle=v.fieldTitle;if(""==v.fieldTitle){field.fieldTitle=v.fieldName}if(_.isObject(v.fieldInput)){var inputObjArray=v.fieldInput;var value=v.value;_.forEach(inputObjArray.values,function(v,i){if(v.value==value){field.fieldValue=v.name}})}else{field.fieldValue=tags[v.fieldName]}var inNoDisplayFlag=0<=noDisplayFields.indexOf(field.fieldName)?true:false;if(!inNoDisplayFlag){otherFields.push(field)}}});var div_wrapper=preset_form.selectAll("div.dropdown-maker").data([0]);var wraper=div_wrapper.enter().append("div").classed("roadTag-wrapper",true).classed("dropdown-maker",true).classed("close",true).on("click",function(){if(0<d3.select(this).attr("class").indexOf("close")){d3.select(this).classed("close",false)}else{d3.select(this).classed("close",true)}});wraper.append("div").classed("head",true).text("\u6D4F\u89C8\u5168\u90E8\u5C5E\u6027");var wraper_body=div_wrapper.selectAll("div.body").data([0]);wraper_body.enter().append("div").classed("body",true).on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault()});div_wrapper.classed("hide",function(){return"select"!=context.mode().id});var update=wraper_body.selectAll("div.body div.attr").data(otherFields,function(d,i){return d.fieldName});var enter=update.enter();var exit=update.exit();var divItem=enter.append("div").attr("class","attr clearfix");divItem.append("div").text(function(d,i){return d.fieldTitle}).attr("class","left");divItem.append("div").attr("class","right");wraper_body.selectAll("div.attr .right").data(otherFields,function(d,i){return d.fieldName}).text(function(d,i){return d.fieldValue});exit.remove()}function fieldInTpl(fieldName,tpl){var isTplflag=false;var fieldGroup=tpl.fieldsGroup;for(var i=0;i<fieldGroup.length;i++){var fieldObj=fieldGroup[i];_.forIn(fieldObj.fields,function(v,i){if(v.fieldName==fieldName){isTplflag=true}})}return isTplflag}return d3.rebind(poiTagEditor,dispatch,"on")};;;iD.ui.TagEditor.DividerAttributeTagEditor=function(context){var dispatch=d3.dispatch("change");var DISPLAY_FIELD_LIST=["VIRTUAL","COLOR","TYPE","DRIVE_RULE","OVERLAY"];function tagEditor(selection,opts){var tpl=iD.ui.TagEditorTpl.DividerAttribute(),tags=opts.tags,entityID=opts.id,entity=context.entity(entityID),currentLayer=iD.Layers.getLayer(entity.layerId),modelEntity=iD.ModelEntitys[entity.modelName],geoType=modelEntity.getGeoType();var fields=modelEntity.getFields(geoType);tpl.fieldsGroup[0].fields=iD.ui.TagEditor.createTplFieldList(modelEntity,DISPLAY_FIELD_LIST);var fieldHash={};for(var i=0,len=fields.length;i<len;i++){var fieldObj=fields[i];bindFieldFilterFunc(fieldObj);fieldHash[fieldObj.fieldName]=fieldObj}context.container().select(".KDSEditor-inspector-wrap  .KDSEditor-header h3").text(tpl.title);iD.ui.TagEditor.renderFieldGroups(selection,tpl,{layer:currentLayer,dispatch:dispatch,context:context,entity:entity,tags:tags,fields:fieldHash})}tagEditor.available=function(entity){return entity.modelName==iD.data.DataType.DIVIDER_ATTRIBUTE};function bindFieldFilterFunc(fieldObj){if("TYPE"==fieldObj.fieldName){fieldObj.optionFilter=function(optionList,d){let list=[];for(let o of optionList){var v=Number(o.value);if("32"!=v&&"3"!=d.VIRTUAL&&19<v&&33>v){continue}list.push(o)}return list}}}var noDisplayFields=["","datatype"];function renderOtherFiels(selection,tpl,opts){var preset_form=d3.select(selection[0][0].parentNode);var tags=opts.tags;var fields=opts.fields;var otherFields=[];_.forEach(fields,function(v,k){if(!fieldInTpl(k,tpl)){var field={};field.fieldName=v.fieldName;field.fieldTitle=v.fieldTitle;if(""==v.fieldTitle){field.fieldTitle=v.fieldName}if(_.isObject(v.fieldInput)){var inputObjArray=v.fieldInput;var value=v.value;_.forEach(inputObjArray.values,function(v,i){if(v.value==value){field.fieldValue=v.name}})}else{field.fieldValue=tags[v.fieldName]}var inNoDisplayFlag=0<=noDisplayFields.indexOf(field.fieldName)?true:false;if(!inNoDisplayFlag){otherFields.push(field)}}});var div_wrapper=preset_form.selectAll("div.dropdown-maker").data([0]);var wraper=div_wrapper.enter().append("div").classed("roadTag-wrapper",true).classed("dropdown-maker",true).classed("close",true).on("click",function(){if(0<d3.select(this).attr("class").indexOf("close")){d3.select(this).classed("close",false)}else{d3.select(this).classed("close",true)}});wraper.append("div").classed("head",true).text("\u6D4F\u89C8\u5168\u90E8\u5C5E\u6027");var wraper_body=div_wrapper.selectAll("div.body").data([0]);wraper_body.enter().append("div").classed("body",true).on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault()});div_wrapper.classed("hide",function(){return"select"!=context.mode().id});var update=wraper_body.selectAll("div.body div.attr").data(otherFields,function(d,i){return d.fieldName});var enter=update.enter();var exit=update.exit();var divItem=enter.append("div").attr("class","attr clearfix");divItem.append("div").text(function(d,i){return d.fieldTitle}).attr("class","left");divItem.append("div").attr("class","right");wraper_body.selectAll("div.attr .right").data(otherFields,function(d,i){return d.fieldName}).text(function(d,i){return d.fieldValue});exit.remove()}function fieldInTpl(fieldName,tpl){var isTplflag=false;var fieldGroup=tpl.fieldsGroup;for(var i=0;i<fieldGroup.length;i++){var fieldObj=fieldGroup[i];_.forIn(fieldObj.fields,function(v,i){if(v.fieldName==fieldName){isTplflag=true}})}return isTplflag}return d3.rebind(tagEditor,dispatch,"on")};;;iD.ui.TagEditor.LaneAttributeTagEditor=function(context){var dispatch=d3.dispatch("change");var DISPLAY_FIELD_LIST=["LANETYPE","MAX_SPEED","MIN_SPEED","STATUS","SMTYPE"];function tagEditor(selection,opts){var tpl=iD.ui.TagEditorTpl.LaneAttribute(),tags=opts.tags,entityID=opts.id,entity=context.entity(entityID),currentLayer=iD.Layers.getLayer(entity.layerId),modelEntity=iD.ModelEntitys[entity.modelName],geoType=modelEntity.getGeoType();var fields=modelEntity.getFields(geoType);tpl.fieldsGroup[0].fields=iD.ui.TagEditor.createTplFieldList(modelEntity,DISPLAY_FIELD_LIST);var fieldHash={};for(var i=0,len=fields.length;i<len;i++){var fieldObj=fields[i];bindFieldFilterFunc(fieldObj);fieldHash[fieldObj.fieldName]=fieldObj}context.container().select(".KDSEditor-inspector-wrap  .KDSEditor-header h3").text(tpl.title);iD.ui.TagEditor.renderFieldGroups(selection,tpl,{layer:currentLayer,dispatch:dispatch,context:context,entity:entity,tags:tags,fields:fieldHash})}tagEditor.available=function(entity){return entity.modelName==iD.data.DataType.LANE_ATTRIBUTE};function bindFieldFilterFunc(fieldObj){}var noDisplayFields=["","datatype"];function renderOtherFiels(selection,tpl,opts){var preset_form=d3.select(selection[0][0].parentNode);var tags=opts.tags;var fields=opts.fields;var otherFields=[];_.forEach(fields,function(v,k){if(!fieldInTpl(k,tpl)){var field={};field.fieldName=v.fieldName;field.fieldTitle=v.fieldTitle;if(""==v.fieldTitle){field.fieldTitle=v.fieldName}if(_.isObject(v.fieldInput)){var inputObjArray=v.fieldInput;var value=v.value;_.forEach(inputObjArray.values,function(v,i){if(v.value==value){field.fieldValue=v.name}})}else{field.fieldValue=tags[v.fieldName]}var inNoDisplayFlag=0<=noDisplayFields.indexOf(field.fieldName)?true:false;if(!inNoDisplayFlag){otherFields.push(field)}}});var div_wrapper=preset_form.selectAll("div.dropdown-maker").data([0]);var wraper=div_wrapper.enter().append("div").classed("roadTag-wrapper",true).classed("dropdown-maker",true).classed("close",true).on("click",function(){if(0<d3.select(this).attr("class").indexOf("close")){d3.select(this).classed("close",false)}else{d3.select(this).classed("close",true)}});wraper.append("div").classed("head",true).text("\u6D4F\u89C8\u5168\u90E8\u5C5E\u6027");var wraper_body=div_wrapper.selectAll("div.body").data([0]);wraper_body.enter().append("div").classed("body",true).on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault()});div_wrapper.classed("hide",function(){return"select"!=context.mode().id});var update=wraper_body.selectAll("div.body div.attr").data(otherFields,function(d,i){return d.fieldName});var enter=update.enter();var exit=update.exit();var divItem=enter.append("div").attr("class","attr clearfix");divItem.append("div").text(function(d,i){return d.fieldTitle}).attr("class","left");divItem.append("div").attr("class","right");wraper_body.selectAll("div.attr .right").data(otherFields,function(d,i){return d.fieldName}).text(function(d,i){return d.fieldValue});exit.remove()}function fieldInTpl(fieldName,tpl){var isTplflag=false;var fieldGroup=tpl.fieldsGroup;for(var i=0;i<fieldGroup.length;i++){var fieldObj=fieldGroup[i];_.forIn(fieldObj.fields,function(v,i){if(v.fieldName==fieldName){isTplflag=true}})}return isTplflag}return d3.rebind(tagEditor,dispatch,"on")};;;iD.ui.TagEditor.RoadAttributeTagEditor=function(context){var dispatch=d3.dispatch("change");var DISPLAY_FIELD_LIST=["TYPE","SMTYPE"];function tagEditor(selection,opts){var tpl=iD.ui.TagEditorTpl.RoadAttribute(),tags=opts.tags,entityID=opts.id,entity=context.entity(entityID),currentLayer=iD.Layers.getLayer(entity.layerId),modelEntity=iD.ModelEntitys[entity.modelName],geoType=modelEntity.getGeoType();var fields=modelEntity.getFields(geoType);tpl.fieldsGroup[0].fields=iD.ui.TagEditor.createTplFieldList(modelEntity,DISPLAY_FIELD_LIST);bindFieldTpl(tpl);var fieldHash={};for(var i=0,len=fields.length;i<len;i++){var fieldObj=fields[i];bindFieldFilterFunc(fieldObj);fieldHash[fieldObj.fieldName]=fieldObj}context.container().select(".KDSEditor-inspector-wrap  .KDSEditor-header h3").text(tpl.title);iD.ui.TagEditor.renderFieldGroups(selection,tpl,{layer:currentLayer,dispatch:dispatch,context:context,entity:entity,tags:tags,fields:fieldHash})}tagEditor.available=function(entity){return entity.modelName==iD.data.DataType.ROAD_ATTRIBUTE};function bindFieldTpl(tpl){tpl.fieldsGroup[0].fields.forEach(function(fieldObj){if("TYPE"==fieldObj.fieldName){fieldObj.fieldLinkGroup=["VALUE"];fieldObj.fieldRender="selectgroup2"}})}function bindFieldFilterFunc(fieldObj){}var noDisplayFields=["","datatype"];function renderOtherFiels(selection,tpl,opts){var preset_form=d3.select(selection[0][0].parentNode);var tags=opts.tags;var fields=opts.fields;var otherFields=[];_.forEach(fields,function(v,k){if(!fieldInTpl(k,tpl)){var field={};field.fieldName=v.fieldName;field.fieldTitle=v.fieldTitle;if(""==v.fieldTitle){field.fieldTitle=v.fieldName}if(_.isObject(v.fieldInput)){var inputObjArray=v.fieldInput;var value=v.value;_.forEach(inputObjArray.values,function(v,i){if(v.value==value){field.fieldValue=v.name}})}else{field.fieldValue=tags[v.fieldName]}var inNoDisplayFlag=0<=noDisplayFields.indexOf(field.fieldName)?true:false;if(!inNoDisplayFlag){otherFields.push(field)}}});var div_wrapper=preset_form.selectAll("div.dropdown-maker").data([0]);var wraper=div_wrapper.enter().append("div").classed("roadTag-wrapper",true).classed("dropdown-maker",true).classed("close",true).on("click",function(){if(0<d3.select(this).attr("class").indexOf("close")){d3.select(this).classed("close",false)}else{d3.select(this).classed("close",true)}});wraper.append("div").classed("head",true).text("\u6D4F\u89C8\u5168\u90E8\u5C5E\u6027");var wraper_body=div_wrapper.selectAll("div.body").data([0]);wraper_body.enter().append("div").classed("body",true).on("click",function(d){d3.event.stopPropagation();d3.event.preventDefault()});div_wrapper.classed("hide",function(){return"select"!=context.mode().id});var update=wraper_body.selectAll("div.body div.attr").data(otherFields,function(d,i){return d.fieldName});var enter=update.enter();var exit=update.exit();var divItem=enter.append("div").attr("class","attr clearfix");divItem.append("div").text(function(d,i){return d.fieldTitle}).attr("class","left");divItem.append("div").attr("class","right");wraper_body.selectAll("div.attr .right").data(otherFields,function(d,i){return d.fieldName}).text(function(d,i){return d.fieldValue});exit.remove()}function fieldInTpl(fieldName,tpl){var isTplflag=false;var fieldGroup=tpl.fieldsGroup;for(var i=0;i<fieldGroup.length;i++){var fieldObj=fieldGroup[i];_.forIn(fieldObj.fields,function(v,i){if(v.fieldName==fieldName){isTplflag=true}})}return isTplflag}return d3.rebind(tagEditor,dispatch,"on")};;;iD.ui.RoadRule.CarList=function(options){var event=d3.dispatch("change"),$checkList,$container;var carOptions=iD.ui.RoadRule.CarList.carOptions;var carList=function(selection){$container=selection;$checkList=selection.selectAll("label.check").data(carOptions);var $newChecks=$checkList.enter().append("label").attr("class","check");$newChecks.append("input").attr("type","checkbox").attr("class","inp-check");$newChecks.append("span").attr("class","label");$checkList.selectAll("input.inp-check").attr("name",function(d){return"car_"+d.id}).attr("value",function(d){return d.id}).on("change",function(d){if(31===d.id){if(this.checked){carList.checkAll()}else{carList.uncheckAll()}}else{carList.refreshStat()}event.change(d,this)});$checkList.selectAll("span.label").html(function(d){return d.label})};carList.checkAll=function(){$checkList.selectAll("input.inp-check:not([value=\"0\"])").property("checked",true);carList.refreshStat()};carList.uncheckAll=function(){$checkList.selectAll("input.inp-check:not([value=\"0\"])").property("checked",false);carList.refreshStat()};carList.refreshStat=function(){var unCheckVals=[],checkVals=[],$allChecks=$checkList.selectAll("input.inp-check:not([value=\"0\"])");$allChecks.each(function(d){if(!this.checked){unCheckVals.push(d.id)}else{checkVals.push(d.id)}});if(0<=checkVals.indexOf(31)||1===unCheckVals.length&&31===unCheckVals[0]){$allChecks.property("checked",true);unCheckVals.length=0}$allChecks.each(function(d){if(31===d.id){return}d3.select(this).property("disabled",0===unCheckVals.length)})};carList.getVal=function(){carList.refreshStat();var vals=[],$allChecks=$checkList.selectAll("input.inp-check");$allChecks.each(function(d){if(this.checked){vals.push(d.id)}});if(0<=vals.indexOf(31)){vals=vals.filter(function(v){return 24>v||31==v})}return vals};carList.setVal=function(vals){if(!vals){return false}if(1==vals.length&&31==vals[0]){}$checkList.selectAll("input.inp-check").each(function(d){if(0<=vals.indexOf(d.id)){this.checked=true}});carList.refreshStat()};carList.val=function(_){if(!arguments.length)return carList.getVal();return carList.setVal(_)};carList.disable=function(disable){$container.classed("no-pointer-events disabled",!!disable)};return d3.rebind(carList,event,"on")};iD.ui.RoadRule.CarList.carOptions=[{id:31,label:"\u5168\u90E8\u8F66\u8F86"},{id:30,label:"\u5C0F\u8F7F\u8F66"},{id:29,label:"\u5FAE\u578B\u8F66"},{id:28,label:"\u5C0F\u578B\u5361/\u8D27\u8F66"},{id:27,label:"\u5927\u5361/\u8D27\u8F66"},{id:26,label:"\u62D6/\u6302\u8F66"},{id:25,label:"\u5C0F\u578B\u5BA2\u8F66"},{id:24,label:"\u5927\u578B\u5BA2\u8F66"},{id:0,label:"\u884C\u4EBA"}];;;iD.ui.RoadRule.DatePicker=function(options){var event=d3.dispatch("change"),$month,$day;var datePicker=function(selection){$month=selection.append("select").attr("class","month_sel").on("change",monthChange);selection.append("span").html("\u6708");selection.append("span").attr("class","monthday_divider").html("-");$day=selection.append("select").attr("class","day_sel");selection.append("span").html("\u65E5");$month.selectAll("option").data(d3.range(1,13)).enter().append("option").attr("value",function(d){return d}).text(function(d){return d});monthChange()};function setDayOption(days){var options=$day.selectAll("option").data(d3.range(1,days+1));options.enter().append("option");options.exit().remove();options.attr("value",function(d){return d}).text(function(d){return d})}var daysOfMonth=[31,29,31,30,31,30,31,31,30,31,30,31];function monthChange(){var monthSel=$month.property("value")||1;monthSel=parseInt(monthSel,10);setDayOption(daysOfMonth[(monthSel-1)%12])}datePicker.getVal=function(){return $month.property("value")+"-"+$day.property("value")};datePicker.setVal=function(_){var md=_.split("-");$month.property("value",md[0]);$day.property("value",md[1])};function lpadSpace(str,length){str=""+str;while(str.length<length)str=" "+str;return str}datePicker.val=function(_){if(!arguments.length)return datePicker.getVal();return datePicker.setVal(_)};return d3.rebind(datePicker,event,"on")};;;iD.ui.RoadRule.TimePicker=function(options){var event=d3.dispatch("change"),$hour,$minute;var timePicker=function(selection){$hour=selection.append("select").attr("class","hour");selection.append("span").attr("class","hourmin_divider").html(":");$minute=selection.append("select").attr("class","minute");$hour.selectAll("option").data(d3.range(0,25)).enter().append("option").attr("value",function(d){return lpadZero(d,2)}).text(function(d){return lpadZero(d,2)});$minute.selectAll("option").data(d3.range(0,60)).enter().append("option").attr("value",function(d){return lpadZero(d,2)}).text(function(d){return lpadZero(d,2)})};function lpadZero(str,length){str=""+str;while(str.length<length)str="0"+str;return str}timePicker.getVal=function(){return $hour.property("value")+":"+$minute.property("value")};timePicker.setVal=function(_){var hm=_.split(":");$hour.property("value",hm[0]);$minute.property("value",hm[1])};timePicker.val=function(_){if(!arguments.length)return timePicker.getVal();return timePicker.setVal(_)};return d3.rebind(timePicker,event,"on")};;;iD.ui.RoadRule.DateRange=function(options){var event=d3.dispatch("change"),$container,$dateList,$addBtn;options=_.assign({limit:Number.MAX_VALUE},options);var dateRange=function(selection){$container=selection;$dateList=$container.append("div").attr("class","daterange_list");$addBtn=$container.append("button").attr("class","row-add daterange-add").on("click",dateRange.add);$addBtn.append("span").attr("class","icon KDSEditor-icon plus");$addBtn.append("span").html("\u6DFB\u52A0\u65E5\u671F")};dateRange.add=function(){var data=dateRange.getVal();data.push({start:"1-1",end:"12-31"});$dateList.call(render,data)};function render($dateList,data){var $dateItems=$dateList.selectAll("div.date_range_item").data(data);var $newDateItems=$dateItems.enter().append("div").attr("class","date_range_item row_item cf");$dateItems.exit().remove();$newDateItems.append("label").attr("class","start date_point").each(function(d){var datePicker=iD.ui.RoadRule.DatePicker();this.__ruleDatePicker=datePicker;d3.select(this).call(datePicker)});$newDateItems.append("label").attr("class","date_divider row_divider").html("\u81F3");$newDateItems.append("label").attr("class","end date_point").each(function(d){var datePicker=iD.ui.RoadRule.DatePicker();this.__ruleDatePicker=datePicker;d3.select(this).call(datePicker)});$newDateItems.append("button").attr("class","remove").on("click",function(d){d3.event.preventDefault();d3.event.stopPropagation();d3.select(this.parentNode).remove();refreshStat()}).append("span").attr("class","icon KDSEditor-icon delete");$dateItems.each(function(d){var $rowItem=d3.select(this);$rowItem.select("label.start").node().__ruleDatePicker.val(d.start);$rowItem.select("label.end").node().__ruleDatePicker.val(d.end)});refreshStat()}function refreshStat(){var curLen=$dateList.selectAll("div.date_range_item").size();$addBtn.classed("hidden",curLen>=options.limit||$dateList.classed("disabled"))}dateRange.getVal=function(){var vals=[];$dateList.selectAll("div.date_range_item").each(function(){var $itemItem=d3.select(this),dVal={};dVal.start=$itemItem.select("label.start").node().__ruleDatePicker.val();dVal.end=$itemItem.select("label.end").node().__ruleDatePicker.val();vals.push(dVal)});return vals};dateRange.validate=function(){var passed=true,dVals=[];$dateList.selectAll("div.date_range_item").each(function(){var $itemItem=d3.select(this),dVal={};dVal.start=$itemItem.select("label.start").node().__ruleDatePicker.val();dVal.end=$itemItem.select("label.end").node().__ruleDatePicker.val();dVal.start=paddDate(dVal.start);dVal.end=paddDate(dVal.end);dVal.$ele=$itemItem;if(dVal.start>=dVal.end){passed=false;iD.ui.TagEditor.toastr($itemItem,"\u5F00\u59CB\u65E5\u671F\u9700\u5C0F\u4E8E\u7ED3\u675F\u65E5\u671F",{timeout:3000,placement:"right",delay:10})}if(passed){dVals.push(dVal)}});if(passed){dVals.sort(function(a,b){var fld="start";if(a.start===b.start){fld="end"}if(a[fld]===b[fld]){return 0}return a[fld]>b[fld]?1:-1});for(var i=1,len=dVals.length;i<len;i++){if(dVals[i].start<dVals[i-1].end){passed=false;iD.ui.TagEditor.toastr(dVals[i].$ele,"\u65E5\u671F\u8303\u56F4\u6709\u91CD\u5408",{timeout:3000,placement:"right",delay:10});break}}}return!passed};function paddDate(date){var md=date.split("-");return lpadZero(md[0],2)+"-"+lpadZero(md[1],2)}function lpadZero(str,length){str=""+str;while(str.length<length)str="0"+str;return str}dateRange.setVal=function(data){if(!data)return;$dateList.call(render,data)};dateRange.val=function(_){if(!arguments.length)return dateRange.getVal();return dateRange.setVal(_)};dateRange.disable=function(disable){$container.classed("no-pointer-events disabled",!!disable);refreshStat()};return d3.rebind(dateRange,event,"on")};;;iD.ui.RoadRule.MultiCheck=function(options){var event=d3.dispatch("change"),$checkList,$container;options=_.assign({namePre:"multicheck"},options);var multiCheck=function(selection){$container=selection;$checkList=selection.selectAll("label.check").data(options.options);var $newChecks=$checkList.enter().append("label").attr("class","check");$newChecks.append("input").attr("type","checkbox").attr("class","inp-check");$newChecks.append("span").attr("class","label");$checkList.selectAll("input.inp-check").attr("name",function(d){return options.namePre+"_"+d.name}).attr("value",function(d){return d.value}).on("click",function(d){event.change(d,this)});$checkList.selectAll("span.label").html(function(d){return d.label})};multiCheck.getVal=function(){var vals={};$checkList.selectAll("input.inp-check").each(function(d){if(this.checked){vals[d.name]=d.value}});return vals};multiCheck.setVal=function(vals){if(!vals){return false}var isValArr=_.isArray(vals);$checkList.selectAll("input.inp-check").each(function(d){if(!isValArr){this.checked=vals[d.name]===d.value}else{this.checked=0<=vals.indexOf(d.value)}})};multiCheck.val=function(_){if(!arguments.length)return multiCheck.getVal();return multiCheck.setVal(_)};multiCheck.disable=function(disable,flag){$container.classed("no-pointer-events disabled",!!disable)};return d3.rebind(multiCheck,event,"on")};;;iD.ui.RoadRule.Radio=function(options){var event=d3.dispatch("change"),$radioList,$container;var radio=function(selection){$container=selection;$radioList=selection.selectAll("label.radio").data(options.options);var $newChecks=$radioList.enter().append("label").attr("class","radio");$newChecks.append("input").attr("type","radio").attr("class","inp-radio");$newChecks.append("span").attr("class","label");$radioList.selectAll("input.inp-radio").attr("name",function(d){return d.name||options.name}).attr("disabled",function(d){return d.disabled}).attr("value",function(d){return d.value}).on("click",function(d){event.change(d,this)}).property("checked",function(d){return!!d.default});$radioList.selectAll("span.label").html(function(d){return d.label})};radio.getVal=function(){var val=null;$radioList.selectAll("input.inp-radio").each(function(d){if(this.checked){val=d.value;return false}});return val};radio.setVal=function(_){$radioList.selectAll("input.inp-radio").each(function(d){this.checked=d.value===_})};radio.val=function(_){if(!arguments.length)return radio.getVal();return radio.setVal(_)};radio.disable=function(disable){$container.classed("no-pointer-events disabled",!!disable)};return d3.rebind(radio,event,"on")};;;iD.ui.RoadRule.TimeRange=function(options){var event=d3.dispatch("change"),$container,$timeList,$addBtn;options.btns=options.btns!=undefined?options.btns:true;options=_.assign({limit:Number.MAX_VALUE},options);var timeRange=function(selection){$container=selection;$timeList=$container.append("div").attr("class","timerange_list");if(options.btns){$addBtn=$container.append("button").attr("class","row-add timerange-add").on("click",timeRange.add);$addBtn.append("span").attr("class","icon KDSEditor-icon plus");$addBtn.append("span").html("\u6DFB\u52A0\u65F6\u95F4\u6BB5")}};timeRange.add=function(){var data=timeRange.getVal();data.push({start:"00:00",end:"24:00"});$timeList.call(render,data)};function render($timeList,data){var $timeItems=$timeList.selectAll("div.time_range_item").data(data);$timeItems.exit().remove();var $newTimeItems=$timeItems.enter().append("div").attr("class","time_range_item row_item cf");$newTimeItems.append("label").attr("class","start time_point").each(function(d){var timePicker=iD.ui.RoadRule.TimePicker();this.__ruleTimePicker=timePicker;d3.select(this).call(timePicker)});$newTimeItems.append("label").attr("class","time_divider row_divider").html("\u81F3");$newTimeItems.append("label").attr("class","end time_point").each(function(d){var timePicker=iD.ui.RoadRule.TimePicker();this.__ruleTimePicker=timePicker;d3.select(this).call(timePicker)});if(options.btns){$newTimeItems.append("button").attr("class","remove").on("click",function(d){d3.event.preventDefault();d3.event.stopPropagation();d3.select(this.parentNode).remove();refreshStat()}).append("span").attr("class","icon KDSEditor-icon delete")}$timeItems.each(function(d){var $rowItem=d3.select(this);$rowItem.select("label.start").node().__ruleTimePicker.val(d.start);$rowItem.select("label.end").node().__ruleTimePicker.val(d.end)});refreshStat()}function refreshStat(){var curLen=$timeList.selectAll("div.time_range_item").size();if(options.btns){$addBtn.classed("hidden",curLen>=options.limit||$timeList.classed("disabled"))}}timeRange.getVal=function(){var vals=[];$timeList.selectAll("div.time_range_item").each(function(){var $itemItem=d3.select(this),dVal={};dVal.start=$itemItem.select("label.start").node().__ruleTimePicker.val();dVal.end=$itemItem.select("label.end").node().__ruleTimePicker.val();vals.push(dVal)});return vals};timeRange.validate=function(){var passed=true,dVals=[];$timeList.selectAll("div.time_range_item").each(function(){var $itemItem=d3.select(this),dVal={};dVal.start=$itemItem.select("label.start").node().__ruleTimePicker.val();dVal.end=$itemItem.select("label.end").node().__ruleTimePicker.val();dVal.$ele=$itemItem;if(dVal.start>=dVal.end){passed=false;iD.ui.TagEditor.toastr($itemItem,"\u5F00\u59CB\u65F6\u95F4\u9700\u5C0F\u4E8E\u7ED3\u675F\u65F6\u95F4",{timeout:3000,placement:"right",delay:10})}if(passed){dVals.push(dVal)}});if(passed){dVals.sort(function(a,b){var fld="start";if(a.start===b.start){fld="end"}if(a[fld]===b[fld]){return 0}return a[fld]>b[fld]?1:-1});for(var i=1,len=dVals.length;i<len;i++){if(dVals[i].start<dVals[i-1].end){passed=false;iD.ui.TagEditor.toastr(dVals[i].$ele,"\u65F6\u95F4\u8303\u56F4\u6709\u91CD\u5408",{timeout:3000,placement:"right",delay:10});break}}}return!passed};timeRange.setVal=function(data){if(!data)return;$timeList.call(render,data)};timeRange.val=function(_){if(!arguments.length)return timeRange.getVal();return timeRange.setVal(_)};timeRange.disable=function(disable){$container.classed("no-pointer-events disabled",!!disable);refreshStat()};return d3.rebind(timeRange,event,"on")};;;iD.ui.RoadRule.WeekDay=function(options){var event=d3.dispatch("change");var weekDay=function(selection){var weekDayOpts=[{label:"\u5468\u4E00",name:"mon",value:"1"},{label:"\u5468\u4E8C",name:"tue",value:"2"},{label:"\u5468\u4E09",name:"wed",value:"3"},{label:"\u5468\u56DB",name:"the",value:"4"},{label:"\u5468\u4E94",name:"fri",value:"5"},{label:"\u5468\u516D",name:"sat",value:"6"},{label:"\u5468\u65E5",name:"sun",value:"7"},{label:"\u5168\u9009",name:"all",value:"8"}];$container=selection;$checkList=selection.selectAll("label.check").data(weekDayOpts);var $newChecks=$checkList.enter().append("label").attr("class","check");$newChecks.append("input").attr("type","checkbox").attr("class","inp-check");$newChecks.append("span").attr("class","label");$checkList.selectAll("input.inp-check").attr("name",function(d){return"weekday_"+d.name}).attr("value",function(d){return d.value}).on("change",function(d){if("all"===d.name){if(this.checked){weekDay.checkAll()}else{weekDay.uncheckAll()}}else{weekDay.refreshStat()}event.change(d,this)});$checkList.selectAll("span.label").html(function(d){return d.label})};weekDay.checkAll=function(){$checkList.selectAll("input.inp-check").property("checked",true);weekDay.refreshStat()};weekDay.uncheckAll=function(){$checkList.selectAll("input.inp-check").property("checked",false);weekDay.refreshStat()};weekDay.refreshStat=function(){var unCheckVals=[],checkVals=[],$allChecks=$checkList.selectAll("input.inp-check");$allChecks.each(function(d){if(!this.checked){unCheckVals.push(d.value)}else{checkVals.push(d.value)}});if(0<=checkVals.indexOf("8")||1===unCheckVals.length&&"8"===unCheckVals[0]){$allChecks.property("checked",true);unCheckVals.length=0}$allChecks.each(function(d){if("8"==d.value){return}d3.select(this).property("disabled",0===unCheckVals.length)})};weekDay.getVal=function(){weekDay.refreshStat();var vals=[],$allChecks=$checkList.selectAll("input.inp-check");$allChecks.each(function(d){if(this.checked){vals.push(d.value)}});if(0<=vals.indexOf("8")){vals=vals.filter(function(v){return"8"!=v})}return vals};weekDay.setVal=function(vals){if(!vals){return false}if(1==vals.length&&"8"==vals[0]){}$checkList.selectAll("input.inp-check").each(function(d){if(0<=vals.indexOf(d.value)){this.checked=true}});weekDay.refreshStat()};weekDay.val=function(_){if(!arguments.length)return weekDay.getVal();return weekDay.setVal(_)};weekDay.disable=function(disable){$container.classed("no-pointer-events disabled",!!disable)};return d3.rebind(weekDay,event,"on")};;;iD.ui.RoadRule.Holiday=function(options){var render=iD.ui.RoadRule.Radio({name:"rule_holiday",options:[{label:"\u672A\u8BBE\u5B9A",value:"0",default:true},{label:"\u8282\u5047\u65E5",value:"1"},{label:"\u8282\u5047\u65E5\u9664\u5916",value:"2"}]});var holiday=function(selection){return render(selection)};holiday.val=function(_){return render.val.apply(render,arguments)};holiday.disable=function(disable){return render.disable(disable)};return d3.rebind(holiday,render,"on")};;;iD.ui.RoadRule.Season=function(options){var render=iD.ui.RoadRule.MultiCheck({namePre:"season",options:[{label:"\u6625\u5B63",name:"spring",value:"spring"},{label:"\u590F\u5B63",name:"summer",value:"summer"},{label:"\u79CB\u5B63",name:"autumn",value:"autumn"},{label:"\u51AC\u5B63",name:"winter",value:"winter"},{label:"\u5E72\u5B63",name:"dry",value:"dry"},{label:"\u96E8\u5B63/\u6C5B\u671F",name:"rainy",value:"rainy"}]});var season=function(selection){return render(selection)};season.setVal=function(vals){if(!vals){return false}render.val(vals)};season.getVal=function(){var vals=render.val();return _.values(vals)};season.val=function(_){if(!arguments.length)return season.getVal();return season.setVal(_)};season.disable=function(disable){return render.disable(disable)};return d3.rebind(season,render,"on")};;;iD.ui.RoadRule.Weather=function(options){var render=iD.ui.RoadRule.MultiCheck({namePre:"weather",options:iD.ui.RoadRule.Weather.weatherOptions});var weather=function(selection){return render(selection)};weather.setVal=function(vals){if(!vals){return false}render.val(vals)};weather.getVal=function(){var vals=render.val();return _.values(vals)};weather.val=function(_){if(!arguments.length)return weather.getVal();return weather.setVal(_)};weather.disable=function(disable){return render.disable(disable)};return d3.rebind(weather,render,"on")};iD.ui.RoadRule.Weather.weatherOptions=[{label:"\u6674\u5929",name:"sunny",value:"sunny"},{label:"\u96E8(\u96EA)\u5929",name:"rain",value:"rain"},{label:"\u8DEF\u9762\u7ED3\u51B0",name:"ice",value:"ice"},{label:"\u96FE\u5929",name:"fog",value:"fog"},{label:"\u98CE",name:"wind",value:"wind"}];;;iD.ui.RoadRule.Select=function(options){var event=d3.dispatch("change"),$select;options=_.assign({namePre:"sel"},options);var select=function(selection){if("check"==d3.select("body").attr("role")||"work"==d3.select("body").attr("role")&&false){$select=selection.append("select").attr("class","select").attr("name",function(){return options.namePre+"_"+options.name}).attr("disabled",true).on("change",function(){event.change(d3.select(this).property("value"),this)})}else{$select=selection.append("select").attr("class","select").attr("name",function(){return options.namePre+"_"+options.name}).on("change",function(){event.change(d3.select(this).property("value"),this)})}$select.selectAll("option").data(options.options).enter().append("option").attr("value",function(d){return d.value}).text(function(d){return d.label})};select.getVal=function(){return $select.property("value")};select.setVal=function(_){$select.property("value",_)};select.val=function(_){if(!arguments.length)return select.getVal();return select.setVal(_)};return d3.rebind(select,event,"on")};;;iD.ui.RoadRule.RuleType=function(ruleTypeFlag,blockTypeFlag){var roadRuleOptions=iD.ui.RoadRule.RuleType.typeOptions;roadRuleOptions.forEach(function(d){d.disabled=null});if(!ruleTypeFlag){roadRuleOptions[0].disabled=true;roadRuleOptions[1].disabled=true}if(!blockTypeFlag){roadRuleOptions[2].disabled=true}var render=iD.ui.RoadRule.Radio({name:"type",options:roadRuleOptions});var ruleType=function(selection){return render(selection)};ruleType.val=function(_){return render.val.apply(render,arguments)};return d3.rebind(ruleType,render,"on")};iD.ui.RoadRule.RuleType.typeOptions=[{label:"\u660E\u793A\u7981\u6B62",value:"0",disabled:null,default:true},{label:"\u56FE\u5546\u63A8\u8350",value:"1",disabled:null,default:false},{label:"\u95E8\u7981\u7981\u6B62",value:"2",disabled:null,default:false}];iD.ui.RoadRule.RuleType.getOptionLabel=function(val){var opts=iD.ui.RoadRule.RuleType.typeOptions;for(var i=0,len=opts.length;i<len;i++){if(opts[i].value==val){return opts[i].label}}return""};;;iD.ui.FeatureList=function(context){var layerInfo,event=d3.dispatch("close"),tabs=[{title:t("inspector.data_list_tab_name"),key:"search",action:iD.ui.SearchList(context)},{title:t("inspector.style_setting_tab_name"),key:"style",action:iD.ui.StyleSettingList(context)}];var cTabs=[],ui=context.options.ui,dataPane=ui&&ui.dataPane,stylePane=ui&&ui.stylePane;if(dataPane)cTabs.push(tabs[0]);if(stylePane)cTabs.push(tabs[1]);if("undefined"===typeof dataPane&&"undefined"===typeof stylePane){cTabs.push(tabs[0]);cTabs.push(tabs[1])}tabs=cTabs;function featureList(selection){var $header=selection.selectAll(".KDSEditor-header").data([0]);var $headerEnter=$header.enter().append("div").attr("class","KDSEditor-header KDSEditor-fillL cf");$headerEnter.append("button").attr("class","KDSEditor-fr").on("click",function(){selection.html("");event.close()}).append("span").attr("class","KDSEditor-icon close");$headerEnter.append("h3").text(layerInfo.name+t("inspector.feature_list"));function drawTabsHeader(){var $tabs=selection.selectAll(".KDSEditor-feature-tabs").data([0]);var $tabsEnter=$tabs.enter().append("ul").attr("class","KDSEditor-feature-tabs").attr("id","feature_tabs");var $items=$tabsEnter.selectAll("li").data(tabs,function(d){return d.key});var $enter=$items.enter().append("li").attr("data-tab",function(d){return d.key}).append("a").attr("class","anchor").html(function(d){return d.title});$items.exit().remove()};function drawTabsContent(){var $tabsContent=selection.selectAll(".KDSEditor-feature-tabsContent").data([0]);var $tabsContentEnter=$tabsContent.enter().append("div").attr("class","KDSEditor-feature-tabsContent").attr("id","feature_tabsContent");var $items=$tabsContentEnter.selectAll("div").data(tabs,function(d){return d.key});var $enter=$items.enter().append("div").attr("data-tab",function(d){return d.key}).attr("class",function(d){return d.key+"-list-pane"});$enter.each(function(d){d3.select(this).call(d.action.layerInfo(layerInfo))});$items.exit().remove()};drawTabsHeader();drawTabsContent();if(tabs.length)bootstrap.tabs()("feature_tabs","feature_tabsContent")}featureList.layerInfo=function(_){if(!arguments.length)return layerInfo;layerInfo=_;return featureList};return d3.rebind(featureList,event,"on")};;;iD.ui.LayerPane=function(context){var featureList=iD.ui.FeatureList(context),managerPane=context.ui().layermanager,sublayerList=iD.ui.SublayerList(context);var layerPane=function(selection){featureList.on("close",setFeature);var $wrap=selection.selectAll(".KDSEditor-panewrap").data([0]);var $enter=$wrap.enter().append("div").attr("class","KDSEditor-panewrap");$enter.append("div").attr("class","layer-manager-pane KDSEditor-pane");$enter.append("div").attr("class","KDSEditor-feature-list-pane KDSEditor-pane");var $managerPane=$wrap.select(".layer-manager-pane");var $featurePane=$wrap.select(".KDSEditor-feature-list-pane");function setFeature(){$wrap.transition().styleTween("right",function(){return d3.interpolate("0%","-100%")})};function setManager(layerInfo){$wrap.transition().styleTween("right",function(){return d3.interpolate("-100%","0%")});$featurePane.call(featureList.layerInfo(layerInfo))};function setSublayerList(layerInfo){layerInfo&&layerInfo.isRoad()&&$managerPane.call(sublayerList.layerInfo(layerInfo))};};return layerPane};;iD.ui.SearchList=function(context){var layerInfo,pageIndex=1,pageSize=10,total=0,dataResultsObj={};var searchList=function(selection){var listWrap=selection.selectAll(".KDSEditor-inspector-body").data([0]).enter().append("div").attr("class","KDSEditor-inspector-body");var list=listWrap.append("div").attr("class","KDSEditor-feature-list cf");var searchHeaderWrap=selection.selectAll(".search-header").data([0]).enter().append("div").attr("class","search-header");var _modelEntity=layerInfo.modelEntity(),_geoType=_modelEntity.getGeoType(),_fields=_modelEntity.getFields(_geoType);var conditionWrap=searchHeaderWrap.append("span"),fieldsSelect=conditionWrap.append("select").attr("class","fields"),fieldsConditionSelect=conditionWrap.append("select").attr("class","condition");var fieldsSelectItems=fieldsSelect.selectAll("option").data(_fields,function(d){return d.id});var fieldsSelectEnter=fieldsSelectItems.enter().append("option").attr("value",function(d){return d.fieldName}).text(function(d){return""===d.fieldTitle?d.fieldName:d.fieldTitle});fieldsSelectItems.exit().remove();fieldsConditionSelect.selectAll("option").data([{title:"Like",value:0},{title:"Equal",value:1}]).enter().append("option").attr("value",function(o){return o.value}).text(function(o){return o.title});var input=searchHeaderWrap.append("span").append("input").attr("placeholder",t("inspector.search")).attr("type","search").on("keypress",keypress);function keypress(){if(13===d3.event.keyCode){searchSubmit()}}function drawList(){var entities=filterEntity(dataResultsObj.entities);var noResultsWorldwide=0===entities.length;var resultsIndicator=list.selectAll(".no-results-item").data([0]).enter().append("button").attr("class","no-results-item");resultsIndicator.append("span").attr("class","KDSEditor-icon alert");resultsIndicator.append("span").attr("class","entity-name");list.selectAll(".no-results-item .entity-name").text(noResultsWorldwide?t("geocoder.no_results_worldwide"):t("geocoder.no_results_visible"));list.selectAll(".no-results-item").style("display",noResultsWorldwide?"block":"none");list.selectAll(".KDSEditor-feature-list-item").data([-1]).remove();var items=list.selectAll(".KDSEditor-feature-list-item").data(entities,function(d){return d.id});var enter=items.enter().append("button").attr("class","KDSEditor-feature-list-item").on("click",find);var label=enter.append("div").attr("class","label");label.append("span").attr("class","entity-type").text(function(d){return iD.Entity.id.toOSM(d.id)});label.append("span").attr("class","entity-name").text(function(d){return d.tags[getFieldKey().name]||""});enter.style("opacity",0).transition().style("opacity",1).style("position","relative").style("border-bottom","1px solid #ccc").style("border-radius",0);items.order();items.exit().remove();var $header=list.insert("button",".no-results-item").attr("class","KDSEditor-feature-list-item").append("div").attr("class","label");$header.append("span").attr("class","entity-type").text("\u7F16\u53F7");$header.append("span").attr("class","entity-name").text("\u540D\u79F0");$header.style("position","relative").style("border-bottom","1px solid #ccc").style("border-radius",0)}function initPagination(){var $list=listWrap.selectAll(".pagination").data([0]);var $enter=$list.enter().append("div").attr("class","pagination").call(bootstrap.pagination().pageIndex(pageIndex).pageSize(pageSize).total(total).on("change",function(_pageIndex){searchRequest(_pageIndex,pageSize,function(data){dataResultsObj=data;drawList()})}));$list.exit().remove()}function filterEntity(_){var entities=[];if(_&&0<_.length){for(var i=0,l=_.length;i<l;i++){var currentEntity=_[i];if("point"!==layerInfo.type){if(currentEntity instanceof iD.Way){entities.push(currentEntity)}}else{entities.push(currentEntity)}};}return entities}function find(d){var entity=context.graph().hasEntity(d.id);if(d.loc&&(180<d.loc[0]||90<d.loc[1])){d.loc[0]/=10000;d.loc[1]/=10000}if(entity&&d.entity){context.enter(iD.modes.Select(context,[d.entity.id]))}else{context.loadEntity(d.id,true,layerInfo)}}function searchSubmit(){d3.event.preventDefault();searchRequest(1,pageSize,function(data){dataResultsObj=data;pageIndex=parseInt(dataResultsObj.pageIndex,10)||pageIndex;pageSize=parseInt(dataResultsObj.pageSize,10)||pageSize;total=parseInt(dataResultsObj.count,10)||total;drawList();initPagination()})}function getFieldKey(){return fieldsSelect.selectAll("option").filter(function(){return this.selected}).datum()}function searchRequest(pageIndex,pageSize,callback){var fieldsKey=getFieldKey().columnName,conditionValue=fieldsConditionSelect.selectAll("option").filter(function(){return this.selected}).attr("value"),q=input.value().trim(),filter="";console.log(getFieldKey());filter=0===q.length?"":"and "+fieldsKey+("0"===conditionValue?" like '%"+q+"%'":" ='"+q+"'");if("0"===conditionValue&&0==q.length){filter=""}if("1"===conditionValue&&0==q.length){filter="and ("+fieldsKey+" is null)"}console.info(filter);context.connection().loadSearchResult(filter,layerInfo,pageIndex,pageSize,callback)}};searchList.layerInfo=function(_){if(!arguments.length)return layerInfo;layerInfo=_;return searchList};return searchList};;;iD.ui.StyleSettingList=function(context){var layerInfo,settings=[{key:"display",title:"\u662F\u5426\u6807\u6CE8",type:"select",values:[{name:true,title:"\u662F"},{name:false,title:"\u5426"}]},{key:"fieldKey",title:"\u6807\u6CE8\u5B57\u6BB5",type:"select",values:[]},{key:"fontSize",title:"\u6807\u6CE8\u6587\u5B57\u5927\u5C0F",type:"select",values:[8,9,9.5,10,10.5,11,11.5,12,14,16,18,20,22,24,26]},{key:"fill",title:"\u6807\u6CE8\u6587\u5B57\u989C\u8272",glass:"color-picker KDSEditor-input",type:"input"}];var styleSettingList=function(selection){var _modelEntity=layerInfo.modelEntity(),_geoType=_modelEntity.getGeoType(),_fields=_modelEntity.getFields(_geoType),_label=layerInfo.label||{};settings[1].values=_fields;var $wrap=selection.selectAll(".KDSEditor-inspector-inner").data([0]);$wrap.enter().append("div").attr("class","KDSEditor-inspector-inner");var $list=$wrap.selectAll(".tag-list").data([0]);$list.enter().append("ul").attr("class","tag-list");var $items=$list.selectAll("li").data(settings,function(d){return d.key});var $enter=$items.enter().append("li").attr("class","tag-row cf");$enter.append("div").attr("class","key-wrap").append("label").attr("class","key KDSEditor-label");var $inputWrapPosition=$enter.append("div").attr("class","input-wrap-position");$inputWrapPosition.each(function(d){var that=this;if("input"===d.type){d3.select(that).append("input").property("type","text").attr("class","value "+(d.glass?d.glass:"")).attr("data-key",function(d){return d.key})}if("select"===d.type){var select=d3.select(that).append("select").attr("class","value").attr("data-key",function(d){return d.key});select.selectAll("option").data(d.values).enter().append("option").attr("value",function(o){if(o instanceof Object){return o.name||o.fieldName}return o}).text(function(o){if(o instanceof Object){if(o.title){return o.title}return o.name||o.fieldName}return o})}});$items.select("label.key").html(function(d){return d.title}).attr("title",function(d){return d.title});$items.select("select.value").each(function(d){var _value=_label[d.key],_that=this;if("undefined"!==typeof _value){d3.select(this).selectAll("option").each(function(item){if(item instanceof Object){this.selected=item.name===_value}else{this.selected=item===_value}})}});$items.select("input.value").each(function(d){var _value=_label[d.key],_that=this;if("undefined"!==typeof _value){d3.select(this).style("background",_value).style("color","#fff").value(_value)}});$items.exit().remove();$wrap.append("button").attr("class","KDSEditor-fr confirm").on("click",apply).append("span").text("\u5E94\u7528");$items.select("input.color-picker").on("click",function(){startColorPicker(this)});function apply(){var _labelInfo={};_value="";$inputWrapPosition.each(function(d){var _thisObj=d3.select(this);if("input"===d.type){_value=_thisObj.select("input.value").value()}if("select"===d.type){_thisObj.select("select.value").selectAll("option").each(function(item){if(this.selected){if(item instanceof Object){_value=item.name||item.fieldName}else{_value=item}}})}_labelInfo[d.key]=_value});layerInfo.label=_labelInfo;context.map().dimensions(context.map().dimensions())}};styleSettingList.layerInfo=function(_){if(!arguments.length)return layerInfo;layerInfo=_;return styleSettingList};return styleSettingList};;;iD.ui.PresetList=function(context){var event=d3.dispatch("choose"),id,currentPreset,autofocus=false;function presetList(selection){var geometry=context.geometry(id),presets=context.presets().matchGeometry(geometry);selection.html("");var messagewrap=selection.append("div").attr("class","KDSEditor-header KDSEditor-fillL cf");var message=messagewrap.append("h3").text(t("inspector.choose"));if(context.entity(id).isUsed(context.graph())){messagewrap.append("button").attr("class","preset-choose").on("click",function(){event.choose(currentPreset)}).append("span").attr("class","KDSEditor-icon forward")}else{messagewrap.append("button").attr("class","close").on("click",function(){context.enter(iD.modes.Browse(context))}).append("span").attr("class","KDSEditor-icon close")}function keydown(){if(0===search.property("value").length&&(d3.event.keyCode===d3.keybinding.keyCodes["\u232B"]||d3.event.keyCode===d3.keybinding.keyCodes["\u2326"])){d3.event.preventDefault();d3.event.stopPropagation();iD.operations.Delete([id],context)()}else if(0===search.property("value").length&&(d3.event.ctrlKey||d3.event.metaKey)&&d3.event.keyCode===d3.keybinding.keyCodes.z){d3.event.preventDefault();d3.event.stopPropagation();context.undo()}else if(!d3.event.ctrlKey&&!d3.event.metaKey){d3.select(this).on("keydown",null)}}function keypress(){var value=search.property("value");if(13===d3.event.keyCode&&value.length){list.selectAll(".preset-list-item:first-child").datum().choose()}}function inputevent(){var value=search.property("value");list.classed("filtered",value.length);if(value.length){var results=presets.search(value,geometry);message.text(t("inspector.results",{n:results.collection.length,search:value}));list.call(drawList,results)}else{list.call(drawList,context.presets().defaults(geometry,36));message.text(t("inspector.choose"))}}var searchWrap=selection.append("div").attr("class","search-header");var search=searchWrap.append("input").attr("class","preset-search-input").attr("placeholder",t("inspector.search")).attr("type","search").on("keydown",keydown).on("keypress",keypress).on("input",inputevent);searchWrap.append("span").attr("class","KDSEditor-icon search");if(autofocus){search.node().focus()}var listWrap=selection.append("div").attr("class","KDSEditor-inspector-body");var list=listWrap.append("div").attr("class","preset-list KDSEditor-fillL cf").call(drawList,context.presets().defaults(geometry,36))}function drawList(list,presets){var collection=presets.collection.map(function(preset){return preset.members?CategoryItem(preset):PresetItem(preset)});var items=list.selectAll(".preset-list-item").data(collection,function(d){return d.preset.id});items.enter().append("div").attr("class",function(item){return"preset-list-item preset-"+item.preset.id.replace("/","-")}).classed("current",function(item){return item.preset===currentPreset}).each(function(item){d3.select(this).call(item)}).style("opacity",0).transition().style("opacity",1);items.order();items.exit().remove()}function CategoryItem(preset){var box,sublist,shown=false;function item(selection){var wrap=selection.append("div").attr("class","preset-list-button-wrap category KDSEditor-col12");wrap.append("button").attr("class","preset-list-button").call(iD.ui.PresetIcon().geometry(context.geometry(id)).preset(preset)).on("click",item.choose).append("div").attr("class","label").text(preset.name());box=selection.append("div").attr("class","subgrid KDSEditor-col12").style("max-height","0px").style("opacity",0);box.append("div").attr("class","arrow");sublist=box.append("div").attr("class","preset-list KDSEditor-fillL3 cf KDSEditor-fl")}item.choose=function(){if(shown){shown=false;box.transition().duration(200).style("opacity","0").style("max-height","0px").style("padding-bottom","0px")}else{shown=true;sublist.call(drawList,preset.members);box.transition().duration(200).style("opacity","1").style("max-height",200+80*preset.members.collection.length+"px").style("padding-bottom","20px")}};item.preset=preset;return item}function PresetItem(preset){function item(selection){var wrap=selection.append("div").attr("class","preset-list-button-wrap KDSEditor-col12");wrap.append("button").attr("class","preset-list-button").call(iD.ui.PresetIcon().geometry(context.geometry(id)).preset(preset)).on("click",item.choose).append("div").attr("class","label").text(preset.name());wrap.call(item.reference.button);selection.call(item.reference.body)}item.choose=function(){context.presets().choose(preset);context.perform(iD.actions.ChangePreset(id,currentPreset,preset),t("operations.change_tags.annotation"));event.choose(preset)};item.help=function(){d3.event.stopPropagation();item.reference.toggle()};item.preset=preset;item.reference=iD.ui.TagReference(preset.reference(context.geometry(id)));return item}presetList.autofocus=function(_){if(!arguments.length)return autofocus;autofocus=_;return presetList};presetList.entityID=function(_){if(!arguments.length)return id;id=_;presetList.preset(context.presets().match(context.entity(id),context.graph()));return presetList};presetList.preset=function(_){if(!arguments.length)return currentPreset;currentPreset=_;return presetList};return d3.rebind(presetList,event,"on")};;;iD.ui.EntityEditor=function(context){var event=d3.dispatch("choose"),state="select",id;var rawTagEditor=iD.ui.RawTagEditor(context).on("change",changeTags);function entityEditor(selection){var entity=context.entity(id),tags=_.clone(entity.tags);var currentLayer=iD.Layers.getLayer(entity.layerId);var $header=selection.selectAll(".KDSEditor-header").data([0]);var quick_key="ALT+C";var $enter=$header.enter().append("div").attr("class","KDSEditor-header KDSEditor-fillL cf");$enter.append("button").attr("class","KDSEditor-fr preset-close").attr("title","\u5FEB\u6377\u952E:"+quick_key).append("span").attr("class","KDSEditor-icon close");$enter.append("h3");$header.select("h3").text(t("inspector.edit"));$header.select(".preset-close").on("click",function(){context.enter(iD.modes.Browse(context))});var keybinding=d3.keybinding("entity_editor").on(quick_key,function(){context.enter(iD.modes.Browse(context))});d3.select(document).call(keybinding);var $body=selection.selectAll(".KDSEditor-inspector-body").data([0]);$enter=$body.enter().append("div").attr("class","KDSEditor-inspector-body");$enter.append("div").attr("class","KDSEditor-inspector-border raw-tag-editor KDSEditor-inspector-inner");selection.selectAll(".KDSEditor-inspector-body").each(function(){var $panel=d3.select(this);$panel.classed("no-pointer-events",false);if(currentLayer&&currentLayer.tagReadOnly||!iD.util.entityInPlyGon(context.entity(id),context)){$panel.classed("no-pointer-events",true)}});$body.select(".raw-tag-editor").call(rawTagEditor.entityID(id).tags(tags).state(state));function historyChanged(){if("hide"===state)return;var entity=context.hasEntity(id);if(!entity)return}context.history().on("change.entity-editor",historyChanged)}function clean(o){var out={},k,v;for(k in o){v=o[k];if(null==v)v="NULL";if(k&&v!==undefined){out[k]=v.toString().split(";").map(function(s){return s.trim()}).join(";")}}return out}function changeTags(changed){var primaryKey=window.primaryKey;let _changeKeys=_.keys(changed);if(!primaryKey&&_changeKeys.length){primaryKey=1==_changeKeys.length?_changeKeys[0]:"\u5C5E\u6027\u5B57\u6BB5"}var entity=context.entity(id),tags=clean(_.extend({},entity.tags,changed));var chnName=getChnName(changed,entity,primaryKey);var msg="\u66F4\u6539"+chnName;if(0<d3.select("#multiEditor").size()&&d3.select("#multiEditor")[0][0].checked){if(!arguments[1][4]["eventTriggerType"]&&iD.util.tagChanged(entity.tags,tags)){return}_.forEach(changed,function(value,name,obj){if(_.isUndefined(value)||_.isUndefined(entity.tags[name])){delete obj[name]}});if(_.isEmpty(changed)){return}var actions_array=[],selectedArrs=[],navitypeChanged=isNavitypeChanged(changed,entity.tags,tags);actions_array.push(iD.actions.ChangeTags(id,tags));if(0<d3.select("#multiEditor").size()&&d3.select("#multiEditor")[0][0].checked){selectedArrs=changeOtherRoadTags(id,actions_array,changed,arguments)}actions_array.push(msg);context.perform(iD.actions.Noop(),msg);context.replace.apply(this,actions_array);if(changed.DIRECTION){selectedArrs.forEach(function(selectedId){updateWayMaatAcceTag(selectedId,context,msg)})}if(0<navitypeChanged){selectedArrs.forEach(function(selectedId){updateWalkEnterRelation(selectedId,context,msg,navitypeChanged)})}}else{_.forEach(changed,function(value,name,obj){if(_.isUndefined(value)||_.isUndefined(entity.tags[name])){delete obj[name]}});if(iD.util.tagChanged(entity.tags,tags)){var actions_array=[],navitypeChanged=isNavitypeChanged(changed,entity.tags,tags);actions_array.push(iD.actions.ChangeTags(id,tags));actions_array.push(msg);context.perform(iD.actions.Noop(),msg);context.replace.apply(this,actions_array);if(changed.DIRECTION){updateWayMaatAcceTag(entity.id,context,msg)}if(0<navitypeChanged){updateWalkEnterRelation(entity.id,context,msg,navitypeChanged)}}}}function isNavitypeChanged(changed,oldtags,newtags){if(changed.navitype){if(0>["2","3","6","7"].indexOf(oldtags["navitype"])&&0<=["2","3","6","7"].indexOf(newtags["navitype"])){return 2}else if(0<=["2","3","6","7"].indexOf(oldtags["navitype"])&&0>["2","3","6","7"].indexOf(newtags["navitype"])){return 1}}return 0}function updateWalkEnterRelation(wayId,context,msg,walkRelFlag){var entity=context.entity(wayId);var relations=context.graph().parentRelations(entity);if(1==walkRelFlag){context.replace(addWalkEnterRelation(context,entity,relations),msg)}else if(2==walkRelFlag){relations.forEach(function(relation){if(relation.modelName==iD.data.DataType.RELWKETROAD){context.replace(iD.actions.DeleteRelation(relation.id),msg)}})}}function addWalkEnterRelation(context,way,relations){return function(graph){var distance=0.1,walkTopo=iD.topo.RelWketRoad(),walkUtil=iD.util.walkExtend(),walkEnterIds=walkUtil.getWalkEntersWithFilterBBox(context,distance,way,way,graph);if(walkEnterIds&&1<=walkEnterIds.length){walkEnterIds.forEach(function(walkEnterId){graph=walkTopo.waklroadCreate(graph,walkEnterId,way.id)})}return graph}}function updateAcceTagOfNMaat(relation){return function(graph){relation=iD.util.tagExtend.updateAcceTagOfNMaat(graph,relation);graph=graph.replace(relation);return graph}}function updateAcceTagOfCMaat(relation){return function(graph){relation=iD.util.tagExtend.updateAcceTagOfNMaat(graph,relation);graph=graph.replace(relation);return graph}}function updateWayMaatAcceTag(wayId,context,msg){var entity=context.entity(wayId);var relations=context.graph().parentRelations(entity);relations.forEach(function(relation){if(relation.modelName==iD.data.DataType.NODECONN){context.replace(updateAcceTagOfNMaat(relation),msg)}else if(relation.modelName==iD.data.DataType.C_NODECONN){context.replace(updateAcceTagOfCMaat(relation),msg)}})}function clone2(obj){var o,obj;if(obj.constructor==Object){o=new obj.constructor}else{o=new obj.constructor(obj.valueOf())}for(var key in obj){if(o[key]!=obj[key]){if("object"==typeof obj[key]){o[key]=clone2(obj[key])}else{o[key]=obj[key]}}}return o}function changeOtherRoadTags(currentId,actionArray,changed,args){var d3Obj=d3.select("#KDSEditor-sidebar");var selectIdArray=[];if(0<d3Obj.size()){var save_d=args[1][0],fieldOpts=args[1][1],save_entity=fieldOpts.entity;var selectIds=d3Obj.attr("data-multiselectids");if(selectIds){selectIdArray=selectIds.split(",");for(var i=0;i<selectIdArray.length;i++){if(selectIdArray[i]!=currentId){var entity=context.entity(selectIdArray[i]),chgtag=clone2(args[2]),tpl=args[3];if(tpl.onValidate){fieldOpts.entity=entity;args[1][0]=chgtag;chgtag=tpl.onValidate.apply(chgtag,args[1])}var tags=clean(_.extend({},entity.tags,chgtag));actionArray.push(iD.actions.ChangeTags(selectIdArray[i],tags))}}}args[1][0]=save_d;fieldOpts.entity=save_entity}return selectIdArray}function getChnName(changed,entity,primaryKey){var chnName;var tags=entity.tags;var layerInfo=iD.Layers.getLayer(entity.layerId);var modelEntity,mtype;if("node"==entity.type){mtype="1"}else if("way"==entity.type){mtype="2"}else if("relation"==entity.type){mtype="0"}modelEntity=iD.ModelEntitys[entity.modelName];if(modelEntity){var gtype=modelEntity.getGeoType();var fields=modelEntity.getFields(gtype)}for(var k in changed){fields.forEach(function(field){if(field.fieldName==k&&primaryKey&&primaryKey==k){chnName=field.fieldTitle}})}return chnName}entityEditor.state=function(_){if(!arguments.length)return state;state=_;return entityEditor};entityEditor.entityID=function(_){if(!arguments.length)return id;id=_;return entityEditor};entityEditor.changeTags=function(changed){changeTags(changed||{});return entityEditor};return d3.rebind(entityEditor,event,"on")};;;iD.ui.Disclosure=function(){var dispatch=d3.dispatch("toggled"),title,expanded=false,content=function(){};var disclosure=function(selection){var $link=selection.selectAll(".hide-toggle").data([0]);$link.enter().append("a").attr("href","#").attr("class","hide-toggle");$link.text(title).on("click",toggle).classed("expanded",expanded);var $body=selection.selectAll("div").data([0]);$body.enter().append("div");$body.classed("hide",!expanded).call(content);function toggle(){expanded=!expanded;$link.classed("expanded",expanded);$body.call(iD.ui.Toggle(expanded));dispatch.toggled(expanded)}};disclosure.title=function(_){if(!arguments.length)return title;title=_;return disclosure};disclosure.expanded=function(_){if(!arguments.length)return expanded;expanded=_;return disclosure};disclosure.content=function(_){if(!arguments.length)return content;content=_;return disclosure};return d3.rebind(disclosure,dispatch,"on")};;;iD.ui.Sidebar=function(context){var inspector=iD.ui.Inspector(context),layerPane,current;var inspectorTagList;if(iD.ui.InspectorTagList){if(6==window._systemType){inspectorTagList=iD.ui.InspectorTagList(context,iD.data.DataType.IMAGE_TAG)}else{inspectorTagList=iD.ui.InspectorTagList(context)}}function sidebar(selection){var layerWrap=selection.append("div").attr("class","layer-pane");var inspectorWrap=selection.append("div").attr("class","KDSEditor-inspector-hidden KDSEditor-inspector-wrap KDSEditor-fr");var inspectorTagListWrap=selection.append("div").attr("class","KDSEditor-inspector-hidden KDSEditor-inspector-taglist-wrap KDSEditor-fr");sidebar.hover=function(id){if(inspectorTagList.isMatchType(id)){return}if(!id){isVisible=false;inspectorTagListWrap.classed("KDSEditor-inspector-hidden",false);inspectorTagListWrap.call(inspectorTagList)}var isVisible=isVisibleInspetror(id);if(!isVisible){layerWrap.classed("KDSEditor-inspector-hidden",false);inspectorWrap.classed("KDSEditor-inspector-hidden",true).classed("KDSEditor-inspector-hover",false);return}if(!current&&id){layerWrap.classed("KDSEditor-inspector-hidden",true);inspectorWrap.classed("KDSEditor-inspector-hidden",false).classed("KDSEditor-inspector-hover",true);inspectorTagListWrap.classed("KDSEditor-inspector-hidden",true);if(inspector.entityID()!==id||"hover"!==inspector.state()){inspector.state("hover").entityID(id);inspectorWrap.call(inspector)}}else if(!current){layerWrap.classed("KDSEditor-inspector-hidden",false);inspectorWrap.classed("KDSEditor-inspector-hidden",true);inspector.state("hide")}};sidebar.hover=_.throttle(sidebar.hover,200);sidebar.update=function(){layerWrap.selectAll("div").remove()};sidebar.select=function(id,newFeature){var isVisible=isVisibleInspetror(id);if(!id||inspectorTagList.isMatchType(id)){isVisible=false;inspectorTagListWrap.classed("KDSEditor-inspector-hidden",false);inspectorTagListWrap.call(inspectorTagList,id);return}if(!isVisible){layerWrap.classed("KDSEditor-inspector-hidden",false);inspectorWrap.classed("KDSEditor-inspector-hidden",true).classed("KDSEditor-inspector-hover",false);return}if(!current&&id){layerWrap.classed("KDSEditor-inspector-hidden",true);inspectorWrap.classed("KDSEditor-inspector-hidden",false).classed("KDSEditor-inspector-hover",false);inspectorTagListWrap.classed("KDSEditor-inspector-hidden",true);if(newFeature||inspector.entityID()!==id||"select"!==inspector.state()){inspector.state("select").entityID(id).newFeature(newFeature);inspectorWrap.call(inspector)}}else if(!current){layerWrap.classed("KDSEditor-inspector-hidden",false);inspectorWrap.classed("KDSEditor-inspector-hidden",true);inspector.state("hide")}};context.event.on("delete.sidebar",function(data){if(data&&data.selectedIDs&&data.selectedIDs.length){inspectorTagListWrap.call(inspectorTagList,null,true)}});context.history().on("undone.sidebar",function(){inspectorTagListWrap.call(inspectorTagList)}).on("redone.sidebar",function(){inspectorTagListWrap.call(inspectorTagList)}).on("change.sidebar",function(difference,extent){if(!difference&&extent){inspectorTagListWrap.call(inspectorTagList,null,true)}});context.ui().layermanager.on("change.sidebar",function(lay){if(lay&&"checktag"==lay.type){inspectorTagListWrap.call(inspectorTagList,true)}});sidebar.show=function(component){layerWrap.classed("KDSEditor-inspector-hidden",true);inspectorWrap.classed("KDSEditor-inspector-hidden",true);if(current)current.remove();current=selection.append("div").attr("class","KDSEditor-sidebar-component").call(component)};sidebar.hide=function(){layerWrap.classed("KDSEditor-inspector-hidden",false);inspectorWrap.classed("KDSEditor-inspector-hidden",true);inspectorTagListWrap.classed("KDSEditor-inspector-hidden",false);if(current)current.remove();current=null;removeMutiRoadEditor()};function getNodeParentWaysNum(node){var count=0;context.graph().parentWays(node).forEach(function(way){if(!way.isOneRoadCrossWay()){count++}});return count}function isVisibleInspetror(id){var flag=true,entity=context.hasEntity(id);if(!entity){return false}var blanks=context.variable.blankFieldList||[];return!blanks.includes(entity.modelName);if(id&&(entity=context.entity(id))){var geometry=context.geometry(id);if("vertex"===geometry){if([iD.data.DataType.DIVIDER_NODE,iD.data.DataType.ROAD_NODE].includes(entity.modelName)){return true}if(!entity.isRoadNode()&&!entity.isRoadCross()){flag=false}if(!entity.isRoadCross()&&2!=getNodeParentWaysNum(entity)){return false}}else if("line"===geometry&&entity.isOneRoadCrossWay()){flag=false}if(entity&&entity.tags&&"QC_TAG"==entity.modelName){flag=false}}return flag}function removeMutiRoadEditor(){var multiEditRoad=d3.event&&d3.event._multiEditRoadProp;if(multiEditRoad){}else{var multiEditor=d3.selectAll("#KDSEditor-sidebar #multiRoadEditor_footer");if(0<multiEditor.size()){multiEditor.remove()}}}context.connection().on("loaded.sidebar",function(){sidebar.select()})}sidebar.hover=function(){};sidebar.select=function(){};sidebar.show=function(){};sidebar.hide=function(){};sidebar.update=function(){};return sidebar};;;iD.ui.RawRelationEditor=function(context){var event=d3.dispatch("apply"),nodeId,nodeDataType,fromWayId,toWayId,relations=[],deleteRelations=[],editRelation,relationTemplate={},maat,edit={},timeRuleObj={time1:"",time2:""},ruleTypeBinary=[0,0,0];var _Util={_cars:[{id:31,name:"\u5168\u90E8\u8F66\u8F86"},{id:30,name:"\u5C0F\u8F7F\u8F66"},{id:29,name:"\u5FAE\u578B\u8F66"},{id:28,name:"\u5C0F\u578B\u5361/\u8D27\u8F66"},{id:27,name:"\u5927\u5361/\u8D27\u8F66"},{id:26,name:"\u62D6/\u6302\u8F66"},{id:25,name:"\u5C0F\u578B\u5BA2\u8F66"},{id:24,name:"\u5927\u578B\u5BA2\u8F66"},{id:0,name:"\u884C\u4EBA"}],_2To16:function(v){return parseInt(v,2).toString(16).toUpperCase()},_16To2:function(v){return parseInt(v,16).toString(2)},_2To10:function(v){return parseInt(v,2).toString(10)},_10To2:function(v){return parseInt(v,10).toString(2)},_timeTranfer:function(time1,time2){var arr=[];arr.push("[(h:");arr.push(time1);arr.push(")(h:");arr.push(time2);arr.push(")]");return arr.join("")},_timeReverseTranfer:function(time){var obj={time1:"00:00",time2:"24:00"};time=time.replace("[(","").replace(")]","").replace(/h:/g,"").split(")(");if(2==time.length){obj.time1=time[0];obj.time2=time[1]}return obj},_createHexadecimalBySelectedCars:function(ids){var temp=[];for(var i=0;32>i;i++){temp.push(0)}_(ids).each(function(id){temp[id]=1});return this._2To16(temp.reverse().join(""))},_getCarNamesByHexadecimal:function(v){var array=[],v=v&&this._16To2(v)||"",cars=this._cars;for(var i=0,l=v.length;i<l;i++){if(1===parseInt(v[i],10)){var obj=searchCar(l-1-i);if(obj){array.push(obj)}}}function searchCar(i){var obj;_(cars).each(function(item){if(item.id===i){obj=item;return false}});return obj}return array}};function compareMember(members){var objA={from_road:"",node:"",to_road:""};_(members).each(function(member){objA[member.role]=member.id});var objB={from_road:fromWayId,node:nodeId,to_road:toWayId};return _.isEqual(objA,objB)}function validateTags(tags){var obj={};obj.rule_type=tags.rule_type||"";obj.rule_time=tags.rule_time||"";obj.vehicle=tags.vehicle||"";var _value=_.values(obj).join("");if(""===_value){return false}return true}function rawRelationEditor(selection){var fromWay=context.graph().entity(fromWayId);var toWay=context.graph().entity(toWayId);var mRelations=[],pRelations=[];edit={};_(context.graph().parentRelations(fromWay)).each(function(relation){var crossOrmaat=relation.modelName===iD.data.DataType.C_NODECONN||relation.modelName===iD.data.DataType.NODECONN;if(crossOrmaat){if(compareMember(relation.members))mRelations.push(relation)}});maat=mRelations[0]||{};mRelations.forEach(function(mRelation){var rules=context.graph().parentRelations(mRelation),r;rules.forEach(function(rule){r=_.clone(rule);r=iD.util.merge({members:mRelation.members},r);pRelations.push(r)})});pRelations.forEach(function(relation){if(compareMember(relation.members)&&validateTags(relation.tags)){relations.push(relation)}});nodeDataType=context.graph().entity(nodeId).modelName||"";nodeDataType=-1<nodeDataType.indexOf("Node")?"NodeRule":"CrossRule";var modal=iD.ui.modal(selection);modal.select(".modal").classed("modal-alert",true);modal.select("button.close").style("display","none");var section=modal.select(".KDSEditor-content");var restriction=section.append("div").attr("class","traffic-area");restriction.append("div").attr("class","title").html("\u9650\u884C\u4FE1\u606F");var wrap=restriction.append("div");relationTemplate.layerId=fromWay.layerId;relationTemplate.layertype=fromWay.type;relationTemplate.version=1;relationTemplate.members=[{id:maat.id,role:"",type:"CrossRule"===nodeDataType?"CrossMaat":"NodeMaat"}];drawRestrictionList();function drawRestrictionList(){var fieldKey=iD.Layers.getLayer(fromWay.layerId).label.fieldKey||"name_chn";var items=wrap.html("");var aName=iD.util.displayName(fromWay,fieldKey)||"\u672A\u77E5\u9053\u8DEF";var bName=iD.util.displayName(toWay,fieldKey)||"\u672A\u77E5\u9053\u8DEF";items.append("div").attr("class","roadA-B").html("\u4ECE "+aName+" \u5230 "+bName+" \u7684\u9650\u884C\u4FE1\u606F: ");var dl=items.append("dl").attr("class","time-list");var dl_title=dl.append("dt");dl_title.append("b").html("\u65F6\u95F4\u9650\u5236");dl_title.append("b").html("\u5916\u57E0\u9650\u5236");dl_title.append("b").html("\u8F66\u8F86\u9650\u5236");dl_title.append("b").html("\u64CD\u4F5C");var dds=dl.selectAll("dd").data(relations);var enter=dds.enter().append("dd");enter.append("b").attr("class","time");enter.append("b").attr("class","outer");enter.append("b").attr("class","car");var opt=enter.append("b").attr("class","opt");opt.append("a").attr("class","edit").attr("href","javascript:void(0);").text("[\u7F16\u8F91]");opt.append("a").attr("class","del").attr("href","javascript:void(0);").text("[\u5220\u9664]");enter.select("b.time").html(function(d){var obj=analyzeSingleRelation(d);return obj.rule_time.time1+"-"+obj.rule_time.time2});enter.select("b.outer").html(function(d){var obj=analyzeSingleRelation(d);if(obj.isOuter){return"\u6709"}return"\u65E0"});enter.select("b.car").html(function(d){var obj=analyzeSingleRelation(d),cars=obj.vehicle,names=[];_(cars).each(function(o){names.push(o.name)});return names.join(",")});enter.select("a.edit").on("click",function(d){editRelation=d;drawRestrictionDetail()});enter.select("a.del").on("click",function(d){deleteRelations.push(context.graph().entity(d.id));var temp=[];_(relations).each(function(item,index){if(item.id!=d.id){temp.push(item)}});relations=temp;drawRestrictionList()});var bottom=items.append("div").attr("class","bottom");bottom.append("input").attr("type","button").attr("class","add-rule").property("value","\u6DFB\u52A0\u9650\u884C\u89C4\u5219").on("click",btnAddNewRule);bottom.append("input").attr("type","button").attr("class","apply").property("value","\u5E94\u7528").on("click",btnApply);bottom.append("input").attr("type","button").attr("class","cancel").property("value","\u53D6\u6D88").on("click",btnClose)}function drawRestrictionDetail(){if(editRelation){editRelation=analyzeSingleRelation(editRelation)}var items=wrap.html("");items.append("p").html("\u521B\u5EFA\u4E00\u6761\u9650\u884C\u89C4\u5219");var timeRule=items.append("p");var timeRuleItems=[{name:"\u5168\u5929\u9650\u5236",value:1,checked:true},{name:"",value:0,checked:false}];_(timeRuleItems).each(function(item){var timeRuleInput=timeRule.append("input").attr("type","radio").attr("class","timerule").attr("name","timerule").property("value",item.value).property("checked",item.checked).on("change",timeRuleChanage);if(editRelation){if(1===item.value){timeRuleInput.property("checked",editRelation.isAllDayLimit)}if(0===item.value){timeRuleInput.property("checked",!editRelation.isAllDayLimit)}}timeRule.append("label").html(item.name)});timeRule.append("label").html("\u5F00\u59CB:");var timeStartInput=timeRule.append("input").attr("type","text").attr("class","time_rule_time").attr("id","time_rule_time_start").property("value","08:00").property("disabled",true).call(bootstrap.timepicker().minuteStep(15).on("show",function(){items.selectAll("input.timerule").filter(function(index){return"0"==this.value}).property("checked",true);items.selectAll("input.time_rule_time").property("disabled",false)}));timeRule.append("label").html("\u7ED3\u675F:");var timeEndInput=timeRule.append("input").attr("type","text").attr("class","time_rule_time").attr("id","time_rule_time_end").property("value","17:00").property("disabled",true).call(bootstrap.timepicker().minuteStep(15).on("show",function(){items.selectAll("input.timerule").filter(function(index){return"0"==this.value}).property("checked",true);items.selectAll("input.time_rule_time").property("disabled",false)}));if(editRelation&&!editRelation.isAllDayLimit){timeStartInput.property("value",editRelation.rule_time.time1).property("disabled",false);timeEndInput.property("value",editRelation.rule_time.time2).property("disabled",false)}var outerRule=items.append("p");outerRule.append("input").attr("type","checkbox").attr("class","outrule").attr("name","outrule").property("value",2).property("checked",editRelation?editRelation.isOuter:false);outerRule.append("label").html("\u5916\u57E0\u9650\u5236");var carRule=items.append("div").attr("class","rule-list-info");carRule.append("h1").html("\u8F66\u8F86\u9650\u5236:");var cbList=carRule.selectAll(".item-type").data(_Util._cars,function(d){return d.id});var cbEnter=cbList.enter().append("div").attr("class","item-type");cbEnter.append("input").attr("type","checkbox").attr("class","car-value");cbEnter.append("label").attr("class","car-name");cbEnter.select("input.car-value").property("checked",function(d){if(editRelation){var cars=editRelation.vehicle,flag=false;if(_.find(cars,function(o){return 31===o.id})){flag=true}else{_(cars).each(function(o){if(o.id==d.id){flag=true;return false}})}return flag}return true}).property("disabled",function(d){if(editRelation){if(_.find(editRelation.vehicle,function(o){return 31===o.id})){if(31!==d.id){return true}}return false}return 31!==d.id}).on("change",carChange).attr("data-value",function(d){return d.id}).property("value",function(d){return d.id});cbEnter.select("label.car-name").html(function(d){return d.name});var bottom=items.append("div").attr("class","bottom");bottom.append("input").attr("type","button").attr("class","apply").on("click",btnEditRule).property("value",editRelation?"\u4FEE\u6539":"\u6DFB\u52A0");bottom.append("input").attr("type","button").attr("class","cancel").property("value","\u53D6\u6D88").on("click",btnCancel)}function timeRuleChanage(){d3.selectAll("input.time_rule_time").property("disabled","1"==this.value)}function analyzeSingleRelation(relation){var obj={};obj.id=relation.id;obj.rule_time=_Util._timeReverseTranfer(relation.tags.rule_time||"");obj.rule_type=relation.tags.rule_type||"1";obj.isOuter=false;var _ruleTypeBinary=[],_tempRuleType=_Util._10To2(obj.rule_type);_(_tempRuleType).each(function(item){_ruleTypeBinary.push(parseInt(item,10))});if(3!==_tempRuleType.length){for(var i=0,l=3-_tempRuleType.length;i<l;i++){_ruleTypeBinary.unshift(0)}}if(_ruleTypeBinary[1]){obj.isOuter=true}if(_ruleTypeBinary[2]){obj.isAllDayLimit=true}obj.vehicle=_Util._getCarNamesByHexadecimal(relation.tags.vehicle||"80000000");return obj};function carChange(d){var current=d3.select(this),cars=_.without(_.map(_Util._cars,function(item){return item.id}),31),inputs=d3.selectAll("input.car-value"),selectedIds=[];if(31===d.id){inputs.filter(function(item){return item.id!==d.id}).property("checked",this.checked).property("disabled",this.checked)}else{var allCarsObj=inputs.filter(function(item){return 31===item.id});inputs.filter(function(){return this.checked}).each(function(){var id=parseInt(this.value,10);if(31!==id){selectedIds.push(id)}});if(selectedIds.length===cars.length){allCarsObj.property("checked",true);inputs.filter(function(item){return 31!==item.id}).property("disabled",true)}}}function btnAddNewRule(){editRelation=null;drawRestrictionDetail()}function checkRuleTime(time1,time2){var time1Hour=parseInt(time1.split(":")[0],10),time1Minute=parseInt(time1.split(":")[1],10),time2Hour=parseInt(time2.split(":")[0],10),time2Minute=parseInt(time2.split(":")[1],10);if(time1Hour>time2Hour){return false}if(time1Hour==time2Hour&&time1Minute>time2Minute){return false}return true}function btnEditRule(){timeRuleObj.time1=d3.select("#time_rule_time_start").property("value");timeRuleObj.time2=d3.select("#time_rule_time_end").property("value");var timeRuleId=1;d3.selectAll("input.timerule").each(function(){if(this.checked){timeRuleId=parseInt(this.value,10)}});if(1===timeRuleId){timeRuleObj.time1="00:00";timeRuleObj.time2="24:00"}if("00:00"===timeRuleObj.time1&&"24:00"===timeRuleObj.time2){timeRuleId=1}ruleTypeBinary[2]=timeRuleId?1:0;if(0===timeRuleId&&!checkRuleTime(timeRuleObj.time1,timeRuleObj.time2)){alert("\u5F00\u59CB\u65F6\u95F4\u4E0D\u80FD\u5927\u4E8E\u7ED3\u675F\u65F6\u95F4\uFF01");return}var outRuleId=0;d3.selectAll("input.outrule").each(function(){if(this.checked){outRuleId=parseInt(this.value,10)}});ruleTypeBinary[1]=outRuleId?1:0;var carSelectedIds=[];d3.selectAll("input.car-value").each(function(){if(this.checked){carSelectedIds.push(parseInt(this.value,10))}});if(_.contains(carSelectedIds,31)||0===carSelectedIds.length){carSelectedIds=[31]}ruleTypeBinary[0]=_.contains(carSelectedIds,31)?0:1;var relation=iD.Relation();if(editRelation){relation.id=editRelation.id;edit[relation.id]=true}relation=_.extend(relation,_.clone(relationTemplate));relation.tags={};relation.modelName=nodeDataType;relation.tags.rule_type=_Util._2To10(ruleTypeBinary.join(""));relation.tags.rule_time=_Util._timeTranfer(timeRuleObj.time1,timeRuleObj.time2);relation.tags.vehicle=_Util._createHexadecimalBySelectedCars(carSelectedIds);relation.tags.mesh=context.entity(fromWayId).tags.mesh;if(!editRelation){relations.push(relation)}else{var temp=[];_(relations).each(function(r){if(r.id!=editRelation.id){temp.push(r)}});relations=temp;relations.push(relation)}editRelation=null;relation=null;drawRestrictionList()}function btnClose(){modal.close()}function btnCancel(){editRelation=null;drawRestrictionList()}function btnApply(){relations.forEach(function(v,k){context.graph().hasEntity(v.id)&&!edit[v.id]&&(relations[k]=context.graph().entity(v.id))});context.perform(iD.actions.EditRelation(context,relations,deleteRelations),"\u66F4\u65B0\u5173\u7CFB");btnClose()}};rawRelationEditor.nodeId=function(_){if(!arguments.length)return nodeId;nodeId=_;return rawRelationEditor};rawRelationEditor.fromWayId=function(_){if(!arguments.length)return fromWayId;fromWayId=_;return rawRelationEditor};rawRelationEditor.toWayId=function(_){if(!arguments.length)return toWayId;toWayId=_;return rawRelationEditor};return d3.rebind(rawRelationEditor,event,"on")};;iD.ui.confirm=function(selection){var modal=iD.ui.modal(selection);modal.select(".modal").classed("modal-alert",true);var section=modal.select(".KDSEditor-content");section.append("div").attr("class","modal-section KDSEditor-header");section.append("div").attr("class","modal-section message-text");var buttonwrap=section.append("div").attr("class","modal-section buttons cf");buttonwrap.append("button").attr("class","KDSEditor-col2 action").on("click.confirm",function(){modal.remove()}).text(t("confirm.okay"));return modal};;;iD.ui.Infowindow=function(context){var container,defaultContainer;function infowindow(selection){var opt=arguments[1][0][0];container=selection;infowindow.updateContent(opt);infowindow.updateSize(opt)}infowindow.updateContent=function(opt){if(!opt.content)return;container.html("");var wrap=container.append("div");var closeXDom=wrap.append("div").attr("class","KDSEditor-info-close"),outerDom=wrap.append("div").attr("class","KDSEditor-info-outer"),contentDom=outerDom.append("div").attr("class","KDSEditor-info-content");var core;if("object"===typeof opt.content){core=document.createElement("div"),core.appendChild(opt.content);contentDom.node().appendChild(core)}else{core=contentDom.append("div").html(opt.content)}var sharpDom=wrap.append("div").attr("class","KDSEditor-info-sharp");closeXDom.node().innerHTML="\xD7";closeXDom.href="javascript:void(0)";closeXDom.on("click",function(){context.event.closeinfowindow()});defaultContainer=contentDom;return infowindow};infowindow.updateSize=function(opt){if(!opt.size)return;var w=opt.size[0],h=opt.size[1];if(0<w){defaultContainer.node().style.width=w+"px";container.node().style.width=w+20+"px"}if(0<h)defaultContainer.node().style.height=h+"px";return infowindow};return infowindow};;iD.ui.LassoZoom=function(context){var tools=[iD.modes.LassoZoom(context),iD.modes.LassoZoom(context,true)];return function(selection){var button=selection.selectAll("button").data(tools).enter().append("button").attr("tabindex",-1).attr("class",function(d){if("lasso-zoomOut"===d.id)this.style.borderRadius=0;return d.id}).on("click.lassozoom",function(d){if(d.id===context.mode().id){context.enter(iD.modes.Browse(context))}else{context.enter(d)}}).call(bootstrap.tooltip().placement("left").html(true).title(function(d){return iD.ui.tooltipHtml(d.title,d.key)}));button.append("span").attr("class",function(d){return d.id+" icon"});context.on("enter.lasso_zoom",function(entered){button.classed("active",function(mode){return entered.button===mode.button});context.container().classed("mode-"+entered.id,true)});context.on("exit.lasso_zoom",function(exited){context.container().classed("mode-"+exited.id,false)})}};;;iD.ui.toolbar.Toolbar=function(context){var toolbar=[iD.modes.toolbar.Distance(context)];var keybinding=d3.keybinding("distance");return function(selection){var button=selection.selectAll("button").data(toolbar).enter().append("button").attr("tabindex",-1).attr("class",function(d){keybinding.on(d.key,function(){context.enter(iD.modes.Browse(context));context.enter(d)});return d.id}).on("click.toolbar",function(d){if(d.id===context.mode().id){context.enter(iD.modes.Browse(context))}else{context.enter(iD.modes.Browse(context));context.enter(d)}}).call(bootstrap.tooltip().placement("left").html(true).title(function(d){return iD.ui.tooltipHtml(d.title,d.key)}));button.append("span").attr("class",function(d){return d.id+" icon"});context.on("enter.toolbar",function(entered){button.classed("active",function(mode){return entered.button===mode.button});context.container().classed("mode-"+entered.id,true)});context.on("exit.toolbar",function(exited){context.container().classed("mode-"+exited.id,false)});context.map().on("move.toolbar",function(){});d3.select(document).call(keybinding)}};;;iD.ui.SublayerList=function(context){var layer,available=true;function sublayerList(selection){if(available){drawList();available=false}else{available=true;selection.selectAll(".KDSEditor-sublayer-list").remove()}function drawList(){var sublayers=layer.sublayers;if(sublayers&&sublayers.length){var layersArea=selection.selectAll(".KDSEditor-sublayer-list").data([0]).enter().append("ul").attr("class","KDSEditor-sublayer-list");var li=layersArea.filter(function(d){if(!d)return true}).selectAll("li").data(sublayers).enter().append("li");var label=li.append("label");var checkbox=label.append("input").attr("type","checkbox").attr("name","list").attr("value",function(d){return d.id}).each(function(d){if(d.display)this.setAttribute("checked",d.display)}).on("change",setSublayer);var span=label.append("span").text(function(d){return d.layerName})}function setSublayer(d){if(!d.display){d.display=true;context.connection().flush();context.connection().loadData(context.projection,context.map().dimensions())}else{d.display=false;context.map().center(context.map().center())}setButtonVisible(d)}function setButtonVisible(d){var rLayer=iD.Layers.getLayer();if(rLayer&&rLayer.isRoad()){var drawRCBtns=d3.selectAll(".KDSEditor-col6-1")}}}}sublayerList.layerInfo=function(_){if(!arguments.length)return layerInfo;layer=_;return sublayerList};return sublayerList};;;iD.ui.RoadSplitByMesh=function(context){var event=d3.dispatch("meshsplit"),vertexs;var modal;function getVertexIds(){if(!vertexs||!vertexs.length)return[];return _.map(vertexs,"id")}function roadSplitByMesh(selection){Dialog.alert("\u975E\u6CD5\u64CD\u4F5C\u70B9,\u4E09\u9636\u4EE5\u4E0A\u8282\u70B9:"+getVertexIds(),"","\u8DE8\u56FE\u5E45\u5207\u5206\u975E\u6CD5\u64CD\u4F5C");function drawTagsDetail(){var items=wrap.html("");items.append("p").html("\u975E\u6CD5\u64CD\u4F5C\u70B9");var carRule=items.append("div").attr("class","rule-list-info");carRule.append("h1").html("\u4E09\u9636\u4EE5\u4E0A\u8282\u70B9:");var cbList=carRule.selectAll(".item-type").data(getVertexIds(),function(d){return d});var cbEnter=cbList.enter().append("div").attr("class","item-type");cbEnter.append("label").attr("class","car-name");cbEnter.select("label.car-name").html(function(d){return d});var bottom=items.append("div").attr("class","bottom");bottom.append("input").attr("type","button").attr("class","cancel").on("click",btnClose).property("value","\u786E\u5B9A")}function btnClose(){modal.close()}};roadSplitByMesh.vertexs=function(_){if(!arguments.length)return vertexs;vertexs=_;return roadSplitByMesh};return d3.rebind(roadSplitByMesh,event,"on")};;iD.ui.MeshBoundryTip=function(context,callback){var event=d3.dispatch("meshboundry"),vertexs;function meshBoundryTip(selection){var modal=iD.ui.modal(selection);modal.select(".modal").classed("modal-alert",true);modal.select("button.close").style("display","none");var section=modal.select(".KDSEditor-content");var restriction=section.append("div").attr("class","traffic-area");restriction.append("div").attr("class","title").html("\u63D0\u793A");var wrap=restriction.append("div");drawTagsDetail();function drawTagsDetail(){var items=wrap.html("");items.append("p").html("\u975E\u6CD5\u64CD\u4F5C");var carRule=items.append("div").attr("class","rule-list-info");var cbList=carRule.selectAll(".item-type").data(["\u5DF2\u51FA\u5BF9\u8C61\u8FB9\u754C"],function(d){return d});var cbEnter=cbList.enter().append("div").attr("class","item-type");cbEnter.append("label").attr("class","car-name");cbEnter.select("label.car-name").html(function(d){return d});var bottom=items.append("div").attr("class","bottom");bottom.append("input").attr("type","button").attr("class","cancel").on("click",btnClose).property("value","\u786E\u5B9A")}function btnClose(){modal.close();if(callback){callback()}}};meshBoundryTip.vertexs=function(_){if(!arguments.length)return vertexs;vertexs=_;return meshBoundryTip};return d3.rebind(meshBoundryTip,event,"on")};;iD.ui.intro.navigation=function(context,reveal){var event=d3.dispatch("done"),timeouts=[];var step={title:"intro.navigation.title"};function set(f,t){timeouts.push(window.setTimeout(f,t))}step.enter=function(){var rect=context.surfaceRect(),map={left:rect.left+10,top:rect.top+70,width:rect.width-70,height:rect.height-170};context.map().centerZoom([-85.63591,41.94285],19);reveal(map,t("intro.navigation.drag"));context.map().on("move.intro",_.debounce(function(){context.map().on("move.intro",null);townhall();context.on("enter.intro",inspectTownHall)},400));function townhall(){var hall=[-85.63645945147184,41.942986488012565];var point=context.projection(hall);if(0>point[0]||point[0]>rect.width||0>point[1]||point[1]>rect.height){context.map().center(hall)}var box=iD.ui.intro.pointBox(hall,context);reveal(box,t("intro.navigation.select"));context.map().on("move.intro",function(){var box=iD.ui.intro.pointBox(hall,context);reveal(box,t("intro.navigation.select"),{duration:0})})}function inspectTownHall(mode){if("select"!==mode.id)return;context.on("enter.intro",null);context.map().on("move.intro",null);set(function(){reveal(".entity-editor-pane",t("intro.navigation.pane"));context.on("exit.intro",event.done)},700)}};step.exit=function(){context.map().on("move.intro",null);context.on("enter.intro",null);context.on("exit.intro",null);timeouts.forEach(window.clearTimeout)};return d3.rebind(step,event,"on")};;;iD.ui.intro.point=function(context,reveal){var event=d3.dispatch("done"),timeouts=[];var step={title:"intro.points.title"};function setTimeout(f,t){timeouts.push(window.setTimeout(f,t))}step.enter=function(){context.map().centerZoom([-85.63279,41.94394],19);reveal("button.add-point",t("intro.points.add"),{tooltipClass:"intro-points-add"});var corner=[-85.632481,41.944094];context.on("enter.intro",addPoint);function addPoint(mode){if("add-point"!==mode.id)return;context.on("enter.intro",enterSelect);var pointBox=iD.ui.intro.pad(corner,150,context);reveal(pointBox,t("intro.points.place"));context.map().on("move.intro",function(){pointBox=iD.ui.intro.pad(corner,150,context);reveal(pointBox,t("intro.points.place"),{duration:0})})}function enterSelect(mode){if("select"!==mode.id)return;context.map().on("move.intro",null);context.on("enter.intro",null);setTimeout(function(){reveal(".preset-search-input",t("intro.points.search",{name:context.presets().item("amenity/cafe").name()}));d3.select(".preset-search-input").on("keyup.intro",keySearch)},500)}function keySearch(){var first=d3.select(".preset-list-item:first-child");if(first.classed("preset-amenity-cafe")){reveal(first.select(".preset-list-button").node(),t("intro.points.choose"));d3.selection.prototype.one.call(context.history(),"change.intro",selectedPreset);d3.select(".preset-search-input").on("keydown.intro",function(){d3.event.stopPropagation();d3.event.preventDefault()},true).on("keyup.intro",null)}}function selectedPreset(){setTimeout(function(){reveal(".entity-editor-pane",t("intro.points.describe"),{tooltipClass:"intro-points-describe"});context.history().on("change.intro",closeEditor);context.on("exit.intro",selectPoint)},400)}function closeEditor(){d3.select(".preset-search-input").on("keydown.intro",null);context.history().on("change.intro",null);reveal(".entity-editor-pane",t("intro.points.close"))}function selectPoint(){context.on("exit.intro",null);context.history().on("change.intro",null);context.on("enter.intro",enterReselect);var pointBox=iD.ui.intro.pad(corner,150,context);reveal(pointBox,t("intro.points.reselect"));context.map().on("move.intro",function(){pointBox=iD.ui.intro.pad(corner,150,context);reveal(pointBox,t("intro.points.reselect"),{duration:0})})}function enterReselect(mode){if("select"!==mode.id)return;context.map().on("move.intro",null);context.on("enter.intro",null);setTimeout(function(){reveal(".entity-editor-pane",t("intro.points.fixname"));context.on("exit.intro",deletePoint)},500)}function deletePoint(){context.on("exit.intro",null);context.on("enter.intro",enterDelete);var pointBox=iD.ui.intro.pad(corner,150,context);reveal(pointBox,t("intro.points.reselect_delete"));context.map().on("move.intro",function(){pointBox=iD.ui.intro.pad(corner,150,context);reveal(pointBox,t("intro.points.reselect_delete"),{duration:0})})}function enterDelete(mode){if("select"!==mode.id)return;context.map().on("move.intro",null);context.on("enter.intro",null);context.on("exit.intro",deletePoint);context.map().on("move.intro",deletePoint);context.history().on("change.intro",deleted);setTimeout(function(){var node=d3.select(".radial-menu-item-delete").node();var pointBox=iD.ui.intro.pad(node.getBoundingClientRect(),50,context);reveal(pointBox,t("intro.points.delete"))},300)}function deleted(changed){if(changed.deleted().length)event.done()}};step.exit=function(){timeouts.forEach(window.clearTimeout);context.on("exit.intro",null);context.on("enter.intro",null);context.map().on("move.intro",null);context.history().on("change.intro",null);d3.select(".preset-search-input").on("keyup.intro",null).on("keydown.intro",null)};return d3.rebind(step,event,"on")};;;iD.ui.intro.area=function(context,reveal){var event=d3.dispatch("done"),timeout;var step={title:"intro.areas.title"};step.enter=function(){var playground=[-85.63552,41.94159],corner=[-85.63565411045074,41.9417715536927];context.map().centerZoom(playground,19);reveal("button.add-area",t("intro.areas.add"),{tooltipClass:"intro-areas-add"});context.on("enter.intro",addArea);function addArea(mode){if("add-area"!==mode.id)return;context.on("enter.intro",drawArea);var padding=120*Math.pow(2,context.map().zoom()-19);var pointBox=iD.ui.intro.pad(corner,padding,context);reveal(pointBox,t("intro.areas.corner"));context.map().on("move.intro",function(){padding=120*Math.pow(2,context.map().zoom()-19);pointBox=iD.ui.intro.pad(corner,padding,context);reveal(pointBox,t("intro.areas.corner"),{duration:0})})}function drawArea(mode){if("draw-area"!==mode.id)return;context.on("enter.intro",enterSelect);var padding=150*Math.pow(2,context.map().zoom()-19);var pointBox=iD.ui.intro.pad(playground,padding,context);reveal(pointBox,t("intro.areas.place"));context.map().on("move.intro",function(){padding=150*Math.pow(2,context.map().zoom()-19);pointBox=iD.ui.intro.pad(playground,padding,context);reveal(pointBox,t("intro.areas.place"),{duration:0})})}function enterSelect(mode){if("select"!==mode.id)return;context.map().on("move.intro",null);context.on("enter.intro",null);timeout=setTimeout(function(){reveal(".preset-search-input",t("intro.areas.search",{name:context.presets().item("leisure/playground").name()}));d3.select(".preset-search-input").on("keyup.intro",keySearch)},500)}function keySearch(){var first=d3.select(".preset-list-item:first-child");if(first.classed("preset-leisure-playground")){reveal(first.select(".preset-list-button").node(),t("intro.areas.choose"));d3.selection.prototype.one.call(context.history(),"change.intro",selectedPreset);d3.select(".preset-search-input").on("keyup.intro",null)}}function selectedPreset(){reveal(".pane",t("intro.areas.describe"));context.on("exit.intro",event.done)}};step.exit=function(){window.clearTimeout(timeout);context.on("enter.intro",null);context.on("exit.intro",null);context.history().on("change.intro",null);context.map().on("move.intro",null);d3.select(".preset-search-input").on("keyup.intro",null)};return d3.rebind(step,event,"on")};;;iD.ui.intro.line=function(context,reveal){var event=d3.dispatch("done"),timeouts=[];var step={title:"intro.lines.title"};function timeout(f,t){timeouts.push(window.setTimeout(f,t))}step.enter=function(){var centroid=[-85.6283,41.95699];var midpoint=[-85.62975395449628,41.95787501510204];var start=[-85.6297754121684,41.95805253325314];var intersection=[-85.62974496187628,41.95742515554585];context.map().centerZoom(start,18);reveal("button.add-line",t("intro.lines.add"),{tooltipClass:"intro-lines-add"});context.on("enter.intro",addLine);function addLine(mode){if("add-line"!==mode.id)return;context.on("enter.intro",drawLine);var padding=150*Math.pow(2,context.map().zoom()-18);var pointBox=iD.ui.intro.pad(start,padding,context);reveal(pointBox,t("intro.lines.start"));context.map().on("move.intro",function(){padding=150*Math.pow(2,context.map().zoom()-18);pointBox=iD.ui.intro.pad(start,padding,context);reveal(pointBox,t("intro.lines.start"),{duration:0})})}function drawLine(mode){if("draw-line"!==mode.id)return;context.history().on("change.intro",addIntersection);context.on("enter.intro",retry);var padding=300*Math.pow(2,context.map().zoom()-19);var pointBox=iD.ui.intro.pad(midpoint,padding,context);reveal(pointBox,t("intro.lines.intersect"));context.map().on("move.intro",function(){padding=300*Math.pow(2,context.map().zoom()-19);pointBox=iD.ui.intro.pad(midpoint,padding,context);reveal(pointBox,t("intro.lines.intersect"),{duration:0})})}function retry(mode){if("select"!==mode.id)return;var pointBox=iD.ui.intro.pad(intersection,30,context);reveal(pointBox,t("intro.lines.restart"));timeout(function(){context.replace(iD.actions.DeleteMultiple(mode.selectedIDs()));step.exit();step.enter()},3000)}function addIntersection(changes){if(_.any(changes.created(),function(d){return"node"===d.type&&1<context.graph().parentWays(d).length})){context.history().on("change.intro",null);context.on("enter.intro",enterSelect);var padding=900*Math.pow(2,context.map().zoom()-19);var pointBox=iD.ui.intro.pad(centroid,padding,context);reveal(pointBox,t("intro.lines.finish"));context.map().on("move.intro",function(){padding=900*Math.pow(2,context.map().zoom()-19);pointBox=iD.ui.intro.pad(centroid,padding,context);reveal(pointBox,t("intro.lines.finish"),{duration:0})})}}function enterSelect(mode){if("select"!==mode.id)return;context.map().on("move.intro",null);context.on("enter.intro",null);d3.select("#curtain").style("pointer-events","all");presetCategory()}function presetCategory(){timeout(function(){d3.select("#curtain").style("pointer-events","none");var road=d3.select(".preset-category-road .preset-list-button");reveal(road.node(),t("intro.lines.road"));road.one("click.intro",roadCategory)},500)}function roadCategory(){timeout(function(){var grid=d3.select(".subgrid");reveal(grid.node(),t("intro.lines.residential"));grid.selectAll(":not(.preset-highway-residential) .preset-list-button").one("click.intro",retryPreset);grid.selectAll(".preset-highway-residential .preset-list-button").one("click.intro",roadDetails)},500)}function retryPreset(){timeout(function(){var preset=d3.select(".entity-editor-pane .preset-list-button");reveal(preset.node(),t("intro.lines.wrong_preset"));preset.one("click.intro",presetCategory)},500)}function roadDetails(){reveal(".pane",t("intro.lines.describe"));context.on("exit.intro",event.done)}};step.exit=function(){d3.select("#curtain").style("pointer-events","none");timeouts.forEach(window.clearTimeout);context.on("enter.intro",null);context.on("exit.intro",null);context.map().on("move.intro",null);context.history().on("change.intro",null)};return d3.rebind(step,event,"on")};;;iD.ui.intro.startEditing=function(context,reveal){var event=d3.dispatch("done","startEditing"),modal,timeouts=[];var step={title:"intro.startediting.title"};function timeout(f,t){timeouts.push(window.setTimeout(f,t))}step.enter=function(){reveal(".map-control.help-control",t("intro.startediting.help"));timeout(function(){reveal("#KDSEditor-bar button.save",t("intro.startediting.save"))},3500);timeout(function(){reveal("#surface")},7000);timeout(function(){modal=iD.ui.modal(context.container());modal.select(".modal").attr("class","modal-splash modal KDSEditor-col6");modal.selectAll(".close").remove();var startbutton=modal.select(".KDSEditor-content").attr("class","KDSEditor-fillL").append("button").attr("class","modal-section huge-modal-button").on("click",function(){modal.remove()});startbutton.append("div").attr("class","illustration");startbutton.append("h2").text(t("intro.startediting.start"));event.startEditing()},7500)};step.exit=function(){if(modal)modal.remove();timeouts.forEach(window.clearTimeout)};return d3.rebind(step,event,"on")};;;iD.actions={};;;iD.actions.AddMidpoint=function(midpoint,node){return function(graph){graph=graph.replace(node.move(midpoint.loc));var parents=_.intersection(graph.parentWays(graph.entity(midpoint.edge[0])),graph.parentWays(graph.entity(midpoint.edge[1])));parents.forEach(function(way){for(var i=0;i<way.nodes.length-1;i++){if(iD.geo.edgeEqual([way.nodes[i],way.nodes[i+1]],midpoint.edge)){way.tags=iD.util.tagExtend.updateTaskTag(way);graph=graph.replace(way);graph=graph.replace(way.addNode(node.id,i+1));return}}});return graph}};;;iD.actions.AddMember=function(relationId,member,memberIndex){return function(graph){var relation=graph.entity(relationId);if(isNaN(memberIndex)&&"way"===member.type){var members=relation.indexedMembers();members.push(member);var joined=iD.geo.joinWays(members,graph);for(var i=0;i<joined.length;i++){var segment=joined[i];for(var j=0;j<segment.length&&2<=segment.length;j++){if(segment[j]!==member)continue;if(0===j){memberIndex=segment[j+1].index}else if(j===segment.length-1){memberIndex=segment[j-1].index+1}else{memberIndex=Math.min(segment[j-1].index+1,segment[j+1].index+1)}}}}return graph.replace(relation.addMember(member,memberIndex))}};;;iD.actions.AddEntity=function(entity){return function(graph){return graph.replace(entity)}};;;iD.actions.AddVertex=function(wayId,nodeId,index){return function(graph){let way=graph.entity(wayId);way.tags=iD.util.tagExtend.updateTaskTag(way);graph=graph.replace(way);return graph.replace(way.addNode(nodeId,index))}};;;iD.actions.SplitRoad=function(selectIDs,context,targetId){var action=function(graph){var nodes=_.uniq(selectIDs).map(function(id){var node=graph.entity(id);return node});var targets=[targetId];var insertNodes=_.uniq(selectIDs);_.uniq(nodes).forEach(function(node){var parentWays=graph.parentWays(node);_.uniq(parentWays).forEach(function(way,i){if(1<parentWays.length&&0>targets.indexOf(way.id))return;var nodeIndex=way.nodes.indexOf(node.id);var newNodeIds=way.nodes.slice(nodeIndex);var newWay=iD.Way({layerId:way.layerId,nodes:[],modelName:way.modelName,tags:way.tags});graph=graph.replace(newWay);var newWayId;var wayA=way.update({id:newWayId});_.uniq(newNodeIds).forEach(function(id){if(id!=node.id){wayA=wayA.removeNode(id);graph=graph.replace(wayA)}});wayA=wayA.mergeTags(iD.util.tagExtend.updateTaskTag(wayA));graph=graph.replace(wayA);newWay=graph.entity(newWay.id);_.uniq(newNodeIds).forEach(function(id){newWay=newWay.addNode(id);newWay=newWay.mergeTags(iD.util.tagExtend.updateTaskTag(newWay));graph=graph.replace(newWay)});var isRoad=iD.Layers.getLayer(wayA.layerId).isRoad();if(isRoad&&!way.isNew()){wayA.new_id_inherit=iD.Entity.id.toOSM(way.id)+"-";newWay.new_id_inherit=iD.Entity.id.toOSM(way.id)+"-"}else if(isRoad&&way.new_id_inherit){wayA.new_id_inherit=way.new_id_inherit;newWay.new_id_inherit=way.new_id_inherit}if(2<wayA.nodes.length){var indexA=wayA.nodes.length;var shapeANode=graph.entity(wayA.nodes[indexA-2]);var lon=iD.util.lassExtend.getDistance({lon:shapeANode.loc[0],lat:shapeANode.loc[1]},{lon:node.loc[0],lat:node.loc[1]});if(lon<iD.data.distance){wayA=wayA.removeNode(shapeANode.id);graph=graph.replace(wayA)}}if(2<newWay.nodes.length){var shapeBNode=graph.entity(newWay.nodes[1]);var lon=iD.util.lassExtend.getDistance({lon:shapeBNode.loc[0],lat:shapeBNode.loc[1]},{lon:node.loc[0],lat:node.loc[1]});if(lon<iD.data.distance){newWay=newWay.removeNode(shapeBNode.id);graph=graph.replace(newWay)}}var handle=iD.topo.handle();graph=handle.break(context,graph,way,wayA,newWay,node,insertNodes);wayA=graph.entity(wayA.id);newWay=graph.entity(newWay.id);wayA=iD.util.tagExtend.updateWayLengthTag(graph,wayA);newWay=iD.util.tagExtend.updateWayLengthTag(graph,newWay);newWay=newWay.mergeTags(iD.util.tagExtend.updateTaskTag(newWay));wayA=newWay.mergeTags(iD.util.tagExtend.updateTaskTag(wayA));graph=graph.replace(wayA);graph=graph.replace(newWay);if(way.modelName==iD.data.DataType.ROAD){var fNode=way.nodes[0];var tNode=way.nodes[way.nodes.length-1];var topoEntity=iD.TopoEntity();var crossNodeIdA=topoEntity.isInCrossNode(graph,fNode);var crossNodeIdB=topoEntity.isInCrossNode(graph,tNode);if(false!=crossNodeIdA&&crossNodeIdA==crossNodeIdB){graph=iD.actions.RoadCrossModify([crossNodeIdA,node.id])(graph)}}targets.push(wayA.id);targets.push(newWay.id);graph=iD.actions.DeleteWay(way.id)(graph);node=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,node)});graph=graph.replace(node)});selectIDs.length=0;return graph};action.disabled=function(graph){return false};return action};;iD.actions.SplitDivider=function(nodeId,context,fromDA){var wayIds;function split(graph,way,newWayId){var wayB=iD.Way({id:newWayId,layerId:way.layerId,modelName:way.modelName,tags:iD.util.getDefauteTags(way)});wayB=wayB.mergeTags(iD.util.tagExtend.updateTaskTag(way));var nodesA,nodesB;var idx=_.indexOf(way.nodes,nodeId,1);nodesA=way.nodes.slice(0,idx+1);nodesB=way.nodes.slice(idx);var newWay=iD.Way({layerId:way.layerId,nodes:nodesA,modelName:way.modelName,tags:iD.util.getDefauteTags(way)});newWay=newWay.mergeTags(iD.util.tagExtend.updateTaskTag(way));graph=graph.replace(newWay);wayB.modelName=way.modelName;wayB=wayB.update({nodes:nodesB});graph=graph.replace(wayB);if(fromDA){var lastWay;if("3"==way.tags.DIRECTION){lastWay=newWay}else{lastWay=wayB}lastWay.nodes.forEach(function(nid){var rels=[];rels.push(...graph.parentRelations(graph.entity(nid),iD.data.DataType.DIVIDER_ATTRIBUTE));rels.push(...graph.parentRelations(graph.entity(nid),iD.data.DataType.LANE_ATTRIBUTE));rels.forEach(r=>{r=r.replaceMember(way,lastWay);graph=graph.replace(r)})})}var handle=iD.topo.handle();if("3"==way.tags.DIRECTION){wayB=wayB.mergeTags(iD.util.tagExtend.updateTaskTag(way));graph=graph.replace(wayB);graph=handle.break(context,graph,way,wayB,newWay,graph.entity(nodeId),fromDA)}else{newWay=newWay.mergeTags(iD.util.tagExtend.updateTaskTag(way));graph=graph.replace(newWay);graph=handle.break(context,graph,way,newWay,wayB,graph.entity(nodeId),fromDA)}return graph}var action=function(graph){var candidates=action.ways(graph);for(var i=0;i<candidates.length;i++){graph=split(graph,candidates[i]);graph=iD.actions.DeleteWay(candidates[i].id)(graph)}var nodee=graph.entity(nodeId);graph=graph.replace(nodee);return graph};action.ways=function(graph){var node=graph.entity(nodeId),parents=graph.parentWays(node),hasLines=_.any(parents,function(parent){return"line"===parent.geometry(graph)});return parents.filter(function(parent){if(wayIds&&-1===wayIds.indexOf(parent.id))return false;if(!wayIds&&hasLines&&"line"!==parent.geometry(graph))return false;if(parent.isClosed()){return true}for(var i=1;i<parent.nodes.length-1;i++){if(parent.nodes[i]===nodeId){return true}}return false})};action.disabled=function(graph){var candidates=action.ways(graph);if(0===candidates.length||wayIds&&wayIds.length!==candidates.length)return"not_eligible"};action.cpContext=function(context){action.context=context};return action};;;iD.actions.SplitDividingLine=function(selectIDs,breakWayIds,context,fromPicPlayer){function getWays(graph,splitway){let ways=[];let extent=context.map().extent().intersection(splitway.extent(graph));let entitys=context.intersects(extent);ways=_.uniq(entitys);return _.filter(ways,function(d){return d&&d.type===iD.data.GeomType.WAY&&d.id!=splitway.id&&d.modelName===iD.data.DataType.DIVIDER})}function getWaysFPic(graph){let ways=[];if(breakWayIds&&breakWayIds.length){ways=_.map(breakWayIds,function(wid){return context.hasEntity(wid)});ways=_.uniq(ways)}return _.filter(ways,function(d){return d&&d.type===iD.data.GeomType.WAY&&d.modelName===iD.data.DataType.DIVIDER})}var action=function(graph){if(fromPicPlayer){graph=splitDividersFPic(graph)}else{graph=splitDividers(graph)}return graph};function splitDividers(graph){if(1!=selectIDs.length){return graph}let splitWay=graph.entity(selectIDs[0]);let ways=getWays(graph,splitWay);let splitWayNodes=splitWay.nodes;var lineCalute=iD.util.LineCalCulate();ways.forEach(way=>{let locs=lineCalute.getIntersectLoc(splitWayNodes,way.nodes,graph);if(!locs.length)return false;graph=splitWayByCrossLocs(graph,way,locs)});graph=iD.actions.DeleteWay(splitWay.id)(graph);if(!ways.length){context.undo()}selectIDs.length=0;return graph}function splitDividersFPic(graph){if(2>selectIDs.length){return graph}let ways=getWaysFPic(graph);let splitNodeLocs=selectIDs;ways.forEach((way,idx)=>{let locs=iD.util.getIntersectLoc(splitNodeLocs,way.nodes,graph);if(!locs.length)return false;graph=splitWayByCrossLocs(graph,way,locs,idx)});if(!ways.length){context.undo()}selectIDs.length=0;return graph}function splitWayByCrossLocs(graph,way,crossLocs,wayidx){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);crossLocs.forEach(loc=>{let choice=iD.geo.chooseEdge(graph.childNodes(way),context.projection(loc),context.projection);let edge=[way.nodes[choice.index-1],way.nodes[choice.index]];let node=iD.Node({layerId:currentLayer.id,loc:loc,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,currentLayer),modelName:iD.data.DataType.DIVIDER_NODE});graph=iD.actions.AddMidpoint({loc:loc,edge:edge},node)(graph);graph=iD.actions.Disconnect(node.id,[way.id])(graph);var player=iD.picUtil.player;if(fromPicPlayer&&player){var handle=iD.measureinfo.handle();let picData=iD.AutoMatch.locsToPicPlayer([loc],player)[0];if(picData&&0==wayidx){let xy=picData.coordinates[0];graph=handle.addEntity(graph,node,{type:4,method:8,trackPointId:player.pic_point.tags.trackPointId,trackId:player.dataMgr.trackId,imgOffset:{x:parseInt(xy[0]),y:parseInt(xy[1])}})}}});return graph}action.disabled=function(graph){return false};return action};;iD.actions.ChangeTags=function(entityId,tags){return function(graph){var entity=graph.entity(entityId);var lay=iD.Layers.getLayer(entity.layerId);if(lay&&lay.tagReadOnly){return graph}function isUpdateTag(fieldName,value){if(_.isArray(value)){if(value.includes(entity.tags[fieldName])){return!value.includes(tags[fieldName])}else{return value.includes(tags[fieldName])}}return entity.tags[fieldName]==value&&tags[fieldName]!=value}if(entity.modelName==iD.data.DataType.DIVIDER){if(isUpdateTag("R_LINE","1")){let relationNames=[iD.data.DataType.R_ROAD_DIVIDER,iD.data.DataType.R_DIVIDER_TL,iD.data.DataType.R_DIVIDER_DREF,iD.data.DataType.R_DIVIDER_OPL,iD.data.DataType.R_DIVIDER_OPG];var flag=false;for(var relName of relationNames){var rels=graph.parentRelations(entity,relName);for(var relation of rels){flag=true;graph=iD.actions.DeleteRelation(relation.id)(graph)}}if(flag){Dialog.alert("\u6E05\u7A7A\u53C2\u8003\u7EBF\u4E0A\u8F66\u9053\u7EBF\u5206\u7EC4\uFF0C\u4EE5\u53CA\u5173\u8054\u7684\u5173\u7CFB\u3002",null,null,null,null,{AutoClose:3})}}}else if(entity.modelName==iD.data.DataType.OBJECT_PL){if(isUpdateTag("TYPE","2")||"2"==entity.tags.TYPE&&isUpdateTag("SUBTYPE",["1","2",1,2])){var flag=false;var rels=graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_OPL);for(var relation of rels){flag=true;graph=iD.actions.DeleteRelation(relation.id)(graph)}if(flag){Dialog.alert("\u6E05\u7A7A \u53C2\u8003\u7EBF/\u505C\u6B62\u7EBF \u5173\u8054\u5173\u7CFB\u3002",null,null,null,null,{AutoClose:3})}}}else if(entity.modelName==iD.data.DataType.OBJECT_PG){if(isUpdateTag("TYPE","3")||"3"==entity.tags.TYPE&&isUpdateTag("SUBTYPE","7")){var flag=false;var rels=graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_OPG);for(var relation of rels){flag=true;graph=iD.actions.DeleteRelation(relation.id)(graph)}if(flag){Dialog.alert("\u6E05\u7A7A \u53C2\u8003\u7EBF/\u4EBA\u884C\u6A2A\u9053 \u5173\u8054\u5173\u7CFB\u3002",null,null,null,null,{AutoClose:3})}}}return graph.replace(entity.update({tags:iD.util.tagExtend.updateTaskTag(entity,tags)}))}};;;iD.actions.Circularize=function(wayId,projection,maxAngle){maxAngle=(maxAngle||20)*Math.PI/180;var action=function(graph){var way=graph.entity(wayId);if(!way.isConvex(graph)){graph=action.makeConvex(graph)}var nodes=_.uniq(graph.childNodes(way)),keyNodes=nodes.filter(function(n){return 1!==graph.parentWays(n).length}),points=nodes.map(function(n){return projection(n.loc)}),keyPoints=keyNodes.map(function(n){return projection(n.loc)}),centroid=2===points.length?iD.geo.interp(points[0],points[1],0.5):d3.geom.polygon(points).centroid(),radius=d3.median(points,function(p){return iD.geo.euclideanDistance(centroid,p)}),sign=0<d3.geom.polygon(points).area()?1:-1,ids;if(!keyNodes.length){keyNodes=[nodes[0]];keyPoints=[points[0]]}if(1===keyNodes.length){var index=nodes.indexOf(keyNodes[0]),oppositeIndex=Math.floor((index+nodes.length/2)%nodes.length);keyNodes.push(nodes[oppositeIndex]);keyPoints.push(points[oppositeIndex])}for(var i=0;i<keyPoints.length;i++){var nextKeyNodeIndex=(i+1)%keyNodes.length,startNode=keyNodes[i],endNode=keyNodes[nextKeyNodeIndex],startNodeIndex=nodes.indexOf(startNode),endNodeIndex=nodes.indexOf(endNode),numberNewPoints=-1,indexRange=endNodeIndex-startNodeIndex,distance,totalAngle,eachAngle,startAngle,endAngle,angle,loc,node,j,inBetweenNodes=[];if(0>indexRange){indexRange+=nodes.length}distance=iD.geo.euclideanDistance(centroid,keyPoints[i]);if(0===distance){distance=1e-4}keyPoints[i]=[centroid[0]+(keyPoints[i][0]-centroid[0])/distance*radius,centroid[1]+(keyPoints[i][1]-centroid[1])/distance*radius];graph=graph.replace(keyNodes[i].move(projection.invert(keyPoints[i])));startAngle=Math.atan2(keyPoints[i][1]-centroid[1],keyPoints[i][0]-centroid[0]);endAngle=Math.atan2(keyPoints[nextKeyNodeIndex][1]-centroid[1],keyPoints[nextKeyNodeIndex][0]-centroid[0]);totalAngle=endAngle-startAngle;if(0<totalAngle*sign){totalAngle=-sign*(2*Math.PI-Math.abs(totalAngle))}do{numberNewPoints++;eachAngle=totalAngle/(indexRange+numberNewPoints)}while(Math.abs(eachAngle)>maxAngle);for(j=1;j<indexRange;j++){angle=startAngle+j*eachAngle;loc=projection.invert([centroid[0]+Math.cos(angle)*radius,centroid[1]+Math.sin(angle)*radius]);node=nodes[(j+startNodeIndex)%nodes.length].move(loc);graph=graph.replace(node)}var layerId;for(j=0;j<numberNewPoints;j++){angle=startAngle+(indexRange+j)*eachAngle;loc=projection.invert([centroid[0]+Math.cos(angle)*radius,centroid[1]+Math.sin(angle)*radius]);layerId=node.layerId||"";node=iD.Node({loc:loc,layerId});graph=graph.replace(node);nodes.splice(endNodeIndex+j,0,node);inBetweenNodes.push(node.id)}if(1===indexRange&&inBetweenNodes.length){var startIndex1=way.nodes.lastIndexOf(startNode.id),endIndex1=way.nodes.lastIndexOf(endNode.id),wayDirection1=endIndex1-startIndex1;if(-1>wayDirection1){wayDirection1=1}_.each(_.without(graph.parentWays(keyNodes[i]),way),function(sharedWay){if(sharedWay.areAdjacent(startNode.id,endNode.id)){var startIndex2=sharedWay.nodes.lastIndexOf(startNode.id),endIndex2=sharedWay.nodes.lastIndexOf(endNode.id),wayDirection2=endIndex2-startIndex2,insertAt=endIndex2;if(-1>wayDirection2){wayDirection2=1}if(wayDirection1!==wayDirection2){inBetweenNodes.reverse();insertAt=startIndex2}for(j=0;j<inBetweenNodes.length;j++){sharedWay=sharedWay.addNode(inBetweenNodes[j],insertAt+j)}graph=graph.replace(sharedWay)}})}}ids=nodes.map(function(n){return n.id});ids.push(ids[0]);way=way.update({nodes:ids});graph=graph.replace(way);return graph};action.makeConvex=function(graph){var way=graph.entity(wayId),nodes=_.uniq(graph.childNodes(way)),points=nodes.map(function(n){return projection(n.loc)}),sign=0<d3.geom.polygon(points).area()?1:-1,hull=d3.geom.hull(points);if(-1===sign){nodes.reverse();points.reverse()}for(var i=0;i<hull.length-1;i++){var startIndex=points.indexOf(hull[i]),endIndex=points.indexOf(hull[i+1]),indexRange=endIndex-startIndex;if(0>indexRange){indexRange+=nodes.length}for(var j=1;j<indexRange;j++){var point=iD.geo.interp(hull[i],hull[i+1],j/indexRange),node=nodes[(j+startIndex)%nodes.length].move(projection.invert(point));graph=graph.replace(node)}}return graph};action.disabled=function(graph){if(!graph.entity(wayId).isClosed())return"not_closed"};return action};;;iD.actions.Connect=function(context,nodeIds){return function(graph){var survivor=graph.entity(_.last(nodeIds));if(graph.isPoi(survivor))return graph;var node=graph.entity(nodeIds[0]);if(node.modelName==iD.data.DataType.ROAD_NODE){if(node.modelName!=survivor.modelName){return graph}var idInheritStr="";if(survivor.new_id_inherit){idInheritStr=idInheritStr+survivor.new_id_inherit+","}if(node.new_id_inherit){idInheritStr=idInheritStr+node.new_id_inherit+","}survivor.new_id_inherit=idInheritStr+iD.Entity.id.toOSM(node.id)+"+";var parentWays=graph.parentWays(node);for(var i=0;i<parentWays.length;i++){var parent=parentWays[i];if(!parent.isOneRoadCrossWay()){graph=graph.replace(parent.update({tags:iD.util.tagExtend.updateTaskTag(parent)}));graph=graph.replace(parent.replaceNode(node.id,survivor.id))}}graph=iD.topo.handle().nodeMerge(context,graph,graph.entity(node.id),graph.entity(survivor.id))}else{graph.parentWays(node).forEach(function(parent){if(!parent.areAdjacent(node.id,survivor.id)){survivor.mergeTags(node.tags);graph=graph.replace(survivor.update({tags:iD.util.tagExtend.updateTaskTag(survivor)}));graph=graph.replace(parent.replaceNode(node.id,survivor.id))}})}if(survivor.modelName==iD.data.DataType.ROAD_NODE){survivor=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,survivor)}var defaultTags=iD.util.getDefauteTags(iD.data.DataType.ROAD_NODE,iD.Layers.getLayer(survivor.layerId));survivor.tags=defaultTags;graph=iD.actions.AddEntity(survivor)(graph);graph=iD.actions.DeleteNode(node.id)(graph);if(0==graph.parentWays(survivor).length){graph=graph.remove(survivor)}return graph}};;;iD.actions.DeleteMember=function(relationId,memberIndex){return function(graph){var relation=graph.entity(relationId).removeMember(memberIndex);graph=graph.replace(relation);if(relation.isDegenerate())graph=iD.actions.DeleteRelation(relation.id)(graph);return graph}};;;iD.actions.DeleteMultiple=function(ids,context){var actions={way:iD.actions.DeleteWay,node:iD.actions.DeleteNode,relation:iD.actions.DeleteRelation};var action=function(graph){ids.forEach(function(id){if(graph.hasEntity(id)){graph=actions[graph.entity(id).type](id,context)(graph)}});return graph};action.disabled=function(graph){let ftype;for(var i=0;i<ids.length;i++){var id=ids[i],disabled;let entity=graph.hasEntity(id);if(entity){if(!ftype){ftype=entity.type}if(ftype!=entity.type){return"multi_type"}disabled=actions[graph.entity(id).type](id).disabled(graph);if(disabled)return disabled}else{if(i===ids.length-1)return false}}};return action};;;iD.actions.WayAddNodes=function(wayid,_nodes,index){return function(graph){let way=graph.entity(wayid);for(let node of _nodes){graph=graph.replace(node)}let nodesids=_.pluck(_nodes,"id");let nodes=_.clone(way.nodes);nodes.splice(index===undefined?nodes.length:index,0,...nodesids);return graph.replace(way.update({nodes:nodes}))}};;;iD.actions.DeleteNode=function(nodeId,context){var key="datatype",value="RoadNode";function deleteNode(graph,node){return 0==graph.parentWays(node).length}function deleteObjectPtRelation(graph,node){return graph;if(node.modelName!=iD.data.DataType.OBJECT_PT){return graph}var relations=context.graph().parentRelations(node,iD.data.DataType.R_OPT_OPT)||[];relations.forEach(function(rel){graph=graph.remove(rel);for(let i in rel.members){let subnode=graph.hasEntity(rel.members[i].id);if(subnode&&subnode.id!=node.id){graph=graph.remove(subnode)}}});return graph}var action=function(graph){var node=graph.entity(nodeId);var pWays=graph.parentWays(node);function deleteRoadCrossMember(way,graph){var cross_id=way.nodes[0],cross_node_id=way.nodes[1],members=[].concat(graph.entity(cross_id).members),member;for(var i=0;i<members.length;i++){member=members[i];member.id===cross_node_id&&(members.splice(i,1),i--)}graph=iD.actions.ChangeNodeMember(cross_id,members)(graph);if(1>=graph.entity(cross_id).members.length){graph=iD.actions.DeleteNode(cross_id)(graph)}return graph.remove(way)}var flag=false;graph.parentWays(node).forEach(function(parent){if(parent.isOneRoadCrossWay()){if(node.isRoadCross()){graph=iD.actions.DeleteWay(parent.id)(graph)}}else if(1==graph.parentWays(node).length&&parent.last()!=node.id&&parent.first()!=node.id){if(parent.isArea&&parent.isArea()&&3==parent.nodes.length){graph=graph.remove(parent)}else if(2==parent.nodes.length){graph=graph.remove(parent)}else{parent=parent.removeNode(node.id);parent=iD.util.tagExtend.updateWayLengthTag(graph,parent);parent.tags=iD.util.tagExtend.updateTaskTag(parent);graph=graph.replace(parent)}}});graph.parentRelations(node).forEach(function(parent){graph=iD.actions.DeleteRelation(parent.id)(graph)});return graph.remove(node)};action.disabled=function(){return false};return action};;;iD.actions.DeleteRelation=function(relationId){function deleteEntity(entity,graph){return!graph.parentWays(entity).length&&!graph.parentRelations(entity).length&&!entity.hasInterestingTags()}var action=function(graph){var relation=graph.entity(relationId);graph.parentRelations(relation).forEach(function(parent){graph=iD.actions.DeleteRelation(parent.id)(graph)});return graph.remove(relation)};action.disabled=function(graph){if(!graph.entity(relationId).isComplete(graph))return"incomplete_relation"};return action};;;iD.actions.DeleteWay=function(wayId){function deleteNode(node,graph){var i=0;graph.parentWays(node).forEach(function(way){if(!way.isOneRoadCrossWay()){i++}});return 0==i}function getWayBBox(graph,wayA,epsion){var nodes=wayA.nodes;var maxLat=-Infinity,minLat=Infinity,maxLon=-Infinity,minLon=Infinity;nodes.forEach(function(nodeId){var node=graph.entity(nodeId);var loc=node.loc;if(loc[0]>maxLon){maxLon=loc[0]}if(loc[0]<minLon){minLon=loc[0]}if(loc[1]>maxLat){maxLat=loc[1]}if(loc[1]<minLat){minLat=loc[1]}});return[[minLon-epsion,minLat-epsion],[maxLon+epsion,maxLat+epsion]]}function deleteWalkEnterAreaId(graph,area){var bbox=getWayBBox(graph,area,0.000001),all=editor.context.intersects(bbox),areaid=area.id.slice(area.id.indexOf("_")+1),wkenters=[];all.forEach(function(entity){if(entity instanceof iD.Node&&entity.modelName==iD.data.DataType.WALKENTER){if(entity.tags.area_id==areaid){wkenters.push(entity)}}});wkenters.forEach(function(node){node=node.mergeTags({area_id:""});graph=graph.replace(node)});return graph}var action=function(graph){var way=graph.entity(wayId);var fNode=graph.entity(way.first());var tNode=graph.entity(way.last());var fways=graph.parentWays(fNode);var tways=graph.parentWays(tNode);if(1==fways.length){var defaultNode=iD.util.getDefauteTags(fNode.modelName,iD.Layers.getLayer(fNode.layerId));fNode.tags=defaultNode}else{fNode.tags=iD.util.tagExtend.updateTaskTag(fNode)}if(1==tways.length){var defaultNode=iD.util.getDefauteTags(tNode.modelName,iD.Layers.getLayer(tNode.layerId));tNode.tags=defaultNode}else{tNode.tags=iD.util.tagExtend.updateTaskTag(tNode)}if("undefined"!=typeof way.modelName&&way.modelName==iD.data.DataType.WALKAREA){graph=deleteWalkEnterAreaId(graph,way)}if(!way.isOneRoadCrossWay()){graph.parentRelations(way).forEach(function(parent){graph=iD.actions.DeleteRelation(parent.id)(graph)});_.uniq(way.nodes).forEach(function(nodeId){way=way.removeNode(nodeId);graph=graph.replace(way);if(graph.hasEntity(nodeId)){var node=graph.entity(nodeId);if(deleteNode(node,graph)&&node.modelName!==iD.data.Constant.C_NODE){graph=iD.actions.DeleteNode(node.id)(graph)}}})}graph=graph.remove(way);if(graph.hasEntity(fNode.id)!=undefined){fNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,fNode);graph=graph.replace(fNode);graph=iD.util.tagExtend.updateRelationsTagsByRealNode(graph,fNode)}if(graph.hasEntity(tNode.id)!=undefined){tNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,tNode);graph=graph.replace(tNode);graph=iD.util.tagExtend.updateRelationsTagsByRealNode(graph,tNode)}return graph};action.disabled=function(){return false};return action};;;iD.actions.RoadCrossAdd=function(context,selectedIDs,roadCrossNode){var getMembers=function(ids,graph){var members=[];for(var i=0,l=ids.length;i<l;i++){var entity=graph.entity(ids[i]);members.push({id:entity.id,modelName:entity.modelName,type:iD.data.GeomType.NODE,role:iD.data.RoleType[entity.modelName+"_ID"]})}return members};function generatedotway(a,b){var aid=iD.Entity.id.toOSM(a.id),bid=iD.Entity.id.toOSM(b.id),newId=iD.Entity.id.fromOSM("way",aid+bid,a.layerId);return new iD.Way({id:newId,nodes:[a.id,b.id],_type:"roadcrossline",tags:{},layerId:a.layerId})}var action=function(graph){if(roadCrossNode){graph=roadCrossAppend(graph)}else{graph=roadCrossAdd(graph)}return graph};function roadCrossAdd(graph){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.C_NODE);var layerId=currentLayer.id;var loc=[0,0];selectedIDs.forEach(function(id){loc[0]+=graph.entity(id).loc[0];loc[1]+=graph.entity(id).loc[1]});loc[0]/=selectedIDs.length;loc[1]/=selectedIDs.length;var node=iD.Node({tags:iD.util.getDefauteTags(iD.data.Constant.C_NODE,currentLayer),modelName:iD.data.Constant.C_NODE,loc:loc,layerId:layerId});graph=graph.replace(node);var relMembers=getMembers([node.id].concat(selectedIDs),graph);relMembers.forEach(function(member){if(member.id==node.id){return}graph=graph.replace(generatedotway(node,graph.entity(member.id)))});crossRoadId=node.id;var currentLayer2=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_C_NODE_ROAD_NODE);var relation=iD.Relation({modelName:iD.data.DataType.R_C_NODE_ROAD_NODE,members:relMembers,layerId:currentLayer2.id,tags:iD.util.getDefauteTags(iD.data.DataType.R_C_NODE_ROAD_NODE,currentLayer2)});graph=graph.replace(relation);return iD.topo.handle().roadCrossEdit(graph,selectedIDs[0])}function roadCrossAppend(graph){var node=roadCrossNode;crossRoadId=node.id;var relMembers=getMembers([node.id].concat(selectedIDs),graph);relMembers.forEach(function(member){if(member.id==node.id){return}graph=graph.replace(generatedotway(node,graph.entity(member.id)))});var relation=graph.parentRelations(node,iD.data.DataType.R_C_NODE_ROAD_NODE)[0];if(!relation){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_C_NODE_ROAD_NODE);relation=iD.Relation({modelName:iD.data.DataType.R_C_NODE_ROAD_NODE,members:relMembers,layerId:currentLayer.id,tags:iD.util.getDefauteTags(iD.data.DataType.R_C_NODE_ROAD_NODE,currentLayer)});graph=graph.replace(relation)}else{for(let member of relMembers){if(member.id==node.id){continue}relation.tags=iD.util.tagExtend.updateTaskTag(relation);graph=graph.replace(relation);graph=iD.actions.AddMember(relation.id,member)(graph)}}return iD.topo.handle().roadCrossEdit(graph,selectedIDs[0])}var crossRoadId;action.crossRoadId=function(_){if(_){crossRoadId=_}else{return crossRoadId}};action.disabled=function(graph){return false};action.available=function(){var meshs=[];if(8<selectedIDs.length){Dialog.alert("\u7EFC\u5408\u4EA4\u53C9\u70B9\u6700\u591A\u53EA\u80FD\u7EFC\u54088\u4E2A\u8282\u70B9");return false}if(15<iD.util.roadCrossExtend.getNodesOutWayNum(selectedIDs,context.graph())){Dialog.alert("\u7EFC\u5408\u4EA4\u53C9\u70B9\u6700\u591A\u53EA\u80FD\u5173\u805415\u6761\u8DEF");return false}selectedIDs.forEach(function(id){if(-1==meshs.indexOf(context.graph().entity(id).tags.mesh)){meshs.push(context.graph().entity(id).tags.mesh)}});if(1!==meshs.length){Dialog.alert("\u8981\u7EFC\u5408\u7684\u8282\u70B9\u8DE8\u56FE\u5E45,\u65E0\u6CD5\u521B\u5EFA\u7EFC\u5408\u4EA4\u53C9\u70B9");return false}else{return true}};return action};;iD.actions.RoadCrossModify=function(selectedIDs){function getCrossWayId(graph,entity){var crossWayId;graph.parentWays(entity).forEach(function(way){if(way.isOneRoadCrossWay())crossWayId=way.id});return crossWayId}function roadCrossRelation(graph,id){var entity=graph.hasEntity(id);if(!entity)return;var rels=graph.parentRelations(entity,iD.data.DataType.R_C_NODE_ROAD_NODE);return rels[0]}function createRoadCrossRel(graph,members=[],rels=[]){if(!members.length)return graph;var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_C_NODE_ROAD_NODE);var relation=iD.Relation({modelName:iD.data.DataType.R_C_NODE_ROAD_NODE,members:members,layerId:currentLayer.id,tags:iD.util.getDefauteTags(iD.data.DataType.R_C_NODE_ROAD_NODE,currentLayer)});rels[0]=relation;return graph.replace(relation)}function addRoadCrossMember(graph,roadCross,node){var layers=iD.Layers,layer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD);var layerId=layer.id;var fromId=roadCross.id;var toId=node.id;var way=new iD.Way({id:iD.Entity.id.fromOSM("way",iD.Entity.id.toOSM(fromId)+"_"+iD.Entity.id.toOSM(toId),layerId),nodes:[fromId,toId],_type:"roadcrossline",tags:iD.util.getDefauteTags(iD.data.Constant.C_NODE,layer),layerId:layerId});var rel=roadCrossRelation(graph,fromId);if(!rel){var rels=[];graph=createRoadCrossRel(graph,{id:toId,modelName:iD.data.DataType.C_NODE,type:iD.data.GeomType.NODE,role:iD.data.RoleType.C_NODE_ID},rels);rel=rels[0]}var member={id:toId,modelName:iD.data.DataType.ROAD_NODE,type:iD.data.GeomType.NODE,role:iD.data.RoleType.ROAD_NODE_ID};graph=iD.actions.AddMember(rel.id,member)(graph);graph=iD.actions.AddEntity(way)(graph);return graph}function delRoadCrossMember(graph,roadCross,node){var rel=roadCrossRelation(graph,roadCross.id);var members=rel.members||[];if(!members.length)return graph;var index=-1;members.forEach(function(mber,idx){if(mber.id==node.id){index=idx}});if(-1==index)return graph;graph=iD.actions.DeleteMember(rel.id,index)(graph);graph=iD.actions.DeleteWay(getCrossWayId(graph,node))(graph);return graph}var action=function(graph){var entity=graph.entity(selectedIDs[0]);if(entity.isRoadCross){if(1<selectedIDs.length){var idKey=selectedIDs.length-1;var diffEntity=graph.entity(selectedIDs[idKey]);if(!available(graph,entity,diffEntity)){selectedIDs.pop();return graph}if(!(0===idKey||!diffEntity.isRoadNode)){var rc=roadCrossRelation(graph,diffEntity.id);if(rc){graph=delRoadCrossMember(graph,entity,diffEntity)}else{graph=addRoadCrossMember(graph,entity,diffEntity)}}}entity=graph.entity(entity.id);var rel=roadCrossRelation(graph,entity.id);selectedIDs.pop();if(!rel)return graph;if(1==rel.members.length){if(!editprocess){graph=iD.actions.DeleteNode(entity.id)(graph)}}else{graph=iD.topo.handle().roadCrossEdit(graph,entity.id)}}return graph};action.disabled=function(graph){return false};var editprocess=false;action.setEditProcess=function(_){editprocess=_};var available=function(graph,crossNode,node){if(crossNode.tags.mesh==node.tags.mesh){return true}else{Dialog.alert("\u8981\u7EFC\u5408\u7684\u8282\u70B9\u8DE8\u56FE\u5E45,\u65E0\u6CD5\u7F16\u8F91");return false}};return action};;iD.actions.createIsland=function(context){var startNodeLoc,endNodeLoc,highLightIds=[];var lineCal=iD.util.LineCalCulate();var action=function(graph){graph=getNewRoad(graph,startNodeLoc,endNodeLoc);return graph};action.disabled=function(graph){return false};action.setStartNodeLoc=function(_){startNodeLoc=_};action.setEndNodeLoc=function(_){endNodeLoc=_};action.getHighlightIds=function(){return highLightIds};action.getNodesLoc=function(startNodeLoc,endNodeLoc){var nodesLocation=[];var r=iD.geo.sphericalDistance(startNodeLoc,endNodeLoc);var angle=lineCal.getAngle(endNodeLoc[0],endNodeLoc[1],startNodeLoc[0],startNodeLoc[1]);angle=180-angle;var round=360,step=3;var pts=lineCal.getPathInCircle(startNodeLoc,r,angle,round+angle,step);pts.forEach(function(v,i){nodesLocation.push(v)});return pts};function getNewRoad(graph,startNodeLoc,endNodeLoc){var r=iD.geo.sphericalDistance(startNodeLoc,endNodeLoc);var angle=lineCal.getAngle(endNodeLoc[0],endNodeLoc[1],startNodeLoc[0],startNodeLoc[1]);angle=180-angle;var currLayer=context.layers().getLayer(),graph=context.graph();var round=360,step=3;var pts=lineCal.getPathInCircle(startNodeLoc,r,angle,round+angle,step);var nodes=[],node;pts.forEach(function(v,i){if(0==i||i==pts.length-1){let nodeLayid=context.layers().getCurrentModelEnableLayer(iD.data.DataType.ROAD_NODE).id;node=iD.Node({layerId:nodeLayid,loc:v,island:startNodeLoc});node.modelName=iD.data.DataType.ROAD_NODE;node=iD.util.tagExtend.updateNodeMeshTag(node,context);graph=iD.actions.AddEntity(node)(graph);nodes.push(node.id)}else{node=iD.Node({layerId:currLayer.id,loc:v,island:startNodeLoc});node.modelName=iD.data.DataType.HIGHWAY;graph=iD.actions.AddEntity(node)(graph);nodes.push(node.id)}});var way=iD.Way({layerId:currLayer.id,nodes:nodes});way.modelName=iD.data.DataType.HIGHWAY;way.setTags(iD.util.getDefauteTags(way,currLayer));graph=iD.actions.AddEntity(way)(graph);var fNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,graph.entity(way.first()));var tNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,graph.entity(way.last()));graph=iD.actions.AddEntity(fNode)(graph);graph=iD.actions.AddEntity(tNode)(graph);graph=iD.actions.AddRoad(way)(graph);highLightIds[0]=way.id;context.map().on("drawn.select",selectElements);selectElements();return graph}function selectElements(){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",true)}return action};;iD.actions.AddMaat=function(returnArr,fromWayId,toWayId,nodeId){return function(graph){var node=graph.entity(nodeId);var maatMembers=[{id:fromWayId,role:iD.data.RoleType.FROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD},{id:nodeId,role:iD.data.RoleType.ROAD_NODE_ID,type:iD.data.GeomType.NODE,modelName:iD.data.DataType.ROAD_NODE},{id:toWayId,role:iD.data.RoleType.TROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD}];var maatType=node.isRoadCross()?iD.data.DataType.C_NODECONN:iD.data.DataType.NODECONN;var layers=iD.Layers,currentLayer=layers.getCurrentModelEnableLayer(maatType);var relation=iD.Relation({tags:iD.util.getDefauteTags(maatType,currentLayer),modelName:maatType,members:maatMembers,layerId:currentLayer.id});returnArr[0]=relation;graph=graph.replace(relation);return graph}};;;iD.actions.UpdateNode=function(context,nodeId){return function(graph){var node;if("string"===typeof nodeId){node=graph.entity(nodeId)}else{node=nodeId;nodeId=node.id}node=iD.util.tagExtend.updateNodeMeshTag(node,context);node.tags=iD.util.tagExtend.updateTaskTag(node);graph=graph.replace(node);graph.parentRelations(graph.entity(nodeId)).forEach(function(rel){if(rel.tags&&rel.modelName==iD.data.Constant.C_NODE){graph=iD.actions.ChangeNodeMember(rel.id,rel.members)(graph)}});graph.parentWays(graph.entity(nodeId)).forEach(function(way){way.tags=iD.util.tagExtend.updateTaskTag(way);graph=graph.replace(way)});graph=iD.topo.handle().nodeMove(context,graph,graph.entity(node.id));return graph}};;;iD.actions.UpdateRealNode=function(context,nodeId,oldNodeEntity){return function(graph){var node=graph.entity(nodeId);if(oldNodeEntity&&oldNodeEntity.tags){oldNodeEntity=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,oldNodeEntity);graph=graph.replace(oldNodeEntity);graph=iD.util.tagExtend.updateRelationsTagsByRealNode(graph,oldNodeEntity)}node=iD.util.tagExtend.updateNodeMeshTag(node,context);node=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,node);graph=graph.replace(node);graph=iD.util.tagExtend.updateRelationsTagsByRealNode(graph,node);return graph}};;;iD.actions.ProcessInherit=function(changes){return function(graph){for(var type in changes){if("deleted"==type){continue}var entities=changes[type];for(var i=0;i<entities.length;i++){if("node"===entities[i].type||"way"===entities[i].type){if(entities[i].new_id_inherit){entities[i].new_id_inherit=_.unique(entities[i].new_id_inherit.split(","))}graph=graph.replace(entities[i])}}}return graph}};;;iD.actions.ProcessMesh=function(changes){return function(graph){for(var type in changes){if("deleted"==type){continue}var entities=changes[type];for(var i=0;i<entities.length;i++){if("node"===entities[i].type&&!entities[i].isRoadCross()){var node=entities[i];graph.parentWays(node).forEach(function(way){var fNode=graph.entity(way.first());var tNode=graph.entity(way.last());if(!way.isOneRoadCrossWay()&&way.tags&&way.tags.mesh){if("0"==fNode.tags.boundary){if(way.tags.mesh!=fNode.tags.mesh){graph=graph.replace(way)}}else if("0"==tNode.tags.boundary){if(way.tags.mesh!=tNode.tags.mesh){graph=graph.replace(way)}}else{var road_mesh="";if(tNode.tags.mesh==fNode.tags.mesh){road_mesh=tNode.tags.mesh}else if(tNode.tags.mesh2==fNode.tags.mesh2){road_mesh=tNode.tags.mesh2}else if(tNode.tags.mesh2==fNode.tags.mesh){road_mesh=tNode.tags.mesh2}else if(tNode.tags.mesh==fNode.tags.mesh2){road_mesh=tNode.tags.mesh}if(way.tags.mesh!=road_mesh){graph=graph.replace(way)}}}})}}}return graph}};;;iD.actions.AddWalkRoad=function(walkEntity){var walkUtil=iD.util.walkExtend();var walkTopo=iD.topo.RelWketRoad();function getHighWaysWithFilterBBox(entity,g){var distance=0.1,loc=entity.loc;var hightWays=walkUtil.getHighWaysWithFilterBBox(editor.context,distance,entity);if(hightWays&&1<=hightWays.length){hightWays.forEach(function(hightWay){g=walkTopo.waklroadCreate(g,entity.id,hightWay.id)})}return g}var action=function(graph){if(walkEntity.modelName==iD.data.DataType.WALKENTER){getHighWaysWithFilterBBox(walkEntity,graph)}else if(walkEntity.modelName==iD.data.DataType.WALKLINK){var nodes=walkEntity.nodes;var firstNode=graph.entity(nodes[0]);var endNode=graph.entity(nodes[nodes.length-1]);var fNode=iD.util.tagExtend.updateNodeMeshTag(firstNode,editor.context);var tNode=iD.util.tagExtend.updateNodeMeshTag(endNode,editor.context);graph=graph.replace(fNode);graph=graph.replace(tNode);graph=getHighWaysWithFilterBBox(fNode,graph);graph=getHighWaysWithFilterBBox(tNode,graph)}return graph};action.disabled=function(graph){return false};return action};;iD.actions.CreateLaneInfo=function(context,sId,tags,datum){return function(graph){var Members=[];var entity=graph.hasEntity(sId);var datatype=entity.modelName;var role="",mtype="",type="",rtype="";if(!entity)return graph;if(datatype==iD.data.DataType.NODECONN){role=iD.data.RoleType.NODECONN_ID;mtype=iD.data.DataType.NODECONN;type="1";rtype=iD.data.DataType.LANEINFO}else if(datatype==iD.data.DataType.TURN_GUIDANCE){role=iD.data.RoleType.TURN_GUIDANCE_ID;mtype=iD.data.DataType.TURN_GUIDANCE;type="2";rtype=iD.data.DataType.LANEINFO}else if(datatype==iD.data.DataType.C_NODECONN){role=iD.data.RoleType.C_NODECONN_ID;mtype=iD.data.DataType.C_NODECONN;type="1";rtype=iD.data.DataType.C_LANEINFO}Members=[{id:sId,role:role,type:iD.data.GeomType.RELATION,modelName:mtype}];var currentLayer=iD.Layers.getCurrentModelEnableLayer(rtype);var layid=currentLayer.id;var relation=iD.Relation({tags:iD.util.getDefauteTags(rtype,currentLayer),modelName:rtype,members:Members,layerId:layid});relation.tags.ARROW=tags.ARROW;relation.tags.LANE_NO=tags.LANE_NO;graph=graph.replace(relation);return graph}};;;iD.actions.CreateTurnGuidance=function(context,selectedIds,tgdArr,tags){return function(graph){var Members=[];var member=new Object;for(var i=0;i<selectedIds.length;i++){member={id:selectedIds[i],role:iD.data.RoleType.ROAD_ID,type:iD.data.GeomType.WAY,modelName:iD.data.DataType.ROAD};Members.push(member)}var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.TURN_GUIDANCE);var layeriD=currentLayer.id;var relation=iD.Relation({modelName:iD.data.DataType.TURN_GUIDANCE,members:Members,tags:iD.util.getDefauteTags(iD.data.DataType.TURN_GUIDANCE,currentLayer),layerId:layeriD});if(tags){relation=relation.mergeTags(tags)}graph=graph.replace(relation);tgdArr.push(relation);return graph}};;;iD.actions.rectifyDeviationFeature=function(selectedIDs,context){var dividers=[],points=[],pointLngLats=[];var action=function(graph){graph=action.getNewFeature(graph,dividers,points,pointLngLats);return graph};action.getNewFeature=function(graph,feature,point,pointLngLats){var calculationQueue=[];for(var i=0;i<feature.length;i++){if(feature[i].modelName==iD.data.DataType.DIVIDER){var nodes=graph.childNodes(feature[i]);for(var j=0;j<nodes.length;j++){var n=nodes[j];var sortObj=action.getCalculationPoint(n,point,pointLngLats);if(sortObj){calculationQueue.push(sortObj)}}}}var loc=null;for(var j=0;j<calculationQueue.length;j++){var n=calculationQueue[j].node;var p=calculationQueue[j].point;var newoffsetX=p.loc[0]-n.loc[0];var newoffsetY=p.loc[1]-n.loc[1];var newoffsetZ=p.loc[2]-n.loc[2];console.log("\u70B9\uFF1A",n);console.log("\u504F\u79FB\uFF1A",newoffsetX,newoffsetY,newoffsetZ);if(loc){loc[0]+=newoffsetX;loc[1]+=newoffsetY;loc[2]+=newoffsetZ}else{loc=[newoffsetX,newoffsetY,newoffsetZ]}}loc[0]=loc[0]/calculationQueue.length;loc[1]=loc[1]/calculationQueue.length;loc[2]=loc[2]/calculationQueue.length;for(var j=0;j<calculationQueue.length;j++){var n=calculationQueue[j].node;graph=graph.replace(n.move([n.loc[0]+loc[0],n.loc[1]+loc[1],n.loc[2]+loc[2]]))}return graph};action.getCalculationPoint=function(node,point,pointLngLats){var sortObj=iD.util.distanceByLngLats(node.loc,pointLngLats);console.log("\u8DDD\u79BB\uFF1A",sortObj.dis);console.log("node:",node);return{node:node,point:point[sortObj.index]}};action.disabled=function(graph){var entity,disabled=true,i=0,len=selectedIDs.length;points=[];dividers=[];pointLngLats=[];var allEntitys=context.intersects(iD.geo.Extent([-Infinity,-Infinity],[Infinity,Infinity]));for(var j=0;j<allEntitys.length;j++){if("SearchPoint"==allEntitys[j]._type){points.push(allEntitys[j]);pointLngLats.push(allEntitys[j].loc)}}for(;i<len;i++){entity=context.entity(selectedIDs[i]);if(entity.modelName==iD.data.DataType.DIVIDER){dividers.push(entity)}}if(0!=points.length&&0!=dividers.length){disabled=false}if(disabled){return"not_eligible"}};return action};;iD.actions.CloneMultiple=function(ids,projection,context,exec){var actions={way:iD.actions.CloneWay,roadway:iD.actions.CloneRoadWay};var action=function(graph){var firstId=ids[0];if(graph.hasEntity(firstId)&&"copy"!=exec){graph=actions[graph.entity(firstId).type](ids,projection,context)(graph)}else if(graph.hasEntity(firstId)&&"copy"==exec){graph=actions["roadway"](ids,projection,context)(graph)}return graph};action.disabled=function(){return false};return action};;;iD.actions.CloneWay=function(wayIds,projection,context){function calculateNewLoc(rawLoc){var pixel=projection(rawLoc);pixel[1]-=40;var newLoc=projection.invert(pixel);return newLoc}var action=function(graph){wayIds.forEach(function(wayId){var survivor=graph.entity(wayId),rawNodes=[],newNodes=[],newWay;survivor.nodes.forEach(function(node){var nodeEntity=graph.entity(node),newNodeEntity=iD.Node({layerId:nodeEntity.layerId,loc:calculateNewLoc(nodeEntity.loc),tags:iD.util.tagExtend.updateTaskTag(nodeEntity)});newNodes.push(newNodeEntity.id);graph=graph.replace(newNodeEntity)});newWay=iD.Way({layerId:survivor.layerId,nodes:newNodes,tags:iD.util.tagExtend.updateTaskTag(survivor)});graph=graph.replace(newWay);graph=iD.actions.MoveLineSplitTuFu(context,newWay)(graph)});return graph};action.disabled=function(){return false};return action};;iD.actions.CloneRoadWay=function(wayIds,projection,context,entities){var action=function(graph){var currLayer=context.layers().getLayer(),sharedNIds={};wayIds.forEach(function(wayId){var survivor=graph.entity(wayId),rawNodes=[],newNodes=[],newWay;survivor.nodes.forEach(function(node){if(!sharedNIds[node]){var nodeEntity=graph.entity(node),newNodeEntity=iD.Node({layerId:currLayer.id,loc:nodeEntity.loc,tags:iD.util.tagExtend.updateTaskTag(nodeEntity)});newNodeEntity.setHighway();if(survivor.first()===node||survivor.last()===node){newNodeEntity.setRoadNode()};newNodes.push(newNodeEntity.id);graph=graph.replace(newNodeEntity);sharedNIds[node]=newNodeEntity.id}else{graph.entity(sharedNIds[node]).setRoadNode();;newNodes.push(sharedNIds[node])}});newWay=iD.Way({layerId:currLayer.id,nodes:newNodes,tags:_.clone(survivor.tags)});newWay.setRoadClass();newWay.mergeTags({FLAG:"2"});newWay.tags=iD.util.tagExtend.updateTaskTag(newWay);graph=graph.replace(newWay);graph=iD.actions.MoveLineSplitTuFu(context,newWay)(graph);entities&&entities.push(newWay.id)});return graph};action.disabled=function(){return false};return action};;iD.actions.DiscardTags=function(difference){return function(graph){function discardTags(entity){if(!_.isEmpty(entity.tags)){var tags={};_.each(entity.tags,function(v,k){tags[k]=v});graph=graph.replace(entity.update({tags:_.omit(tags,iD.data.discarded)}))}}difference.modified().forEach(discardTags);difference.created().forEach(discardTags);return graph}};;;iD.actions.Disconnect=function(nodeId,newNodeId){var wayIds,splitObj;function createrDividerAttribute(wayId,nodeId,tags){var dividerAttributeMember=[{id:wayId,modelName:iD.data.DataType.DIVIDER,role:iD.data.RoleType.DIVIDER_ID,type:iD.data.GeomType.WAY},{id:nodeId,modelName:iD.data.DataType.DIVIDER_NODE,role:iD.data.RoleType.DIVIDER_NODE_ID,type:iD.data.GeomType.NODE}];var dividerAttributeRelations=iD.Relation({modelName:iD.data.DataType.DIVIDER_ATTRIBUTE,members:dividerAttributeMember,layerId:iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_ATTRIBUTE).id});dividerAttributeRelations.setTags(tags);return dividerAttributeRelations}function extentRelation(graph,pWayId,wayId,nodeId){var pWay=graph.entity(pWayId);var relations=graph.parentRelations(pWay,iD.data.DataType.DIVIDER_ATTRIBUTE);var wayMember,nodeMember,_tempRealtion,relation;let direction=pWay.tags&&pWay.tags.DIRECTION;for(var i=0,len=relations.length;i<len;i++){_tempRealtion=relations[i];wayMember=_tempRealtion.memberByIdAndRole(pWayId,iD.data.RoleType.DIVIDER_ID);nodeMember=_tempRealtion.memberByRole(iD.data.RoleType.DIVIDER_NODE_ID);if(wayMember&&(nodeMember.id==pWay.first()&&"3"!=direction||nodeMember.id==pWay.last()&&"3"==direction||pWay.nodes.includes(nodeMember.id)&&nodeMember.id!=pWay.first()&&nodeMember.id!=pWay.last())){relation=_tempRealtion;break}}if(relation){graph=graph.replace(createrDividerAttribute(wayId,nodeId,Object.assign({},relation.tags)))}return graph}var action=function(graph){var node=graph.entity(nodeId),connections=action.connections(graph);var pWays=graph.parentWays(node);var ways=[];var relation;splitObj={ways:ways};for(var i=1;i<pWays.length;i++){if(pWays[i].isOneRoadCrossWay()){continue}else{var xWay=graph.entity(pWays[i].id);graph=graph.replace(xWay);ways.push(pWays[i].id)}}for(var i in pWays){var pway=pWays[i];var tempNodeIndex=-1;var pwayNodes=pway.nodes||[];for(var j in pwayNodes){var idstr=pwayNodes[j];if(idstr===nodeId){tempNodeIndex=parseInt(j);break}}if(-1==tempNodeIndex){continue}var nodes1=pwayNodes.slice(0,tempNodeIndex+1);var nodes2=pwayNodes.slice(tempNodeIndex);var way1=iD.Way({layerId:iD.Layers.getCurrentModelEnableLayer(pway.modelName).id,nodes:nodes1,modelName:pway.modelName,tags:pway.tags||{}});var way2=iD.Way({layerId:iD.Layers.getCurrentModelEnableLayer(pway.modelName).id,nodes:nodes2,modelName:pway.modelName,tags:pway.tags||{}});way1.tags=iD.util.tagExtend.updateTaskTag(way1);way2.tags=iD.util.tagExtend.updateTaskTag(way2);let direction=pway.tags&&pway.tags.DIRECTION;graph=2<=way1.nodes.length?graph.replace(way1):graph;graph=2<=way2.nodes.length?graph.replace(way2):graph;graph=extentRelation(graph,pway.id,way1.id,"3"==direction?way1.last():way1.first());graph=extentRelation(graph,pway.id,way2.id,"3"==direction?way2.last():way2.first())}graph=iD.actions.DeleteWay(pWays[0].id)(graph);return graph};action.connections=function(graph){var candidates=[],keeping=false,parentWays=graph.parentWays(graph.entity(nodeId));parentWays.forEach(function(way){if(wayIds&&-1===wayIds.indexOf(way.id)){keeping=true;return}if(way.isArea()&&way.nodes[0]===nodeId){candidates.push({wayID:way.id,index:0})}else{way.nodes.forEach(function(waynode,index){if(waynode===nodeId){candidates.push({wayID:way.id,index:index})}})}});return keeping?candidates:candidates.slice(1)};action.getSplitObj=function(){return splitObj};action.disabled=function(graph){};action.limitWays=function(_){if(!arguments.length)return wayIds;wayIds=_;return action};return action};;;iD.actions.Join=function(ids){function groupEntitiesByGeometry(graph){var entities=ids.map(function(id){return graph.entity(id)});return _.extend({line:[]},_.groupBy(entities,function(entity){return entity.geometry(graph)}))}function mergeid(lines){var start=lines[0],end=lines[1];if(start.nodes[0]==end.nodes[0]||start.nodes[0]==end.nodes[end.nodes.length-1]){return start.nodes[0]}else if(start.nodes[start.nodes.length-1]==end.nodes[0]||start.nodes[start.nodes.length-1]==end.nodes[end.nodes.length-1]){return start.nodes[start.nodes.length-1]}}var action=function(graph){var mid=mergeid(_.uniq(ids).map(function(id){var entity=graph.entity(id);return entity}));var parentWays=graph.parentWays(graph.entity(mid));if(parentWays.length==ids.length){var mergeNode=graph.entity(mid);graph=graph.replace(mergeNode)}var start=graph.entity(ids[0]);var end=graph.entity(ids[1]);start=start.mergeTags(iD.util.tagExtend.updateTaskTag(start));end=end.mergeTags(iD.util.tagExtend.updateTaskTag(end));var mergeSIx=start.nodes.indexOf(mid);var mergeEIx=end.nodes.indexOf(mid);var step=1;var insertIx=0;if(0==mergeEIx){step=1}else{step=-1}var index=0;var current=mergeEIx;while(index<end.nodes.length){if(0!=mergeSIx){insertIx=start.nodes.length}if(end.nodes[current]!=mid){var id=end.nodes[current];start=start.addNode(id,insertIx);graph=graph.replace(start)}current=current+step;index++}graph=graph.remove(end);return graph};action.disabled=function(graph){var geometries=groupEntitiesByGeometry(graph);if(2>ids.length||ids.length!==geometries.line.length)return"not_eligible";var joined=iD.geo.joinWays(ids.map(graph.entity,graph),graph);if(1<joined.length)return"not_adjacent";var nodeIds=_.pluck(joined[0].nodes,"id").slice(1,-1),relation;joined[0].forEach(function(way){var parents=graph.parentRelations(way);parents.forEach(function(parent){if("relation"==parent.type&&parent.isRestriction()&&parent.members.some(function(m){return 0<=nodeIds.indexOf(m.id)}))relation=parent})});if(relation)return"restriction"};return action};;;iD.actions.Merge=function(ids,context){function groupEntitiesByGeometry(graph){var entities=ids.map(function(id){return graph.entity(id)});return _.extend({point:[],area:[],line:[],relation:[]},_.groupBy(entities,function(entity){return entity.geometry(graph)}))}function setShapeNodes(graph,startWay,endWay,newWay,midId,newMidId){startWay.nodes.forEach(function(id){if(id===midId){newWay=newWay.addNode(newMidId,newWay.nodes.length)}else{newWay=newWay.addNode(id,newWay.nodes.length)}newWay.tags=iD.util.tagExtend.updateTaskTag(newWay);graph=graph.replace(newWay)});var mergeSIx=startWay.nodes.indexOf(midId);var mergeEIx=endWay.nodes.indexOf(midId);var step=1;var insertIx=0;if(0==mergeEIx){step=1}else{step=-1}var index=0;var current=mergeEIx;while(index<endWay.nodes.length){if(0!=mergeSIx){insertIx=newWay.nodes.length}if(endWay.nodes[current]!=midId){var id=endWay.nodes[current];newWay=newWay.addNode(id,insertIx);newWay.tags=iD.util.tagExtend.updateTaskTag(newWay);graph=graph.replace(newWay)}current=current+step;index++}graph=graph.replace(newWay);return graph}function setIdInherit(start,end,newWay){if(start.isNew()&&start.new_id_inherit){newWay.new_id_inherit=newWay.new_id_inherit?newWay.new_id_inherit+","+start.new_id_inherit:start.new_id_inherit}else if(!start.isNew()){newWay.new_id_inherit=newWay.new_id_inherit?newWay.new_id_inherit+","+start.osmId()+"+":start.osmId()+"+"}if(end.isNew()&&end.new_id_inherit){newWay.new_id_inherit=newWay.new_id_inherit?newWay.new_id_inherit+","+end.new_id_inherit:end.new_id_inherit}else if(!end.isNew()){newWay.new_id_inherit=newWay.new_id_inherit?newWay.new_id_inherit+","+end.osmId()+"+":end.osmId()+"+"}}var action=function(graph){var mid=mergeid(_.uniq(ids).map(function(id){var entity=graph.entity(id);return entity}));var parentWays=graph.parentWays(graph.entity(mid));var isRoad=iD.Layers.getLayer(graph.entity(wayId).layerId).isRoad();var mergeNode;mergeNode=graph.entity(mid);var newNode=iD.Node({layerId:mergeNode.layerId,loc:mergeNode.loc,modelName:iD.data.DataType.ROAD_NODE,tags:iD.util.getDefauteTags(iD.data.DataType.ROAD_NODE,iD.Layers.getLayer(mergeNode.layerId))});graph=graph.replace(newNode);var start=graph.entity(ids[0]);var end=graph.entity(ids[1]);var newWay=iD.Way({layerId:start.layerId,nodes:[],modelName:graph.entity(wayId).modelName,tags:graph.entity(wayId).tags});newWay.tags=iD.util.tagExtend.updateTaskTag(newWay);graph=graph.replace(newWay);graph=setShapeNodes(graph,start,end,newWay,mid,newNode.id);if(isRoad){newWay=graph.entity(newWay.id);if(graph.entity(wayId).tags.DIRECTION==iD.way.direction.positive&&(newWay.first()==graph.entity(wayId).last()||newWay.last()==graph.entity(wayId).first())){newWay=newWay.mergeTags({DIRECTION:iD.way.direction.reverse});graph=graph.replace(newWay)}else if(graph.entity(wayId).tags.DIRECTION==iD.way.direction.reverse&&(newWay.first()==graph.entity(wayId).last()||newWay.last()==graph.entity(wayId).first())){newWay=newWay.mergeTags({DIRECTION:iD.way.direction.positive});graph=graph.replace(newWay)}newWay=graph.entity(newWay.id);newWay=iD.util.tagExtend.updateWayLengthTag(graph,graph.entity(newWay.id));newWay.tags=iD.util.tagExtend.updateTaskTag(newWay);graph=graph.replace(newWay);setIdInherit(start,end,newWay);graph=graph.replace(newWay);graph=iD.topo.handle().roadMerge(graph,graph.entity(newWay.id),start,end,mergeNode)}ids.pop();ids.pop();ids.push(newWay.id);graph=iD.actions.DeleteWay(start.id)(graph);graph=iD.actions.DeleteWay(end.id)(graph);if(parentWays.length==ids.length){graph=iD.actions.DeleteNode(mergeNode.id)(graph)}if(iD.data.DataType.ROAD==newWay.modelName&&graph.hasEntity(mergeNode.id)&&2<parentWays.length){mergeNode=graph.entity(mergeNode.id);graph=iD.util.tagExtend.updateRelationsTagsByRealNode(graph,mergeNode)}return graph};var wayId;action.wayId=function(_){if(_){wayId=_}else{return wayId}};function mergeid(lines){var start=lines[0],end=lines[1];if(start.nodes[0]==end.nodes[0]||start.nodes[0]==end.nodes[end.nodes.length-1]){return start.nodes[0]}else if(start.nodes[start.nodes.length-1]==end.nodes[0]||start.nodes[start.nodes.length-1]==end.nodes[end.nodes.length-1]){return start.nodes[start.nodes.length-1]}}action.disabled=function(graph){var lines=_.uniq(ids).map(function(id){return graph.entity(id)});var mid=mergeid(lines);if(!mid){return true}var parentWays=graph.parentWays(graph.entity(mid));if(iD.Layers.getLayer(parentWays[0].layerId).isRoad()){return parentWays.length!=ids.length}else{var start=lines[0];var end=lines[1];return start.nodes[0]!=end.nodes[0]&&start.nodes[0]!=end.nodes[end.nodes.length-1]&&start.nodes[start.nodes.length-1]!=end.nodes[0]&&start.nodes[start.nodes.length-1]!=end.nodes[end.nodes.length-1]}};return action};;;iD.actions.AddRoad=function(wayId){var walkTopo=iD.topo.RelWketRoad();var walkUtil=iD.util.walkExtend();var action=function(graph){var way=graph.entity(wayId);var allNodes=way.nodes;var firstNode=way.first();var lastNode=way.last();for(var i=1;i<allNodes.length-1;i++){var node=graph.entity(allNodes[i]);if(node.modelName==iD.data.DataType.ROAD_NODE){var parentRelations=graph.parentRelations(node);parentRelations.forEach(function(relation){graph=graph.remove(relation)})}}var handle=iD.topo.handle();graph=handle.create(graph,way);way=graph.entity(way.id);way=iD.util.tagExtend.updateWayLengthTag(graph,way);graph=graph.replace(way.update({tags:iD.util.tagExtend.updateTaskTag(way)}));graph=graph.replace(way);var fNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,graph.entity(way.first()));var tNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(graph,graph.entity(way.last()));graph=graph.replace(fNode);graph=graph.replace(tNode);return graph};action.disabled=function(graph){return false};return action};;iD.actions.WayJoin=function(ids){function groupEntitiesByGeometry(graph){var entities=ids.map(function(id){return graph.entity(id)});return _.extend({line:[]},_.groupBy(entities,function(entity){return entity.geometry(graph)}))}var action=function(graph){var ways=ids.map(graph.entity,graph),survivor=ways[0],mid=mergeid(ways);if("1"==ways[0].tags.DIRECTION&&"1"==ways[1].tags.DIRECTION){for(let i=0;i<ways.length;i++){if(!ways[i].isNew()){survivor=ways[i];break}}}else{if("2"==ways[0].tags.DIRECTION&&_.first(ways[0].nodes)==mid){survivor=ways[1];ways.reverse()}else if("3"==ways[0].tags.DIRECTION&&_.last(ways[0].nodes)==mid){survivor=ways[1];ways.reverse()}}var mnode=graph.entity(mid);var mpways=graph.parentWays(mnode)||[];if(mnode.modelName&&mpways.length>ids.length){var newNode=iD.Node({layerId:mnode.layerId,loc:mnode.loc,modelName:mnode.modelName,tags:iD.util.getDefauteTags(mnode.modelName,iD.Layers.getLayer(mnode.layerId))});graph.parentRelations(mnode).forEach(d=>{let rol=d.memberByRole(iD.data.RoleType.DIVIDER_ID);if(d.modelName!=iD.data.DataType.MEASUREINFO&&ids.includes(rol.id)){graph=iD.actions.DeleteRelation(d.id)(graph)}});mnode=newNode;graph=graph.replace(newNode);ways=[];mpways.forEach(function(way){if(ids.includes(way.id)){let _way=way.replaceNode(mid,newNode.id);graph=graph.replace(_way);ways.push(_way)}})}graph=graph.replace(mnode.mergeTags(iD.util.tagExtend.updateTaskTag(mnode)));var joined=iD.geo.joinWays(ways,graph)[0];survivor=survivor.update({nodes:_.pluck(joined.nodes,"id")});graph=graph.replace(survivor);graph.parentRelations(mnode).forEach(d=>{if(d.modelName!=iD.data.DataType.MEASUREINFO){graph=iD.actions.DeleteRelation(d.id)(graph)}});joined.forEach(function(way){if(way.id===survivor.id)return;graph.parentRelations(way).forEach(d=>{if(d.modelName==iD.data.DataType.DIVIDER_ATTRIBUTE){graph=graph.remove(d)}else{graph=graph.replace(d.replaceMember(way,survivor))}});graph=iD.actions.DeleteWay(way.id)(graph)});return graph};action.disabled=function(graph){var geometries=groupEntitiesByGeometry(graph);if(2>ids.length||ids.length!==geometries.line.length)return"not_eligible";var joined=iD.geo.joinWays(ids.map(graph.entity,graph),graph);if(1<joined.length)return"not_adjacent";var nodeIds=_.pluck(joined[0].nodes,"id").slice(1,-1),relation;joined[0].forEach(function(way){var parents=graph.parentRelations(way);parents.forEach(function(parent){if(parent.isRestriction()&&parent.members.some(function(m){return 0<=nodeIds.indexOf(m.id)}))relation=parent})});if(relation)return"restriction"};function mergeid(lines){var start=lines[0],end=lines[1];if(start.nodes[0]==end.nodes[0]||start.nodes[0]==end.nodes[end.nodes.length-1]){return start.nodes[0]}else if(start.nodes[start.nodes.length-1]==end.nodes[0]||start.nodes[start.nodes.length-1]==end.nodes[end.nodes.length-1]){return start.nodes[start.nodes.length-1]}}return action};;;iD.actions.WayMerge=function(ids){function groupEntitiesByGeometry(graph){var entities=ids.map(function(id){return graph.entity(id)});return _.extend({point:[],area:[],line:[],relation:[]},_.groupBy(entities,function(entity){return entity.geometry(graph)}))}var action=function(graph){var geometries=groupEntitiesByGeometry(graph),target=geometries.area[0]||geometries.line[0],points=geometries.point;points.forEach(function(point){target=target.mergeTags(point.tags);target=target.mergeTags(iD.util.tagExtend.updateTaskTag(target));graph.parentRelations(point).forEach(function(parent){parent=parent.mergeTags(iD.util.tagExtend.updateTaskTag(parent));graph=graph.replace(parent);graph=graph.replace(parent.replaceMember(point,target))});graph=graph.remove(point)});graph=graph.replace(target);return graph};action.disabled=function(graph){var geometries=groupEntitiesByGeometry(graph);if(0===geometries.point.length||1!==geometries.area.length+geometries.line.length||0!==geometries.relation.length)return"not_eligible"};return action};;;iD.actions.MergePolygon=function(ids,newRelationId){function groupEntities(graph){var entities=ids.map(function(id){return graph.entity(id)});return _.extend({closedWay:[],multipolygon:[],other:[]},_.groupBy(entities,function(entity){if("way"===entity.type&&entity.isClosed()){return"closedWay"}else if("relation"===entity.type&&entity.isMultipolygon()){return"multipolygon"}else{return"other"}}))}var action=function(graph){var entities=groupEntities(graph);var polygons=entities.multipolygon.reduce(function(polygons,m){return polygons.concat(iD.geo.joinWays(m.members,graph))},[]).concat(entities.closedWay.map(function(d){var member=[{id:d.id}];member.nodes=graph.childNodes(d);return member}));var contained=polygons.map(function(w,i){return polygons.map(function(d,n){if(i===n)return null;return iD.geo.polygonContainsPolygon(_.pluck(d.nodes,"loc"),_.pluck(w.nodes,"loc"))})});var members=[],outer=true;while(polygons.length){extractUncontained(polygons);polygons=polygons.filter(isContained);contained=contained.filter(isContained).map(filterContained)}function isContained(d,i){return _.any(contained[i])}function filterContained(d){return d.filter(isContained)}function extractUncontained(polygons){polygons.forEach(function(d,i){if(!isContained(d,i)){d.forEach(function(member){members.push({type:"way",id:member.id,role:outer?"outer":"inner"})})}});outer=!outer}var relation=entities.multipolygon[0]||iD.Relation({id:newRelationId,tags:{type:"multipolygon"}});entities.multipolygon.slice(1).forEach(function(m){relation=relation.mergeTags(m.tags);graph=graph.remove(m)});entities.closedWay.forEach(function(way){function isThisOuter(m){return m.id===way.id&&"inner"!==m.role}if(members.some(isThisOuter)){relation=relation.mergeTags(way.tags);graph=graph.replace(way.update({tags:{}}))}});return graph.replace(relation.update({members:members,tags:_.omit(relation.tags,"area")}))};action.disabled=function(graph){var entities=groupEntities(graph);if(0<entities.other.length||2>entities.closedWay.length+entities.multipolygon.length)return"not_eligible";if(!entities.multipolygon.every(function(r){return r.isComplete(graph)}))return"incomplete_relation"};return action};;;iD.actions.MoveNode=function(nodeId,loc){return function(graph){graph.parentRelations(graph.entity(nodeId)).forEach(function(rel){if(rel.tags&&rel.modelName==iD.data.Constant.C_NODE){graph=iD.actions.ChangeNodeMember(rel.id,rel.members)(graph)}});let node=graph.entity(nodeId);node=node.mergeTags(iD.util.tagExtend.updateTaskTag(node));graph=graph.replace(node);graph=graph.replace(node.move(loc));return graph}};;;iD.actions.Move=function(ids,delta,projection){function addNodes(ids,nodes,graph){ids.forEach(function(id){var entity=graph.entity(id);if("node"===entity.type){nodes.push(id)}else if("way"===entity.type){nodes.push.apply(nodes,entity.nodes)}else{addNodes(_.pluck(entity.members,"id"),nodes,graph)}})}var action=function(graph){var nodes=[];addNodes(ids,nodes,graph);_.uniq(nodes).forEach(function(id){var node=graph.entity(id),start=projection(node.loc),end=projection.invert([start[0]+delta[0],start[1]+delta[1]]);end=end.concat(node.loc[2]);node=node.mergeTags(iD.util.tagExtend.updateTaskTag(node));graph=graph.replace(node);graph=graph.replace(node.move(end))});return graph};action.disabled=function(graph){function incompleteRelation(id){if(graph.hasEntity(id)){var entity=graph.entity(id);return"relation"===entity.type&&!entity.isComplete(graph)}else{return false}}if(_.any(ids,incompleteRelation))return"incomplete_relation"};return action};iD.actions.NewMove=function(ids,delta,projection){var action=function(graph){var nodes=ids.nodes;_.uniq(nodes).forEach(function(node){var start=projection(node.loc),end=projection.invert([start[0]+delta[0],start[1]+delta[1]]);node.loc=end});return graph};action.disabled=function(graph){};return action};;;iD.actions.MoveLineSplitTuFu=function(context,entity){var xWays=[];function queuePoints(points,flag){var temp;for(var i=0;i<points.length;i++){var point=points[i];var pointModel=point[0]+point[1];for(var j=0;j<points.length;j++){var point2=points[j];var pointModel2=point2[0]+point2[1];var boo=eval("pointModel "+("desc"==flag?"<":">")+" pointModel2");if(boo){temp=points[j];points[j]=points[i];points[i]=temp}}}return points}function splitLineByRoadNode(xNodes){var fLines=[];var fLineNodes=[];var fCount=0;for(var f=0;f<xNodes.length;f++){var vNode=xNodes[f];if("RoadNode"==vNode.modelName){fCount+=1}if(2>=fCount){fLineNodes.push(vNode)}if(2==fCount){f-=1;fCount=0;if(2==fLineNodes.length){var s1=eval(fLineNodes[0].loc.join("+")),s2=eval(fLineNodes[1].loc.join("+"));if(parseFloat(s1.toFixed(11))==parseFloat(s2.toFixed(11))){continue}}fLines.push(fLineNodes);fLineNodes=[]}}return fLines}function deleteLittleLine(graph,newWay,len){var firstNode=graph.entity(newWay.first());var lastNode=graph.entity(newWay.last());var removeIds=[];var lon=iD.util.lassExtend.getDistance({lon:firstNode.loc[0],lat:firstNode.loc[1]},{lon:lastNode.loc[0],lat:lastNode.loc[1]});if(lon<len||isNaN(lon)){_.uniq(newWay.nodes).forEach(function(id){newWay=newWay.removeNode(id);graph=graph.replace(newWay);removeIds.push(id);var xNodez=graph.entity(id);graph=graph.remove(xNodez)});graph=graph.remove(newWay)}return{graph:graph,removeIds:removeIds}}return function(graph){var editLayer=context.layers(entity.layerId);if(editLayer&&!editLayer.split){return graph}if(editLayer&&editLayer.isRoad()){nodeDataType=iD.data.Constant.ROADNODE}else{nodeDataType=iD.data.Constant.HIGHWAY}if(entity instanceof iD.Way){xWays.push(entity);var othFLineId=entity.first();var othLLineId=entity.last();var othFLine=graph.entity(othFLineId);var othLLine=graph.entity(othLLineId);var othFLines=graph.parentWays(othFLine);var othLLines=graph.parentWays(othLLine);var othAllLines=othFLines.concat(othLLines);var newOthlines=[];for(var s=0;s<othAllLines.length;s++){if(othAllLines[s].id!=entity.id){newOthlines.push(othAllLines[s])}}xWays=xWays.concat(newOthlines)}else if(entity instanceof iD.Node){xWays=graph.parentWays(entity)}for(var m=0;m<xWays.length;m++){var focusPoints=[];var xWay=xWays[m];var xNodeIds=xWay.nodes;var firstNodeId=xWay.first();var lastNodeId=xWay.last();var firstNode=graph.entity(firstNodeId);var lastNode=graph.entity(lastNodeId);var sides=context.MeshDataStore.getRectCoords();loopSides:for(var j=0;j<sides.length;j++){var side=sides[j];for(var i=0;i<xNodeIds.length;i++){if(i+1>=xNodeIds.length){break}var xNode1=graph.entity(xNodeIds[i]);var xNode2=graph.entity(xNodeIds[i+1]);var SegmentB=xNode1.loc.concat(xNode2.loc);var loc=iD.util.lassExtend.SegmentIntersect(side,SegmentB);if(loc&&3!=loc&&loc.length){if("roadcrossline"==xWay.tags.road_class||"roadcrossline"==xWay._type){graph=graph.remove(xWay);break loopSides}var hasFocusP=false;for(var p=0;p<focusPoints.length;p++){var focusPointP=focusPoints[p].value;if(-1!=focusPointP.join("#").indexOf(loc.join("#"))){hasFocusP=true;break}}var fouceValueP=0.000001;if(!hasFocusP){var s0=eval(xNode1.loc.join("+"));var s1=eval(xNode2.loc.join("+"));var s2=eval(loc.join("+"));var isSmallVal=Math.abs(s0-s2)<fouceValueP||Math.abs(s1-s2)<fouceValueP;var fpIndex=false;if(isSmallVal)continue;for(var t=0;t<focusPoints.length;t++){var fPoint=focusPoints[t];if(fPoint.key==xNode1.id){fpIndex=true;var tempFPs=focusPoints[t].value;var xtfp=false;for(var e=0;e<tempFPs.length;e++){var tfp=tempFPs[e];if(-1!=tfp.join("#").indexOf(loc.join("#"))){xtfp=true;break}}if(!xtfp&&s1!=s2&&s0!=s2&&!isSmallVal){focusPoints[t].value.push(loc)}}}if(!fpIndex){var nd1=xNode1.loc[0]+xNode1.loc[1];var nd2=xNode2.loc[0]+xNode2.loc[1];var xOrderBy="desc";if(nd1<nd2){xOrderBy="asc"}if(s1!=s2&&s0!=s2&&!isSmallVal){focusPoints.push({key:xNode1.id,key2:xNode2.id,value:[loc],order:xOrderBy})}}}}}}if(!focusPoints.length)continue;for(var c=0;c<focusPoints.length;c++){var locInfo=focusPoints[c];var centerpoints=locInfo.value;centerpoints=queuePoints(centerpoints,locInfo.order);for(var v=0;v<centerpoints.length;v++){var cpoint=centerpoints[v];var cXpoint=graph.extendNode(xWay,cpoint,{});cXpoint.modelName="RoadNode";graph=graph.replace(cXpoint);var xIndex=xWay.nodes.indexOf(locInfo.key)+1;xWay=xWay.addNode(cXpoint.id,xIndex);graph=graph.replace(xWay)}}var xNodes=_.uniq(xWay.nodes).map(function(id){var node=graph.entity(id);return node});var fLines=splitLineByRoadNode(xNodes);var sourceId="";var sourceVersion=1;for(var z=0;z<fLines.length;z++){var linePoints=fLines[z];var lastPointLoc=linePoints[linePoints.length-1];var lastNewPoint={};if(z==fLines.length-1){lastNewPoint=graph.entity(lastPointLoc.id);sourceId=xWay.id;var oldV=xWay.version||1;sourceVersion=parseFloat(oldV)+1;_.uniq(xWay.nodes).forEach(function(id,i){xWay=xWay.removeNode(id);graph=graph.replace(xWay)});graph=graph.remove(xWay)}else{lastNewPoint=graph.extendNode(xWay,lastPointLoc.loc,{});lastNewPoint.modelName="RoadNode";graph=graph.replace(lastNewPoint)}var newWay=iD.Way();newWay.layerId=xWay.layerId;newWay=newWay.mergeTags(xWay.tags);if(sourceId){newWay.id=sourceId;newWay.version=sourceVersion}graph=graph.replace(newWay);for(var h=0;h<linePoints.length-1;h++){var hPoint=linePoints[h];newWay=newWay.addNode(hPoint.id);graph=graph.replace(newWay)}newWay=newWay.addNode(lastPointLoc.id);graph=graph.replace(newWay)}}return graph}};;;iD.actions.Noop=function(){return function(graph){return graph}};;;iD.actions.Orthogonalize=function(wayId,projection){var threshold=12,lowerThreshold=Math.cos((90-threshold)*Math.PI/180),upperThreshold=Math.cos(threshold*Math.PI/180);var action=function(graph){var way=graph.entity(wayId),nodes=graph.childNodes(way),points=_.uniq(nodes).map(function(n){return projection(n.loc)}),corner={i:0,dotp:1},epsilon=1e-4,i,j,score,motions;if(4===nodes.length){for(i=0;1000>i;i++){motions=points.map(calcMotion);points[corner.i]=addPoints(points[corner.i],motions[corner.i]);score=corner.dotp;if(score<epsilon){break}}graph=graph.replace(graph.entity(nodes[corner.i].id).move(projection.invert(points[corner.i])))}else{var best,originalPoints=_.clone(points);score=Infinity;for(i=0;1000>i;i++){motions=points.map(calcMotion);for(j=0;j<motions.length;j++){points[j]=addPoints(points[j],motions[j])}var newScore=squareness(points);if(newScore<score){best=_.clone(points);score=newScore}if(score<epsilon){break}}points=best;for(i=0;i<points.length;i++){if(originalPoints[i][0]!==points[i][0]||originalPoints[i][1]!==points[i][1]){graph=graph.replace(graph.entity(nodes[i].id).move(projection.invert(points[i])))}}for(i=0;i<points.length;i++){var node=nodes[i];if(1<graph.parentWays(node).length||graph.parentRelations(node).length||node.hasInterestingTags()){continue}var dotp=normalizedDotProduct(i,points);if(dotp<-1+epsilon){graph=iD.actions.DeleteNode(nodes[i].id)(graph)}}}return graph;function calcMotion(b,i,array){var a=array[(i-1+array.length)%array.length],c=array[(i+1)%array.length],p=subtractPoints(a,b),q=subtractPoints(c,b),scale,dotp;scale=2*Math.min(iD.geo.euclideanDistance(p,[0,0]),iD.geo.euclideanDistance(q,[0,0]));p=normalizePoint(p,1);q=normalizePoint(q,1);dotp=filterDotProduct(p[0]*q[0]+p[1]*q[1]);if(3<array.length){if(-0.707106781186547>dotp){dotp+=1}}else if(dotp&&Math.abs(dotp)<corner.dotp){corner.i=i;corner.dotp=Math.abs(dotp)}return normalizePoint(addPoints(p,q),0.1*dotp*scale)}};function squareness(points){return points.reduce(function(sum,val,i,array){var dotp=normalizedDotProduct(i,array);dotp=filterDotProduct(dotp);return sum+2*Math.min(Math.abs(dotp-1),Math.min(Math.abs(dotp),Math.abs(dotp+1)))},0)}function normalizedDotProduct(i,points){var a=points[(i-1+points.length)%points.length],b=points[i],c=points[(i+1)%points.length],p=subtractPoints(a,b),q=subtractPoints(c,b);p=normalizePoint(p,1);q=normalizePoint(q,1);return p[0]*q[0]+p[1]*q[1]}function subtractPoints(a,b){return[a[0]-b[0],a[1]-b[1]]}function addPoints(a,b){return[a[0]+b[0],a[1]+b[1]]}function normalizePoint(point,scale){var vector=[0,0];var length=Math.sqrt(point[0]*point[0]+point[1]*point[1]);if(0!==length){vector[0]=point[0]/length;vector[1]=point[1]/length}vector[0]*=scale;vector[1]*=scale;return vector}function filterDotProduct(dotp){if(lowerThreshold>Math.abs(dotp)||Math.abs(dotp)>upperThreshold){return dotp}return 0}action.disabled=function(graph){var way=graph.entity(wayId),nodes=graph.childNodes(way),points=_.uniq(nodes).map(function(n){return projection(n.loc)});if(squareness(points)){return false}return"not_squarish"};return action};;;iD.actions.RotateWay=function(wayId,pivot,angle,projection){return function(graph){return graph.update(function(graph){var way=graph.entity(wayId);_.unique(way.nodes).forEach(function(id){var node=graph.entity(id),point=projection(node.loc),radial=[0,0];radial[0]=point[0]-pivot[0];radial[1]=point[1]-pivot[1];point=[radial[0]*Math.cos(angle)-radial[1]*Math.sin(angle)+pivot[0],radial[0]*Math.sin(angle)+radial[1]*Math.cos(angle)+pivot[1]];var newLoc=projection.invert(point);newLoc[2]=node.loc[2]||-1;graph=graph.replace(node.move(newLoc))})})}};;;iD.actions.RestrictTurn=function(turn,projection,restrictionId){return function(graph){var from=graph.entity(turn.from.way),via=graph.entity(turn.via.node),to=graph.entity(turn.to.way);function split(toOrFrom){var newID=toOrFrom.newID||iD.Way().id;graph=iD.actions.Split(via.id,[newID]).limitWays([toOrFrom.way])(graph);var a=graph.entity(newID),b=graph.entity(toOrFrom.way);if(-1!==a.nodes.indexOf(toOrFrom.node)){return[a,b]}else{return[b,a]}}if(!from.affix(via.id)){if(turn.from.node===turn.to.node){from=to=split(turn.from)[0]}else if(turn.from.way===turn.to.way){var s=split(turn.from);from=s[0];to=s[1]}else{from=split(turn.from)[0]}}if(!to.affix(via.id)){to=split(turn.to)[0]}return graph.replace(iD.Relation({id:restrictionId,tags:{type:"restriction",restriction:turn.restriction||iD.geo.inferRestriction(graph.entity(turn.from.node),via,graph.entity(turn.to.node),projection)},members:[{id:from.id,type:"way",role:"from"},{id:via.id,type:"node",role:"via"},{id:to.id,type:"way",role:"to"}]}))}};;;iD.actions.Reverse=function(wayId){var replacements=[[/:right$/,":left"],[/:left$/,":right"],[/:forward$/,":backward"],[/:backward$/,":forward"]],numeric=/^([+\-]?)(?=[\d.])/,roleReversals={forward:"backward",backward:"forward",north:"south",south:"north",east:"west",west:"east"};function reverseKey(key){for(var i=0;i<replacements.length;++i){var replacement=replacements[i];if(replacement[0].test(key)){return key.replace(replacement[0],replacement[1])}}return key}function reverseValue(key,value){if("incline"===key&&numeric.test(value)){return value.replace(numeric,function(_,sign){return"-"===sign?"":"-"})}else if("incline"===key||"direction"===key){return{up:"down",down:"up"}[value]||value}else{return{left:"right",right:"left"}[value]||value}}return function(graph){var way=graph.entity(wayId),nodes=way.nodes.slice().reverse(),tags={},key,role;for(key in way.tags){tags[reverseKey(key)]=reverseValue(key,way.tags[key])}graph.parentRelations(way).forEach(function(relation){relation.members.forEach(function(member,index){if(member.id===way.id&&(role=roleReversals[member.role])){relation=relation.updateMember({role:role},index);graph=graph.replace(relation)}})});return graph.replace(way.update({nodes:nodes,tags:tags}))}};;;iD.actions.Straighten=function(selectedIDs,projection){function positionAlongWay(n,s,e){return((n[0]-s[0])*(e[0]-s[0])+(n[1]-s[1])*(e[1]-s[1]))/(Math.pow(e[0]-s[0],2)+Math.pow(e[1]-s[1],2))}function getTheSameWay(graph,entity1,entity2){let wids1=_.pluck(graph.parentWays(entity1),"id"),wids2=_.pluck(graph.parentWays(entity2),"id"),wayId;for(let i=0;i<wids1.length;i++){if(wids2.includes(wids1[i])){wayId=wids1[i];break}}return wayId}function getHeight(loc,node){let cRangeNodes=iD.util.selectNode_Z(loc,40);let tracks=[];for(let i=0;i<cRangeNodes.length;i++){var rangeNodes=cRangeNodes[i];var node=iD.util.getNearestNode(loc,rangeNodes.nodes);tracks.push({node:node,cameraHeight:rangeNodes.cameraHeight,trackId:rangeNodes.traceId})}if(0==tracks.length){return node.loc[2]}var nearrestTrack=iD.util.getNearestTracks(loc,tracks);return nearrestTrack.node.loc[2]-nearrestTrack.cameraHeight}var action=function(graph){let entity1=graph.entity(selectedIDs[0]),entity2=graph.entity(selectedIDs[1]),wayId=getTheSameWay(graph,entity1,entity2),way=graph.entity(wayId),nodes=graph.childNodes(way),index1=nodes.indexOf(entity1),index2=nodes.indexOf(entity2);if(index1>index2){[index1,index2]=[index2,index1]}points=nodes.map(function(n){return projection(n.loc)}),startPoint=points[index1],endPoint=points[index2],toDelete=[],i;for(i=index1+1;i<index2;i++){var node=nodes[i],point=points[i];if(1<graph.parentWays(node).length||graph.parentRelations(node).length||node.hasInterestingTags()){let u=positionAlongWay(point,startPoint,endPoint),p0=startPoint[0]+u*(endPoint[0]-startPoint[0]),p1=startPoint[1]+u*(endPoint[1]-startPoint[1]),loc=projection.invert([p0,p1]);heigth=getHeight(loc,node);loc.push(heigth);graph=graph.replace(graph.entity(node.id).move(loc))}else{if(-1===toDelete.indexOf(node)){toDelete.push(node)}}}for(i=0;i<toDelete.length;i++){graph=iD.actions.DeleteNode(toDelete[i].id)(graph)}return graph};action.disabled=function(graph){let entity1=graph.entity(selectedIDs[0]),entity2=graph.entity(selectedIDs[1]),wayId=getTheSameWay(graph,entity1,entity2),way=graph.entity(wayId),nodes=graph.childNodes(way),points=nodes.map(function(n){return projection(n.loc)}),index1=nodes.indexOf(entity1),index2=nodes.indexOf(entity2);if(index1>index2){[index1,index2]=[index2,index1]}startPoint=points[index1],endPoint=points[index2],threshold=0.2*Math.sqrt(Math.pow(startPoint[0]-endPoint[0],2)+Math.pow(startPoint[1]-endPoint[1],2)),i;for(i=index1+1;i<index2;i++){var point=points[i],u=positionAlongWay(point,startPoint,endPoint),p0=startPoint[0]+u*(endPoint[0]-startPoint[0]),p1=startPoint[1]+u*(endPoint[1]-startPoint[1]),dist=Math.sqrt(Math.pow(p0-point[0],2)+Math.pow(p1-point[1],2));if(dist>threshold){return"too_bendy"}}};return action};;;iD.actions.Split=function(nodeId,newWayIds){var wayIds,splitObj={ways:[]},isRoad=arguments[2]&&arguments[2].isRoad;function splitArea(nodes,idxA,graph){var lengths=new Array(nodes.length),length,i,best=0,idxB;function wrap(index){return iD.util.wrap(index,nodes.length)}function dist(nA,nB){return iD.geo.sphericalDistance(graph.entity(nA).loc,graph.entity(nB).loc)}length=0;for(i=wrap(idxA+1);i!==idxA;i=wrap(i+1)){length+=dist(nodes[i],nodes[wrap(i-1)]);lengths[i]=length}length=0;for(i=wrap(idxA-1);i!==idxA;i=wrap(i-1)){length+=dist(nodes[i],nodes[wrap(i+1)]);if(length<lengths[i])lengths[i]=length}for(i=0;i<nodes.length;i++){var cost=lengths[i]/dist(nodes[idxA],nodes[i]);if(cost>best){idxB=i;best=cost}}return idxB}function split(graph,wayA,newWayId){var wayB=iD.Way({id:newWayId,tags:wayA.tags}),nodesA,nodesB,isArea=wayA.isArea(),isOuter=iD.geo.isSimpleMultipolygonOuterMember(wayA,graph);if(wayA.isClosed()){var nodes=wayA.nodes.slice(0,-1),idxA=_.indexOf(nodes,nodeId),idxB=splitArea(nodes,idxA,graph);if(idxB<idxA){nodesA=nodes.slice(idxA).concat(nodes.slice(0,idxB+1));nodesB=nodes.slice(idxB,idxA+1)}else{nodesA=nodes.slice(idxA,idxB+1);nodesB=nodes.slice(idxB).concat(nodes.slice(0,idxA+1))}}else{var idx=_.indexOf(wayA.nodes,nodeId,1);nodesA=wayA.nodes.slice(0,idx+1);nodesB=wayA.nodes.slice(idx)}if(isRoad&&(!wayA.isNew()||wayA.isNew()&&wayA.new_id_inherit)){!wayA.new_id_inherit&&(wayA.new_id_inherit=iD.Entity.id.toOSM(wayA.id)+"-");wayB.new_id_inherit=(wayA.id_inherit||iD.Entity.id.toOSM(wayA.id))+"-";wayB.id_inherit=wayA.id_inherit||iD.Entity.id.toOSM(wayA.id)}wayA=wayA.update({nodes:nodesA});wayA=wayA.update({id:newWayId});wayB.modelName=wayA.modelName;wayB=wayB.update({nodes:nodesB});wayB.layerId=wayA.layerId;splitObj={ways:[wayA.id,wayB.id]};graph=graph.replace(wayA);graph=graph.replace(wayB);graph.parentRelations(wayA).forEach(function(relation){if(relation.isRestriction()){var via=relation.memberByRole("via");if(via&&wayB.contains(via.id)){relation=relation.updateMember({id:wayB.id},relation.memberById(wayA.id).index);graph=graph.replace(relation)}}else{if(relation===isOuter){graph=graph.replace(relation.mergeTags(wayA.tags));graph=graph.replace(wayA.update({tags:{}}));graph=graph.replace(wayB.update({tags:{}}))}var member={id:wayB.id,type:"way",role:relation.memberById(wayA.id).role};if(isRoad){}else{relation=relation.mergeTags(iD.util.tagExtend.updateTaskTag(relation));graph=graph.replace(relation);graph=iD.actions.AddMember(relation.id,member)(graph)}}});if(!isOuter&&isArea){var multipolygon=iD.Relation({tags:_.extend({},wayA.tags,{type:"multipolygon"}),members:[{id:wayA.id,role:"outer",type:"way"},{id:wayB.id,role:"outer",type:"way"}]});graph=graph.replace(multipolygon);graph=graph.replace(wayA.update({tags:{}}));graph=graph.replace(wayB.update({tags:{}}))}return graph}var action=function(graph){var candidates=action.ways(graph);for(var i=0;i<candidates.length;i++){graph=split(graph,candidates[i],newWayIds&&newWayIds[i]);graph=iD.actions.DeleteWay(candidates[i].id)(graph)}var nodee=graph.entity(nodeId);graph=graph.replace(nodee);return graph};action.getSplitObj=function(){return splitObj};action.ways=function(graph){var node=graph.entity(nodeId),parents=graph.parentWays(node),hasLines=_.any(parents,function(parent){return"line"===parent.geometry(graph)});return parents.filter(function(parent){if(wayIds&&-1===wayIds.indexOf(parent.id))return false;if(!wayIds&&hasLines&&"line"!==parent.geometry(graph))return false;if(parent.isClosed()){return true}for(var i=1;i<parent.nodes.length-1;i++){if(parent.nodes[i]===nodeId){return true}}return false})};action.disabled=function(graph){var candidates=action.ways(graph);if(0===candidates.length||wayIds&&wayIds.length!==candidates.length)return"not_eligible"};action.limitWays=function(_){if(!arguments.length)return wayIds;wayIds=_;return action};action.cpContext=function(context){action.context=context};return action};;;iD.actions.dividerDREF=function(selectedIDs,context){var wayIds;var action=function(graph){var relation=iD.Relation(),modelConfig;var members=[],entity,i=0,len=selectedIDs.length;for(;i<len;i++){entity=context.entity(selectedIDs[i]);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(modelConfig&&modelConfig.editable&&entity.modelName==iD.data.DataType.DIVIDER){members.push({id:entity.id,modelName:iD.data.DataType.DIVIDER,role:iD.data.RoleType.DIVIDER_ID,type:iD.data.GeomType.WAY})}}var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_DIVIDER_DREF);_.assign(relation,{modelName:iD.data.DataType.R_DIVIDER_DREF,members:members,tags:iD.util.getDefauteTags(iD.data.DataType.R_DIVIDER_DREF,currentLayer),layerId:currentLayer.id});graph=graph.replace(relation);return graph};return action};;;iD.actions.createdividerOPL=function(selectedIDs,context){var action=function(graph){var relation=iD.Relation();var members=[],entity,i=0,len=selectedIDs.length;for(;i<len;i++){entity=context.entity(selectedIDs[i]);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(modelConfig&&modelConfig.editable&&(entity.modelName==iD.data.DataType.DIVIDER||entity.modelName==iD.data.DataType.OBJECT_PL)){if(entity.modelName==iD.data.DataType.DIVIDER){var role=iD.data.RoleType.DIVIDER_ID}else{var role=iD.data.RoleType.OBJECT_PL_ID}members.push({id:entity.id,modelName:entity.modelName,role:role,type:iD.data.GeomType.WAY})}}var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_DIVIDER_OPL);_.assign(relation,{modelName:iD.data.DataType.R_DIVIDER_OPL,members:members,tags:iD.util.getDefauteTags(iD.data.DataType.R_DIVIDER_OPL,currentLayer),layerId:currentLayer.id});graph=graph.replace(relation);return graph};action.disabled=function(graph){var modelConfig,entity,layer,disabled=true,i=0,len=selectedIDs.length,dividierRLine;for(;i<len;i++){entity=context.entity(selectedIDs[i]);layer=iD.Layers.getLayer(entity.layerId);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(entity.type===iD.data.GeomType.NODE){return"exist_node"}if(!modelConfig||!modelConfig.editable){disabled=true;break}if(entity.modelName==iD.data.DataType.DIVIDER&&"1"==entity.tags.R_LINE){if(dividierRLine){disabled=true;break}disabled=false;dividierRLine=entity;continue}if(entity.modelName==iD.data.DataType.OBJECT_PL&&"2"==entity.tags.TYPE&&["1","2","3",1,2,3].includes(entity.tags.SUBTYPE)){disabled=false;continue}disabled=true;break}if(!iD.Layers.getLayerModelEditable(layer,iD.data.DataType.R_DIVIDER_OPL)){disabled=true}if(disabled){return"not_eligible"}for(var sid of selectedIDs){if(sid==dividierRLine.id)continue;var relations=graph.parentRelations(graph.entity(sid),iD.data.DataType.R_DIVIDER_OPL);if(relations.length){return"exist_relation"}}};return action};;;iD.actions.deleteDividerOPL=function(selectedIDs,context){var action=function(graph){var entity=graph.entity(selectedIDs[0]),relations=[],ids;if(entity.modelName==iD.data.DataType.OBJECT_PL){relations.push(...graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_OPL))}ids=_.pluck(relations,"id");graph=iD.actions.DeleteRelation(ids[0])(graph);return graph};action.disabled=function(graph){var entity=graph.entity(selectedIDs[0]),relations=[];if(entity.modelName==iD.data.DataType.OBJECT_PL){relations.push(...graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_OPL))}if(0==relations.length){return"not_eligible"}};return action};;;iD.actions.createdividerOPG=function(selectedIDs,context){var action=function(graph){var relation=iD.Relation();var members=[],entity,i=0,len=selectedIDs.length;for(;i<len;i++){entity=context.entity(selectedIDs[i]);layer=iD.Layers.getLayer(entity.layerId,entity.modelName);if(layer&&layer.editable&&(entity.modelName==iD.data.DataType.DIVIDER||entity.modelName==iD.data.DataType.OBJECT_PG)){if(entity.modelName==iD.data.DataType.DIVIDER){var role=iD.data.RoleType.DIVIDER_ID}else{var role=iD.data.RoleType.OBJECT_PG_ID}members.push({id:entity.id,modelName:entity.modelName,role:role,type:iD.data.GeomType.WAY})}}var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_DIVIDER_OPG);_.assign(relation,{modelName:iD.data.DataType.R_DIVIDER_OPG,members:members,tags:iD.util.getDefauteTags(iD.data.DataType.R_DIVIDER_OPG,currentLayer),layerId:currentLayer.id});graph=graph.replace(relation);return graph};action.disabled=function(graph){var layer,entity,disabled=true,i=0,len=selectedIDs.length,dividierRLine;for(;i<len;i++){entity=context.entity(selectedIDs[i]);layer=iD.Layers.getLayer(entity.layerId,entity.modelName);if(entity.type===iD.data.GeomType.NODE){return"exist_node"}if(!layer||!layer.editable){disabled=true;break}if(entity.modelName==iD.data.DataType.DIVIDER&&"1"==entity.tags.R_LINE){if(dividierRLine){disabled=true;break}disabled=false;dividierRLine=entity;continue}if(entity.modelName==iD.data.DataType.OBJECT_PG&&"3"==entity.tags.TYPE&&"7"==entity.tags.SUBTYPE){disabled=false;continue}disabled=true;break}if(disabled){return"not_eligible"}for(var sid of selectedIDs){if(sid==dividierRLine.id)continue;var relations=graph.parentRelations(graph.entity(sid),iD.data.DataType.R_DIVIDER_OPG);if(relations.length){return"exist_relation"}}};return action};;;iD.actions.deleteDividerOPG=function(selectedIDs,context){var action=function(graph){var entity=graph.entity(selectedIDs[0]),relations=[],ids;if(entity.modelName==iD.data.DataType.OBJECT_PG){relations.push(...graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_OPG))}ids=_.pluck(relations,"id");graph=iD.actions.DeleteRelation(ids[0])(graph);return graph};action.disabled=function(graph){var entity=graph.entity(selectedIDs[0]),relations=[];if(entity.modelName==iD.data.DataType.OBJECT_PG){relations.push(...graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_OPG))}if(0==relations.length){return"not_eligible"}};return action};;;iD.actions.createdividerVirtualLane=function(selectedIDs,context){var wayIds;var action=function(graph){let entitys=[],lines=[],ways=[],len=selectedIDs.length;var projection=context.projection;for(let i=0;i<len;i++){let entity=context.entity(selectedIDs[i]);let way=graph.parentWays(entity);ways.push(way);var nodeIndex=way[0].nodes.indexOf(selectedIDs[i]);var nextNodeId=way[0].nodes[nodeIndex+1];var nextNode=null,prevNode;if(nextNodeId){entity._isStart=true;nextNode=context.entity(nextNodeId)}var prevNodeId=way[0].nodes[nodeIndex-1];if(prevNodeId){entity._isStart=false;prevNode=context.entity(prevNodeId)}var line=nextNode?[entity.loc[0],entity.loc[1],entity.loc[2],nextNode.loc[0],nextNode.loc[1],nextNode.loc[2],"next"]:prevNode?[entity.loc[0],entity.loc[1],entity.loc[2],prevNode.loc[0],prevNode.loc[1],prevNode.loc[2],"prev"]:[];lines.push(line);entitys.push(entity)}var newlines=[],linePointPx=[];var linecal=iD.util.LineCalCulate(),currLayer=context.layers().getLayer();for(let l=0;l<lines.length;l++){let x1=[lines[l][0],lines[l][1],lines[l][2]],x2=[lines[l][3],lines[l][4],lines[l][5]],p_x1=projection(x1),p_x2=projection(x2);var x=p_x2[1]-p_x1[1]+p_x1[0],y=p_x1[0]-p_x2[0]+p_x1[1];var px=[x,y];var xy=projection.invert(px);var newLine=[x1[0],x1[1],xy[0],xy[1]];newlines.push(newLine);linePointPx.push(p_x1);linePointPx.push(p_x2)}var B=iD.util.extendIntersection(newlines[0],newlines[1]);var startPoint=[lines[0][0],lines[0][1]];var endPoint=[lines[1][0],lines[1][1]];var line1Angle=linecal.getAngle(B[0],B[1],startPoint[0],startPoint[1]),line2Angle=linecal.getAngle(B[0],B[1],endPoint[0],endPoint[1]);var p_b=projection(B);var t1=projection(startPoint);var t2=projection(endPoint);var dis1=iD.util.distanceByPixel(t1,p_b);var dis2=iD.util.distanceByPixel(t2,p_b);var shortAxis=Math.min(dis1,dis2);var majorAxis=Math.max(dis1,dis2);var majorAxis_lineAngle=null;if(majorAxis==dis1){majorAxis_lineAngle=line1Angle}else if(majorAxis==dis2){majorAxis_lineAngle=line2Angle}obj={center:projection(B),shortAxis:shortAxis,majorAxis:majorAxis,startDu:line1Angle,du:line2Angle};var x=obj.center[0],y=obj.center[1],a=obj.majorAxis,b=obj.shortAxis,startDu=obj.startDu,du=obj.du,nodes=[],a1=majorAxis_lineAngle;var lnglats=[];for(var i=0;360>=i;i+=5){hudu=Math.PI/180*i;var x1=b*Math.sin(hudu)+x,y1=y-a*Math.cos(hudu);var newpx=(x1-x)*Math.cos((a1+0)*Math.PI/180)-(y1-y)*Math.sin((a1+0)*Math.PI/180);var newpy=(x1-x)*Math.sin((a1+0)*Math.PI/180)+(y1-y)*Math.cos((a1+0)*Math.PI/180);let lnglat=projection.invert([newpx+x,newpy+y]);lnglat[2]=lines[0][2];lnglats.push(lnglat)}var selectP1=[lines[0][0],lines[0][1]],selectP2=[lines[1][0],lines[1][1]];var selectP1Dis=iD.util.pt2LineDist2(lnglats,selectP1);var selectP2Dis=iD.util.pt2LineDist2(lnglats,selectP2);var newNodes=[];var _lnglats=_.clone(lnglats);var startEntity=entitys[0];var endEntity=entitys[1];var newLnglatlineAngle=linecal.getAngle(selectP1[0],selectP1[1],selectP2[0],selectP2[1]);if(120>newLnglatlineAngle||300<newLnglatlineAngle){var tempangle2=selectP1Dis.i;var tempangle1=selectP2Dis.i;selectP1Dis.i=tempangle1;selectP2Dis.i=tempangle2;startEntity=entitys[1];endEntity=entitys[0]}var newLnglats=action.getRange360(selectP1Dis.i,selectP2Dis.i,_lnglats);newNodes.push(startEntity.id);for(var i=0;i<newLnglats.length;i++){var node=iD.Node({layerId:currLayer.id,loc:newLnglats[i],modelName:iD.data.DataType.DIVIDER_NODE,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,currLayer)});graph=graph.replace(node);newNodes.push(node.id)}newNodes.push(endEntity.id);var divider=iD.Way({layerId:currLayer.id,nodes:newNodes,modelName:iD.data.DataType.DIVIDER,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER,currLayer)});graph=graph.replace(divider);return graph};action.getRange360=function(from=0,to=0,lnglats=[]){var ds=lnglats;var result=[];if(from>=to){result=ds.slice(from+10,ds.length).concat(ds.slice(0,to))}else{result=ds.slice(from+10,to)}return result};action.convertClockwise=function(pointList){var maxY=0;var index=0;for(let i=0;i<pointList.length;i++){let pt=pointList[i];if(0==i){maxY=pt[1];index=0;continue}if(maxY<pt[1]){maxY=pt[1];index=i}}let front=0==index?pointList.length-2:index-1;let middle=index;let after=index>pointList.length-1?0:index+1;let frontPt=pointList[front];let middlePt=pointList[middle];let afterPt=pointList[after];return 0<(afterPt[0]-frontPt[0])*(middlePt[1]-frontPt[1])-(middlePt[0]-frontPt[0])*(afterPt[1]-frontPt[1])};action.disabled=function(graph){var entity,disabled=true,i=0,len=selectedIDs.length;if(1<len){var firstWay=null;for(;i<len;i++){entity=context.entity(selectedIDs[i]);if(entity.modelName===iD.data.DataType.DIVIDER_NODE){let way=graph.parentWays(entity)[0];if(!firstWay){firstWay=way}else if(firstWay.id!=way.id){let index=way.nodes.indexOf(entity.id);if(0==index||index==way.nodes.length-1){disabled=false}else{return"not_node"}}else{return"not_node"}}else{return"not_node"}}}if(disabled){return"not_eligible"}};return action};;;iD.actions.createdividerVirtualLaneCircle=function(selectedIDs,context){var action=function(graph){let entitys=[],lines=[],ways=[],len=selectedIDs.length,nodes=[],currLayer=context.layers().getLayer(context.entity(selectedIDs[0]).layerId);for(let i=0;i<len;i++){let entity=context.entity(selectedIDs[i]);let way=graph.parentWays(entity);ways.push(way);var nodeIndex=way[0].nodes.indexOf(selectedIDs[i]);var nextNodeId=way[0].nodes[nodeIndex+1];var nextNode=null,prevNode;if(nextNodeId){entity._isStart=true;nextNode=context.entity(nextNodeId)}var prevNodeId=way[0].nodes[nodeIndex-1];if(prevNodeId){entity._isStart=false;prevNode=context.entity(prevNodeId)}var line=nextNode?[nextNode.loc[0],nextNode.loc[1],entity.loc[0],entity.loc[1]]:prevNode?[prevNode.loc[0],prevNode.loc[1],entity.loc[0],entity.loc[1]]:[];lines.push(line);entitys.push(entity)}let A=entitys[0].loc,B=entitys[1].loc;let P=iD.util.extendIntersection(lines[0],lines[1]);let locs=iD.util.getSquareBezier(A,B,P);nodes.push(entitys[0].id);for(var i=1;i<locs.length;i++){node=iD.Node({layerId:currLayer.id,loc:locs[i],modelName:iD.data.DataType.DIVIDER_NODE,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,currLayer)});graph=graph.replace(node);nodes.push(node.id)}nodes.push(entitys[1].id);var divider=iD.Way({layerId:currLayer.id,nodes:nodes,modelName:iD.data.DataType.DIVIDER,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER,currLayer)});graph=graph.replace(divider);return graph};action.disabled=function(graph){var entity,disabled=true,i=0,len=selectedIDs.length;if(1<len){var firstWay=null;for(;i<len;i++){entity=context.entity(selectedIDs[i]);if(entity.modelName===iD.data.DataType.DIVIDER_NODE){let way=graph.parentWays(entity)[0];if(!firstWay){firstWay=way}else if(firstWay.id!=way.id){let index=way.nodes.indexOf(entity.id);if(0==index||index==way.nodes.length-1){disabled=false}else{return"not_node"}}else{return"not_node"}}else{return"not_node"}}}if(disabled){return"not_eligible"}};return action};;;iD.actions.junction=function(selectedIDs,context){var wayIds;var action=function(graph){var relation=iD.Relation(),modelConfig;var members=[],entity,i=0,len=selectedIDs.length;for(;i<len;i++){entity=context.entity(selectedIDs[i]);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig.editable)continue;if(entity.modelName==iD.data.DataType.DIVIDER){members.push({id:entity.id,modelName:iD.data.DataType.DIVIDER,role:iD.data.RoleType.DIVIDER_ID,type:iD.data.GeomType.WAY})}else if(entity.modelName==iD.data.DataType.JUNCTION){members.push({id:entity.id,modelName:iD.data.DataType.JUNCTION,role:iD.data.RoleType.JUNCTION_ID,type:iD.data.GeomType.NODE})}}var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_DIVIDER_JUNCTION);_.assign(relation,{modelName:iD.data.DataType.R_DIVIDER_JUNCTION,members:members,tags:iD.util.getDefauteTags(iD.data.DataType.R_DIVIDER_JUNCTION,currentLayer),layerId:currentLayer.id});graph=graph.replace(relation);return graph};action.disabled=function(graph){var modelConfig,entity,i=0,len=selectedIDs.length,ways=[],junction=[];for(;i<len;i++){entity=context.entity(selectedIDs[i]);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(modelConfig&&!modelConfig.editable){continue}if(entity.modelName==iD.data.DataType.DIVIDER){ways.push(entity)}else if(entity.modelName==iD.data.DataType.JUNCTION){junction.push(entity)}}if(2>ways.length){return"not_eligible"}else if(1!=junction.length){return"not_eligible_jnuction"}let rJunction=graph.parentRelations(junction[0],iD.data.DataType.R_DIVIDER_JUNCTION);if(rJunction.length){return"not_eligible_R_jnuction"}};return action};;;iD.actions.cancelRelations=function(selectedIDs,context){var action=function(graph){var entity=graph.entity(selectedIDs[0]),relations=[],ids;if(entity.modelName==iD.data.DataType.DIVIDER||entity.modelName==iD.data.DataType.ROAD){relations.push(...graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_DREF));relations.push(...graph.parentRelations(entity,iD.data.DataType.R_ROAD_DIVIDER))}var relationNames=[iD.data.DataType.R_ROAD_DIVIDER,iD.data.DataType.R_DIVIDER_OPL,iD.data.DataType.R_DIVIDER_OPG];relations.forEach(function(rel){if(rel.modelName!=iD.data.DataType.R_DIVIDER_DREF){return}for(let m of rel.members){let way=context.entity(m.id);if("1"==way.tags.R_LINE){relations.push(...graph.parentRelations(way,iD.data.DataType.R_DIVIDER_TL))}}});if(entity.modelName==iD.data.DataType.DIVIDER){for(let relName of relationNames){relations.push(...graph.parentRelations(entity,relName))}}ids=_.compact(_.uniq(_.pluck(relations,"id")));if(entity.modelName==iD.data.DataType.DIVIDER){ids.forEach(rid=>{graph=iD.actions.DeleteRelation(rid)(graph)});Dialog.alert("\u6E05\u7A7A\u8F66\u9053\u7EBF\u5206\u7EC4\uFF0C\u4EE5\u53CA\u4E0E\u5176\u5173\u8054\u7684\u5173\u7CFB\u3002",null,null,null,null,{AutoClose:3})}else{graph=iD.actions.DeleteRelation(ids[0])(graph)}return graph};action.disabled=function(graph){var entity=graph.entity(selectedIDs[0]),relations=[];if(entity.modelName==iD.data.DataType.DIVIDER||entity.modelName==iD.data.DataType.ROAD){relations.push(...graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_DREF));relations.push(...graph.parentRelations(entity,iD.data.DataType.R_ROAD_DIVIDER))}for(let rel of relations){if(!rel||!context.hasEntity(rel.id)){return"not_eligible"}}if(0==relations.length){return"not_eligible"}};return action};;;iD.actions.deleteDividerJunction=function(selectedIDs,context){var action=function(graph){var entity=graph.entity(selectedIDs[0]),relations=[],ids;if(entity.modelName==iD.data.DataType.JUNCTION){relations.push(...graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_JUNCTION))}ids=_.pluck(relations,"id");graph=iD.actions.DeleteRelation(ids[0])(graph);return graph};action.disabled=function(graph){var entity=graph.entity(selectedIDs[0]),relations=[];if(entity.modelName==iD.data.DataType.JUNCTION){relations.push(...graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_JUNCTION))}if(0==relations.length){return"not_eligible"}};return action};;;iD.actions.roadDivider=function(selectedIDs,context){var wayIds;var action=function(graph){var modelConfig;var members=[],entity,i=0,len=selectedIDs.length;for(;i<len;i++){entity=context.entity(selectedIDs[i]);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!modelConfig.editable){continue}if(entity.modelName==iD.data.DataType.DIVIDER){members.push({id:entity.id,modelName:iD.data.DataType.DIVIDER,role:iD.data.RoleType.DIVIDER_ID,type:iD.data.GeomType.WAY})}else if(entity.modelName==iD.data.DataType.ROAD){members.push({id:entity.id,modelName:iD.data.DataType.ROAD,role:iD.data.RoleType.ROAD_ID,type:iD.data.GeomType.WAY})}}var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_ROAD_DIVIDER);var relation=iD.Relation({modelName:iD.data.DataType.R_ROAD_DIVIDER,members:members,tags:iD.util.getDefauteTags(iD.data.DataType.R_ROAD_DIVIDER,currentLayer),layerId:currentLayer.id});graph=graph.replace(relation);return graph};action.disabled=function(graph){var modelConfig,entity,i=0,len=selectedIDs.length;var roads=[];var dividers=[];var relations=[];dividerType=false;for(;i<len;i++){entity=context.entity(selectedIDs[i]);var layer=iD.Layers.getLayer(entity.layerId);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!modelConfig.editable){continue}if(!iD.Layers.getLayerModelEditable(layer,iD.data.DataType.R_ROAD_DIVIDER)){return"exist_node"}if(entity.type===iD.data.GeomType.NODE){return"exist_node"}if(entity.modelName==iD.data.DataType.DIVIDER){dividers.push(selectedIDs[i])}else if(entity.modelName==iD.data.DataType.ROAD){roads.push(selectedIDs[i])}if(entity.modelName==iD.data.DataType.DIVIDER&&1==entity.tags.R_LINE){dividerType=true}}if(1!=roads.length){return"not_eligible"}else if(!dividerType){return"not_eligible_divider"}else if(2!==selectedIDs.length){return"not_eligible_length"}relations=graph.parentRelations(graph.entity(roads[0]),iD.data.DataType.R_ROAD_DIVIDER);for(relaction of relations){let isExist=true;let members=relaction.members;for(member of members){if(!selectedIDs.includes(member.id)){isExist=false;break}}if(isExist){return"exist_relation"}}};return action};;;iD.actions.UpdateDividerNode=function(selectedIDs,context){function typeDash(relation){if("2"==relation.tags.DRIVE_RULE){return true}return false}var action=function(graph){var dasheds=[],newNodes=[],entity;selectedIDs.forEach(d=>{let way=graph.entity(d);newNodes=action.splitWays(way)});newNodes.forEach(nodes=>{let preDashType=null,tags;let values=["1","2"];nodes.forEach(nodeId=>{entity=context.entity(nodeId);if("3"==entity.tags.DASHTYPE){return false}DASHTYPE=entity.tags.DASHTYPE;if(null!=preDashType&&[preDashType,"0"].includes(entity.tags.DASHTYPE)){DASHTYPE=_.difference(values,[preDashType])[0];tags=Object.assign({},entity.tags);tags.DASHTYPE=DASHTYPE;graph=iD.actions.ChangeTags(nodeId,tags)(graph)}if(["1","2"].includes(DASHTYPE)){preDashType=DASHTYPE}})});return graph};action.splitWays=function(way){var nodeIndex=[];let relations=context.graph().parentRelations(way,iD.data.DataType.DIVIDER_ATTRIBUTE);relations.forEach(relation=>{if(relation){if(typeDash(relation)){relation.members.forEach(function(member){if(member.modelName==iD.data.DataType.DIVIDER_NODE){nodeIndex.push({index:_.indexOf(way.nodes,member.id),isDashType:true})}})}else{relation.members.forEach(function(member){if(member.modelName==iD.data.DataType.DIVIDER_NODE){nodeIndex.push({index:_.indexOf(way.nodes,member.id),isDashType:false})}})}}});var newNodes=[];nodeIndex.push({index:way.nodes.length,isDashType:false});nodeIndex=_.sortBy(_.uniq(nodeIndex),function(obj){return obj.index});if(1==nodeIndex.length){newNodes.push(way.nodes)}else{for(var i=0;i<nodeIndex.length;i++){var startIndex=nodeIndex[i];if(startIndex.isDashType){var endIndex=nodeIndex[i+1];if(endIndex){newNodes.push(action.getNodes(startIndex.index,endIndex.index,way))}}}}return newNodes};action.getNodes=function(startIndex,endIndex,way){var nodes=way.nodes;var newNodes=[];for(var i=startIndex;i<endIndex;i++){var node=nodes[i];if(node){newNodes.push(node)}}return newNodes};action.disabled=function(graph){var dasheds=[];selectedIDs.forEach(d=>{let way=graph.entity(d);let relations=context.graph().parentRelations(way,iD.data.DataType.DIVIDER_ATTRIBUTE);relations.forEach(relation=>{if(relation&&typeDash(relation)){dasheds.push(way)}})});if(!dasheds.length){return"not_divider"}};return action};;;iD.actions.UnrestrictTurn=function(turn){return function(graph){return iD.actions.DeleteRelation(turn.restriction)(graph)}};;;iD.actions.EditRelation=function(context,editRelatins,deleteRelations){editRelatins=editRelatins||[];deleteRelations=deleteRelations||[];function deleteEntity(entity,graph){return!graph.parentWays(entity).length&&!graph.parentRelations(entity).length}var action=function(graph){_.forEach(deleteRelations,function(relationId){var relation=graph.entity(relationId.id);graph.parentRelations(relation).forEach(function(parent){parent=parent.removeMembersWithID(relationId);graph=graph.replace(parent);if(parent.isDegenerate()){graph=iD.actions.DeleteRelation(parent.id)(graph)}});graph=graph.remove(relation)});_.forEach(editRelatins,function(editRelatin){editRelatin.tags=iD.util.tagExtend.updateTaskTag(editRelatin);graph=graph.replace(editRelatin)});return graph};return action};;;iD.actions.ChangeNodeMember=function(entityId,scmember){return function(graph){var entity=graph.entity(entityId);entity.tags=iD.util.tagExtend.updateTaskTag(entity);graph=graph.replace(entity);graph=graph.replace(entity.updateMember(scmember));entity=graph.entity(entityId);if(entity.modelName==iD.data.Constant.C_NODE&&entity.members){var loc=[0,0];entity.members.forEach(function(member){loc[0]+=graph.entity(member.id).loc[0];loc[1]+=graph.entity(member.id).loc[1]});loc[0]/=entity.members.length;loc[1]/=entity.members.length;entity.loc=loc;graph=graph.replace(entity)}return graph}};;;iD.actions.RoadIntersect=function(selectIDs,context,lnglat){var modelNameParam=iD.picUtil.getModelNameParam();var getIntersectLoc=function(nodes1,nodes2,graph){var locs=[];var lineCal=iD.util.LineCalCulate();var interPoint=[0,0];for(var j=0;j<nodes1.length;j++){if(j+1>nodes1.length-1)break;var nodes1_pre=graph.entity(nodes1[j]),nodes1_next=graph.entity(nodes1[j+1]),pre_arr1=[nodes1_pre.loc[0],nodes1_pre.loc[1],nodes1_next.loc[0],nodes1_next.loc[1]];for(var k=0;k<nodes2.length;k++){if(k+1>nodes2.length-1)break;var nodes2_pre=graph.entity(nodes2[k]),nodes2_next=graph.entity(nodes2[k+1]),pre_arr2=[nodes2_pre.loc[0],nodes2_pre.loc[1],nodes2_next.loc[0],nodes2_next.loc[1]];var loc=iD.util.lassExtend.SegmentIntersect(pre_arr1,pre_arr2);loc&&loc.length&&locs.push({loc:loc,index:k})}}return locs};var hasSameNode=function(wayA,wayB){var wayA_fNode=wayA.nodes[0];var wayA_tNode=wayA.nodes[wayA.nodes.length-1];var wayB_fNode=wayB.nodes[0];var wayB_tNode=wayB.nodes[wayB.nodes.length-1];if(wayA_fNode==wayB_fNode||wayA_fNode==wayB_tNode||wayA_tNode==wayB_fNode||wayA_tNode==wayB_tNode)return true;return false};var isHighWayModel=function(wayA,wayB){if(wayA.modelName==modelNameParam.DIVIDER&&wayB.modelName==modelNameParam.DIVIDER){return true}return false};var action=function(graph){var ways=_.uniq(selectIDs).map(function(id){return graph.entity(id)}),locs=[];var nodesArr=[];for(var i=0;i<ways.length;i++){for(var j=i+1;j<ways.length;j++){if(!hasSameNode(ways[i],ways[j])){var nodes1=ways[i].nodes,nodes2=ways[j].nodes,acts=[];var twoWays=[ways[i],ways[j]];nodes1.length<nodes2.length&&(nodes2=ways[j].nodes,nodes1=ways[i].nodes);var locs=getIntersectLoc(nodes1,nodes2,graph),lobj={},dis=Infinity,idx,wayNodeIndex;locs.forEach(function(v,ky){var distance=iD.geo.sphericalDistance(lnglat,v.loc);if(dis>distance){dis=distance,idx=ky,wayNodeIndex=v.index}});locs=_.pluck(locs,"loc");if(locs[0]){if(null==wayNodeIndex||wayNodeIndex+1>nodes2.length-1){}else{let n1=context.entity(nodes2[wayNodeIndex]),n2=context.entity(nodes2[wayNodeIndex+1]);let diff=n1.loc[0]-n2.loc[0],mdiff=n1.loc[0]-lnglat[0];if(0==diff){diff=n1.loc[1]-n2.loc[1];mdiff=n1.loc[1]-lnglat[1]}locs[0][2]=n1.loc[2]+(n1.loc[2]-n2.loc[2])*(mdiff/diff)}}var locflag=!lnglat&&locs[0]||idx!==undefined&&locs[idx];if(0!==locs.length&&locflag&&2<=locflag.length){var currLayer=iD.Layers.getCurrentModelEnableLayer(modelNameParam.DIVIDER_NODE);var loc=!lnglat&&locs[0]||idx!==undefined&&locs[idx],node=iD.Node({layerId:currLayer.id,modelName:modelNameParam.DIVIDER_NODE,loc:loc});if(isHighWayModel(ways[i],ways[j])){node=node.mergeTags(iD.util.getDefauteTags(modelNameParam.DIVIDER_NODE,currLayer))}nodesArr.push(node);twoWays.forEach(function(way){var choice=iD.geo.chooseEdge(graph.childNodes(way),context.projection(loc),context.projection),edge=[way.nodes[choice.index-1],way.nodes[choice.index]];if(isHighWayModel(ways[i],ways[j])){graph=iD.actions.AddMidpoint({loc:loc,edge:edge},node)(graph)}});ways=_.uniq(selectIDs).map(function(id){return graph.entity(id)});var handle=iD.topo.handle();graph=handle.roadIntersect(graph,[node],ways)}}}}ways.forEach(function(way){var roadNodesArr=[];nodesArr.forEach(function(node){if(0<=way.nodes.indexOf(node.id)){roadNodesArr.push(node.id)}});if(0<roadNodesArr.length){graph=iD.actions.SplitRoad(roadNodesArr,context,way.id)(graph)}});var handle=iD.topo.handle();graph=handle.roadIntersect(graph,nodesArr,ways);selectIDs.length=0;return graph};action.disabled=function(graph){return false};return action};;iD.actions.ExpandRoad=function(wayIds,projection,context){var topoEntity=iD.TopoEntity();var lineCal=iD.util.LineCalCulate();var userInputParam={left:"",right:"",originalRoadTag:""};var newWays=[];var originalWayIds=[];var action=function(graph){newWays=[];originalWayIds=[];wayIds.forEach(function(wayId){originalWayIds.push(wayId);var survivor=graph.entity(wayId),rawNodes=[],newNodes=[],newWay;if(userInputParam.left&&0<Number(userInputParam.left)){newroad("left",survivor,newNodes,newWay)}});wayIds.forEach(function(wayId){var survivor=graph.entity(wayId),rawNodes=[],newNodes=[],newWay;if(userInputParam.right&&0<Number(userInputParam.right)){newroad("right",survivor,newNodes,newWay)}});if(false==userInputParam.originalRoadTag){for(var i=0;i<originalWayIds.length;i++){graph=iD.actions.DeleteWay(originalWayIds[i])(graph)}}var handle=iD.measureinfo.handle();newWays.forEach(function(way){if(way.modelName==iD.data.DataType.ROAD){graph=iD.actions.AddRoad(way.id)(graph)}if(way.modelName==iD.data.DataType.DIVIDER){let firstNode=graph.entity(way.nodes[0]);let relation=graph.parentRelations(firstNode,iD.data.DataType.MEASUREINFO)[0];graph=handle[relation?"updateEntity":"addEntity"](graph,firstNode,{type:5,method:7,lineType:"divider"})}});return graph;function newroad(position,survivor,newNodes,newWay){var newLoc;var oldLoc;var interPoint=[0,0];var nodeEntity;var adjoinEntity;var newNodeEntitys=[];for(var i=0;i<survivor.nodes.length-1;i++){nodeEntity=graph.entity(survivor.nodes[i]);adjoinEntity=graph.entity(survivor.nodes[i+1]);if(nodeEntity.loc[0]==adjoinEntity.loc[0]&&nodeEntity.loc[1]==adjoinEntity.loc[1]){continue}if(0==i){newLoc=getLngLat(nodeEntity.loc[0],nodeEntity.loc[1],adjoinEntity.loc[0],adjoinEntity.loc[1],position);interPoint=[newLoc[0].Longitude,newLoc[0].Latitude]}else{newLoc=getLngLat(nodeEntity.loc[0],nodeEntity.loc[1],adjoinEntity.loc[0],adjoinEntity.loc[1],position);lineCal.getIntersectionPoint(projection,[oldLoc[0].Longitude,oldLoc[0].Latitude],[oldLoc[1].Longitude,oldLoc[1].Latitude],[newLoc[0].Longitude,newLoc[0].Latitude],[newLoc[1].Longitude,newLoc[1].Latitude],interPoint)}let h=nodeEntity.loc[2]||-1;var newNodeEntity=iD.Node({layerId:nodeEntity.layerId,loc:[interPoint[0],interPoint[1],h],modelName:nodeEntity.modelName,tags:iD.util.tagExtend.updateTaskTag(nodeEntity)});newNodes.push(newNodeEntity.id);newNodeEntitys.push(newNodeEntity);oldLoc=newLoc}let h=adjoinEntity.loc[2]||-1;var newNodeEntity=iD.Node({layerId:adjoinEntity.layerId,modelName:nodeEntity.modelName,loc:[newLoc[1].Longitude,newLoc[1].Latitude,h],tags:iD.util.tagExtend.updateTaskTag(adjoinEntity)});newNodes.push(newNodeEntity.id);newNodeEntitys.push(newNodeEntity);var isOutTansactionExtent=false;for(var i=0;i<newNodeEntitys.length;i++){if(iD.util.pointNotInPlyGonx(newNodeEntitys[i].loc,context)){isOutTansactionExtent=true;break}}if(true==isOutTansactionExtent){if("left"==position){Dialog.alert("\u5DE6\u8FB9\u6269\u8DEF\uFF0C\u5DF2\u51FA\u5BF9\u8C61\u8FB9\u754C",callback)}else if("right"==position){Dialog.alert("\u53F3\u8FB9\u6269\u8DEF\uFF0C\u5DF2\u51FA\u5BF9\u8C61\u8FB9\u754C",callback)}}else if(false==isOutTansactionExtent){for(let i=0;i<newNodeEntitys.length;i++){graph=graph.replace(newNodeEntitys[i])}newWay=iD.Way({modelName:survivor.modelName,layerId:survivor.layerId,nodes:newNodes,tags:survivor.tags});newWay.tags=iD.util.tagExtend.updateTaskTag(newWay);graph=graph.replace(newWay);newWays.push(newWay)}};function callback(){context.enter(iD.modes.Browse(context))};function getLngLat(lngA,latA,lngB,latB,position){var result=new Array;var angle=lineCal.getAngle(lngA,latA,lngB,latB);var distance=0.003;if("left"==position){angle=angle-90+360;if(""!=userInputParam.left){distance=userInputParam.left/1000}}else if("right"==position){angle=angle+90+360;if(""!=userInputParam.right){distance=userInputParam.right/1000}}var newPointA={};var newPointB={};var pointA=lineCal.calculateVerticalP(lngA,latA,distance,angle);newPointA.Longitude=pointA.Longitude;newPointA.Latitude=pointA.Latitude;result.push(newPointA);var pointB=lineCal.calculateVerticalP(lngB,latB,distance,angle);newPointB.Longitude=pointB.Longitude;newPointB.Latitude=pointB.Latitude;result.push(newPointB);return result};};action.setUserInputParam=function(_){userInputParam=_};action.disabled=function(){return false};return action};;iD.actions.HorizontalMove=function(context,projection,nodes,dist,isLeft){var handle=iD.measureinfo.handle();function getLnglat(lngA,latA,lngB,latB,dist,isLeft){var result=new Array;var lineCal=iD.util.LineCalCulate();var angle=lineCal.getAngle(lngA,latA,lngB,latB);if(isLeft){angle=angle-90+360}else{angle=angle+90+360}var newPointA={};var newPointB={};var pointA=lineCal.calculateVerticalP(lngA,latA,dist,angle);newPointA.Longitude=pointA.Longitude;newPointA.Latitude=pointA.Latitude;result.push(newPointA);var pointB=lineCal.calculateVerticalP(lngB,latB,dist,angle);newPointB.Longitude=pointB.Longitude;newPointB.Latitude=pointB.Latitude;result.push(newPointB);return result}var action=function(graph){var newLoc;var oldLoc;var interPoint=[0,0];var nodeEntity;var adjoinEntity;var lineCal=iD.util.LineCalCulate();for(var i=0;i<nodes.length-1;i++){nodeEntity=nodes[i];adjoinEntity=nodes[i+1];if(0==i){newLoc=getLnglat(nodeEntity.loc[0],nodeEntity.loc[1],adjoinEntity.loc[0],adjoinEntity.loc[1],dist,isLeft);interPoint=[newLoc[0].Longitude,newLoc[0].Latitude]}else{newLoc=getLnglat(nodeEntity.loc[0],nodeEntity.loc[1],adjoinEntity.loc[0],adjoinEntity.loc[1],dist,isLeft);lineCal.getIntersectionPoint(projection,[oldLoc[0].Longitude,oldLoc[0].Latitude],[oldLoc[1].Longitude,oldLoc[1].Latitude],[newLoc[0].Longitude,newLoc[0].Latitude],[newLoc[1].Longitude,newLoc[1].Latitude],interPoint)}graph=iD.actions.MoveNode(nodeEntity.id,[interPoint[0],interPoint[1],nodeEntity.loc[2]])(graph);if(0==i&&handle){graph=handle.addEntity(graph,nodeEntity,{type:6,method:6,data:[{type:"pan"}]})}oldLoc=newLoc}graph=iD.actions.MoveNode(adjoinEntity.id,[newLoc[1].Longitude,newLoc[1].Latitude,adjoinEntity.loc[2]])(graph);return graph};action.disabled=function(){return false};return action};;iD.actions.TopoSplit=function(context,selectedWays,entity,newNodeEntityArr){return function(graph){var selectedWay=graph.entity(selectedWays);var nodeLength=selectedWay.nodes.length;var fromNode=selectedWay.nodes[0];var fromNodeEntity=graph.entity(fromNode);var toNode=selectedWay.nodes[nodeLength-1];var toNodeEntity=graph.entity(toNode);var fromToNodes=[fromNode,toNode];var newNodeId;var layers=iD.Layers;var currentLayer=layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD_NODE);if(fromNode==entity.id){var newNodeEntity=new iD.Node({loc:fromNodeEntity.loc,layerId:currentLayer.id,modelName:iD.data.DataType.ROAD_NODE,tags:iD.util.getDefauteTags(iD.data.DataType.ROAD_NODE,currentLayer)});selectedWay=selectedWay.updateNode(newNodeEntity.id,0);selectedWay=selectedWay.mergeTags(iD.util.tagExtend.updateTaskTag(selectedWay));graph=graph.replace(selectedWay);graph=graph.replace(newNodeEntity)}else if(toNode==entity.id){var newNodeEntity=new iD.Node({loc:toNodeEntity.loc,layerId:currentLayer.id,modelName:iD.data.DataType.ROAD_NODE,tags:iD.util.getDefauteTags(iD.data.DataType.ROAD_NODE,currentLayer)});selectedWay=selectedWay.updateNode(newNodeEntity.id,nodeLength-1);selectedWay=selectedWay.mergeTags(iD.util.tagExtend.updateTaskTag(selectedWay));graph=graph.replace(newNodeEntity)}else{Dialog.alert("\u8BF7\u5728\u9009\u62E9\u7684\u9053\u8DEF\u9996\u5C3E\u7ED3\u70B9\u8FDB\u884C\u9053\u8DEF\u62D3\u8865\u5206\u79BB\uFF01\uFF01")}graph=graph.replace(entity);graph=graph.replace(selectedWay);if(newNodeEntity){newNodeEntityArr.push(newNodeEntity);if(entity.new_id_inherit){newNodeEntity.new_id_inherit=entity.new_id_inherit}else{newNodeEntity.new_id_inherit=iD.Entity.id.toOSM(entity.id)+"-"}graph=graph.replace(entity);var handle=iD.topo.handle();graph=handle.topoSplit(graph,newNodeEntity,entity,selectedWays)}return graph}};;;iD.actions.ConnectDivider=function(context,nodeIds){return function(graph){var survivor=graph.entity(_.last(nodeIds));for(var i=0;i<nodeIds.length-1;i++){var node=graph.entity(nodeIds[i]);graph.parentWays(node).forEach(function(parent){if(!parent.areAdjacent(node.id,survivor.id)){parent.tags=iD.util.tagExtend.updateTaskTag(parent);graph=graph.replace(parent.replaceNode(node.id,survivor.id))}});graph.parentRelations(node).forEach(function(parent){parent.tags=iD.util.tagExtend.updateTaskTag(parent);graph=graph.replace(parent.replaceMember(node,survivor))});survivor=survivor.mergeTags(node.tags);graph=iD.actions.DeleteNode(node.id)(graph)}graph=graph.replace(survivor);return graph}};;;iD.behavior={};;;iD.behavior.AddWay=function(context){var event=d3.dispatch("start","startFromWay","startFromNode","dragend"),draw=iD.behavior.Draw(context);var addWay=function(surface){draw.on("click",event.start).on("clickWay",event.startFromWay).on("clickNode",event.startFromNode).on("cancel",addWay.cancel).on("finish",addWay.cancel);context.map().on("dragend",event.dragend);context.map().dblclickEnable(false);surface.call(draw)};addWay.off=function(surface){surface.call(draw.off)};addWay.cancel=function(){window.setTimeout(function(){context.map().dblclickEnable(true)},1000);context.enter(iD.modes.Browse(context))};addWay.tail=function(text){draw.tail(text);return addWay};return d3.rebind(addWay,event,"on")};;;iD.behavior.drag=function(){function d3_eventCancel(){d3.event.stopPropagation();d3.event.preventDefault()}var event=d3.dispatch("start","move","end"),origin=null,selector="",filter=null,event_,target,surface;event.of=function(thiz,argumentz){return function(e1){var e0=e1.sourceEvent=d3.event;e1.target=drag;d3.event=e1;try{event[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}};var d3_event_userSelectProperty=iD.util.prefixCSSProperty("UserSelect"),d3_event_userSelectSuppress=d3_event_userSelectProperty?function(){var selection=d3.selection(),select=selection.style(d3_event_userSelectProperty);selection.style(d3_event_userSelectProperty,"none");return function(){selection.style(d3_event_userSelectProperty,select)}}:function(type){var w=d3.select(window).on("selectstart."+type,d3_eventCancel);return function(){w.on("selectstart."+type,null)}};function mousedown(){target=this;event_=event.of(target,arguments);var eventTarget=d3.event.target,touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null,offset,origin_=point(),started=false,selectEnable=d3_event_userSelectSuppress(null!==touchId?"drag-"+touchId:"drag");var w=d3.select(window).on(null!==touchId?"touchmove.drag-"+touchId:"mousemove.drag",dragmove).on(null!==touchId?"touchend.drag-"+touchId:"mouseup.drag",dragend,true);if(origin){offset=origin.apply(target,arguments);offset=[offset[0]-origin_[0],offset[1]-origin_[1]]}else{offset=[0,0]}if(null===touchId)d3.event.stopPropagation();function point(){var p=target.parentNode||surface;return null!==touchId?d3.touches(p).filter(function(p){return p.identifier===touchId})[0]:d3.mouse(p)}function dragmove(){var p=point(),dx=p[0]-origin_[0],dy=p[1]-origin_[1];if(0===dx&&0===dy)return;if(!started){started=true;event_({type:"start"})}origin_=p;d3_eventCancel();event_({type:"move",point:[p[0]+offset[0],p[1]+offset[1]],delta:[dx,dy]})}function dragend(){if(started){event_({type:"end"});d3_eventCancel();if(d3.event.target===eventTarget)w.on("click.drag",click,true)}w.on(null!==touchId?"touchmove.drag-"+touchId:"mousemove.drag",null).on(null!==touchId?"touchend.drag-"+touchId:"mouseup.drag",null);selectEnable()}function click(){d3_eventCancel();w.on("click.drag",null)}}function drag(selection){var matchesSelector=iD.util.prefixDOMProperty("matchesSelector"),delegate=mousedown;if(selector){delegate=function(){var root=this,target=d3.event.target;for(;target&&target!==root;target=target.parentNode){if(target[matchesSelector](selector)&&(!filter||filter(target.__data__))){return mousedown.call(target,target.__data__)}}}}selection.on("mousedown.drag"+selector,delegate).on("touchstart.drag"+selector,delegate)}drag.off=function(selection){selection.on("mousedown.drag"+selector,null).on("touchstart.drag"+selector,null)};drag.delegate=function(_){if(!arguments.length)return selector;selector=_;return drag};drag.filter=function(_){if(!arguments.length)return origin;filter=_;return drag};drag.origin=function(_){if(!arguments.length)return origin;origin=_;return drag};drag.cancel=function(){d3.select(window).on("mousemove.drag",null).on("mouseup.drag",null);return drag};drag.target=function(){if(!arguments.length)return target;target=arguments[0];event_=event.of(target,Array.prototype.slice.call(arguments,1));return drag};drag.surface=function(){if(!arguments.length)return surface;surface=arguments[0];return drag};return d3.rebind(drag,event,"on")};;;iD.behavior.Draw=function(context){var event=d3.dispatch("move","click","clickWay","clickNode","undo","cancel","finish"),keybinding=d3.keybinding("draw"),hover=iD.behavior.Hover(context).altDisables(true).on("hover",context.ui().sidebar.hover),tail=iD.behavior.Tail(),edit=iD.behavior.Edit(context),closeTolerance=4,tolerance=12;function datum(){if(d3.event.altKey)return{};else return d3.event.target.__data__||{}}function mousedown(){function point(){var p=element.node().parentNode;return null!==touchId?d3.touches(p).filter(function(p){return p.identifier===touchId})[0]:d3.mouse(p)}var element=d3.select(this),touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null,time=+new Date,pos=point();element.on("mousemove.draw",null);d3.select(window).on("mouseup.draw",function(){element.on("mousemove.draw",mousemove);if(iD.geo.euclideanDistance(pos,point())<closeTolerance||iD.geo.euclideanDistance(pos,point())<tolerance&&500>+new Date-time){d3.select(window).on("click.draw-block",function(){d3.event.stopPropagation()},true);context.map().dblclickEnable(false);window.setTimeout(function(){context.map().dblclickEnable(true);d3.select(window).on("click.draw-block",null)},500);click()}})}function mousemove(){event.move(datum())}function click(){if(iD.util.pointNotInPlyGonx(context.map().mouseCoordinates(),context)){Dialog.alert("\u5DF2\u51FA\u5BF9\u8C61\u8FB9\u754C\uFF01");return false}var d=datum(),modelConfig=iD.Layers.getLayer(d.layerId,d.modelName),isEnable=modelConfig?modelConfig.editable:"";if("way"==d.type&&isEnable){var nodes=d.nodes;for(var i=0;i<nodes.length;i++){var node=context.graph().entity(nodes[i]);if(iD.util.pointNotInPlyGonx(node.loc,context)){Dialog.alert("\u70B9\u51FB\u7684\u9053\u8DEF\u5DF2\u51FA\u5BF9\u8C61\u8FB9\u754C\uFF01");return false}}}else if(d instanceof iD.Node&&isEnable&&d.modelName==iD.data.DataType.HIGHWAY){var way=context.graph().parentWays(d);if(1==way.length){var nodes=way[0].nodes;for(var i=0;i<nodes.length;i++){var node=context.graph().entity(nodes[i]);if(iD.util.pointNotInPlyGonx(node.loc,context)){Dialog.alert("\u70B9\u51FB\u7684\u9053\u8DEF\u5DF2\u51FA\u5BF9\u8C61\u8FB9\u754C\uFF01");return false}}}}if("way"===d.type&&isEnable){var choice=iD.geo.chooseEdge(context.childNodes(d),context.mouse(),context.projection),edge=[d.nodes[choice.index-1],d.nodes[choice.index]];event.clickWay(choice.loc,edge,d)}else if("node"===d.type&&isEnable){event.clickNode(d)}else{event.click(context.map().mouseCoordinates())}}function backspace(){d3.event.preventDefault();event.undo()}function del(){d3.event.preventDefault();event.cancel()}function ret(){d3.event.preventDefault();event.finish()}function draw(selection){context.install(hover);context.install(edit);if(!iD.behavior.Draw.usedTails[tail.text()]){context.install(tail)}keybinding.on("\u232B",backspace).on("\u2326",del).on("\u238B",ret).on("\u21A9",ret);selection.on("mousedown.draw",mousedown).on("mousemove.draw",mousemove);d3.select(document).call(keybinding);return draw}draw.off=function(selection){context.uninstall(hover);context.uninstall(edit);if(!iD.behavior.Draw.usedTails[tail.text()]){context.uninstall(tail);iD.behavior.Draw.usedTails[tail.text()]=true}selection.on("mousedown.draw",null).on("mousemove.draw",null);d3.select(window).on("mouseup.draw",null);d3.select(document).call(keybinding.off)};draw.tail=function(_){tail.text(_);return draw};return d3.rebind(draw,event,"on")};iD.behavior.Draw.usedTails={};;;iD.behavior.DrawWay=function(context,wayId,index,mode,baseGraph){var moveData,undoAndContine=false;var keybinding=d3.keybinding("DrawWay");var way=context.entity(wayId),constant=iD.data.DataType,isArea="area"===context.geometry(wayId),finished=false,annotation=t((way.isDegenerate()?"operations.start.annotation.":"operations.continue.annotation.")+context.geometry(wayId)),draw=iD.behavior.Draw(context);var startIndex="undefined"===typeof index?way.nodes.length-1:0,start=iD.Node({loc:context.graph().entity(way.nodes[startIndex]).loc,modelName:constant.ROAD_NODE}),end=iD.Node({loc:context.map().mouseCoordinates(),modelName:constant.ROAD_NODE}),segment=iD.Way({nodes:"undefined"===typeof index?[start.id,end.id]:[end.id,start.id],tags:_.clone(way.tags),layerId:iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD_NODE).id,modelName:constant.ROAD});var isConnectFakeNode=false;var f=context[way.isDegenerate()?"replace":"perform"];var firstNode=context.graph().entity(way.nodes[0]);f(iD.actions.AddEntity(start),iD.actions.AddEntity(end),iD.actions.AddEntity(segment));function move(datum){moveData=datum;var loc,enableLayer=context.layers().getLayer(iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD).id);if("node"===datum.type&&datum.id!==end.id){loc=datum.loc}else if("way"===datum.type&&datum.id!==segment.id&&enableLayer&&enableLayer.id===datum.layerId&&!datum.isArea()){loc=iD.geo.chooseEdge(context.childNodes(datum),context.mouse(),context.projection).loc}else{loc=context.map().mouseCoordinates()}context.replace(iD.actions.MoveNode(end.id,loc),"\u7ED8\u5236\u7EBF\u7684\u70B9")}function undone(){finished=true;context.enter(iD.modes.Browse(context))}function setActiveElements(){var active=isArea?[wayId,end.id]:[segment.id,start.id,end.id];context.surface().selectAll(iD.util.entitySelector(active)).classed("active",true)}function createWayWithHighwayNode(){if(window.fakeNodesArr&&window.fakeNodesArr[0]){var fakeNode=window.fakeNodesArr[0];var nodesArr=way.nodes;nodesArr.forEach(function(nodeID){if(nodeID==fakeNode.id){var newNode=iD.Node({layerId:fakeNode.layerId,loc:fakeNode.loc,modelName:constant.ROAD_NODE});context.replace(iD.actions.AddEntity(newNode),annotation);var graph=context.graph();var parentWays=graph.parentWays(fakeNode);parentWays.forEach(function(way){var wayNodesArr=way.nodes;wayNodesArr.forEach(function(wayNode){if(wayNode==fakeNode.id){way=way.replaceNode(nodeID,newNode.id);context.replace(iD.actions.AddEntity(way),annotation)}})});context.replace(iD.actions.DeleteNode(nodeID),annotation);way=context.graph().entity(way.id);newNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(context.graph(),newNode);newNode=iD.util.tagExtend.updateNodeMeshTag(newNode,context);context.replace(iD.actions.AddEntity(newNode),annotation)}});isConnectFakeNode=true}}function cancelWholeWay(){context.replace(iD.actions.AddEntity(way),annotation);var nodes=way.nodes;for(var i=0;i<nodes.length;i++){context.undo()}finished=true;context.enter(iD.modes.AddRoad(context))}var drawWay=function(surface){draw.on("move",move).on("click",drawWay.add).on("clickWay",drawWay.addWay).on("clickNode",drawWay.addNode).on("undo",context.undo).on("cancel",drawWay.cancel).on("finish",drawWay.finish);keybinding.on("Shift+Z",cancelWholeWay);d3.select(document).call(keybinding);context.map().dblclickEnable(false).on("drawn.draw",setActiveElements);setActiveElements();surface.call(draw);context.history().on("undone.draw",undone)};drawWay.off=function(surface){if(!finished&&false==undoAndContine){context.pop()}if(finished&&context.hasEntity(way.id)&&1<context.entity(way.id).nodes.length){context.replace(iD.actions.AddRoad(way.id,context),annotation)}context.map().on("drawn.draw",null);surface.call(draw.off).selectAll(".active").classed("active",false);context.history().on("undone.draw",null);keybinding.off()};function ReplaceTemporaryNode(newNode){return function(graph){newNode.layerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD_NODE).id;if(isArea){graph=graph.replace(way.addNode(newNode.id,index)).remove(end);return graph}else{var graph=graph.replace(graph.entity(wayId).addNode(newNode.id,index)).remove(end).remove(segment).remove(start);return graph}}}drawWay.add=function(loc){var cNode;if("undefined"===typeof index){cNode=context.hasEntity(way.nodes[way.nodes.length-(isArea?2:1)])}else{cNode=context.graph().entity(way.nodes[0>index?0:index])}if(cNode&&cNode.loc[0]===loc[0]&&cNode.loc[1]===loc[1])return;var nodeLayerId=iD.Layers.getCurrentModelEnableLayer(constant.ROAD_NODE).id;var newNode=new iD.Node({loc:loc,layerId:nodeLayerId,modelName:constant.ROAD_NODE});var cIndex=way.nodes.indexOf(cNode.id),tags=_.clone(cNode.tags);newNode.setTags(iD.util.getDefauteTags(newNode,iD.Layers.getLayer(newNode.layerId)));var actions=[iD.actions.AddEntity(newNode),ReplaceTemporaryNode(newNode),annotation];context.replace.apply(this,actions);finished=true;context.enter(mode)};drawWay.addWay=function(loc,edge,originalEntity){var previousEdge=startIndex?[way.nodes[startIndex],way.nodes[startIndex-1]]:[way.nodes[0],way.nodes[1]];if(iD.geo.edgeEqual(edge,previousEdge))return;var parents=_.intersection(context.graph().parentWays(context.entity(edge[0])),context.graph().parentWays(context.entity(edge[1])));if(-1!=parents.indexOf(way)){return}var nodeLayerId=iD.Layers.getCurrentModelEnableLayer(constant.ROAD_NODE).id;var newNode=iD.Node({loc:loc,layerId:nodeLayerId});newNode.modelName=constant.ROAD_NODE;newNode.setTags(iD.util.getDefauteTags(newNode,iD.Layers.getLayer(newNode.layerId)));context.perform(iD.actions.AddEntity(newNode),ReplaceTemporaryNode(newNode),annotation);finished=true;context.enter(mode)};drawWay.addNode=function(node){if(way.areAdjacent(node.id,way.nodes[way.nodes.length-1]))return;if(-1!=way.nodes.indexOf(node.id)){return}var actions=[];var newNode=iD.Node({layerId:node.layerId,loc:node.loc,modelName:constant.ROAD_NODE});newNode.setTags(iD.util.getDefauteTags(newNode,iD.Layers.getLayer(newNode.layerId)));actions.push(iD.actions.AddEntity(newNode));actions.push(...[ReplaceTemporaryNode(newNode),annotation]);context.perform.apply(this,actions);finished=true;context.enter(mode)};drawWay.finish=function(){context.pop();finished=true;createWayWithHighwayNode();window.setTimeout(function(){context.map().dblclickEnable(true)},1000);if(context.hasEntity(wayId)){context.enter(iD.modes.Select(context,[wayId]).suppressMenu(true).newFeature(true));var newWay=context.entity(wayId);var tNode=context.entity(newWay.last());if(tNode.tags.boundary&&"20"==tNode.tags.boundary&&tNode.tags.realnode&&"0"==tNode.tags.realnode){Dialog.alert("\u76EE\u6807\u70B9\u4E3A\u8DE8\u56FE\u5E45\u8FB9\u6846\u70B9\uFF0C\u4E0D\u80FD\u662F\u771F\u5B9E\u8282\u70B9",function(){context.enter(iD.modes.Browse(context))});return}}else{context.enter(iD.modes.Browse(context))}};drawWay.cancel=function(){context.perform(d3.functor(baseGraph),t("operations.cancel_draw.annotation"));window.setTimeout(function(){context.map().dblclickEnable(true)},1000);finished=true;context.enter(iD.modes.Browse(context))};drawWay.tail=function(text){draw.tail(text);return drawWay};return drawWay};;;iD.behavior.DrawLandCoverArea=function(context,wayId,index,mode,baseGraph){var way=context.entity(wayId),finished=false,constant=iD.data.DataType,annotation=t((way.isDegenerate()?"operations.start.annotation.":"operations.continue.annotation.")+context.geometry(wayId)),draw=iD.behavior.Draw(context);var startIndex="undefined"===typeof index?way.nodes.length-1:0,start=iD.Node({loc:context.graph().entity(way.nodes[startIndex]).loc,modelName:constant.LANDCOVERAREA}),end=iD.Node({loc:context.map().mouseCoordinates(),modelName:constant.LANDCOVERAREA}),segment=iD.Way({nodes:"undefined"===typeof index?[start.id,end.id]:[end.id,start.id],tags:_.clone(way.tags)});var f=context[way.isDegenerate()?"replace":"perform"];f(iD.actions.AddEntity(end),iD.actions.AddVertex(wayId,end.id,index));function move(datum){var loc;if("node"===datum.type&&datum.id!==end.id){loc=datum.loc}else if("way"===datum.type&&datum.id!==segment.id){loc=iD.geo.chooseEdge(context.childNodes(datum),context.mouse(),context.projection,datum).loc}else{loc=context.map().mouseCoordinates()}context.replace(iD.actions.MoveNode(end.id,loc))}function undone(){finished=true;context.enter(iD.modes.Browse(context))}function setActiveElements(){var active=[wayId,end.id];context.surface().selectAll(iD.util.entitySelector(active)).classed("active",true)}var drawWay=function(surface){draw.on("move",move).on("click",drawWay.add).on("clickWay",drawWay.addWay).on("clickNode",drawWay.addNode).on("undo",context.undo).on("cancel",drawWay.cancel).on("finish",drawWay.finish);context.map().dblclickEnable(false).on("drawn.draw",setActiveElements);setActiveElements();surface.call(draw);context.history().on("undone.draw",undone)};drawWay.off=function(surface){if(!finished)context.pop();context.map().on("drawn.draw",null);surface.call(draw.off).selectAll(".active").classed("active",false);context.history().on("undone.draw",null)};function ReplaceTemporaryNode(newNode){return function(graph){graph=graph.replace(way.addNode(newNode.id,index));return graph}}drawWay.add=function(loc){let preNode=context.graph().entity(way.nodes[way.nodes.length-1]);var last=context.hasEntity(way.nodes[way.nodes.length-2]);var wayLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.LANDCOVERAREA).id;var newNode=iD.Node({loc:loc,layerId:wayLayerId,modelName:iD.data.DataType.LANDCOVERAREA});context.replace(iD.actions.AddEntity(newNode),ReplaceTemporaryNode(newNode),annotation);finished=true;context.enter(mode)};drawWay.addWay=function(loc,edge,clickWay){drawWay.add(loc)};drawWay.addNode=function(node){if(way.areAdjacent(node.id,way.nodes[way.nodes.length-1]))return;context.perform(ReplaceTemporaryNode(node),annotation);finished=true;context.enter(mode)};drawWay.finish=function(){context.pop();finished=true;window.setTimeout(function(){context.map().dblclickEnable(true)},1000);if(context.hasEntity(wayId)){context.enter(iD.modes.Select(context,[wayId]).suppressMenu(true).newFeature(true))}else{context.enter(iD.modes.Browse(context))}};drawWay.cancel=function(){context.perform(d3.functor(baseGraph),t("operations.cancel_draw.annotation"));window.setTimeout(function(){context.map().dblclickEnable(true)},1000);finished=true;context.enter(iD.modes.Browse(context))};drawWay.tail=function(text){draw.tail(text);return drawWay};return drawWay};;;iD.behavior.DrawBoardArea=function(context,wayId,index,mode,baseGraph){var way=context.entity(wayId),finished=false,constant=iD.data.DataType,annotation=t((way.isDegenerate()?"operations.start.annotation.":"operations.continue.annotation.")+context.geometry(wayId)),draw=iD.behavior.Draw(context);var startIndex="undefined"===typeof index?way.nodes.length-1:0,start=iD.Node({loc:context.graph().entity(way.nodes[startIndex]).loc}),end=iD.Node({loc:context.map().mouseCoordinates()}),segment=iD.Way({nodes:"undefined"===typeof index?[start.id,end.id]:[end.id,start.id],tags:_.clone(way.tags)});var f=context[way.isDegenerate()?"replace":"perform"];f(iD.actions.AddEntity(end),iD.actions.AddVertex(wayId,end.id,index));function move(datum){var loc;if("node"===datum.type&&datum.id!==end.id){loc=datum.loc}else if("way"===datum.type&&datum.id!==segment.id){loc=iD.geo.chooseEdge(context.childNodes(datum),context.mouse(),context.projection,datum).loc}else{loc=context.map().mouseCoordinates()}context.replace(iD.actions.MoveNode(end.id,loc))}function undone(){finished=true;context.enter(iD.modes.Browse(context))}function setActiveElements(){var active=[wayId,end.id];context.surface().selectAll(iD.util.entitySelector(active)).classed("active",true)}var drawWay=function(surface){draw.on("move",move).on("click",drawWay.add).on("clickWay",drawWay.addWay).on("clickNode",drawWay.addNode).on("undo",context.undo).on("cancel",drawWay.cancel).on("finish",drawWay.finish);context.map().dblclickEnable(false).on("drawn.draw",setActiveElements);setActiveElements();surface.call(draw);context.history().on("undone.draw",undone)};drawWay.off=function(surface){if(!finished)context.pop();context.map().on("drawn.draw",null);surface.call(draw.off).selectAll(".active").classed("active",false);context.history().on("undone.draw",null)};function ReplaceTemporaryNode(newNode){return function(graph){graph=graph.replace(way.addNode(newNode.id,index));return graph}}drawWay.add=function(loc){let preNode=context.graph().entity(way.nodes[way.nodes.length-1]);var last=context.hasEntity(way.nodes[way.nodes.length-2]);var wayLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.TRAFFICSIGN_NODE).id;var newNode=iD.Node({loc:loc,layerId:wayLayerId,modelName:iD.data.DataType.TRAFFICSIGN_NODE});context.replace(iD.actions.AddEntity(newNode),ReplaceTemporaryNode(newNode),annotation);finished=true;context.enter(mode)};drawWay.addWay=function(loc,edge,clickWay){drawWay.add(loc)};drawWay.addNode=function(node){if(way.areAdjacent(node.id,way.nodes[way.nodes.length-1]))return;context.perform(ReplaceTemporaryNode(node),annotation);finished=true;context.enter(mode)};drawWay.finish=function(){context.pop();finished=true;window.setTimeout(function(){context.map().dblclickEnable(true)},1000);if(context.hasEntity(wayId)){context.enter(iD.modes.Select(context,[wayId]).suppressMenu(true).newFeature(true))}else{context.enter(iD.modes.Browse(context))}};drawWay.cancel=function(){context.perform(d3.functor(baseGraph),t("operations.cancel_draw.annotation"));window.setTimeout(function(){context.map().dblclickEnable(true)},1000);finished=true;context.enter(iD.modes.Browse(context))};drawWay.tail=function(text){draw.tail(text);return drawWay};return drawWay};;;iD.behavior.DrawFusionDivider=function(context,wayId,index,mode,baseGraph){var moveData,undoAndContine=false;var keybinding=d3.keybinding("DrawDivider");var way=context.entity(wayId),constant=iD.data.DataType,isArea="area"===context.geometry(wayId),finished=false,annotation=t((way.isDegenerate()?"operations.start.annotation.":"operations.continue.annotation.")+context.geometry(wayId)),draw=iD.behavior.Draw(context),editLayer=iD.Layers.getLayer();var startIndex="undefined"===typeof index?way.nodes.length-1:0,start=iD.Node({loc:context.graph().entity(way.nodes[startIndex]).loc}),end=iD.Node({loc:context.map().mouseCoordinates()}),segment=iD.Way({nodes:"undefined"===typeof index?[start.id,end.id]:[end.id,start.id],tags:_.clone(way.tags)});var isConnectFakeNode=false;var f=context[way.isDegenerate()?"replace":"perform"];var firstNode=context.graph().entity(way.nodes[0]);var isWalkRoad=firstNode.modelName==constant.WALKENTER;var isHighWay=firstNode.modelName==constant.ROADNODE;isArea=false;f(iD.actions.AddEntity(start),iD.actions.AddEntity(end),iD.actions.AddEntity(segment));if(isWalkRoad){var roadcross=d3.select("g.layer.layer-roadcross");roadcross.classed("no-pointer-events",true);var placename=d3.select("g.layer.layer-placename");placename.classed("no-pointer-events",true)}else if(isHighWay){var walklink=d3.select("g.layer.layer-walk");walklink.classed("no-pointer-events",true)}function move(datum){moveData=datum;var loc,enableLayer=context.layers().getLayer(datum.layerId);if("node"===datum.type&&datum.id!==end.id){loc=datum.loc}else if("way"===datum.type&&datum.id!==segment.id&&enableLayer&&enableLayer.id===datum.layerId&&!datum.isArea()){loc=iD.geo.chooseEdge(context.childNodes(datum),context.mouse(),context.projection).loc}else{loc=context.map().mouseCoordinates()}context.replace(iD.actions.MoveNode(end.id,loc))}function undone(){finished=true;context.enter(iD.modes.Browse(context))}function setActiveElements(){var active=isArea?[wayId,end.id]:[segment.id,start.id,end.id];context.surface().selectAll(iD.util.entitySelector(active)).classed("active",true)}function createWayWithHighwayNode(){if(window.fakeNodesArr&&window.fakeNodesArr[0]){var fakeNode=window.fakeNodesArr[0];var nodesArr=way.nodes;nodesArr.forEach(function(nodeID){if(nodeID==fakeNode.id){var newNode=iD.Node({layerId:fakeNode.layerId,loc:fakeNode.loc});context.replace(iD.actions.AddEntity(newNode),annotation);var graph=context.graph();var parentWays=graph.parentWays(fakeNode);parentWays.forEach(function(way){var wayNodesArr=way.nodes;wayNodesArr.forEach(function(wayNode){if(wayNode==fakeNode.id){way=way.replaceNode(nodeID,newNode.id);context.replace(iD.actions.AddEntity(way),annotation)}})});context.replace(iD.actions.DeleteNode(nodeID),annotation);way=context.graph().entity(way.id);if(isHighWay){newNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(context.graph(),newNode);newNode=iD.util.tagExtend.updateNodeMeshTag(newNode,context)}context.replace(iD.actions.AddEntity(newNode),annotation)}});isConnectFakeNode=true}}function cancelWholeWay(){context.replace(iD.actions.AddEntity(way),annotation);var nodes=way.nodes;for(var i=0;i<nodes.length;i++){context.undo()}finished=true;context.enter(iD.modes.AddRoad(context))}var drawWay=function(surface){draw.on("move",move).on("click",drawWay.add).on("clickWay",drawWay.addWay).on("clickNode",drawWay.addNode).on("undo",context.undo).on("cancel",drawWay.cancel).on("finish",drawWay.finish);keybinding.on("Shift+Z",cancelWholeWay);d3.select(document).call(keybinding);context.map().dblclickEnable(false).on("drawn.draw",setActiveElements);setActiveElements();surface.call(draw);context.history().on("undone.draw",undone)};drawWay.off=function(surface){if(!finished&&false==undoAndContine){createWayWithHighwayNode();var upnode=context.graph().entity(way.nodes[0]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);upnode=context.graph().entity(way.nodes[way.nodes.length-1]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);if(isHighWay){context.replace(iD.actions.AddRoad(way),annotation)}else if(isWalkRoad){context.replace(iD.actions.AddWalkRoad(way),annotation)}context.pop()}context.map().on("drawn.draw",null);surface.call(draw.off).selectAll(".active").classed("active",false);context.history().on("undone.draw",null);keybinding.off()};function ReplaceTemporaryNode(newNode){return function(graph){var currLayer=context.layers().getLayer(newNode.layerId);var layerid=iD.Layers.getCurrentModelEnableLayer(newNode.modelName)?iD.Layers.getCurrentModelEnableLayer(newNode.modelName).id:currLayer.id;newNode.layerId=layerid;if(isArea){graph=graph.replace(way.addNode(newNode.id,index)).remove(end);return graph}else{var graph=graph.replace(graph.entity(wayId).addNode(newNode.id,index)).remove(end).remove(segment).remove(start);if(currLayer.split){var parents=graph.parentWays(newNode);return graph}else{return graph}}}}drawWay.add=function(loc){var cNode;if("undefined"===typeof index){cNode=context.hasEntity(way.nodes[way.nodes.length-(isArea?2:1)])}else{cNode=context.graph().entity(way.nodes[0>index?0:index])}if(cNode&&cNode.loc[0]===loc[0]&&cNode.loc[1]===loc[1])return;var newNode=new iD.Node({loc:loc,layerId:way.layerId,modelName:constant.DIVIDER_NODE});newNode.setTags(iD.util.getDefauteTags(newNode,iD.Layers.getLayer(newNode.layerId)));var cIndex=way.nodes.indexOf(cNode.id),tags=_.clone(cNode.tags);modelName=constant.DIVIDER;newNode.setTags(iD.util.getDefauteTags(newNode,iD.Layers.getLayer(newNode.layerId)));var actions=[iD.actions.AddEntity(newNode),iD.actions.ChangeTags(cNode.id,tags),ReplaceTemporaryNode(newNode),annotation];if(0===cIndex&&2>way.nodes.length)actions.splice(1,1);context.replace.apply(this,actions);finished=true;context.enter(mode)};drawWay.addWay=function(loc,edge,originalEntity){var previousEdge=startIndex?[way.nodes[startIndex],way.nodes[startIndex-1]]:[way.nodes[0],way.nodes[1]];if(!isArea&&iD.geo.edgeEqual(edge,previousEdge))return;var parents=_.intersection(context.graph().parentWays(context.entity(edge[0])),context.graph().parentWays(context.entity(edge[1])));if(-1!=parents.indexOf(way)){return}var last=context.hasEntity(way.nodes[way.nodes.length-(isArea?2:1)]);var newNode=iD.Node({loc:loc,layerId:way.layerId});newNode.modelName=constant.DIVIDER_NODE;newNode.setTags(iD.util.getDefauteTags(newNode,iD.Layers.getLayer(newNode.layerId)));context.perform(iD.actions.AddEntity(newNode),ReplaceTemporaryNode(newNode),annotation);finished=true;context.enter(mode)};drawWay.addNode=function(node){if(way.areAdjacent(node.id,way.nodes[way.nodes.length-1]))return;if(-1!=way.nodes.indexOf(node.id)){return}if(node.modelName==iD.data.DataType.DIVIDER_NODE){var last=context.hasEntity(way.nodes[way.nodes.length-1]);var index=way.nodes.indexOf(last.id);way["inline"]=1;var actions=[];var tags=_.clone(last.tags);var newNode;context.perform(iD.actions.Noop(),t("modes.add_road.description"));if(node.modelName==iD.data.DataType.DIVIDER_NODE){newNode=iD.Node({layerId:node.layerId,loc:node.loc,modelName:iD.data.DataType.DIVIDER_NODE});newNode.setTags(iD.util.getDefauteTags(newNode,iD.Layers.getLayer(newNode.layerId)));actions.push(iD.actions.AddEntity(newNode));actions.push(...[ReplaceTemporaryNode(newNode),annotation]);context.perform.apply(this,actions)}}finished=true;context.enter(mode)};drawWay.finish=function(){context.pop();finished=true;createWayWithHighwayNode();window.setTimeout(function(){context.map().dblclickEnable(true)},1000);if(context.hasEntity(wayId)){context.enter(iD.modes.Select(context,[wayId]).suppressMenu(true).newFeature(true));if(editLayer.continues){if("area"===mode.button&&editLayer.isRoad()){}else if("area"===mode.button){context.enter(iD.modes.AddArea(context))}else if("line"===mode.button&&editLayer&&!editLayer.isRoad()){context.enter(iD.modes.AddLine(context))}else if("line"===mode.button&&editLayer&&editLayer.isRoad()){var upnode=context.graph().entity(way.nodes[0]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);upnode=context.graph().entity(way.nodes[way.nodes.length-1]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);if(isHighWay){context.replace(iD.actions.AddRoad(way),annotation)}var endNodeId=way.nodes[way.nodes.length-1];var graph=editor.context.graph();var endNode=graph.entity(endNodeId)}}if(isWalkRoad){context.replace(iD.actions.AddWalkRoad(way),annotation)}var newWay=context.entity(wayId);var tNode=context.entity(newWay.last());if(tNode.tags.boundary&&"20"==tNode.tags.boundary&&tNode.tags.realnode&&"0"==tNode.tags.realnode){Dialog.alert("\u76EE\u6807\u70B9\u4E3A\u8DE8\u56FE\u5E45\u8FB9\u6846\u70B9\uFF0C\u4E0D\u80FD\u662F\u771F\u5B9E\u8282\u70B9",function(){context.enter(iD.modes.Browse(context))});return}}else{if(isWalkRoad&&1<way.nodes.length){context.replace(iD.actions.AddWalkRoad(way),annotation)}context.enter(iD.modes.Browse(context))}};drawWay.cancel=function(){context.perform(d3.functor(baseGraph),t("operations.cancel_draw.annotation"));window.setTimeout(function(){context.map().dblclickEnable(true)},1000);finished=true;context.enter(iD.modes.Browse(context))};drawWay.tail=function(text){draw.tail(text);return drawWay};return drawWay};;;iD.behavior.DrawDivider=function(context,wayId,index,mode,baseGraph){var moveData,undoAndContine=false;var keybinding=d3.keybinding("DrawDivider");var way=context.entity(wayId),constant=iD.data.DataType,isArea="area"===context.geometry(wayId),finished=false,annotation=t((way.isDegenerate()?"operations.start.annotation.":"operations.continue.annotation.")+context.geometry(wayId)),draw=iD.behavior.Draw(context),editLayer=iD.Layers.getLayer(way.layerId);var startIndex="undefined"===typeof index?way.nodes.length-1:0,start=iD.Node({loc:context.graph().entity(way.nodes[startIndex]).loc,modelName:iD.data.DataType.DIVIDER_NODE,layerId:iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE).id}),end=iD.Node({loc:context.map().mouseCoordinates(),modelName:iD.data.DataType.DIVIDER_NODE,layerId:iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE).id}),segment=iD.Way({nodes:"undefined"===typeof index?[start.id,end.id]:[end.id,start.id],modelName:iD.data.DataType.DIVIDER,layerId:iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER).id,tags:_.clone(way.tags)});var isConnectFakeNode=false;var f=context[way.isDegenerate()?"replace":"perform"];var firstNode=context.graph().entity(way.nodes[0]);var isWalkRoad=firstNode.modelName==constant.WALKENTER;var isHighWay=firstNode.modelName==constant.ROADNODE;isArea=false;f(iD.actions.AddEntity(start),iD.actions.AddEntity(end),iD.actions.AddEntity(segment));if(isWalkRoad){var roadcross=d3.select("g.layer.layer-roadcross");roadcross.classed("no-pointer-events",true);var placename=d3.select("g.layer.layer-placename");placename.classed("no-pointer-events",true)}else if(isHighWay){var walklink=d3.select("g.layer.layer-walk");walklink.classed("no-pointer-events",true)}function move(datum){moveData=datum;var loc,enableLayer=context.layers().getLayer(datum.layerId);if("node"===datum.type&&datum.id!==end.id){loc=datum.loc}else if("way"===datum.type&&datum.id!==segment.id&&enableLayer&&enableLayer.id===datum.layerId&&!datum.isArea()){loc=iD.geo.chooseEdge(context.childNodes(datum),context.mouse(),context.projection).loc}else{loc=context.map().mouseCoordinates()}context.replace(iD.actions.MoveNode(end.id,loc));if(way.inline&&iD.Layers.getLayer(way.layerId).isRoad()&&datum.tags&&datum.modelName==constant.ROADNODE){if(firstNode.modelName==constant.WALKENTER){}else{drawWay.finish();delete way.inline;if(isConnectFakeNode){var nodeID=way.nodes[way.nodes.length-1];datum=context.graph().entity(nodeID)}var graph=context.graph();var fromNode=graph.entity(datum.id);startFromNode(fromNode)}}}function startFromNode(node){var wayLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER).id;var way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.DIVIDER;way.setTags(iD.util.getDefauteTags(way,iD.Layers.getLayer(way.layerId)));if(firstNode.modelName!=constant.WALKENTER){var flag=iD.walkRoadFlag.ROAD}else{var flag=iD.walkRoadFlag.WALKROAD}var args=[iD.util.SplitRoadRule([node.id],context,flag,node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id)];if(node.tags){args.splice(0,1)}context.perform.apply(this,args);context.enter(iD.modes.DrawLine(context,way.id,context.graph(),"","road"))}function undone(){finished=true;context.enter(iD.modes.Browse(context))}function setActiveElements(){var active=isArea?[wayId,end.id]:[segment.id,start.id,end.id];context.surface().selectAll(iD.util.entitySelector(active)).classed("active",true)}function createWayWithHighwayNode(){if(window.fakeNodesArr&&window.fakeNodesArr[0]){var fakeNode=window.fakeNodesArr[0];var nodesArr=way.nodes;nodesArr.forEach(function(nodeID){if(nodeID==fakeNode.id){var newNode=iD.Node({layerId:fakeNode.layerId,loc:fakeNode.loc});context.replace(iD.actions.AddEntity(newNode),annotation);var graph=context.graph();var parentWays=graph.parentWays(fakeNode);parentWays.forEach(function(way){var wayNodesArr=way.nodes;wayNodesArr.forEach(function(wayNode){if(wayNode==fakeNode.id){way=way.replaceNode(nodeID,newNode.id);context.replace(iD.actions.AddEntity(way),annotation)}})});context.replace(iD.actions.DeleteNode(nodeID),annotation);way=context.graph().entity(way.id);if(isHighWay){newNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(context.graph(),newNode);newNode=iD.util.tagExtend.updateNodeMeshTag(newNode,context)}context.replace(iD.actions.AddEntity(newNode),annotation)}});isConnectFakeNode=true}}function cancelWholeWay(){context.replace(iD.actions.AddEntity(way),annotation);var nodes=way.nodes;for(var i=0;i<nodes.length;i++){context.undo()}finished=true;context.enter(iD.modes.AddRoad(context))}var drawWay=function(surface){draw.on("move",move).on("click",drawWay.add).on("clickWay",drawWay.addWay).on("clickNode",drawWay.addNode).on("undo",context.undo).on("cancel",drawWay.cancel).on("finish",drawWay.finish);keybinding.on("Shift+Z",cancelWholeWay);d3.select(document).call(keybinding);context.map().dblclickEnable(false).on("drawn.draw",setActiveElements);setActiveElements();surface.call(draw);context.history().on("undone.draw",undone)};drawWay.off=function(surface){if(!finished&&false==undoAndContine){createWayWithHighwayNode();var upnode=context.graph().entity(way.nodes[0]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);upnode=context.graph().entity(way.nodes[way.nodes.length-1]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);if(isHighWay){context.replace(iD.actions.AddRoad(way),annotation)}else if(isWalkRoad){context.replace(iD.actions.AddWalkRoad(way),annotation)}context.pop()}context.map().on("drawn.draw",null);surface.call(draw.off).selectAll(".active").classed("active",false);context.history().on("undone.draw",null);keybinding.off()};function ReplaceTemporaryNode(newNode){return function(graph){var currLayer=context.layers().getLayer(newNode.layerId);newNode.layerId=iD.Layers.getCurrentModelEnableLayer(newNode.modelName).id;if(isArea){graph=graph.replace(way.addNode(newNode.id,index)).remove(end);return graph}else{var graph=graph.replace(graph.entity(wayId).addNode(newNode.id,index)).remove(end).remove(segment).remove(start);if(currLayer.split){var parents=graph.parentWays(newNode);return graph}else{return graph}}}}drawWay.add=function(loc){if(checkLineNodeDistanceLTE(loc)){return}let cRangeNodes=iD.util.selectNode_Z(loc,40);let tracks=[];for(let i=0;i<cRangeNodes.length;i++){var rangeNodes=cRangeNodes[i];var node=iD.util.getNearestNode(loc,rangeNodes.nodes);tracks.push({node:node,cameraHeight:rangeNodes.cameraHeight,trackId:rangeNodes.traceId})}if(0==tracks.length){Dialog.alert("\u5F53\u524D\u4F4D\u7F6E\uFF0C\u65E0\u6CD5\u83B7\u53D6\u9AD8\u7A0B\u503C\uFF01");return}var nearrestTrack=iD.util.getNearestTracks(loc,tracks);loc[2]=nearrestTrack.node.loc[2]-nearrestTrack.cameraHeight;var cNode;if("undefined"===typeof index){cNode=context.hasEntity(way.nodes[way.nodes.length-(isArea?2:1)])}else{cNode=context.graph().entity(way.nodes[0>index?0:index])}if(cNode&&cNode.loc[0]===loc[0]&&cNode.loc[1]===loc[1])return;var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);var nodeLayerId=nodeLayer.id;var newNode=new iD.Node({loc:loc,layerId:nodeLayerId,modelName:constant.DIVIDER_NODE,tags:iD.util.getDefauteTags(constant.DIVIDER_NODE,nodeLayer)});var cIndex=way.nodes.indexOf(cNode.id),tags=_.clone(cNode.tags);var actions=[iD.actions.AddEntity(newNode),iD.actions.ChangeTags(cNode.id,tags),ReplaceTemporaryNode(newNode),annotation];if(0===cIndex&&2>way.nodes.length)actions.splice(1,1);context.replace.apply(this,actions);finished=true;context.enter(mode);updatePicplayer()};drawWay.addWay=function(loc,edge,originalEntity){drawWay.add(loc);return;var previousEdge=startIndex?[way.nodes[startIndex],way.nodes[startIndex-1]]:[way.nodes[0],way.nodes[1]];if(!isArea&&iD.geo.edgeEqual(edge,previousEdge))return;var parents=_.intersection(context.graph().parentWays(context.entity(edge[0])),context.graph().parentWays(context.entity(edge[1])));if(-1!=parents.indexOf(way)){return}var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);var nodeLayerId=nodeLayer.id;var newNode=iD.Node({loc:loc,layerId:nodeLayerId,modelName:constant.DIVIDER_NODE,tags:iD.util.getDefauteTags(constant.DIVIDER_NODE,nodeLayer)});context.perform(iD.actions.AddEntity(newNode),ReplaceTemporaryNode(newNode),annotation);finished=true;context.enter(mode)};drawWay.addNode=function(node){drawWay.add(node.loc);return;if(way.areAdjacent(node.id,way.nodes[way.nodes.length-1]))return;if(-1!=way.nodes.indexOf(node.id)){return}way["inline"]=1;var actions=[];context.perform(iD.actions.Noop(),t("modes.add_road.description"));var newNode=iD.Node({layerId:node.layerId,loc:node.loc,tags:iD.util.getDefauteTags(constant.DIVIDER_NODE,iD.Layers.getLayer(node.layerId)),modelName:constant.DIVIDER_NODE});actions.push(iD.actions.AddEntity(newNode));actions.push(...[ReplaceTemporaryNode(newNode),annotation]);context.perform.apply(this,actions);finished=true;context.enter(mode)};drawWay.finish=function(){context.pop();finished=true;createWayWithHighwayNode();window.setTimeout(function(){context.map().dblclickEnable(true)},1000);context.map().on("dragend",null);if(context.hasEntity(wayId)){context.enter(iD.modes.Select(context,[wayId]).suppressMenu(true).newFeature(true));if(editLayer.continues){if("area"===mode.button&&editLayer.isRoad()){}else if("area"===mode.button){context.enter(iD.modes.AddArea(context))}else if("line"===mode.button&&editLayer&&!editLayer.isRoad()){context.enter(iD.modes.AddLine(context))}else if("line"===mode.button&&editLayer&&editLayer.isRoad()){var upnode=context.graph().entity(way.nodes[0]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);upnode=context.graph().entity(way.nodes[way.nodes.length-1]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);if(isHighWay){context.replace(iD.actions.AddRoad(way),annotation)}var endNodeId=way.nodes[way.nodes.length-1];var graph=editor.context.graph();var endNode=graph.entity(endNodeId)}}if(isWalkRoad){context.replace(iD.actions.AddWalkRoad(way),annotation)}var newWay=context.entity(wayId);var tNode=context.entity(newWay.last());if(tNode.tags.boundary&&"20"==tNode.tags.boundary&&tNode.tags.realnode&&"0"==tNode.tags.realnode){Dialog.alert("\u76EE\u6807\u70B9\u4E3A\u8DE8\u56FE\u5E45\u8FB9\u6846\u70B9\uFF0C\u4E0D\u80FD\u662F\u771F\u5B9E\u8282\u70B9",function(){context.enter(iD.modes.Browse(context))});updatePicplayer();return}}else{if(isWalkRoad&&1<way.nodes.length){context.replace(iD.actions.AddWalkRoad(way),annotation)}context.enter(iD.modes.Browse(context))}updatePicplayer()};drawWay.cancel=function(){context.perform(d3.functor(baseGraph),t("operations.cancel_draw.annotation"));window.setTimeout(function(){context.map().dblclickEnable(true)},1000);finished=true;context.enter(iD.modes.Browse(context));updatePicplayer()};drawWay.tail=function(text){draw.tail(text);return drawWay};function updatePicplayer(){var way=context.hasEntity(wayId);if(way){var nodes=way.nodes;context.event.entityedite({entitys:[wayId],acceptids:[wayId].concat(nodes)})}else{context.event.entityedite({})}}function checkLineNodeDistanceLTE(loc2,opts={distance:0.2,alert:true}){return false}return drawWay};;;iD.behavior.DrawCutDivider=function(context,wayId,index,mode,baseGraph){var moveData,undoAndContine=false;var keybinding=d3.keybinding("DrawCutDivider");var way=context.entity(wayId),constant=iD.data.DataType,isArea="area"===context.geometry(wayId),finished=false,annotation=t((way.isDegenerate()?"operations.start.annotation.":"operations.continue.annotation.")+context.geometry(wayId)),draw=iD.behavior.Draw(context),editLayer=iD.Layers.getLayer();var startIndex="undefined"===typeof index?way.nodes.length-1:0,_startNodeCurrentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE),start=iD.Node({loc:context.graph().entity(way.nodes[startIndex]).loc,modelName:iD.data.DataType.DIVIDER_NODE,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,_startNodeCurrentLayer),layerId:_startNodeCurrentLayer.id}),end=iD.Node({loc:context.map().mouseCoordinates(),modelName:iD.data.DataType.DIVIDER_NODE,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,_startNodeCurrentLayer),layerId:_startNodeCurrentLayer.id}),segment=iD.Way({nodes:"undefined"===typeof index?[start.id,end.id]:[end.id,start.id],modelName:iD.data.DataType.DIVIDER,layerId:iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER).id,tags:iD.uti.tagExtend.updateTaskTag(way)});var isConnectFakeNode=false;var f=context[way.isDegenerate()?"replace":"perform"];var firstNode=context.graph().entity(way.nodes[0]);var isWalkRoad=firstNode.modelName==constant.WALKENTER;var isHighWay=firstNode.modelName==constant.ROADNODE;isArea=false;f(iD.actions.AddEntity(start),iD.actions.AddEntity(end),iD.actions.AddEntity(segment));if(isWalkRoad){var roadcross=d3.select("g.layer.layer-roadcross");roadcross.classed("no-pointer-events",true);var placename=d3.select("g.layer.layer-placename");placename.classed("no-pointer-events",true)}else if(isHighWay){var walklink=d3.select("g.layer.layer-walk");walklink.classed("no-pointer-events",true)}function move(datum){moveData=datum;var loc,enableLayer=context.layers().getLayer(datum.layerId);if("node"===datum.type&&datum.id!==end.id){loc=datum.loc}else if("way"===datum.type&&datum.id!==segment.id&&enableLayer&&enableLayer.id===datum.layerId&&!datum.isArea()){loc=iD.geo.chooseEdge(context.childNodes(datum),context.mouse(),context.projection).loc}else{loc=context.map().mouseCoordinates()}context.replace(iD.actions.MoveNode(end.id,loc));if(way.inline&&iD.Layers.getLayer(way.layerId).isRoad()&&datum.tags&&datum.modelName==constant.ROADNODE){if(firstNode.modelName==constant.WALKENTER){}else{drawWay.finish();delete way.inline;if(isConnectFakeNode){var nodeID=way.nodes[way.nodes.length-1];datum=context.graph().entity(nodeID)}var graph=context.graph();var fromNode=graph.entity(datum.id);startFromNode(fromNode)}}}function startFromNode(node){var wayLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER).id;var way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.DIVIDER;way.setTags(iD.util.getDefauteTags(way,iD.Layers.getLayer(way.layerId)));if(firstNode.modelName!=constant.WALKENTER){var flag=iD.walkRoadFlag.ROAD}else{var flag=iD.walkRoadFlag.WALKROAD}var args=[iD.util.SplitRoadRule([node.id],context,flag,node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id)];if(node.tags){args.splice(0,1)}context.perform.apply(this,args);context.enter(iD.modes.DrawLine(context,way.id,context.graph(),"","road"))}function undone(){finished=true;context.enter(iD.modes.Browse(context))}function setActiveElements(){var active=isArea?[wayId,end.id]:[segment.id,start.id,end.id];context.surface().selectAll(iD.util.entitySelector(active)).classed("active",true)}function createWayWithHighwayNode(){if(window.fakeNodesArr&&window.fakeNodesArr[0]){var fakeNode=window.fakeNodesArr[0];var nodesArr=way.nodes;nodesArr.forEach(function(nodeID){if(nodeID==fakeNode.id){var newNode=iD.Node({layerId:fakeNode.layerId,loc:fakeNode.loc});context.replace(iD.actions.AddEntity(newNode),annotation);var graph=context.graph();var parentWays=graph.parentWays(fakeNode);parentWays.forEach(function(way){var wayNodesArr=way.nodes;wayNodesArr.forEach(function(wayNode){if(wayNode==fakeNode.id){way=way.replaceNode(nodeID,newNode.id);context.replace(iD.actions.AddEntity(way),annotation)}})});context.replace(iD.actions.DeleteNode(nodeID),annotation);way=context.graph().entity(way.id);if(isHighWay){newNode=iD.util.tagExtend.updateRoadNodeRealNodeTag(context.graph(),newNode);newNode=iD.util.tagExtend.updateNodeMeshTag(newNode,context)}context.replace(iD.actions.AddEntity(newNode),annotation)}});isConnectFakeNode=true}}function cancelWholeWay(){context.replace(iD.actions.AddEntity(way),annotation);var nodes=way.nodes;for(var i=0;i<nodes.length;i++){context.undo()}finished=true;context.enter(iD.modes.AddRoad(context))}var drawWay=function(surface){draw.on("move.draw-cut-divider",move).on("clickNode.draw-cut-divider",drawWay.addNode).on("undo.draw-cut-divider",context.undo).on("cancel.draw-cut-divider",drawWay.cancel).on("finish.draw-cut-divider",drawWay.finish);keybinding.on("Shift+Z",cancelWholeWay);d3.select(document).call(keybinding);context.map().dblclickEnable(false).on("drawn.draw-cut-divider",setActiveElements);setActiveElements();surface.call(draw);context.history().on("undone.draw-cut-divider",undone)};drawWay.off=function(surface){if(!finished&&false==undoAndContine){createWayWithHighwayNode();var upnode=context.graph().entity(way.nodes[0]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);upnode=context.graph().entity(way.nodes[way.nodes.length-1]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);if(isHighWay){context.replace(iD.actions.AddRoad(way),annotation)}else if(isWalkRoad){context.replace(iD.actions.AddWalkRoad(way),annotation)}context.pop()}context.map().on("drawn.draw-cut-divider",null);surface.call(draw.off).selectAll(".active").classed("active",false);context.history().on("undone.draw-cut-divider",null);keybinding.off()};function ReplaceTemporaryNode(newNode){return function(graph){var currLayer=context.layers().getLayer(newNode.layerId);newNode.layerId=iD.Layers.getCurrentModelEnableLayer(newNode.modelName).id;if(isArea){graph=graph.replace(way.addNode(newNode.id,index)).remove(end);return graph}else{var graph=graph.replace(graph.entity(wayId).addNode(newNode.id,index)).remove(end).remove(segment).remove(start);if(currLayer.split){var parents=graph.parentWays(newNode);return graph}else{return graph}}}}drawWay.addNode=function(node){if(way.areAdjacent(node.id,way.nodes[way.nodes.length-1]))return;if(-1!=way.nodes.indexOf(node.id)){return}way["inline"]=1;var actions=[];var newNode=iD.Node({layerId:node.layerId,loc:node.loc,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,iD.Layers.getLayer(node.layerId)),modelName:constant.DIVIDER_NODE});actions.push(iD.actions.AddEntity(newNode));actions.push(...[ReplaceTemporaryNode(newNode),annotation]);context.perform.apply(this,actions);finished=true;checkWayLength(wayId,this)};function checkWayLength(wayId,behavior){var way=context.entity(wayId);if(way.nodes&&2==way.nodes.length){behavior.finish();context.replace(iD.actions.SplitDividingLine([way.id],null,context),t("modes.cut_divider.description"));drawWay.finishSplitLine()}}drawWay.finishSplitLine=function(){};drawWay.finish=function(){finished=true;createWayWithHighwayNode();window.setTimeout(function(){context.map().dblclickEnable(true)},1000);if(context.hasEntity(wayId)){context.enter(iD.modes.Browse(context));if(editLayer.continues){if("area"===mode.button&&editLayer.isRoad()){}else if("area"===mode.button){context.enter(iD.modes.AddArea(context))}else if("line"===mode.button&&editLayer&&!editLayer.isRoad()){context.enter(iD.modes.AddLine(context))}else if("line"===mode.button&&editLayer&&editLayer.isRoad()){var upnode=context.graph().entity(way.nodes[0]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);upnode=context.graph().entity(way.nodes[way.nodes.length-1]);upnode=iD.util.tagExtend.updateNodeMeshTag(upnode,context);context.replace(iD.actions.AddEntity(upnode),annotation);if(isHighWay){context.replace(iD.actions.AddRoad(way),annotation)}var endNodeId=way.nodes[way.nodes.length-1];var graph=editor.context.graph();var endNode=graph.entity(endNodeId)}}if(isWalkRoad){context.replace(iD.actions.AddWalkRoad(way),annotation)}var newWay=context.entity(wayId);var tNode=context.entity(newWay.last());if(tNode.tags.boundary&&"20"==tNode.tags.boundary&&tNode.tags.realnode&&"0"==tNode.tags.realnode){Dialog.alert("\u76EE\u6807\u70B9\u4E3A\u8DE8\u56FE\u5E45\u8FB9\u6846\u70B9\uFF0C\u4E0D\u80FD\u662F\u771F\u5B9E\u8282\u70B9",function(){context.enter(iD.modes.Browse(context))});return}}else{if(isWalkRoad&&1<way.nodes.length){context.replace(iD.actions.AddWalkRoad(way),annotation)}context.enter(iD.modes.Browse(context))}};drawWay.cancel=function(){context.perform(d3.functor(baseGraph),t("operations.cancel_draw.annotation"));window.setTimeout(function(){context.map().dblclickEnable(true)},1000);finished=true;context.enter(iD.modes.Browse(context))};drawWay.tail=function(text){draw.tail(text);return drawWay};return drawWay};;;iD.behavior.Edit=function(context){function edit(){context.map().minzoom(16)}edit.off=function(){context.map().minzoom(0)};return edit};;;iD.behavior.Hover=function(){var dispatch=d3.dispatch("hover"),selection,altDisables,target,context;if(arguments&&arguments.length&&arguments[0]){var context=arguments[0]}function keydown(){if(altDisables&&d3.event.keyCode===d3.keybinding.modifierCodes.alt){dispatch.hover(null);selection.selectAll(".hover").classed("hover-suppressed",true).classed("hover",false)}}function keyup(){if(altDisables&&d3.event.keyCode===d3.keybinding.modifierCodes.alt){dispatch.hover(target?target.id:null);selection.selectAll(".hover-suppressed").classed("hover-suppressed",false).classed("hover",true)}}function displayOverlays(id,display){context.map().getOverlays(id).forEach(function(overlay){if(display){overlay.display=false}else{overlay.display=true}});context.map().drawOverlayers()}var hover=function(__){selection=__;var hotmarker={};var lastTile="";function filter(target){if(context){context.hover_callback&&context.hover_callback.call(this,target,context.mouse())}var lightOverlays=context.lightOverlays();if(target instanceof iD.Polyline||target instanceof iD.Polygon||target instanceof iD.Marker||target instanceof iD.Circle||target instanceof iD.TransPolygon){dispatch.hover(null);var org=""!=lightOverlays?lightOverlays+", ":"";var selector=org+"."+target.id;var suppressed=altDisables&&d3.event&&d3.event.altKey;selection.selectAll(selector).classed(suppressed?"hover-suppressed":"hover",true);return true}else if(lightOverlays){hover.overlays()}return false}function enter(d){if(d===target)return;target=d;selection.selectAll(".hover").classed("hover",false);selection.selectAll(".hover-suppressed").classed("hover-suppressed",false);if(filter(target))return;if(target instanceof iD.Entity){if(target instanceof iD.Transportation)return;var selector="."+target.id;if("relation"===target.type){target.members.forEach(function(member){selector+=", ."+member.id})}var suppressed=altDisables&&d3.event&&d3.event.altKey;selection.selectAll(selector).classed(suppressed?"hover-suppressed":"hover",true);dispatch.hover(target.id)}else{dispatch.hover(null)}}var down;function mouseover(){if(down)return;var target=d3.event.target;enter(target?target.__data__:null)}function mousemove(e){if(context){var layer=context.layers().getLayer();if(!layer){return}layer.lastIds=[];var hot=layer.hotspots[e.tile.join("_")];if(!hot){hotmarker.visible=false;displayOverlays("editorhotspot",false);return false}var name="";if(!context.background().getOverlayLayers(layer.id+"HotspoLayer")){return}var tilexy=context.background().getOverlayLayers(layer.id+"HotspoLayer").getTilexy(e.tile);var xy=[Math.abs(e.layerX-tilexy[0]),Math.abs(e.layerY-tilexy[1])];for(var i in hot){if(isInclusion(xy,hot[i],layer)){layer.lastIds.push(i);lastTile=e.tile.join("_")}else if(lastTile!=e.tile.join("_")){if(context.map().getOverlays("editorhotspot")[0].visible){hotmarker.visible=false;displayOverlays("editorhotspot",false)}layer.lastIds=[];lastTile=""}}if(layer.lastIds.length){layer.lastIds.forEach(function(obj){if(hot[obj].name!=undefined){name=name+hot[obj].name+"\u3001"}else{name=name+obj+"\u3001"}});name=name.slice(0,-1);var xy=context.map().mouse();hotmarker.loc=context.map().invert([xy[0]+5,xy[1]-5]);hotmarker.label=name;hotmarker.visible=true;displayOverlays("editorhotspot",true);context.map().updateOverlays([hotmarker])}if(!layer.lastIds.length){if(context.map().getOverlays("editorhotspot")[0].visible){displayOverlays("editorhotspot",false)}}}}function isInclusion(xy,obj,layer){var inclusion=false;if("point"==layer.hotspotType){return xy[0]>obj.coordinates[0][0]&&xy[0]<obj.coordinates[2][0]&&xy[1]>obj.coordinates[1][1]&&xy[1]<obj.coordinates[3][1]}else if("line"==layer.hotspotType){if(iD.util.pt2LineDist(obj.coordinates,xy).dis<obj.d){return iD.util.pt2LineDist(obj.coordinates,xy)}}else if("poly"==layer.hotspotType){return iD.geo.pointInPolygon(xy,obj.coordinates)}return inclusion}function creatmarker(xy,label){var marker=new Icon({id:"editorhotspot",loc:xy,url:"",width:23,height:35,label:label,visible:true,offset:[10,-10],"font-style":{"font-size":15,"font-weight":"bold","font-family":"\u5FAE\u8F6F\u96C5\u9ED1",fill:"#333"},"rect-style":{fill:"#fff",opacity:0.5,stroke:"#267124","stroke-width":2}});return marker}function mouseout(){if(down)return;var target=d3.event.relatedTarget;enter(target?target.__data__:null)}function mousedown(){down=true;d3.select(window).on("mouseup.hover",mouseup)}function mouseup(){down=false}selection.on("mouseover.hover",mouseover).on("mouseout.hover",mouseout).on("mousedown.hover",mousedown).on("mouseup.hover",mouseup);if(context&&context.layers().getLayer()&&context.layers().getLayer().isHotspot()){hotmarker=creatmarker([116.28,39.94],"");hotmarker.visible=false;context.map().addOverlays(hotmarker);hotmarker=context.map().getOverlays("editorhotspot")[0];context.event.on("mousemove.hover",mousemove)}else{displayOverlays("editorhotspot",false)}d3.select(window).on("keydown.hover",keydown).on("keyup.hover",keyup)};hover.overlays=function(){var selector=context.lightOverlays();if(selector){var suppressed=altDisables&&d3.event&&d3.event.altKey;selection.selectAll(selector).classed(suppressed?"hover-suppressed":"hover",true)}};hover.off=function(selection){selection.selectAll(".hover").classed("hover",false);selection.selectAll(".hover-suppressed").classed("hover-suppressed",false);hover.overlays();selection.on("mouseover.hover",null).on("mouseout.hover",null).on("mousedown.hover",null).on("mouseup.hover",null);if(context&&context.layers().getLayer()){context.event.on("mousemove.hover",null)}else{displayOverlays("editorhotspot",false)}d3.select(window).on("keydown.hover",null).on("keyup.hover",null).on("mouseup.hover",null)};hover.altDisables=function(_){if(!arguments.length)return altDisables;altDisables=_;return hover};return d3.rebind(hover,dispatch,"on")};;;iD.behavior.Lasso=function(context){var mode=arguments[1];var filter=arguments[2]||iD.util.empty;var _shiftKey=false,_ctrlKey=false;var behavior=function(selection){var mouse=null,lasso;function mousedown(){_shiftKey=true===d3.event.shiftKey;_ctrlKey=true===d3.event.ctrlKey;if(_shiftKey||_ctrlKey||mode){mouse=context.mouse();selection.on("mousemove.lasso",mousemove).on("mouseup.lasso",mouseup);d3.event.stopPropagation();d3.event.preventDefault()}}function mousemove(){if(!lasso){lasso=iD.ui.Lasso(context).a(mouse);context.surface().call(lasso)}lasso.b(context.mouse())}function normalize(a,b){return[[Math.min(a[0],b[0]),Math.min(a[1],b[1])],[Math.max(a[0],b[0]),Math.max(a[1],b[1])]]}function mouseup(){selection.on("mousemove.lasso",null).on("mouseup.lasso",null);if(!lasso)return;d3.event._isLasso=true;function execLassoInstance(selected){context.event.dragbox({bounds:extent,entity:selected});context.lasso_callback&&context.lasso_callback.call(this,extent,selected)}var extent=iD.geo.Extent(normalize(context.projection.invert(lasso.a()),context.projection.invert(lasso.b())));var polygon=extent.polygon();lasso.close();d3.event._lassoCenter=extent.center();var selected=context.intersects(extent).filter(function(entity){function insectTrans(datum){if(datum){if(datum instanceof iD.Way){return iD.util.wayInPlyGonx(datum,context)}else if(datum instanceof iD.Node){return iD.util.nodeInPlyGonx(datum,context)}}return false}var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||modelConfig&&!modelConfig.editable){return false}var r=false;if(_shiftKey&&iD.Task.d){var layer=iD.Layers.getLayer(entity.layerId);if(!layer){return false}if(!layer.isPoint()&&entity instanceof iD.Node){r=false}if(entity instanceof iD.Way){r=filter(entity)&&insectTrans(entity)&&true}}if(_ctrlKey&&iD.Task.d){if(!iD.Layers.getLayer(entity.layerId)){return false}var role=d3.select("body").attr("role");if("check"==role){if(entity instanceof iD.Node&&"undefined"!=typeof entity.tags&&"undefined"!=typeof entity.modelName&&0<=["QC_TAG"].indexOf(entity.modelName)&&iD.Static.layersInfo.isDisplay(entity.modelName)){r=filter(entity)&&insectTrans(entity)&&true}}else{if(entity instanceof iD.Node&&"undefined"!=typeof entity.tags&&"undefined"!=typeof entity.modelName&&0<=[iD.data.DataType.ROAD_NODE,iD.data.DataType.DIVIDER_NODE,iD.data.Constant.C_NODE,iD.data.DataType.OBJECT_PT,iD.data.DataType.LAMPPOST,iD.data.DataType.LIMITHEIGHT,iD.data.DataType.TRAFFICLIGHT,iD.data.DataType.ROAD_ATTRIBUTE,iD.data.DataType.CHECK_TAG,iD.data.DataType.IMAGE_TAG,iD.data.DataType.ANALYSIS_TAG,iD.data.DataType.QUESTION_TAG].indexOf(entity.modelName)&&iD.Static.layersInfo.isDisplay(entity.modelName)){r=filter(entity)&&insectTrans(entity)&&true}}}return r});var currentSelIds=_.clone(context.selectedIDs()),isReverseSel=false;d3.event._lassoReverseSel=isReverseSel;if(selected.length){if(_shiftKey&&selected[0]instanceof iD.Way){var lassExtend=iD.util.lassExtend;var innerAreaWays=[];for(var i=0;i<selected.length;i++){var currWay=selected[i];if("node"===currWay.type){var nflag=isReverseSel||lassExtend.isPointInRect({lon:currWay.loc[0],lat:currWay.loc[1]},extent);if(nflag){innerAreaWays.push(currWay)};continue}if(currWay instanceof iD.Way){var locs=_.pluck(context.graph().childNodes(currWay),"loc");if(iD.geo.polygonIntersectsPolygon(polygon,locs,true)){innerAreaWays.push(currWay)}}}if(0<innerAreaWays.length){var innerAreaWayIds=_.pluck(innerAreaWays,"id");var allSelectId=_.uniq(currentSelIds.concat(innerAreaWayIds));_.forEach(innerAreaWayIds,function(wayid){if(0<=currentSelIds.indexOf(wayid)){allSelectId.splice(allSelectId.indexOf(wayid),1)}})}innerAreaWays.length&&allSelectId.length&&context.enter(iD.modes.Select(context,allSelectId));var selectMultiIDs=_.pluck(innerAreaWays,"id");d3.select("#KDSEditor-sidebar").attr("data-multiselectIDs",selectMultiIDs);execLassoInstance(innerAreaWays)}if(_ctrlKey&&selected[0]instanceof iD.Node){var lassExtend=iD.util.lassExtend;var innerAreaNodes=[];for(var i=0;i<selected.length;i++){var currNode=selected[i];innerAreaNodes.push(currNode)}var allSelectId=_.uniq(currentSelIds.concat(_.pluck(innerAreaNodes,"id")));_.forEach(innerAreaNodes,function(n){if(0<=currentSelIds.indexOf(n.id)){allSelectId.splice(allSelectId.indexOf(n.id),1)}});innerAreaNodes.length&&context.enter(iD.modes.Select(context,allSelectId));execLassoInstance(innerAreaNodes)}}if(!selected.length){context.enter(iD.modes.Browse(context));execLassoInstance(selected)}lasso=null}selection.on("mousedown.lasso",mousedown);_shiftKey=false;_ctrlKey=false};behavior.off=function(selection){selection.on("mousedown.lasso",null)};return behavior};;;iD.behavior.Select=function(context){function keydown(){if(d3.event&&d3.event.altKey){context.variable.altKeyDown=true;context.surface().classed("alt-mousedown",true)}if(d3.event&&d3.event.shiftKey){context.surface().classed("behavior-multiselect",true)}}function keyup(){if(context.variable.altKeyDown){context.variable.altKeyDown=false;context.surface().classed("alt-mousedown",false)}if(!d3.event||!d3.event.shiftKey){context.surface().classed("behavior-multiselect",false)}}function click(){var datum=d3.event.target.__data__;iD.select=d3.event.target;if(datum&&window.debug){iD.topo.check().mainCheck(context.graph(),datum)}if(!d3.event.shiftKey&&(!datum||!("way"==datum.type)||datum.tags&&datum.modelName!=iD.data.DataType.HIGHWAY)){d3.select("#geoRoadInfo").remove()}if("undefined"==typeof datum||"undefined"==typeof datum.tags||"QC_TAG"!==datum.modelName){var trigger=d3.select(".nav .item-element");if(!trigger.empty()&&trigger.classed("show")){trigger.node().click()}}extendDeal(datum);if(!("undefined"!=typeof datum&&"undefined"!=typeof datum.tags&&"QC_TAG"==datum.modelName)){if(filter(datum)||!insectTrans(datum)){if(!(d3.event.shiftKey||d3.event.ctrlKey)){context.enter(iD.modes.Browse(context))}if(0<d3.select("#surface .radial-menu").size()){d3.select("#surface .radial-menu").remove()}return}}var lasso=d3.select("#surface .lasso").node();if(!(datum instanceof iD.Entity)){if(!d3.event.shiftKey&&!lasso)context.enter(iD.modes.Browse(context))}else if(!d3.event.ctrlKey&&!d3.event.shiftKey&&!lasso){d3.event._clickselect=true;if(1!==context.selectedIDs().length||context.selectedIDs()[0]!==datum.id){context.enter(iD.modes.Select(context,[datum.id]))}else{context.mode().reselect()}}else if(0<=context.selectedIDs().indexOf(datum.id)){var selectedIDs=_.without(context.selectedIDs(),datum.id);context.enter(selectedIDs.length?iD.modes.Select(context,selectedIDs):iD.modes.Browse(context))}else{filterShift(datum)}}function filterShift(datum){var datumGeo,sItem,sItemGeo,sIDs=context.selectedIDs(),sID=context.selectedID,layer;if(sIDs[0]){sItem=context.entity(sIDs[0]);layer=context.layers().getLayer(sItem.layerId)}if(d3.event.shiftKey&&sItem instanceof iD.Way){if(null===sIDs||0>sIDs.length){context.enter(iD.modes.Select(context,[datum.id]))}else{if(!sIDs[0])return;if(context.geometry(sItem.id)===context.geometry(datum.id)){if(0<sIDs.indexOf(datum.id)){sIDs=_.without(sIDs,datum.id);context.enter(sIDs.length?iD.modes.Select(context,sIDs):iD.modes.Browse(context))}else{sIDs.push(datum.id);context.enter(iD.modes.Select(context,sIDs))}}}}else{if(sID){var arr=[sID,datum.id];datumGeo=context.geometry(datum.id),sItemGeo=context.geometry(sItem.id);context.selectedID=undefined;if("vertex"===datumGeo||"point"===datumGeo){if("vertex"===sItemGeo||"point"===sItemGeo){arr.push(datum.id);context.enter(iD.modes.Select(context,sIDs.concat(arr)))}}return}if(!sIDs||0===sIDs.length){context.enter(iD.modes.Select(context,[datum.id]))}else{sItem=context.entity(sIDs[0]);if(d3.event.ctrlKey&&context.geometry(sItem.id)==context.geometry(datum.id)){if(0<sIDs.indexOf(datum.id)){sIDs=_.without(sIDs,datum.id);context.entity(sIDs.length?iD.modes.Select(context,sIDs):iD.modes.Browse(context))}else{datumGeo=context.geometry(datum.id);sItem=context.entity(sIDs[0]),sItemGeo=context.geometry(sItem.id);if("vertex"===datumGeo||"point"===datumGeo){if("vertex"===sItemGeo||"point"===sItemGeo){sIDs.push(datum.id);context.enter(iD.modes.Select(context,sIDs))}}else{if("line"===datumGeo&&"line"===sItemGeo){if(!sItem._type||!context.isOneRoadCrossWay(sItem)){sIDs.push(datum.id);context.enter(iD.modes.Select(context,sIDs))}}else if("line"===datumGeo&&"point"===sItemGeo){if(sItem.isSpeedcamera&&sItem.isSpeedcamera()){sIDs.push(datum.id);3<=sIDs.length&&sIDs.splice(1,1);context.enter(iD.modes.Select(context,sIDs))}else if(sItem.isRoadZLevel&&sItem.isRoadZLevel()){sIDs.push(datum.id);4<=sIDs.length&&sIDs.splice(1,1);context.enter(iD.modes.Select(context,sIDs))}else if(sItem.isPlaceName&&sItem.isPlaceName()){sIDs.push(datum.id);4<=sIDs.length&&sIDs.splice(1,1);context.enter(iD.modes.Select(context,sIDs))}else if(sItem.isQcTag&&sItem.isQcTag()){sIDs.push(datum.id);4<=sIDs.length&&sIDs.splice(1,1);context.enter(iD.modes.Select(context,sIDs))}}}}}}}}function filter(datum){if(datum instanceof iD.Entity){if(datum.g()&&datum.g().g()){if(datum.remove&&datum.parent){context.map().removeOverlays(datum.parent);context.event.drawoverlayers()}datum.editable&&context.enter(iD.modes.NewSelect(context,context.selectedIDs(),datum));return true}}if(!(datum instanceof iD.Entity)||datum instanceof iD.Transportation){if(datum instanceof iD.Transportation){context.enter(iD.modes.Select(context,context.selectedIDs(),datum));return true}}if(datum instanceof iD.Way&&datum.isOneRoadCrossWay()){return true}return false}function insectTrans(datum){return true;if(datum){if(datum instanceof iD.Way){return iD.util.wayInPlyGonx(datum,context)}else if(datum instanceof iD.Node){return iD.util.nodeInPlyGonx(datum,context)}}return false}function showQcDesc(datum){}function extendDeal(datum){console.log(datum);if(!datum){context.event.selected([])}showQcDesc(datum);context.click_callback&&context.click_callback.call(this,datum,context.mouse());return;context.click_callback&&context.click_callback.call(this,datum,context.mouse());var layer=context.layers().getLayer();if(layer&&layer.isHotspot()&&layer.lastIds.length){context.hotspot_click_callback&&context.hotspot_click_callback.call(this,{id:layer.lastIds})}}var behavior=function(selection){d3.select(window).on("keydown.select",keydown).on("keyup.select",keyup);var lastMousePos,lastMouseTarget,clickTimeId;selection.on("mousedown.select",function(d){lastMousePos=[d3.event.clientX,d3.event.clientY];lastMouseTarget=d3.event.target}).on("mouseup.select",function(d){if(!d3.select(d3.event.target).datum()){return}var upPos=[d3.event.clientX,d3.event.clientY];if(d3.event.target===lastMouseTarget&&5>iD.geo.euclideanDistance(lastMousePos,upPos)){var targetEvent=d3.event;if(clickTimeId){clearTimeout(clickTimeId)}clickTimeId=setTimeout(function(){clickTimeId=null;var oldEvent=d3.event;d3.event=targetEvent;click();d3.event=oldEvent;targetEvent=null},250)}}).on("click.select",function(){if(clickTimeId){clearTimeout(clickTimeId);clickTimeId=null}var upPos=[d3.event.clientX,d3.event.clientY];if(lastMousePos&&5>iD.geo.euclideanDistance(lastMousePos,upPos)){click()}lastMousePos=null;lastMouseTarget=null});keydown()};behavior.off=function(selection){d3.select(window).on("keydown.select",null).on("keyup.select",null);selection.on("click.select",null);selection.on("mouseup.select",null);selection.on("mousedown.select",null);keyup()};return behavior};;;iD.behavior.Tail=function(){var text,container,xmargin=25,tooltipSize=[0,0],selectionSize=[0,0];function tail(selection){if(!text)return;d3.select(window).on("resize.tail",function(){selectionSize=selection.dimensions()});function show(){container.style("display","block");tooltipSize=container.dimensions()}function mousemove(){if("none"===container.style("display"))show();var xoffset=d3.event.clientX+tooltipSize[0]+xmargin>selectionSize[0]?-tooltipSize[0]-xmargin:xmargin;container.classed("left",0<xoffset);iD.util.setTransform(container,d3.event.clientX+xoffset,d3.event.clientY)}function mouseleave(){if(d3.event.relatedTarget!==container.node()){container.style("display","none")}}function mouseenter(){if(d3.event.relatedTarget!==container.node()){show()}}container=d3.select(document.body).append("div").style("display","none").attr("class","tail tooltip-inner");container.append("div").text(text);selection.on("mousemove.tail",mousemove).on("mouseenter.tail",mouseenter).on("mouseleave.tail",mouseleave);container.on("mousemove.tail",mousemove);tooltipSize=container.dimensions();selectionSize=selection.dimensions()}tail.off=function(selection){if(!text)return;container.on("mousemove.tail",null).remove();selection.on("mousemove.tail",null).on("mouseenter.tail",null).on("mouseleave.tail",null);d3.select(window).on("resize.tail",null)};tail.text=function(_){if(!arguments.length)return text;text=_;return tail};return tail};;;iD.behavior.drawIsland=function(context){var startNodeLoc,endNodeLoc;var keybinding=d3.keybinding("drawIsland");var action=iD.actions.createIsland(context);var annotation=t("modes.add_island.description");var highLightIds,circle;var behavior=function(selection){var mouse=null,mode="circle",style={fill:"red",opacity:"0.5",stroke:"rgb(255, 99, 25)","stroke-width":3};function mousemove(){selection.on("click.circle",null);if(!circle){var loc=context.map().mouseCoordinates();circle=new Circle({loc:loc,radius:loc,mode:"circle",onDraw:function(element){element.style(style)}});context.map().addOverlays(circle);context.event.drawstart({overlay:circle,mode:mode})}if(circle)circle.radius=context.map().mouseCoordinates();context.event.drawoverlayers();context.event.drawing({overlay:circle,mode:mode})}function cancel(){d3.event.preventDefault();selection.on("mousemove.circle",null);if(circle){context.map().removeOverlays(circle)}context.enter(iD.modes.Browse(context))}function dblclick(){selection.on("mousemove.circle",null).on("mouseup.circle",null).on("click.circle",null);context.map().dblclickEnable(false);endNodeLoc=context.map().mouseCoordinates();var isOutTansactionExtent=false;var nodes=action.getNodesLoc(startNodeLoc,endNodeLoc);for(var i=0;i<nodes.length;i++){if(iD.util.pointNotInPlyGonx(nodes[i],context)){isOutTansactionExtent=true;break}}if(true==isOutTansactionExtent){Dialog.alert("\u5DF2\u51FA\u5BF9\u8C61\u8FB9\u754C",callback)}else if(false==isOutTansactionExtent){context.map().removeOverlays(circle);action.setStartNodeLoc(startNodeLoc);action.setEndNodeLoc(endNodeLoc);context.perform(action,annotation);highLightIds=action.getHighlightIds();context.enter(iD.modes.Select(context,[highLightIds[0]]).suppressMenu(true).newFeature(true));if("undefined"!=typeof highLightIds&&""!=highLightIds){context.map().on("drawn.select",selectElements);selectElements()}}}var callback=function(){context.map().removeOverlays(circle);context.enter(iD.modes.Browse(context));context.enter(iD.modes.AddIsland(context))};function selectElements(){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",true)}function start(){var sf=context.surface();sf.on("dblclick.select",null).selectAll(".selected").classed("selected",false);context.map().on("drawn.select",null);circle=null;mouse=context.mouse();startNodeLoc=context.map().mouseCoordinates();selection.on("dblclick.circle",dblclick).on("mousemove.circle",mousemove);d3.event.stopPropagation();d3.event.preventDefault()}selection.on("click.circle",start);keybinding.on("\u238B",cancel);d3.select(document).call(keybinding)};behavior.off=function(selection){if(circle){context.map().removeOverlays(circle)}selection.on("mousemove.circle",null).on("click.circle",null).on("dblclick.circle",null)};return behavior};;;iD.behavior.DrawPlacename=function(context){var event=d3.dispatch("move","click","clickWay","clickNode","undo","cancel","finish"),keybinding=d3.keybinding("draw"),hover=iD.behavior.Hover(context).altDisables(true).on("hover",context.ui().sidebar.hover),tail=iD.behavior.Tail(),edit=iD.behavior.Edit(context),closeTolerance=0,tolerance=1;function datum(){if(d3.event.altKey)return{};else return d3.event.target.__data__||{}}function mousedown(){function point(){var p=element.node().parentNode;return null!==touchId?d3.touches(p).filter(function(p){return p.identifier===touchId})[0]:d3.mouse(p)}var element=d3.select(this),touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null,time=+new Date,pos=point();element.on("mousemove.draw",null);d3.select(window).on("mouseup.draw",function(){element.on("mousemove.draw",mousemove);if(iD.geo.euclideanDistance(pos,point())<closeTolerance||iD.geo.euclideanDistance(pos,point())<tolerance&&500>+new Date-time){d3.select(window).on("click.draw-block",function(){d3.event.stopPropagation()},true);context.map().dblclickEnable(false);window.setTimeout(function(){context.map().dblclickEnable(true);d3.select(window).on("click.draw-block",null)},500);click()}})}function mousemove(){event.move(datum())}function click(){var d=datum(),modelConfig=iD.Layers.getLayer(d.layerId,d.modelName),isEnable=modelConfig?modelConfig.editable:"";if("way"===d.type&&isEnable){var choice=iD.geo.chooseEdge(context.childNodes(d),context.mouse(),context.projection),edge=[d.nodes[choice.index-1],d.nodes[choice.index]];event.clickWay(choice.loc,d,edge)}else{event.click(context.map().mouseCoordinates())}}function backspace(){d3.event.preventDefault();event.undo()}function del(){d3.event.preventDefault();event.cancel()}function ret(){d3.event.preventDefault();event.finish()}function draw(selection){context.install(hover);context.install(edit);if(!iD.behavior.Draw.usedTails[tail.text()]){context.install(tail)}keybinding.on("\u232B",backspace).on("\u2326",del).on("\u238B",ret).on("\u21A9",ret);selection.on("mousedown.draw",mousedown).on("mousemove.draw",mousemove);d3.select(document).call(keybinding);return draw}draw.off=function(selection){context.uninstall(hover);context.uninstall(edit);if(!iD.behavior.Draw.usedTails[tail.text()]){context.uninstall(tail);iD.behavior.Draw.usedTails[tail.text()]=true}selection.on("mousedown.draw",null).on("mousemove.draw",null);d3.select(window).on("mouseup.draw",null);d3.select(document).call(keybinding.off);context.map().on("dragend",null)};draw.tail=function(_){tail.text(_);return draw};return d3.rebind(draw,event,"on")};iD.behavior.Draw.usedTails={};;;iD.behavior.DrawRoadAttribute=function(context){var event=d3.dispatch("move","click","clickWay","clickNode","undo","cancel","finish"),keybinding=d3.keybinding("draw"),hover=iD.behavior.Hover(context).altDisables(true).on("hover",context.ui().sidebar.hover),tail=iD.behavior.Tail(),edit=iD.behavior.Edit(context),closeTolerance=0,tolerance=1;function datum(){if(d3.event.altKey)return{};else return d3.event.target.__data__||{}}function mousedown(){function point(){var p=element.node().parentNode;return null!==touchId?d3.touches(p).filter(function(p){return p.identifier===touchId})[0]:d3.mouse(p)}var element=d3.select(this),touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null,time=+new Date,pos=point();element.on("mousemove.draw",null);d3.select(window).on("mouseup.draw",function(){element.on("mousemove.draw",mousemove);if(iD.geo.euclideanDistance(pos,point())<closeTolerance||iD.geo.euclideanDistance(pos,point())<tolerance&&500>+new Date-time){d3.select(window).on("click.draw-block",function(){d3.event.stopPropagation()},true);context.map().dblclickEnable(false);window.setTimeout(function(){context.map().dblclickEnable(true);d3.select(window).on("click.draw-block",null)},500);click()}})}function mousemove(){event.move(datum())}function click(){var d=datum(),modelConfig=iD.Layers.getLayer(d.layerId,d.modelName),isEnable=modelConfig?modelConfig.editable:"";if(d.modelName!=iD.data.DataType.ROAD){Dialog.alert("\u5FC5\u987B\u70B9\u51FB\u5728\u9053\u8DEF\u4E0A");return}if("way"===d.type&&isEnable){var choice=iD.geo.chooseEdge(context.childNodes(d),context.mouse(),context.projection),edge=[d.nodes[choice.index-1],d.nodes[choice.index]];event.clickWay(choice.loc,d,edge)}else{event.click(context.map().mouseCoordinates())}}function backspace(){d3.event.preventDefault();event.undo()}function del(){d3.event.preventDefault();event.cancel()}function ret(){d3.event.preventDefault();event.finish()}function draw(selection){context.install(hover);context.install(edit);if(!iD.behavior.Draw.usedTails[tail.text()]){context.install(tail)}keybinding.on("\u232B",backspace).on("\u2326",del).on("\u238B",ret).on("\u21A9",ret);selection.on("mousedown.draw",mousedown).on("mousemove.draw",mousemove);d3.select(document).call(keybinding);return draw}draw.off=function(selection){context.uninstall(hover);context.uninstall(edit);if(!iD.behavior.Draw.usedTails[tail.text()]){context.uninstall(tail);iD.behavior.Draw.usedTails[tail.text()]=true}selection.on("mousedown.draw",null).on("mousemove.draw",null);d3.select(window).on("mouseup.draw",null);d3.select(document).call(keybinding.off)};draw.tail=function(_){tail.text(_);return draw};return d3.rebind(draw,event,"on")};iD.behavior.Draw.usedTails={};;;iD.behavior.LassoZoom=function(context){var type=arguments[1];var behavior=function(selection){var mouse=null,lasso;function mousedown(){mouse=context.mouse();lasso=null;selection.on("mousemove.lasso",mousemove).on("mouseup.lasso",mouseup).on("mousedown.lasso",mouseup);d3.event.stopPropagation();d3.event.preventDefault()}function mousemove(){if(!lasso){lasso=iD.ui.Lasso(context).a(mouse);context.surface().call(lasso)}lasso.b(context.mouse())}function normalize(a,b){return[[Math.min(a[0],b[0]),Math.min(a[1],b[1])],[Math.max(a[0],b[0]),Math.max(a[1],b[1])]]}function mouseup(){selection.on("mousemove.lasso",null).on("mouseup.lasso",null);if(context.mouse().join(",")==mouse.join(",")){context.enter(iD.modes.Browse(context));return}if(!lasso)return;var extent=iD.geo.Extent(normalize(context.projection.invert(lasso.a()),context.projection.invert(lasso.b())));lasso.close();if(type){var size=context.map().dimensions();var dx=lasso.b()[0]-lasso.a()[0],dy=lasso.b()[1]-lasso.a()[1];var ratio=Math.min(size[0]/Math.abs(dx),size[1]/Math.abs(dy));ratio=Math.floor(ratio);var targetZoomLv=Math.round(context.map().zoom()+Math.log(1/ratio)/Math.log(2));context.map().centerZoom(extent.center(),targetZoomLv)}else{context.map().centerZoom(extent.center(),context.map().extentZoom(extent))}context.enter(iD.modes.Browse(context))}selection.on("mousedown.lasso",mousedown)};behavior.off=function(selection){selection.on("mousedown.lasso",null)};return behavior};;;iD.behavior.RoadCrossModify=function(context,selectedIDs){var perform=false;function keydown(){if(d3.event&&d3.event.shiftKey){context.surface().classed("behavior-multiselect",true)}}function keyup(){if(!d3.event||!d3.event.shiftKey){context.surface().classed("behavior-multiselect",false)}}function roadCrossLine(datum){var layers=iD.Layers,layer=layers.getCurrentModelEnableLayer(iD.data.DataType.C_NODE);if(layer&&layer.isRoad()){var entity=context.graph().entity(selectedIDs[0]);if(context.isRoadCross(entity)){selectedIDs.push(datum.id);var action=iD.actions.RoadCrossModify(selectedIDs);action.setEditProcess(true);context.replace(action,t("operations.road_cross_edit.description"))}}}function roadCrossRelation(id){var graph=context.graph();var entity=graph.hasEntity(id);if(!entity)return;var rels=graph.parentRelations(entity,iD.data.DataType.R_C_NODE_ROAD_NODE);return rels[0]}function isUnicomInnerMembers(datum,roadCrossID,context){var rel=roadCrossRelation(roadCrossID);var members=rel&&rel.members||[];var nodesArr=[];members.forEach(function(member){nodesArr.push(member.id)});if(-1==nodesArr.indexOf(datum.id)){for(var j=0;j<nodesArr.length;j++){if(iD.util.roadCrossExtend.isUnicomBetweenTwoNodes(datum,context.graph().entity(nodesArr[j]),context)){return true}}}else{var index=nodesArr.indexOf(datum.id);nodesArr.splice(index,1);return iD.util.roadCrossExtend.isUnicomOfArr(nodesArr,context)}return false}function click(){var datum=d3.event.target.__data__;var roadCrossId=selectedIDs[0];if(datum&&datum.tags){if(datum.modelName==iD.data.DataType.ROAD_NODE){var flag=false;var ways=[];context.graph().parentWays(datum).forEach(function(d){if(!d.isOneRoadCrossWay()){return ways.push(d)}});if(2>ways.length){Dialog.alert("\u60AC\u6302\u70B9\u4E0D\u80FD\u7EFC\u5408\u6210\u7EFC\u5408\u4EA4\u53C9\u70B9");return}var isInCrossFlag=false;var rel=roadCrossRelation(datum);if(rel&&!_.pluck(rel.members,"id").includes(roadCrossId)){flag=true}if(flag){Dialog.alert("\u9009\u62E9\u7684\u8282\u70B9\u4E2D\u5DF2\u7ECF\u88AB\u5176\u5B83\u7EFC\u5408\u4EA4\u53C9\u70B9\u7EFC\u5408,\u8BF7\u9009\u62E9\u5176\u5B83\u8282\u70B9");return}isInCrossFlag=rel&&_.pluck(rel.members,"id").includes(datum.id);if(rel&&!isInCrossFlag){if(7<rel.members.length){Dialog.alert("\u7EFC\u5408\u4EA4\u53C9\u70B9\u6700\u591A\u53EA\u80FD\u7EFC\u54088\u4E2A\u8282\u70B9");return}var nodesIdArr=[];rel.members.forEach(function(member){nodesIdArr.push(member.id)});nodesIdArr.push(datum.id);if(15<iD.util.roadCrossExtend.getNodesOutWayNum(nodesIdArr,context.graph())){Dialog.alert("\u7EFC\u5408\u4EA4\u53C9\u70B9\u6700\u591A\u53EA\u80FD\u5173\u805415\u6761\u8DEF");return}}if(0<selectedIDs.length&&!isUnicomInnerMembers(datum,roadCrossId,context)){Dialog.alert("\u88AB\u7EFC\u5408\u7684\u7ED3\u70B9\u95F4\u9053\u8DEF\u4E0D\u8FDE\u901A\uFF0C\u4E0D\u80FD\u6267\u884C\u8BE5\u7F16\u8F91");return}if(0<selectedIDs.length){perform=true;roadCrossLine(datum)}else{}}else if(datum.modelName==iD.data.Constant.C_NODE){context.enter(iD.modes.Browse(context))}}}var behavior=function(selection){var lastMousePos,lastMouseTarget,clickTimeId;d3.select(window).on("keydown.roadcross",keydown).on("keyup.roadcross",keyup);selection.on("mousedown.roadcross",function(){lastMousePos=[d3.event.clientX,d3.event.clientY];lastMouseTarget=d3.event.target}).on("mouseup.roadcross",function(){var upPos=[d3.event.clientX,d3.event.clientY];if(d3.event.target===lastMouseTarget&&5>iD.geo.euclideanDistance(lastMousePos,upPos)){var targetEvent=d3.event;if(clickTimeId){clearTimeout(clickTimeId)}clickTimeId=setTimeout(function(){clickTimeId=null;var oldEvent=d3.event;d3.event=targetEvent;click();d3.event=oldEvent;targetEvent=null},250)}lastMousePos=null;lastMouseTarget=null}).on("click.roadcross",function(){if(clickTimeId){clearTimeout(clickTimeId);clickTimeId=null}click()});keydown();context.perform(iD.actions.Noop(),t("operations.road_cross_edit.description"))};behavior.off=function(selection){if(!perform){context.pop()}else{context.replace(iD.actions.RoadCrossModify(selectedIDs),t("operations.road_cross_edit.description"))}d3.select(window).on("keydown.roadcross",null).on("keyup.roadcross",null);selection.on("click.roadcross",null);selection.on("mouseup.roadcross",null);selection.on("mousedown.roadcross",null);keyup()};return behavior};;;iD.behavior.LaneInfoPathEdit=function(context,selectedIDs,maat){var fromMember=maat.memberByRole(iD.data.RoleType.FROAD_ID);var toMember=maat.memberByRole(iD.data.RoleType.TROAD_ID);function keydown(){if(d3.event&&d3.event.shiftKey){context.surface().classed("behavior-multiselect",true)}}function keyup(){if(!d3.event||!d3.event.shiftKey){context.surface().classed("behavior-multiselect",false)}}function click(){var datum=d3.event.target.__data__;if(datum&&datum.tags){if(datum.modelName==iD.data.DataType.ROAD&&"way"==datum.type){var index=selectedIDs.indexOf(datum.id);if(-1==index){selectedIDs.push(datum.id)}else{if(fromMember.id==datum.id||toMember.id==datum.id){Dialog.alert("\u884C\u8F66\u5F15\u5BFC\u7EBF\u8DEF\u5F84\u5FC5\u987B\u5305\u542B\u884C\u8F66\u5F15\u5BFC\u7EBF")}else{selectedIDs.splice(index,1)}}context.surface().selectAll(".selected").classed("selected",false);context.surface().selectAll(iD.util.entityOrMemberSelector(selectedIDs,context.graph())).classed("selected",true)}}}var behavior=function(selection){var lastMousePos,lastMouseTarget,clickTimeId;d3.select(window).on("keydown.LaneInfoModify",keydown).on("keyup.LaneInfoModify",keyup);selection.on("mousedown.LaneInfoModify",function(){lastMousePos=[d3.event.clientX,d3.event.clientY];lastMouseTarget=d3.event.target}).on("mouseup.LaneInfoModify",function(){var upPos=[d3.event.clientX,d3.event.clientY];if(d3.event.target===lastMouseTarget&&5>iD.geo.euclideanDistance(lastMousePos,upPos)){var targetEvent=d3.event;if(clickTimeId){clearTimeout(clickTimeId)}clickTimeId=setTimeout(function(){clickTimeId=null;var oldEvent=d3.event;d3.event=targetEvent;click();d3.event=oldEvent;targetEvent=null},250)}lastMousePos=null;lastMouseTarget=null}).on("click.LaneInfoModify",function(){if(clickTimeId){clearTimeout(clickTimeId);clickTimeId=null}click()});keydown()};behavior.off=function(selection){d3.select(window).on("keydown.LaneInfoModify",null).on("keyup.LaneInfoModify",null);selection.on("click.LaneInfoModify",null);selection.on("mouseup.LaneInfoModify",null);selection.on("mousedown.LaneInfoModify",null);keyup()};return behavior};;;iD.behavior.ediftorWay=function(){function d3_eventCancel(){d3.event.stopPropagation();d3.event.preventDefault()}var event=d3.dispatch("start","move","end","off"),origin=null,selector="",node=null,filter=null,event_,target,surface;event.of=function(thiz,argumentz){return function(e1){var e0=e1.sourceEvent=d3.event;e1.target=drag;d3.event=e1;argumentz[0]=node;try{event[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}};var d3_event_userSelectProperty=iD.util.prefixCSSProperty("UserSelect"),d3_event_userSelectSuppress=d3_event_userSelectProperty?function(){var selection=d3.selection(),select=selection.style(d3_event_userSelectProperty);selection.style(d3_event_userSelectProperty,"none");return function(){selection.style(d3_event_userSelectProperty,select)}}:function(type){var w=d3.select(window).on("selectstart."+type,d3_eventCancel);return function(){w.on("selectstart."+type,null)}};function mousedown(){target=this;event_=event.of(this,arguments);var eventTarget=d3.event.target,touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null,offset,origin_=point(),started=false,selectEnable=d3_event_userSelectSuppress(null!==touchId?"drag-"+touchId:"drag");var w=d3.select(window).on(null!==touchId?"touchmove.editorway-"+touchId:"mousemove.editorway",dragmove).on(null!==touchId?"touchend.editorway-"+touchId:"mouseup.editorway",dragend,true);offset=[0,0];if(null===touchId)d3.event.stopPropagation();function point(){var p=target.parentNode||surface;return null!==touchId?d3.touches(p).filter(function(p){return p.identifier===touchId})[0]:d3.mouse(p)}function dragmove(){var p=point(),dx=p[0]-origin_[0],dy=p[1]-origin_[1];if(0===dx&&0===dy)return;if(!started){started=true;event_({type:"start"})}origin_=p;d3_eventCancel();event_({type:"move",point:[p[0]+offset[0],p[1]+offset[1]],delta:[dx,dy]})}function dragend(){if(started){event_({type:"end"});d3_eventCancel();if(d3.event.target===eventTarget)w.on("click.editorway",click,true)}w.on(null!==touchId?"touchmove.editorway-"+touchId:"mousemove.editorway",null).on(null!==touchId?"touchend.editorway-"+touchId:"mouseup.editorway",null);selectEnable()}function click(){d3_eventCancel();w.on("click.editorway",null)}}function drag(selection){var matchesSelector=iD.util.prefixDOMProperty("matchesSelector"),delegate=mousedown;if(selector){delegate=function(){var root=this,target=d3.event.target;for(;target&&target!==root;target=target.parentNode){if((target[matchesSelector]("path")||target[matchesSelector](selector))&&null!=node){return mousedown.call(target,target.__data__)}}}}selection.on("mousedown.editor_way"+selector,delegate).on("touchstart.editor_way"+selector,delegate)}drag.off=function(selection){selection.on("mousedown.editor_way"+selector,null).on("touchstart.editor_way"+selector,null);event_&&event_({type:"off"})};drag.node=function(_){if(!arguments.length)return node;node=_;return drag};drag.delegate=function(_){if(!arguments.length)return selector;selector=_;return drag};drag.filter=function(_){if(!arguments.length)return origin;filter=_;return drag};drag.origin=function(_){if(!arguments.length)return origin;origin=_;return drag};drag.cancel=function(){d3.select(window).on("mousemove.editor_way",null).on("mouseup.editor_way",null);return drag};drag.target=function(){return drag};drag.surface=function(){if(!arguments.length)return surface;surface=arguments[0];return drag};return d3.rebind(drag,event,"on")};;;iD.modes={};;;iD.modes.AddArea=function(context){var mode={id:"add-area",button:"area",title:"",description:t("modes.add_area.description"),key:"Alt+3",enable:true};var behavior=iD.behavior.AddWay(context).tail(t("modes.add_area.tail")).on("start",start).on("startFromWay",startFromWay).on("startFromNode",startFromNode);function start(loc){var nodeLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE).id;var wayLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER).id;var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER);var graph=context.graph(),node=iD.Node({loc:loc,layerId:nodeLayerId,modelName:iD.data.DataType.DIVIDER_NODE,tags:{}}),way=iD.Way({layerId:wayLayerId,modelName:iD.data.DataType.DIVIDER,tags:{}});way.tags["isPolygon"]=true;context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id),iD.actions.AddVertex(way.id,node.id));context.event.add({type:"area",entity:way});context.enter(iD.modes.DrawArea(context,way.id,graph))}function startFromWay(loc,edge){var nodeLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE).id;var wayLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER).id;var graph=context.graph(),node=iD.Node({loc:loc,layerId:nodeLayerId,modelName:iD.data.DataType.DIVIDER_NODE,tags:{}}),way=iD.Way({layerId:wayLayerId,modelName:iD.data.DataType.DIVIDER,tags:{}});way.tags["isPolygon"]=true;context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id),iD.actions.AddVertex(way.id,node.id),iD.actions.AddMidpoint({loc:loc,edge:edge},node));context.enter(iD.modes.DrawArea(context,way.id,graph))}function startFromNode(node){var nodeLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE).id;var wayLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER).id;var graph=context.graph(),node=iD.Node({loc:loc,layerId:nodeLayerId,modelName:iD.data.DataType.DIVIDER_NODE,tags:{}}),way=iD.Way({layerId:wayLayerId,modelName:iD.data.DataType.DIVIDER,tags:{}});way.tags["isPolygon"]=true;context.perform(iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id),iD.actions.AddVertex(way.id,node.id));context.enter(iD.modes.DrawArea(context,way.id,graph))}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddBoardArea=function(context){var mode={id:"add-board-area",button:"board-area",title:"",description:t("modes.add_board_area.description"),key:"Alt+5",enable:true};var constant=iD.data.DataType;var highLightIds=context.selectedIDs();function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",flag)}context.map().on("drawn.select",selectElements);var behavior=iD.behavior.AddWay(context).tail(t("modes.add_board_area.tail")).on("start",start).on("startFromWay",startFromWay).on("startFromNode",startFromNode);function start(loc){var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.TRAFFICSIGN_NODE);var nodeLayerid=nodeLayer.id;var pgLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.TRAFFICSIGN);var pgLayerid=pgLayer.id;var graph=context.graph(),node=iD.Node({loc:loc,layerId:nodeLayerid,modelName:iD.data.DataType.TRAFFICSIGN_NODE}),way=iD.Way({layerId:pgLayerid,modelName:iD.data.DataType.TRAFFICSIGN});way.setTags(iD.util.getDefauteTags(way,pgLayer));node.setTags(iD.util.getDefauteTags(node,nodeLayer));context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id),iD.actions.AddVertex(way.id,node.id));context.event.add({type:"area",entity:way});context.enter(iD.modes.DrawBoardArea(context,way.id,graph,"board-area"))}function startFromWay(loc,edge,clickWay){start(loc)}function startFromNode(node){start(node.loc)}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddLandCoverArea=function(context){var mode={id:"add-land-cover-area",button:"landCoverArea",title:"",description:t("modes.add_land_cover_area.description"),key:"Alt+3",enable:true};var constant=iD.data.DataType;var highLightIds=context.selectedIDs();function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",flag)}context.map().on("drawn.select",selectElements);var behavior=iD.behavior.AddWay(context).tail(t("modes.add_land_cover_area.tail")).on("start",start).on("startFromWay",startFromWay).on("startFromNode",startFromNode);function start(loc){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.LANDCOVERAREA);var wayLayerId=wayLayer.id;var graph=context.graph(),node=iD.Node({loc:loc,layerId:wayLayerId,modelName:iD.data.DataType.LANDCOVERAREA}),way=iD.Way({layerId:wayLayerId,modelName:iD.data.DataType.LANDCOVERAREA});way.setTags(iD.util.getDefauteTags(way,wayLayer));node.setTags(iD.util.getDefauteTags(node,wayLayer));context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id),iD.actions.AddVertex(way.id,node.id));context.event.add({type:"area",entity:way});context.enter(iD.modes.DrawLandCoverArea(context,way.id,graph,"walk-area"))}function startFromWay(loc,edge,clickWay){start(loc)}function startFromNode(node){start(node.loc)}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddPoint=function(context){var mode={id:"add-point",button:"point",title:"",description:t("modes.add_point.description"),key:"Alt+1"};var behavior=iD.behavior.Draw(context).tail(t("modes.add_point.tail")).on("click",add).on("clickWay",addWay).on("clickNode",addNode).on("cancel",cancel).on("finish",cancel);function add(loc){var layer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.OBJECT_PT);var layerid=layer.id;var node=iD.Node({layerId:layerid,loc:loc,modelName:iD.data.DataType.OBJECT_PT,tags:iD.util.getDefauteTags(iD.data.DataType.OBJECT_PT,layer)});context.perform(iD.actions.AddEntity(node),t("operations.add.annotation.point"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:node.type,entity:node})}function addWay(loc){add(loc)}function addNode(node){add(node.loc)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddPointCheckTag=function(context){if(!iD.User.isEditCheckSystemAndRole()){return false}var mode={id:"add-point-checktag",button:"point-checktag",title:"",description:t("operations.checkTag.description"),key:"Alt+5"};var behavior=iD.behavior.Draw(context).tail(t("operations.checkTag.tail")).on("click",add).on("clickWay",addWay).on("clickNode",addNode).on("cancel",cancel).on("finish",cancel);function add(loc){var layer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.CHECK_TAG);var layerid=layer.id;var node=iD.Node({layerId:layerid,loc:loc,modelName:iD.data.DataType.CHECK_TAG,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.CHECK_TAG,layer),{CREATEBY:iD.User.getInfo().username})});iD.util.tagExtend.updateTaskTag(node);context.perform(iD.actions.AddEntity(node),t("operations.checkTag.title"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:node.type,entity:node})}function addWay(loc){add(loc)}function addNode(node){add(node.loc)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddPoi=function(context){var mode={id:"add-poi",button:"poi",title:"",description:t("modes.add_poi.description"),key:"Alt+1"};var behavior=iD.behavior.Draw(context).tail(t("modes.add_poi.tail")).on("click",add).on("clickWay",addWay).on("clickNode",addNode).on("cancel",cancel).on("finish",cancel);function add(loc){var layer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.POI);var layerid=layer.id;var node=iD.Node({layerId:layerid,loc:loc,modelName:iD.data.DataType.POI,tags:iD.util.getDefauteTags(iD.data.DataType.POI,layer)});context.perform(iD.actions.AddEntity(node),t("operations.add.annotation.point"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:node.type,entity:node})}function addWay(loc){add(loc)}function addNode(node){add(node.loc)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddTextMark=function(context){var mode={id:"add-text-mark",button:"textmark",title:"",description:t("modes.add_text_mark.description"),key:"Alt+1"};var behavior=iD.behavior.Draw(context).tail(t("modes.add_text_mark.tail")).on("click",add).on("clickWay",addWay).on("clickNode",addNode).on("cancel",cancel).on("finish",cancel);function add(loc){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.TEXT_MARK);var layerid=currentLayer.id;var node=iD.Node({layerId:layerid,loc:loc,modelName:iD.data.DataType.TEXT_MARK,tags:iD.util.getDefauteTags(iD.data.DataType.TEXT_MARK,currentLayer)});context.perform(iD.actions.AddEntity(node),t("operations.add.annotation.point"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:node.type,entity:node})}function addWay(loc){add(loc)}function addNode(node){add(node.loc)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddLine=function(context){var mode={id:"add-line",button:"line",title:"",description:t("modes.add_line.description"),key:"Ctrl+Q",enable:true};var behavior=iD.behavior.AddWay(context).tail(t("modes.add_line.tail")).on("start",start).on("startFromWay",startFromWay).on("startFromNode",startFromNode);function start(loc){var currLayer=context.layers().getLayer();var graph=context.graph(),node=iD.Node({layerId:currLayer.id,loc:loc}),way=iD.Way({layerId:currLayer.id});context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));context.event.add({type:"line",entity:way});context.enter(iD.modes.DrawLine(context,way.id,graph))}function startFromWay(loc,edge){var currLayer=context.layers().getLayer();var graph=context.graph(),node=iD.Node({layerId:currLayer.id,loc:loc}),way=iD.Way({layerId:currLayer.id});context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id),iD.actions.AddMidpoint({loc:loc,edge:edge},node));context.enter(iD.modes.DrawLine(context,way.id,graph))}function startFromNode(node){var currLayer=context.layers().getLayer();var way=iD.Way({layerId:currLayer.id});context.perform(iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));context.enter(iD.modes.DrawLine(context,way.id,context.graph()))}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddFusionDivider=function(context){var mode={id:"add-fusion-divider",button:"fusiondivider",title:"",description:t("modes.add_fusion_divider.description"),key:"Ctrl+Q",enable:true};var highLightIds=context.selectedIDs();function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",flag)}context.map().on("drawn.select",selectElements);var behavior=iD.behavior.AddWay(context).tail(t("modes.add_fusion_divider.tail")).on("start",start).on("startFromWay",startFromWay).on("startFromNode",startFromNode);function start(loc){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER);var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);var wayLayerId=wayLayer.id;var nodeLayerId=nodeLayer.id;var graph=context.graph(),node=iD.Node({layerId:nodeLayerId,loc:loc,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,nodeLayer),modelName:iD.data.DataType.DIVIDER_NODE}),way=iD.Way({layerId:wayLayerId,modelName:iD.data.DataType.DIVIDER});way.setTags(iD.util.getDefauteTags(way,wayLayer));context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));context.event.add({type:"road",entity:way});context.enter(iD.modes.DrawFusionDivider(context,way.id,graph,"","fusiondivider"))}function startFromWay(loc,edge){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER);var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);var wayLayerId=wayLayer.id;var nodeLayerId=nodeLayer.id;var graph=context.graph(),node=iD.Node({layerId:nodeLayerId,loc:loc,modelName:iD.data.DataType.DIVIDER_NODE}),way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.DIVIDER;way.setTags(iD.util.getDefauteTags(way,wayLayer));node.setTags(iD.util.getDefauteTags(node,nodeLayer));context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));context.enter(iD.modes.DrawFusionDivider(context,way.id,graph,"","fusiondivider"))}function startFromNode(node){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER);var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);var wayLayerId=wayLayer.id;var nodeLayerId=nodeLayer.id;var way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.DIVIDER;way.setTags(iD.util.getDefauteTags(way,wayLayer));var args=[];var isBreakPoint=true;var newWayFirstNode=node;context.perform(iD.actions.Noop(),t("modes.add_road.description"));if(node.modelName==iD.data.DataType.DIVIDER_NODE){var graph=context.graph();var parentWays=graph.parentWays(node);parentWays.forEach(function(way){if(way.first()!=node.id&&way.last()!=node.id){isBreakPoint=false}})}if(!isBreakPoint||node.modelName!=iD.data.DataType.DIVIDER_NODE){newWayFirstNode=iD.Node({layerId:nodeLayerId,loc:node.loc,modelName:iD.data.DataType.DIVIDER_NODE});newWayFirstNode.setTags(iD.util.getDefauteTags(newWayFirstNode,nodeLayer));args.push(iD.actions.AddEntity(newWayFirstNode))}args.push(...[iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,newWayFirstNode.id)]);context.replace.apply(this,args);context.enter(iD.modes.DrawFusionDivider(context,way.id,graph,"","fusiondivider"))}mode.enter=function(){context.install(behavior);var walklink=d3.select("g.layer.layer-walk");walklink.classed("no-pointer-events",true)};mode.exit=function(){selectElements(true);context.uninstall(behavior);var walklink=d3.select("g.layer.layer-walk");walklink.classed("no-pointer-events",false)};return mode};;;iD.modes.AddRoad=function(context){var mode={id:"add-road",button:"road",title:"",description:t("modes.add_road.description"),key:"Ctrl+Q",enable:true};var highLightIds=context.selectedIDs();function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",flag)}context.map().on("drawn.select",selectElements);var behavior=iD.behavior.AddWay(context).tail(t("modes.add_line.tail")).on("start",start).on("startFromWay",startFromWay).on("startFromNode",startFromNode);function start(loc){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD);var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD_NODE);var wayLayerId=wayLayer.id;var nodeLayerId=nodeLayer.id;var graph=context.graph(),node=iD.Node({layerId:nodeLayerId,loc:loc,modelName:iD.data.DataType.ROAD_NODE}),way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.ROAD;way.setTags(iD.util.getDefauteTags(way,wayLayer));node.setTags(iD.util.getDefauteTags(node,nodeLayer));context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));context.event.add({type:"road",entity:way});context.enter(iD.modes.DrawLine(context,way.id,graph,"","road"))}function startFromWay(loc,edge){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD);var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD_NODE);var wayLayerId=wayLayer.id;var nodeLayerId=nodeLayer.id;var graph=context.graph(),node=iD.Node({layerId:nodeLayerId,loc:loc,modelName:iD.data.DataType.ROAD_NODE}),way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.ROAD;way.setTags(iD.util.getDefauteTags(way,wayLayer));node.setTags(iD.util.getDefauteTags(node,nodeLayer));context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));context.enter(iD.modes.DrawLine(context,way.id,graph,"","road"))}function startFromNode(node){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD);var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD_NODE);var wayLayerId=wayLayer.id;var nodeLayerId=nodeLayer.id;var way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.ROAD;way.setTags(iD.util.getDefauteTags(way,wayLayer));var args=[];var isBreakPoint=true;var newWayFirstNode=node;context.perform(iD.actions.Noop(),t("modes.add_road.description"));if(node.modelName==iD.data.DataType.ROAD_NODE){var graph=context.graph();var parentWays=graph.parentWays(node);parentWays.forEach(function(way){if(way.first()!=node.id&&way.last()!=node.id){isBreakPoint=false}})}if(!isBreakPoint||node.modelName!=iD.data.DataType.ROAD_NODE){newWayFirstNode=iD.Node({layerId:nodeLayerId,loc:node.loc,modelName:iD.data.DataType.ROAD_NODE});newWayFirstNode.setTags(iD.util.getDefauteTags(newWayFirstNode,nodeLayer));args.push(iD.actions.AddEntity(newWayFirstNode))}args.push(...[iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,newWayFirstNode.id)]);context.replace.apply(this,args);context.enter(iD.modes.DrawLine(context,way.id,graph,"","road"))}mode.enter=function(){context.install(behavior);var walklink=d3.select("g.layer.layer-walk");walklink.classed("no-pointer-events",true)};mode.exit=function(){selectElements(true);context.uninstall(behavior);var walklink=d3.select("g.layer.layer-walk");walklink.classed("no-pointer-events",false)};return mode};;;iD.modes.AddDivider=function(context){var mode={id:"add-divider",button:"divider",title:"",description:t("modes.add_divider.description"),key:"Ctrl+Q",enable:true};var highLightIds=context.selectedIDs();function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",flag)}context.map().on("drawn.select",selectElements);var behavior=iD.behavior.AddWay(context).tail(t("modes.add_divider.tail")).on("start",start).on("startFromWay",start).on("startFromNode",start).on("dragend",dragMap);function start(loc){let cRangeNodes=iD.util.selectNode_Z(loc,40);let tracks=[];for(let i=0;i<cRangeNodes.length;i++){var rangeNodes=cRangeNodes[i];var node=iD.util.getNearestNode(loc,rangeNodes.nodes);tracks.push({node:node,cameraHeight:rangeNodes.cameraHeight,trackId:rangeNodes.traceId})}if(0==tracks.length){Dialog.alert("\u5F53\u524D\u4F4D\u7F6E\uFF0C\u65E0\u6CD5\u83B7\u53D6\u9AD8\u7A0B\u503C\uFF01");return}var nearrestTrack=iD.util.getNearestTracks(loc,tracks);loc[2]=nearrestTrack.node.loc[2]-nearrestTrack.cameraHeight;var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER);var wayLayerId=wayLayer.id;var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);var nodeLayerId=nodeLayer.id;var graph=context.graph(),node=iD.Node({layerId:nodeLayerId,loc:loc,modelName:iD.data.DataType.DIVIDER_NODE}),way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.DIVIDER;way.setTags(iD.util.getDefauteTags(way,wayLayer));node.setTags(iD.util.getDefauteTags(node,nodeLayer));context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));context.event.add({type:"road",entity:way});context.enter(iD.modes.DrawDivider(context,way.id,graph,"","divider"))}function startFromWay(loc,edge){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER);var wayLayerId=wayLayer.id;var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);var nodeLayerId=nodeLayer.id;var graph=context.graph(),node=iD.Node({layerId:nodeLayerId,loc:loc,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,nodeLayer),modelName:iD.data.DataType.DIVIDER_NODE}),way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.DIVIDER;way.setTags(iD.util.getDefauteTags(way,wayLayer));context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));context.enter(iD.modes.DrawDivider(context,way.id,graph,"","divider"))}function startFromNode(node){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER);var wayLayerId=wayLayer.id;var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);var nodeLayerId=nodeLayer.id;var way=iD.Way({layerId:wayLayerId});way.modelName=iD.data.DataType.DIVIDER;way.setTags(iD.util.getDefauteTags(way,wayLayer));var args=[];var isBreakPoint=true;var newWayFirstNode=node;context.perform(iD.actions.Noop(),t("modes.add_divider.description"));if(node.modelName==iD.data.DataType.DIVIDER_NODE){var graph=context.graph();var parentWays=graph.parentWays(node);parentWays.forEach(function(way){if(way.first()!=node.id&&way.last()!=node.id){isBreakPoint=false}})}if(!isBreakPoint||node.modelName!=iD.data.DataType.DIVIDER_NODE){newWayFirstNode=iD.Node({layerId:nodeLayerId,loc:node.loc,tags:iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,nodeLayer),modelName:iD.data.DataType.DIVIDER_NODE});args.push(iD.actions.AddEntity(newWayFirstNode))}args.push(...[iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,newWayFirstNode.id)]);context.replace.apply(this,args);context.enter(iD.modes.DrawDivider(context,way.id,graph,"","divider"))}function dragMap(e){}mode.enter=function(){context.install(behavior);var walklink=d3.select("g.layer.layer-walk");walklink.classed("no-pointer-events",true)};mode.exit=function(){selectElements(true);context.uninstall(behavior);var walklink=d3.select("g.layer.layer-walk");walklink.classed("no-pointer-events",false)};return mode};;;iD.modes.AddCutDivider=function(context){var mode={id:"add-cut-divider",button:"cutDivider",title:"",description:t("modes.cut_divider.description"),key:"Ctrl+E",enable:true};var highLightIds=context.selectedIDs();function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",flag)}context.map().on("drawn.cut-divider",selectElements);var behavior=iD.behavior.AddWay(context).tail(t("modes.add_divider.tail")).on("start.cut-divider",start).on("startFromWay.cut-divider",startFromWay).on("startFromNode.cut-divider",startFromNode);function enterDrawDividerMode(waydata,graph){var mode=iD.modes.DrawCutDivider(context,waydata.id,graph,"","divider");context.enter(mode)}function start(loc){var wayLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER);var wayLayerId=wayLayer.id;var nodeLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.DIVIDER_NODE);var nodeLayerId=nodeLayer.id;var graph=context.graph(),node=iD.Node({layerId:nodeLayerId,loc:loc,modelName:iD.data.DataType.DIVIDER_NODE}),way=iD.Way({layerId:wayLayerId,modelName:iD.data.DataType.DIVIDER});way.setTags(iD.util.getDefauteTags(way,wayLayer));node.setTags(iD.util.getDefauteTags(node,nodeLayer));way.tags.iscut=true;context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));enterDrawDividerMode(way,graph)}function startFromWay(loc,edge){start(loc)}function startFromNode(node){start(node.loc)}mode.enter=function(){context.install(behavior)};mode.exit=function(){selectElements(true);context.uninstall(behavior)};return mode};;;iD.modes.Browse=function(context){var mode={button:"browse",id:"browse",title:t("modes.browse.title"),description:t("modes.browse.description")},sidebar;var behaviors=[iD.behavior.Hover(context).on("hover",context.ui().sidebar.hover),iD.behavior.Select(context),iD.behavior.Lasso(context),iD.modes.DragNode(context).behavior];mode.enter=function(){context.transportation.set();context.temp().rawposition=0;behaviors.forEach(function(behavior){context.install(behavior)});if(document.activeElement&&document.activeElement.blur){document.activeElement.blur()}if(sidebar){context.ui().sidebar.show(sidebar)}else{context.ui().sidebar.select(null)}var d3Obj=d3.select("#KDSEditor-sidebar");if(0<d3Obj.size()){d3Obj.attr("data-multiselectids",null);d3Obj.attr("data-filterparam",null);d3Obj.attr("data-member-multiselectids",null)}};mode.exit=function(){behaviors.forEach(function(behavior){context.uninstall(behavior)});if(sidebar){context.ui().sidebar.hide(sidebar)}};mode.sidebar=function(_){if(!arguments.length)return sidebar;sidebar=_;return mode};return mode};;;iD.modes.DragNode=function(context,selectedWays){var mode={id:"drag-node",button:"browse"};var nudgeInterval,activeIDs,wasMidpoint,cancelled,startloc,selectedIDs=[],hover=iD.behavior.Hover(context).altDisables(false).on("hover",context.ui().sidebar.hover),edit=iD.behavior.Edit(context);var oldNodeEntity;function isOverlay(entity){return _.filter([iD.Marker,iD.Icon,iD.Polygon,iD.Polyline],Overlay=>entity instanceof Overlay).length||null!=entity.graphType}function edge(point,size){var pad=[30,100,30,100];if(point[0]>size[0]-pad[0])return[-10,0];else if(point[0]<pad[2])return[10,0];else if(point[1]>size[1]-pad[1])return[0,-10];else if(point[1]<pad[3])return[0,10];return null}function startNudge(nudge){if(nudgeInterval)window.clearInterval(nudgeInterval);nudgeInterval=window.setInterval(function(){context.pan(nudge)},50)}function stopNudge(){if(nudgeInterval)window.clearInterval(nudgeInterval);nudgeInterval=null}function moveAnnotation(entity){return t("operations.move.annotation."+entity.geometry(context.graph()))}function connectAnnotation(entity){if(0<newNodeEntity.length){return t("operations.topo_split.annotation-way")}return t("operations.connect.annotation."+entity.geometry(context.graph()))}function origin(entity){return context.projection(entity.loc)}function layerEnable(entity){var r=true;if("midpoint"===entity.type)r=iD.Layers.getLayer(entity.parents[0].layerId);else r=iD.Layers.getLayer(entity.layerId);return null==r?false:r.editable}function filter(entity){var isoverlay=isOverlay(entity);if(!isoverlay){var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!(iD.Task.working&&iD.Task.working.task_id===iD.Task.d.task_id)||!modelConfig&&!modelConfig.editable){return true}}if(!isoverlay){if(entity.modelName&&context.variable.canNotDrag.includes(entity.modelName)){return true}else if("start"==arguments[1]||"ing"==arguments[1]){return false}}if(isoverlay&&entity instanceof iD.Entity){if(entity.g()&&entity.g().g()){if(entity.enable||entity.editable){if("start"!=arguments[1]){entity.loc=context.map().mouseCoordinates()}if(entity.parents&&entity.edge){var nodes=entity.parents.nodes;for(var i=0;i<nodes.length-1;i++){if(iD.geo.edgeEqual([nodes[i].id,nodes[i+1].id],entity.edge)){nodes.splice(i+1,0,entity);continue}}}var k="drag"+arguments[1];context.event[k]&&context.event[k]({overlay:entity,loc:entity.loc});context.map().drawOverlayers()}return true}}if(entity.type===iD.data.GeomType.MIDPOINT){let edgeFirstId=entity.edge[0];let edgeFirstEntity=context.getEntity(edgeFirstId);return edgeFirstEntity.modelName&&context.variable.canNotDrag.includes(entity.modelName)?true:false}if(!layerEnable(entity)||entity instanceof iD.Transportation)return true;if(entity instanceof iD.Node&&(entity.isPlaceName()||entity.isQcTag())){return true}if(entity instanceof iD.Node&&iD.util.entityInPlyGon(entity,context)&&"end"!=arguments[1])return true}function un_drag_mid_node(entity){if("midpoint"==entity.type){var e2=context.graph().entity(entity.edge[0]);var way2=context.graph().parentWays(e2);if(way2.length&&"roadcrossline"==way2[0]._type){return 1}}return 0}var willBeSingleNode=function(entity,context){var flag=false;var topoEntity=iD.TopoEntity();var crossNodeId=topoEntity.isInCrossNode(context.graph(),entity.id);if(crossNodeId){var parentWays=context.graph().parentWays(entity);var wayCounts=0;for(var i=0;i<parentWays.length;i++){if(parentWays[i].modelName==iD.data.DataType.HIGHWAY)wayCounts++}if(2==wayCounts){flag=true}}return flag};var isSingleNode=function(entity,context){var flag=false;var parentWays=context.graph().parentWays(entity);var wayCounts=0;for(var i=0;i<parentWays.length;i++){if(parentWays[i].modelName==iD.data.DataType.HIGHWAY)wayCounts++}if(1==wayCounts){flag=true}return flag};var altPopFlag;function start(entity){altPopFlag=d3.event&&d3.event.sourceEvent.altKey||false;if(filter(entity,"start"))return;var flag=false;if(selectedWays&&isSingleNode(entity,context)){}else if(selectedWays&&context.variable.firstInTopo){if(willBeSingleNode(entity,context)){context.variable.singleNodeByTopoSplit=true;context.variable.singleNode=entity.id;context.enter(iD.modes.Browse(context));return}else{oldNodeEntity=entity;context.perform(iD.actions.TopoSplit(context,selectedWays,entity,newNodeEntity));context.variable.firstInTopo=false;flag=true;if(newNodeEntity&&0<newNodeEntity.length){entity=newNodeEntity[0];var vertex=context.surface().selectAll("."+entity.id);behavior.target(vertex.node(),entity);dragWayBehavior&&dragWayBehavior.target(vertex.node(),entity)}}}cancelled=d3.event.sourceEvent.shiftKey;if(cancelled){dragWayBehavior&&dragWayBehavior.cancel();return behavior.cancel()}wasMidpoint="midpoint"===entity.type;if(wasMidpoint){var midpoint=entity;var pEntity=entity.parents[0];let firstNode=context.entity(pEntity.first());entity=iD.Node({layerId:pEntity.layerId,modelName:firstNode.modelName});context.perform(iD.actions.AddMidpoint(midpoint,entity));var vertex=context.surface().selectAll("."+entity.id);behavior.target(vertex.node(),entity);context.event["entityedite"]&&context.event["entityedite"]({entitys:context.history().graph().parentWays(entity)})}else{startloc=entity.loc;if(!flag){context.perform(iD.actions.Noop())}}activeIDs=_.pluck(context.graph().parentWays(entity),"id");activeIDs.push(entity.id);context.enter(mode)}function datum(){var d=d3.event.sourceEvent.target.__data__;if(!d){return{}};var modelConfig=iD.Layers.getLayer(d.layerId,d.modelName);if(modelConfig&&modelConfig.editable){return d}else{return{}}}function childOf(p,c){if(p===c)return false;while(c&&c!==p)c=c.parentNode;return c===p}function move(entity){if(filter(entity,"ing"))return;if(selectedWays&&isSingleNode(entity,context)){}else if(selectedWays){if(willBeSingleNode(entity,context)){context.variable.singleNodeByTopoSplit=true;context.enter(iD.modes.Browse(context));return}}if(!d3.event.sourceEvent.altKey){if(altPopFlag){altPopFlag=false;if(isOverlay(entity)){filter(entity,"end")}else{context.pop()}behavior.cancel()}context.enter(iD.modes.Browse(context));return}if(cancelled)return;d3.event.sourceEvent.stopPropagation();var nudge=childOf(context.container().node(),d3.event.sourceEvent.toElement)&&edge(d3.event.point,context.map().dimensions());if(nudge)startNudge(nudge);else stopNudge();var loc=context.map().mouseCoordinates();var d=datum();if(d.layerId==entity.layerId){if("node"===d.type&&d.id!==entity.id){loc=d.loc}else if("way"===d.type&&!d3.select(d3.event.sourceEvent.target).classed("fill")){loc=iD.geo.chooseEdge(context.childNodes(d),context.mouse(),context.projection).loc}}if(!entity.loc){entity.loc=loc}if(2==loc.length){if(entity.loc[2]){loc.push(entity.loc[2])}else{loc.push(-1)}}context.replace(iD.actions.MoveNode(entity.id,loc),moveAnnotation(entity))}function updateRoadCrossRelation(node){if(node.modelName==iD.data.Constant.C_NODE){return}var graph=context.graph();var relations=graph.parentRelations(node,iD.data.DataType.R_C_NODE_ROAD_NODE);if(!relations.length||1>=node.getParentWays(graph).length){return}for(let i in relations){let relation=relations[i];let newLoc=[0,0],_count=0,roadCrossId;relation.members.forEach(function(m){let entity=graph.entity(m.id);if(entity.modelName==iD.data.Constant.C_NODE){roadCrossId=entity.id;return}_count++;newLoc[0]+=entity.loc[0];newLoc[1]+=entity.loc[1]});newLoc[0]/=_count;newLoc[1]/=_count;context.replace(iD.actions.MoveNode(roadCrossId,newLoc))}}function isInWay(entity,way){var flag=false;context.graph().parentWays(entity).forEach(function(w){if(way.id==w.id){flag=true}});return flag}function isLinkNode(entity,d){var flag=false;var nodes=[];context.graph().parentWays(entity).forEach(function(w){nodes.push(w.nodes[0]);nodes.push(w.nodes[w.nodes.length-1])});context.graph().parentWays(d).forEach(function(w){if(-1!=nodes.indexOf(w.nodes[0])||-1!=nodes.indexOf(w.nodes[w.nodes.length-1])){flag=true}});return flag}function isOutOfBorder(entity){if(entity instanceof iD.Node&&!iD.util.entityInPlyGon(entity,context))return true;if(entity instanceof iD.Way&&!iD.util.entityInPlyGon(entity,context))return true;return false}function dimIsOutOfBorder(entity){return false;if(entity instanceof iD.Node&&!iD.util.justNodeInPlyGonx(entity,context))return true;if(entity instanceof iD.Way&&!iD.util.wayInPlyGonx(entity,context))return true;return false}function filterParentways(graph,entity){var ways=graph.parentWays(entity),r=[];for(var i=0;i<ways.length;i++){var way=ways[i];if(!way.isOneRoadCrossWay())r.push(way)}return r}function isAssistInfoOrTollgate(graph,entity){if(entity.tags.tollgate&&"1"==entity.tags.tollgate){return true}var parentRels=graph.parentRelations(entity);for(var i=0;i<parentRels.length;i++){if(parentRels[i].modelName==iD.data.DataType.NODECONN){var secondeRels=graph.parentRelations(parentRels[i]);for(var j=0;j<secondeRels.length;j++){if(secondeRels[j].modelName==iD.data.DataType.ASSISTINFO&&secondeRels[j].tags&&"0"!=secondeRels[j].tags.block_type){return true}}}}return false}function isSameType(entity,way){if(entity.modelName==iD.data.DataType.WALKENTER&&way.modelName&&way.modelName==iD.data.DataType.WALKLINK||entity.modelName==iD.data.DataType.ROAD_NODE&&way.modelName&&way.modelName==iD.data.DataType.ROAD){return true}return false}function end(entity){if(filter(entity,"end")){return}if(selectedWays&&isSingleNode(entity,context)){}else if(selectedWays){if(willBeSingleNode(entity,context)){context.variable.singleNodeByTopoSplit=true;context.enter(iD.modes.Browse(context));return}}if(!d3.event.sourceEvent.altKey){if(altPopFlag){altPopFlag=false;if(isOverlay(entity)){filter(entity,"end")}else{context.pop()}behavior.cancel()}context.enter(iD.modes.Browse(context));return}if(isOutOfBorder(context.entity(entity.id))){Dialog.alert("\u5BF9\u8C61\u7F16\u8F91\u51FA\u754C",function(){context.pop();context.enter(iD.modes.Browse(context))});return}if(cancelled)return;var d=datum();if(d instanceof iD.Entity&&dimIsOutOfBorder(d)){Dialog.alert("\u76EE\u6807\u5BF9\u8C61\u4E0D\u53EF\u7F16\u8F91",function(){context.pop();context.enter(iD.modes.Browse(context))});return}if(d instanceof iD.Node&&d.modelName==iD.data.DataType.ROAD_NODE&&"20"==d.tags.boundary&&"0"==d.tags.realnode){Dialog.alert("\u76EE\u6807\u70B9\u4E3A\u8DE8\u56FE\u5E45\u8FB9\u6846\u70B9\uFF0C\u4E0D\u80FD\u662F\u771F\u5B9E\u8282\u70B9",function(){context.pop();context.enter(iD.modes.Browse(context))});return}if(entity.modelName==iD.data.DataType.ROAD_NODE&&!wasMidpoint){if("way"===d.type&&!d.isOneRoadCrossWay()){if(isInWay(entity,d)){Dialog.alert("\u4E0D\u80FD\u5C06\u8282\u70B9\u79FB\u52A8\u5230\u81EA\u8EAB\u8FDE\u63A5\u9053\u8DEF\u4E0A",function(){context.pop();context.enter(iD.modes.Browse(context))})}else if(isSameType(entity,d)){var choice=iD.geo.chooseEdge(context.childNodes(d),context.mouse(),context.projection);var newNode=iD.Node({layerId:entity.layerId,modelName:iD.data.DataType.ROAD_NODE,loc:entity.loc});var args=[iD.actions.AddEntity(newNode),iD.actions.AddMidpoint({loc:choice.loc,edge:[d.nodes[choice.index-1],d.nodes[choice.index]]},newNode),iD.actions.SplitRoad([newNode.id],context,d.id),iD.actions.UpdateNode(context,entity.id),iD.actions.Connect(context,[newNode.id,entity.id]),connectAnnotation(d)];var isroad=iD.Layers.getLayer(d.layerId).isRoad();if(!isroad){args.splice(1,2)}if(isroad&&!iD.util.nodeIsBreakPoint(entity,context.graph())){var pway=context.graph().parentWays(entity)[0];args.splice(args.length-1,0,iD.actions.SplitRoad([entity.id],context,pway.id))}if(!isroad||isroad&&entity.modelName===iD.data.DataType.ROAD_NODE){context.replace.apply(this,args)}var way=0<context.graph().parentWays(entity).length?context.graph().parentWays(entity):null;context.event["entityedite"]&&context.event["entityedite"]({entitys:way})}}else if("node"===d.type&&d.id!==entity.id&&!d.isRoadCross()&&d.modelName==entity.modelName){if(2==filterParentways(context.graph(),d).length&&isAssistInfoOrTollgate(context.graph(),d)){Dialog.alert("\u7ED3\u70B9\u5B58\u5728\u6536\u8D39\u53E3\u6216\u8005\u95E8\u7981\uFF0C\u4E0D\u80FD\u6267\u884C\u7C98\u8FDE\u64CD\u4F5C",function(){context.pop();context.enter(iD.modes.Browse(context))});return}if(isLinkNode(entity,d)){Dialog.alert("\u4E0D\u80FD\u5408\u5E76\u5177\u6709\u5171\u540C\u8FDE\u63A5\u9053\u8DEF\u7684\u4E24\u4E2A\u8282\u70B9",function(){context.pop();context.enter(iD.modes.Browse(context))});return}else{let entityIsBP=iD.util.nodeIsBreakPoint(entity,context.graph());let dIsBP=iD.util.nodeIsBreakPoint(d,context.graph());args=[iD.actions.Connect(context,[entity.id,d.id]),iD.actions.UpdateNode(context,d.id),connectAnnotation(d)];if(entityIsBP&&dIsBP){var args=[iD.actions.Connect(context,[entity.id,d.id]),iD.actions.UpdateNode(context,d.id),connectAnnotation(d)];entity=d}else{var beforeArgs=[];if(!dIsBP){beforeArgs.push(...[iD.actions.SplitRoad([d.id],context),iD.actions.UpdateNode(context,d.id)])}if(!entityIsBP){beforeArgs.push(...[iD.actions.SplitRoad([entity.id],context),iD.actions.UpdateNode(context,entity.id)])}args.unshift(...beforeArgs)}context.replace.apply(this,args);var way=0<context.graph().parentWays(entity).length?context.graph().parentWays(entity):null;context.event["entityedite"]&&context.event["entityedite"]({entitys:way})}}else{context.replace(iD.actions.UpdateNode(context,entity.id),moveAnnotation(entity))}}else if(!wasMidpoint&&"node"===entity.type){MoveEndToNode(entity,d)}else if(!wasMidpoint&&"node"===entity.type){var is_road=iD.Layers.getLayer(entity.layerId).isRoad();var args=[iD.actions.UpdateRealNode(context,entity.id,oldNodeEntity),iD.actions.UpdateNode(context,entity.id),connectAnnotation(entity)];if(!is_road){args.splice(1,1)}if(!(is_road&&"Highway"===entity.modelName)){if(entity.tags&&"Point"!==entity.modelName){context.replace.apply(this,args);var way=0<context.graph().parentWays(entity).length?context.graph().parentWays(entity):null;context.event["entityedite"]&&context.event["entityedite"]({entitys:way})}}}else if(wasMidpoint){context.replace(iD.actions.Noop(),iD.actions.UpdateNode(context,entity.id),t("operations.add.annotation.vertex"))}var reselection=selectedIDs.filter(function(id){return context.graph().hasEntity(id)});if(reselection.length){if(context.graph().hasEntity(entity.id)){context.enter(iD.modes.Select(context,[entity.id]).suppressMenu(true))}else{context.enter(iD.modes.Browse(context))}}else{context.enter(iD.modes.Browse(context))}}function MoveEndToNode(moveEntity,datum){var moveIsBreakPoint=iD.util.nodeIsBreakPoint(moveEntity,context.graph());var datumIsBreakPoint=iD.util.nodeIsBreakPoint(datum,context.graph());if(!_.isEmpty(datum)&&moveIsBreakPoint&&datumIsBreakPoint&&moveEntity.modelName==datum.modelName){var args=[iD.actions.ConnectDivider(context,[moveEntity.id,datum.id]),connectAnnotation(datum)];context.replace.apply(this,args)}else{context.replace(iD.actions.Noop(),iD.actions.UpdateNode(context,moveEntity.id),t("operations.add.annotation.vertex"))}var way=0<context.graph().parentWays(moveEntity).length?context.graph().parentWays(moveEntity):null;context.event["entityedite"]&&context.event["entityedite"]({entitys:way})}function cancel(){dragWayBehavior&&dragWayBehavior.cancel();behavior.cancel();context.enter(iD.modes.Browse(context))}function setActiveElements(){context.surface().selectAll(iD.util.entitySelector(activeIDs)).classed("active",true)}function available(entity){if(entity.isRoadNode()){var meshCode=MapSheet.getMeshCode(entity,context);var rc;context.graph().parentRelations(entity).forEach(function(rel){if(rel.tags&&rel.modelName==iD.data.Constant.C_NODE){rc=rel}});if(rc&&meshCode!=entity.tags.mesh){return false}}return true}var behavior=iD.behavior.drag().delegate("g.node, g.point, g.midpoint").surface(context.surface().node()).origin(origin).on("start",start).on("move",move).on("end",end);var dragWayBehavior=iD.behavior.ediftorWay?iD.behavior.ediftorWay().delegate("g.node, g.point, g.midpoint").surface(context.surface()?context.surface().node():null).origin(origin).on("start",start).on("move",move).on("end",end).on("off",off):null;function off(){stopNudge()}mode.enter=function(){context.install(hover);context.install(edit);context.history().on("undone.drag-node",cancel);context.map().on("drawn.drag-node",setActiveElements);setActiveElements();var adasRoads=[];activeIDs.forEach(function(id){var activeEntity=context.graph().entity(id);if(activeEntity instanceof iD.Way&&iD.data.DataType.HIGHWAY==activeEntity.modelName&&"0"!=activeEntity.tags.adas&&iD.Adas.isAdasRoad(id)){adasRoads.push(id)}});if(adasRoads&&1<=adasRoads.length){var adasPasswordTip=iD.ui.AdasPasswordTip(context,passwordRight,null,adasRoads);adasPasswordTip.perform("\u5C06\u8981\u4FEE\u6539\u7684\u9053\u8DEF\u662F\u9AD8\u7CBE\u9053\u8DEF\uFF0C\u8BF7\u8F93\u5165\u5BC6\u7801\uFF1A")}function passwordRight(adasRoads){iD.Adas.addAdaRoad(adasRoads)}};mode.exit=function(){context.uninstall(hover);context.uninstall(edit);context.history().on("undone.drag-node",null);context.map().on("drawn.drag-node",null);context.surface().selectAll(".active").classed("active",false);stopNudge()};mode.selectedIDs=function(_){if(!arguments.length)return selectedIDs;selectedIDs=_;return mode};var newNodeEntity=[];var wEnterAndRoadObj=new Object;mode.behavior=behavior;mode.dragWayBehavior=dragWayBehavior;return mode};;;iD.modes.DrawArea=function(context,wayId,baseGraph,modetype){var mode={button:"area",id:"draw-area",drawroad:modetype};var behavior;mode.enter=function(){var way=context.entity(wayId),headId=way.nodes[way.nodes.length-2],tailId=way.first();behavior=iD.behavior.DrawDivider(context,wayId,-1,mode,baseGraph).tail(t("modes.draw_area.tail"));var addNode=behavior.addNode;behavior.addNode=function(node){if(node.id===headId||node.id===tailId){behavior.finish()}else{addNode(node)}};context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};mode.selectedIDs=function(){return[wayId]};return mode};;;iD.modes.DrawLandCoverArea=function(context,wayId,baseGraph,modetype){var mode={button:"landCoverArea",id:"draw-land-cover-area",drawroad:modetype};var behavior;mode.enter=function(){var way=context.entity(wayId),headId=way.nodes[way.nodes.length-2],tailId=way.first();behavior=iD.behavior.DrawLandCoverArea(context,wayId,-1,mode,baseGraph).tail(t("modes.draw_land_cover_area.tail"));var addNode=behavior.addNode;behavior.addNode=function(node){if(node.id===headId||node.id===tailId){behavior.finish()}else{addNode(node)}};context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};mode.selectedIDs=function(){return[wayId]};return mode};;;iD.modes.DrawBoardArea=function(context,wayId,baseGraph,modetype){var mode={button:"boardArea",id:"draw-board-area",drawroad:modetype};var behavior;mode.enter=function(){var way=context.entity(wayId),headId=way.nodes[way.nodes.length-2],tailId=way.first();behavior=iD.behavior.DrawBoardArea(context,wayId,-1,mode,baseGraph).tail(t("modes.draw_board_area.tail"));var addNode=behavior.addNode;behavior.addNode=function(node){if(node.id===headId||node.id===tailId){behavior.finish()}else{addNode(node)}};context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};mode.selectedIDs=function(){return[wayId]};return mode};;;iD.modes.DrawLine=function(context,wayId,baseGraph,affix,linetype){var mode={button:"line",id:"draw-line",type:linetype,drawroad:linetype};var behavior;mode.enter=function(){var way=context.entity(wayId),index="prefix"===affix?0:undefined,headId="prefix"===affix?way.first():way.last();behavior=iD.behavior.DrawWay(context,wayId,index,mode,baseGraph,linetype).tail(t("modes.draw_line.tail"));var addNode=behavior.addNode;behavior.addNode=function(node){if(node.id===headId){behavior.finish()}else{addNode(node)}};context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};mode.selectedIDs=function(){return[wayId]};return mode};;;iD.modes.DrawFusionDivider=function(context,wayId,baseGraph,affix,linetype){var mode={button:"divider",id:"draw-fusion-divider",type:linetype,drawroad:linetype};var behavior;mode.enter=function(){var way=context.entity(wayId),index="prefix"===affix?0:undefined,headId="prefix"===affix?way.first():way.last();behavior=iD.behavior.DrawFusionDivider(context,wayId,index,mode,baseGraph,linetype).tail(t("modes.draw_fusion_divider.tail"));var addNode=behavior.addNode;behavior.addNode=function(node){if(node.id===headId){behavior.finish()}else{addNode(node)}};context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};mode.selectedIDs=function(){return[wayId]};return mode};;;iD.modes.DrawDivider=function(context,wayId,baseGraph,affix,linetype){var mode={button:"divider",id:"draw-divider",type:linetype,drawroad:linetype};var behavior;mode.enter=function(){var way=context.entity(wayId),index="prefix"===affix?0:undefined,headId="prefix"===affix?way.first():way.last();behavior=iD.behavior.DrawDivider(context,wayId,index,mode,baseGraph,linetype).tail(t("modes.draw_divider.tail"));var addNode=behavior.addNode;behavior.addNode=function(node){if(node.id===headId){behavior.finish()}else{addNode(node)}};context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};mode.selectedIDs=function(){return[wayId]};return mode};;;iD.modes.DrawCutDivider=function(context,wayId,baseGraph,affix,linetype){var mode={id:"draw-cut-divider",button:"cutDivider",type:linetype,drawroad:linetype};var event=d3.dispatch("finish");var behavior;mode.enter=function(){var way=context.entity(wayId),index="prefix"===affix?0:undefined,headId="prefix"===affix?way.first():way.last();behavior=iD.behavior.DrawCutDivider(context,wayId,index,mode,baseGraph).tail(t("modes.draw_divider.tail"));var finishSplitLine=behavior.finishSplitLine;behavior.finishSplitLine=function(){finishSplitLine();context.event.entityedite({mode:mode,entitys:[]})};context.install(behavior)};function checkWayLength(wayId,behavior){var way=context.entity(wayId);if(way.nodes&&2==way.nodes.length){behavior.finish();return}}mode.exit=function(){context.uninstall(behavior)};mode.selectedIDs=function(){return[wayId]};return d3.rebind(mode,event,"on")};;;iD.modes.Move=function(context,entityIDs){var mode={id:"move",button:"browse"};var keybinding=d3.keybinding("move"),edit=iD.behavior.Edit(context),annotation=1===entityIDs.length?t("operations.move.annotation."+context.geometry(entityIDs[0])):t("operations.move.annotation.multiple"),origin,nudgeInterval;var wEnterAndRoadObj;function edge(point,size){var pad=[30,100,30,100];if(point[0]>size[0]-pad[0])return[-10,0];else if(point[0]<pad[2])return[10,0];else if(point[1]>size[1]-pad[1])return[0,-10];else if(point[1]<pad[3])return[0,10];return null}function startNudge(nudge){if(nudgeInterval)window.clearInterval(nudgeInterval);nudgeInterval=window.setInterval(function(){context.pan(nudge);context.replace(iD.actions.Move(entityIDs,[-nudge[0],-nudge[1]],context.projection),annotation);var c=context.projection(origin);origin=context.projection.invert([c[0]-nudge[0],c[1]-nudge[1]])},50)}function stopNudge(){if(nudgeInterval)window.clearInterval(nudgeInterval);nudgeInterval=null}function start(){var entitys=[];entityIDs.forEach(function(entityID){entitys.push(context.graph().entity(entityID))});var moveNodes=[];entitys.forEach(function(singleEntity){if("way"==singleEntity.type){var fNode=context.graph().entity(singleEntity.first());var tNode=context.graph().entity(singleEntity.last());if(-1==moveNodes.indexOf(fNode)){moveNodes.push(fNode)}if(-1==moveNodes.indexOf(tNode)){moveNodes.push(tNode)}}});var modifyWays=[];var modifyWayFlag={};moveNodes.forEach(function(node){context.graph().parentWays(node).forEach(function(way){if(!way.isOneRoadCrossWay()&&!modifyWayFlag[way.id]){modifyWays.push(way);modifyWayFlag[way.id]=true}})});wEnterAndRoadObj=iD.util.walkExtend().getObjForWEnterAndRoad(modifyWays,context.graph())}function move(){var p=context.mouse();var delta=origin?[p[0]-context.projection(origin)[0],p[1]-context.projection(origin)[1]]:[0,0];var nudge=edge(p,context.map().dimensions());if(nudge)startNudge(nudge);else stopNudge();origin=context.map().mouseCoordinates();context.replace(iD.actions.Move(entityIDs,delta,context.projection),annotation)}function available(moveNodes){function isMoveCrossNode(node){var rc;var flag=false;context.graph().parentRelations(node).forEach(function(rel){if(rel.tags&&rel.modelName==iD.data.Constant.C_NODE){rc=rel}});if(rc&&rc.tags.mesh!=context.entity(node.id).tags.mesh){return false}return true}for(var i=0;i<moveNodes.length;i++){var flag=isMoveCrossNode(moveNodes[i]);if(!flag){return false}}return true}function finish(){d3.event.stopPropagation();context.enter(iD.modes.Select(context,entityIDs).suppressMenu(true));stopNudge();var entity=[];entityIDs.forEach(function(entityID){entity.push(context.graph().entity(entityID))});var taskData=iD.Task.working;if("2"==taskData.task_classes){entity.forEach(function(singleEntity){if(singleEntity instanceof iD.Way){singleEntity=singleEntity.mergeTags({pro_id:taskData.basic_id});context.replace(iD.actions.AddEntity(singleEntity),annotation);var fNode=context.graph().entity(singleEntity.nodes[0]);var tNode=context.graph().entity(singleEntity.nodes[singleEntity.nodes.length-1]);var fParentWays=context.graph().parentWays(fNode);var tParentWays=context.graph().parentWays(tNode);var parentWays=[];var wayIndex;fParentWays.forEach(function(fWay){-1==parentWays.indexOf(fWay)&&parentWays.push(fWay)});tParentWays.forEach(function(tWay){if(-1==parentWays.indexOf(tWay)){parentWays.push(tWay)}else{wayIndex=parentWays.indexOf(tWay)}});if(wayIndex!=undefined)parentWays.splice(wayIndex,1);parentWays.forEach(function(way){way=way.mergeTags({pro_id:taskData.basic_id});context.replace(iD.actions.AddEntity(way),annotation)})}})}var moveNodes=[];entity.forEach(function(singleEntity){if("way"==singleEntity.type){var fNode=context.graph().entity(singleEntity.first());var tNode=context.graph().entity(singleEntity.last());if(-1==moveNodes.indexOf(fNode)){moveNodes.push(fNode)}if(-1==moveNodes.indexOf(tNode)){moveNodes.push(tNode)}}});var modifyWays=[];var modifyWayFlag={};moveNodes.forEach(function(node){context.replace(iD.actions.UpdateNode(context,node.id),annotation)});if(!available(moveNodes)){Dialog.alert("\u79FB\u52A8\u9053\u8DEF\u5173\u8054\u7EFC\u5408\u4EA4\u53C9\u70B9,\u65E0\u6CD5\u8DE8\u56FE\u5E45\u79FB\u52A8\u9053\u8DEF!",function(){context.pop();context.enter(iD.modes.Browse(context))});return}var isOutTansactionExtent=false;for(var i=0;i<entityIDs.length;i++){let way=context.entity(entityIDs[i]);for(let j=0;j<way.nodes.length;j++){let datum=context.entity(way.nodes[j]);if(iD.util.pointNotInPlyGonx(datum.loc,context)){isOutTansactionExtent=true;break}}}if(true==isOutTansactionExtent){Dialog.alert("\u5DF2\u51FA\u5BF9\u8C61\u8FB9\u754C",callback);context.pop()}moveNodes.forEach(function(node){context.graph().parentWays(node).forEach(function(way){if(!way.isOneRoadCrossWay()&&!modifyWayFlag[way.id]){modifyWays.push(way);modifyWayFlag[way.id]=true}})});modifyWays.forEach(function(way){way=iD.util.tagExtend.updateWayLengthTag(context.graph(),way);context.replace(iD.actions.AddEntity(way),annotation)});context.event["entityedite"]&&context.event["entityedite"]({entitys:entity});_.uniq(entityIDs).forEach(function(id){var entity=context.graph().entity(id)})}function callback(){context.history().undo();context.enter(iD.modes.Browse(context))};function cancel(){context.pop();context.enter(iD.modes.Select(context,entityIDs).suppressMenu(true));stopNudge()}function undone(){context.enter(iD.modes.Browse(context))}mode.enter=function(){context.install(edit);context.perform(iD.actions.Noop(),annotation);start();context.surface().on("mousemove.move",move).on("click.move",finish);context.history().on("undone.move",undone);keybinding.on("\u238B",cancel).on("\u21A9",finish);d3.select(document).call(keybinding)};mode.exit=function(){stopNudge();context.uninstall(edit);context.surface().on("mousemove.move",null).on("click.move",null);context.history().on("undone.move",null);keybinding.off()};return mode};iD.modes.NewMove=function(context,entityIDs){var mode={id:"move",button:"browse"};var keybinding=d3.keybinding("move"),edit=iD.behavior.Edit(context),annotation=1===entityIDs.length?t("operations.move.annotation.multiple"):t("operations.move.annotation.multiple"),origin,nudgeInterval;context.event["dragstart"]&&context.event["dragstart"]({overlay:entityIDs});function edge(point,size){var pad=[30,100,30,100];if(point[0]>size[0]-pad[0])return[-10,0];else if(point[0]<pad[2])return[10,0];else if(point[1]>size[1]-pad[1])return[0,-10];else if(point[1]<pad[3])return[0,10];return null}function startNudge(nudge){console.log("s");if(nudgeInterval)window.clearInterval(nudgeInterval);nudgeInterval=window.setInterval(function(){context.pan(nudge);iD.actions.NewMove(entityIDs,[-nudge[0],-nudge[1]],context.projection).call();context.map().drawOverlayers();var c=context.projection(origin);origin=context.projection.invert([c[0]-nudge[0],c[1]-nudge[1]])},50)}function stopNudge(){if(nudgeInterval)window.clearInterval(nudgeInterval);nudgeInterval=null}function move(){var p=context.mouse();var delta=origin?[p[0]-context.projection(origin)[0],p[1]-context.projection(origin)[1]]:[0,0];var nudge=edge(p,context.map().dimensions());if(nudge)startNudge(nudge);else stopNudge();origin=context.map().mouseCoordinates();iD.actions.NewMove(entityIDs,delta,context.projection).call();context.event["draging"]&&context.event["draging"]({overlay:entityIDs});context.map().drawOverlayers()}function finish(){context.event["dragend"]&&context.event["dragend"]({overlay:entityIDs});d3.event.stopPropagation();context.enter(iD.modes.Browse(context));stopNudge()}function cancel(){context.pop();stopNudge()}function undone(){context.enter(iD.modes.Browse(context))}mode.enter=function(){context.install(edit);context.surface().on("mousemove.move",move).on("click.move",finish);context.history().on("undone.move",undone);keybinding.on("\u238B",cancel).on("\u21A9",finish);d3.select(document).call(keybinding)};mode.exit=function(){stopNudge();context.uninstall(edit);context.surface().on("mousemove.move",null).on("click.move",null);context.history().on("undone.move",null);keybinding.off()};return mode};;;iD.modes.RotateWay=function(context,wayId){var mode={id:"rotate-way",button:"browse"};var keybinding=d3.keybinding("rotate-way"),edit=iD.behavior.Edit(context);mode.enter=function(){context.install(edit);var annotation=t("operations.rotate.annotation."+context.geometry(wayId)),way=context.graph().entity(wayId),nodes=_.uniq(context.graph().childNodes(way)),points=nodes.map(function(n){return context.projection(n.loc)}),pivot=d3.geom.polygon(points).centroid(),angle;var isdown=ismove=isup=false;context.perform(iD.actions.Noop(),annotation);function rotate(){if((isdown||ismove)&&!isup){isdown=false;ismove=true;points=nodes.map(function(n){return context.projection(n.loc)});pivot=d3.geom.polygon(points).centroid()}var mousePoint=context.mouse(),newAngle=Math.atan2(mousePoint[1]-pivot[1],mousePoint[0]-pivot[0]);if("undefined"===typeof angle)angle=newAngle;context.replace(iD.actions.RotateWay(wayId,pivot,newAngle-angle,context.projection),annotation);angle=newAngle;var player=iD.picUtil.player;if(player&&player.resetPointToPicPlayer){player.resetPointToPicPlayer(_.uniq([way.id].concat(way.nodes)))}}function finish(){isup=true;d3.event.stopPropagation();context.enter(iD.modes.Select(context,[wayId]).suppressMenu(true));context.event.entityedite({mode:mode,entitys:[wayId]});var player=iD.picUtil.player;var way=context.hasEntity(wayId);if(player&&way&&way.modelName==iD.data.DataType.OBJECT_PG){var mAdds=[],actions=[];for(var nid of way.nodes){let node=context.entity(nid);let point=player.ZEUtil.getShapesByEid(nid)[0];let xy=[];if(point){xy=[point.shape.cx,point.shape.cy]}else{let picData=iD.AutoMatch.locsToPicPlayer([node.loc],player)[0];xy=picData.coordinates[0]}mAdds.push({node:node,xy:xy})}for(let item of mAdds){let xy=player.reductionPoint(item.xy);actions.push(iD.picUtil.measureinfoAction(item.node,{trackPointId:player.allNodes[player.selectPicIndex].tags.trackPointId,imgOffset:{x:xy[0],y:xy[1]}}))}context.replace.apply(context,actions.concat(annotation))}}function cancel(){context.pop();context.enter(iD.modes.Select(context,[wayId]).suppressMenu(true))}function undone(){context.enter(iD.modes.Browse(context))}function mousedown(){isdown=true}context.surface().on("mousedown.rotate-way",mousedown).on("mousemove.rotate-way",rotate).on("click.rotate-way",finish);context.history().on("undone.rotate-way",undone);keybinding.on("\u238B",cancel).on("\u21A9",finish);d3.select(document).call(keybinding)};mode.exit=function(){context.uninstall(edit);context.surface().on("mousedown.rotate-way",null).on("mousemove.rotate-way",null).on("click.rotate-way",null);context.history().on("undone.rotate-way",null);keybinding.off()};return mode};;;iD.modes.Save=function(context,indexFlag,callback,errorCallback){function getCrossMeshWays(changes,context){var graph=context.graph();var currLayer=context.layers().getLayer();if(!currLayer||!currLayer.isRoad())return[];if(currLayer.split){var pWays=[],filer={};var created=[].concat(changes["created"]),modified=[].concat(changes["modified"]),deleted=[].concat(changes["deleted"]);created=created.filter(function(v){if("line"===v.geometry(graph))return true;return false});modified.forEach(function(v){if("vertex"===v.geometry(graph)&&!MapSheet.isPointOnRectSide(v.loc,context)){graph.parentWays(v).forEach(function(mp){!filer[mp.id]&&pWays.push(mp);filer[mp.id]=true})}});var wanted=created.concat(pWays);function unique(arr){var result=[],hash={};for(var i=0,elem;i<arr.length&&null!=(elem=arr[i].id);i++){if(!hash[elem]){result.push(arr[i]);hash[elem]=true}}return result}wanted=unique(wanted);wanted=wanted.filter(function(want){if(want.isOneRoadCrossWay())return false;var focusArr=[];var focusPoints=[];var fNode=graph.entity(want.first());var tNode=graph.entity(want.last());for(var l=want.nodes.length,i=0;i<l-1;i++){var p1=graph.entity(want.nodes[i]).loc,p2=graph.entity(want.nodes[i+1]).loc,p12=p1.concat(p2);var tmpFocusPoints=MapSheet.getFocusPoints(undefined,p12,context);focusPoints=focusPoints.concat(tmpFocusPoints)}for(var i=0;i<focusPoints.length;i++){var fDistance=iD.util.lassExtend.getDistance({lon:fNode.loc[0],lat:fNode.loc[1]},{lon:focusPoints[i][0],lat:focusPoints[i][1]});var tDistance=iD.util.lassExtend.getDistance({lon:tNode.loc[0],lat:tNode.loc[1]},{lon:focusPoints[i][0],lat:focusPoints[i][1]});if(1<fDistance&&1<tDistance){focusArr.push(focusPoints[i])}}if(0<focusArr.length){return true}return false});wanted=wanted.filter(function(want){var fNode=graph.entity(want.first());var tNode=graph.entity(want.last());if(2==want.nodes.length&&(fNode.tags&&"20"==fNode.tags.boundary||tNode.tags&&"20"==tNode.tags.boundary)){return false}return true});return wanted}return[]}function splitCrossMeshWay(way,context){var graph=context.graph();var currLayer=context.layers().getLayer(way.layerId);var fNode=context.entity(way.first());var tNode=context.entity(way.last());var focusPoints=[];for(var l=way.nodes.length,i=0;i<l-1;i++){var p1=graph.entity(way.nodes[i]).loc,p2=graph.entity(way.nodes[i+1]).loc,p12=p1.concat(p2);var tmpFocusPoints=MapSheet.getFocusPoints(undefined,p12,context);focusPoints=focusPoints.concat(tmpFocusPoints)}var focusArr=[];for(var i=0;i<focusPoints.length;i++){var fDistance=iD.util.lassExtend.getDistance({lon:fNode.loc[0],lat:fNode.loc[1]},{lon:focusPoints[i][0],lat:focusPoints[i][1]});var tDistance=iD.util.lassExtend.getDistance({lon:tNode.loc[0],lat:tNode.loc[1]},{lon:focusPoints[i][0],lat:focusPoints[i][1]});if(1<fDistance&&1<tDistance){focusArr.push(focusPoints[i])}}if(0==focusArr.length){return}var loc=focusArr[0];var choice=iD.geo.chooseEdge(graph.childNodes(way),context.projection(loc),context.projection),edge=[way.nodes[choice.index-1],way.nodes[choice.index]];var node=iD.Node({layerId:currLayer.id,loc:loc});var annotation=t("operations.split.annotation.road");context.replace(iD.actions.AddMidpoint({loc:loc,edge:edge},node),iD.actions.SplitRoad([node.id],context),annotation)}function processCrossMeshWays(context){var changes=context.history().changes(iD.actions.DiscardTags(context.history().difference()));var wanted=getCrossMeshWays(changes,context);if(1>wanted.length){return}else{wanted.forEach(function(way){splitCrossMeshWay(way,context)})}processCrossMeshWays(context)}function updateVerifyOfChanges(changes){return function(graph){var created=[].concat(changes["created"]),modified=[].concat(changes["modified"]),deleted=[].concat(changes["deleted"]);created.forEach(function(cEntity){cEntity=iD.util.tagExtend.updateVerifyTag(cEntity);graph=graph.replace(cEntity)});modified.forEach(function(mEntity){mEntity=iD.util.tagExtend.updateVerifyTag(mEntity);graph=graph.replace(mEntity)});return graph}}function deal(changes){context.perform(iD.actions.Noop(),"cross mesh ways");processCrossMeshWays(context);var newChanges=context.history().changes(iD.actions.DiscardTags(context.history().difference()));context.replace(updateVerifyOfChanges(newChanges));var newChanges=context.history().changes(iD.actions.DiscardTags(context.history().difference()));var actions=[iD.actions.ProcessInherit(changes),iD.actions.ProcessMesh(changes),"test"];context.replace.apply(this,actions);context.replace(iD.actions.ProcessInherit(newChanges));newChanges=context.history().changes(iD.actions.DiscardTags(context.history().difference()));context.replace(iD.actions.ProcessMesh(newChanges))}function cancel(){if(indexFlag&&"layermanager"===indexFlag){context.flush()}context.enter(iD.modes.Browse(context))}var fieldRequiredValidate={[iD.data.DataType.IMAGE_TAG]:function(entity){var modelEntity=iD.ModelEntitys[iD.data.DataType.IMAGE_TAG];if(!modelEntity){return}var fieldNames=_.toArray(arguments);fieldNames.slice(0,1);if(!fieldNames.length){return}var errMsg=[];for(let d of modelEntity.getFields(modelEntity.getGeoType())){if(!fieldNames.includes(d.fieldName)){continue}if(1==d.fieldInputFilter){var fieldVal=entity.tags[d.fieldName];if(null==fieldVal||""==fieldVal){errMsg.push((d.fieldTitle||d.fieldName)+" \u4E0D\u80FD\u4E3A\u7A7A\u503C");continue}}}if(errMsg.length){return errMsg}return true}};function validateEntityField(entity){var validate=fieldRequiredValidate[entity.modelName];var result,obj={validate:true,errMsg:[]};if(validate){result=validate(entity,"DATATYPE","ERRORTYPE")}if(_.isArray(result)){obj.validate=false;obj.errMsg=result}else if(result==undefined||true==result){obj.validate=true}else{obj.validate=false}return obj}function updateEntity2Relation(){var changes=context.history().changes();var created=[],modified=[],deleted=[],filter={};var validate=iD.ModelEntitys[iD.data.DataType.IMAGE_TAG];for(var type in changes){var entities=changes[type];for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.modelName==iD.data.DataType.IMAGE_TAG){var valid=validateEntityField(entity);if(!valid.validate){Dialog.alert("\u56FE\u50CF\u6807\u8BB0: "+iD.Entity.id.toOSM(entity.id)+" \u5B57\u6BB5\u9A8C\u8BC1\u9519\u8BEF\uFF1A<br/>"+valid.errMsg.join("<br/>"));return false}}if(entities[i].isOneRoadCrossWay&&entities[i].isOneRoadCrossWay()){entities.splice(i,1);i--}}}context.event.savestart(changes);return changes}function filterModelNameList(list){var arr=[];list.forEach(function(d){if(!d.modelName)return;let mname=(""+d.modelName).toLowerCase();if("undefined"==mname||"null"==mname)return;arr.push(d)});return arr}function save(changes){var savedDataList=context.intersects(iD.geo.Extent([-Infinity,-Infinity],[Infinity,Infinity]));var dividers=_.filter(savedDataList,d=>d.modelName==iD.data.DataType.DIVIDER);changes=_.clone(changes);changes.created=filterModelNameList(changes.created);changes.deleted=filterModelNameList(changes.deleted);changes.modified=filterModelNameList(changes.modified);if(0==changes.created.length&&0==changes.deleted.length&&0==changes.modified.length){Dialog.alert("\u6570\u636E\u4E2D\u4E0D\u5B58\u5728\u6709\u6548\u7684modelName\u3002",null,null,null,null,{AutoClose:3});return}iD.Adas.resertAdasRoads();var loading=iD.ui.Loading(context).message(t("save.uploading")).blocking(true);context.container().call(loading);iD.modes.Save.savingLock++;context.connection().putChangeset(changes,"",context.history().imageryUsed(),function(err,data){loading.close();if(err){iD.modes.Save.savingLock++;if("timeout"===err.errorType){Dialog.alert("\u8BF7\u6C42\u6570\u636E\u5E93(KDS)\u65E0\u54CD\u5E94")}else if("KDS"==err.errorType){Dialog.alert(err.message)}else{Dialog.alert("\u6570\u636E\u5E93(KDS)\u4FDD\u5B58\u51FA\u9519")}errorCallback&&errorCallback()}else{iD.modes.Save.savingLock=0;context.flush();pic&&pic.clearMark();callback&&callback()}})}function canSave(changes){if(!changes)return false;var changed=false;_.each(changes,function(vals=[]){if(vals.length)changed=true});if(!changed){return false}if(!iD.ui.TagEditor.autocheck.road(context,changes)){return false}var created=[].concat(changes["created"]),modified=[].concat(changes["modified"]),deleted=[].concat(changes["deleted"]);var all=created.concat(modified);var errMsg=[];var checkDate=iD.util.dataValidate.checkNodeAndWayValidate(all,context);errMsg=checkDate.errMsg;if(0<errMsg.length){Dialog.alert(errMsg[0],function(){},"\u9053\u8DEF/\u6B65\u5BFC\u7EBF\u7ED3\u70B9\u9519\u8BEF");return false}errMsg=iD.util.dataValidate.checkCrossAndWayValidate(checkDate.wayArr,checkDate.roadCrossArr,checkDate.walkEnterArr,context);if(0<errMsg.length){Dialog.alert(errMsg[0],function(){},"\u62D3\u8865\u5173\u7CFB\u9519\u8BEF");return false}return true}function success(e,changeset_id){}var mode={id:"save"};var behaviors=[iD.behavior.Hover(context),iD.behavior.Select(context),iD.behavior.Lasso(context),iD.modes.DragNode(context).behavior];function saveConfirm(tip){var b=true;Dialog.confirm(tip,function(){save();b=true},function(){b=false;cancel()});return b}mode.enter=function(){behaviors.forEach(function(behavior){context.install(behavior)});var changes=updateEntity2Relation();if(changes&&canSave(changes)){save(changes);if(context.variable.autoSaveTime){window.clearInterval(context.variable.autoSaveTime);context.variable.autoSaveTime=null;context.variable.autoSaveTime=window.setInterval(context.autoSave,900000)}}else{}context.enter(iD.modes.Browse(context))};mode.exit=function(){behaviors.forEach(function(behavior){context.uninstall(behavior)})};return mode};iD.modes.Save.savingLock=0;iD.modes.Save.isSaving=function(){return 0!==iD.modes.Save.savingLock};;;iD.modes.AddRoadCross=function(context){var mode={id:"add-roadcross",button:"roadcross",title:t("modes.add_roadcross.title"),description:t("modes.add_roadcross.description"),key:"5"};var behavior=iD.behavior.Draw(context).tail(t("modes.add_roadcross.tail")).on("click",add).on("clickWay",addWay).on("clickNode",addNode).on("cancel",cancel).on("finish",cancel);function add(loc){var layer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.C_NODE),layerId=layer.id;var node=iD.Node({_type:"roadcross",members:[],modelName:iD.data.Constant.C_NODE,loc:loc,layerId:layerId});node.setTags(iD.util.getDefauteTags(node,layer));context.perform(iD.actions.AddEntity(node),t("operations.add.annotation.point"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:"roadcross",entity:node})}function addWay(loc){add(loc)}function addNode(node){add(node.loc)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){d3.select(".add-road").classed("active",false);d3.select("."+this.id).classed("active",true);context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddSpeedCamera=function(context){var mode={id:"add-speedcamera",button:"speedcamera",title:t("modes.add_speedcamera.title"),description:t("modes.add_speedcamera.description"),key:"6"};var behavior=iD.behavior.Draw(context).tail(t("modes.add_speedcamera.tail")).on("click",add).on("clickWay",addWay).on("clickNode",addNode).on("cancel",cancel).on("finish",cancel);function add(loc){var layer=iD.Layers.getLayer(),layerId=layer.id;var node=iD.Node({_type:"speedcamera",members:[],modelName:"SpeedCamera",loc:loc,layerId:layerId});context.perform(iD.actions.AddEntity(node),t("operations.add.annotation.point"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:"speedcamera",entity:node});if(layer.continues)context.enter(iD.modes.AddSpeedCamera(context))}function addWay(loc){add(loc)}function addNode(node){add(node.loc)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){d3.select(".add-road").classed("active",false);d3.select("."+this.id).classed("active",true);context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddZlevel=function(context){var mode={id:"add-zlevel",button:"zlevel",title:t("modes.add_zlevel.title"),description:t("modes.add_zlevel.description"),key:"7"};var behavior=iD.behavior.Draw(context).tail(t("modes.add_zlevel.tail")).on("click",add).on("clickWay",addWay).on("clickNode",addNode).on("cancel",cancel).on("finish",cancel);function add(loc){var layer=iD.Layers.getLayer(),layerId=layer.id;var node=iD.Node({_type:"zlevel",members:[],modelName:"ZLevel",loc:loc,layerId:layerId});context.perform(iD.actions.AddEntity(node),t("operations.add.annotation.point"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:"zlevel",entity:node});if(layer.continues)context.enter(iD.modes.AddZlevel(context))}function addWay(loc){add(loc)}function addNode(node){add(node.loc)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){d3.select(".add-zlevel").classed("active",false);d3.select("."+this.id).classed("active",true);context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddWalkroad=function(context){var mode={id:"add-walkroad",button:"walkroad",title:t("modes.add_walkroad.description"),description:t("modes.add_walkroad.description"),key:"Ctrl+W",enable:true};var constant=iD.data.DataType;var newWayId;var highLightIds=context.selectedIDs();function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",flag)}context.map().on("drawn.select",selectElements);var behavior=iD.behavior.AddWay(context).tail(t("modes.add_line.tail")).on("start",start).on("startFromWay",startFromWay).on("startFromNode",startFromNode);function start(loc,flag,originalNode){var currLayer=context.layers().getLayer();var graph=context.graph(),node=iD.Node({layerId:currLayer.id,loc:loc}),way=iD.Way({layerId:currLayer.id});way.setTags(iD.util.getDefauteTags(way));way.tags.isnewwalklink="true";context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id));context.event.add({type:"road",entity:way});newWayId=way.id;context.enter(iD.modes.DrawLine(context,way.id,graph,"","walkroad"))}function startFromWay(loc,edge,originalEntity){var currLayer=context.layers().getLayer();var graph=context.graph(),node=iD.Node({layerId:currLayer.id,loc:loc}),way=iD.Way({layerId:currLayer.id});way.setTags(iD.util.getDefauteTags(way));way.tags.isnewwalklink="true";var args=[iD.actions.AddMidpoint({loc:loc,edge:edge},node),iD.util.SplitRoadRule([node.id],context,iD.walkRoadFlag.WALKROAD,originalEntity),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id)];context.perform.apply(this,args);newWayId=way.id;context.enter(iD.modes.DrawLine(context,way.id,graph,"","walkroad"))}function startFromNode(node){if(node.modelName==iD.data.DataType.ROADNODE||node.modelName==iD.data.DataType.HIGHWAY){start(node.loc,constant.HIGHWAY,node)}else{var currLayer=context.layers().getLayer();var way=iD.Way({layerId:currLayer.id});way.setTags(iD.util.getDefauteTags(way));way.tags.isnewwalklink="true";var args=[iD.util.SplitRoadRule([node.id],context,iD.walkRoadFlag.WALKROAD,node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id)];context.perform(iD.actions.Noop(),t("modes.add_walkroad.description"));if(node.tags){args.splice(0,1)}else if(node.tags){var newNode=iD.Node({layerId:node.layerId,loc:node.loc});context.replace(iD.actions.AddEntity(newNode),t("modes.add_walkroad.description"));var graph=context.graph();var parentWays=graph.parentWays(node);parentWays.forEach(function(way){var nodesArr=way.nodes;nodesArr.forEach(function(wayNode){if(wayNode==node.id){way=way.removeNode(node.id);context.replace(iD.actions.AddEntity(way),t("modes.add_walkroad.description"))}})});var sIndex=parentWays[0].id;var entityWay=context.graph().entity(sIndex);context.replace(iD.actions.DeleteNode(node.id),t("modes.add_walkroad.description"));var choice=iD.geo.chooseEdge(context.childNodes(entityWay),context.mouse(),context.projection),edge=[entityWay.nodes[choice.index-1],entityWay.nodes[choice.index]];args=[iD.actions.AddMidpoint({loc:newNode.loc,edge:edge},newNode),iD.util.SplitRoadRule([newNode.id],context,iD.walkRoadFlag.WALKROAD,node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,newNode.id)]}context.perform.apply(this,args);newWayId=way.id;context.enter(iD.modes.DrawLine(context,way.id,context.graph(),"","walkroad"))}}mode.enter=function(){var roadcross=d3.select("g.layer.layer-roadcross");roadcross.classed("no-pointer-events",true);var placename=d3.select("g.layer.layer-placename");placename.classed("no-pointer-events",true);context.install(behavior)};mode.exit=function(){context.uninstall(behavior);var roadcross=d3.select("g.layer.layer-roadcross");roadcross.classed("no-pointer-events",false);var placename=d3.select("g.layer.layer-placename");placename.classed("no-pointer-events",false);selectElements(true)};return mode};;;iD.modes.AddWalkArea=function(context){var mode={id:"add-walk-area",button:"walk-area",title:t("modes.add_walk_area.title"),description:t("modes.add_walk_area.description"),key:"Ctrl+l",enable:true};var constant=iD.data.DataType;var highLightIds=context.selectedIDs();function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",flag)}context.map().on("drawn.select",selectElements);var behavior=iD.behavior.AddWay(context).tail(t("modes.add_walk_area.tail")).on("start",start).on("startFromWay",start).on("startFromNode",start);function start(loc){var currLayer=context.layers().getLayer(),areaLayer=context.layers().getSubLayerByName(constant.WALKAREA);var graph=context.graph(),node=iD.Node({loc:loc,layerId:currLayer.id,modelName:constant.WALKAREA}),way=iD.Way({layerId:currLayer.id,tags:{area:""}});way.setTags(iD.util.getDefauteTags(way));way.tags.area="";context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(way),iD.actions.AddVertex(way.id,node.id),iD.actions.AddVertex(way.id,node.id));context.event.add({type:"area",entity:way});context.enter(iD.modes.DrawArea(context,way.id,graph,"walk-area"))}mode.enter=function(){context.install(behavior)};mode.exit=function(){selectElements(true);context.uninstall(behavior)};return mode};;;iD.modes.DisconnectRoad=function(context){var mode={id:"disconnect-road",button:"disconnect",title:"",description:t("modes.disconnect-road.description"),key:"8"};var origSelectedId=context.selectedIDs();function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(origSelectedId,context.graph())).classed("selected",flag)}context.map().on("drawn.select",selectElements);var behavior=iD.behavior.AddWay(context).tail(t("modes.disconnect-road.tail")).on("startFromWay",startFromWay).on("startFromNode",startFromNode);function startFromWay(loc,edge,datum){var currLayer=context.layers().getLayer(datum.layerId);if(currLayer&&currLayer.isRoad()){var node=iD.Node({layerId:currLayer.id,loc:loc});var graph=context.graph().replace(node.move(loc));var newSelectedWay=_.intersection(graph.parentWays(graph.entity(edge[0])),graph.parentWays(graph.entity(edge[1])));var newSelectedId=newSelectedWay[0].id;if(newSelectedId==origSelectedId){var annotation=t("operations.split.annotation.road");context.perform(iD.actions.AddMidpoint({loc:loc,edge:edge},node),iD.actions.SplitRoad([node.id],context),annotation);context.enter(iD.modes.Browse(context))}else{Dialog.alert("\u8BF7\u5728\u9009\u4E2D\u7684\u9053\u8DEF\u4E0A\u8FDB\u884C\u6253\u65AD\uFF01\uFF01");selectElements(false);context.enter(iD.modes.Browse(context))}}}function startFromNode(datum){var currLayer=context.layers().getLayer(datum.layerId);if(currLayer&&currLayer.isRoad()&&(datum.modelName==iD.data.DataType.WALKLINK||datum.modelName==iD.data.DataType.HIGHWAY)){var parentWays=context.graph().parentWays(datum);if(1==parentWays.length){if(parentWays[0].id==origSelectedId){var way=parentWays[0];var index=way.nodes.indexOf(datum.id);var node=iD.Node({layerId:currLayer.id,loc:datum.loc});var annotation=t("operations.split.annotation.road");var loc=datum.loc;var edge=[way.nodes[index-1],way.nodes[index]];context.perform(iD.actions.AddMidpoint({loc:loc,edge:edge},node),iD.actions.DeleteMultiple([datum.id]),iD.actions.SplitRoad([node.id],context),annotation);context.enter(iD.modes.Browse(context))}else{Dialog.alert("\u8BF7\u5728\u9009\u4E2D\u7684\u9053\u8DEF\u4E0A\u8FDB\u884C\u6253\u65AD\uFF01\uFF01");selectElements(false);context.enter(iD.modes.Browse(context))}}}}mode.enter=function(){selectElements(true);context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.TopoSplit=function(context,selectedIDs){var mode={id:"topo-split",button:"topo_split"},sidebar;var keybinding=d3.keybinding("drawIsland");var fromToNodes=[];var selectedWays;selectedWays=context.selectedIDs()[0];var selectedWaysEntity=context.graph().entity(selectedWays),fromNodeId=selectedWaysEntity.nodes[0],toNodeId=selectedWaysEntity.nodes[selectedWaysEntity.nodes.length-1];fromToNodes=[fromNodeId,toNodeId];function selectElements(flag){context.surface().selectAll(iD.util.entityOrMemberSelector(fromToNodes,context.graph())).classed("selected",flag)}context.map().on("drawn.select",selectElements);function cancel(){d3.event.preventDefault();context.enter(iD.modes.Browse(context))}function origin(entity){console.error(entity);return context.projection(entity.loc)}var behavior=iD.modes.DragNode(context,selectedWays).behavior;mode.enter=function(){context.variable.firstInTopo=true;selectElements(true);keybinding.on("\u238B",cancel);d3.select(document).call(keybinding);context.install(behavior)};function selectSingleNodeElements(singleNode){context.surface().selectAll(iD.util.entityOrMemberSelector(singleNode,context.graph())).classed("selected",true)}mode.exit=function(){selectElements(false);if(true==context.variable.singleNodeByTopoSplit&&null!=context.variable.singleNode){var singleNode=[context.variable.singleNode];Dialog.alert(iD.alert.tip.operation_create_fake_node_in_crossnode,function(){selectSingleNodeElements(singleNode)});context.variable.singleNodeByTopoSplit=false;context.variable.singleNode=null}context.variable.firstInTopo=null;context.uninstall(behavior)};mode.sidebar=function(_){if(!arguments.length)return sidebar;sidebar=_;return mode};mode.selectedIDs=function(){return selectedIDs};return mode};;;iD.modes.AddIsland=function(context,highLightIds){var mode={id:"add-island",button:"island",title:"",description:t("modes.add_island.description"),key:"Ctrl+M",enable:true};function selectElements(){context.surface().selectAll(iD.util.entityOrMemberSelector(highLightIds,context.graph())).classed("selected",true)}var behavior=iD.behavior.drawIsland(context);mode.enter=function(){var sf=context.surface();sf.on("dblclick.select",null).selectAll(".selected").classed("selected",false);context.map().on("drawn.select",null);context.install(behavior)};mode.exit=function(){if("undefined"!=typeof highLightIds&&""!=highLightIds){context.map().on("drawn.select",selectElements);selectElements()}context.uninstall(behavior)};return mode};;;iD.modes.AddPlacename=function(context){var mode={id:"add-placename",button:"placename",title:t("modes.add_placename.title"),description:t("modes.add_placename.description"),key:"Ctrl+B",enable:true};var behavior=iD.behavior.DrawPlacename(context).tail(t("modes.add_placename.tail")).on("clickWay",addWay).on("cancel",cancel).on("finish",cancel);function add(loc,datum){var layer=iD.Layers.getLayer(),layerId=layer.id;var chnName;if(datum.modelName==iD.data.DataType.HIGHWAY){chnName=datum.tags.name_chn}var node=iD.Node({_type:"placename",modelName:iD.data.DataType.PLACENAME,tags:{name_chn:chnName,x_coord:loc[0].toString(),y_coord:loc[1].toString()},loc:loc,layerId:layerId});context.perform(iD.actions.AddEntity(node),t("modes.add_placename.annotation"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:"placename",entity:node});if(layer.continues)context.enter(iD.modes.Browse(context))}function addWay(loc,datum){add(loc,datum)}function addNode(node){add(node.loc)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddRoadAttribute=function(context){var mode={id:"add-road-attribute",button:"roadAttribute",title:t("modes.add_road_attribute.title"),description:t("modes.add_road_attribute.description"),key:"Ctrl+B",enable:true};var behavior=iD.behavior.DrawRoadAttribute(context).tail(t("modes.add_road_attribute.tail")).on("clickWay",addWay).on("cancel",cancel).on("finish",cancel);function add(loc,datum){var layer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD_ATTRIBUTE);var layerId=layer.id;var node=iD.Node({modelName:iD.data.DataType.ROAD_ATTRIBUTE,loc:loc,layerId:layerId});node.setTags(iD.util.getDefauteTags(node,layer));var members=[{id:node.id,modelName:node.modelName,role:iD.data.RoleType.ROAD_ATTRIBUTE_ID,type:iD.data.GeomType.NODE},{id:datum.id,modelName:datum.modelName,role:iD.data.RoleType.ROAD_ID,type:iD.data.GeomType.WAY}];var raLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_ROAD_RA);var relation=iD.Relation({modelName:iD.data.DataType.R_ROAD_RA,members:members,tags:iD.util.getDefauteTags(iD.data.DataType.R_ROAD_RA,raLayer),layerId:raLayer.id});context.perform(iD.actions.AddEntity(node),iD.actions.AddEntity(relation),t("modes.add_road_attribute.annotation"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:"ROAD_ATTRIBUTE",entity:node});if(layer.continues)context.enter(iD.modes.Browse(context))}function addWay(loc,datum){add(loc,datum)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.AddJunction=function(context){var mode={id:"add-junction",button:"junction",title:t("modes.add_junction.title"),description:t("modes.add_junction.description"),key:"5"};var behavior=iD.behavior.Draw(context).tail(t("modes.add_junction.tail")).on("click",add).on("clickWay",addWay).on("clickNode",addNode).on("cancel",cancel).on("finish",cancel);function add(loc){var layer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.JUNCTION);var layerId=layer.id;var node=iD.Node({members:[],modelName:iD.data.DataType.JUNCTION,loc:loc,layerId:layerId});node.setTags(iD.util.getDefauteTags(node,layer));context.perform(iD.actions.AddEntity(node),t("operations.add.annotation.point"));context.enter(iD.modes.Select(context,[node.id]).suppressMenu(true).newFeature(true));context.event.add({type:"junction",entity:node})}function addWay(loc){add(loc)}function addNode(node){add(node.loc)}function cancel(){context.enter(iD.modes.Browse(context))}mode.enter=function(){d3.select(".add-road").classed("active",false);d3.select("."+this.id).classed("active",true);context.install(behavior)};mode.exit=function(){context.uninstall(behavior)};return mode};;;iD.modes.Select=function(context,selectedIDs,transportation,fromManual){var mode={id:"select",button:"browse"};var keybinding=d3.keybinding("select"),timeout=null,behaviors=[iD.behavior.Hover(context),iD.behavior.Select(context),iD.behavior.Lasso(context),iD.modes.DragNode(context).selectedIDs(selectedIDs).behavior],inspector,radialMenu,newFeature=false,suppressMenu=false;var wrap=context.container().select(".KDSEditor-inspector-wrap");function singular(){if(1===selectedIDs.length){var d=context.hasEntity(selectedIDs[0]);if(!d){selectedIDs=[]}return d}}function positionMenu(pathCenter){if(!radialMenu){return}var isLasso=d3.event&&d3.event._isLasso,posLoc=null;var isFromList=d3.event&&d3.event._isFromList;var clickselect=d3.event&&d3.event._clickselect;var multiEditRoad=d3.event&&d3.event._multiEditRoadProp;var entity=singular();if((isLasso||isFromList||pathCenter)&&!clickselect){if(isLasso&&d3.event._lassoCenter&&!d3.event._lassoReverseSel){posLoc=context.projection(d3.event._lassoCenter)}else if(0<selectedIDs.length){var selExtent=iD.geo.Extent();var posIds=selectedIDs;if(isFromList){var selector=iD.util.entityRelationFooterHighlightSelector(entity,context);var sids=selector.split(",");if(!sids[0])sids=[];if(sids.length){posIds=[]}sids.forEach(function(id){posIds.push(id.replace(".",""))})}_.each(posIds,function(id){selExtent=selExtent.extend(context.entity(id).extent(context.graph()))});posLoc=context.projection(selExtent.center())}}else if(!clickselect&&fromManual){var selExtent=iD.geo.Extent();_.each(selectedIDs,function(id){selExtent=selExtent.extend(context.entity(id).extent(context.graph()))});posLoc=context.projection(selExtent.center())}if(multiEditRoad){var roadExtent=entity.extent(context.graph());posLoc=context.projection(roadExtent.center())}if(entity&&"node"===entity.type){radialMenu.center(context.projection(entity.loc))}else{radialMenu.center(posLoc||context.mouse())}}function showMenu(){if(isDrawCrossWay||!radialMenu)return;context.surface().call(radialMenu.close).call(radialMenu)}function compareMember(members,transportation){var objA={from_road:"",node:"",to_road:""};_(members).each(function(member){objA[member.role]=member.id});var objB={from_road:transportation.fromwayId,node:transportation.nodeId,to_road:transportation.towayId};return _.isEqual(objA,objB)}function relation(){return;if(transportation&&transportation.fromwayId&&transportation instanceof iD.Transportation){if(transportation.editor){context.container().call(iD.ui.RawRelationEditor(context).fromWayId(transportation.fromwayId).nodeId(transportation.nodeId).toWayId(transportation.towayId))}else{var way=context.graph().entity(transportation.fromwayId);var roadcross=context.graph().entity(transportation.nodeId),roadcross=roadcross.modelName===iD.data.Constant.C_NODE;var parentRelations=context.graph().parentRelations(way),mRelations=[],crossOrmaat=false;parentRelations.forEach(function(relation){crossOrmaat=relation.modelName===iD.data.DataType.C_NODECONN||relation.modelName===iD.data.DataType.NODECONN;crossOrmaat&&compareMember(relation.members,transportation)&&mRelations.push(relation)});var maat=mRelations[0]||{};if(!transportation.isOneDay()){var relation=transportation.newRelation({maat:maat,roadcross:roadcross});relation.layerId=way.layerId;relation.tags.mesh=context.entity(transportation.fromwayId).tags.mesh;context.perform(iD.actions.AddEntity(iD.Relation(relation)),t("operations.transportation.add.description"))}else{var relations=context.graph().parentRelations(way);var rules=context.graph().parentRelations(maat);_(transportation.oneDayRelations(rules)).each(function(relation){relation.tags.mesh=context.entity(transportation.fromwayId).tags.mesh;context.perform(iD.actions.EditRelation(context,[],[relation]),t("operations.transportation.delete.description"))})}}}}var isDrawCrossWay=false;function zLevel(){var layers=iD.Layers,layer=layers.getLayer(),ids=context.selectedIDs();if(layer&&layer.isRoad()&&3<=ids.length){var entity=context.graph().entity(ids[0]),way1=context.graph().entity(ids[1]),way2=context.graph().entity(ids[2]);if(entity.isRoadZLevel&&entity.isRoadZLevel()){var scmember=[{type:"Highway",role:"link_up",id:way1.id},{type:"Highway",role:"link_down",id:way2.id}];context.perform(iD.actions.ChangeNodeMember(entity.id,scmember),t("operations.change_members.annotation"));iD.util.storeDottedLoc(entity,way1,entity.id+"-"+way1.id,context.temp().zlevel_locs,context);iD.util.storeDottedLoc(entity,way2,entity.id+"-"+way2.id,context.temp().zlevel_locs,context);isDrawCrossWay=true}}}mode.selectedIDs=function(){return selectedIDs};mode.setSelectedIDs=function(_){if(_){selectedIDs=_}return selectedIDs};mode.closeRadialMenu=function(){if(radialMenu){radialMenu.close();keybinding.off()}};mode.reselect=function(){var surfaceNode=context.surface().node();if(surfaceNode.focus){surfaceNode.focus()}positionMenu();showMenu()};mode.newFeature=function(_){if(!arguments.length)return newFeature;newFeature=_;return mode};mode.suppressMenu=function(_){if(!arguments.length)return suppressMenu;suppressMenu=_;return mode};mode.getLayerId=function(){let layerId;for(let i=0;i<selectedIDs.length;i++){var entityId=selectedIDs[i];var entity=context.entity(entityId);if(!layerId){layerId=entity.layerId}}return layerId};mode.enter=function(){var isFromList=d3.event&&d3.event._isFromList;var outTaskBounds=false;for(var _sid of selectedIDs){var _et=context.entity(_sid);if(!iD.util.entityInPlyGon(_et,context)){outTaskBounds=true}}var $sidebar=d3.select("#KDSEditor-sidebar");var dataMultids=($sidebar.attr("data-multiselectIDs")||"").split(",");if(!dataMultids[0])dataMultids=[];if((isFromList||dataMultids.length)&&1==selectedIDs.length){var mids=($sidebar.attr("data-member-multiselectids")||"").split(",");if(!mids[0])mids=[];if(!_.include(mids,selectedIDs[0])&&!_.include(dataMultids,selectedIDs[0])){$sidebar.attr("data-multiselectIDs",null).attr("data-filterparam",null).attr("data-member-multiselectids",null);if(d3.event){d3.event._isFromList=false}isFromList=false}else{if(d3.event){d3.event._isFromList=true}isFromList=true}}relation();var transp=context.transportation.is(selectedIDs[0]);context.transportation.reset(transp);zLevel();behaviors.forEach(function(behavior){context.install(behavior)});var layerId=this.getLayerId();if(!layerId){selectElements();context.event.selected(_.map(context.selectedIDs(),context.entity));updateFromListDom(isFromList);return false}var cLayer=iD.Layers.getLayer(layerId);var operations=d3.values(iD.operations).map(function(o){return cLayer&&o(selectedIDs,context)}).filter(function(o){if(outTaskBounds)return false;return cLayer&&o.available()});keybinding.on("\u238B",function(){context.enter(iD.modes.Browse(context))},true);operations.forEach(function(operation){operation.keys.forEach(function(key){keybinding.on(key,function(){if(!operation.disabled()){operation()}})})});var _e=singular();context.ui().sidebar.select(_e?_e.id:null,newFeature);context.history().on("undone.select",update).on("redone.select",update);function update(){context.surface().call(radialMenu.close);if(_.any(selectedIDs,function(id){return!context.hasEntity(id)})){context.enter(iD.modes.Browse(context))}}var repositionMenu=function(){if(0<d3.select("g.radial-menu").size()){positionMenu(true)}};context.map().on("moveend.select-rp",repositionMenu);context.map().on("zoom.select-rp",repositionMenu);d3.select(window).on("mousewheel.select-rp",repositionMenu);d3.select("button.zoom-in").on("mousewheel.select-rp",repositionMenu);d3.select("button.zoom-out").on("mousewheel.select-rp",repositionMenu);d3.select(window).on("resize.select-rp",repositionMenu);function dblclick(){if(!("work"==d3.select("body").attr("role")&&iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;var target=d3.select(d3.event.target),datum=target.datum();if(!datum||!iD.Layers.getLayer(datum.layerId).editable){return false}if(datum instanceof iD.Way&&!target.classed("fill")){if(datum.isOneRoadCrossWay()){return false}var firstNode=context.graph().childNodes(datum)[0];if(firstNode.modelName&&context.variable.canNotDrag.includes(firstNode.modelName)){return false}var choice=iD.geo.chooseEdge(context.childNodes(datum),context.mouse(),context.projection),node=iD.Node({layerId:firstNode.layerId,modelName:firstNode.modelName,tags:iD.util.getDefauteTags(firstNode.modelName,iD.Layers.getLayer(firstNode.layerId))});var prev=datum.nodes[choice.index-1],next=datum.nodes[choice.index];context.perform(iD.actions.AddMidpoint({loc:choice.loc,edge:[prev,next]},node),t("operations.add.annotation.vertex"));d3.event.preventDefault();d3.event.stopPropagation()}}d3.select(document).call(keybinding);function selectElements(){var sids;if(!isFromList){sids=iD.util.entityOrMemberSelector(selectedIDs,context.graph())}else{sids=iD.util.entitySelector(selectedIDs)}context.surface().selectAll(sids).classed("selected",true);var slopesIds=[];for(var i=0;i<selectedIDs.length;i++){if(!context.hasEntity(selectedIDs[i])){continue}if(context.entity(selectedIDs[i])instanceof iD.Way&&context.entity(selectedIDs[i]).tags&&context.entity(selectedIDs[i]).modelName==iD.data.DataType.HIGHWAY){var slopes=context.entity(selectedIDs[i]).getSlopes(context.graph());slopes.forEach(function(slope){slopesIds.push(slope.id)})}}if(0<slopesIds.length){context.surface().selectAll(iD.util.entityOrMemberSelector(slopesIds,context.graph())).classed("selected",true)}}context.map().on("drawn.select",selectElements);selectElements();radialMenu=iD.ui.RadialMenu(context,transp?[]:operations);var show=!suppressMenu;if(show){positionMenu()}timeout=window.setTimeout(function(){if(show){showMenu()}context.surface().on("dblclick.select",dblclick);var sIDs=context.selectedIDs();sIDs&&sIDs.forEach(function(id,i){if(!context.graph().hasEntity(id)){sIDs.splice(i,1);context.surface().call(radialMenu.close)}})},200);var selecteds=[];selectedIDs.forEach(function(id){selecteds.push(context.entity(id))});if(1==selectedIDs.length){iD.ui.dispEntity(context,context.graph().entity(selectedIDs[0]));if(isFromList){iD.util.entityRelationFooterHighlightSelector(context.entity(selectedIDs[0]),context,true);if(d3.event){d3.event._isFromList=false}}}else{iD.ui.dispMultiEntity(context,selectedIDs)}context.event.selected(selecteds);updateFromListDom(isFromList)};function updateFromListDom(isFromList){if(1<selectedIDs.length){var entities=iD.ui.SelectionList(context,selectedIDs);d3.select("#KDSEditor-sidebar").attr("data-multiselectIDs",selectedIDs);context.ui().sidebar.show(entities)}else if(!isFromList){d3.select("#KDSEditor-sidebar").attr("data-multiselectIDs",null).attr("data-filterparam",null).attr("data-member-multiselectids",null)}}mode.exit=function(){if(timeout)window.clearTimeout(timeout);if(inspector)wrap.call(inspector.close);behaviors.forEach(function(behavior){context.uninstall(behavior)});keybinding.off();context.history().on("undone.select",null).on("redone.select",null);context.history().on("change.selection-list",null);var sf=context.surface();if(radialMenu)sf.call(radialMenu.close);sf.on("dblclick.select",null).selectAll(".selected").classed("selected",false);context.map().on("drawn.select",null);context.map().on("moveend.select-rp",null);context.map().on("zoom.select-rp",null);d3.select(window).on("mousewheel.select-rp",null);d3.select("button.zoom-in").on("mousewheel.select-rp",null);d3.select("button.zoom-out").on("mousewheel.select-rp",null);d3.select(window).on("resize.selec-rpt",null);context.ui().sidebar.hide()};return mode};iD.modes.NewSelect=function(context,selectedIDs,_){var mode={id:"select",button:"browse"};var keybinding=d3.keybinding("select"),timeout=null,behaviors=[iD.behavior.Hover(context),iD.behavior.Select(context),iD.behavior.Lasso(context),iD.modes.DragNode(context).selectedIDs(selectedIDs).behavior],inspector,radialMenu,newFeature=false,suppressMenu=false;var wrap=context.container().select(".KDSEditor-inspector-wrap");function positionMenu(){radialMenu.center(context.mouse())}function showMenu(){context.surface().call(radialMenu.close).call(radialMenu)}mode.selectedIDs=function(){return selectedIDs};mode.reselect=function(){var surfaceNode=context.surface().node();if(surfaceNode.focus){surfaceNode.focus()}positionMenu();showMenu()};mode.newFeature=function(_){if(!arguments.length)return newFeature;newFeature=_;return mode};mode.suppressMenu=function(_){if(!arguments.length)return suppressMenu;suppressMenu=_;return mode};mode.enter=function(){behaviors.forEach(function(behavior){context.install(behavior)});var operations=d3.values(iD.overoperations).map(function(o){return o(_,context)}).filter(function(o){return o.available()});keybinding.on("\u238B",function(){context.enter(iD.modes.Browse(context))},true);operations.forEach(function(operation){operation.keys.forEach(function(key){keybinding.on(key,function(){if(!operation.disabled()){operation()}})})});context.history().on("undone.select",update).on("redone.select",update);function update(){context.surface().call(radialMenu.close);if(_.any(selectedIDs,function(id){return!context.hasEntity(id)})){context.enter(iD.modes.Browse(context))}}context.map().on("move.select",function(){context.surface().call(radialMenu.close)});d3.select(document).call(keybinding);function selectElements(){context.surface().selectAll(iD.util.entityOrMemberSelector(selectedIDs,context.graph())).classed("selected",true)}context.map().on("drawn.select",selectElements);selectElements();radialMenu=iD.ui.RadialMenu(context,operations,true);var show=d3.event&&!suppressMenu;if(show){positionMenu()}timeout=window.setTimeout(function(){if(show){showMenu()}var sIDs=context.selectedIDs();sIDs&&sIDs.forEach(function(id,i){if(!context.graph().hasEntity(id)){sIDs.splice(i,1);context.surface().call(radialMenu.close)}})},200)};mode.exit=function(){if(timeout)window.clearTimeout(timeout);if(inspector)wrap.call(inspector.close);behaviors.forEach(function(behavior){context.uninstall(behavior)});keybinding.off();context.history().on("undone.select",null).on("redone.select",null);var sf=context.surface();if(radialMenu)sf.call(radialMenu.close);sf.on("dblclick.select",null).selectAll(".selected").classed("selected",false);context.map().on("drawn.select",null)};return mode};;;iD.modes.RoadCrossModify=function(context,selectedIDs){var mode={id:"RoadCrossModify",button:"RoadCrossModify"};var keybinding=d3.keybinding("RoadCrossModify"),behaviors=[iD.behavior.Hover(context),iD.behavior.RoadCrossModify(context,selectedIDs)];mode.selectedIDs=function(){return selectedIDs};mode.setSelectedIDs=function(_){if(_){selectedIDs=_}return selectedIDs};mode.enter=function(){keybinding.on("\u238B",function(){context.enter(iD.modes.Browse(context))},true);behaviors.forEach(function(behavior){context.install(behavior)});d3.select(document).call(keybinding);function selectElements(){context.surface().selectAll(iD.util.entityOrMemberSelector(selectedIDs,context.graph())).classed("selected",true)}context.map().on("drawn.select",selectElements);selectElements()};mode.exit=function(){behaviors.forEach(function(behavior){context.uninstall(behavior)});context.surface().selectAll(".selected").classed("selected",false);context.map().on("drawn.select",null);keybinding.off()};return mode};;;iD.modes.LassoZoom=function(context){var type=arguments[1];var mode={id:!type?"lasso-zoom":"lasso-zoomOut",button:!type?"lasso-zoom":"lasso-zoomOut",title:!type?"\u62C9\u6846\u653E\u5927":"\u62C9\u6846\u7F29\u5C0F",description:!type?"\u62C9\u6846\u653E\u5927":"\u62C9\u6846\u7F29\u5C0F",key:"none",enable:true};var keybinding=d3.keybinding("lasso-zoom");var behavior=iD.behavior.LassoZoom(context,type);mode.enter=function(){context.install(behavior);keybinding.on("\u238B",function(){context.enter(iD.modes.Browse(context))});d3.select(document).call(keybinding)};mode.exit=function(){context.uninstall(behavior);keybinding.off()};return mode};;;iD.modes.toolbar={};iD.behavior.toolbar={};iD.modes.toolbar.Polygon=function(context){var mode={id:"toolbar-polygon",button:"toolbar-polygon",title:"\u591A\u8FB9\u5F62\u6846\u9009",description:"\u591A\u8FB9\u5F62\u6846\u9009",key:"",enable:true};var t=arguments[1];var f=arguments[2];var behavior=iD.behavior.toolbar.Polygon(context,mode.id,t,f);mode.enter=function(){context.install(behavior)};mode.exit=function(){window.setTimeout(function(){context.map().dblclickEnable(true)},300);context.uninstall(behavior)};return mode};iD.behavior.toolbar.Polygon=function(context,modeid){var type=arguments[2];var filter=arguments[3]||iD.util.empty;var behaviorEvent=d3.dispatch("finish");var behavior=function(selection){var mouse=null,draw=false,mode="polygon",style={fill:"red",opacity:"0.5",stroke:"rgb(255, 99, 25)","stroke-width":3},time=0,pos=null,closeTolerance=4,tolerance=12;function mousedown(){mouse=context.mouse();behavior.polygon=null;selection.on("mousemove.polygon",mousemove).on("mouseup.polygon",mouseup).on("mousedown.polygon",mouseup).on("click.polygon",click).on("dblclick.polygon",dblclick);d3.event.stopPropagation();d3.event.preventDefault();var element=d3.select(this),touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null,time=+new Date,pos=context.map().mouse();element.on("mousemove.polygon",null);d3.select(window).on("mouseup.polygon",function(){element.on("mousemove.polygon",mousemove);d3.select(window).on("click.draw-block",function(){d3.event.stopPropagation()},true);context.map().dblclickEnable(false);window.setTimeout(function(){context.map().dblclickEnable(true);d3.select(window).on("click.draw-block",null)},500);click()});draw=true}function event(){var bounds=behavior.polygon.bounds();var extent=iD.geo.Extent(bounds);behavior.polygon.convertArea();filterNodes(behavior.polygon.nodes);var els=context.layers().getLayer();var selected=context.intersects(extent).filter(function(entity){if(!els||els&&els.id!==entity.layerId){return false}if(!els.isPoint()&&entity instanceof iD.Node){return false}if(entity instanceof iD.Way){return filter(entity)&&true}if(entity instanceof iD.Node)return filter(entity)&&iD.util.isPointInPolygon(entity,behavior.polygon);return false});if(selected.length&&(selected[0]instanceof iD.Node||"area"==els.type)&&!type){0!=selected.length&&context.enter(iD.modes.Select(context,_.pluck(selected,"id")));context.event.polygonend({bounds:bounds,coordinates:behavior.polygon.nodes,selected:selected});return}if(selected.length&&selected[0]instanceof iD.Way&&"area"!=els.type&&!type){var extend=iD.util.lassExtend;var wrap=[];for(var i=0;i<selected.length;i++){var way=selected[i];var nodes=way.nodes;if(!els||els&&els.id!==way.layerId){continue}if("node"===way.type){var nflag=extend.isPointInRect({lon:way.loc[0],lat:way.loc[1]},extent);if(nflag){wrap.push(way)};continue}for(var j=0;j<nodes.length;j++){if(j+1>=nodes.length)break;var nodeId=nodes[j];var node=context.graph().entity(nodeId);var loc=node.loc;var nextId=nodes[j+1];var nextNode=context.graph().entity(nextId);var nextLoc=nextNode.loc;var newline=[loc[0],loc[1],nextLoc[0],nextLoc[1]];var intersects=extend.isLineInRect(extent,newline);if(intersects){wrap.push(way);break}}}wrap.length&&context.enter(iD.modes.Select(context,_.pluck(wrap,"id")));selected=wrap}if(type){filterNodes(behavior.polygon.nodes);if(3>behavior.polygon.nodes.length){context.map().removeOverlays(behavior.polygon);context.event.drawoverlayers();context.enter(iD.modes.Browse(context));return}behavior.polygon.nodes[behavior.polygon.nodes.length-1]=behavior.polygon.nodes[0];context.replace(iD.actions.Noop())}context.event.draw({overlay:behavior.polygon,mode:mode});!type&&context.event.polygonend({bounds:bounds,coordinates:behavior.polygon.nodes,selected:selected});if(!selected.length||type)context.enter(iD.modes.Browse(context))}function filterNodes(nodes){if(3===nodes.length){if(iD.geo.edgeEqual(nodes[1].loc,nodes[2].loc))nodes.splice(2,1)}else{for(var i=0;i<nodes.length-2;i++){if(iD.geo.edgeEqual(nodes[i].loc,nodes[i+1].loc)){nodes.splice(i+1,1);filterNodes(nodes);break}}}}function dblclick(){behavior.polygon&&behavior.polygon.moveNode(new Point({loc:context.map().mouseCoordinates()}));behavior.polygon&&behaviorEvent.finish(behavior.polygon);event()}function mousemove(){if(!behavior.polygon){var nodes=[],loc=context.map().mouseCoordinates();nodes.push(new Point({loc:loc}));nodes.push(new Point({loc:loc}));nodes.push(new Point({loc:loc}));behavior.polygon=new Polygon({nodes:nodes,mode:"polygon",onDraw:function(element){element.style(style)}});context.map().addOverlays(behavior.polygon);context.event.drawstart({overlay:behavior.polygon,mode:mode})}if(!draw){behavior.polygon.moveNode(new Point({loc:context.map().mouseCoordinates()}));context.event.drawoverlayers();context.event.drawing({overlay:behavior.polygon,mode:mode})}}var t=0;function click(){if(d3.event.target.__data__&&d3.event.target.__data__.button&&d3.event.target.__data__.enter){d3.event.preventDefault();if(d3.event.target.__data__.id==modeid)context.enter(iD.modes.Browse(context));else{context.enter(d3.event.target.__data__)}}else if(d3.event.target.__data__||"surface"===d3.event.target.id){if(200>new Date().getTime()-t){return}if(iD.geo.euclideanDistance(pos||context.map().mouse(),context.map().mouse())<closeTolerance||iD.geo.euclideanDistance(pos||context.map().mouse(),context.map().mouse())<tolerance&&500>+new Date-time){behavior.polygon&&behavior.polygon.addNode(new Point({loc:context.map().mouseCoordinates()}));t=new Date().getTime();context.event.drawing({overlay:behavior.polygon,mode:mode})}else{return}}else{if(d3.event.target&&"surface"!=d3.event.target.id&&d3.event.target.onclick){context.event.draw({overlay:behavior.polygon,mode:mode});context.enter(iD.modes.Browse(context));d3.event.target.onclick()}}}function mouseup(){time=+new Date;if(draw){draw=false}else{draw=true;pos=context.map().mouse()}}function backspace(){d3.event.preventDefault()}function del(){d3.event.preventDefault()}function ret(){d3.event.preventDefault();context.event.draw({overlay:behavior.polygon,mode:mode});context.enter(iD.modes.Browse(context))}keybinding.on("\u232B",backspace).on("\u2326",del).on("\u238B",ret).on("\u21A9",ret);selection.on("mousedown.polygon",mousedown);d3.select(document).call(keybinding)};var keybinding=d3.keybinding("draw");behavior.off=function(selection){selection.on("mousedown.polygon",null);selection.on("mousemove.polygon",null);selection.on("mouseup.polygon",null);selection.on("click.polygon",null);selection.on("dblclick.polygon",null);d3.select(window).on("mouseup.polygon",null);if(!type)setTimeout(function(){context.map().removeOverlays(behavior.polygon);context.event.drawoverlayers()},500);d3.select(document).call(keybinding.off)};return d3.rebind(behavior,behaviorEvent,"on")};iD.modes.toolbar.MeasureArea=function(context){var mode={id:"toolbar-measureArea",button:"toolbar-measureArea",title:"\u6D4B\u9762",description:"\u6D4B\u9762",key:"",enable:true};var behavior=iD.behavior.toolbar.Polygon(context,mode.id,true);behavior.on("finish",drawFinish);function drawFinish(e){e.distance=e.getArea();e.mode="measurearea"}mode.enter=function(){context.install(behavior)};mode.exit=function(){window.setTimeout(function(){context.map().dblclickEnable(true)},300);context.uninstall(behavior)};return mode};iD.modes.toolbar.Distance=function(context){var mode={id:"toolbar-distance",button:"distance",title:t("modes.toolbar_distance.title"),description:t("modes.toolbar_distance.description"),key:"Ctrl+Y",enable:true};var behavior=iD.behavior.toolbar.Distance(context,mode.id);mode.enter=function(){context.install(behavior)};mode.exit=function(){if(!behavior.flag){context.map().removeOverlays(behavior.tmpPolyline);context.event.drawoverlayers()}window.setTimeout(function(){context.map().dblclickEnable(true)},300);context.uninstall(behavior)};return mode};iD.behavior.toolbar.Distance=function(context,modeid){var behavior=function(selection){var mouse=null,draw=false,polyline,mode="distance",style={stroke:"rgb(255, 99, 25)",opacity:"0.5","stroke-width":3};function mousedown(){mouse=context.mouse();polyline=null;selection.on("mousemove.distance",mousemove).on("mouseup.distance",mouseup).on("mousedown.distance",mousedownup).on("click.distance",click).on("dblclick.distance",dblclick);d3.event.stopPropagation();d3.event.preventDefault();var element=d3.select(this),touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null,time=+new Date;element.on("mousemove.distance",null);d3.select(window).on("mouseup.distance",function(){element.on("mousemove.distance",mousemove);d3.select(window).on("click.draw-block",function(){d3.event.stopPropagation()},true);context.map().dblclickEnable(false);window.setTimeout(function(){context.map().dblclickEnable(true);d3.select(window).on("click.draw-block",null)},500);click()});draw=true}function distance(){var distance=0,nodes=polyline.nodes;for(var i in nodes){if(nodes[parseInt(i)+1]){var loc1=nodes[i].loc;var loc2=nodes[parseInt(i)+1].loc;distance+=iD.geo.sphericalDistance(loc1,loc2)}}return distance.toFixed(2)}function partDistance(){var distance=0,nodes=polyline.nodes;var length=nodes.length;if(nodes[length-2].loc){var loc1=nodes[length-1].loc;var loc2=nodes[length-2].loc;distance+=iD.geo.sphericalDistance(loc1,loc2)}return distance.toFixed(2)}function dblclick(){behavior.flag=true;if(polyline){polyline.moveNode(new Marker({loc:context.map().mouseCoordinates()}));polyline.distance=distance();polyline.last().end=true;d3.select("#KDSEditor-footer").selectAll("#partDistanceInfo").remove();context.event.drawoverlayers();context.event.draw({overlay:polyline,mode:mode})}context.enter(iD.modes.Browse(context))}function mousemove(){if(!polyline){var nodes=[],loc=context.map().mouseCoordinates();nodes.push(new Marker({loc:loc}));nodes.push(new Marker({loc:loc}));nodes.push(new Marker({loc:loc}));polyline=new Polyline({nodes:nodes,mode:"distance",onDraw:function(element){element.style(style)}});context.map().addOverlays(polyline);context.event.drawstart({overlay:polyline,mode:mode})}if(!draw){polyline.moveLoc(context.map().mouseCoordinates());polyline.distance=distance();behavior.tmpPolyline=polyline;var partDis=[partDistance()];var partinfo=d3.select("#KDSEditor-footer").selectAll("#partDistanceInfo").data(partDis);var enter=partinfo.enter();partinfo.text(function(d,i){return"\u5F53\u524D\u7EBF\u957F\uFF1A"+d+"\u7C73"});enter.append("div").attr("id","partDistanceInfo").classed("partDistanceInfo",true).style({position:"absolute",right:"10%",bottom:"2px","font-size":"14px"}).text(function(d,i){return"\u5F53\u524D\u7EBF\u957F\uFF1A"+d+"\u7C73"});partinfo.exit().remove();context.event.drawoverlayers();context.event.drawing({overlay:polyline,mode:mode})}}var t=0;function click(){if(d3.event.target.__data__&&d3.event.target.__data__.button&&d3.event.target.__data__.enter){d3.event.preventDefault();polyline&&polyline.addNode(new Marker({loc:context.map().mouseCoordinates()}));behavior.tmpPolyline=polyline;dblclick();if(d3.event.target.__data__.id==modeid)context.enter(iD.modes.Browse(context));else{context.enter(iD.modes.Browse(context));context.enter(d3.event.target.__data__)}}else if(d3.event.target.__data__||"surface"===d3.event.target.id){if(200>new Date().getTime()-t){return}if(same(point(),context.map().mouseCoordinates()))polyline&&polyline.addNode(new Marker({loc:context.map().mouseCoordinates()}));behavior.tmpPolyline=polyline;t=new Date().getTime();context.event.drawing({overlay:polyline,mode:mode})}else{if(d3.event.target&&"surface"!=d3.event.target.id&&d3.event.target.onclick){context.event.draw({overlay:polyline,mode:mode});context.enter(iD.modes.Browse(context));d3.event.target.onclick()}}}var origin_point,origin_lnglat;function point(){var target=this;var touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null;var surface=context.surface().node();var p=target.parentNode||surface;return null!==touchId?d3.touches(p).filter(function(p){return p.identifier===touchId})[0]:d3.mouse(p)}function same(point,lnglat){if(origin_point&&lnglat&&origin_point[0]==point[0]&&origin_point[1]==point[1]&&origin_lnglat[0]==lnglat[0]&&origin_lnglat[1]==lnglat[1])return true;else return false}function mouseup(){if(draw)draw=false;else draw=true}function mousedownup(){origin_point=point();origin_lnglat=context.map().mouseCoordinates();if(draw)draw=false;else draw=true}function backspace(){d3.event.preventDefault()}function del(){d3.event.preventDefault()}function ret(){d3.event.preventDefault();click();dblclick()}selection.on("mousedown.distance",mousedown);d3.select(document).call(keybinding)};var keybinding=d3.keybinding("draw");behavior.flag=false;behavior.tmpPolyline;behavior.off=function(selection){behavior.flag=false;behavior.tmpPolyline=null;selection.on("mousedown.distance",null);selection.on("mousemove.distance",null);selection.on("mouseup.distance",null);selection.on("click.distance",null);selection.on("dblclick.distance",null);d3.select(window).on("mouseup.distance",null);d3.select(document).call(keybinding.off)};return behavior};iD.modes.toolbar.Marker=function(context){var mode={id:"toolbar-marker",button:"toolbar-marker",title:"\u7ED8\u5236\u70B9",description:"\u7ED8\u5236\u70B9",key:"",enable:true};var behavior=iD.behavior.toolbar.Marker(context,mode.id);mode.enter=function(){context.install(behavior)};mode.exit=function(){window.setTimeout(function(){context.map().dblclickEnable(true)},300);context.uninstall(behavior)};return mode};iD.behavior.toolbar.Marker=function(context,modeid){var behavior=function(selection){var mouse=null,draw=false,marker,mode="marker",style={stroke:"rgb(255, 99, 25)",opacity:"0.5","stroke-width":3};function mousedown(){mouse=context.mouse();marker=null;selection.on("click.marker",click);d3.event.stopPropagation();d3.event.preventDefault()}function click(){marker=new Marker({loc:context.map().mouseCoordinates(),mode:"marker"});context.map().addOverlays(marker);context.event.drawoverlayers();context.event.draw({overlay:marker,mode:mode});context.enter(iD.modes.Browse(context))}function backspace(){d3.event.preventDefault()}function del(){d3.event.preventDefault()}function ret(){d3.event.preventDefault()}keybinding.on("\u232B",backspace).on("\u2326",del).on("\u238B",ret).on("\u21A9",ret);selection.on("mousedown.marker",mousedown);d3.select(document).call(keybinding)};var keybinding=d3.keybinding("draw");behavior.off=function(selection){selection.on("mousedown.marker",null);selection.on("click.marker",null);d3.select(document).call(keybinding.off)};return behavior};iD.modes.toolbar.Rectangle=function(context){var mode={id:"toolbar-rectangle",button:"toolbar-rectangle",title:"\u7ED8\u5236\u77E9\u5F62",description:"\u7ED8\u5236\u77E9\u5F62",key:"",enable:true};var behavior=iD.behavior.toolbar.Rectangle(context,mode.id);mode.enter=function(){context.install(behavior)};mode.exit=function(){window.setTimeout(function(){context.map().dblclickEnable(true)},300);context.uninstall(behavior)};return mode};iD.behavior.toolbar.Rectangle=function(context,modeid){var behavior=function(selection){var mouse=null,draw=false,polygon,mode="rectangle",style={fill:"red",opacity:"0.5",stroke:"rgb(255, 99, 25)","stroke-width":3};function mousedown(){mouse=context.mouse();polygon=null;selection.on("mousemove.rectangle",mousemove).on("mouseup.rectangle",mouseup).on("mousedown.rectangle",mouseup);d3.event.stopPropagation();d3.event.preventDefault()}function mousemove(){var loc=context.map().mouseCoordinates();if(!polygon){var nodes=[];nodes.push(new Point({loc:loc}));polygon=new Polygon({nodes:[nodes],mode:"rectangle",onDraw:function(element){element.style(style)}});polygon.rectangle={start:loc,end:loc};polygon.rectangle.start=loc;context.map().addOverlays(polygon);context.event.drawstart({overlay:polygon,mode:mode})}polygon.rectangle.end=loc;var points=polygon.boundPoints();var nodes=[];nodes.push(new Point({loc:points[0]}));nodes.push(new Point({loc:points[1]}));nodes.push(new Point({loc:points[2]}));nodes.push(new Point({loc:points[3]}));nodes.push(new Point({loc:points[0]}));polygon.nodes=nodes;context.event.drawoverlayers();context.event.drawing({overlay:polygon,mode:mode})}function normalize(a,b){return[[Math.min(a[0],b[0]),Math.min(a[1],b[1])],[Math.max(a[0],b[0]),Math.max(a[1],b[1])]]}function mouseup(){selection.on("mousemove.rectangle",null).on("mouseup.rectangle",null);context.event.drawoverlayers();context.event.draw({overlay:polygon,mode:mode});context.enter(iD.modes.Browse(context))}selection.on("mousedown.rectangle",mousedown)};behavior.off=function(selection){selection.on("mousedown.rectangle",null);selection.on("mousemove.rectangle",null);selection.on("mouseup.rectangle",null)};return behavior};iD.modes.toolbar.Circle=function(context){var mode={id:"toolbar-circle",button:"toolbar-circle",title:"\u7ED8\u5236\u5706",description:"\u7ED8\u5236\u5706",key:"",enable:true};var behavior=iD.behavior.toolbar.Circle(context,mode.id);mode.enter=function(){context.install(behavior)};mode.exit=function(){window.setTimeout(function(){context.map().dblclickEnable(true)},300);context.uninstall(behavior)};return mode};iD.behavior.toolbar.Circle=function(context,modeid){var behavior=function(selection){var mouse=null,draw=false,circle,mode="circle",style={fill:"red",opacity:"0.5",stroke:"rgb(255, 99, 25)","stroke-width":3};function mousedown(){mouse=context.mouse();circle=null;selection.on("mousemove.circle",mousemove).on("mouseup.circle",mouseup).on("mousedown.circle",mouseup);d3.event.stopPropagation();d3.event.preventDefault()}function mousemove(){if(!circle){var loc=context.map().mouseCoordinates();circle=new Circle({loc:loc,radius:loc,mode:"circle",onDraw:function(element){element.style(style)}});context.map().addOverlays(circle);context.event.drawstart({overlay:circle,mode:mode})}if(circle)circle.radius=context.map().mouseCoordinates();context.event.drawoverlayers();context.event.drawing({overlay:circle,mode:mode})}function normalize(a,b){return[[Math.min(a[0],b[0]),Math.min(a[1],b[1])],[Math.max(a[0],b[0]),Math.max(a[1],b[1])]]}function mouseup(){selection.on("mousemove.circle",null).on("mouseup.circle",null);if(circle)circle.radius=context.map().mouseCoordinates();context.event.drawoverlayers();context.event.draw({overlay:circle,mode:mode});context.enter(iD.modes.Browse(context))}selection.on("mousedown.circle",mousedown)};behavior.off=function(selection){selection.on("mousedown.circle",null)};return behavior};iD.modes.toolbar.Polyline=function(context){var mode={id:"toolbar-polyline",button:"toolbar-polyline",title:"\u7ED8\u5236\u7EBF\u6BB5",description:"\u7ED8\u5236\u7EBF\u6BB5",key:"",enable:true};var behavior=iD.behavior.toolbar.Polyline(context,mode.id);mode.enter=function(){context.install(behavior)};mode.exit=function(){window.setTimeout(function(){context.map().dblclickEnable(true)},300);context.uninstall(behavior)};return mode};iD.behavior.toolbar.Polyline=function(context,modeid){var behavior=function(selection){var mouse=null,draw=false,polyline,mode="polyline",style={stroke:"rgb(255, 99, 25)",opacity:"0.5","stroke-width":3};function mousedown(){mouse=context.mouse();polyline=null;selection.on("mousemove.polyline",mousemove).on("mouseup.polyline",mouseup).on("mousedown.polyline",mousedownup).on("click.polyline",click).on("dblclick.polyline",dblclick);d3.event.stopPropagation();d3.event.preventDefault();var element=d3.select(this),touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null,time=+new Date;element.on("mousemove.polyline",null);d3.select(window).on("mouseup.polyline",function(){element.on("mousemove.polyline",mousemove);d3.select(window).on("click.draw-block",function(){d3.event.stopPropagation()},true);context.map().dblclickEnable(false);window.setTimeout(function(){context.map().dblclickEnable(true);d3.select(window).on("click.draw-block",null)},500);click()});draw=true}function filterNodes(nodes){for(var i=0;i<nodes.length-1;i++){if(iD.geo.edgeEqual(nodes[i].loc,nodes[i+1].loc)){nodes.splice(i+1,1);filterNodes(nodes);break}}}function dblclick(){if(polyline){polyline.moveNode(new Marker({loc:context.map().mouseCoordinates()}));filterNodes(polyline.nodes);context.event.drawoverlayers();context.event.draw({overlay:polyline,mode:mode})}context.enter(iD.modes.Browse(context))}function mousemove(){if(!polyline){var nodes=[],loc=context.map().mouseCoordinates();nodes.push(new Marker({loc:loc}));nodes.push(new Marker({loc:loc}));nodes.push(new Marker({loc:loc}));polyline=new Polyline({nodes:nodes,mode:"polyline",onDraw:function(element){element.style(style)}});context.map().addOverlays(polyline);context.event.drawstart({overlay:polyline,mode:mode})}if(!draw){polyline.moveLoc(context.map().mouseCoordinates());context.event.drawoverlayers();context.event.drawing({overlay:polyline,mode:mode})}}var t=0;function click(){if(d3.event.target.__data__&&d3.event.target.__data__.button&&d3.event.target.__data__.enter){d3.event.preventDefault();polyline&&polyline.addNode(new Marker({loc:context.map().mouseCoordinates()}));dblclick();if(d3.event.target.__data__.id==modeid)context.enter(iD.modes.Browse(context));else{context.enter(iD.modes.Browse(context));context.enter(d3.event.target.__data__)}}else if(d3.event.target.__data__||"surface"===d3.event.target.id){if(200>new Date().getTime()-t){return}if(same(point(),context.map().mouseCoordinates()))polyline&&polyline.addNode(new Marker({loc:context.map().mouseCoordinates()}));t=new Date().getTime();context.event.drawing({overlay:polyline,mode:mode})}else{if(d3.event.target&&"surface"!=d3.event.target.id&&d3.event.target.onclick){context.event.draw({overlay:polyline,mode:mode});context.enter(iD.modes.Browse(context));d3.event.target.onclick()}}}var origin_point,origin_lnglat;function point(){var target=this;var touchId=d3.event.touches?d3.event.changedTouches[0].identifier:null;var surface=context.surface().node();var p=target.parentNode||surface;return null!==touchId?d3.touches(p).filter(function(p){return p.identifier===touchId})[0]:d3.mouse(p)}function same(point,lnglat){if(origin_point&&lnglat&&origin_point[0]==point[0]&&origin_point[1]==point[1]&&origin_lnglat[0]==lnglat[0]&&origin_lnglat[1]==lnglat[1])return true;else return false}function mouseup(){if(draw)draw=false;else draw=true}function mousedownup(){origin_point=point();origin_lnglat=context.map().mouseCoordinates();if(draw)draw=false;else draw=true}function backspace(){d3.event.preventDefault()}function del(){d3.event.preventDefault()}function ret(){d3.event.preventDefault();click();dblclick()}keybinding.on("\u232B",backspace).on("\u2326",del).on("\u238B",ret).on("\u21A9",ret);selection.on("mousedown.polyline",mousedown);d3.select(document).call(keybinding)};var keybinding=d3.keybinding("draw");behavior.off=function(selection){selection.on("mousedown.polyline",null);selection.on("mousemove.polyline",null);selection.on("mouseup.polyline",null);selection.on("click.polyline",null);selection.on("dblclick.polyline",null);d3.select(window).on("mouseup.polyline",null);d3.select(document).call(keybinding.off)};return behavior};iD.modes.toolbar.Lasso=function(context){var mode={id:"toolbar-lasso",button:"toolbar-lasso",title:"\u62C9\u6846\u9009\u62E9",description:"\u62C9\u6846\u9009\u62E9",key:"",enable:true};var f=arguments[1];var behavior=iD.behavior.Lasso(context,"true",f);mode.enter=function(){context.install(behavior)};mode.exit=function(){window.setTimeout(function(){context.map().dblclickEnable(true)},300);context.uninstall(behavior)};return mode};;;iD.modes.EditorWay=function(context,selectedIDs){var mode={button:"way_editor",id:"way_editor"};var keybinding=d3.keybinding("editorway");var behaviors=[iD.behavior.Hover(context)];var dragbehaviors=iD.modes.DragNode(context).dragWayBehavior;mode.selectedIDs=function(){return selectedIDs};mode.setSelectedIDs=function(_){if(_){selectedIDs=_}return selectedIDs};function d3_eventCancel(){dragbehaviors.node(null);d3.event.stopPropagation();d3.event.preventDefault()}mode.enter=function(){enter()};function enter(){function selectElements(){context.surface().selectAll(iD.util.entityOrMemberSelector(selectedIDs,context.graph())).classed("selected",true)}context.map().on("drawn.way_editor",selectElements);selectElements();function delegate(){var layerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD).id;var roadNodeLayerId=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.ROAD_NODE).id;var target=d3.select(d3.event.target),wayID,datum=target.datum();var dargNode=null;if(!datum||datum.layerId!=layerId){return false}if(!iD.Layers.getLayer(datum.layerId).editable){return false}if(datum instanceof iD.Way){if(datum.id!==selectedIDs[0]){dargNode=null;d3_eventCancel();return}if(datum.isOneRoadCrossWay()){return false}var choice=iD.geo.chooseEdge(context.childNodes(datum),context.mouse(),context.projection,datum),node=iD.Node({layerId:roadNodeLayerId,loc:choice.loc,modelName:iD.data.DataType.ROAD_NODE});var prev=datum.nodes[choice.index-1],next=datum.nodes[choice.index];dragbehaviors.node(node);context.perform(iD.actions.AddMidpoint({loc:choice.loc,edge:[prev,next]},node),t("operations.add.annotation.vertex"))}else if(datum instanceof iD.Node){wayID=context.graph().parentWays(datum);if(-1==_.indexOf(_.pluck(wayID,"id"),selectedIDs[0])||datum.modelName===iD.data.DataType.ROADNODE){dargNode=null;d3_eventCancel()}else{dragbehaviors.node(datum)}}}context.surface().on("mousedown.way_editor",delegate);context.surface().on("click.way_editor",function(){var datum=d3.event.target.__data__;if("undefined"==datum||null==datum){context.enter(iD.modes.Browse(context))}});context.install(dragbehaviors);behaviors.forEach(function(behavior){context.install(behavior)});keybinding.on("\u238B",function(){context.enter(iD.modes.Browse(context))});function dele(){var wayNodes=_.clone(context.childNodes(context.entity(selectedIDs[0])));if(2==wayNodes.length)return;wayNodes.shift();wayNodes.pop();var node=iD.geo.chooseNode(wayNodes,context.mouse(),context.projection);if(context.graph().hasEntity(node.id)){var action=iD.actions.DeleteMultiple([node.id]);var annotation=t("operations.delete.annotation.multiple",{n:1});context.perform(action,annotation)}}keybinding.on(iD.ui.cmd("\u2326"),dele);d3.select(document).call(keybinding)}mode.exit=function(){behaviors.forEach(function(behavior){context.uninstall(behavior)});context.uninstall(dragbehaviors);keybinding.off();context.map().on("drawn.way_editor",null);context.surface().on("click.way_editor",null);var sf=context.surface();sf.on("mousedown.way_editor",null).selectAll(".selected").classed("selected",false)};return mode};;;iD.modes.LaneInfoModify=function(context,selectedIDs,maat){var isCorrect=false;var fromMember=maat.memberByRole(iD.data.RoleType.FROAD_ID);var toMember=maat.memberByRole(iD.data.RoleType.TROAD_ID);var nodeMember=maat.modelName===iD.data.DataType.NODECONN?maat.memberByRole(iD.data.RoleType.ROAD_NODE_ID):maat.memberByRole(iD.data.RoleType.C_NODE_ID);var initSelectedIds=function(maat){if(context.hasEntity(fromMember.id)){selectedIDs.push(fromMember.id)}if(context.hasEntity(toMember.id)){selectedIDs.push(toMember.id)}};var addNextWay=function(sortWayIds,wayIds){if(1<sortWayIds.length&&0<wayIds.length){var preWay=context.entity(sortWayIds[sortWayIds.length-1]);var prePreWay=context.entity(sortWayIds[sortWayIds.length-2]);var nextNodeId;if(preWay.first()==prePreWay.first()||preWay.first()==prePreWay.last()){nextNodeId=preWay.last()}else{nextNodeId=preWay.first()}var pways=context.graph().parentWays(context.entity(nextNodeId));for(var i=0;i<pways.length;i++){var index=wayIds.indexOf(pways[i].id);if(-1!=index){sortWayIds.push(pways[i].id);wayIds.splice(index,1);addNextWay(sortWayIds,wayIds);break}}return}return};var isCorrectLinkRoad=function(sortWayIds){var currWay,nextWay;for(var i=0;i<sortWayIds.length-1;i++){currWay=context.entity(sortWayIds[i]);nextWay=context.entity(sortWayIds[i+1]);if(currWay.tags.DIRECTION==iD.way.direction.twowayforbid){return false}if(currWay.tags.DIRECTION==iD.way.direction.twoway){continue}if(currWay.first()==nextWay.first()||currWay.first()==nextWay.last()){if(currWay.tags.DIRECTION==iD.way.direction.reverse){continue}else{return false}}else{if(currWay.tags.DIRECTION==iD.way.direction.positive){continue}else{return false}}}if(nextWay.tags.DIRECTION==iD.way.direction.twowayforbid){return false}else if(nextWay.tags.DIRECTION==iD.way.direction.twoway){return true}else if(nextWay.first()==currWay.first()||nextWay.first()==currWay.last()){if(nextWay.tags.DIRECTION==iD.way.direction.positive){return true}else{return false}}else{if(nextWay.tags.DIRECTION==iD.way.direction.reverse){return true}else{return false}}};var mode={id:"LaneInfoModify",button:"LaneInfoModify"};if(maat&&0==selectedIDs.length){initSelectedIds(maat)}var keybinding=d3.keybinding("LandInfoModify"),behaviors=[iD.behavior.Hover(context),iD.behavior.LaneInfoPathEdit(context,selectedIDs,maat)];mode.selectedIDs=function(){return selectedIDs};mode.setSelectedIDs=function(_){if(_){selectedIDs=_}return selectedIDs};mode.enter=function(){keybinding.on("\u238B",function(){context.enter(iD.modes.Browse(context))},true);behaviors.forEach(function(behavior){context.install(behavior)});d3.select(document).call(keybinding);function selectElements(){context.surface().selectAll(iD.util.entityOrMemberSelector(selectedIDs,context.graph())).classed("selected",true)}context.map().on("drawn.select",selectElements);selectElements()};mode.availableExit=function(){var sortWayIds=[];var wayIds=[];var crossMemberNodes=[];for(var i=0;i<selectedIDs.length;i++){var id=selectedIDs[i];if(id!=fromMember.id){if(maat.modelName==iD.data.DataType.NODECONN){if(id!=toMember.id){wayIds.push(id)}}else{wayIds.push(id)}}}let topoEntity=iD.TopoEntity();if(maat.modelName==iD.data.DataType.NODECONN){sortWayIds.push(fromMember.id);sortWayIds.push(toMember.id);addNextWay(sortWayIds,wayIds)}else{sortWayIds.push(fromMember.id);var crossNode=context.entity(nodeMember.id);var crossMemberNodes=[];var cmembers=topoEntity.getCrossNodeMembers(context.graph(),nodeMember.id);for(var i=0;i<cmembers.length;i++){crossMemberNodes.push(cmembers[i].id)}var firstWay=context.entity(fromMember.id);var nextNodeId;if(-1!=crossMemberNodes.indexOf(firstWay.first())){nextNodeId=firstWay.first()}else{nextNodeId=firstWay.last()}var pways=context.graph().parentWays(context.entity(nextNodeId));for(var i=0;i<pways.length;i++){var index=wayIds.indexOf(pways[i].id);if(-1!=index){sortWayIds.push(pways[i].id);wayIds.splice(index,1);addNextWay(sortWayIds,wayIds);break}}}if(0<wayIds.length){Dialog.alert("\u8BF7\u9009\u62E9\u4F9D\u6B21\u76F8\u8FDE\u7684\u9053\u8DEF\u4F5C\u4E3ATurnGuidance\u8DEF\u5F84");return false}if(!isCorrectLinkRoad(sortWayIds)){Dialog.alert("\u8BF7\u9009\u62E9\u4F9D\u6B21\u76F8\u8FDE\u5E76\u53EF\u901A\u884C\u7684\u9053\u8DEF\u4F5C\u4E3ATurnGuidance\u8DEF\u5F84");return false}if(3>sortWayIds.length){Dialog.alert("TurnGuidance\u8DEF\u5F84\u4E0D\u80FD\u5C11\u4E8E3\u6761\u9053\u8DEF");return false}for(var i=1;i<sortWayIds.length;i++){var wayEntity=context.entity(sortWayIds[i]);if(wayEntity.id==toMember.id){break}if(-1==crossMemberNodes.indexOf(wayEntity.first())||-1==crossMemberNodes.indexOf(wayEntity.last())){Dialog.alert("TurnGuidance\u9053\u8DEF\u4E4B\u95F4\u53EA\u80FD\u4E3A\u5185\u90E8\u9053\u8DEF");return false}}var length=selectedIDs.length;for(var i=0;i<length;i++){selectedIDs.pop()}for(var i=0;i<sortWayIds.length;i++){selectedIDs.push(sortWayIds[i])}isCorrect=true;return true};mode.exit=function(){if(!isCorrect){var length=selectedIDs.length;for(var i=0;i<length;i++){selectedIDs.pop()}}behaviors.forEach(function(behavior){context.uninstall(behavior)});context.surface().selectAll(".selected").classed("selected",false);context.map().on("drawn.select",null);keybinding.off()};return mode};;;iD.modes.PicPlay=function(context,selectedIDs,mouse){var mode={button:"pic_play",id:"pic_play",title:"Pic",description:"Pic"},sidebar;var behaviors=[iD.behavior.Hover(context).on("hover",context.ui().sidebar.hover),iD.behavior.Select(context)];var dvrDataMgr=iD.svg.Pic.dataMgr;mode.enter=function(){context.transportation.set();context.temp().rawposition=0;dvrDataMgr.selectedIDs(selectedIDs||[]);dvrDataMgr.mousePos(mouse||null);behaviors.forEach(function(behavior){context.install(behavior)});if(document.activeElement&&document.activeElement.blur){document.activeElement.blur()}context.container().classed("mode-browse",true)};mode.exit=function(){dvrDataMgr.mousePos(null);context.container().classed("mode-browse",false);behaviors.forEach(function(behavior){context.uninstall(behavior)})};return mode};;;iD.operations={};iD.overoperations={};;;iD.operations.Continue=function(selectedIDs,context){function candidateWays(){return graph.parentWays(vertex).filter(function(parent){return"line"===parent.geometry(graph)&&parent.affix(vertex.id)&&(0===geometries.line.length||geometries.line[0]===parent)})}var operation=function(){var candidate=candidateWays()[0];context.enter(iD.modes.DrawLine(context,candidate.id,context.graph(),candidate.affix(vertex.id)))};operation.available=function(){return false;var entity=context.entity(selectedIDs[0]),modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName),isMultiple=modelConfig.editable&&1===geometries.vertex.length&&1>=geometries.line.length;if(entity.isArea&&entity.isArea()||!modelConfig.editable||context.isRoadCross(entity))return false;var ways=context.graph().parentWays(entity);if(ways&&1<ways.length)return false;if(ways&&1===ways.length){if(ways[0].first()===selectedIDs[0]||ways[0].last()===selectedIDs[0])return true&&isMultiple&&!operation.disabled();else return false}return isMultiple&&!operation.disabled()};operation.disabled=function(){var candidates=candidateWays();if(0===candidates.length)return"not_eligible";if(1<candidates.length)return"multiple"};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.continue."+disable):t("operations.continue.description")};operation.id="continue";operation.keys=[t("operations.continue.key")];operation.title=t("operations.continue.title");return operation};;;iD.operations.Circularize=function(selectedIDs,context){if(selectedIDs.length){var entityId=selectedIDs[0],entity=context.entity(entityId),extent=entity.extent(context.graph()),geometry=context.geometry(entityId),action=iD.actions.Circularize(entityId,context.projection)}var isEditable=function(_){var editable=true;for(var i=0;i<_.length;i++){var entity=context.graph().entity(_[i]),modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);editable=modelConfig&&modelConfig.editable;if(!editable)return false}return editable};var operation=function(){var annotation=t("operations.circularize.annotation."+geometry);context.perform(action,annotation)};operation.available=function(){return false;var entity=context.entity(selectedIDs[0]);var editable=isEditable(selectedIDs);var layer=iD.Layers.getLayer(entity.layerId);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(layer.isRoad()||layer.isLine())return false;return editable&&1===selectedIDs.length&&modelConfig.editable&&"way"===entity.type&&1<_.uniq(entity.nodes).length&&!context.isOneRoadCrossWay(entity)&&!operation.disabled()};operation.disabled=function(){var layer=iD.Layers.getLayer();if(layer.isRoad())return false;var reason;if(0.8>extent.percentContainedIn(context.extent())){reason="too_large"}return action.disabled(context.graph())||reason};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.circularize."+disable):t("operations.circularize.description."+geometry)};operation.id="circularize";operation.keys=[t("operations.circularize.key")];operation.title=t("operations.circularize.title");return operation};;;iD.operations.Orthogonalize=function(selectedIDs,context){if(selectedIDs.length){var entityId=selectedIDs[0],entity=context.entity(entityId),extent=entity.extent(context.graph()),geometry=context.geometry(entityId),action=iD.actions.Orthogonalize(entityId,context.projection)}var operation=function(){var annotation=t("operations.orthogonalize.annotation."+geometry);context.perform(action,annotation)};operation.available=function(){return false&&!operation.disabled()};operation.disabled=function(){var reason;if(0.8>extent.percentContainedIn(context.extent())){reason="too_large"}return action.disabled(context.graph())||reason};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.orthogonalize."+disable):t("operations.orthogonalize.description."+geometry)};operation.id="orthogonalize";operation.keys=[t("operations.orthogonalize.key")];operation.title=t("operations.orthogonalize.title");return operation};;;iD.operations.Straighten=function(selectedIDs,context){var action=iD.actions.Straighten(selectedIDs,context.projection,context);function operation(){var annotation=t("operations.straighten.annotation");context.perform(action,annotation);context.event.entityedite({})}operation.available=function(){if(2!=selectedIDs.length){return false}let entity1=context.entity(selectedIDs[0]);let entity2=context.entity(selectedIDs[1]);if(entity1.layerId!=entity2.layerId||!iD.Layers.getLayer(entity1.layerId,entity1.modelName).editable){return false}let wids1=_.pluck(context.graph().parentWays(entity1),"id");let wids2=_.pluck(context.graph().parentWays(entity2),"id");let wayID;for(let i=0;i<wids1.length;i++){if(wids2.includes(wids1[i])){wayID=wids1[i];break}}return wayID&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.straighten."+disable):t("operations.straighten.description")};operation.id="straighten";operation.keys=[t("operations.straighten.key")];operation.title=t("operations.straighten.title");return operation};;;iD.operations.Delete=function(selectedIDs,context){var action=iD.actions.DeleteMultiple(selectedIDs,context);function isUnicomInnerMember(nodeID,way,context){var crossNodeAId=iD.TopoEntity().isInCrossNode(context.graph(),nodeID);let topoEntity=iD.TopoEntity();let members=topoEntity.getCrossNodeMembers(context.graph(),crossNodeAId);var nodesArr=[];members.forEach(function(member){nodesArr.push(member.id)});if(!(-1<nodesArr.indexOf(way.first())&&-1<nodesArr.indexOf(way.last()))){return true}var index=nodesArr.indexOf(nodeID);nodesArr.splice(index,1);var node1=context.graph().entity(nodeID);if(iD.util.roadCrossExtend.isUnicomOfArr(nodesArr,context)){for(var j=0;j<nodesArr.length;j++){var ways=iD.util.roadCrossExtend.unicomWaysBetweenTwoNodes(node1,context.graph().entity(nodesArr[j]),context);if(1==ways.length&&ways[0]!=way){return true}else if(1<ways.length){return true}}}return false}function isDeleteWay(way){let firstnodeid=way.first();let lastnodeid=way.last();var num1=iD.TopoEntity().getRoadIsInCrossParentWaysNum(context.graph().entity(firstnodeid),context.graph());var num=iD.TopoEntity().getRoadIsInCrossParentWaysNum(context.graph().entity(lastnodeid),context.graph());if(0!=num1){if(!isUnicomInnerMember(firstnodeid,way,context)){Dialog.alert("\u5220\u9664\u9053\u8DEF\u5BFC\u81F4\u88AB\u7EFC\u5408\u7684\u7ED3\u70B9\u95F4\u9053\u8DEF\u4E0D\u8FDE\u901A\uFF0C\u4E0D\u80FD\u6267\u884C\u8BE5\u7F16\u8F91");return false}if(2==num1){Dialog.alert(iD.alert.tip.operation_create_fake_node_in_crossnode,function(){context.enter(iD.modes.Select(context,[firstnodeid]).suppressMenu(true))});return false}}if(0!=num){if(!isUnicomInnerMember(lastnodeid,way,context)){Dialog.alert("\u5220\u9664\u9053\u8DEF\u5BFC\u81F4\u88AB\u7EFC\u5408\u7684\u7ED3\u70B9\u95F4\u9053\u8DEF\u4E0D\u8FDE\u901A\uFF0C\u4E0D\u80FD\u6267\u884C\u8BE5\u7F16\u8F91");return false}if(2==num){Dialog.alert(iD.alert.tip.operation_create_fake_node_in_crossnode,function(){context.enter(iD.modes.Select(context,[lastnodeid]).suppressMenu(true))});return false}}return true};var operation=function(){if(!selectedIDs||!selectedIDs.length)return;var annotation,nextSelectedID;let extraActions=[];for(var i=0;i<selectedIDs.length;i++){if(context.entity(selectedIDs[i])instanceof iD.Way){if(!isDeleteWay(context.entity(selectedIDs[i]))){return}}}if(1<selectedIDs.length){annotation=t("operations.delete.annotation.multiple",{n:selectedIDs.length})}else{var id=selectedIDs[0],entity=context.entity(id),geometry=context.geometry(id),parents=context.graph().parentWays(entity),parent=parents[0];annotation=t("operations.delete.annotation."+geometry)}if(nextSelectedID&&context.hasEntity(nextSelectedID)){}else{context.enter(iD.modes.Browse(context))}context.perform(action,annotation);if(extraActions.length){context.replace.apply(context,extraActions.concat(annotation))}context.event["delete"]&&context.event["delete"]({selectedIDs})};operation.available=function(){var flag=true;if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;for(let eid of selectedIDs){var entity=context.entity(eid);let ways=context.graph().parentWays(entity).forEach(function(way){if(!way.modelName){return}else{if(way.first()==entity.id||way.last()==entity.id){return flag=false}}});var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!modelConfig.editable){flag=false}if(entity&&entity.modelName==iD.data.DataType.CHECK_TAG&&!iD.User.isEditCheckSystemAndRole()){flag=false}if(!flag){break}}return flag};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.delete."+disable):t("operations.delete.description")};operation.id="delete";operation.keys=[iD.ui.cmd("\u2318\u232B"),iD.ui.cmd("\u2318\u2326"),iD.ui.cmd("\u2326")];operation.title=t("operations.delete.title");return operation};iD.overoperations.Delete=function(selected,context){var operation=function(){if("v"==selected.vertices){var parent=context.map().getOverlays(selected.parent);if(1==parent.length){parent=parent[0];var nodes=parent.nodes;if(2==nodes.length||4===nodes.length&&"polygon"===parent.type)context.map().removeOverlays(parent);else{if("polygon"===parent.type&&(parent.first()==selected||parent.last()==selected)){nodes.splice(0,1);nodes.splice(nodes.length-1,1);nodes.push(nodes[0])}else{for(var i=0;i<nodes.length;i++){if(nodes[i].id==selected.id){nodes.splice(i,1);continue}}}}}context.map().drawOverlayers()}else{context.map().removeOverlays(selected);context.map().drawOverlayers()}};operation.available=function(){if(!selected.editable)return false;return"m"==selected.vertices?false:true};operation.disabled=function(){return false};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.delete."+disable):t("operations.delete.description")};operation.id="delete";operation.keys=[iD.ui.cmd("\u2318\u232B"),iD.ui.cmd("\u2318\u2326")];operation.title=t("operations.delete.title");return operation};;;iD.operations.Disconnect=function(selectedIDs,context){var layer=context.layers().getLayer(context.entity(selectedIDs[0]).layerId);var dataType=selectedIDs.length&&context.entity(selectedIDs[0]).modelName||"";if(!(dataType==iD.data.DataType.HIGHWAY||dataType==iD.data.DataType.WALKLINK)){dataType="Others"}var annotation=1===selectedIDs.length&&dataType?t("operations.disconnect.annotation."+dataType):t("operations.disconnect.description");var operation=function(){context.enter(iD.modes.DisconnectRoad(context))};operation.available=function(){if(1!==selectedIDs.length)return false;var firstEntity=context.entity(selectedIDs[0]);var isWalkArea=firstEntity.modelName==iD.data.DataType.WALKAREA;if("node"==firstEntity.type||context.isOneRoadCrossWay(firstEntity)||isWalkArea)return false;return false&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.disconnect."+disable):annotation};operation.id="disconnect";operation.keys=[t("operations.disconnect.key")];operation.title=t("operations.disconnect.title");return operation};;;iD.operations.Merge=function(selectedIDs,context){var join=iD.actions.Join(selectedIDs),merge=iD.actions.Merge(selectedIDs,context),mergePolygon=iD.actions.MergePolygon(selectedIDs),layer=context.layers().getLayer(context.entity(selectedIDs[0]).layerId),isRoadLayer=layer&&layer.isRoad(),anotion=isRoadLayer?"merge-road":"merge";function availableCrossWay(){var isAvailable=false;selectedIDs.forEach(function(sID){var entity=context.entity(sID);if(context.isOneRoadCrossWay(entity))isAvailable=true});return isAvailable}var annotation,action;function isUnicomInnerMember(nodeID,start,end,context){var crossNodeAId=iD.TopoEntity().isInCrossNode(context.graph(),nodeID);var members=context.graph().entity(crossNodeAId).members;var nodesArr=[];members.forEach(function(member){nodesArr.push(member.id)});var index=nodesArr.indexOf(nodeID);nodesArr.splice(index,1);var node1=context.graph().entity(nodeID);if(iD.util.roadCrossExtend.isUnicomOfArr(nodesArr,context)){for(var j=0;j<nodesArr.length;j++){var ways=iD.util.roadCrossExtend.unicomWaysBetweenTwoNodes(node1,context.graph().entity(nodesArr[j]),context);if(1==ways.length&&ways[0]!=start&&ways[0]!=end){return true}else if(1<ways.length){return true}}}return false}function isRoadMerge(start,end){if(isMergeCyclic(start,end)){Dialog.alert("\u5408\u5E76\u9053\u8DEF\u4F1A\u5BFC\u81F4\u73AF\u5F62\u9053\u8DEF,\u65E0\u6CD5\u5408\u5E76");return false}var nodeId=start.nodes[0];if(start.nodes[0]==end.nodes[0]||start.nodes[0]==end.nodes[end.nodes.length-1]){nodeId=start.nodes[0]}else if(start.nodes[start.nodes.length-1]==end.nodes[0]||start.nodes[start.nodes.length-1]==end.nodes[end.nodes.length-1]){nodeId=start.nodes[start.nodes.length-1]}var num=iD.TopoEntity().getRoadIsInCrossParentWaysNum(context.graph().entity(nodeId),context.graph());if(2<num){if(!isUnicomInnerMember(nodeId,start,end,context)){Dialog.alert("\u5408\u5E76\u9053\u8DEF\u5BFC\u81F4\u88AB\u7EFC\u5408\u7684\u7ED3\u70B9\u95F4\u9053\u8DEF\u4E0D\u8FDE\u901A\uFF0C\u4E0D\u80FD\u6267\u884C\u8BE5\u7F16\u8F91");return false}}if(0!=num&&3==num){Dialog.alert(iD.alert.tip.operation_create_fake_node_in_crossnode,function(){context.enter(iD.modes.Select(context,[nodeId]).suppressMenu(true))});return false}else{return true}}var isMergeCyclic=function(start,end){var mapTool={};mapTool[start.first()]=1;mapTool[start.last()]=1;mapTool[end.first()]=mapTool[end.first()]?mapTool[end.first()]+1:1;mapTool[end.last()]=mapTool[end.last()]?mapTool[end.last()]+1:1;var flag=false;var mapWay={};for(var key in mapTool){if(1==mapTool[key]){context.graph().parentWays(context.graph().entity(key)).forEach(function(way){if(!flag){if(!mapWay[way.id]){mapWay[way.id]=1}else{flag=true}}})}}return flag};var operation=function(){annotation=t("operations."+anotion+".annotation",{n:selectedIDs.length});if(!join.disabled(context.graph())){action=join}else if(!merge.disabled(context.graph())){action=merge}else{action=mergePolygon}var graph=context.graph();var start=graph.entity(selectedIDs[0]);if(iD.Layers.getLayer(start.layerId).isRoad()){var end=graph.entity(selectedIDs[1]);if(isRoadMerge(start,end)){action=merge;performAction(start.id)}}else{performAction()}};var performAction=function(wayId){action.wayId(wayId);context.perform(action,annotation);context.enter(iD.modes.Select(context,selectedIDs.filter(function(id){return context.hasEntity(id)})).suppressMenu(true))};var isEditable=function(_){var editable=true;for(var i=0;i<_.length;i++){var entity=context.graph().entity(_[i]),modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);editable=modelConfig.editable;if(!editable)return false}return editable};operation.available=function(){if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;var entity=context.entity(selectedIDs[0]);var editable=isEditable(selectedIDs);if(entity.modelName!=iD.data.DataType.ROAD||"node"===entity.type||entity.isArea&&entity.isArea()||2!=selectedIDs.length||availableCrossWay()){return false}for(var d of _.map(selectedIDs,context.entity)){if(!iD.util.entityInPlyGon(d,context)){return false}}if(1<selectedIDs.length){var id1=selectedIDs[0],id2=selectedIDs[1];var e1=context.graph().entity(id1),e2=context.graph().entity(id2);var e1f=e1.first(),e2f=e2.first(),e1l=e1.last(),e2l=e2.last();var sp="";if(e1f===e2f&&e1l===e2l||e1l===e2f&&e1f===e2l){return false}}return editable&&iD.Layers.getLayer(entity.layerId,entity.modelName).editable&&2<=selectedIDs.length&&!operation.disabled()};operation.disabled=function(){return join.disabled(context.graph())&&merge.disabled(context.graph())&&mergePolygon.disabled(context.graph())};operation.tooltip=function(){var j=join.disabled(context.graph()),m=merge.disabled(context.graph()),p=mergePolygon.disabled(context.graph());if("restriction"===j&&m&&p)return t("operations."+anotion+".restriction",{relation:context.presets().item("type/restriction").name()});if("incomplete_relation"===p&&j&&m)return t("operations."+anotion+".incomplete_relation");if(j&&m&&p)return t("operations."+anotion+"."+j);return t("operations."+anotion+".description")};operation.id="merge";operation.keys=[t("operations."+anotion+".key")];operation.title=t("operations."+anotion+".title");return operation};;;iD.operations.WayMerge=function(selectedIDs,context){var join=iD.actions.WayJoin(selectedIDs),merge=iD.actions.WayMerge(selectedIDs),mergePolygon=iD.actions.MergePolygon(selectedIDs);var operation=function(){var annotation=t("operations.merge.annotation",{n:selectedIDs.length}),action;if(!join.disabled(context.graph())){action=join}else if(!merge.disabled(context.graph())){action=merge}else if(!mergePolygon.disabled(context.graph())){action=mergePolygon}if(!action){return false}context.mode().setSelectedIDs([]);context.perform(action,annotation);context.event.entityedite({entitys:[]});context.enter(iD.modes.Browse(context));return true};operation.available=function(){if(2>selectedIDs.length){return false}for(let i=0,len=selectedIDs.length;i<len;i++){var entity=context.entity(selectedIDs[i]);if(!iD.util.entityInPlyGon(entity,context)){return false}var editable=iD.Layers.getLayer(entity.layerId,entity.modelName).editable;if(!editable||entity.modelName==iD.data.DataType.ROAD||"node"===entity.type||entity.isArea()){return false}}return true&&!operation.disabled()};operation.disabled=function(){return join.disabled(context.graph())&&merge.disabled(context.graph())&&mergePolygon.disabled(context.graph())};operation.tooltip=function(){var j=join.disabled(context.graph()),m=merge.disabled(context.graph()),p=mergePolygon.disabled(context.graph());if("restriction"===j&&m&&p)return t("operations.merge.restriction",{relation:context.presets().item("type/restriction").name()});if("incomplete_relation"===p&&j&&m)return t("operations.merge.incomplete_relation");if(j&&m&&p)return t("operations.merge."+j);return t("operations.merge.description")};operation.id="merge";operation.keys=[t("operations.merge.key")];operation.title=t("operations.merge.title");return operation};;;iD.operations.Move=function(selectedIDs,context){function adasControl(){var adasRoads=[];selectedIDs.forEach(function(id){var activeEntity=context.graph().entity(id);if(activeEntity instanceof iD.Way&&iD.data.DataType.HIGHWAY&&activeEntity.modelName&&"undefined"!=typeof activeEntity.tags.adas&&"0"!=activeEntity.tags.adas&&iD.Adas.isAdasRoad(id)){adasRoads.push(id)}});if(adasRoads&&1<=adasRoads.length){var adasPasswordTip=iD.ui.AdasPasswordTip(context,passwordRight,passwordWrong,adasRoads);adasPasswordTip.perform("\u5C06\u8981\u4FEE\u6539\u7684\u9053\u8DEF\u662F\u9AD8\u7CBE\u9053\u8DEF\uFF0C\u8BF7\u8F93\u5165\u5BC6\u7801\uFF1A")}function passwordRight(adasRoads){iD.Adas.addAdaRoad(adasRoads)}function passwordWrong(){context.enter(iD.modes.Browse(context))}}var extent=selectedIDs.reduce(function(extent,id){return extent.extend(context.entity(id).extent(context.graph()))},iD.geo.Extent());var annotation=1===selectedIDs.length?t("operations.move.annotation."+context.geometry(selectedIDs[0])):t("operations.move.annotation.multiple");var operation=function(){adasControl();context.enter(iD.modes.Move(context,selectedIDs))};operation.available=function(){if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;var entity;for(let i=0;i<selectedIDs.length;i++){entity=context.entity(selectedIDs[i]);if(entity.modelName!=iD.data.DataType.ROAD)return false;if(!iD.Layers.getLayer(entity.layerId,entity.modelName).editable||context.isOneRoadCrossWay(entity)||context.isPlaceName(entity)||context.isQcTag(entity))return false}return;(1<selectedIDs.length||entity.modelName&&entity.modelName==iD.data.DataType.ROAD&&"way"==entity.type)&&!operation.disabled()};operation.disabled=function(){var reason;return iD.actions.Move(selectedIDs).disabled(context.graph())||reason};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.move."+disable):annotation};operation.id="move";operation.keys=[t("operations.move.key")];operation.title=t("operations.move.title");return operation};iD.overoperations.Move=function(selected,context){var operation=function(){context.enter(iD.modes.NewMove(context,selected))};operation.available=function(){if(selected instanceof iD.Marker||!selected.editable)return false;return"m"==selected.vertices?false:true};operation.disabled=function(){return false};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.move."+disable):t("operations.move.description")};operation.id="move";operation.keys=[t("operations.move.key")];operation.title=t("operations.move.title");return operation};;;iD.operations.Rotate=function(selectedIDs,context){if(selectedIDs.length){var entityId=selectedIDs[0],entity=context.entity(entityId),extent=entity.extent(context.graph()),geometry=context.geometry(entityId)}var operation=function(){context.enter(iD.modes.RotateWay(context,entityId))};operation.available=function(){var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!modelConfig.editable)return false;if(1!==selectedIDs.length||"way"!==entity.type)return false;if("area"===geometry){if(entity.modelName!=iD.data.DataType.OBJECT_PG)return false;return true&&!operation.disabled()}if(entity.isClosed()&&context.graph().parentRelations(entity).some(function(r){return r.isMultipolygon()}))return true&&!operation.disabled();return false};operation.disabled=function(){var layer=iD.Layers.getLayer(entity.layerId);if(!iD.Layers.getLayerModelEditable(layer,entity.modelName)){return true}if(0.8>extent.percentContainedIn(context.extent())){return"too_large"}else{return false}};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.rotate."+disable):t("operations.rotate.description")};operation.id="rotate";operation.keys=[t("operations.rotate.key")];operation.title=t("operations.rotate.title");return operation};;;iD.operations.Reverse=function(selectedIDs,context){var entityId=selectedIDs[0];var operation=function(){context.perform(iD.actions.Reverse(entityId),t("operations.reverse.annotation"))};operation.available=function(){return false;var entity=context.entity(selectedIDs[0]);if(!iD.Layers.getLayer(entity.layerId,entity.modelName).editable)return false;return 1===selectedIDs.length&&"line"===context.geometry(entityId)&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.reverse.description")};operation.id="reverse";operation.keys=[t("operations.reverse.key")];operation.title=t("operations.reverse.title");return operation};;;iD.operations.Split=function(selectedIDs,context){var aType="line";var vertices=_.filter(selectedIDs,function vertex(entityId){return"vertex"===context.geometry(entityId)});var entityId=vertices[0],action=iD.actions.Split(entityId);if(1<selectedIDs.length){action.limitWays(_.without(selectedIDs,entityId))}var operation=function(){var annotation;var ways=action.ways(context.graph());if(1===ways.length){annotation=t("operations.split.annotation."+aType)}else{annotation=t("operations.split.annotation.multiple",{n:ways.length})}var difference=context.perform(action,annotation);context.event.entityedite({entitys:[]});context.enter(iD.modes.Select(context,difference.extantIDs()))};operation.available=function(){var entity=context.entity(selectedIDs[0]),modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(context.isRoadCross(entity))return false;if(!(entity instanceof iD.Node)){return false}var parents=context.graph().parentWays(entity);if(!parents.length){return false}var isPlay=true,parentWay=parents[0];parents.forEach(function(d,i){if(!iD.util.entityInPlyGon(d,context)){isPlay=false;return}if(iD.Layers.getLayer(d.layerId,d.modelName).editable&&(d.first()===entity.id||d.last()===entity.id)){isPlay=false}});if([iD.data.DataType.DIVIDER_NODE,iD.data.DataType.ROAD_NODE].includes(entity.modelName)){return false}return!parentWay.isArea()&&modelConfig.editable&&1===vertices.length&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.split."+disable)}var ways=action.ways(context.graph());if(1===ways.length){return t("operations.split.description."+aType)}else{return t("operations.split.description.multiple")}};operation.id="split";operation.keys=[t("operations.split.key")];operation.title=t("operations.split.title");return operation};;;iD.operations.SplitDivider=function(selectedIDs,context){var vertices=_.filter(selectedIDs,function vertex(entityId){return"vertex"===context.geometry(entityId)});var entityId=vertices[0],action=iD.actions.SplitDivider(entityId,context);var operation=function(){var annotation;var ways=action.ways(context.graph());if(1===ways.length){annotation=t("operations.split.annotation.line")}else{annotation=t("operations.split.annotation.multiple",{n:ways.length})}var difference=context.perform(action,annotation);context.enter(iD.modes.Browse(context));context.event.entityedite({entitys:[]})};operation.available=function(){if(1<selectedIDs.length)return false;var entity=context.entity(selectedIDs[0]),modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(context.isRoadCross(entity))return false;if(!(entity instanceof iD.Node)){return false}if(entity.modelName!==iD.data.DataType.DIVIDER_NODE){return false}var parents=context.graph().parentWays(entity);if(!parents.length){return false}var isPlay=true,parentWay=parents[0];parents.forEach(function(d,i){if(!iD.util.entityInPlyGon(d,context)){isPlay=false;return}if(iD.Layers.getLayer(d.layerId,d.modelName).editable&&(d.first()===entity.id||d.last()===entity.id)){isPlay=false}});if(!isPlay)return false;return!parentWay.isArea()&&modelConfig.editable&&1===vertices.length&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.split."+disable)}var ways=action.ways(context.graph());if(1===ways.length){return t("operations.split.description.line")}else{return t("operations.split.description.multiple")}};operation.id="split";operation.keys=[t("operations.split.key")];operation.title=t("operations.split.title");return operation};;;iD.operations.dividerDREF=function(selectedIDs,context){var action=iD.actions.dividerDREF(selectedIDs,context);var operation=function(){var annotation=t("operations.dividerDREF.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context))};operation.available=function(){var ways=[];var modelConfig;var entity;selectedIDs.forEach(function(d,i){entity=context.entity(d);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(modelConfig&&modelConfig.editable&&entity.modelName==iD.data.DataType.DIVIDER){ways.push(d)}});return 1<ways.length&&!operation.disabled()};operation.disabled=function(){var modelConfig,entity,graph=context.graph(),i=0,len=selectedIDs.length,rLines=[];for(;i<len;i++){entity=context.entity(selectedIDs[i]);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(entity.modelName!=iD.data.DataType.DIVIDER){return"exist_othermodel"}if(modelConfig&&modelConfig.editable&&entity.modelName==iD.data.DataType.DIVIDER&&"1"==entity.tags.R_LINE){rLines.push(entity.id)}}if(!rLines.length){return"not_eligible"}var flag=false;for(let i in selectedIDs){if(flag)break;let way=graph.entity(selectedIDs[i]),maxRels=1;let relations=graph.parentRelations(way,iD.data.DataType.R_DIVIDER_DREF);if("1"==way.tags.R_LINE&&"1"==way.tags.DIRECTION){maxRels=2}if(relations.length>=maxRels){flag=true;break}relations.forEach(function(rel){var mids=_.pluck(rel.members,"id");var arr1=mids,arr2=selectedIDs;if(arr1.length<arr2.length){arr1=selectedIDs;arr2=mids}if(0==_.difference(arr1,arr2).length){flag=true}})}if(flag){return"exist_relation"}return false};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.dividerDREF."+disable)}return t("operations.dividerDREF.description.line")};operation.id="dividerDREF";operation.keys=[t("operations.dividerDREF.key")];operation.title=t("operations.dividerDREF.title");return operation};;;iD.operations.createdividerOPL=function(selectedIDs,context){var action=iD.actions.createdividerOPL(selectedIDs,context);var operation=function(){var annotation=t("operations.createdividerOPL.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context))};operation.available=function(){var ways=[];var modelConfig;var entity;selectedIDs.forEach(function(d,i){entity=context.entity(d);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!modelConfig.editable){return true}if(entity.modelName==iD.data.DataType.OBJECT_PL||entity.modelName==iD.data.DataType.DIVIDER&&"1"==entity.tags.R_LINE){ways.push(entity)}});return 1<selectedIDs.length&&2==_.uniq(_.pluck(ways,"modelName")).length&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.createdividerOPL."+disable)}return t("operations.createdividerOPL.description.line")};operation.id="createdividerOPL";operation.keys=[t("operations.createdividerOPL.key")];operation.title=t("operations.createdividerOPL.title");return operation};;;iD.operations.cancledividerOPL=function(selectedIDs,context){var action=iD.actions.deleteDividerOPL(selectedIDs,context);var operation=function(){var annotation=t("operations.cancledividerOPL.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context))};function relation(){}operation.available=function(){var isvisible=false;if(1<selectedIDs.length){return isvisible}var entity=context.entity(selectedIDs[0]);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!modelConfig.editable){return isvisible}if(entity.modelName==iD.data.DataType.OBJECT_PL){isvisible=true}return isvisible&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.cancledividerOPL."+disable)}return t("operations.cancledividerOPL.description.line")};operation.id="cancledividerOPL";operation.keys=[t("operations.cancledividerOPL.key")];operation.title=t("operations.cancledividerOPL.title");return operation};;;iD.operations.createdividerOPG=function(selectedIDs,context){var action=iD.actions.createdividerOPG(selectedIDs,context);var operation=function(){var annotation=t("operations.createdividerOPG.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context))};operation.available=function(){var ways=[];var modelConfig;var entity;selectedIDs.forEach(function(d,i){entity=context.entity(d);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!modelConfig.editable){return true}if(entity.modelName==iD.data.DataType.OBJECT_PG||entity.modelName==iD.data.DataType.DIVIDER&&"1"==entity.tags.R_LINE){ways.push(entity)}});return 1<selectedIDs.length&&2==_.uniq(_.pluck(ways,"modelName")).length&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.createdividerOPG."+disable)}return t("operations.createdividerOPG.description.line")};operation.id="createdividerOPG";operation.keys=[t("operations.createdividerOPG.key")];operation.title=t("operations.createdividerOPG.title");return operation};;;iD.operations.cancledividerOPG=function(selectedIDs,context){var action=iD.actions.deleteDividerOPG(selectedIDs,context);var operation=function(){var annotation=t("operations.cancledividerOPG.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context))};function relation(){}operation.available=function(){var isvisible=false;if(1<selectedIDs.length){return isvisible}var entity=context.entity(selectedIDs[0]);var modelConfig=iD.Layers.getLayer(entity.layerId);if(!modelConfig||!modelConfig.editable){return isvisible}if(entity.modelName==iD.data.DataType.OBJECT_PG){isvisible=true}return isvisible&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.cancledividerOPG."+disable)}return t("operations.cancledividerOPG.description.line")};operation.id="cancledividerOPG";operation.keys=[t("operations.cancledividerOPG.key")];operation.title=t("operations.cancledividerOPG.title");return operation};;;iD.operations.createdividerVirtualLane=function(selectedIDs,context){var action=iD.actions.createdividerVirtualLane(selectedIDs,context);var operation=function(){var annotation=t("operations.createdividerVirtualLane.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context));context.event.entityedite()};operation.available=function(){return false;return!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.createdividerVirtualLane."+disable)}return t("operations.createdividerVirtualLane.description.line")};operation.id="createdividerVirtualLane";operation.keys=[t("operations.createdividerVirtualLane.key")];operation.title=t("operations.createdividerVirtualLane.title");return operation};;;iD.operations.createdividerVirtualLaneCircle=function(selectedIDs,context){var action=iD.actions.createdividerVirtualLaneCircle(selectedIDs,context);var operation=function(){var annotation=t("operations.createdividerVirtualLaneCircle.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context));context.event.entityedite()};operation.available=function(){return!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.createdividerVirtualLaneCircle."+disable)}return t("operations.createdividerVirtualLaneCircle.description.line")};operation.id="createdividerVirtualLaneCircle";operation.keys=[t("operations.createdividerVirtualLaneCircle.key")];operation.title=t("operations.createdividerVirtualLaneCircle.title");return operation};;;iD.operations.jnuction=function(selectedIDs,context){var action=iD.actions.junction(selectedIDs,context);var operation=function(){var annotation=t("operations.junction.annotation");context.perform(action,annotation);context.enter(iD.modes.Browse(context))};operation.available=function(){var ways=[];var modelConfig;var entity;selectedIDs.forEach(function(d,i){entity=context.entity(d);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(modelConfig&&modelConfig.editable&&entity.modelName==iD.data.DataType.DIVIDER){ways.push(d)}});return 1<ways.length&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.junction."+disable)}return t("operations.junction.description")};operation.id="junction";operation.keys=[t("operations.junction.key")];operation.title=t("operations.junction.title");return operation};;;iD.operations.cancelRelations=function(selectedIDs,context){var action=iD.actions.cancelRelations(selectedIDs,context);var operation=function(){var annotation=t("operations.cancelRelations.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context))};function relation(){}operation.available=function(){var isvisible=false;if(1<selectedIDs.length){return isvisible}var entity=context.entity(selectedIDs[0]);var modelConfig=iD.Layers.getLayer(entity.layerId);if(!modelConfig||!modelConfig.editable){return isvisible}if(entity.modelName==iD.data.DataType.DIVIDER||entity.modelName==iD.data.DataType.ROAD){isvisible=true}return isvisible&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.cancelRelations."+disable)}return t("operations.cancelRelations.description.line")};operation.id="cancelRelations";operation.keys=[t("operations.cancelRelations.key")];operation.title=t("operations.cancelRelations.title");return operation};;;iD.operations.cancelDividerJunction=function(selectedIDs,context){var action=iD.actions.deleteDividerJunction(selectedIDs,context);var operation=function(){var annotation=t("operations.cancelDividerJunction.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context))};function relation(){}operation.available=function(){var isvisible=false;if(1<selectedIDs.length){return isvisible}var entity=context.entity(selectedIDs[0]);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!modelConfig.editable){return isvisible}if(entity.modelName==iD.data.DataType.JUNCTION){isvisible=true}return isvisible&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.cancelDividerJunction."+disable)}return t("operations.cancelDividerJunction.description.line")};operation.id="cancelDividerJunction";operation.keys=[t("operations.cancelDividerJunction.key")];operation.title=t("operations.cancelDividerJunction.title");return operation};;;iD.operations.roadDivider=function(selectedIDs,context){var action=iD.actions.roadDivider(selectedIDs,context);var operation=function(){var annotation=t("operations.road_divider.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context))};operation.available=function(){var ways=[];var modelConfig;var entity;selectedIDs.forEach(function(d,i){entity=context.entity(d);modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(modelConfig&&modelConfig.editable&&entity.modelName==iD.data.DataType.DIVIDER){ways.push(d)}});return 0<ways.length&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.road_divider."+disable)}return t("operations.road_divider.description.line")};operation.id="road_divider";operation.keys=[t("operations.road_divider.key")];operation.title=t("operations.road_divider.title");return operation};;;iD.operations.UpdateDividerNode=function(selectedIDs,context){var annotation;var action=iD.actions.UpdateDividerNode(selectedIDs,context);var operation=function(){annotation=t("operations.update_divider_node.annotation");var difference=context.perform(action,annotation);context.event.entityedite({entitys:selectedIDs});context.enter(iD.modes.Browse(context))};operation.available=function(){let isPlay=true,entity;selectedIDs.forEach(d=>{entity=context.entity(d);var modelConfig=iD.Layers.getLayer(entity.layerId);if(!modelConfig||!modelConfig.editable||entity.modelName!=iD.data.DataType.DIVIDER){isPlay=false}});return isPlay&&!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){var disable=operation.disabled();if(disable){return t("operations.update_divider_node."+disable)}return t("operations.update_divider_node.description")};operation.id="update_divider_node";operation.keys=[t("operations.update_divider_node.key")];operation.title=t("operations.update_divider_node.title");return operation};;;iD.operations.Clone=function(selectedIDs,context){var action=iD.actions.CloneMultiple(selectedIDs,context.projection,context);var layer=iD.Layers.getLayer(context.entity(selectedIDs[0]).layerId);var operation=function(){var annotation;if(layer.isRoad()){annotation=t("operations.clone.annotation-road")}else if(layer.isLine()){annotation=t("operations.clone.annotation-way")}context.perform(action,annotation)};operation.available=function(){return false;if(1!==selectedIDs.length)return false;var firstEntity=context.entity(selectedIDs[0]);if("node"==firstEntity.type||context.isOneRoadCrossWay(firstEntity))return false;return false};operation.disabled=function(){return false};operation.tooltip=function(){if(layer.isRoad())return t("operations.clone.description-road");else if(layer.isLine())return t("operations.clone.description-way")};operation.id="clone";operation.keys=[iD.ui.cmd("L")];if(layer&&layer.isRoad())operation.title=t("operations.clone.title-road");else if(layer&&layer.isLine())operation.title=t("operations.clone.title-way");return operation};;iD.operations.Copy=function(selectedIDs,context){var action=iD.actions.CloneMultiple(selectedIDs,context.projection,context,"copy");var operation=function(){var annotation=t("operations.copy.annotation");context.perform(action,annotation);var newWayIds=context._newCopyLinedIds;_.uniq(newWayIds).forEach(function(id){var entity=context.graph().entity(id);context.replace(iD.actions.MoveLineSplitTuFu(context,entity),annotation)})};operation.available=function(){return false;var layer=context.layers().getLayer();if(0===selectedIDs.length||!layer)return false;for(let sid of selectedIDs){let entity=context.hasEntity(sid);if(entity&&entity instanceof iD.Way){if(entity.isArea()){return false}}else{return false}}var firstEntity=context.entity(selectedIDs[0]);if("node"==firstEntity.type)return false;var lay=iD.Layers.getLayer(firstEntity.layerId);var modelConfig=iD.Layers.getLayer(firstEntity.layerId,firstEntity.modelName);if(lay.isLine()&&!modelConfig.editable){return true&&!operation.disabled()}return false&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.copy.description")};operation.id="copy";operation.keys=[iD.ui.cmd("C")];operation.title=t("operations.copy.title");return operation};;iD.operations.Traffic=function(selectionIDs,context){var selectId=selectionIDs[0];var _this={};_this.disable=false;var operation=function(){context.transportation.set(selectId);context.enter(iD.modes.Select(context,selectionIDs))};operation.available=function(){if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;var entity=context.entity(selectId);if(entity.modelName!=iD.data.DataType.ROAD)return false;var editable;var layer;var geometry=context.geometry(selectId);var editable="check"==d3.select("body").attr("role")||iD.Layers.getLayer(entity.layerId,entity.modelName).editable;if(1!=selectionIDs.length){return false}layer=iD.Layers.getLayer(entity.layerId);var isRoadLayer=false;if(!layer){return false}else{isRoadLayer=layer.isRoad?layer.isRoad():false}if(!isRoadLayer){return editable&&isRoadLayer&&!operation.disabled()}if(entity instanceof iD.Way){var way=entity;var w_nodes=way.nodes,len=w_nodes.length,n_cross_node=context.graph().parentRelations(context.graph().entity(w_nodes[0]),iD.data.DataType.C_NODECONN),e_cross_node=context.graph().parentRelations(context.graph().entity(w_nodes[len-1]),iD.data.DataType.C_NODECONN);if(!_.isEmpty(n_cross_node)&&!_.isEmpty(e_cross_node)&&n_cross_node.id===e_cross_node.id){_this.disable=true}}if(context.isOneRoadCrossWay(entity)){return false}return editable&&"line"==geometry&&!operation.disabled()};operation.disabled=function(){return _this.disable};operation.tooltip=function(){return t("operations.traffic.description")};operation.id="traffic";operation.keys=[t("operations.traffic.key")];operation.title=t("operations.traffic.title");return operation};;iD.operations.SplitRoad=function(selectedIDs,context){var layer=context.layers().getLayer(context.entity(selectedIDs[0]).layerId),action=iD.actions.SplitRoad(selectedIDs,context);function isTerminal(entity){var parents=context.graph().parentWays(entity),isTer=false;parents.forEach(function(d,i){if(d.first()===entity.id||d.last()===entity.id)isTer=true;if(!iD.Layers.getLayer(d.layerId,d.modelName).editable){isTer=true}});return isTer}function multipleNodes(){var isAllNode=true;_.uniq(selectedIDs).forEach(function(id){var node=context.entity(id),geometry=context.geometry(id);var ways=context.graph().parentWays(node);var way=ways[0];if("vertex"!==geometry&&node.modelName==iD.data.DataType.ROAD_NODE){isAllNode=false}});return isAllNode}var operation=function(){var annotation=t("operations.split.annotation.road");context.perform(action,annotation)};operation.available=function(){var entity=context.entity(selectedIDs[0]);if("node"!=entity.type){return false}let parentways=context.graph().parentWays(entity);if(!parentways.length){return false}var isout=false;parentways.forEach(function(d){if(!iD.util.entityInPlyGon(d,context)){isout=true;return}});if(isout)return false;if(parentways[0].modelName!=iD.data.DataType.ROAD)return false;var isTerm=false;selectedIDs.forEach(function(id){var entity=context.entity(id);if(isTerminal(entity))isTerm=true});if(isTerm)return false;if(multipleNodes())return true&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.split.description.road")};operation.id="split-road";operation.keys=[t("operations.split.key")];operation.title=t("operations.split.title");return operation};;iD.operations.RoadIntersect=function(selectedIDs,context){var lnglat;var operation=function(){var action=iD.actions.RoadIntersect(selectedIDs,context,lnglat),annotation=t("operations.intersect.annotation.road");context.perform(action,annotation);context.enter(iD.modes.Browse(context));context.event.entityedite({entitys:[]})};operation.available=function(){if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;if(2>selectedIDs.length)return false;let layer=iD.Layers.getLayer(context.entity(selectedIDs[0]).layerId);if(layer&&!layer.isRoad())return false;var hasSameNode=function(wayA,wayB){var hasSameNode=false;var wayA_fNode=wayA.nodes[0];var wayA_tNode=wayA.nodes[wayA.nodes.length-1];var wayB_fNode=wayB.nodes[0];var wayB_tNode=wayB.nodes[wayB.nodes.length-1];if(wayA_fNode==wayB_fNode||wayA_fNode==wayB_tNode||wayA_tNode==wayB_fNode||wayA_tNode==wayB_tNode){hasSameNode=true;return hasSameNode}return hasSameNode};var isAvailable=function(selectedIDs){var isAvailable=false;for(var i=0;i<selectedIDs.length;i++){for(var j=i+1;j<selectedIDs.length;j++){var wayA=context.graph().entity(selectedIDs[i]);var wayB=context.graph().entity(selectedIDs[j]);if(!hasSameNode(wayA,wayB)){isAvailable=true}}}return isAvailable};var isEditable=function(selectedIDs){for(var i=0;i<selectedIDs.length;i++){var entity=context.graph().entity(selectedIDs[i]);var editable=iD.Layers.getLayer(entity.layerId,entity.modelName).editable;if(editable)return true}return false};lnglat=context.map().mouseCoordinates();var legal=true;selectedIDs.forEach(function(id){!(context.entity(id).modelName==iD.data.DataType.DIVIDER)&&(legal=false)});return isEditable(selectedIDs)&&legal&&isAvailable(selectedIDs)&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.intersect.description.road")};operation.id="intersect-road";operation.keys=[t("operations.intersect.key")];operation.title=t("operations.intersect.title");return operation};;iD.operations.Expand=function(selectedIDs,context){var layer;if(selectedIDs.length){layer=iD.Layers.getLayer(context.entity(selectedIDs[0]).layerId)}var roadExpandTip=iD.ui.RoadExpandTip(context);var userInputParam={left:"",right:"",originalRoadTag:""};var action=iD.actions.ExpandRoad(selectedIDs,context.projection,context);var annotation;var operation=function(){if(layer.isRoad()){annotation=t("operations.expand.annotation-road")}else if(layer.isLine()){annotation=t("operations.expand.annotation-way")}roadExpandTip.perform(context.container(),expandRoad)};var expandRoad=function(userInputParam){action.setUserInputParam(userInputParam);if(!userInputParam.originalRoadTag){context.enter(iD.modes.Browse(context))}context.perform(action,annotation);context.event.entityedite({entitys:[]})};var isEditable=function(_){var editable=true;for(var i=0;i<_.length;i++){var entity=context.graph().entity(_[i]),modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);editable=modelConfig&&modelConfig.editable;if(!editable)return false}return editable};operation.available=function(){if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;var entity=context.entity(selectedIDs[0]);if(entity.modelName!=iD.data.DataType.DIVIDER&&entity.modelName!=iD.data.DataType.ROAD)return false;var editable=isEditable(selectedIDs);if(1>selectedIDs.length){return false}var count=0;for(var i=0;i<selectedIDs.length;i++){var selectedID=selectedIDs[i];var firstEntity=context.graph().entity(selectedID),lay=iD.Layers.getLayer(firstEntity.layerId),modelConfig=iD.Layers.getLayer(firstEntity.layerId,firstEntity.modelName);if("node"==firstEntity.type||context.isOneRoadCrossWay(firstEntity))return false;if(lay.isLine()&&modelConfig.editable){count++}}return editable&&1<=count&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){if(layer.isRoad())return t("operations.expand.description-road");else if(layer.isLine())return t("operations.expand.description-way")};operation.id="expand";operation.keys=[iD.ui.cmd("Z")];if(!layer){operation.title=t("operations.expand.title-road")}else if(layer.isRoad())operation.title=t("operations.expand.title-road");else if(layer.isLine())operation.title=t("operations.expand.title-way");return operation};;iD.operations.TopoSplit=function(selectedIDs,context){var operation=function(){context.enter(iD.modes.TopoSplit(context,selectedIDs))};var layer=iD.Layers.getLayer(context.entity(selectedIDs[0]).layerId);operation.available=function(){if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;var graph=context.graph();var entity=context.entity(selectedIDs[0]);if("2"==entity.tags.FORM_WAY||entity.modelName!=iD.data.DataType.HIGHWAY)return false;var editable=iD.Layers.getLayer(entity.layerId,entity.modelName).editable;if(1!==selectedIDs.length)return false;var firstEntity=context.entity(selectedIDs[0]),lay=iD.Layers.getLayer(firstEntity.layerId),modelConfig=iD.Layers.getLayer(firstEntity.layerId,firstEntity.modelName);if("node"==firstEntity.type||context.isOneRoadCrossWay(firstEntity))return false;if((lay.isLine()||lay.isRoad())&&modelConfig.editable){var fNodeEntity=graph.entity(entity.nodes[0]);var tNodeEntity=graph.entity(entity.nodes[entity.nodes.length-1]);var parentWaysA=graph.parentWays(fNodeEntity);var parentWaysB=graph.parentWays(tNodeEntity);return editable&&(1<parentWaysA.length||1<parentWaysB.length)&&true&&!operation.disabled()}return false&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){if(layer&&layer.isRoad())return t("operations.topo_split.description-road");else if(layer&&layer.isLine())return t("operations.topo_split.description-way")};operation.id="topo_split";operation.keys=[iD.ui.cmd("T")];if(layer&&layer.isRoad())operation.title=t("operations.topo_split.title-road");else if(layer&&layer.isLine())operation.title=t("operations.topo_split.title-way");return operation};;;iD.operations.RoadsMove=function(selectedIDs,context){var operation=function(){var entities=[];var annotation=t("operations.roadsmove.annotation.road"),action=iD.actions.CloneRoadWay(context.selectedIDs(),undefined,context,entities);context.perform(action,annotation);context.enter(iD.modes.Move(context,entities))};operation.available=function(){return false;var layer=context.layers().getLayer(context.entity(selectedIDs[0]).layerId),graph=context.graph();if(layer&&!layer.isRoad()||2>selectedIDs.length)return false;var legal=true;selectedIDs.forEach(function(id){!("line"===context.entity(id).geometry(graph))&&(legal=false)});return legal&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.roadsmove.description.road")};operation.id="roadsmove";operation.keys=[t("operations.roadsmove.key")];operation.title=t("operations.roadsmove.title");return operation};;iD.operations.CloneTags=function(selectedIDs,context){var isEditable=function(_){var editable=true;for(var i=0;i<_.length;i++){var entity=context.graph().entity(_[i]),modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);editable=modelConfig.editable;if(!editable)return false}return editable};var operation=function(){context.storage("s_map_editor_copy_wayId",selectedIDs[0]);context.enter(iD.modes.Browse(context))};operation.available=function(){if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;var entity=context.entity(selectedIDs[0]);if(entity.modelName!=iD.data.DataType.ROAD)return false;var editable=isEditable(selectedIDs);var layer=iD.Layers.getLayer(entity.layerId),graph=context.graph();if(layer&&!layer.isRoad()||1!==selectedIDs.length)return false;var legal=true;selectedIDs.forEach(function(id){!("line"===context.entity(id).geometry(graph))&&(legal=false)});return editable&&legal&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.clone_tags.description.road")};operation.id="clone_tags-road";operation.keys=[t("operations.clone_tags.key")];operation.title=t("operations.clone_tags.title");return operation};;iD.operations.PasteTags=function(selectedIDs,context){var operation=function(){context.container().call(iD.ui.TagsClone(context,iD.data.DataType.ROAD).selectedIDs(selectedIDs))};var isEditable=function(_){var editable=true;for(var i=0;i<_.length;i++){var entity=context.graph().entity(_[i]);editable=iD.Layers.getLayer(entity.layerId,entity.modelName).editable;if(!editable)return false}return editable};operation.available=function(){if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;var entity=context.entity(selectedIDs[0]);if(entity.modelName!=iD.data.DataType.ROAD)return false;var layer=iD.Layers.getLayer(entity.layerId),graph=context.graph();if(layer&&!layer.isRoad()||!localStorage.getItem("s_map_editor_copy_wayId"))return false;var legal=true;selectedIDs.forEach(function(id){!("line"===context.entity(id).geometry(graph))&&(legal=false)});return isEditable(selectedIDs)&&legal&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.paste_tags.description.road")};operation.id="paste_tags-road";operation.keys=[t("operations.paste_tags.key")];operation.title=t("operations.paste_tags.title");return operation};;iD.operations.DeleteSlope=function(selectedIDs,context){var operation=function(){var annotation,nextSelectedID=[];var slopesIds=[];for(var i=0;i<selectedIDs.length;i++){if(context.entity(selectedIDs[i])instanceof iD.Way&&context.entity(selectedIDs[i]).tags&&context.entity(selectedIDs[i]).modelName==iD.data.DataType.HIGHWAY){var slopes=context.entity(selectedIDs[i]).getSlopes(context.graph());slopes.forEach(function(slope){slopesIds.push(slope.id)})}if(context.entity(selectedIDs[i]).tags&&context.entity(selectedIDs[i]).modelName==iD.data.DataType.DETAILSLOPE){nextSelectedID.push(selectedIDs[i])}}if(nextSelectedID&&context.hasEntity(nextSelectedID)){context.enter(iD.modes.Select(context,[nextSelectedID]))}else{context.enter(iD.modes.Browse(context))}if(0<selectedIDs.length){annotation=t("operations.delete_slope.annotation",{n:slopesIds.length})}var action=iD.actions.DeleteMultiple(slopesIds);context.perform(action,annotation)};operation.available=function(){var entity=context.entity(selectedIDs[0]);if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(modelConfig&&modelConfig.editable){for(var i=0;i<selectedIDs.length;i++){if("way"==context.entity(selectedIDs[i]).type&&context.entity(selectedIDs[i]).tags&&context.entity(selectedIDs[i]).modelName==iD.data.DataType.HIGHWAY){var slopes=context.entity(selectedIDs[i]).getSlopes(context.graph());if(0<slopes.length){return!operation.disabled()}}}}else{return false&&!operation.disabled()}};operation.disabled=function(){return false};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.delete_slope."+disable):t("operations.delete_slope.description")};operation.id="delete_slope";operation.keys=[];operation.title=t("operations.delete_slope.title");return operation};;;iD.operations.EditorWay=function(selectedIDs,context){var operation=function(){context.enter(iD.modes.EditorWay(context,selectedIDs))};operation.available=function(){if(!selectedIDs||1!=selectedIDs.length){return false}var entity=context.entity(selectedIDs[0]);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;if(!modelConfig.editable)return false;if(modelConfig.editable){if("way"==entity.type&&entity.modelName==iD.data.DataType.ROAD){return true&&!operation.disabled()}}return false&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){var disable=operation.disabled();return disable?t("operations.way_editor."+disable):t("operations.way_editor.description")};operation.id="way_editor";operation.keys=[iD.ui.cmd("Q")];operation.title=t("operations.way_editor.title");return operation};;;iD.operations.roadCrossCreate=function(selectedIDs,context){var graph=context.graph();var layer=context.layers().getLayer(graph.entity(selectedIDs[0]).layerId);var annotation;var operation=function(){var roadCrossNodes=[],roadNodeIds=[],roadNodes=[];selectedIDs.forEach(function(nid){let entity=graph.entity(nid);if(entity.modelName==iD.data.DataType.C_NODE){roadCrossNodes.push(entity)}else{roadNodeIds.push(entity.id);roadNodes.push(entity)}});if(1<roadCrossNodes.length){Dialog.alert("\u53EA\u80FD\u4E3A\u4E00\u4E2A\u7EFC\u5408\u4EA4\u53C9\u70B9\u8FFD\u52A0\u70B9");return}let checkUnicomIds=[];if(!roadCrossNodes[0]){checkUnicomIds=roadNodeIds}else{var relation=graph.parentRelations(roadCrossNodes[0],iD.data.DataType.R_C_NODE_ROAD_NODE)[0];if(relation){checkUnicomIds=_.uniq(roadNodeIds.concat(_.pluck(relation.members,"id")))}else{checkUnicomIds=roadNodeIds}}if(!iD.util.roadCrossExtend.isUnicomOfArr(checkUnicomIds,context)){Dialog.alert("\u88AB\u7EFC\u5408\u7684\u7ED3\u70B9\u95F4\u9053\u8DEF\u4E0D\u8FDE\u901A\uFF0C\u4E0D\u80FD\u521B\u5EFA\u8BE5\u7EFC\u5408\u4EA4\u53C9\u70B9");return}for(var i=0;i<roadNodes.length;i++){var ways=[];var node=roadNodes[i];graph.parentWays(node).forEach(function(d){if(!d.isOneRoadCrossWay()){return ways.push(d)}});if(2>ways.length){Dialog.alert("\u60AC\u6302\u70B9\u4E0D\u80FD\u7EFC\u5408\u6210\u7EFC\u5408\u4EA4\u53C9\u70B9");return}var flag=false;graph.parentRelations(node).forEach(function(rel){if(rel.tags&&rel.modelName==iD.data.DataType.R_C_NODE_ROAD_NODE){flag=true}});if(flag){Dialog.alert("\u9009\u62E9\u7684\u8282\u70B9\u4E2D\u5DF2\u7ECF\u88AB\u7EFC\u5408,\u8BF7\u9009\u62E9\u5176\u5B83\u8282\u70B9");context.enter(iD.modes.Browse(context));return}}var action=iD.actions.RoadCrossAdd(context,roadNodeIds,roadCrossNodes[0]);if(!action.available()){context.enter(iD.modes.Browse(context));return}context.perform(action,t("operations.add.annotation.point"));context.enter(iD.modes.Browse(context))};operation.available=function(){if(!layer||!layer.isRoad()){return false}if(1==selectedIDs.length)return false;for(var i=0;i<selectedIDs.length;i++){var entity=context.graph().entity(selectedIDs[i]);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig.editable||!_.include([iD.data.DataType.ROAD_NODE,iD.data.Constant.C_NODE],entity.modelName)){return false}}return!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){if(layer&&layer.isRoad()){return t("operations.road_cross_create.description")}};operation.id="RoadCrossCreate";operation.keys=[iD.ui.cmd("R")];operation.title=t("operations.road_cross_create.title");return operation};;iD.operations.roadCrossModify=function(selectedIDs,context){var layer=context.layers().getLayer(context.graph().entity(selectedIDs[0]).layerId);var annotation;var operation=function(){context.enter(iD.modes.RoadCrossModify(context,selectedIDs))};operation.available=function(){if(!layer.isRoad()){return false}if(1!=selectedIDs.length)return false;var entity=context.graph().entity(selectedIDs[0]);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);return iD.data.Constant.C_NODE==entity.modelName&&modelConfig.editable&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){if(layer.isRoad()){return t("operations.road_cross_edit.description")}};operation.id="RoadCrossEdit";operation.keys=[iD.ui.cmd("F")];operation.title=t("operations.road_cross_edit.title");return operation};;iD.operations.AutoGenerateWay=function(selectedIDs,context){var operation=function(){var entity1=context.entity(selectedIDs[0]);var w1=context.graph().parentWays(entity1)[0];var newWay=iD.Way({layerId:w1.layerId,nodes:[entity1.id,selectedIDs[1]],modelName:w1.modelName,tags:iD.util.getDefauteTags(w1.modelName)});context.perform(iD.actions.AddEntity(newWay),t("operations.auto_generate_way.title"))};operation.available=function(){if(!selectedIDs||2!=selectedIDs.length){return false}var entity1=context.entity(selectedIDs[0]);var entity2=context.entity(selectedIDs[1]);if(entity2.modelName!=entity1.modelName||!(entity1 instanceof iD.Node)){return false}var w1=context.graph().parentWays(entity1);var w2=context.graph().parentWays(entity2);if(!w1.length||!w2.length){return false}let w1_modelConfig=iD.Layers.getLayer(w1[0].layerId,w1[0].modelName);let w2_modelConfig=iD.Layers.getLayer(w2[0].layerId,w2[0].modelName);if(!w1_modelConfig.editable)return false;if(!w2_modelConfig.editable)return false;if(w1[0].layerId!=w2[0].layerId){return false}for(w of w1){if(selectedIDs.includes(w.first())&&selectedIDs.includes(w.last())){return false}}for(w of w2){if(selectedIDs.includes(w.first())&&selectedIDs.includes(w.last())){return false}}if([w1[0].first(),w1[0].last()].includes(entity1.id)&&[w2[0].first(),w2[0].last()].includes(entity2.id)){return true}};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.auto_generate_way.description")};operation.id="auto_generate_way";operation.keys=[iD.ui.cmd("Q")];operation.title=t("operations.auto_generate_way.title");return operation};;;iD.operations.LamppostLREFCreate=function(selectedIDs,context,isReplace){var isReplace=!!isReplace;var operation=function(){var graph=context.graph();var poles=[],lampHolders=[],relation_ids=[];selectedIDs.forEach(function(nid){let entity=graph.entity(nid);if(1==entity.tags.TYPE){poles.push(entity)}else if(2==entity.tags.TYPE){lampHolders.push(entity)}var rel=graph.parentRelations(entity,iD.data.DataType.R_LAMPPOST_LREF)[0];rel&&relation_ids.push(rel.id)});if(!poles.length||!lampHolders.length){Dialog.alert("\u81F3\u5C11\u8981\u9009\u62E9\u4E00\u4E2A\u706F\u6746\u548C\u4E00\u4E2A\u706F\u5934");return}if(1<_.uniq(relation_ids).length){Dialog.alert("\u9009\u62E9\u7684\u70B9\u5DF2\u7ECF\u6709\u706F\u6746/\u706F\u5934\u5173\u7CFB");return}let allEntities=poles.concat(lampHolders);let members=[];for(let entity of allEntities){members.push({id:entity.id,modelName:entity.modelName,role:iD.data.RoleType.LAMPPOST_ID,type:iD.data.GeomType.NODE})}if(!relation_ids.length){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_LAMPPOST_LREF);let relation=iD.Relation({modelName:iD.data.DataType.R_LAMPPOST_LREF,members:members,layerId:currentLayer.id,tags:iD.util.getDefauteTags(iD.data.DataType.R_LAMPPOST_LREF,currentLayer)});context[isReplace?"replace":"perform"](iD.actions.AddEntity(relation),t("operations.lamppost_lref_create.title"))}else{let relation=graph.entity(relation_ids[0]);let bfMlength=relation.members.length;for(let i=0;i<members.length;i++){let m=members[i];if(!relation.memberById(m.id)){relation=relation.addMember(members[i])}}if(bfMlength==relation.members.length){Dialog.alert("\u6CA1\u6709\u5F85\u8FFD\u52A0\u7684\u70B9");return}context[isReplace?"replace":"perform"](iD.actions.EditRelation(context,[relation]),t("operations.lamppost_lref_create.title"))}context.enter(iD.modes.Browse(context))};operation.available=function(){if(2>selectedIDs.length)return false;var layerids=[];var graph=context.graph();var holder;for(var i=0;i<selectedIDs.length;i++){var entity=graph.entity(selectedIDs[i]);var layer=iD.Layers.getLayer(entity.layerId);if(0==layerids.length||-1!=_.indexOf(layerids,layer.id)){layerids.push(layer.id)}else{return false}if(entity.modelName!=iD.data.DataType.LAMPPOST){return false}if(!_.include([1,2],Number(entity.tags.TYPE))){return false}if(1==entity.tags.TYPE){if(holder){return false}holder=entity}}return layer.editable&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.lamppost_lref_create.description")};operation.id="merge";operation.keys=[iD.ui.cmd("P")];operation.title=t("operations.lamppost_lref_create.title");return operation};;iD.operations.LamppostLREFDelete=function(selectedIDs,context,isReplace){var operation=function(){var graph=context.graph();var entity=graph.entity(selectedIDs[0]);var relation=context.graph().parentRelations(entity,iD.data.DataType.R_LAMPPOST_LREF)[0];context.perform(iD.actions.DeleteRelation(relation.id),t("operations.opt_opt_delete.title"));context.enter(iD.modes.Browse(context))};operation.available=function(){var layer=context.layers().getLayerByName(iD.data.DataType.R_LAMPPOST_LREF);if(!layer||!layer.editable)return false;if(1!=selectedIDs.length)return false;var entity=context.graph().entity(selectedIDs[0]);var rels=context.graph().parentRelations(entity,iD.data.DataType.R_LAMPPOST_LREF);if(!rels.length){return false}return layer.editable&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.lamppost_lref_delete.description")};operation.id="delete";operation.keys=[iD.ui.cmd("P")];operation.title=t("operations.lamppost_lref_delete.title");return operation};;iD.operations.copyPoleLamp=function(selectedIDs,context){var COPY_PASTE_KEY="map_editor_copy_pole_lamp";var selectedTopPole,selectedRelation;var operation=function(){var graph=context.graph(),lineCal=iD.util.LineCalCulate(),baseEntity=selectedTopPole;var trackNodes=iD.picUtil.player.allNodes;var linePoint=iD.util.pt2LineDist(_.pluck(trackNodes,"loc"),baseEntity.loc);var lineAngle=lineCal.getAngle(baseEntity.loc[0],baseEntity.loc[1],linePoint.x,linePoint.y);var lampArr=_.compact(_.map(selectedRelation.members,function(m){var entity=graph.entity(m.id);if(2==entity.tags.TYPE){return entity}}));var savedList=[];for(let lamp of lampArr){let lampAngle=lineCal.getAngle(baseEntity.loc[0],baseEntity.loc[1],lamp.loc[0],lamp.loc[1]);let angleDiff=lampAngle-lineAngle;let distance=iD.util.distanceByLngLat(baseEntity.loc,lamp.loc);let zDiff=lamp.loc[2]-baseEntity.loc[2];savedList.push({angleDiff:angleDiff,lampId:lamp.id,poleId:baseEntity.id,distance:distance,zDiff:zDiff})}savedList.length&&localStorage.setItem(COPY_PASTE_KEY,JSON.stringify(savedList));context.enter(iD.modes.Browse(context))};operation.available=function(){if(1!=selectedIDs.length)return false;if(!iD.picUtil.player||!iD.picUtil.player.allNodes||!iD.picUtil.player.allNodes.length){return false}var graph=context.graph();var entity=context.entity(selectedIDs[0]);var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig||!modelConfig.editable){return false}if(entity.modelName!=iD.data.DataType.LAMPPOST||1!=entity.tags.TYPE){return false}var relations=graph.parentRelations(entity,iD.data.DataType.R_LAMPPOST_LREF);if(!relations.length)return false;selectedRelation=relations[0];selectedTopPole=entity;return!operation.disabled()};operation.disabled=function(){if(!selectedTopPole||!selectedRelation){return true}return false};operation.tooltip=function(){if(!selectedTopPole){return t("operations.copy_pole_lamp.noTopPole")}return t("operations.copy_pole_lamp.description")};operation.id="copy";operation.keys=[iD.ui.cmd("\u2318C")];operation.title=t("operations.copy_pole_lamp.title");return operation};;iD.operations.pastePoleLamp=function(selectedIDs,context){let COPY_PASTE_KEY="map_editor_copy_pole_lamp";let modelNameParam=iD.picUtil.getModelNameParam();let selectedTopPoleList=[];let handle=iD.measureinfo.handle();iD.actions.AddEntity=function(entity){return function(graph){return graph.replace(entity)}};var createMeasureinfo=(entity,opt)=>{return function(graph){return handle.addEntity(graph,entity,{type:2,method:5,data:[opt]})}};var operation=function(){var graph=context.graph(),lineCal=iD.util.LineCalCulate();let trackNodes=iD.picUtil.player.allNodes,_count=0;for(let baseEntity of selectedTopPoleList){let linePoint=iD.util.pt2LineDist(_.pluck(trackNodes,"loc"),baseEntity.loc);if(linePoint.i>=trackNodes.length-2){let temp=[];let p1=trackNodes[trackNodes.length-2],p2=trackNodes[trackNodes.length-1];let trst=iD.util.pedal([p1.loc[0],p1.loc[1],p2.loc[0],p2.loc[1]],baseEntity.loc,temp);if(!isNaN(trst)){linePoint.x=temp[0];linePoint.y=temp[1]}}let lineAngle=lineCal.getAngle(baseEntity.loc[0],baseEntity.loc[1],linePoint.x,linePoint.y);let savedList=[];try{savedList=JSON.parse(localStorage.getItem(COPY_PASTE_KEY))}catch(e){localStorage.removeItem(COPY_PASTE_KEY)}let actions=[],addedEntities=[];var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.LAMPPOST);for(let data of savedList){let angle=lineAngle+data.angleDiff;if(360<=angle){angle-=360}let lonlat=lineCal.calculateVerticalP(baseEntity.loc[0],baseEntity.loc[1],data.distance/1000,angle);let node=iD.Node({modelName:modelNameParam.LAMPPOST,layerId:currentLayer.id,tags:_.extend({},iD.util.getDefauteTags(modelNameParam.LAMPPOST,currentLayer),{TYPE:2}),loc:[lonlat.Longitude,lonlat.Latitude,baseEntity.loc[2]+data.zDiff]});let opt={angle:angle,distance:data.distance,type:"copy"};actions.push(createMeasureinfo(node,opt));actions.push(iD.actions.AddEntity(node));addedEntities.push(node.id)}context[0===_count?"perform":"replace"].apply(context,actions.concat(t("operations.paste_pole_lamp.title")));if(actions.length){let relCreate=iD.operations.LamppostLREFCreate([baseEntity.id].concat(addedEntities),context,true);if(relCreate.available()&&!relCreate.disabled()){relCreate();context.replace(iD.actions.Noop(),t("operations.paste_pole_lamp.title"))}}_count++}0<_count&&context.event.entityedite({entitys:[]});context.enter(iD.modes.Browse(context))};operation.available=function(){if(1>selectedIDs.length)return false;if(!localStorage.getItem(COPY_PASTE_KEY))return false;let trackNodes=iD.picUtil.player&&iD.picUtil.player.allNodes;if(!trackNodes||!trackNodes.length){return false}let graph=context.graph(),layerids=[];for(let entityid of selectedIDs){let entity=graph.entity(entityid);if(!_.include([iD.data.DataType.LAMPPOST],entity.modelName)){return false}var layer=iD.Layers.getLayer(entity.layerId);if(0==layerids.length||-1!=_.indexOf(layerids,layer.id)){layerids.push(layer.id)}else{return false}if(1!=entity.tags.TYPE){return false}selectedTopPoleList.push(entity)}return layer.editable&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.paste_pole_lamp.description")};operation.id="paste";operation.keys=[iD.ui.cmd("\u2318V")];operation.title=t("operations.paste_pole_lamp.title");return operation};;iD.operations.LineInfoModify=function(selectedIDs,context){var nodeLineInfo=new iD.ui.NodeLineInfo(context,context.container(),selectedIDs);var operation=function(){nodeLineInfo.show()};operation.available=function(){if(!(iD.Task.working&&iD.Task.working.task_id==iD.Task.d.task_id))return false;if(1!=selectedIDs.length)return false;var entity=context.entity(selectedIDs[0]),wrongDataFlag=false,graph=context.graph();var editable=iD.Static.layersInfo.isEditable(entity.modelName);if(editable&&entity instanceof iD.Node&&(entity.modelName==iD.data.DataType.ROAD_NODE||entity.modelName==iD.data.DataType.C_NODE)){return true&&!operation.disabled()}return false&&!operation.disabled()};operation.disabled=function(){let disabeld=nodeLineInfo.disabled(context.graph());return"not_eligible"==disabeld?"not_eligible":!disabeld};operation.tooltip=function(){var disable=operation.disabled();return"not_eligible"==disable?t("operations.line_info_modify.not_eligible"):t("operations.line_info_modify.description")};operation.id="line_info_modify";operation.keys=[iD.ui.cmd("L")];operation.title=t("operations.line_info_modify.title");return operation};;;iD.operations.createSeparationPoints=function(selectedIDs,context){let modelName=iD.data.DataType.DIVIDER_ATTRIBUTE;let projection=context.projection;let seDisArr=[3,3];function createSeparationPoints(startNode,endNode,dashTypeArr,param={}){let totalDis=iD.util.distanceByLngLat(startNode.loc,endNode.loc);param.count=param.count||0;param.dist=param.dist||0;let count=param.count||0;let nowDis=seDisArr[count%2];if(totalDis+param.dist<nowDis){param.dist+=totalDis;return[]}let angleA=iD.util.LineCalCulate().getAngle(startNode.loc[0],startNode.loc[1],endNode.loc[0],endNode.loc[1]);let addedDis=-param.dist,addedNodes=[],layer=iD.Layers.getLayer(startNode.layerId);do{nowDis=seDisArr[count%2],dashType=dashTypeArr[count%2];addedDis+=nowDis;let AB=addedDis,BC,AC;BC=Math.sin(angleA*Math.PI/180)*AB;AC=Math.cos(angleA*Math.PI/180)*AB;let newLoc=iD.util.getLngLatByOffsetMeter(startNode.loc,BC,AC);let newLonlat=[newLoc[0],newLoc[1],startNode.loc[2]];let node=iD.Node({modelName:iD.data.DataType.DIVIDER_NODE,layerId:layer.id,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.DIVIDER_NODE,layer),{DASHTYPE:dashType}),loc:newLonlat});addedNodes.push(node);count++}while(addedDis+seDisArr[count%2]<totalDis);param.count=count||0;param.dist=totalDis-addedDis;if(0>=param.dist)param.dist=0;var zDiff=startNode.loc[2]-endNode.loc[2],avgZ=zDiff/(addedNodes.length+1);var i=0;for(i=0;i<addedNodes.length;i++){addedNodes[i].loc[2]=startNode.loc[2]-avgZ*(i+1)}return addedNodes}function isEndsNode(node,wayNodes){var index=wayNodes.indexOf(node);return 0==index||index==wayNodes.length-1}var operation=function(){let graph=context.graph(),entity=context.entity(selectedIDs[0]);let relations,isFirst,wayNodes,startNode,endNode,relation,rol,startIndex,endIndex,actions=[],index=1,way=entity,_dashTypeArr=[1,2],addedNodes=[];if(entity instanceof iD.Node){relations=graph.parentRelations(entity,modelName);way=graph.parentWays(entity)[0];index=way.nodes.indexOf(entity.id);if(1==relations.length){relation=relations[0]}else{relation=graph.parentRelations(way,modelName)[0]}let dividerId=relation.memberByRole(iD.data.RoleType.DIVIDER_ID).id;if(dividerId!=way.id){return}_dashTypeArr.reverse();var typeArr=_.clone(_dashTypeArr);rol=relation.memberByRole(iD.data.RoleType.DIVIDER_NODE_ID);wayNodes=graph.childNodes(way);isFirst=way.first()==rol.id;var directionNodes=_.clone(wayNodes);if(!isFirst)directionNodes.reverse();var dirIndex=directionNodes.indexOf(wayNodes[index]);startNode=directionNodes[dirIndex];endNode=directionNodes[directionNodes.length-1];startIndex=directionNodes.indexOf(startNode);endIndex=directionNodes.indexOf(endNode);var param={};for(var i=startIndex;i<endIndex;i++){var start=directionNodes[i];var end=directionNodes[i+1];var newNodes=createSeparationPoints(start,end,typeArr,param);newNodes.length&&addedNodes.push(...newNodes)}if(addedNodes.length&&1===_.last(addedNodes).tags.DASHTYPE){addedNodes.pop()}}else if(entity instanceof iD.Way){relation=iD.util.getDividerParentRelation(graph,entity,modelName);rol=relation.memberByRole(iD.data.RoleType.DIVIDER_NODE_ID);isFirst=entity.first()==rol.id;wayNodes=graph.childNodes(entity);startNode=wayNodes[isFirst?0:1];endNode=wayNodes[isFirst?1:0];addedNodes=createSeparationPoints(startNode,endNode,_dashTypeArr)}if(addedNodes.length){if(entity instanceof iD.Way){actions.push(iD.actions.ChangeTags(startNode.id,_.extend({},startNode.tags,{DASHTYPE:_dashTypeArr[1]})));actions.push(iD.actions.ChangeTags(endNode.id,_.extend({},endNode.tags,{DASHTYPE:_dashTypeArr[addedNodes.length%2]})));actions.push(iD.actions.WayAddNodes(way.id,addedNodes,index));actions.push("\u751F\u6210\u5206\u9694\u7EBF\u8D77\u7EC8\u70B9")}else{var arr=[],i=0;for(i=startIndex+1;i<endIndex;i++){actions.push(iD.actions.ChangeTags(directionNodes[i].id,_.extend({},directionNodes[i].tags,{DASHTYPE:3})))}for(i=0;i<addedNodes.length;i++){var obj=_.assign(iD.geo.chooseEdge(wayNodes,projection(addedNodes[i].loc),projection),{node:addedNodes[i]});arr.push(obj)}var groups=_.groupBy(arr,"index");var keys=Object.keys(groups);var values=Object.values(groups);var group,wnode1,wnode2,deleteNodes=[],minDis=0.2;var insertIndex=0;actions.push(iD.actions.ChangeTags(wayNodes[index].id,_.extend({},startNode.tags,{DASHTYPE:_dashTypeArr[1]})));for(i=0;i<values.length;i++){group=_.pluck(values[i],"node");actions.push(iD.actions.WayAddNodes(way.id,group,insertIndex+~~keys[i]));insertIndex=insertIndex+group.length;wnode1=wayNodes[keys[i]-1],wnode2=wayNodes[keys[i]];if(!wnode1&&!wnode2)continue;group.forEach((n,_idx)=>{var dis=iD.util.distanceByLngLat(wnode1.loc,n.loc);if(dis<=minDis){deleteNodes.push(wnode1)}if(_idx!=group.length-1||!wnode2)return;dis=iD.util.distanceByLngLat(wnode2.loc,n.loc);if(dis<=minDis){deleteNodes.push(wnode2)}})}var deleteIds=_.pluck(deleteNodes.filter(n=>!isEndsNode(n,wayNodes)),"id");deleteIds=_.uniq(deleteIds);actions.push(iD.actions.DeleteMultiple(deleteIds,context));actions.push("\u751F\u6210\u5206\u9694\u7EBF\u8D77\u7EC8\u70B9")}}actions.length&&context.perform.apply(this,actions);context.event.entityedite({entitys:[entity.id]})};operation.available=function(){if(1!=selectedIDs.length)return false;let entity=context.entity(selectedIDs[0]);let graph=context.graph(),relation;let layer=iD.Layers.getLayer(entity.layerId);if(!layer||!layer.display||!layer.editable){return false}if(entity instanceof iD.Node){let ways=graph.parentWays(entity);if(1<ways.length||0==ways.length){return false}let relations=graph.parentRelations(ways[0],modelName);if(1<relations.length||!relations.length||"5"!=relations[0].tags.TYPE){return false}let rol=relations[0].memberByRole(iD.data.RoleType.DIVIDER_NODE_ID),wayNodes=graph.childNodes(ways[0]),isFirst=wayNodes[0].id==rol.id,index=ways[0].nodes.indexOf(entity.id),startNode=wayNodes[index];endNode=isFirst?wayNodes[wayNodes.length-1]:wayNodes[0];let totalDis=iD.util.distanceByLngLat(startNode.loc,endNode.loc);if(totalDis<=seDisArr[0]){return false}}else if(entity instanceof iD.Way){if(entity.modelName!=iD.data.DataType.DIVIDER)return false;relation=iD.util.getDividerParentRelation(graph,entity,modelName);if(2!=entity.nodes.length||!relation||"5"!=relation.tags.TYPE){return false}let nodes=context.graph().childNodes(entity);let totalDis=iD.util.distanceByLngLat(nodes[0].loc,nodes[1].loc);if(totalDis<=seDisArr[0]){return false}}else{return false}return true};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.dividerSeparation.title")};operation.id="continue";operation.keys=[iD.ui.cmd("R")];operation.title=t("operations.dividerSeparation.title");return operation};;iD.operations.createBridgePoint=function(selectedIDs,context){var bridgeLines=[],crossDividers=[];var operation=function(){var graph=context.graph(),actions=[];let dataList=[],bridgeDataList={},crossNodeList=[],lineCale=iD.util.LineCalCulate();let blineMapNodes={};bridgeLines.forEach(function(bid){let bline=context.entity(bid);crossDividers.forEach(function(did){let divider=context.entity(did);let intersectLoc=lineCale.getIntersectLoc(bline.nodes,divider.nodes,context.graph());if(intersectLoc&&intersectLoc.length){let blineNodes=[];if(blineMapNodes[bline.id]){blineNodes=blineMapNodes[bline.id]}else{blineNodes=context.graph().childNodes(bline);blineMapNodes[bline.id]=blineNodes}for(let resultLoc of intersectLoc){let result=iD.util.pt2LineDist(_.pluck(blineNodes,"loc"),resultLoc);let nodeLoc=[];if(0<=result.i&&result.i<blineNodes.length){let fnode=blineNodes[result.i],tnode=blineNodes[result.i+1];nodeLoc=iD.util.getBetweenPointLoc(fnode.loc,tnode.loc,resultLoc)}dataList.push({loc:nodeLoc,bline:bline,divider:divider,dnodeLoc:resultLoc})}}})});dataList.forEach(function(d){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.LIMITHEIGHT);let node=iD.Node({modelName:iD.data.DataType.LIMITHEIGHT,layerId:currentLayer.id,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.LIMITHEIGHT,currentLayer),{HEIHGT:d.loc[2]-d.dnodeLoc[2]||0}),loc:d.loc});crossNodeList.push(node);actions.push(iD.actions.AddEntity(node));let members=[getMembers([node])[0],getMembers([d.divider])[0]];var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_DIVIDER_LH);let relation=iD.Relation({modelName:iD.data.DataType.R_DIVIDER_LH,members:members,layerId:currentLayer.id,tags:iD.util.getDefauteTags(iD.data.DataType.R_DIVIDER_LH,currentLayer)});actions.push(iD.actions.AddEntity(relation));let bline=d.bline;if(!bridgeDataList[bline.id]){bridgeDataList[bline.id]=[]}bridgeDataList[bline.id].push(node)});var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_BRIDGE_LH);for(let blineid in bridgeDataList){let nodes=bridgeDataList[blineid];if(!nodes||!nodes.length){continue}let entity=context.entity(blineid);let members=[getMembers([entity])[0]].concat(getMembers(nodes));let relation=iD.Relation({modelName:iD.data.DataType.R_BRIDGE_LH,members:members,layerId:currentLayer.id,tags:iD.util.getDefauteTags(iD.data.DataType.R_BRIDGE_LH,currentLayer)});actions.push(iD.actions.AddEntity(relation))}context.enter(iD.modes.Browse(context));if(actions.length){context.perform.apply(context,actions.concat(t("operations.bridge_point.title")));context.event.entityedite({entitys:[]})}context.enter(iD.modes.Select(context,_.pluck(crossNodeList,"id")))};function getMembers(entitys){let members=[];entitys.forEach(function(entity){let typeName="";if(entity instanceof iD.Node){typeName=iD.data.GeomType.NODE}else if(entity instanceof iD.Way){typeName=iD.data.GeomType.WAY}else if(entity instanceof iD.Relation){typeName=iD.data.GeomType.RELATION}members.push({id:entity.id,modelName:entity.modelName,type:typeName,role:iD.data.RoleType[entity.modelName+"_ID"]})});return members}operation.available=function(){if(2>selectedIDs.length)return false;let graph=context.graph(),layer;for(var i=0;i<selectedIDs.length;i++){var entity=context.graph().entity(selectedIDs[i]);if(entity.modelName==iD.data.DataType.BRIDGE){layer=iD.Layers.getLayer(entity.layerId);let rels=graph.parentRelations(entity,iD.data.DataType.R_BRIDGE_LH);if(rels.length){return false}bridgeLines.push(entity.id)}else if(entity.modelName==iD.data.DataType.DIVIDER){crossDividers.push(entity.id)}else{return false}}if(!layer||!layer.editable)return false;if(!iD.Layers.getLayerModelEditable(layer,iD.data.DataType.LIMITHEIGHT)){return"exist_node"}return 0<bridgeLines.length&&0<crossDividers.length&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.bridge_point.description")};operation.id="bridge-point";operation.keys=[iD.ui.cmd("B")];operation.title=t("operations.bridge_point.title");return operation};;iD.operations.trafficLightTREF=function(selectedIDs,context){var selectedEntities=[];var operation=function(){let members=[];selectedEntities.forEach(function(entity){members.push({id:entity.id,modelName:entity.modelName,type:iD.data.GeomType.NODE,role:iD.data.RoleType.TRAFFICLIGHT_ID})});var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_TRAFFICLIGHT_TREF);let relation=iD.Relation({modelName:iD.data.DataType.R_TRAFFICLIGHT_TREF,members:members,layerId:currentLayer.id,tags:iD.util.getDefauteTags(iD.data.DataType.R_TRAFFICLIGHT_TREF,currentLayer)});context.perform(iD.actions.AddEntity(relation),t("operations.trafficLightTREF.title"));context.enter(iD.modes.Browse(context))};operation.available=function(){if(2>selectedIDs.length)return false;var graph=context.graph(),layerids=[],layer;var isBreak=false;selectedIDs.forEach(function(d,i){if(isBreak){return}let entity=context.entity(d);layer=iD.Layers.getLayer(entity.layerId);if(0==layerids.length||-1!=_.indexOf(layerids,layer.id)){layerids.push(layer.id)}else{return false}if(entity.modelName==iD.data.DataType.TRAFFICLIGHT){let rels=graph.parentRelations(entity,iD.data.DataType.R_TRAFFICLIGHT_TREF);if(rels&&rels.length){isBreak=true}selectedEntities.push(entity)}else{isBreak=true}});if(!layer.editable)return false;return!isBreak&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.trafficLightTREF.description")};operation.id="dividerDREF";operation.keys=[iD.ui.cmd("T")];operation.title=t("operations.trafficLightTREF.title");return operation};;;iD.operations.trafficLightTREFDelete=function(selectedIDs,context){var selectedRelations=[];var operation=function(){context.perform(iD.actions.DeleteRelation(selectedRelations[0].id),t("operations.trafficLightTREF.delete_relation"));context.enter(iD.modes.Browse(context))};operation.available=function(){if(1>selectedIDs.length)return false;var graph=context.graph(),layerids=[],layer;var isBreak=false;selectedIDs.forEach(function(d,i){if(isBreak){return}let entity=context.entity(d);layer=iD.Layers.getLayer(entity.layerId);if(0==layerids.length||-1!=_.indexOf(layerids,layer.id)){layerids.push(layer.id)}else{return false}if(entity.modelName==iD.data.DataType.TRAFFICLIGHT){let rels=graph.parentRelations(entity,iD.data.DataType.R_TRAFFICLIGHT_TREF);if(rels&&rels.length){selectedRelations.push(rels[0])}}else{isBreak=true}});if(!layer.editable)return false;selectedRelations=_.uniq(selectedRelations);return!isBreak&&1==selectedRelations.length&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.trafficLightTREF.delete_relation")};operation.id="delete";operation.keys=[iD.ui.cmd("D")];operation.title=t("operations.trafficLightTREF.delete_relation");return operation};;;iD.operations.dividerTrafficLightTREF=function(selectedIDs,context){var selectedTREF=[],selectedDivider=[];var operation=function(){let rLine=selectedDivider[0];let actions=[];var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_DIVIDER_TL);selectedTREF.forEach(function(relTREF){let members=[{id:relTREF.id,modelName:relTREF.modelName,type:iD.data.GeomType.RELATION,role:iD.data.RoleType.R_TRAFFICLIGHT_TREF_ID},{id:rLine.id,modelName:rLine.modelName,type:iD.data.GeomType.WAY,role:iD.data.RoleType.DIVIDER_ID}];let relation=iD.Relation({modelName:iD.data.DataType.R_DIVIDER_TL,members:members,layerId:currentLayer.id,tags:iD.util.getDefauteTags(iD.data.DataType.R_DIVIDER_TL,currentLayer)});actions.push(iD.actions.AddEntity(relation))});if(actions.length){actions.push(t("operations.dividerTrafficLightTREF.title"));context.perform.apply(context,actions)}context.enter(iD.modes.Browse(context))};operation.available=function(){if(2>selectedIDs.length)return false;var graph=context.graph(),layer,layer2;var isBreak=false;selectedIDs.forEach(function(d,i){if(isBreak){return}let entity=context.entity(d);if(entity.modelName==iD.data.DataType.DIVIDER){layer=iD.Layers.getLayer(entity.layerId)}else if(entity.modelName==iD.data.DataType.TRAFFICLIGHT){layer2=iD.Layers.getLayer(entity.layerId)}if(entity.modelName==iD.data.DataType.TRAFFICLIGHT){let rels=graph.parentRelations(entity,iD.data.DataType.R_TRAFFICLIGHT_TREF);if(rels&&rels.length){selectedTREF.push(rels[0])}else{isBreak=true}}else if(entity.modelName==iD.data.DataType.DIVIDER&&"1"==entity.tags.R_LINE){selectedDivider.push(entity);let rels=graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_TL);if(rels&&rels.length){isBreak=true}let drefs=graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_DREF);if(!drefs||!drefs.length){isBreak=true}}else{isBreak=true}});if(!layer||!layer2){return false}if(!layer.editable||!layer2.editable){return false}selectedTREF=_.uniq(selectedTREF);return!isBreak&&1==selectedDivider.length&&0<selectedTREF.length&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.dividerTrafficLightTREF.description")};operation.id="merge";operation.keys=[iD.ui.cmd("M")];operation.title=t("operations.dividerTrafficLightTREF.title");return operation};;;iD.operations.dividerTrafficLightTREFDelete=function(selectedIDs,context){var selectedRelations=[];var operation=function(){context.perform(iD.actions.DeleteRelation(selectedRelations[0].id),t("operations.dividerTrafficLightTREF.delete_relation"));context.enter(iD.modes.Browse(context))};operation.available=function(){if(1!=selectedIDs.length)return false;var graph=context.graph(),layer,layer2;var isBreak=false;selectedIDs.forEach(function(d,i){if(isBreak){return}let entity=context.entity(d);if(entity.modelName==iD.data.DataType.DIVIDER){layer=iD.Layers.getLayer(entity.layerId)}else if(entity.modelName==iD.data.DataType.TRAFFICLIGHT){layer2=iD.Layers.getLayer(entity.layerId)}if(_.include([iD.data.DataType.TRAFFICLIGHT,iD.data.DataType.DIVIDER],entity.modelName)){let rels;if(entity.modelName==iD.data.DataType.TRAFFICLIGHT){rels=graph.parentRelations(entity,iD.data.DataType.R_TRAFFICLIGHT_TREF);if(rels&&rels.length){rels=graph.parentRelations(rels[0],iD.data.DataType.R_DIVIDER_TL)}}else{rels=graph.parentRelations(entity,iD.data.DataType.R_DIVIDER_TL)}if(rels&&rels.length){selectedRelations.push(rels[0])}}else{isBreak=true}});if(!layer&&!layer2){return false}selectedRelations=_.uniq(selectedRelations);return!isBreak&&1==selectedRelations.length&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.dividerTrafficLightTREF.delete_relation")};operation.id="delete";operation.keys=[iD.ui.cmd("D")];operation.title=t("operations.dividerTrafficLightTREF.delete_relation");return operation};;;iD.operations.roadRoadAttribute=function(selectedIDs,context){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.R_ROAD_RA);var road,roadAttr;var operation=function(){var graph=context.graph();var members=[{id:roadAttr.id,modelName:roadAttr.modelName,role:iD.data.RoleType.ROAD_ATTRIBUTE_ID,type:iD.data.GeomType.NODE},{id:road.id,modelName:road.modelName,role:iD.data.RoleType.ROAD_ID,type:iD.data.GeomType.WAY}];var relation=iD.Relation({modelName:iD.data.DataType.R_ROAD_RA,members:members,tags:iD.util.getDefauteTags(iD.data.DataType.R_ROAD_RA,currentLayer),layerId:currentLayer.id});context.perform(iD.actions.AddEntity(relation),t("operations.road_ra_create.title"));context.enter(iD.modes.Browse(context))};operation.available=function(){if(2!=selectedIDs.length)return false;var graph=context.graph();for(var i=0;i<selectedIDs.length;i++){var entity=graph.entity(selectedIDs[i]);if(entity.modelName==iD.data.DataType.ROAD_ATTRIBUTE){if(roadAttr)return false;else if(graph.parentRelations(entity,iD.data.DataType.R_ROAD_RA).length)return false;roadAttr=entity}else if(entity.modelName==iD.data.DataType.ROAD){if(road)return false;road=entity}else{return false}var modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!modelConfig)return false;if(!modelConfig.editable)return false}return currentLayer.editable&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.road_ra_create.description")};operation.id="merge";operation.keys=[iD.ui.cmd("P")];operation.title=t("operations.road_ra_create.title");return operation};;iD.operations.rectifyDeviationFeature=function(selectedIDs,context,isReplace){var action=iD.actions.rectifyDeviationFeature(selectedIDs,context);var operation=function(){var annotation=t("operations.rectifyDeviationFeature.annotation.line");context.perform(action,annotation);context.enter(iD.modes.Browse(context));context.event.entityedite()};operation.available=function(){return!operation.disabled()};operation.disabled=function(){return action.disabled(context.graph())};operation.tooltip=function(){return t("operations.rectifyDeviationFeature.description")};operation.id="rdf";operation.keys=[iD.ui.cmd("D")];operation.title=t("operations.rectifyDeviationFeature.title");return operation};;iD.measureinfo={};iD.measureinfo.getParams=function(opt={}){var nodes=opt.points||[];var result={Paras:{method:opt.method,nodes:nodes}};return result};iD.measureinfo.handle=function(){var handels={};handels["forward_intersection"]=iD.measureinfo.ForwardIntersection();handels["normal"]=iD.measureinfo.Normal();handels["paste"]=iD.measureinfo.Paste();handels["verticalsign"]=iD.measureinfo.VerticalSign();handels["split"]=iD.measureinfo.Split();handels["pan"]=iD.measureinfo.Pan();handels["expand_line"]=iD.measureinfo.ExpandLine();var handle={};function getHandel(type){let keyType="";if(0==type){keyType="normal"}else if(1==type){keyType="forward_intersection"}else if(2==type){keyType="paste"}else if(3==type){keyType="verticalsign"}else if(4==type){keyType="split"}else if(5==type){keyType="expand_line"}else if(6==type){keyType="pan"}return handels[keyType]}handle.addEntity=function(graph,entity,opt={}){let obj=getHandel(opt.type);if(obj)return obj.add(graph,entity,opt);return graph};handle.updateEntity=function(graph,entity,opt={}){let obj=getHandel(opt.type);if(obj)return obj.update(graph,entity,opt);return graph};handle.remove=function(graph,id,opt={}){let entity=graph.entity(id);let obj=getHandel(opt.type);if(obj)return obj.update(graph,entity);let relations=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO);for(let rel of relations){graph=graph.remove(rel)}return graph};return handle};;iD.measureinfo.ForwardIntersection=function(){var handle={};function getParam(opt){let points=[];for(let p of opt.points){points.push({trackPointId:p.trackPointId,trackId:opt.trackId,x:p.imgOffset.x,y:p.imgOffset.y})}var param=iD.measureinfo.getParams({method:opt.method,points:points});return param}handle.add=function(graph,entity,opt={}){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.MEASUREINFO);var members=[{id:entity.id,modelName:entity.modelName,role:iD.data.RoleType[entity.modelName+"_ID"],type:iD.data.GeomType.NODE}];var param=getParam(opt);var relation=iD.Relation({modelName:iD.data.DataType.MEASUREINFO,members:members,layerId:currentLayer.id,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.MEASUREINFO,currentLayer),{METHOD:3,PARAMETER:JSON.stringify(param)})});graph=graph.replace(relation);return graph};handle.update=function(graph,entity,opt={}){var relation=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO)[0];if(!relation){return graph}var param=getParam(opt);graph=graph.replace(relation.mergeTags({METHOD:3,PARAMETER:JSON.stringify(param)}));return graph};handle.remove=function(graph){return graph};return handle};;iD.measureinfo.Normal=function(){var handle={};function getParam(opt){var param=iD.measureinfo.getParams({method:opt.method,points:[{trackPointId:opt.trackPointId,trackId:opt.trackId,x:opt.imgOffset.x,y:opt.imgOffset.y}]});return param}handle.add=function(graph,entity,opt={}){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.MEASUREINFO);if(!currentLayer)return graph;var members=[{id:entity.id,modelName:entity.modelName,role:iD.data.RoleType[entity.modelName+"_ID"],type:iD.data.GeomType.NODE}];var param=getParam(opt);var relation=iD.Relation({modelName:iD.data.DataType.MEASUREINFO,members:members,layerId:currentLayer.id,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.MEASUREINFO,currentLayer),{METHOD:2,PARAMETER:JSON.stringify(param)})});graph=graph.replace(relation);return graph};handle.update=function(graph,entity,opt={}){var relation=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO)[0];if(!relation){return graph}var param=getParam(opt);graph=graph.replace(relation.mergeTags({METHOD:2,PARAMETER:JSON.stringify(param)}));return graph};handle.remove=function(graph){return graph};return handle};;iD.measureinfo.Paste=function(){var paste={};paste.add=function(graph,entity,opt){if(!entity||!opt){return graph}var relations=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO);if(relations.length){return this.update(graph,entity,opt)}let obj=iD.measureinfo.getParams({method:opt.method,points:opt.data});relation=createMeasureinfo(graph,entity,obj);graph=graph.replace(relation);return graph};paste.remove=function(graph){return graph};paste.update=function(graph,entity,opt){var relations=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO);if(0==relations.length){return graph}relation=relations[0];graph=graph.replace(relation.mergeTags({METHOD:2,PARAMETER:JSON.stringify(iD.measureinfo.getParams({method:5,points:opt.data}))}));return graph};function createMeasureinfo(graph,entity,paras){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.MEASUREINFO);var members=[{id:entity.id,modelName:entity.modelName,role:iD.data.Model2Role[entity.modelName],type:iD.data.GeomType.NODE}];var relation=iD.Relation({modelName:iD.data.DataType.MEASUREINFO,members:members,layerId:currentLayer.id,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.MEASUREINFO,currentLayer),{METHOD:2,PARAMETER:JSON.stringify(paras)})});return relation};return paste};;iD.measureinfo.Pan=function(){var paste={};paste.add=function(graph,entity,opt){if(!entity||!opt){return graph}var relations=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO);if(relations.length){return this.update(graph,entity,opt)}let obj=iD.measureinfo.getParams({method:opt.method,points:opt.data});relation=createMeasureinfo(graph,entity,obj);graph=graph.replace(relation);return graph};paste.remove=function(graph){return graph};paste.update=function(graph,entity,opt){var relations=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO);if(0==relations.length){return graph}relation=relations[0];graph=graph.replace(relation.mergeTags({METHOD:2,PARAMETER:JSON.stringify(iD.measureinfo.getParams({method:6,points:opt.data}))}));return graph};function createMeasureinfo(graph,entity,paras){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.MEASUREINFO);var members=[{id:entity.id,modelName:entity.modelName,role:iD.data.Model2Role[entity.modelName],type:iD.data.GeomType.NODE}];var relation=iD.Relation({modelName:iD.data.DataType.MEASUREINFO,members:members,layerId:currentLayer.id,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.MEASUREINFO,currentLayer),{METHOD:2,PARAMETER:JSON.stringify(paras)})});return relation};return paste};;iD.measureinfo.Split=function(){var handle={};function getParam(opt){var param=iD.measureinfo.getParams({method:opt.method,points:[{trackPointId:opt.trackPointId,trackId:opt.trackId,x:opt.imgOffset.x,y:opt.imgOffset.y,type:"split"}]});return param}handle.add=function(graph,entity,opt={}){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.MEASUREINFO);var members=[{id:entity.id,modelName:entity.modelName,role:iD.data.RoleType[entity.modelName+"_ID"],type:iD.data.GeomType.NODE}];var param=getParam(opt);var relation=iD.Relation({modelName:iD.data.DataType.MEASUREINFO,members:members,layerId:currentLayer.id,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.MEASUREINFO,currentLayer),{METHOD:8,PARAMETER:JSON.stringify(param)})});graph=graph.replace(relation);return graph};handle.update=function(graph,entity,opt={}){var relation=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO)[0];if(!relation){return graph}var param=getParam(opt);graph=graph.replace(relation.mergeTags({METHOD:2,PARAMETER:JSON.stringify(param)}));return graph};handle.remove=function(graph){return graph};return handle};;iD.measureinfo.VerticalSign=function(){var handle={};function getParam(opt){var param=iD.measureinfo.getParams({method:opt.method,points:[{trackPointId:opt.trackPointId,trackId:opt.trackId,x:opt.imgOffset.x,y:opt.imgOffset.y,pointid:opt.pointid,pointtype:opt.pointtype}]});return param}handle.add=function(graph,entity,opt={}){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.MEASUREINFO);var members=[{id:entity.id,modelName:entity.modelName,role:iD.data.RoleType[entity.modelName+"_ID"],type:iD.data.GeomType.NODE}];var param=getParam(opt);var relation=iD.Relation({modelName:iD.data.DataType.MEASUREINFO,members:members,layerId:currentLayer.id,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.MEASUREINFO,currentLayer),{METHOD:1,PARAMETER:JSON.stringify(param)})});graph=graph.replace(relation);return graph};handle.update=function(graph,entity,opt={}){var relation=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO)[0];if(!relation){return graph}var param=getParam(opt);graph=graph.replace(relation.mergeTags({METHOD:1,PARAMETER:JSON.stringify(param)}));return graph};return handle};;iD.measureinfo.ExpandLine=function(){var handle={};function getParam(opt){var param=iD.measureinfo.getParams({method:opt.method,points:[{type:"expand_"+(opt.lineType||"")}]});return param}handle.add=function(graph,entity,opt={}){var currentLayer=iD.Layers.getCurrentModelEnableLayer(iD.data.DataType.MEASUREINFO);var members=[{id:entity.id,modelName:entity.modelName,role:iD.data.RoleType[entity.modelName+"_ID"],type:iD.data.GeomType.NODE}];var param=getParam(opt);var relation=iD.Relation({modelName:iD.data.DataType.MEASUREINFO,members:members,layerId:currentLayer.id,tags:_.extend({},iD.util.getDefauteTags(iD.data.DataType.MEASUREINFO,currentLayer),{METHOD:7,PARAMETER:JSON.stringify(param)})});graph=graph.replace(relation);return graph};handle.update=function(graph,entity,opt={}){var relation=graph.parentRelations(entity,iD.data.DataType.MEASUREINFO)[0];if(!relation){return graph}var param=getParam(opt);graph=graph.replace(relation.mergeTags({METHOD:2,PARAMETER:JSON.stringify(param)}));return graph};handle.remove=function(graph){return graph};return handle};;iD.operations.RawPosition=function(selectedIDs,context){var operation=function(){context.temp().rawposition=selectedIDs;context.event.changemap()};operation.available=function(){return false;var layers=iD.Layers,layer=layers.getLayer();if(layer.isRoad())return false;var entity=context.entity(selectedIDs[0]),lay=iD.Layers.getLayer(entity.layerId),modelConfig=iD.Layers.getLayer(entity.layerId,entity.modelName);if(!lay||context.isRoadCross(entity))return false;var parents=context.graph().parentWays(entity),isPlay=true;(layer.isRoad()||layer.isLine())&&parents.forEach(function(d,i){if(d.first()===entity.id||d.last()===entity.id)isPlay=false});if(!isPlay||"RoadNode"===entity.modelName)return false;var c=lay.origCoord,k=entity.tags;if(!c)return false;return modelConfig.editable&&(2==c.length&&k[c[0]]&&k[c[1]]||k[c])&&!operation.disabled()};operation.disabled=function(){return false};operation.tooltip=function(){return t("operations.rawposition.title")};operation.id="rawposition";operation.keys=[t("operations.rawposition.key")];operation.title=t("operations.rawposition.title");return operation};;;iD.Layers=function(context){var layer={};layer.addLayer=function(layer){iD.data.layers.push(layer)};layer.removeLayer=function(l){var layers=this.getLayers();for(var i=0;i<layers.length;i++){var _=layers[i];if(_&&l.id&&_.id==l.id){iD.data.layers.splice(i,1)}}};layer.removeAllLayers=function(){iD.data.layers.length=0};layer.getLayers=function(){return iD.data.layers};layer.getDataLayers=function(){var layers=iD.data.layers,dataLayers=[];layers.forEach(function(item){if(!item.isHotspot()){dataLayers.push(item)}});return dataLayers};layer.getHotspotLayers=function(){var layers=iD.data.layers,dataLayers=[];layers.forEach(function(item){if(item.isHotspot()){dataLayers.push(item)}});return dataLayers};layer.getLayerById=function(layerId){for(var i=0;i<iD.data.layers.length;i++){var l=iD.data.layers[i];if(l.id==layerId){return iD.data.layers[i]}}return null};layer.getLayerByName=function(layerName){var layerId=iD.config.getLayerId(layerName);return layer.getLayerById(layerId)};layer.getSubLayerByName=function(layerName){return iD.config.getLayerByName(layerName)};layer.getLayersByModelName=function(modelName){let layers=iD.data.layers,result=[];layers.forEach(function(item){if(modelName?iD.util.getModelNameByItem(item.models.datas||[],modelName):true){result.push(item)}});return result};layer.getEditableLayers=function(){let layers=iD.data.layers,result=[];layers.forEach(function(item){if(item.editable){result.push(item)}});return result};layer.getCurrentModelEnableLayer=function(modelName){let layers=iD.data.layers,result;layers.forEach(function(item){if(item.editable&&(modelName?iD.util.getModelNameByItem(item.models.datas||[],modelName):true)){result=item;return false}});return result};layer.getLayer=function(layerID,modelName){if(layerID){let lay=this.getLayerById(layerID);if(lay){if(modelName){var model=lay.models.datas[modelName];if(model){return model}}return lay}}};layer._setAttribute=function(lay,model,param){if(param.display!=undefined){if(lay.display){model.display=param.display}else{model.display=false}}if(!model.editlock&&param.editable!=undefined){if(lay.editable){model.editable=param.editable}else{model.editable=false}}};layer.setLayerEditable=function(lay,edit=true,models=[]){let m=[];if(0==models.length){for(let j in lay.models.datas){m.push(j)}}for(let i in m){this._setAttribute(lay,lay.models.datas[m[i]],{editable:edit})}};layer.setLayerDisplay=function(lay,display=true,models=[]){let m=[];if(0==models.length){for(let j in lay.models.datas){m.push(j)}}for(let i in m){this._setAttribute(lay,lay.models.datas[m[i]],{display:display})}};layer.getModelConfig=function(lay,models=[]){if(0==models.length){for(let j in lay.models.datas){models.push(j)}}var modelsConfig=[];for(let i in models){let modelDis=lay.models.datas[models[i]];modelsConfig[models[i]]={editable:modelDis&&modelDis.editable}}return modelsConfig};layer.getLayerModelDisplay=function(lay,modelName){if(lay.display){return lay.models.datas[modelName]?lay.models.datas[modelName].display:false}return false};layer.getLayerModelEditable=function(lay,modelName){if(lay.editable){return lay.models.datas[modelName]?lay.models.datas[modelName].editable:false}return false};return layer}();iD.ModelEntitys={};iD.Layer=function(param){var _this=param||{};_this.hotspots={};_this.hotspotType="";_this.lastIds=[];_this.sublayers=[];function isMultiModel(){return _this._modelEntity&&!(_this._modelEntity instanceof iD.ModelEntity)}function _modelEntityType(type){if(isMultiModel()){for(let modelName in _this._modelEntity){let modelEntity=_this._modelEntity[modelName];if(modelEntity.type()==type){return true}}return false}else{return _this._modelEntity.type()==type}}function _modelEntityHasModel(modelName){if(isMultiModel()){return null!=_this._modelEntity[modelName]}else{return _this._modelEntity.modelName()==modelName}}_this.isArea=function(){return _modelEntityType(3)};_this.isHotspot=function(){return"hotspot"===_this.type};_this.isRoad=function(){return _modelEntityHasModel(iD.data.DataType.ROAD)};_this.isDivider=function(){let mname=iD.data.DataType.DIVIDER;return _modelEntityHasModel(mname)};_this.isLine=function(){return _modelEntityType(2)};_this.isPoint=function(){return _modelEntityType(1)};_this.isRelation=function(){return _modelEntityType(0)};_this.modelEntity=function(_){if(!arguments.length)return _this._modelEntity;_this._modelEntity=_;return _this};_this.hasModelEntity=function(_){return _modelEntityHasModel(_)};return _this};;iD.Connection=function(context){var event=d3.dispatch("authenticating","modelEntityLoaded","authenticated","auth","loading","load","loaded"),url="http://www.kd.com",connection={},inflight={},inflightTag={},modelEntityCache={},loadedModelEntityFlag=false,loadedLayerFlag=false,loadedSubModelEntityFlag=false,loadedTiles={},tileZoom=15,oauth=osmAuth({url:"http://www.kd.com",oauth_consumer_key:"5A043yRSEugj4DJ5TljuapfnrflWDte8jTOcWLlT",oauth_secret:"aB3jKq1TRsCOUrfOIZ6oQMEDmv2ptV76PA54NGLL",loading:authenticating,done:authenticated}),ndStr="nd",tagStr="tag",memberStr="member",nodeStr="node",wayStr="way",relationStr="relation",delimiter="_",off;var connectionType=true;var transId;iD.data.initModelEntityTags={};context.MeshDataStore={all:[],node:[],way:[],newWay:[],setWayMeshId:function setWayMeshId(xWay,graph){var meshStore=this;var firstId=xWay.first(),lastId=xWay.last(),first=graph.entity(firstId),last=graph.entity(lastId),firstLoc=first.loc,lastLoc=last.loc;var pXY={lng:"",lat:""};if(2==xWay.nodes.length){var tempXY=iD.geo.interp(firstLoc,lastLoc,0.5);pXY.lng=tempXY[0];pXY.lat=tempXY[1]}else{var tempEntityId=xWay.nodes[1];var tempLoc=graph.entity(tempEntityId).loc;pXY.lng=tempLoc[0];pXY.lat=tempLoc[1]}var meshs=meshStore.way;for(var i=0;i<meshs.length;i++){var mesh=meshs[i];var mNodes=mesh.nodes;var p1=mNodes[0];var p2=mNodes[1];var p3=mNodes[2];var p4=mNodes[3];var pp1=graph.entity(p1);var pp2=graph.entity(p2);var pp3=graph.entity(p3);var pp4=graph.entity(p4);var ppMinX=Math.min(pp1.loc[0],pp2.loc[0],pp3.loc[0],pp4.loc[0]);var ppMaxX=Math.max(pp1.loc[0],pp2.loc[0],pp3.loc[0],pp4.loc[0]);var ppMinY=Math.min(pp1.loc[1],pp2.loc[1],pp3.loc[1],pp4.loc[1]);var ppMaxY=Math.max(pp1.loc[1],pp2.loc[1],pp3.loc[1],pp4.loc[1]);var meshcoord=[[ppMinX,ppMinY],[ppMaxX,ppMaxY]];var r=iD.util.lassExtend.isPointInRect(pXY,meshcoord);if(r){xWay=xWay.mergeTags({mesh:mesh.tags.mesh_});graph=graph.replace(xWay);_.uniq(xWay.nodes).forEach(function(id,i){var xNode=graph.entity(id);xNode=xNode.mergeTags({mesh:mesh.tags.mesh_});graph=graph.replace(xNode)});break}}return graph},getNode:function(id){var nodes=this.node,r=null;for(var i=0;i<nodes.length;i++){var node=nodes[i];if(node.id==id){r=node;break}}return r},getWay:function(id){var ways=this.way,r=null;for(var i=0;i<ways.length;i++){var way=ways[i];if(way.id==id){r=way;break}}return r},getRectCoords:function(){var _way=this.way;var _node=this.node;var r=[];var lines=[];for(var i=0;i<_way.length;i++){var wNodes=_way[i].nodes;var rectCoord=[];for(var j=0;j<wNodes.length;j++){for(var n=0;n<_node.length;n++){if(_node[n].id==wNodes[j]){rectCoord.push(_node[n].loc)}}}r.push(rectCoord)}for(var m=0;m<r.length;m++){var xRectCoord=r[m];var p1=xRectCoord[0];var p2=xRectCoord[1];var p3=xRectCoord[2];var p4=xRectCoord[3];var line1=p1.concat(p2);var line2=p2.concat(p3);var line3=p3.concat(p4);var line4=p4.concat(p1);var allLines=[line1,line2,line3,line4];for(var f=0;f<allLines.length;f++){var hasLine=false;var xline=allLines[f];for(var k=0;k<lines.length;k++){var tl=lines[k].join("#");var ll=xline.join("#");if(tl==ll){hasLine=true;break}}if(!hasLine){lines.push(xline)}}}for(var k=0;k<lines.length;k++){var kLine=lines[k].join("+");for(var h=0;h<lines.length;h++){if(k==h)continue;var hLine=lines[h].join("+");if(eval(kLine)==eval(hLine)){lines.splice(h,1)}}}return lines}};connection.loadFromURL=function(url,callback,layer,isEditCheck){var options={};options=layer?{layerId:layer.id}:{};options.isEditCheck=isEditCheck;function done(dom){let parseResult=[],xhrOptions=this.options||{};if(xhrOptions.isEditCheck){parseResult=editCheckParseJson(dom,xhrOptions)}else{parseResult=parseJson(dom,xhrOptions)}return callback(null,parseResult)}var d3xml=d3.json(url);d3xml.options=options;return d3xml.get().on("load",done)};function editCheckParseJson(dom,options){var entities=[];var modelEntity;let rootResult=dom.result||{};for(var key in rootResult){var _parser=parsersJ[key];if(_parser){var entityArr=rootResult[key];entityArr.forEach(function(entity){modelEntity=iD.ModelEntitys[entity.modelName];let layerid=!_.isEmpty(options)?options.layerId:"";et=_parser(entity,layerid);if(!layerid){if(!modelEntity){layerid=entity.layerId}else{layerid=modelEntity.layerId()}}et.layerId=layerid;entities.push(et)})}}return entities}function getAppType(sysType){let appType="";switch(sysType||+window._systemType){case 1:appType="edit";break;case 2:appType="fusion";break;case 5:appType="editcheck";break;case 6:appType="imagetag";break;default:appType="edit";break;}return appType}function getTagAppType(type){let appType="";switch(type){case 1:appType="editcheck";break;case 2:appType="imagetag";break;case 3:appType="analysistag";break;case 4:appType="questiontag";break;}return appType}function parse(dom,options){if(!dom||!dom.childNodes)return new Error("Bad request");if(connectionType){var root="xml"==dom.childNodes[0].nodeName.toLowerCase()?dom.childNodes[1]:dom.childNodes[0];if(!root.childNodes[3]){return[]}var children=root.childNodes[3].childNodes;var entities=[];if(children[0]&&"page"==children[0].nodeName){var nodeSet={};var wayArr=[];for(var j=0,k=children.length;j<k;j++){var _child=children[j];if("page"==_child.nodeName)continue;_parser=parsers[_child.nodeName];if(_parser){et=_parser(_child,child.id,options.layerId);et.layerId=options.layerId;et.layertype=options.type;entities.push(et);if(et instanceof iD.Way){wayArr.push(et)}else if(et instanceof iD.Node){nodeSet[et.id]=1}}}for(j=0;j<wayArr.length;j++){for(var k=0;k<wayArr[j].nodes.length;k++){if(!nodeSet[wayArr[j].nodes[k]]){Dialog.alert("KDS\u8FD4\u56DE\u6570\u636E\u5728\u9053\u8DEF"+wayArr[j].id+"\u4E0A\u7F3A\u5C11\u8282\u70B9:"+wayArr[j].nodes[k]);return entities}}}return entities}var i,et,l,layerchildren,isRLayer=iD.Layers.getLayerById(options.layerId).isRoad();for(i=0,l=children.length;i<l;i++){var child=children[i],parser=parsers[child.nodeName];if("layer"==child.nodeName){var layerchildren=child.childNodes;var nodeSet={};var wayArr=[];for(j=0,k=layerchildren.length;j<k;j++){var _child=layerchildren[j],_parser=parsers[_child.nodeName];if(_parser){et=_parser(_child,child.id,options.layerId);et.layerId=options.layerId;et.layertype=options.type;isRLayer&&subLayersOption(et,options,_child);entities.push(et);if(et instanceof iD.Way){wayArr.push(et)}else if(et instanceof iD.Node){nodeSet[et.id]=1}}}var flag=false;for(j=0;j<wayArr.length;j++){for(var k=0;k<wayArr[j].nodes.length;k++){if(!nodeSet[wayArr[j].nodes[k]]){var index=entities.indexOf(wayArr[j]);if(!flag){console.error("KDS\u8FD4\u56DE\u6570\u636E\u5728\u9053\u8DEF"+wayArr[j].id+"\u4E0A\u7F3A\u5C11\u8282\u70B9:"+wayArr[j].nodes[k])}}}}}}}else{var root=dom.childNodes[0],children=root.childNodes,entities=[];for(var i=0,l=children.length;i<l;i++){var child=children[i],parser=parsers[child.nodeName];if(parser){entities.push(parser(child,options.layerId))}}}return entities}function parseJson(dom,options){var rootArr=dom.layer;if(!(rootArr instanceof Array)){rootArr=[rootArr]}if(0==rootArr.length){return[]}var entities=[];var modelEntity;var i,et,l;for(i=0,l=rootArr.length;i<l;i++){var child=rootArr[i];for(var nodeName in child){var modelInfo=child[nodeName];let synodeRoadNodeRelations=[];let roadNodeList={},roadCrossList={};for(var key in modelInfo){var _parser=parsersJ[key];if(_parser){var entityArr=modelInfo[key];for(let i=0;i<entityArr.length;i++){var entity=entityArr[i];modelEntity=iD.ModelEntitys[entity.modelName];let layerid=!_.isEmpty(options)?options.layerId:"";et=_parser(entity,layerid);if(!layerid){if(!modelEntity){layerid=entity.layerId}else{layerid=modelEntity.layerId()}}et.layerId=layerid;entities.push(et);if(et.modelName==iD.data.DataType.R_C_NODE_ROAD_NODE){synodeRoadNodeRelations.push(et)}else if(et.modelName==iD.data.DataType.ROAD_NODE){roadNodeList[et.id]=et}else if(et.modelName==iD.data.DataType.C_NODE){roadCrossList[et.id]=et}}}}for(let idx in synodeRoadNodeRelations){let rel=synodeRoadNodeRelations[idx];let roadnodes=[],roadcrossNode;(rel.members||[]).forEach(function(m){if(m.modelName==iD.data.Constant.C_NODE){roadcrossNode=roadCrossList[m.id]}else if(m.modelName==iD.data.DataType.ROAD_NODE){roadNodeList[m.id]&&roadnodes.push(roadNodeList[m.id])}});if(!roadcrossNode||!roadnodes.length){continue}roadnodes.forEach(function(roadnode){entities.push(parseJsonRoadCrossLine(roadcrossNode,roadnode))})}}}return entities}function parseJsonRoadCrossLine(synode,roadnode){var aid=iD.Entity.id.toOSM(synode.id),bid=iD.Entity.id.toOSM(roadnode.id),newId=iD.Entity.id.fromOSM("way",aid+bid,synode.layerId);return new iD.Way({id:newId,nodes:[synode.id,roadnode.id],_type:"roadcrossline",tags:{},layerId:synode.layerId})}var parsersJ={node:function nodeData(obj,layerid,minLayerId){return new iD.Node({id:iD.Entity.id.fromOSM(nodeStr,obj.id,layerid),loc:[parseFloat(obj.lon),parseFloat(obj.lat),parseFloat(obj.z)],version:obj.version,modelName:obj.modelName,tags:getTagsByJson(obj,obj.modelName,"node")})},way:function wayData(obj,layerid,minLayerId){return new iD.Way({id:iD.Entity.id.fromOSM(wayStr,obj.id,layerid),version:obj.version,modelName:obj.modelName,tags:getTagsByJson(obj,obj.modelName,"way"),nodes:getNodesByJson(obj,layerid)})},relation:function relationData(obj,layerid,minLayerId){return new iD.Relation({id:iD.Entity.id.fromOSM(relationStr,obj.id,layerid),version:obj.version,modelName:obj.modelName,tags:getTagsByJson(obj,obj.modelName,"relation"),members:getMembersByJson(obj,layerid)})}};function JSONByTag(entity){var tagsArr=entity.tag,tags={};if(tagsArr&&0<tagsArr.length){tagsArr.forEach(function(eachTag){tags[eachTag.k]=eachTag.v?eachTag.v:""})}return tags}function createDefaultTags(modelName){function Tag(tag){for(var p in tag){this[p]=tag[p]}}let modelEntity=iD.ModelEntitys[modelName];if(modelEntity){var gtype=modelEntity.getGeoType();modelEntity.getFields(gtype).filter(function(d){Tag.prototype[d.fieldName]=d.defaultValue})}return Tag}function getTagsByJson(entity,modelName,clsType){var tags=JSONByTag(entity);var _tags;var tagsFun=iD.data.initModelEntityTags[modelName+"_"+clsType];if(!tagsFun){tagsFun=createDefaultTags(modelName);iD.data.initModelEntityTags[modelName+"_"+clsType]=tagsFun}_tags=new tagsFun(tags);if(_tags.geojson&&"string"===typeof _tags.geojson){_tags.geojson=JSON.parse(_tags.geojson)}return _tags}function getNodesByJson(entity,layerid){var ndArr=entity.nd,nodes=[];ndArr.forEach(function(eachNd){var ndName=iD.Entity.id.fromOSM(nodeStr,eachNd.ref,layerid);nodes.push(ndName)});return nodes}function getMembersByJson(entity,layerid,modelEntity){var elemsArr=entity.member,members=new Array(elemsArr.length),key;for(var i=0,l=elemsArr.length;i<l;i++){var attrs=elemsArr[i];key=attrs.type===iD.data.GeomType.NODE?"n":attrs.type===iD.data.GeomType.RELATION?"r":"w";let memberid=key+"_"+attrs.ref;if(2==window._systemType||1==window._systemType){memberid=key+layerid+"_"+attrs.ref}members[i]={id:memberid,modelName:attrs.modelName,type:attrs.type,role:attrs.role}}var sublayer=entity.modelName;if(sublayer===iD.data.DataType.NODECONN||sublayer===iD.data.DataType.C_NODECONN){var mbers=new Array(elemsArr.length);for(var i=0,l=members.length;i<l;i++){if(-1!==members[i].role.indexOf("FROAD"))mbers[0]=members[i];else if(-1!==members[i].role.indexOf("TROAD"))mbers[2]=members[i];else mbers[1]=members[i]}return mbers}return members}function subLayersOption(et,entity,modelInfoid,layerId,type){et.modelName===iD.data.Constant.ZLEVEL&&(et.members=getMembersByJson(entity,modelInfoid,layerId,type));et.modelName===iD.data.Constant.C_NODE&&(et.members=getMembersByJson(entity,modelInfoid,layerId,type));et.modelName===iD.data.DataType.DETAILSLOPE&&(et.members=getMembersByJson(entity,modelInfoid,layerId,type))}var link_upId2level={},zlevel_up2dn={};function filterZLevel(a,entities){if(a.isRoadZLevel&&a.isRoadZLevel()){var zlevel_member=a.members;if(!zlevel_member.length)return;link_up=zlevel_member[0],link_down=zlevel_member[1];if("link_up"===link_up.role)link_up=zlevel_member[0],link_down=zlevel_member[1];else link_down=zlevel_member[0],link_up=zlevel_member[1];link_upId2level[link_up.id]=1;link_upId2level[link_down.id]=0;!zlevel_up2dn[link_up.id]&&(zlevel_up2dn[link_up.id]=[]);zlevel_up2dn[link_up.id].push(link_down.id);if(context.graph().hasEntity(link_up.id)&&context.graph().hasEntity(link_down.id)){var link_up_enty=context.graph().entity(link_up.id),link_dn_enty=context.graph().entity(link_down.id);iD.util.storeDottedLoc(a,link_up_enty,a.id+"-"+link_up_enty.id,context.temp().zlevel_locs,context,entities);iD.util.storeDottedLoc(a,link_dn_enty,a.id+"-"+link_dn_enty.id,context.temp().zlevel_locs,context,entities)}else{for(var i in entities){if("way"===entities[i].type){if(entities[i].id===link_up.id)iD.util.storeDottedLoc(a,entities[i],a.id+"-"+entities[i].id,context.temp().zlevel_locs,context,entities);if(entities[i].id===link_down.id)iD.util.storeDottedLoc(a,entities[i],a.id+"-"+entities[i].id,context.temp().zlevel_locs,context,entities)}}}}}function sortZLevel(link_upId){var link_downs=zlevel_up2dn[link_upId];for(var i in link_downs){if(zlevel_up2dn[link_downs[i]]&&zlevel_up2dn[link_downs[i]].length){link_upId2level[link_upId]+=1;link_upId2level[link_downs[i]]+=1;sortZLevel(link_downs[i]);break}}}function setSortedZLevel(entities){for(var link_upId in zlevel_up2dn)sortZLevel(link_upId,zlevel_up2dn);for(var link_upId in link_upId2level){if(context.graph().hasEntity(link_upId)){link_upId2level[link_upId]&&(context.graph().entity(link_upId).zlevel=link_upId2level[link_upId])}else for(var i in entities)link_upId2level[entities[i].id]&&(entities[i].zlevel=link_upId2level[entities[i].id])}var obj_temp={};obj_temp=iD.util.merge(link_upId2level,obj_temp);for(var ky in obj_temp){if(context.graph().hasEntity(ky)){link_upId2level[ky]=null;delete link_upId2level[ky];zlevel_up2dn[ky]=null;delete zlevel_up2dn[ky]}}obj_temp=null}function filterSpeedcamera(a,entities,parsed){if(a.isSpeedcamera&&a.isSpeedcamera()&&a.members.length){var scWayId=a.members[0].id,scWay;for(var i in entities)if("way"===entities[i].type&&entities[i].id===scWayId){scWay=entities[i];break};iD.util.storeDottedLoc(a,scWay,a.id,context.temp().camaera_locs,context,entities)}}function relativeId(a,b){return a.id==="n"+a.layerId+"_"+b.id}function filterRoadEntity(entities,parsed){var filter=[],zlevels=[],cameras=[];!context.temp().camaera_locs&&(context.temp().camaera_locs={});!context.temp().zlevel_locs&&(context.temp().zlevel_locs={});for(var i in entities){("node"===entities[i].type&&entities[i].isPlaceName()||"node"===entities[i].type&&entities[i].isRoadCross()||entities[i].isRoadNode&&entities[i].isRoadNode())&&filter.push(entities[i]);filterZLevel(entities[i],entities);filterSpeedcamera(entities[i],entities,parsed)}setSortedZLevel(entities.concat(context.intersects(context.map().extent())));filter.forEach(function(a){if(a.isRoadCross()){var memebers=a.members;memebers.forEach(function(memeber){generatedotway(a,memeber,parsed)})}})}function generatedotway(a,b,parsed){var aid=iD.Entity.id.toOSM(a.id),bid=iD.Entity.id.toOSM(b.id),newId=iD.Entity.id.fromOSM(wayStr,aid+bid,a.layerId);parsed.push(new iD.Way({id:newId,nodes:[a.id,b.id],_type:"roadcrossline",modelName:a.modelName,layerId:a.layerId}))}connection.searchPoiURL=function(url,opt,callback){var param="&sid=1000&encode=utf-8&resType=json&batch="+opt.pageIndex+"&number="+opt.pageSize+"&keyword="+encodeURIComponent(opt.keyword);var rid=Math.round(100000*Math.random());url+=param+"&rid="+rid;var script;window.MMap={MAjaxResult:[]};function done(){var data=MMap.MAjaxResult[rid];callback.call(this,data);delete MMap.MAjaxResult[rid];script.remove()}script=d3.select("head").append("script").attr("type","text/javascript").attr("src",url).on("load",done)};connection.loadEntity=function(id,layerInfo,callback){var osmID=iD.Entity.id.toOSM(id);var url=layerInfo.url+"/data/query/get?sid=2100&layerId="+layerInfo.id+"&id="+osmID+"&filter=and id="+osmID;d3.xml(url,function done(err,xml){var result=parseSearchResultEntity(xml,layerInfo);event.load(err,{data:result.entities});if(callback)callback(err,result.entities&&_.find(result.entities,function(e){return e.id===id}))})};function authenticating(){event.authenticating()}function authenticated(){event.authenticated()}function getNodes(obj,_){var elems=obj.getElementsByTagName(ndStr),nodes=new Array(elems.length),_ndStr=ndStr[0],key;for(var i=0,l=elems.length;i<l;i++){key=_ndStr;_&&(key=_ndStr+_+delimiter);nodes[i]=key+elems[i].attributes.ref.value}return nodes}function getTags(obj){var elems=obj.getElementsByTagName(tagStr),tags={};for(var i=0,l=elems.length;i<l;i++){var attrs=elems[i].attributes;tags[attrs.k.value]=attrs.v?attrs.v.value:""}return tags}function getMembers(obj,_){var elems=obj.getElementsByTagName(memberStr),members=new Array(elems.length),key;var layerInfo=iD.Layers.getLayer(_);var datatype=getTags(obj)["datatype"];var memberModes;if(layerInfo&&layerInfo.isRoad()&&datatype){memberModes=layerInfo.getSubLayerByType(datatype).members}for(var i=0,l=elems.length;i<l;i++){var attrs=elems[i].attributes;var subLayerId=_;if(memberModes){memberModes.forEach(function(memberMode){if(memberMode.type==attrs.type.value&&attrs.type.value!=iD.data.Constant.ROADNODE){subLayerId=memberMode.id}})}key="n"===attrs.role.value[0]||"RoadNode"===attrs.type.value?"n":"CrossMaat"===attrs.type.value||"NodeMaat"===attrs.type.value?"r":"w";subLayerId&&(key+=subLayerId+delimiter);members[i]={id:key+attrs.ref.value,type:attrs.type.value,role:attrs.role.value}}var sublayer=obj.parentNode.attributes.type.value;if(sublayer===iD.data.DataType.NODECONN||sublayer===iD.data.DataType.C_NODECONN){var mbers=new Array(elems.length);for(var i=0,l=members.length;i<l;i++){if(-1!==members[i].role.indexOf("FROAD"))mbers[0]=members[i];else if(-1!==members[i].role.indexOf("TROAD"))mbers[2]=members[i];else mbers[1]=members[i]}return mbers}return members}var parsers={node:function nodeData(obj,_,parentLayerId){var attrs=obj.attributes;return new iD.Node({id:iD.Entity.id.fromOSM(nodeStr,attrs.id.value,_),loc:[parseFloat(attrs.lon.value),parseFloat(attrs.lat.value)],version:attrs.version&&attrs.version.value,user:attrs.user&&attrs.user.value,tags:getTags(obj)})},way:function wayData(obj,_,parentLayerId){var attrs=obj.attributes;return new iD.Way({id:iD.Entity.id.fromOSM(wayStr,attrs.id.value,_),version:attrs.version&&attrs.version.value,user:attrs.user&&attrs.user.value,tags:getTags(obj),nodes:getNodes(obj,_)})},relation:function relationData(obj,_,parentLayerId){var attrs=obj.attributes;return new iD.Relation({id:iD.Entity.id.fromOSM(relationStr,attrs.id.value,_),version:attrs.version&&attrs.version.value,user:attrs.user&&attrs.user.value,tags:getTags(obj),members:getMembers(obj,parentLayerId)})}};function parseSearchResultEntity(dom,layerInfo){if(!dom||!dom.childNodes)return new Error("Bad request");var root=dom.childNodes[0],children=root.childNodes,result={entities:[]};for(var i=0,l=children.length;i<l;i++){var child=children[i],parser=parsers[child.nodeName];if(parser){var entity=parser(child,layerInfo.id);entity.layerId=layerInfo.id;result.entities.push(entity)}if("page"===child.nodeName){var attrs=child.attributes;result.pages=attrs.pages&&attrs.pages.value;result.pageIndex=attrs.currentpage&&attrs.currentpage.value;result.pageSize=attrs.pagesize&&attrs.pagesize.value;result.count=attrs.count&&attrs.count.value}}return result}connection.authenticated=function(){return oauth.authenticated()};connection.changesetJXON=function(tags){return{osm:{changeset:{tag:_.map(tags,function(value,key){return{"@k":key,"@v":value}}),"@version":2,"@generator":"KD"}}}};connection.osmChangeJXON=function(changeset_id,changes){function nest(x,order){var groups={};for(var i=0;i<x.length;i++){var tagName=Object.keys(x[i])[0];if(!groups[tagName])groups[tagName]=[];groups[tagName].push(x[i][tagName])}var ordered={};order.forEach(function(o){if(groups[o])ordered[o]=groups[o]});return ordered}var OSMString=["created","modified","deleted"];function rep(entity,i){return entity.asJXON(changeset_id,context,OSMString[i])}var created=changes.created.map(function(entity){return rep(entity,0)});var modified=changes.modified.map(function(entity){return rep(entity,1)});var deleted=changes.deleted.map(function(entity){return rep(entity,2)});return{osmChange:{"@version":2,"@generator":"KD",create:nest(created,["node","way","relation"]),modify:nest(modified,["node","way","relation"]),delete:_.extend(nest(deleted,["relation","way","node"]),{"@if-unused":true})}}};connection.changesetTags=function(comment,imageryUsed){var tags={imagery_used:imageryUsed.join(";").substr(0,255),created_by:"iD "+iD.version};if(comment){tags.comment=comment}return tags};connection.putChangeset=function(changes,comment,imageryUsed,callback){console.log(":::::::::changes:::::::",changes);for(var i=changes.created.length-1;0<=i;i--){var _entity=changes.created[i];if(_entity instanceof iD.Way&&"undefined"!=typeof _entity.tags&&"undefined"!=typeof _entity.modelName&&"Highway"==_entity.modelName){changes.created[i].tags=iD.ui.TagEditor.autoassign.road(_entity.tags)}}console.log(":::::::::\u81EA\u52A8\u8D4B\u503C\u540E\u7684changes:::::::",changes);var parser=new DOMParser;function createFormDataParam(action,content,changesetid){var param="action="+action;param+="instanceId="+_instanceId;param+="&user="+iD.User.getInfo().username;param+="&encode=UTF-8";if(changesetid){param+="&changesetId="+changesetid}param+="&xml="+encodeURIComponent(content);param+="&transId="+transId;return param}var headers={"Content-Type":"application/xml"};function createAction(uploadData){let instanceid=window._instanceId;var loader=function(err,data){if(!data){callback({errorType:"failed"},null);return}var changesetid=parseFloat(data.response);uploadAction(changesetid,uploadData)};var content=JXON.stringify(connection.changesetJXON(connection.changesetTags(comment,imageryUsed))),formData=createFormDataParam("create",content,null);var url,header=headers;url=iD.config.URL.kds_data+"data/changeset/create?instanceId="+instanceid;oauth.ohauth.rawxhr("POST",url,formData,header,loader)}var uploadAction=function(changesetid,uploaddata){let instanceid=window._instanceId;var uploader=function(err,data){if(!data){callback({errorType:"failed"},null);return}if(data.responseXML){var xmlDoc=parser.parseFromString(data.response,"text/xml")}else{let res=JSON.parse(data.response);if(_.isObject(res)){callback({errorType:"KDS",message:res.message},null);return}}closeAction(changesetid)};var content=JXON.stringify(connection.osmChangeJXON(changesetid,uploaddata)),formData=createFormDataParam("upload",content,changesetid);formData=content;var url;var header=headers;if(true==_isInstance){url=iD.config.URL.kds_data+"data/changeset/"+changesetid+"/upload?instanceId="+instanceid}else if(iD.Task&&iD.Task.d){url=iD.config.URL.kds_data+"trans/"+iD.Task.d.tags.transId+"/edit?changesetId="+changesetid}oauth.ohauth.rawxhr("POST",url,formData,header,uploader)};function closeAction(changesetid){let instanceid=window._instanceId;var closeLoader=function(err,data){if(!data){callback({errorType:"failed"},null);return}if(!err){var xmlDoc=parser.parseFromString(data.response,"text/xml")}if(0<data.responseText.indexOf("error")){callback(err,xmlDoc);return}callback(err,xmlDoc)};var formData=createFormDataParam("close","<xml version=\"1\" encoding=\"gb2312\"/>",changesetid);var header=headers;var url=iD.config.URL.kds_data+"data/changeset/"+changesetid+"/close?instanceId="+instanceid;oauth.ohauth.rawxhr("POST",url,formData,header,closeLoader)}var saveDataAction=function(uploaddata,opts={}){var saveLoader=function(err,data){if(!data||err){callback(err||{errorType:"failed"},null);return}var xmlDoc;if(data.responseXML){xmlDoc=parser.parseFromString(data.response,"text/xml")}else{var res=JSON.parse(data.response);if(res&&"0"!=res.code){callback({errorType:"KDS",message:res.message},null);return}}callback(err,xmlDoc)};var content=JXON.stringify(connection.osmChangeJXON(null,uploaddata)),formData=createFormDataParam("upload",content,null);formData=content;var header=headers;var megreParam="";var baseServer=iD.config.URL.kds_tag,url="";if(opts.tagServer){var appType=opts.appType;if(appType){megreParam+="app="+appType}url=baseServer+"data/task/"+iD.Task.taskId()+"/edit"}else{var batchVal=opts.BATCH||"";baseServer=iD.config.URL.kds_data;if(batchVal){megreParam+="batch="+batchVal}url=baseServer+"data/task/"+iD.Task.taskId(batchVal)+"/"+iD.Task.dbCode(batchVal)+"/edit"}megreParam+=(megreParam?"&":"")+"user="+iD.User.getInfo().username;url+="?"+megreParam;oauth.ohauth.rawxhr("POST",url,formData,header,saveLoader)};var item={created:[],deleted:[],modified:[]};item.created=changes.created;item.deleted=changes.deleted;item.modified=changes.modified;var difference=context.history().difference().changes();for(var kId in difference){item.modified.forEach(function(v,k){if(v.id===kId){var diff=difference[kId],btags=diff.base.tags,htags=diff.head.tags,tags={};for(var tn in htags)btags[tn]!==htags[tn]&&(tags[tn]=htags[tn]);v.tags=tags;if("line"===v.geometry(context.graph())){var _diff=_.difference(diff.head.nodes,diff.base.nodes);!(diff.base.nodes.length!==diff.head.nodes.length||0!==_diff.length)&&(v.nodes=[])}}})}function _getTagItem(tagType){let result={},modelName;if(1==tagType){modelName=iD.data.DataType.CHECK_TAG}else if(2==tagType){modelName=iD.data.DataType.IMAGE_TAG}else if(3==tagType){modelName=iD.data.DataType.ANALYSIS_TAG}else if(4==tagType){modelName=iD.data.DataType.QUESTION_TAG}else{return result}for(let type in item){result[type]=[];let tmpArr=[];item[type]=_.compact(_.map(item[type]||[],function(entity){if(entity&&entity.modelName===modelName){result[type].push(entity);return}return entity}))}return result}let checkItem=_getTagItem(1);if(checkItem.created.length||checkItem.deleted.length||checkItem.modified.length){saveDataAction(checkItem,{tagServer:true,appType:getTagAppType(1)})}let analysisItem=_getTagItem(3);if(analysisItem.created.length||analysisItem.deleted.length||analysisItem.modified.length){saveDataAction(analysisItem,{tagServer:true,appType:getTagAppType(3)})}let questionItem=_getTagItem(4);if(questionItem.created.length||questionItem.deleted.length||questionItem.modified.length){saveDataAction(questionItem,{tagServer:true,appType:getTagAppType(4)})}if(item.created.length||item.deleted.length||item.modified.length){if(iD.User.isWorkRole()){var batchItem=saveDataGroupByBatch(item);if(batchItem[""]){var emp=batchItem[""];var fkey=_.compact(_.keys(batchItem))[0];if(fkey){batchItem[fkey].created.push(...emp.created);batchItem[fkey].deleted.push(...emp.deleted);batchItem[fkey].modified.push(...emp.modified);delete batchItem[""]}}_.each(batchItem,function(bitem,batchid){if(bitem.created.length||bitem.deleted.length||bitem.modified.length){saveDataAction(bitem,{BATCH:batchid})}})}else{console.log("%c\u8981\u7D20\u672A\u6839\u636E\u6279\u6B21\u5206\u7EC4\u4FDD\u5B58 ......","color: red; font-weight: blod;");saveDataAction(item)}}};function saveDataGroupByBatch(protoItem){let result={},obj={};obj.created=_.groupBy(protoItem.created,function(d){var dlay=iD.Layers.getLayer(d.layerId);return dlay&&dlay.batch||d.tags.BATCH||""});obj.modified=_.groupBy(protoItem.modified,function(d){d=context.entity(d.id);var dlay=iD.Layers.getLayer(d.layerId);return dlay&&dlay.batch||d.tags.BATCH||""});obj.deleted=_.groupBy(protoItem.deleted,function(d){var dlay=iD.Layers.getLayer(d.layerId);return dlay&&dlay.batch||d.tags.BATCH||""});_.each(obj,function(batchItem,type){_.each(batchItem,function(dataList,batchid){let item=result[batchid];if(!item){item=result[batchid]={};item.created=item.modified=item.deleted=[]}item[type]=dataList})});return result}function abortRequest(i){if(i){i.abort()}}connection.tileZoom=function(_){if(!arguments.length)return tileZoom;tileZoom=_;return connection};connection.loadData=function(projection,dimensions){if(iD.Task.d){connection.loadTiles(projection,dimensions)}};connection.loadCheckTagList=function(projection,dimensions){if(off)return;if(!iD.User||!iD.User.authQueryTag()||!iD.Task.d||!iD.Layers.getLayersByModelName(iD.data.DataType.CHECK_TAG).length){return}var s=2*projection.scale()*Math.PI,z=Math.max(Math.log(s)/Math.log(2)-8,0);if(z<context.map().editableLevel()){return}_loadTagDataList(1)};connection.loadImageTagList=function(projection,dimensions){if(off)return;if(!iD.User||!iD.User.authQueryTag()||!iD.Task.d||!iD.Layers.getLayersByModelName(iD.data.DataType.IMAGE_TAG).length){return}var s=2*projection.scale()*Math.PI,z=Math.max(Math.log(s)/Math.log(2)-8,0);if(z<context.map().editableLevel()){return}_loadTagDataList(2)};connection.loadAnalysisTagList=function(projection,dimensions){if(off)return;if(!iD.User||!iD.User.authQueryTag()||!iD.Task.d||!iD.Layers.getLayersByModelName(iD.data.DataType.ANALYSIS_TAG).length){return}var s=2*projection.scale()*Math.PI,z=Math.max(Math.log(s)/Math.log(2)-8,0);if(z<context.map().editableLevel()){return}_loadTagDataList(3)};connection.loadQuestionTagList=function(projection,dimensions){if(off)return;if(!iD.User||!iD.User.authQueryTag()||!iD.Task.d||!iD.Layers.getLayersByModelName(iD.data.DataType.QUESTION_TAG).length){return}var s=2*projection.scale()*Math.PI,z=Math.max(Math.log(s)/Math.log(2)-8,0);if(z<context.map().editableLevel()){return}_loadTagDataList(4)};function _loadTagDataList(loadType){let modelName="",layer;let appType="";let _checkTagKey="tag_load";switch(loadType){case 1:modelName=iD.data.DataType.CHECK_TAG;appType=getTagAppType(1);break;case 2:modelName=iD.data.DataType.IMAGE_TAG;appType=getTagAppType(2);break;case 3:modelName=iD.data.DataType.ANALYSIS_TAG;appType=getTagAppType(3);break;case 4:modelName=iD.data.DataType.QUESTION_TAG;appType=getTagAppType(4);break;default:break;}if(appType){_checkTagKey=appType+"_load"}if(loadedTiles[_checkTagKey]||inflightTag[_checkTagKey]){return}layer=iD.Layers.getLayersByModelName(modelName)[0];var requestTaskid=iD.Task.d.task_id;function queryCheckTagUrl(){if(!iD.config||!iD.config.URL){return""}var mergePara="";if(appType){mergePara="app="+appType}mergePara+="&modelName="+modelName;var dataUrl=iD.config.URL.kds_tag+"data/TASKID/"+requestTaskid+"/query?"+mergePara;return dataUrl}if(_.isEmpty(inflightTag)){event.loading()}inflightTag[_checkTagKey]=connection.loadFromURL(queryCheckTagUrl(),function(err,parsed,lay){loadedTiles[_checkTagKey]=true;delete inflightTag[_checkTagKey];if(requestTaskid!=iD.Task.d.task_id){delete loadedTiles[_checkTagKey];return}var loadedObj={loaded:false};if(_.isEmpty(inflightTag)){loadedObj.loaded=true}if(parsed&&parsed.length){event.load(err,_.extend({data:parsed},{extent:context.map()&&context.map().extent()},loadedObj))}if(_.isEmpty(inflightTag)){event.loaded(lay,true)}},layer,true)}connection.loadLayerInfo=function(fn,layers){if(!layers)layers=iD.Layers.getLayers();var urls=[],isSubMode={};layers.forEach(function(item,k){if(item.isHotspot&&item.isHotspot())return;urls.push(dataLayerUrl(item));if(item.isRoad()&&item.group_members){var lsIds=[];item.group_members.forEach(function(litem,lk){lsIds.push(litem.id)});urls.push(dataLayerUrl(item,lsIds));isSubMode[k+1]=true}});function asyncQuest(inputs,callback){var results=[],errors=[],remaining=inputs.length;event.loading();inputs.forEach(function(d,i){if(layerObjCache[d]){remaining--;return}layerObjCache[d]=true;d3.xml(d,function done(err,data){errors[i]=err;results[i]=data;remaining--;if(!remaining)callback(errors,results)})})}function loadedLayerInfo(){for(var i in urls)if(!layerObjCache[urls[i]])return false;return true}function triumph(err,xmls){xmls.forEach(function(dom,j){if(isSubMode[j]){parseSubDataLayer(dom)}else{parseDataLayer(dom)}});event.loaded();loadedLayerFlag=true;fn()}if(loadedLayerFlag&&loadedLayerInfo()){fn()}else{asyncQuest(urls,triumph)}};connection.loadTiles=function(projection,dimensions){if(off)return;var s=2*projection.scale()*Math.PI,z=Math.max(Math.log(s)/Math.log(2)-8,0);if(z<context.map().editableLevel()){return}var ts=256*Math.pow(2,z-tileZoom),origin=[s/2-projection.translate()[0],s/2-projection.translate()[1]];var tiles=d3.geo.tile().scaleExtent([tileZoom,tileZoom]).scale(s).size(dimensions).translate(projection.translate())();tiles=tiles.map(function(tile){var x=tile[0]*ts-origin[0],y=tile[1]*ts-origin[1];return{id:tile.toString(),extent:iD.geo.Extent(projection.invert([x,y+ts]),projection.invert([x+ts,y]))}});function bboxUrl(tile,layer){if(!iD.config||!iD.config.URL){return""}var mergePara="";if(iD.Task.d){mergePara="&filter=true"}var batchVal=layer&&layer.batch||"";var dataUrl=iD.config.URL.kds_data+"data/task/"+iD.Task.taskId(batchVal)+"/"+iD.Task.dbCode(batchVal)+"/bbox?bbox="+tile.extent.toParam()+mergePara+"&tileId="+tile.id;if(layer){var _last=_.last(layer.url);dataUrl=layer.url+"&bbox="+tile.extent.toParam()+mergePara+"&tileId="+tile.id;if("?"==_last&&-1<dataUrl.indexOf("?&")){dataUrl=dataUrl.replace("?&","?")}}return dataUrl}var layers=iD.Layers.getLayers();var tagModels=[iD.data.DataType.CHECK_TAG,iD.data.DataType.IMAGE_TAG,iD.data.DataType.ANALYSIS_TAG,iD.data.DataType.QUESTION_TAG];layers=layers.filter(function(layer){for(var mname of tagModels){if(iD.util.getModelNameByItem(layer.models.datas,mname)){return false}}return true});layers.forEach(function(layer){_.filter(inflight,function(v,i){var wanted=_.find(tiles,function(tile){var id=tile.id+","+layer.id;if(i===id){return true}return false});if(!wanted)delete inflight[i];return!wanted}).map(abortRequest)});var _dataList=[];layers.forEach(function(layer){if(!layer.url||!layer.display){return false}tiles.forEach(function(tile){var id=tile.id+","+layer.id;if(loadedTiles[id]||inflight[id])return;if(_.isEmpty(inflight)){event.loading()}inflight[id]=connection.loadFromURL(bboxUrl(tile,layer),function(err,parsed,lay){loadedTiles[id]=true;delete inflight[id];var loadedObj={loaded:false};if(_.isEmpty(inflight)){loadedObj.loaded=true}var hasLoad=false;if(0<parsed.length){console.log("load",id);event.load(err,_.extend({data:parsed||[]},tile,loadedObj));hasLoad=true}if(loadedObj.loaded){if(!hasLoad){event.load(err,_.extend({data:parsed||[]},tile,loadedObj))}event.loaded()}},layer)})})};connection.loadSearchResult=function(condition,layerInfo,pageIndex,pageSize,callback){var url=layerInfo.url+"/data/query/list?sid=2100&encode=UTF-8&layerId="+layerInfo.id+"&currentpage="+pageIndex+"&pagesize="+pageSize+"&filter="+encodeURIComponent(condition);d3.xml(url,function done(err,xml){var result=parseSearchResultEntity(xml,layerInfo);callback(result)})};iD.User&&iD.User.on("login.connection",function(){transId=iD.util.stringQs(window.location.href).transId||22,holes={},useId=iD.User.getInfo().userid,users=context.users={};users[useId]={};users.cUseId=useId});connection.searchPictureFeatureInfo=function(layerId,bbox,x,y,width,height,callback){var searchCount=0;var callbackCount=0;var searchResult=[];var tagFlags=[];var layers=editor.getOverlayers();layers.forEach(function(layer){if(layer.visible&&layer.dataUrl){searchCount++}});var flag=false;function searchCallBack(d,tagFlag){searchResult.push(d);tagFlags.push(tagFlag);callbackCount++;if(searchResult.length==searchCount){for(var i=0;i<searchCount;i++){if(searchResult[i]&&searchResult[i].length){callback(searchResult[i],tagFlags[i]);return}}callback()}return}for(var i=0;i<layers.length;i++){if(layers[i].visible&&layers[i].dataUrl){var queryUrl=layers[i].dataUrl+"outputFormat=geojson&bbox="+bbox[0][0]+","+bbox[0][1]+","+bbox[1][0]+","+bbox[1][1]+"&X="+x+"&y="+y+"&width="+width+"&height="+height+"&callback={callback}";if("t_pkb_shp"==layers[i].id){d3.jsonp(queryUrl,function(d){searchCallBack(d,iD.tagIndex.t_pkb_shp)})}else if("t_pkb_tag"==layers[i].id){d3.jsonp(queryUrl,function(d){searchCallBack(d,iD.tagIndex.t_pkb_tag)})}else if("t_user_feedback_pkb_tag"==layers[i].id){d3.jsonp(queryUrl,function(d){searchCallBack(d,iD.tagIndex.t_user_feedback_pkb_tag)})}else if("t_user_feedback_pkb_shp"==layers[i].id){d3.jsonp(queryUrl,function(d){searchCallBack(d,iD.tagIndex.t_user_feedback_pkb_shp)})}else{d3.jsonp(queryUrl,function(d){searchCallBack(d,iD.tagIndex.ref_tag)})}flag=true}}if(!flag){callback()}};connection.switch=function(options){url=options.url;oauth.options(_.extend({loading:authenticating,done:authenticated},options));event.auth();connection.flush();return connection};connection.toggle=function(_){off=!_;return connection};connection.flush=function(){_.forEach(inflight,abortRequest);loadedTiles={};inflight={};inflightTag={};return connection};connection.loadedTiles=function(_){if(!arguments.length)return loadedTiles;loadedTiles=_;return connection};connection.logout=function(){oauth.logout();event.auth();return connection};return d3.rebind(connection,event,"on")};;;iD.Difference=function(base,head){var changes={},length=0;function changed(h,b){return!_.isEqual(_.omit(h,"v"),_.omit(b,"v"))}_.each(head.entities,function(h,id){var b=base.entities[id];if(changed(h,b)){changes[id]={base:b,head:h};length++}});_.each(base.entities,function(b,id){var h=head.entities[id];if(!changes[id]&&changed(h,b)){changes[id]={base:b,head:h};length++}});function addParents(parents,result){for(var i=0;i<parents.length;i++){var parent=parents[i];if(parent.id in result)continue;result[parent.id]=parent;addParents(head.parentRelations(parent),result)}}function addChildren(entity,result,head){var members=entity.members||[];for(var i=0;i<members.length;i++){if(members[i].id in result){continue}if(head.hasEntity(members[i].id)){var memberObj=head.entity(members[i].id);result[memberObj.id]=memberObj;if("relation"==memberObj.type){addChildren(memberObj,result,head)}}}}var difference={};difference.length=function(){return length};difference.changes=function(){return changes};difference.extantIDs=function(){var result=[];_.each(changes,function(change,id){if(change.head)result.push(id)});return result};difference.modified=function(){var result=[];_.each(changes,function(change){if(change.base&&change.head)result.push(change.head)});return result};difference.created=function(){var result=[];_.each(changes,function(change){if(!change.base&&change.head)result.push(change.head)});return result};difference.deleted=function(){var result=[];_.each(changes,function(change){if(change.base&&!change.head)result.push(change.base)});return result};difference.summary=function(){var relevant={};function addEntity(entity,graph,changeType){relevant[entity.id]={entity:entity,graph:graph,changeType:changeType}}function addParents(entity){var parents=head.parentWays(entity);for(var j=parents.length-1;0<=j;j--){var parent=parents[j];if(!(parent.id in relevant))addEntity(parent,head,"modified")}}_.each(changes,function(change){if(change.head&&"vertex"!==change.head.geometry(head)){addEntity(change.head,head,change.base?"modified":"created")}else if(change.base&&"vertex"!==change.base.geometry(base)){addEntity(change.base,base,"deleted")}else if(change.base&&change.head){var moved=!_.isEqual(change.base.loc,change.head.loc),retagged=!_.isEqual(change.base.tags,change.head.tags);if(moved){addParents(change.head)}if(retagged||moved&&change.head.hasInterestingTags()){addEntity(change.head,head,"modified")}}else if(change.head&&change.head.hasInterestingTags()){addEntity(change.head,head,"created")}else if(change.base&&change.base.hasInterestingTags()){addEntity(change.base,base,"deleted")}});return d3.values(relevant)};difference.complete=function(extent){var result={},id,change;for(id in changes){change=changes[id];var h=change.head,b=change.base,entity=h||b;if(extent&&(!h||!h.intersects(extent,head))&&(!b||!b.intersects(extent,base)))continue;result[id]=h;if("way"===entity.type){var nh=h?h.nodes:[],nb=b?b.nodes:[],diff,i;diff=_.difference(nh,nb);for(i=0;i<diff.length;i++){result[diff[i]]=head.hasEntity(diff[i])}diff=_.difference(nb,nh);for(i=0;i<diff.length;i++){result[diff[i]]=head.hasEntity(diff[i])}}addParents(head.parentWays(entity),result);addParents(head.parentRelations(entity),result);if(entity.tags&&entity.modelName&&addChildRenFlagSet[entity.modelName]){addChildren(entity,result,head)}}return result};var addChildRenFlagSet={};addChildRenFlagSet[iD.data.DataType.R_DIVIDER_DREF]=1;addChildRenFlagSet[iD.data.DataType.DIVIDER_ATTRIBUTE]=1;addChildRenFlagSet[iD.data.DataType.R_ROAD_DIVIDER]=1;addChildRenFlagSet[iD.data.DataType.R_DIVIDER_JUNCTION]=1;return difference};;;iD.Entity=function(attrs){if(this instanceof iD.Entity)return;if(attrs&&attrs.type){return iD.Entity[attrs.type].apply(this,arguments)}else if(attrs&&attrs.id){return iD.Entity[iD.Entity.id.type(attrs.id)].apply(this,arguments)}return new iD.Entity().initialize(arguments)};iD.Entity.id=function(type,layerId){return iD.Entity.id.fromOSM(type,iD.Entity.id.next[type]--,layerId)};iD.Entity.id.next={node:-1,way:-1,relation:-1,transportation:-1,marker:-1,polyline:-1,polygon:1000,label:-1,icon:-1,circle:-1,transpolygon:-1};iD.Entity.id.delimiter="_";iD.Entity.id.fromOSM=function(type,id,_){if(_&&(2==window._systemType||1==window._systemType))return type[0]+_+iD.Entity.id.delimiter+id;else return type[0]+iD.Entity.id.delimiter+id};iD.Entity.id.toOSM=function(id){let strs=id.split(iD.Entity.id.delimiter);return strs[strs.length-1]};iD.Entity.id.type=function(id){return{n:"node",w:"way",r:"relation"}[id[0]]};iD.Entity.key=function(entity){return entity.id+"v"+(entity.v||0)};iD.Entity.prototype={tags:{},initialize:function(sources){let isTag=false;for(var i=0;i<sources.length;++i){var source=sources[i];if(source.tags){isTag=true}for(var prop in source){if(Object.prototype.hasOwnProperty.call(source,prop)){this[prop]=source[prop]}}}if(!this.id&&this.type){this.id=iD.Entity.id(this.type,this.layerId)}if(iD.debug){Object.freeze(this);Object.freeze(this.tags);if(this.loc)Object.freeze(this.loc);if(this.nodes)Object.freeze(this.nodes);if(this.members)Object.freeze(this.members)}if(this.loc&&2===this.loc.length){this.loc.push(-1)}if(iD.ModelEntitys&&!isTag&&this.modelName){this.setDefaultTags()}else if(!isTag){this.tags={}}return this},osmId:function(){return iD.Entity.id.toOSM(this.id)},isNew:function(){return 0>this.osmId()},update:function(attrs){iD.util.tagExtend.modelNameErro(this);return iD.Entity(this,attrs,{v:1+(this.v||0)})},setDefaultTags:function(){let defaultTags={};if(this.layerId&&this.modelName){var modelEntity=iD.ModelEntitys[this.modelName];if(modelEntity){var gtype=modelEntity.getGeoType();modelEntity.getFields(gtype).filter(function(d){if(d.defaultValue&&!_.isEmpty(d.defaultValue)){defaultTags[d.fieldName]=d.defaultValue}})}}this.tags=defaultTags},setTags:function(d){this.tags=d},mergeTags:function(tags){var merged=_.clone(this.tags),changed=false;for(var k in tags){var t1=merged[k],t2=tags[k];if(!t1){changed=true;merged[k]=t2}else if(t1!==t2){changed=true;merged[k]=t2}}return changed?this.update({tags:merged}):this},intersects:function(extent,resolver){return this.extent(resolver).intersects(extent)},isUsed:function(resolver){return 0<_.without(Object.keys(this.tags),"area").length||0<resolver.parentRelations(this).length},isInterestingTags:function(){return this.modelName==iD.data.DataType.ROAD_NODE||this.modelName==iD.data.DataType.DIVIDER_NODE||this.modelName==iD.data.DataType.ROAD_NODE||this.modelName==iD.data.DataType.OBJECT_PL_NODE||this.modelName==iD.data.DataType.BRIDGE_NODE;var tgs=this.tags;return _.keys(this.tags).some(function(key){return"RoadNode"===tgs[key]})},hasInterestingTags:function(){return _.keys(this.tags).some(function(key){return"attribution"!==key&&"created_by"!==key&&"source"!==key&&"odbl"!==key&&0!==key.indexOf("tiger:")})},isHighwayIntersection:function(){return false},deprecatedTags:function(){var tags=_.pairs(this.tags);var deprecated={};iD.data.deprecated.forEach(function(d){var match=_.pairs(d.old)[0];tags.forEach(function(t){if(t[0]===match[0]&&(t[1]===match[1]||"*"===match[1])){deprecated[t[0]]=t[1]}})});return deprecated},g:function(){if(!this.graphType)return false;var graphType=this.graphType;return{marker:function(){if("marker"==graphType)return true;return false},polyline:function(){if("polyline"==graphType)return true;return false},polygon:function(){if("polygon"==graphType)return true;return false},g:function(){if("polygon"==graphType||"polyline"==graphType||"marker"==graphType||"circle"==graphType)return true;return false}}},setEnable:function(_,map){this.enable=_;if(map)map.getMap().drawOverlayers()},modelNameTypeMatch:function(modelName){return modelName&&this.modelName===modelName||this._type===modelName||this._type===modelName.toLowerCase()}};;;iD.Graph=function(other,mutable){if(!(this instanceof iD.Graph))return new iD.Graph(other,mutable);if(other instanceof iD.Graph){var base=other.base();this.entities=_.assign(Object.create(base.entities),other.entities);this._parentWays=_.assign(Object.create(base.parentWays),other._parentWays);this._parentRels=_.assign(Object.create(base.parentRels),other._parentRels)}else{this.entities=Object.create({});this._parentWays=Object.create({});this._parentRels=Object.create({});this.rebase(other||[],[this])}this.transients={};this._childNodes={};if(!mutable){this.freeze()}};iD.Graph.prototype={extendNode:function(node,loc,tags){var newNode=iD.Node({layerId:node.layerId,loc:loc||node.loc,modelName:node.modelName});newNode.version=node.version;newNode=newNode.mergeTags(tags);return newNode},extendWay:function(way){var newWay=iD.Way({layerId:way.layerId,nodes:way.nodes,modelName:way.modelName});newWay.version=way.version;newWay=newWay.mergeTags(way.tags);return newWay},hasEntity:function(id){return this.entities[id]},entity:function(id){var entity=this.entities[id];if(!entity){throw new Error("entity "+id+" not found")}return entity},transient:function(entity,key,fn){var id=entity.id,transients=this.transients[id]||(this.transients[id]={});if(transients[key]!==undefined){return transients[key]}transients[key]=fn.call(entity);return transients[key]},parentWays:function(entity){return _.map(this._parentWays[entity.id],this.entity,this)},isPoi:function(entity){if(entity&&"node"===entity.type&&(entity.isPlaceName()||entity.isRoadCross()||entity.isQcTag())){return true}var parentWays=this._parentWays[entity.id];return!parentWays||0===parentWays.length},isShared:function(entity){var parentWays=this._parentWays[entity.id];return parentWays&&1<parentWays.length},parentRelations:function(entity,modelName){var relIds=this._parentRels[entity.id];var rels=[];if(relIds){for(var i=0;i<relIds.length;i++){var id=relIds[i];var entity=this.entities[id];if(1==arguments.length){if(entity){rels.push(entity)}}else if(entity&&modelName==entity.modelName){rels.push(entity)}}}return rels},childNodes:function(entity){if(this._childNodes[entity.id])return this._childNodes[entity.id];var nodes=[];for(var i=0,l=entity.nodes.length;i<l;i++){nodes[i]=this.entity(entity.nodes[i])}if(iD.debug)Object.freeze(nodes);this._childNodes[entity.id]=nodes;return this._childNodes[entity.id]},base:function(){return{entities:iD.util.getPrototypeOf(this.entities),parentWays:iD.util.getPrototypeOf(this._parentWays),parentRels:iD.util.getPrototypeOf(this._parentRels)}},rebase:function(entities,stack){var base=this.base(),i,j,k,id;for(i=0;i<entities.length;i++){var entity=entities[i];if(base.entities[entity.id])continue;base.entities[entity.id]=entity;this._updateCalculated(undefined,entity,base.parentWays,base.parentRels);if("way"===entity.type){for(j=0;j<entity.nodes.length;j++){id=entity.nodes[j];for(k=1;k<stack.length;k++){var ents=stack[k].entities;if(ents.hasOwnProperty(id)&&ents[id]===undefined){delete ents[id]}}}}}for(i=0;i<stack.length;i++){stack[i]._updateRebased()}},_updateRebased:function(){var base=this.base(),i,k,child,id,keys;keys=Object.keys(this._parentWays);for(i=0;i<keys.length;i++){child=keys[i];if(base.parentWays[child]){for(k=0;k<base.parentWays[child].length;k++){id=base.parentWays[child][k];if(!this.entities.hasOwnProperty(id)&&!_.contains(this._parentWays[child],id)){this._parentWays[child].push(id)}}}}keys=Object.keys(this._parentRels);for(i=0;i<keys.length;i++){child=keys[i];if(base.parentRels[child]){for(k=0;k<base.parentRels[child].length;k++){id=base.parentRels[child][k];if(!this.entities.hasOwnProperty(id)&&!_.contains(this._parentRels[child],id)){this._parentRels[child].push(id)}}}}this.transients={}},_updateCalculated:function(oldentity,entity,parentWays,parentRels){parentWays=parentWays||this._parentWays;parentRels=parentRels||this._parentRels;let type=entity&&entity.type||oldentity&&oldentity.type,removed,added,ways,rels,i;if("way"===type){if(oldentity&&entity){removed=_.difference(oldentity.nodes,entity.nodes);added=_.difference(entity.nodes,oldentity.nodes)}else if(oldentity){removed=oldentity.nodes;added=[]}else if(entity){removed=[];added=entity.nodes}for(i=0;i<removed.length;i++){parentWays[removed[i]]=_.without(parentWays[removed[i]],oldentity.id)}for(i=0;i<added.length;i++){ways=_.without(parentWays[added[i]],entity.id);ways.push(entity.id);parentWays[added[i]]=ways}}else if("relation"===type){if(oldentity&&entity){removed=_.difference(oldentity.members,entity.members);added=_.difference(entity.members,oldentity)}else if(oldentity){removed=oldentity.members||[];added=[]}else if(entity){removed=[];added=entity.members||[]}for(i=0;i<removed.length;i++){parentRels[removed[i].id]=_.without(parentRels[removed[i].id],oldentity.id)}for(i=0;i<added.length;i++){rels=_.without(parentRels[added[i].id],entity.id);rels.push(entity.id);parentRels[added[i].id]=rels}}else if("node"===type&&(oldentity&&-1<iD.data.asRelations.indexOf(oldentity.modelName)||entity&&-1<iD.data.asRelations.indexOf(entity.modelName))){if(oldentity&&entity){removed=_.difference(oldentity.members,entity.members);added=_.difference(entity.members,oldentity)}else if(oldentity){removed=oldentity.members||[];added=[]}else if(entity){removed=[];added=entity.members||[]}for(i=0;i<removed.length;i++){parentRels[removed[i].id]=_.without(parentRels[removed[i].id],oldentity.id)}for(i=0;i<added.length;i++){rels=_.without(parentRels[added[i].id],entity.id);rels.push(entity.id);parentRels[added[i].id]=rels}}},replace:function(entity){if(_.isEqual(this.entities[entity.id],entity)){return this}return this.update(function(){this._updateCalculated(this.entities[entity.id],entity);this.entities[entity.id]=entity})},remove:function(entity){return this.update(function(){this._updateCalculated(entity,undefined);this.entities[entity.id]=undefined})},update:function(){var graph=this.frozen?iD.Graph(this,true):this;for(var i=0;i<arguments.length;i++){arguments[i].call(graph,graph)}return this.frozen?graph.freeze():this},freeze:function(){this.frozen=true;return this},load:function(entities){var base=this.base();this.entities=Object.create(base.entities);for(var i in entities){this.entities[i]=entities[i];this._updateCalculated(base.entities[i],this.entities[i])}return this}};;;iD.History=function(context){var stack,index,tree,imageryUsed=["Bing"],dispatch=d3.dispatch("change","undone","redone"),lock=iD.util.SessionMutex("lock");if(!iD.User){}else{var username=iD.User.getInfo().username}function perform(actions){actions=Array.prototype.slice.call(actions);var annotation;if(!_.isFunction(_.last(actions))){annotation=actions.pop()}var graph=stack[index].graph;for(var i=0;i<actions.length;i++){graph=actions[i](graph)}return{graph:graph,annotation:annotation,imageryUsed:imageryUsed}}function change(previous){var difference=iD.Difference(previous,history.graph());dispatch.change(difference);if(null!=d3.select("#effects-forbid-info")[0][0]&&true==d3.select("#effects-forbid-info").classed("active")||null!=d3.select("#effects-limit-line")[0][0]&&true==d3.select("#effects-limit-line").classed("active")){var flag=false;var complete=difference.complete(context.map().extent());var all=_.compact(_.values(complete));for(var key in all){try{if(all[key]&&all[key].tags&&all[key].modelName&&(0==all[key].modelName.indexOf(iD.data.DataType.ASSISTINFO)||0==all[key].modelName.indexOf(iD.data.DataType.FORBIDINFO))){context.map().dimensions(context.map().dimensions());flag=true;break}}catch(e){console.log(all)}}if(!flag){var complete=iD.Difference(history.graph(),previous).complete(context.map().extent());var all=_.compact(_.values(complete));for(var key in all){try{if(all[key]&&all[key].tags&&all[key].modelName&&(0==all[key].modelName.indexOf(iD.data.DataType.ASSISTINFO)||0==all[key].modelName.indexOf(iD.data.DataType.FORBIDINFO))){context.map().dimensions(context.map().dimensions());flag=true;break}}catch(e){console.log(all)}}}}return difference}function getKey(n){if(iD.Task.d){return"iD_"+iD.Task.d.task_id+"_"+n}else{return}}var history={graph:function(){return stack[index].graph},merge:function(entities,extent,url,loadedFlag){stack[0].graph.rebase(entities,_.pluck(stack,"graph"));tree.rebase(entities);if(loadedFlag){dispatch.change(undefined,context.map().extent())}},perform:function(){var previous=stack[index].graph;stack=stack.slice(0,index+1);stack.push(perform(arguments));index++;return change(previous)},replace:function(){var previous=stack[index].graph;stack[index]=perform(arguments);return change(previous)},pop:function(){var previous=stack[index].graph;if(0<index){index--;stack.pop();return change(previous)}},popAll:function(){while(0<index){var previous=stack[index].graph;index--;stack.pop();change(previous)}},undo:function(){var previous=stack[index].graph;while(0<index){index--;if(stack[index].annotation)break}dispatch.undone();return change(previous)},redo:function(){var previous=stack[index].graph;while(index<stack.length-1){index++;if(stack[index].annotation)break}dispatch.redone();return change(previous)},undoAnnotation:function(){var i=index;while(0<=i){if(stack[i].annotation)return stack[i].annotation;i--}},redoAnnotation:function(){var i=index+1;while(i<=stack.length-1){if(stack[i].annotation)return stack[i].annotation;i++}},intersects:function(extent){return tree.intersects(extent,stack[index].graph)},difference:function(){var base=stack[0].graph,head=stack[index].graph;return iD.Difference(base,head)},changes:function(action){var base=stack[0].graph,head=stack[index].graph;if(action){head=action(head)}var difference=iD.Difference(base,head);return{modified:difference.modified(),created:difference.created(),deleted:difference.deleted()}},hasChanges:function(){return 0<this.difference().length()},imageryUsed:function(sources){if(sources){imageryUsed=sources;return history}else{return _(stack.slice(1,index+1)).pluck("imageryUsed").flatten().unique().without(undefined,"Custom").value()}},reset:function(){stack=[{graph:iD.Graph()}];index=0;tree=iD.Tree(stack[0].graph);dispatch.change();return history},toJSON:function(){if(1>=stack.length)return;var allEntities={},baseEntities={},base=stack[0];var s=stack.map(function(i){var modified=[],deleted=[];_.forEach(i.graph.entities,function(entity,id){if(entity){var key=iD.Entity.key(entity);allEntities[key]=entity;modified.push(key)}else{deleted.push(id)}if(id in base.graph.entities){baseEntities[id]=base.graph.entities[id]}});var x={};if(modified.length)x.modified=modified;if(deleted.length)x.deleted=deleted;if(i.imageryUsed)x.imageryUsed=i.imageryUsed;if(i.annotation)x.annotation=i.annotation;return x});return JSON.stringify({version:3,entities:_.values(allEntities),baseEntities:_.values(baseEntities),stack:s,nextIDs:iD.Entity.id.next,index:index})},fromJSON:function(json){var h=JSON.parse(json);iD.Entity.id.next=h.nextIDs;index=h.index;if(2===h.version||3===h.version){var allEntities={};h.entities.forEach(function(entity){allEntities[iD.Entity.key(entity)]=iD.Entity(entity)});if(3===h.version){var baseEntities=h.baseEntities.map(iD.Entity);stack[0].graph.rebase(baseEntities,_.pluck(stack,"graph"));tree.rebase(baseEntities)}stack=h.stack.map(function(d){var entities={},entity;if(d.modified){d.modified.forEach(function(key){entity=allEntities[key];entities[entity.id]=entity})}if(d.deleted){d.deleted.forEach(function(id){entities[id]=undefined})}return{graph:iD.Graph(stack[0].graph).load(entities),annotation:d.annotation,imageryUsed:d.imageryUsed}})}else{stack=h.stack.map(function(d){var entities={};for(var i in d.entities){var entity=d.entities[i];entities[i]="undefined"===entity?undefined:iD.Entity(entity)}d.graph=iD.Graph(stack[0].graph).load(entities);return d})}dispatch.change();return history},save:function(){if(lock.locked()){context.storage(getKey(username),history.toJSON()||null);if(context.storage(getKey(username))&&3000000<context.storage(getKey(username)).length){context.filehistory().savetxt(context.storage(getKey(username)))}else{}}return history},clearSaved:function(){if(lock.locked())context.storage(getKey(username),null);return history},lock:function(){return lock.lock()},unlock:function(){lock.unlock()},restorableChanges:function(){return lock.locked()&&!!context.storage(getKey(username))},restore:function(){if(!lock.locked())return;var json=context.storage(getKey(username));if(json)history.fromJSON(json)},_getKey:getKey};history.reset();return d3.rebind(history,dispatch,"on")};;;iD.fileHistory=function(context){window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;function getKey(n){return"iD_"+window.location.origin+"_"+n}var filehistory={blobData:null,savetxt:function(blobData){filehistory.blobData=null;filehistory.blobData=blobData;window.requestFileSystem(window.PERSISTENT,1024*(1024*3),filehistory.initFs,filehistory.errorHandler)},initFs:function(fs){fs.root.getFile(iD.User.getInfo().username+"_"+iD.Task.d.task_id+".txt",{create:false},function(fileEntry){if(fileEntry.isFile){fileEntry.remove(function(){filehistory.createFile(fs)},filehistory.errorHandlers)}},filehistory.errorHandlers)},createFile:function(fs){fs.root.getFile(iD.User.getInfo().username+"_"+iD.Task.d.task_id+".txt",{create:true},function(fileEntry){fileEntry.createWriter(function(fileWriter){if(!filehistory.blobData){return}else{var blob=new Blob([filehistory.blobData],{type:"text/plain"});fileWriter.write(blob);filehistory.showFile(fileEntry)}})},filehistory.errorHandlers)},showFile:function(fileEntry){if(!fileEntry){return fileHistory}else{if(context.history().hasChanges()&&!context.variable.isOpenSaveDialog){context.variable.isOpenSaveDialog=true;window.clearInterval(context.variable.autoSaveTime);Dialog.confirm("\u60A8\u6709\u5F88\u591A\u6570\u636E\u8FD8\u6CA1\u6709\u8FDB\u884C\u4FDD\u5B58\uFF0C\u662F\u5426\u4FDD\u5B58\uFF1F",function(){context.enter(iD.modes.Save(context,"auto saving"));context.variable.isOpenSaveDialog=false},function(){context.variable.isOpenSaveDialog=false;if(context.variable.autoSaveTime){window.clearInterval(context.variable.autoSaveTime);context.variable.autoSaveTime=window.setInterval(context.autoSave,900000)}})}}},filejson:function(n,callback){window.requestFileSystem(window.PERSISTENT,1024*(1024*3),onInitFs,filehistory.errorHandlers);function onInitFs(fs){fs.root.getFile(n,{},function(fileEntry){fileEntry.file(function(file){var reader=new FileReader;reader.onloadend=function(e){if(this.result&&""!=this.result){var fileResult=JSON.parse(this.result);callback(fileResult)}else{console.log("\u6CA1\u6709\u76F8\u5173\u6570\u636E...")}return this.result};reader.readAsText(file)},filehistory.errorHandlers)},filehistory.errorHandlers)}},errorHandlers:function(err){console.info("\u83B7\u53D6\u6587\u4EF6\u5931\u8D25");console.info(err)},errorHandler:function(err){window.webkitStorageInfo.requestQuota(PERSISTENT,1024*(1024*3),function(grantedBytes){window.requestFileSystem(PERSISTENT,1024*(1024*3),filehistory.createFile,filehistory.errorHandlers)},function(e){console.log("Error",e)})}};return filehistory};;iD.Node=iD.Entity.node=function iD_Node(){if(!(this instanceof iD_Node)){return new iD_Node().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}};iD.Node.prototype=Object.create(iD.Entity.prototype);_.extend(iD.Node.prototype,{type:"node",extent:function(){return new iD.geo.Extent(this.loc)},geometry:function(graph){return graph.transient(this,"geometry",function(){return graph.isPoi(this)?"point":"vertex"})},move:function(loc){return this.update({loc:loc})},isIntersection:function(resolver){return resolver.transient(this,"isIntersection",function(){return 1<resolver.parentWays(this).filter(function(parent){return(parent.tags.highway||parent.tags.waterway||parent.tags.railway||parent.tags.aeroway)&&"line"===parent.geometry(resolver)}).length})},isHighwayIntersection:function(resolver){return resolver.transient(this,"isHighwayIntersection",function(){return 1<resolver.parentWays(this).filter(function(parent){return parent.tags.highway&&"line"===parent.geometry(resolver)}).length})},asJXON:function(changeset_id,context,t){var layer=context.layers(this.layerId);if(layer&&layer.isArea&&layer.isLine&&layer.wkt&&(this.isArea&&this.isArea()||this.type==iD.data.GeomType.WAY)){if("deleted"===t||"created"===t)return[];var way=context.graph().parentWays(this)[0];return way.wktJSON(changeset_id,layer,context)}var r={node:{"@id":this.osmId(),"@lon":this.loc[0],"@lat":this.loc[1],"@z":this.loc[2]||-1,"@modelName":this.modelName,"@version":this.version||0,tag:_.map(this.tags,function(v,k){return{keyAttributes:{k:k,v:v||""}}})}};if(changeset_id)r.node["@changeset"]=changeset_id;if(this.new_id_inherit)r.node["@new_id_inherit"]=this.new_id_inherit;if(this.members)r.node["member"]=_.map(this.members,function(member){return{keyAttributes:{type:member.type,role:member.role,ref:iD.Entity.id.toOSM(member.id)}}});return r},asGeoJSON:function(){return{type:"Point",coordinates:this.loc}},memberById:function(id){for(var i=0;i<this.members.length;i++){if(this.members[i].id===id){return _.extend({},this.members[i],{index:i})}}},isRoadCross:function(){return this.modelName===iD.data.Constant.C_NODE||"roadcross"===this._type},isPlaceName:function(){return this.modelName===iD.data.DataType.PLACENAME||this._type===iD.data.DataType.PLACENAME||"placename"===this._type},isSearchPoint:function(){return this.modelName===iD.data.DataType.SEARCH_POINT||this._type===iD.data.DataType.SEARCH_POINT||"searchpoint"===this._type},isDetailSlope:function(){return this.modelName===iD.data.DataType.DETAILSLOPE||"detailslope"===this._type},isWalkZlevel:function(){return this.modelName===iD.data.DataType.WALKZLEVEL||"walkzlevel"===this._type},isQcTag:function(){return"QC_TAG"===this.modelName||"QC_TAG"===this._type},isRoadNode:function(){return this.modelName===iD.data.DataType.ROAD_NODE},isEndpoint:function(resolver){var id=this.id;return 0<resolver.parentWays(this).filter(function(parent){return!parent.isClosed()&&!!parent.affix(id)}).length},getParentWays:function(graph){var ways=[];graph.parentWays(this).forEach(function(way){if(!way.isOneRoadCrossWay()){ways.push(way)}});return ways},isWalkEnter:function(){return this.modelName===iD.data.DataType.WALKENTER},isWalkAreaPoint:function(){return this.modelName===iD.data.DataType.WALKAREA},setHighway:function(){this.modelName="Highway"},setRoadNode:function(){this.modelName=iD.data.DataType.ROAD_NODE},isRoadZLevel:function(){return"ZLevel"===this.modelName||"zlevel"===this._type},isSpeedcamera:function(){return"SpeedCamera"===this.modelName||"speedcamera"===this._type},updateMember:function(member,index){if(2==arguments.length){var members=this.members.slice();members.splice(index,1,_.extend({},members[index],member));return this.update({members:members})}else{return this.update({members:member})}}});iD.Marker=function iD_Marker(){if(!(this instanceof iD_Marker)){return new iD_Marker().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}this.graphType="marker"};iD.Marker.prototype=Object.create(iD.Node.prototype);_.extend(iD.Marker.prototype,{type:"marker",initialize:function(sources){for(var i=0;i<sources.length;++i){var source=sources[i];for(var prop in source){if(Object.prototype.hasOwnProperty.call(source,prop)){this[prop]=source[prop]}}}if(!this.id&&this.type){this.id=iD.Entity.id(this.type)}if(iD.debug){Object.freeze(this);Object.freeze(this.tags);if(this.loc)Object.freeze(this.loc);if(this.nodes)Object.freeze(this.nodes);if(this.members)Object.freeze(this.members)}this["font-style"]=iD.util.merge(this["font-style"]||this["style"]||[],iD.store.markerstyle.fontStyle);this["rect-style"]=iD.util.merge(this["rect-style"]||[],iD.store.markerstyle.rectStyle);this["arrow-style"]=iD.util.merge(this["arrow-style"]||[],iD.store.markerstyle.arrowStyle);if(!this.offset){this.offset=[0,0]}if(!this.width){this.width=25}if(!this.height){this.height=25}return this},setVertices:function(_){this.vertices=_},getVertices:function(_){return this.vertices||false},getOffset:function(){return this.offset},getSize:function(){return[this.width,this.height]},getLabelSize:function(){return this.label.length},getFontSize:function(){return parseInt(this["font-style"]["font-size"])},getSizeCenter:function(){return[this.width/2,this.height/2]},getAttribute:function(){var x=-this.getSizeCenter()[0]+this.offset[0],y=-this.getSizeCenter()[1]+this.offset[1];if(0==parseInt(this.shape)){x+=this.getSizeCenter()[0];y+=this.getSizeCenter()[0]}return{translate:"translate("+x+", "+y+")"}},getRectAttribute:function(){var x=this.getSizeCenter()[0]+this.offset[0],y=this.offset[1]-this.getFontSize()/2;return{width:this.getLabelSize()*this.getFontSize(),height:this.getFontSize(),style:this["rect-style"],translate:"translate("+x+", "+y+")"}},getTextAttribute:function(){var x=this.getSizeCenter()[0]+this.offset[0],y=this.getFontSize()/3+this.offset[1];return{style:this["font-style"],translate:"translate("+x+", "+y+")"}},getArrowAttribute:function(){var a=iD.util.angleTranslate(parseFloat(this["arrow-angle"]),5);var x=a.x+this.offset[0];var y=a.y+this.offset[1];return{style:this["arrow-style"],translate:"translate("+x+", "+y+") scale(0.45) rotate("+a.angle+")"}}});iD.Icon=function iD_Icon(){if(!(this instanceof iD_Icon)){return new iD_Icon().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}this.graphType="marker"};iD.Icon.prototype=Object.create(iD.Marker.prototype);_.extend(iD.Icon.prototype,{type:"icon",graph:function(){}});;;iD.Relation=iD.Entity.relation=function iD_Relation(){if(!(this instanceof iD_Relation)){return new iD_Relation().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}};iD.Relation.prototype=Object.create(iD.Entity.prototype);iD.Relation.creationOrder=function(a,b){var aId=parseInt(iD.Entity.id.toOSM(a.id),10);var bId=parseInt(iD.Entity.id.toOSM(b.id),10);if(0>aId||0>bId)return aId-bId;return bId-aId};_.extend(iD.Relation.prototype,{type:"relation",members:[],extent:function(resolver,memo){return resolver.transient(this,"extent",function(){if(memo&&memo[this.id])return iD.geo.Extent();memo=memo||{};memo[this.id]=true;return this.members.reduce(function(extent,member){member=resolver.hasEntity(member.id);if(member){return extent.extend(member.extent(resolver,memo))}else{return extent}},iD.geo.Extent())})},geometry:function(graph){return graph.transient(this,"geometry",function(){return this.isMultipolygon()?"area":"relation"})},isDegenerate:function(){return 0===this.members.length},indexedMembers:function(){var result=new Array(this.members.length);for(var i=0;i<this.members.length;i++){result[i]=_.extend({},this.members[i],{index:i})}return result},memberByRole:function(role){for(var i=0;i<this.members.length;i++){if(this.members[i].role===role){return _.extend({},this.members[i],{index:i})}}},memberBySequence:function(sequence){if(sequence){for(var i=0;i<this.members.length;i++){if(this.members[i].sequence==sequence){return _.extend({},this.members[i],{index:i})}}}else{var members=this.members.sort(function(a,b){return parseInt(a.sequence)-parseInt(b.sequence)});var rmebers=[];for(var i=0,il=members.length;i<il;i++){rmebers.push(_.extend({},members[i],{index:i}))}return rmebers}},memberById:function(id){for(var i=0;i<this.members.length;i++){if(this.members[i].id===id){return _.extend({},this.members[i],{index:i})}}},memberByIdAndRole:function(id,role){for(var i=0;i<this.members.length;i++){if(this.members[i].id===id&&this.members[i].role===role){return _.extend({},this.members[i],{index:i})}}},addMember:function(member,index){var members=this.members.slice();members.splice(index===undefined?members.length:index,0,member);return this.update({members:members})},updateMember:function(member,index){if(2==arguments.length){var members=this.members.slice();members.splice(index,1,_.extend({},members[index],member));return this.update({members:members})}else{return this.update({members:member})}},removeMember:function(index){var members=this.members.slice();members.splice(index,1);return this.update({members:members})},removeMembersWithID:function(id){var members=_.reject(this.members,function(m){return m.id===id});return this.update({members:members})},replaceMember:function(needle,replacement){if(!this.memberById(needle.id))return this;var members=[];for(var i=0;i<this.members.length;i++){var member=this.members[i];if(member.id!==needle.id){members.push(member)}else if(!this.memberByIdAndRole(replacement.id,member.role)){members.push({id:replacement.id,modelName:replacement.modelName,type:replacement.type,role:member.role})}}return this.update({members:members})},getTurnGuidanceByMaat:function(graph,type){var fWayId=this.memberByRole(iD.data.RoleType.FROAD_ID).id;var tWayId=this.memberByRole(iD.data.RoleType.TROAD_ID).id;var relations=[];var relations1=graph.parentRelations(graph.entity(fWayId),iD.data.DataType.TURN_GUIDANCE);var relations2=graph.parentRelations(graph.entity(tWayId),iD.data.DataType.TURN_GUIDANCE);function isInObjectArr(id,arrs){for(var i=0;i<arrs.length;i++){if(arrs[i].id==id){return true}}return false}for(var i=0;i<relations1.length;i++){if(isInObjectArr(relations1[i].id,relations2)){relations.push(relations1[i])}}var results=[];if(this.modelName==iD.data.DataType.NODECONN){for(var i=0;i<relations.length;i++){var firstSeqId=relations[i].members[0].id;var secondSeqId=relations[i].members[1].id;if(firstSeqId==fWayId&&secondSeqId==tWayId){results.push(relations[i])}}}else if(this.modelName==iD.data.DataType.C_NODECONN){for(var i=0;i<relations.length;i++){var firstSeqId=relations[i].members[0].id;if(firstSeqId==fWayId){results.push(relations[i])}}}var results=results.sort(function(a,b){var aId=iD.Entity.id.toOSM(a.id),bId=iD.Entity.id.toOSM(b.id);return bId-aId});return results},asJXON:function(changeset_id){var _temp={0:"relation",1:"node",2:"way",3:"way"};var r={relation:{"@id":this.osmId(),"@version":this.version||0,"@modelName":this.modelName,member:_.map(this.members,function(member){return{keyAttributes:{modelName:member.modelName,type:member.type,role:member.role,ref:iD.Entity.id.toOSM(member.id)}}}),tag:_.map(this.tags,function(v,k){return{keyAttributes:{k:k,v:v||""}}})}};iD.util.tagExtend.modelNameErro(r);if(changeset_id)r.relation["@changeset"]=changeset_id;return r},asGeoJSON:function(resolver){return resolver.transient(this,"GeoJSON",function(){if(this.isMultipolygon()){return{type:"MultiPolygon",coordinates:this.multipolygon(resolver)}}else{return{type:"FeatureCollection",properties:this.tags,features:this.members.map(function(member){return _.extend({role:member.role},resolver.entity(member.id).asGeoJSON(resolver))})}}})},area:function(resolver){return resolver.transient(this,"area",function(){return d3.geo.area(this.asGeoJSON(resolver))})},isMultipolygon:function(){return"multipolygon"===this.tags.type},isComplete:function(resolver){for(var i=0;i<this.members.length;i++){if(!resolver.hasEntity(this.members[i].id)){return false}}return true},isRestriction:function(){return!!(this.tags.type&&this.tags.type.match(/^restriction:?/))},multipolygon:function(resolver){var outers=this.members.filter(function(m){return"outer"===(m.role||"outer")}),inners=this.members.filter(function(m){return"inner"===m.role});outers=iD.geo.joinWays(outers,resolver);inners=iD.geo.joinWays(inners,resolver);outers=outers.map(function(outer){return _.pluck(outer.nodes,"loc")});inners=inners.map(function(inner){return _.pluck(inner.nodes,"loc")});var result=outers.map(function(o){return[d3.geo.area({type:"Polygon",coordinates:[o]})>2*Math.PI?o.reverse():o]});function findOuter(inner){var o,outer;for(o=0;o<outers.length;o++){outer=outers[o];if(iD.geo.polygonContainsPolygon(outer,inner))return o}for(o=0;o<outers.length;o++){outer=outers[o];if(iD.geo.polygonIntersectsPolygon(outer,inner))return o}}for(var i=0;i<inners.length;i++){var inner=inners[i];if(d3.geo.area({type:"Polygon",coordinates:[inner]})<2*Math.PI){inner=inner.reverse()}var o=findOuter(inners[i]);if(o!==undefined)result[o].push(inners[i]);else result.push([inners[i]])}return result}});iD.Transportation=iD.Entity.Transportation=function iD_Transportation(){if(!(this instanceof iD_Transportation)){return new iD_Transportation().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}};iD.Transportation.prototype=Object.create(iD.Entity.prototype);iD.Transportation.operations=function(){};iD.Transportation.operations.set=function(id){iD.Transportation.operations.id=id||0};iD.Transportation.operations.reset=function(value){if(!value)iD.Transportation.operations.set()};iD.Transportation.operations.is=function(id){return iD.Transportation.operations.id==id?true:false};iD.Transportation.operations.id=0;_.extend(iD.Transportation.prototype,{isOneDay:function(){var status=this.tags.status;if(1==status||2==status)return false;return true},newRelation:function(option){var relation={};relation.id=null;relation.version=1;relation.members=this.members(option);relation.tags=this.asTags(option);return relation},oneDayRelations:function(rules){var transportation=this;var ____=[];rules.forEach(function(rule){if(1==rule.tags.rule_type)____.push(rule)});return ____},members:function(option){return[{id:option.maat.id,role:"",type:option.roadcross?"CrossMaat":"NodeMaat"}]},asTags:function(option){return{rule_type:1,rule_time:"[(h1:00){h24:00}]",vehicle:"80000000"}},transpToRelations:function(towayId,relations){var trs=[],state=1,red=false,yellow=false,green=false;relations.forEach(function(relation){if(relation.memberByRole(iD.data.RoleType.TROAD_ID).id==towayId)trs.push(relation)});_(trs).each(function(relation){var tags=relation.tags,ruletype=tags.rule_type,ruletime=tags.rule_time,vehicle=tags.vehicle;if(1==ruletype)red=true;else if(""==ruletype&&""==ruletime&&""==vehicle||ruletype==undefined&&ruletime==undefined&&vehicle==undefined)green=true;else yellow=true});if(red)return 3;if(yellow)return 2;if(green)return 1;return state},newTransportations:function(first,last,direction){var transps={},type="transportation",firstID=iD.Entity.id(type),lastID=iD.Entity.id(type);transps[firstID]=iD.Transportation({type:type,id:firstID,loc:first.loc,tags:{node:"first"},relation:direction});transps[lastID]=iD.Transportation({type:type,id:lastID,loc:last.loc,tags:{node:"last"},relation:direction});return transps}});;;iD.Way=iD.Entity.way=function iD_Way(){if(!(this instanceof iD_Way)){return new iD_Way().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}};iD.Way.prototype=Object.create(iD.Entity.prototype);_.extend(iD.Way.prototype,{type:"way",nodes:[],extent:function(resolver){return resolver.transient(this,"extent",function(){return this.nodes.reduce(function(extent,id){var node=resolver.hasEntity(id);if(node){return extent.extend(node.extent())}else{return extent}},iD.geo.Extent())})},first:function(){return this.nodes[0]},preLastNode:function(){return this.nodes[this.nodes.length-2]},last:function(){return this.nodes[this.nodes.length-1]},contains:function(node){return 0<=this.nodes.indexOf(node)},affix:function(node){if(this.nodes[0]===node)return"prefix";if(this.nodes[this.nodes.length-1]===node)return"suffix"},layer:function(){return 0;if(this.tags.layer!==undefined){return Math.max(-10,Math.min(+this.tags.layer,10))}if("overground"===this.tags.location)return 1;if("underground"===this.tags.location)return-1;if("underwater"===this.tags.location)return-10;if("line"===this.tags.power)return 10;if("minor_line"===this.tags.power)return 10;if(this.tags.aerialway)return 10;if(this.tags.bridge)return 1;if(this.tags.cutting)return-1;if(this.tags.tunnel)return-1;if(this.tags.waterway)return-1;if("pipeline"===this.tags.man_made)return-10;if(this.tags.boundary)return-10;if(this.zlevel)return this.zlevel;return 0},isOneWay:function(){return"yes"===this.tags.ONEWAY||"1"===this.tags.ONEWAY||"-1"===this.tags.ONEWAY||"river"===this.tags.WATERWAY||"stream"===this.tags.WATERWAY||"roundabout"===this.tags.JUNCTION||"2"===this.tags.DIRECTION||"3"===this.tags.DIRECTION},isOneStopWay:function(){return"4"===this.tags.DIRECTION},isOneTrafficWay:function(){return"trafficarrow"===this._type},isOneRoadCrossWay:function(){return this._type&&"roadcrossline"===this._type},isClosed:function(){return 0<this.nodes.length&&this.first()===this.last()},roadClass:function(){return this.tags.ROAD_CLASS},setRoadClass:function(v){this.tags.ROAD_CLASS=v},isConvex:function(resolver){if(!this.isClosed()||this.isDegenerate())return null;var nodes=_.uniq(resolver.childNodes(this)),coords=_.pluck(nodes,"loc"),curr=0,prev=0;for(var i=0;i<coords.length;i++){var o=coords[(i+1)%coords.length],a=coords[i],b=coords[(i+2)%coords.length],res=iD.geo.cross(o,a,b);curr=0<res?1:0>res?-1:0;if(0===curr){continue}else if(prev&&curr!==prev){return false}prev=curr}return true},isArea:function(){if(!this.modelName||!iD.ModelEntitys[this.modelName]){return false}if(3===iD.ModelEntitys[this.modelName].type())return true;if(!this.isClosed()||"no"===this.tags.area)return false;if(this.modelName==iD.data.DataType.WALKAREA){return true}for(var key in this.tags)if(key in iD.areaKeys&&!(this.tags[key]in iD.areaKeys[key]))return true;return false},isDegenerate:function(){return _.uniq(this.nodes).length<(this.isArea()?3:2)},areAdjacent:function(n1,n2){for(var i=0;i<this.nodes.length;i++){if(this.nodes[i]===n1){if(this.nodes[i-1]===n2)return true;if(this.nodes[i+1]===n2)return true}}return false},geometry:function(graph){return graph.transient(this,"geometry",function(){return this.isArea()?"area":"line"})},getWalkZlevel:function(graph){var rels=graph.parentRelations(this);var walkZlevel=[];rels.forEach(function(relation){if(relation.modelName==iD.data.DataType.WALKZLEVEL){walkZlevel.push(relation)}});return walkZlevel},isNaviType:function(){var tool={2:true,3:true,6:true,7:true};if(iD.data.DataType.HIGHWAY==this.modelName){if(!tool[this.modelName]){return true}else{return false}}return false},addNode:function(id,index){var nodes=this.nodes.slice();nodes.splice(index===undefined?nodes.length:index,0,id);return this.update({nodes:nodes})},updateNode:function(id,index){var nodes=this.nodes.slice();nodes.splice(index,1,id);return this.update({nodes:nodes})},replaceNode:function(needle,replacement){if(0>this.nodes.indexOf(needle))return this;var nodes=this.nodes.slice();for(var i=0;i<nodes.length;i++){if(nodes[i]===needle){nodes[i]=replacement}}return this.update({nodes:nodes})},removeNode:function(id){var nodes=[];for(var i=0;i<this.nodes.length;i++){var node=this.nodes[i];if(node!==id&&nodes[nodes.length-1]!==node){nodes.push(node)}}if(1<this.nodes.length&&this.first()===id&&this.last()===id&&nodes[nodes.length-1]!==nodes[0]){nodes.push(nodes[0])}return this.update({nodes:nodes})},asJXON:function(changeset_id,context,t){var wkt=this.asWKTJXON(changeset_id,context,t);if(wkt)return wkt;var r={way:{"@id":this.osmId(),"@modelName":this.modelName,"@version":this.version||0,nd:_.map(this.nodes,function(id){return{keyAttributes:{ref:iD.Entity.id.toOSM(id)}}}),tag:_.map(this.tags,function(v,k){return{keyAttributes:{k:k,v:v||""}}})}};if(changeset_id)r.way["@changeset"]=changeset_id;if(this.new_id_inherit)r.way["@new_id_inherit"]=this.new_id_inherit;return r},asWKTJXON:function(changeset_id,context,t){var layer=context.layers(this.layerId);if(layer&&layer.isArea&&layer.isLine&&layer.wkt&&(this.isArea&&this.isArea()||this.type==iD.data.GeomType.WAY)){return this.wktJSON(changeset_id,layer,context,t)}return false},wktJSON:function(_id,l,__,d){if(!this.modelName){if(l.isLine())this.modelName="";if(l.isArea())this.tags.area=""}var wktString=l.isArea()?"POLYGON(("+this.convertWKT(__)+"))":"LineString("+this.convertWKT(__)+")";wktString="deleted"==d?"":wktString;var r={way:{"@id":this.osmId(),"@version":this.version||0,wkt:wktString,tag:_.map(this.tags,function(v,k){return{keyAttributes:{k:k,v:v}}})}};if(_id)r.way["@changeset"]=_id;if(this.new_id_inherit)r.way["@new_id_inherit"]=this.new_id_inherit;return r},convertWKT:function(context){var length=this.nodes.length;function get(i){return i==length-1?"":","};var wktString="";_.map(this.nodes,function(id,i){try{var l=context.entity(id).loc;wktString+=l[0]+" "+l[1]+get(i)}catch(e){}});return wktString},asGeoJSON:function(resolver){return resolver.transient(this,"GeoJSON",function(){var coordinates=_.pluck(resolver.childNodes(this),"loc");if(this.isArea()&&this.isClosed()){return{type:"Polygon",coordinates:[coordinates]}}else{return{type:"LineString",coordinates:coordinates}}})},area:function(resolver){return resolver.transient(this,"area",function(){var nodes=resolver.childNodes(this);if(!this.isClosed()&&nodes.length){nodes=nodes.concat([nodes[0]])}var json={type:"Polygon",coordinates:[_.pluck(nodes,"loc")]};var area=d3.geo.area(json);if(d3.geo.area(json)>2*Math.PI){json.coordinates[0]=json.coordinates[0].reverse();area=d3.geo.area(json)}return isNaN(area)?0:area})},setRoadClass:function(v){this.tags.ROAD_CLASS=v||"45000"},isRoadClass:function(){return"41000"===this.tags.ROAD_CLASS||"42000"===this.tags.ROAD_CLASS||"43000"===this.tags.ROAD_CLASS||"44000"===this.tags.ROAD_CLASS||"45000"===this.tags.ROAD_CLASS||"47000"===this.tags.ROAD_CLASS||"51000"===this.tags.ROAD_CLASS||"52000"===this.tags.ROAD_CLASS||"53000"===this.tags.ROAD_CLASS||"54000"===this.tags.ROAD_CLASS||"49"===this.tags.ROAD_CLASS}});iD.Polygon=function iD_Polygon(){if(!(this instanceof iD_Polygon)){return new iD_Polygon().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}this.graphType="polygon"};iD.Polygon.prototype=Object.create(iD.Way.prototype);_.extend(iD.Polygon.prototype,{type:"polygon",convertArea:function(){var first=this.first();var last=this.last();if(first!=last){if(iD.geo.edgeEqual(first.loc,last.loc)){this.nodes.splice(this.nodes.length-1,1)}this.nodes.push(first)}},boundPoints:function(end){var xs=[];var ys=[];xs.push(this.rectangle.start[0]);ys.push(this.rectangle.start[1]);xs.push(this.rectangle.end[0]);ys.push(this.rectangle.end[1]);var minx=d3.min(xs);var miny=d3.min(ys);var maxx=d3.max(xs);var maxy=d3.max(ys);var top=[minx,miny];var left=[minx,maxy];var bottom=[maxx,maxy];var right=[maxx,miny];return[top,left,bottom,right]},bounds:function(){var xs=[];var ys=[];for(var i in this.nodes){var node=this.nodes[i];xs.push(node.loc[0]);ys.push(node.loc[1])}var minx=d3.min(xs);var miny=d3.min(ys);var maxx=d3.max(xs);var maxy=d3.max(ys);return[[minx,miny],[maxx,maxy]]},getArea:function(){var metrePerDegree=6378137*Math.PI/180;var sum=0,arr=this.nodes,len=arr.length;if(3>len){return 0}for(i=0;i<len-1;i++){var m=arr[i].loc;var n=arr[i+1].loc;var x1=m[0]*metrePerDegree*Math.cos(m[1]*Math.PI/180);var y1=m[1]*metrePerDegree;var x2=n[0]*metrePerDegree*Math.cos(n[1]*Math.PI/180);var y2=n[1]*metrePerDegree;sum+=x1*y2-x2*y1}var o=arr[i].loc;var p=arr[0].loc;var xn=o[0]*metrePerDegree*Math.cos(o[1]*Math.PI/180);var yn=o[1]*metrePerDegree;var xf=p[0]*metrePerDegree*Math.cos(p[1]*Math.PI/180);var yf=p[1]*metrePerDegree;sum+=xn*yf-xf*yn;var area=0.5*Math.abs(sum);return Number(area.toFixed(2))},getTextAttribute:function(){return{style:this["font-style"]}},asGeoJSON:function(resolver){var coordinates=_.pluck(this.nodes,"loc");return{type:"Polygon",coordinates:[coordinates]}},area:function(resolver){var json={type:"Polygon",coordinates:[_.pluck(this.nodes,"loc")]};var area=d3.geo.area(json);if(d3.geo.area(json)>2*Math.PI){json.coordinates[0]=json.coordinates[0].reverse();area=d3.geo.area(json)}return isNaN(area)?0:area},addNode:function(node,index){var nodes=this.nodes;nodes.push(node);return this},moveNode:function(node,index){var nodes=this.nodes;index=index||nodes.length-2;nodes.splice(index,1,node);return this}});iD.Polyline=function iD_Polyline(){if(!(this instanceof iD_Polyline)){return new iD_Polyline().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}this.graphType="polyline"};iD.Polyline.prototype=Object.create(iD.Way.prototype);_.extend(iD.Polyline.prototype,{type:"polyline",asGeoJSON:function(resolver){var coordinates=_.pluck(this.nodes,"loc");return{type:"LineString",coordinates:coordinates}},addNode:function(node,index){var nodes=this.nodes;nodes.push(node);return this},moveNode:function(node,index){var nodes=this.nodes;index=index||nodes.length-2;nodes.splice(index,1,node);return this},moveLoc:function(loc){this.last().loc=loc;return this},getNodes:function(){return this.nodes},setArrow:function(show,_editor){this.arrow=show;if(_editor)_editor.getMap().drawOverlayers()}});iD.Circle=function iD_Circle(){if(!(this instanceof iD_Circle)){return new iD_Circle().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}this.graphType="circle"};iD.Circle.prototype=Object.create(iD.Node.prototype);_.extend(iD.Circle.prototype,{type:"circle",getRadius:function(_){if(_)this.__=_;return this.__||0}});iD.TransPolygon=function iD_TransPolygon(){if(!(this instanceof iD_TransPolygon)){return new iD_TransPolygon().initialize(arguments)}else if(arguments.length){this.initialize(arguments)}this.graphType="polygon"};iD.TransPolygon.prototype=Object.create(iD.Way.prototype);_.extend(iD.TransPolygon.prototype,{type:"transpolygon",area:function(resolver){var json={type:"Polygon",coordinates:[_.pluck(this.nodes,"loc")]};var area=d3.geo.area(json);if(d3.geo.area(json)>2*Math.PI){json.coordinates[0]=json.coordinates[0].reverse();area=d3.geo.area(json)}return isNaN(area)?0:area},asGeoJSON:function(resolver){var coords;if(!this.nodes||!this.holes||!this.nodes.length||!this.holes.length){coords=[]}else{var holdCoords=this.holes?this.holes.map(function(h){return _.pluck(h,"loc")}):[];coords=[_.pluck(this.nodes,"loc")].concat(holdCoords)}return{type:"Polygon",coordinates:coords}}});;;iD.Tree=function(head){var rtree=rbush(),rectangles={};function extentRectangle(extent){return[extent[0][0],extent[0][1],extent[1][0],extent[1][1]]}function entityRectangle(entity){var rect=extentRectangle(entity.extent(head));rect.id=entity.id;rectangles[entity.id]=rect;return rect}function updateParents(entity,insertions,memo){if(memo&&memo[entity.id])return;memo=memo||{};memo[entity.id]=true;head.parentWays(entity).forEach(function(parent){if(rectangles[parent.id]){rtree.remove(rectangles[parent.id]);insertions.push(parent)}});head.parentRelations(entity).forEach(function(parent){if(rectangles[parent.id]){rtree.remove(rectangles[parent.id]);insertions.push(parent)}updateParents(parent,insertions,memo)})}var tree={};tree.rebase=function(entities){var insertions=[];for(var i=0;i<entities.length;i++){var entity=entities[i];if(head.entities.hasOwnProperty(entity.id)||rectangles[entity.id])continue;insertions.push(entity);updateParents(entity,insertions)}insertions=_.unique(insertions).map(entityRectangle);rtree.load(insertions);return tree};tree.intersects=function(extent,graph){if(graph!==head){var diff=iD.Difference(head,graph),insertions=[];head=graph;diff.deleted().forEach(function(entity){rtree.remove(rectangles[entity.id]);delete rectangles[entity.id]});diff.modified().forEach(function(entity){rtree.remove(rectangles[entity.id]);insertions.push(entity);updateParents(entity,insertions)});diff.created().forEach(function(entity){insertions.push(entity)});insertions=_.unique(insertions).map(entityRectangle);rtree.load(insertions)}return rtree.search(extentRectangle(extent)).map(function(rect){return head.entity(rect.id)})};return tree};;;iD.areaKeys={aeroway:{gate:true,taxiway:true},amenity:{atm:true,bbq:true,bench:true,clock:true,drinking_water:true,parking_entrance:true,post_box:true,telephone:true,vending_machine:true,waste_basket:true},area:{},barrier:{block:true,bollard:true,cattle_grid:true,cycle_barrier:true,entrance:true,fence:true,gate:true,kissing_gate:true,lift_gate:true,stile:true,toll_booth:true},building:{entrance:true},craft:{},emergency:{fire_hydrant:true,phone:true},golf:{hole:true},historic:{boundary_stone:true},landuse:{},leisure:{picnic_table:true,slipway:true},man_made:{cutline:true,embankment:true,flagpole:true,pipeline:true,survey_point:true},military:{},natural:{coastline:true,peak:true,spring:true,tree:true},office:{},"piste:type":{},place:{},power:{line:true,minor_line:true,pole:true,tower:true},public_transport:{stop_position:true},shop:{},tourism:{viewpoint:true},waterway:{canal:true,ditch:true,drain:true,river:true,stream:true,weir:true}};;;iD.oneWayTags={aerialway:{chair_lift:true,mixed_lift:true,"t-bar":true,"j-bar":true,platter:true,rope_tow:true,magic_carpet:true,yes:true},highway:{motorway:true,motorway_link:true},junction:{roundabout:true},man_made:{"piste:halfpipe":true},"piste:type":{downhill:true,sled:true,yes:true},waterway:{river:true,stream:true}};;;iD.ModelEntity=function(){this._fieldArray=[];this._geoType=0;this._layerId="";this._members=[];this._type=0;this._modelName=""};iD.ModelEntity.prototype={setGeoType:function(geoType){this._geoType=geoType},getGeoType:function(){return this._geoType},layerId:function(_){if(!arguments.length)return this._layerId;this._layerId=_;return this},modelName:function(_){if(!arguments.length)return this._modelName;this._modelName=_;return this},type:function(_){if(!arguments.length)return this._type;this._type=_;return this},members:function(_){if(!arguments.length)return this._members;this._members=_;return this},addField:function(fieldObj){var flag=false;_(this._fieldArray).each(function(item){if(item.id==fieldObj.id){flag=true;return false}});if(!flag){this._fieldArray.push(fieldObj)}},getFields:function(geoType){var _result=_.filter(this._fieldArray,function(obj){return true});if(geoType){_result=_.filter(_result,function(obj){return parseInt(obj.geoType,10)===parseInt(geoType,10)})}return _result;return _result.reverse()},getValues:function(){var _values=[];_(this.getFields()).each(function(field){_(field).each(function(value,key){_values.push(value)})});return _values},getChineseName:function(englishName,geoType){var name=englishName,current;_(this.getFields(geoType)).each(function(field){_(field).each(function(value,key){if(key===englishName||value===englishName){name=field.title||field.fieldTitle||englishName;current=field;return false}});if(current){return false}});return name}};;iD.InfoWindow=function iD_InfoWindow(map,opt){if(!(this instanceof iD_InfoWindow)){return new iD_InfoWindow().initialize(map,opt)}else if(arguments.length){this.initialize(map,opt)}this.graphType="infoWindow"};_.extend(iD.InfoWindow.prototype,{type:"infoWindow",initialize:function(map,opt){this.map=map;this.opt=opt},open:function(position){if(!this.map)return;var map=this.map,opt=this.opt,context=map.getContext();var tt=setInterval(function(){if(context.infowindow_isBand){clearInterval(tt);!opt.size?opt.size=[300,100]:null,!opt.content?opt.content="":null;context.event.openinfowindow(opt,position)}},50)},close:function(){if(!this.map)return;var map=this.map,context=map.getContext();var tt=setInterval(function(){if(context.infowindow_isBand){clearInterval(tt);context.event.closeinfowindow()}},50)},setContent:function(content){if(!this.map)return;this.opt.content=content?content:"";this.map.getContext().event.changeinfowindow(this.opt)},getContent:function(){return this.opt.content},setSize:function(size){if(!this.map)return;this.opt.size=size?size:[300,100];this.map.getContext().event.changeinfowindow(this.opt)},getSize:function(){return this.opt.size},setPosition:function(){},getPosition:function(){}});;;iD.presets=function(){var all=iD.presets.Collection([]),defaults={area:all,line:all,point:all,vertex:all,relation:all},fields={},universal=[],recent=iD.presets.Collection([]);var index={point:{},vertex:{},line:{},area:{},relation:{}};all.match=function(entity,resolver){var geometry=entity.geometry(resolver),geometryMatches=index[geometry],best=-1,match;for(var k in entity.tags){var keyMatches=geometryMatches[k];if(!keyMatches)continue;for(var i=0;i<keyMatches.length;i++){var score=keyMatches[i].matchScore(entity);if(score>best){best=score;match=keyMatches[i]}}}return match||all.item(geometry)};all.load=function(d){if(d.fields){_.forEach(d.fields,function(d,id){fields[id]=iD.presets.Field(id,d);if(d.universal)universal.push(fields[id])})}if(d.presets){_.forEach(d.presets,function(d,id){all.collection.push(iD.presets.Preset(id,d,fields))})}if(d.categories){_.forEach(d.categories,function(d,id){all.collection.push(iD.presets.Category(id,d,all))})}if(d.defaults){var getItem=_.bind(all.item,all);defaults={area:iD.presets.Collection(d.defaults.area.map(getItem)),line:iD.presets.Collection(d.defaults.line.map(getItem)),point:iD.presets.Collection(d.defaults.point.map(getItem)),vertex:iD.presets.Collection(d.defaults.vertex.map(getItem)),relation:iD.presets.Collection(d.defaults.relation.map(getItem))}}for(var i=0;i<all.collection.length;i++){var preset=all.collection[i],geometry=preset.geometry;for(var j=0;j<geometry.length;j++){var g=index[geometry[j]];for(var k in preset.tags){(g[k]=g[k]||[]).push(preset)}}}return all};all.field=function(id){return fields[id]};all.universal=function(){return universal};all.defaults=function(geometry,n){var rec=recent.matchGeometry(geometry).collection.slice(0,4),def=_.uniq(rec.concat(defaults[geometry].collection)).slice(0,n-1);return iD.presets.Collection(_.unique(rec.concat(def).concat(all.item(geometry))))};all.choose=function(preset){if(!preset.isFallback()){recent=iD.presets.Collection(_.unique([preset].concat(recent.collection)))}return all};return all};;;iD.presets.Preset=function(id,preset,fields){preset=_.clone(preset);preset.id=id;preset.fields=(preset.fields||[]).map(getFields);function getFields(f){return fields[f]}preset.matchGeometry=function(geometry){return 0<=preset.geometry.indexOf(geometry)};var matchScore=preset.matchScore||1;preset.matchScore=function(entity){var tags=preset.tags,score=0;for(var t in tags){if(entity.tags[t]===tags[t]){score+=matchScore}else if("*"===tags[t]&&t in entity.tags){score+=matchScore/2}else{return-1}}return score};preset.t=function(scope,options){return t("presets.presets."+id+"."+scope,options)};var name=preset.name;preset.name=function(){if(preset.suggestion){id=id.split("/");id=id[0]+"/"+id[1];return name+" - "+t("presets.presets."+id+".name")}return preset.t("name",{default:name})};preset.terms=function(){return preset.t("terms",{default:""}).split(",")};preset.isFallback=function(){return 0===Object.keys(preset.tags).length};preset.reference=function(geometry){var key=Object.keys(preset.tags)[0],value=preset.tags[key];if("relation"===geometry&&"type"===key){return{rtype:value}}else if("*"===value){return{key:key}}else{return{key:key,value:value}}};var removeTags=preset.removeTags||preset.tags;preset.removeTags=function(tags,geometry){tags=_.omit(tags,_.keys(removeTags));for(var f in preset.fields){var field=preset.fields[f];if(field.matchGeometry(geometry)&&field["default"]===tags[field.key]){delete tags[field.key]}}return tags};var applyTags=preset.addTags||preset.tags;preset.applyTags=function(tags,geometry){var k;tags=_.clone(tags);for(k in applyTags){if("*"===applyTags[k]){tags[k]="yes"}else{tags[k]=applyTags[k]}}for(k in applyTags){if("area"===geometry&&!(k in iD.areaKeys))tags.area="yes";break}for(var f in preset.fields){var field=preset.fields[f];if(field.matchGeometry(geometry)&&field.key&&!tags[field.key]&&field["default"]){tags[field.key]=field["default"]}}return tags};return preset};;;iD.presets.Category=function(id,category,all){category=_.clone(category);category.id=id;category.members=iD.presets.Collection(category.members.map(function(id){return all.item(id)}));category.matchGeometry=function(geometry){return 0<=category.geometry.indexOf(geometry)};category.matchScore=function(){return-1};category.name=function(){return t("presets.categories."+id+".name",{default:id})};category.terms=function(){return[]};return category};;;iD.presets.Collection=function(collection){var maxSearchResults=50,maxSuggestionResults=10;var presets={collection:collection,item:function(id){return _.find(collection,function(d){return d.id===id})},matchGeometry:function(geometry){return iD.presets.Collection(collection.filter(function(d){return d.matchGeometry(geometry)}))},search:function(value,geometry){if(!value)return this;value=value.toLowerCase();var searchable=_.filter(collection,function(a){return false!==a.searchable&&true!==a.suggestion}),suggestions=_.filter(collection,function(a){return true===a.suggestion});var leading_name=_.filter(searchable,function(a){return leading(a.name().toLowerCase())}).sort(function(a,b){var i=a.name().toLowerCase().indexOf(value)-b.name().toLowerCase().indexOf(value);if(0===i)return a.name().length-b.name().length;else return i});var leading_terms=_.filter(searchable,function(a){return _.any(a.terms()||[],leading)});function leading(a){var index=a.indexOf(value);return 0===index||" "===a[index-1]}var levenstein_name=searchable.map(function(a){return{preset:a,dist:iD.util.editDistance(value,a.name().toLowerCase())}}).filter(function(a){return 3>a.dist+Math.min(value.length-a.preset.name().length,0)}).sort(function(a,b){return a.dist-b.dist}).map(function(a){return a.preset});var leventstein_terms=_.filter(searchable,function(a){return _.any(a.terms()||[],function(b){return 3>iD.util.editDistance(value,b)+Math.min(value.length-b.length,0)})});function suggestionName(name){var nameArray=name.split(" - ");if(1<nameArray.length){name=nameArray.slice(0,nameArray.length-1).join(" - ")}return name.toLowerCase()}var leading_suggestions=_.filter(suggestions,function(a){return leading(suggestionName(a.name()))}).sort(function(a,b){a=suggestionName(a.name());b=suggestionName(b.name());var i=a.indexOf(value)-b.indexOf(value);if(0===i)return a.length-b.length;else return i});var leven_suggestions=suggestions.map(function(a){return{preset:a,dist:iD.util.editDistance(value,suggestionName(a.name()))}}).filter(function(a){return 1>a.dist+Math.min(value.length-suggestionName(a.preset.name()).length,0)}).sort(function(a,b){return a.dist-b.dist}).map(function(a){return a.preset});var other=presets.item(geometry);var results=leading_name.concat(leading_terms,leading_suggestions.slice(0,maxSuggestionResults+5),levenstein_name,leventstein_terms,leven_suggestions.slice(0,maxSuggestionResults)).slice(0,maxSearchResults-1);return iD.presets.Collection(_.unique(results.concat(other)))}};return presets};;;iD.presets.Field=function(id,field){field=_.clone(field);field.id=id;field.matchGeometry=function(geometry){return!field.geometry||field.geometry===geometry};field.t=function(scope,options){return t("presets.fields."+id+"."+scope,options)};field.label=function(){return field.t("label",{default:id})};var placeholder=field.placeholder;field.placeholder=function(){return field.t("placeholder",{default:placeholder})};return field};;;iD.validate=function(changes,graph){var warnings=[];function tagSuggestsArea(change){if(_.isEmpty(change.tags))return false;var tags=change.tags;var presence=["landuse","amenities","tourism","shop"];for(var i=0;i<presence.length;i++){if(tags[presence[i]]!==undefined){return presence[i]+"="+tags[presence[i]]}}if(tags.building&&"yes"===tags.building)return"building=yes"}if(100<changes.deleted.length){warnings.push({message:t("validations.many_deletions",{n:changes.deleted.length})})}for(var i=0;i<changes.created.length;i++){var change=changes.created[i],geometry=change.geometry(graph);if(("point"===geometry||"line"===geometry||"area"===geometry)&&!change.isUsed(graph)){warnings.push({message:t("validations.untagged_"+geometry),tooltip:t("validations.untagged_"+geometry+"_tooltip"),entity:change})}var deprecatedTags=change.deprecatedTags();if(!_.isEmpty(deprecatedTags)){warnings.push({message:t("validations.deprecated_tags",{tags:iD.util.tagText({tags:deprecatedTags})}),entity:change})}if("line"===geometry&&tagSuggestsArea(change)){warnings.push({message:t("validations.tag_suggests_area",{tag:tagSuggestsArea(change)}),entity:change})}}return warnings};;;window.locale={_current:"en"};locale.current=function(_){if(!arguments.length)return locale._current;if(locale[_]!==undefined)locale._current=_;else if(locale[_.split("-")[0]])locale._current=_.split("-")[0];return locale};function t(s,o,loc){loc=loc||locale._current;var path=s.split(".").reverse(),rep=locale[loc];while(rep!==undefined&&path.length)rep=rep[path.pop()];if(rep!==undefined){if(o)for(var k in o)rep=rep.replace("{"+k+"}",o[k]);return rep}if("en"!==loc){return t(s,o,"en")}if(o&&"default"in o){return o["default"]}var missing="Missing "+loc+" translation: "+s;if("undefined"!==typeof console)console.error(missing);return missing};;iD.introGraph="{}";;;;;(function(){var context,map,isHotspot=true;var KDSEditor=function(id,opt){this.initialize(id,opt)};_.extend(KDSEditor.prototype,{initialize:function(id,opt){this.id=id;this.context=$$.init(this.id,opt);return this},addListener:function(name,callback){switch(name){case"lasso":context.lasso_callback=callback;break;case"click":context.click_callback=callback;break;case"hotspotclick":context.hotspot_click_callback=callback;break;case"hover":context.hover_callback=callback;break;case"movestart":callback&&map.on("movestart.editorapi",function(){var d3ev=d3.event||"";d3ev&&callback.call(d3ev,d3ev.x,d3ev.y)});break;case"move":callback&&map.on("move.editorapi",function(){var d3ev=d3.event&&d3.event.sourceEvent||"";d3ev&&callback.call(d3ev,d3ev.x,d3ev.y)});break;case"moveend":callback&&map.on("moveend.editorapi",function(){var d3ev=d3.event||"";d3ev&&callback.call(d3ev,d3ev.x,d3ev.y)});break;case"zoom":callback&&map.on("zoom.editorapi",function(e){callback.call(e)});break;case"drawn":callback&&map.on("drawn.editorapi",callback);break;case"loaded":break;case"savestart":context.event.on("savestart.event",callback);break;case"saveend":context.event.on("saveend.event",callback);break;case"dragbox":context.event.on("dragbox.event",callback);break;case"add":context.event.on("add.event",callback);break;case"polygonend":context.event.on("polygonend.event",callback);break;case"drawstart":context.event.on("drawstart.event",callback);break;case"drawing":context.event.on("drawing.event",callback);break;case"drawend":context.event.on("draw.event",callback);break;case"selected":context.event.on("selected.event",callback);break;case"mouseover":context.event.on("mouseover.event",callback);break;case"mousemove":context.event.on("mousemove.event",callback);break;default:context.event.on(name+".event",callback);}return this},setMouseTool:function(mode,filter){switch(mode){case"distance":context.enter(iD.modes.toolbar.Distance(context));break;case"measure-area":context.enter(iD.modes.toolbar.MeasureArea(context));break;case"polygon":context.enter(iD.modes.toolbar.Polygon(context,true));break;case"polygon-selected":context.enter(iD.modes.toolbar.Polygon(context,false,filter));break;case"marker":context.enter(iD.modes.toolbar.Marker(context));break;case"rectangle":context.enter(iD.modes.toolbar.Rectangle(context));break;case"circle":context.enter(iD.modes.toolbar.Circle(context));break;case"polyline":context.enter(iD.modes.toolbar.Polyline(context));break;case"rectangle-selected":context.enter(iD.modes.toolbar.Lasso(context,filter));break;case"zoom":context.enter(iD.modes.LassoZoom(context));break;case"zoomIn":context.enter(iD.modes.LassoZoom(context));break;case"zoomOut":context.enter(iD.modes.LassoZoom(context,true));break;case"pan":context.enter(iD.modes.Browse(context));break;default:context.enter(iD.modes.Browse(context));}return this},pixelToLonlat:function(pix){return context.projection.invert(pix)},lonlatToPixel:function(loc){return context.projection(loc)},lightEntity:function(ids){map.lightEntity(ids);return this},lightEntities:function(id,entities){map.lightEntities(id,entities);return this},removeEntities:function(id,entities){map.removeEntities(id,entities);return this},setCenter:function(loc){map.center(loc);return this},getCenter:function(){return map.center()},setZoom:function(v){map.zoom(v);return this},setZoom:function(v,force){map.zoom(v,force);return this},getZoom:function(){return map.zoom()},setMaxZoom:function(v){map.max_zoom(v);return this},setMinZoom:function(v){map.min_zoom(v);return this},getMaxZoom:function(){return map.max_zoom()},getMinZoom:function(){return map.min_zoom()},zoomIn:function(){map.zoomIn();return this},zoomOut:function(){map.zoomOut();return this},setCenterZoom:function(loc,v){map.centerZoom(loc,v);return this},setEditableLevel:function(v){map.editableLevel(v);return this},getEditableLevel:function(){return map.editableLevel()},getBounds:function(){return map.trimmedExtent()},addPointLayer:function(o){var f=true;if(o.length){var ff=[];for(var i=0;i<o.length;i++){ff.push($$.addLayer(o[i],iD.store.layers.point))}f=-1!==ff.indexOf(true)}else{f=$$.addLayer(o,iD.store.layers.point)}if(!f)return this;return this.flushView(o)},addLineLayer:function(o){var f=true;if(o.length){var ff=[];for(var i=0;i<o.length;i++){ff.push($$.addLayer(o[i],iD.store.layers.line))}f=-1!==ff.indexOf(true)}else{f=$$.addLayer(o,iD.store.layers.line)}if(!f)return this;return this.flushView(o)},addAreaLayer:function(o){var f=true;if(o.length){var ff=[];for(var i=0;i<o.length;i++){ff.push($$.addLayer(o[i],iD.store.layers.area))}f=-1!==ff.indexOf(true)}else{f=$$.addLayer(o,iD.store.layers.area)}if(!f)return this;return this.flushView(o)},addHotspotLayer:function(o){var f=true;if(o.length){var ff=[];var enlayer=context.layers().getLayer();var isenlayer=false,vs=true;if(enlayer){isenlayer=true}for(var i=0;i<o.length;i++){f=$$.addLayer(o[i],iD.store.layers.hotSpot);ff.push(f);if(!f)continue;if(isenlayer){vs=false}else{vs=o[i].editable}this.addOverlayer({name:o[i].name,type:"tms",url:o[i].tileUrl,hotspot:true,zooms:[0,22],id:o[i].id+"HotspoLayer",visible:vs})}f=-1!==ff.indexOf(true)}else{f=$$.addLayer(o,iD.store.layers.hotSpot);if(!f)return this;if(isenlayer){vs=false}else{vs=o.editable}this.addOverlayer({name:o.name||o.id,type:"tms",url:o.tileUrl,hotspot:true,zooms:[0,22],id:o.id+"HotspoLayer",visible:vs})}if(!f)return this;return this.flushView(o)},removeHotspotLayer:function(id){if(id.length){for(var i=0;i<id.length;i++){this.removeOverlayerById(id[i]+"HotspoLayer");this.removeDataLayer({id:id[i]})}}},addRoadLayer:function(o){var f=true;if(o.length){var ff=[];for(var i=0;i<o.length;i++){ff.push($$.addLayer(o[i],iD.store.layers.road))}f=-1!==ff.indexOf(true)}else{f=$$.addLayer(o,iD.store.layers.road)}if(!f)return this;return this.flushView(o)},addDataLayer:function(o){var f=true;if(o.length){var ff=[];for(var i=0;i<o.length;i++){if(o[i].id&&o[i].type){ff.push($$.addLayer(o[i],iD.store.layers[o[i].type]))}}f=-1!==ff.indexOf(true)}else{if(o.id&&o.type){f=$$.addLayer(o,iD.store.layers[o.type])}}if(!f)return this;return this.flushView(o)},getDataLayers:function(){return context.layers().getDataLayers()},getHotspotLayers:function(){return context.layers().getHotspotLayers()},getDataLayer:function(id){return context.layers().getLayerById(id)},getOverLayerByID:function(id){var layers=iD.data.imagery;for(var i in layers){if(layers[i].isOverlay&&layers[i].id==id){return layers[i]}}return false},getTileLayers:function(){return $$.getImagery(false)},getOverlayers:function(){return $$.getImagery(true)},flushView:function(layer,isUpdate){if(isUpdate)context.event.changemap();else context.flush();if(layer.length){for(var i=0,l=layer.length;i<l;i++){context.ui().updateLayer(layer[i])}}else{context.ui().updateLayer(layer)}return this},flushBackground:function(layer){if(layer.isOverlay){this._removeOverlayer(layer);this.addOverlayer(layer)}else{this._removeTileLayer(layer);this.addTileLayer(layer)}return this},removeDataLayers:function(layers){if(layers.length){for(var i=0;i<layers.length;i++){this.removeDataLayer(layers[i])}}},removeTileLayers:function(layers){if(layers.length){for(var i=0;i<layers.length;i++){this._removeTileLayer(layers[i])}}},removeOverlayers:function(layers){if(layers.length){for(var i=0;i<layers.length;i++){this._removeOverlayer(layers[i])}}},removeDataLayer:function(layer){context.connection().removeModelEntityCache(context.layers(layer.id));context.layers().removeLayer(layer);return this.flushView(layer)},removeALLDataLayer:function(){context.layers().removeAllLayers();return this.flushView(editor.context.layers().getLayers())},_removeTileLayer:function(layer){var _="string"===typeof layer?{id:layer}:layer;if(_&&$$.isOverlayer(_.id||_))return;$$.removeImagery(_);context.background().init();return this},removeTileLayerById:function(ids){var that=this;if("[object Array]"===Object.prototype.toString.call(ids)){ids.forEach(function(id){that._removeTileLayer({id:id})})}else{that._removeTileLayer({id:ids})}},_removeOverlayer:function(layer){var _="string"===typeof layer?{id:layer}:layer;if(_&&!$$.isOverlayer(_.id||_))return;$$.removeImagery(_);context.background().init();return this},removeOverlayerById:function(ids){var that=this;if("[object Array]"===Object.prototype.toString.call(ids)){ids.forEach(function(id){that._removeOverlayer({id:id})})}else{that._removeOverlayer({id:ids})}},addTileLayer:function(opt){if(opt.length){for(var i=0;i<opt.length;i++){context.background().addLayer($$.addOverlayer(opt[i]))}}else{context.background().addLayer($$.addOverlayer(opt))}},addOverlayer:function(opt){if(opt.length){for(var i=0;i<opt.length;i++){context.background().addLayer($$.addOverlayer(opt[i]))}}else{context.background().addLayer($$.addOverlayer(opt))}return this},updateTags:function(id,tags,save){if(!id||!tags)return;id=iD.util.transArray(id);var actions=[];id.forEach(function(d){var entity=context.entity(d);if(entity instanceof iD.Node||entity instanceof iD.Way){tags=$$.clean(_.extend({},entity.tags,tags));if(!_.isEqual(entity.tags,tags)){actions.push(iD.actions.ChangeTags(d,tags));var way=0<context.graph().parentWays(entity).length?context.graph().parentWays(entity):null;context.event["entityedite"]&&context.event["entityedite"]({entitys:way})}}});if(0!=actions.length){actions.push(t("operations.change_tags.annotation"));context.perform.apply(this,actions);save&&this.saveDataLayer()}return this},undoOperation:function(){context.undo()},redoOperation:function(){context.redo()},saveDataLayer:function(){if(context.history().hasChanges()){context.enter(iD.modes.Save(context,t("save.title")))}},addLayerFeature:function(feature){this.addLayerEntity(feature)},addLayerEntity:function(entity){if(entity instanceof iD.Node)context.perform(iD.actions.AddEntity(entity),t("operations.add.annotation.point"));else if(entity instanceof iD.Way){var layer=context.layers(entity.layerId);if(entity.isArea()){var actions=[];var nodes=entity.nodes;var news=[];for(var i in nodes){news.push(nodes[i].id);var tags=$$.mergeObject(nodes[i].tags||{},{});nodes[i].setTags(tags);actions.push(iD.actions.AddEntity(nodes[i]))}news.push(nodes[0].id);entity.nodes=news;var tags=$$.mergeObject(entity.tags||{},$$.defauteTags(entity));entity.setTags(tags);entity.tags.area="";actions.push(iD.actions.AddEntity(entity));actions.push(t("operations.start.annotation.area"));context.perform.apply(this,actions)}else if(entity.type==iD.data.GeomType.WAY){var actions=[];var nodes=entity.nodes;var news=[];for(var i in nodes){news.push(nodes[i].id);var tags=$$.mergeObject(nodes[i].tags||{},{});nodes[i].setTags(tags);actions.push(iD.actions.AddEntity(nodes[i]))}entity.nodes=news;var tags=$$.mergeObject(entity.tags||{},$$.defauteTags(entity));entity.setTags(tags);actions.push(iD.actions.AddEntity(entity));actions.push(t("operations.start.annotation.line"));context.perform.apply(this,actions)}else if(entity.modelName==iD.data.DataType.ROAD){}}},getEntity:function(id){return context.entity(id)},addOverlays:function(o){if("[object Array]"===Object.prototype.toString.call(o)){for(var i in o)map.addOverlays(o[i])}else map.addOverlays(o);map.drawOverlayers()},removeOverlays:function(o){if("[object Array]"===Object.prototype.toString.call(o)){for(var i in o)map.removeOverlays(o[i])}else map.removeOverlays(o);map.drawOverlayers()},getMap:function(){return map},getContext:function(){return context},getOverlays:function(overlaysid){return map.getOverlays(overlaysid)},getOverlaysByType:function(type){return map.getOverlays()[type]},lightOverlays:function(overlaysid){map.lightOverlays(overlaysid);return this},lightOverlaysClean:function(){map.lightOverlays([]);return this},setOverlaysEnable:function(id,isEnable){if(!id)return;if("undefined"===typeof isEnable)isEnable=false;id=iD.util.transArray(id);this.getOverlays(id).forEach(function(overlay){overlay.editable=isEnable});map.drawOverlayers()},setOverlaysEnableByType:function(type,isEnable){if(!type)return;if("undefined"===typeof isEnable)isEnable=false;this.getOverlaysByType(type).forEach(function(overlay){overlay.editable=isEnable});map.drawOverlayers()},updateOverlays:function(overlays){map.updateOverlays(overlays)},cleanOverlays:function(){var overlayers=context.map().getOverlays();for(var type in overlayers){this.removeOverlays(overlayers[type])}},displayOverlays:function(id,display){if(!id)return;id=iD.util.transArray(id);this.getOverlays(id).forEach(function(overlay){if(display)overlay.display=false;else overlay.display=true});map.drawOverlayers()},showOverlays:function(id){this.displayOverlays(id,false)},hideOverlays:function(id){this.displayOverlays(id,true)},removeOverlaysByType:function(type){if(-1===["distance","polygon","marker","rectangle","circle","polyline","icon","measurearea"].indexOf(type))return;var overlayers=context.map().getOverlays(),overlays=overlayers[type],oves=[];if(-1!==["measurearea","distance","rectangle"].indexOf(type))"rectangle"===type||"measurearea"===type?overlays=overlayers["polygon"]:overlays=overlayers["polyline"];for(var i in overlays)if(overlays[i].mode===type||!overlays[i].mode)oves.push(overlays[i]);overlays=oves;this.removeOverlays(overlays)},seletedInRectangle:function(bounds,filter){this.setSelected(bounds,filter)},setSelected:function(bounds,filter){var layer=context.layers().getLayer();if(!bounds||!layer)return;filter=filter||iD.util.empty;function INSTAN_NODE(entity){return entity instanceof iD.Node}function INSTAN_WAY(entity){return entity instanceof iD.Way}var extent=iD.geo.Extent(bounds);var selected=context.intersects(extent).filter(function(entity){if(layer.id!==entity.layerId||!layer.isPoint()&&INSTAN_NODE(entity)){return false}if(INSTAN_NODE(entity)||INSTAN_WAY(entity)){return filter(entity)&&true}return false});var length=selected.length;if(length&&(INSTAN_NODE(selected[0])||"area"==layer.type)){if(0!=length)context.enter(iD.modes.Select(context,_.pluck(selected,"id")));return selected}if(length&&INSTAN_WAY(selected[0])&&"area"!=layer.type){var extend=iD.util.lassExtend,graph=context.graph(),wrap=[];selected.forEach(function(e){if(layer.id!==e.layerId){return}if("node"===e.type){extend.isPointInRect({lon:e.loc[0],lat:e.loc[1]},extent)&&wrap.push(e);return}var n=e.nodes;for(var i=0;i<n.length;i++){if(i+1>=n.length)break;var a=graph.entity(n[i]),b=graph.entity(n[i+1]),c=[a.loc[0],a.loc[1],b.loc[0],b.loc[1]],intersects=extend.isLineInRect(extent,c);if(intersects&&3!=intersects&&wrap.push(e))break}});if(wrap.length)context.enter(iD.modes.Select(context,_.pluck(wrap,"id")));return wrap}},getOptions:function(){return context.options},cleanHistory:function(){context.flush()},disconnect:function(selectedIDs){var _disconnect=iD.operations.Disconnect(selectedIDs,context);if(_disconnect.available()){return _disconnect()}return false},wayMerge:function(selectedIDs){var _merge=iD.operations.WayMerge(selectedIDs,context);if(_merge.available()){return _merge()}else{return false}},getHistory:function(){if(context.history().hasChanges()){return context.history().changes(iD.actions.DiscardTags(context.history().difference()))}return false},getParentWays:function(nodeEntity){return context.history().graph().parentWays(nodeEntity)},getSelectedIDs:function(){return context.selectedIDs()},moveEntity:function(selectedIDs){var _move=iD.operations.Move(selectedIDs,context);if(_move.available()){_move()}}});var $$={init:function(id,param){var KDSEditorLibraryPath=window.KDSEditorLibraryPath||"";context=iD().assetPath(KDSEditorLibraryPath+"dist/");context.locale("zh-CN");map=context.map();if(param&&false===param.ui){context.default_ui_none=true}else if("object"===typeof param.ui){context.default_ui_none=param.ui}d3.select("#"+id).call(context.ui());if(param){var maxz=24,minz=1;if(!param.center){param.center=[116.305197,39.982418]}if(!param.maxZoom){param.maxZoom=maxz}if(!param.minZoom){param.minZoom=minz}if(param.maxZoom&&(param.maxZoom>maxz||param.maxZoom<=minz)){param.maxZoom=maxz}if(param.minZoom&&(param.minZoom<minz||param.minZoom>=maxz)){param.minZoom=minz}if(param.maxZoom<=param.minZoom){param.maxZoom=maxz}if(param.minZoom>=param.maxZoom){param.minZoom=minz}if(!param.zoom&&16>=param.minZoom&&16<=param.maxZoom){param.zoom=16}if(!param.zoom&&(16<param.minZoom||16>param.maxZoom)){param.zoom=param.minZoom}if(param.zoom&&param.maxZoom&&param.zoom>param.maxZoom){param.zoom=param.maxZoom}if(param.zoom&&param.minZoom&&param.zoom<param.minZoom){param.zoom=param.minZoom}param.zoom&&map.zoom(param.zoom);param.maxZoom&&map.max_zoom(param.maxZoom);param.minZoom&&map.min_zoom(param.minZoom);param.center&&map.center(param.center);if(!param.editableLevel||10>param.editableLevel){param.editableLevel=10}if(param.editableLevel>maxz){param.editableLevel=maxz}param.editableLevel&&map.editableLevel(param.editableLevel);if(param.serverUrl){iD.store.url.layer=param.serverUrl}if(param.searchUrl){iD.store.url.searchpoi=param.searchUrl}if("undefined"===typeof param.loadPanorama){param.loadPanorama=true}if("undefined"===typeof param.overlaysApply){param.overlaysApply=true}context.options=param}return context},mergeObject:function(json1,json2){for(var key in json1){json2[key]=json1[key]}var r={};for(var k in json2){r[k]=json2[k]}return r},addLayer:function(opt,typeopt={}){if(!opt.id)return false;var lays=context.layers().getLayers();for(var i=0;i<lays.length;i++){if(lays[i].id===opt.id)return false}if(!opt.url&&typeopt&&"hotspot"!=typeopt.type){opt.url=iD.store.url.layer}var enlayer=context.layers().getLayer();var o=$$.mergeObject(opt,_.clone(typeopt));var lay;if(opt instanceof DataLayer||opt instanceof HotspotLayer){var llayer=iD.Layer(o);for(var key in llayer)opt[key]=llayer[key];lay=opt}else if(o.type&&"hotspot"==o.type){lay=new HotspotLayer(iD.Layer(o))}else{lay=new DataLayer(iD.Layer(o))}var layers=context.layers().getLayers();var add=true;add&&context.layers().addLayer(lay);return true},addImagery:function(opt){if(!opt.url){opt.url=iD.store.url.layer}var ox=_.clone(iD.store.imagery.imagery);var o=$$.mergeObject(opt,ox);if(opt instanceof TileLayer){for(var key in o)opt[key]=o[key];o=opt}else{o=new TileLayer(iD.Layer(o))}iD.data.imagery.push(o);iD.data.imagery.sort(function(a,b){return(a.order||0)>(b.order||0)?-1:1})},addOverlayer:function(opt){if(!opt.url){opt.url=iD.store.url.layer}var lays=context.background().getLayers();for(var i=0;i<lays.length;i++){if(lays[i].id===opt.id)return false}var ox=_.clone(iD.store.imagery.overlayer);var o=$$.mergeObject(opt,ox);if(opt instanceof Overlayer){for(var key in o)opt[key]=o[key];o=opt}else{o=new Overlayer(iD.Layer(o))}return o},removeImagery:function(layer){for(var i=0;i<iD.data.imagery.length;i++){var _=iD.data.imagery[i];if(_&&layer.id&&_.id==layer.id){iD.data.imagery.splice(i,1)}}},getImagery:function(type){var layers=iD.data.imagery,_=[];for(var i in layers){if(type)layers[i].isOverlay&&_.push(layers[i]);else!layers[i].isOverlay&&_.push(layers[i])}return _},clean:function(o){var out={},k,v;for(k in o){if(k&&(v=o[k])!==undefined){out[k]=v.trim()}}return out},defauteTags:function(entity){var defaultTags={},modelEntity=iD.Layers.getLayer(entity.layerId).modelEntity(),gtype=modelEntity.getGeoType();modelEntity.getFields(gtype).filter(function(d){if(d.defaultvalue&&!_.isEmpty(d.defaultvalue)){defaultTags[d.name]=d.defaultvalue}return false});return defaultTags},isOverlayer:function(id){var layers=iD.data.imagery;for(var i in layers)if(id===layers[i].id&&layers[i].isOverlay)return layers[i]},setCenterFromCache:function(param){var s_m_e_c=context.storage("s_map_editor_center");if(null!==s_m_e_c&&""!==s_m_e_c){var s_m_e_c_x_y=s_m_e_c.split(","),c_x=parseFloat(s_m_e_c_x_y[0]),c_y=parseFloat(s_m_e_c_x_y[1]);if(0!==c_x&&0!==c_y)param.center=[s_m_e_c_x_y[0],s_m_e_c_x_y[1]]}}};var DataLayer=function(opt){this.initialize(opt)};_.extend(DataLayer.prototype,{initialize:function(opt){for(var key in opt){this[key]=opt[key]}},update:function(map){if(!map)return;map.flushView(this,true);return this},setOptions:function(opt){for(var i in opt){this[i]=opt[i]}this.editor&&this.update(this.editor);return this}});var HotspotLayer=function(opt){this.initialize(opt)};_.extend(HotspotLayer.prototype,{initialize:function(opt){for(var key in opt){this[key]=opt[key]}},update:function(map){if(!map)return;map.flushView(this,true);return this},setOptions:function(opt){for(var i in opt){this[i]=opt[i]}if(this.editor&&this.isHotspot()){var hotlayer=this.editor.getOverLayerByID(this.id+"HotspoLayer");hotlayer.setOptions({editor:this.editor,name:this.name,type:"tms",url:this.tileUrl,visible:this.editable})}this.editor&&this.update(this.editor);return this}});var Overlayer=function(opt){this.initialize(opt)};_.extend(Overlayer.prototype,{initialize:function(opt){for(var key in opt){this[key]=opt[key]}},update:function(map){if(!map)return;map.flushBackground(this)},setOptions:function(opt){for(var i in opt){this[i]=opt[i]}this.editor&&this.update(this.editor);return this}});var TileLayer=function(opt){this.initialize(opt)};_.extend(TileLayer.prototype,{initialize:function(opt){for(var key in opt){this[key]=opt[key]}},update:function(map){if(!map)return;map.flushBackground(this)},setOptions:function(opt){for(var i in opt){this[i]=opt[i]}this.editor&&this.update(this.editor);return this}});window.Point=iD.Marker;window.Marker=iD.Marker;window.Icon=iD.Icon;window.Polyline=iD.Polyline;window.Polygon=iD.Polygon;window.Circle=iD.Circle;window.InfoWindow=iD.InfoWindow;window.OverView=iD.OverView;window.Node=iD.Node;window.Way=iD.Way;window.KDSEditor=KDSEditor;window.MapEditor=KDSEditor;window.DataLayer=DataLayer;window.HotspotLayer=HotspotLayer;window.Overlayer=Overlayer;window.TileLayer=TileLayer;window.TransPolygon=iD.TransPolygon})();