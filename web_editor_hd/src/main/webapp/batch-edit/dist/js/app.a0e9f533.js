(function(){"use strict";var e={3882:function(e,t,a){var i=a(9963),s=a(6252);function l(e,t){const a=(0,s.up)("router-view");return(0,s.wg)(),(0,s.j4)(a)}const n={};n.render=l;var r=n,o=a(2119);const d={class:"home"};function c(e,t,a,i,l,n){const r=(0,s.up)("indexHeader"),o=(0,s.up)("indexSearch"),c=(0,s.up)("indexContent"),u=(0,s.up)("indexFooter");return(0,s.wg)(),(0,s.j4)("div",d,[(0,s.Wm)(r,{msg:"属性批量编辑",ref:"header"},null,512),(0,s.Wm)(o,{onRefresh:n.refresh,ref:"search"},null,8,["onRefresh"]),(0,s.Wm)(c,{tagDatas:l.tagDatas,onCheckTagEdit:n.checkTagEdit,onCheckTagCreate:n.checkTagCreate,onRefreshForm:n.refreshForm,onFinishTask:n.finishTask,ref:"content"},null,8,["tagDatas","onCheckTagEdit","onCheckTagCreate","onRefreshForm","onFinishTask"]),(0,s.Wm)(u,{ref:"footer",tagEdits:l.tagEdits,onTagDataUpdateState:n.tagDataUpdateState,onTagDataChange:n.tagDataChange,onDrawerOpened:n.drawerOpened,onDrawerClose:n.drawerClose,onContentPageChange:n.contentPageChange},null,8,["tagEdits","onTagDataUpdateState","onTagDataChange","onDrawerOpened","onDrawerClose","onContentPageChange"])])}var u=a(3577);const h=(0,s.HX)("data-v-11ddc304");(0,s.dD)("data-v-11ddc304");const g={class:"indexHeader"};(0,s.Cn)();const m=h(((e,t,a,i,l,n)=>((0,s.wg)(),(0,s.j4)("div",g,[(0,s.Wm)("h2",null,(0,u.zw)(a.msg),1)]))));var f={name:"indexHeader",props:{msg:String}};f.render=m,f.__scopeId="data-v-11ddc304";var p=f;const T=(0,s.HX)("data-v-1ceed5a3");(0,s.dD)("data-v-1ceed5a3");const k={class:"search"},v=(0,s.Uk)("领取"),b=(0,s.Uk)("退出");(0,s.Cn)();const y=T(((e,t,a,l,n,r)=>{const o=(0,s.up)("el-option"),d=(0,s.up)("el-select"),c=(0,s.up)("el-button");return(0,s.wg)(),(0,s.j4)("div",k,[(0,s.Wm)(d,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value=e),placeholder:"请选择",filterable:"","filter-method":r.dataFilter,onChange:r.changeTask,"no-data-text":"无任务","no-match-text":"无匹配任务"},{default:T((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(n.searchTasks,(e=>(0,s.wy)(((0,s.wg)(),(0,s.j4)(o,{key:r.renderValue(e),label:r.renderLabel(e),value:r.renderValue(e),title:r.renderLabel(e)},{default:T((()=>[(0,s.Wm)("span",{innerHTML:r.renderLabel(e)},null,8,["innerHTML"]),(0,s.Wm)("span",{class:"",style:"float: right; color: "+e.fcolor+";background-color:"+e.checkColro+"; font-size: 13px;width: 60px;text-align: center;",innerHTML:r.renderStatus(e)},null,12,["innerHTML"]),(0,s.Wm)("span",{style:{float:"right",color:"#8492a6","font-size":"13px"},innerHTML:r.renderKey(e)},null,8,["innerHTML"])])),_:2},1032,["label","value","title"])),[[i.F8,r.renderShow(e)]]))),128))])),_:1},8,["modelValue","filter-method","onChange"]),(0,s.Wm)(c,{class:"btn-cliam",type:"primary",icon:"el-icon-circle-plus-outline",onClick:t[2]||(t[2]=e=>r.cliam())},{default:T((()=>[v])),_:1}),(0,s.Wm)(c,{class:"btn-logout",type:"primary",icon:"el-icon-user",onClick:t[3]||(t[3]=e=>r.logout())},{default:T((()=>[b])),_:1})])}));var w=a(9669),C=a.n(w);function I(){return new Promise((e=>{C().get(window._init_url,{}).then((t=>{e(t.data)}),(()=>{e({})})).catch((()=>{e({})}))}))}function D(e){return new Promise((t=>{C().get(e.url,{}).then((e=>{t(e.data)}),(()=>{t({})})).catch((()=>{t({})}))}))}function E(e){return new Promise((t=>{C().get(e.url,{}).then((e=>{t(e.data)}),(()=>{t({})})).catch((()=>{t({})}))}))}function _(e){return new Promise((t=>{C().get(e.url,{}).then((e=>{t(e.data)}),(()=>{t({})})).catch((()=>{t({})}))}))}function N(e){return new Promise((t=>{C().post(e.url,e.data).then((e=>{t(e.data)}),(()=>{t({})})).catch((()=>{t({})}))}))}var $=a(9755),F=a.n($);function x(e,t){var a={ouc:{user:null,oauth2User:t,clientId:"client",clientSecret:"secret"},getNoHashUrl:function(){return window.location.href.split("#")[0]},begin:function(e){e=F().extend({clientId:!1,authorizeUrl:!1,redirectUri:window.location.href,responseType:"code"},e),window.location.href=e.authorizeUrl+"?client_id="+e.clientId+"&response_type="+e.responseType+"&redirect_uri="+e.redirectUri},user:function(t){F().ajax({type:"get",url:t,async:!1,data:{},success:function(t){t?e.config.globalProperties.$user=t:a.oAuthLoginPage()},error:function(){alert("当前登录用户为空，请检查当前地址是否正确")}})},signout:function(){F().ajax({type:"get",url:a.ouc.oauth2User+"logout",async:!1,data:{},success:function(){window.location.reload()},error:function(){console.log("当前登录用户为空，请检查当前地址是否正确")}})},oAuthLoginPage:function(){a.begin({authorizeUrl:a.ouc.oauth2User+"/authorize",clientId:a.ouc.clientId,redirectUri:a.getNoHashUrl()})}};return a}function S(e){var t={};return e.forEach((e=>{var a=e.k||e.key||e.name,i=e.v||e.val||e.value||"";t[a]=i})),t}function U(e){var t=e.authorities,a=!1,i=!1,s=["edit","work","LinearWork","diseaseWork","autoTopologyWork","totalFactorCompileWork"],l=["edit_check","manualCheck","check","LinearCheck","diseaseCheck","autoTopologyCheck","totalFactorCompileCheck"];return t.forEach((e=>{var t=e.authority;s.includes(t)&&(a=!0),l.includes(t)&&(i=!0)})),a&&i?3:a&&!i?1:!a&&i?2:0}var W={name:"search",data(){return{loading:null,catchTasks:{},searchTasks:[],tasks:[],value:""}},mounted(){this.findTasks()},methods:{changeTask(e){var t=this.catchTasks[e].featureGroupId,a=this.catchTasks[e].taskId;window.currentTask=this.catchTasks[e],this.$emit("refresh",a,t)},dataFilter(e){this.searchTasks=e?this.tasks.filter((t=>{var a=this.renderLabel(t),i=this.renderValue(t);if(~i.indexOf(e)||~i.toUpperCase().indexOf(e.toUpperCase())||~a.indexOf(e)||~a.toUpperCase().indexOf(e.toUpperCase()))return!0})):this.tasks},findTasks(){this.loading=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});var e=this,t=e.$config.kts+"runtime/tasks?includeProcessVariables=true&size=100&sort=createTime&order=desc&assignee="+e.$user.name;e.catchTasks={},e.searchTasks=[],e.tasks=[],e.value="",_({url:t,data:{}}).then((t=>{var a=t.data||[],i=[];a.forEach((e=>{var t=e.variables.find((e=>"taskId"==e.name));t&&(e.taskId=t.value,i.push(t.value))})),e.tasks=a,e.findTaskLists(i)}))},findTaskLists(e){var t=this,a=new FormData;if(e.length){a.append("ids",e.join(","));var i=t.$config.kts+"task/findByIds";N({url:i,data:a}).then((e=>{"0"!=e.code&&t.$notify({title:"警告",message:e.message,type:"warning"});var a=e.result||{};for(var i in a){var s=S(a[i].tags),l=a[i].featureGroups||[],n=t.tasks.filter((e=>e.taskId==i));n&&n.length&&n.forEach((e=>{var n=e.taskDefinitionKey,r=l.find((e=>e.linkId==n));if(r){var o=this.checkStatus(s);e.featureGroupId=r.featureGroupId,e.taskName=a[i].name,e.formatTags=s,e.checkText=o.checkText,e.checkColro=o.checkColro,e.fcolor=o.fcolor,t.catchTasks[e.id]=e}}))}t.searchTasks=t.tasks,this.loading.close()}))}else this.loading.close()},checkStatus(e){var t="未检查",a="",i="#000";return!e.checkStatus||"1"!=e.checkStatus&&"0"!=e.checkStatus?e.checkStatus&&"2"==e.checkStatus?(t="检查完成",a="#ff0000"):e.checkStatus&&"3"==e.checkStatus?(t="检查异常",a="#0000FF",i="#fff"):e.checkStatus&&"4"==e.checkStatus?(t="进行中",a="#FFFF00",i="#000"):!e.checkStatus||"100"!=e.checkStatus&&"5"!=e.checkStatus?e.checkStatus&&"6"==e.checkStatus&&(t="处理异常",a="#0000FF",i="#fff"):(t="可作业",a="#008000",i="#000"):(t=["等待中","检查中"][e.checkStatus]||"",a="#FFFF00"),{checkText:t,checkColro:a,fcolor:i}},renderShow(e){return!!e.featureGroupId},renderLabel(e){return e.taskName||" - "},renderValue(e){return e.id},renderKey(e){return e.taskId||" - "},renderStatus(e){return e.checkText||" - "},cliam(){var e=this,t=e.$config.kts+"task/claim?user="+e.$user.name;_({url:t,data:{}}).then((t=>{"0"==t.code&&t.result.length?(e.$notify({title:"成功",message:t.message,type:"success"}),e.findTasks()):e.$notify({title:"警告",message:t.message,type:"warning"})}))},save(){},logout(){x(null,this.$config.kd_auth_server).signout()}}};W.render=y,W.__scopeId="data-v-1ceed5a3";var A=W;const V={class:"mark el-icon-warning"};function R(e,t,a,l,n,r){const o=(0,s.up)("contentSearch"),d=(0,s.up)("el-image"),c=(0,s.up)("contentEdit"),h=(0,s.up)("el-scrollbar"),g=(0,s.up)("contentPage"),m=(0,s.up)("el-tab-pane"),f=(0,s.up)("el-tabs"),p=(0,s.Q2)("loading");return(0,s.wg)(),(0,s.j4)("div",{class:["tabs",n.paneClass]},[(0,s.Wm)(o,{onRemakeTask:r.remakeTask,onRefresh:r.refresh,onFinish:r.finishTask,onRefreshForm:r.refreshForm},null,8,["onRemakeTask","onRefresh","onFinish","onRefreshForm"]),(0,s.wy)((0,s.Wm)(f,{class:"contentTabs",modelValue:n.activeName,"onUpdate:modelValue":t[3]||(t[3]=e=>n.activeName=e),type:"border-card",onTabClick:r.handleClick},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(n.lists,(e=>((0,s.wg)(),(0,s.j4)(m,{label:e.name,name:e.value,key:e.name},{default:(0,s.w5)((()=>[(0,s.Wm)(h,null,{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(r.filterActiveLists,(e=>((0,s.wg)(),(0,s.j4)("div",{key:e.id,class:["blockImage hide","_"+e.id],onMouseenter:t[1]||(t[1]=e=>r.mouseenter(e)),onMouseleave:t[2]||(t[2]=e=>r.mouseleave(e))},[(0,s.Wm)(d,{style:{height:"170px"},src:e.file_url,"preview-src-list":[e.file_url],fit:"fill"},null,8,["src","preview-src-list"]),(0,s.Wm)(c,{ref:"contentEdit",editTags:e.tags,tagDatas:a.tagDatas,editQuestionTag:n.editQuestionTag,modelName:e.modelName,editDisabled:n.editDisabled,checkDisabled:n.checkDisabled,stateDisabled:n.stateDisabled,editId:e.id,entity:e,entityId:e.entityId,onEditList:r.editList,onCheckList:r.checkList,onCheckListCreate:r.checkListCreate,onTagImage:r.tagImage,onTagImageDelete:r.tagImageDelete},null,8,["editTags","tagDatas","editQuestionTag","modelName","editDisabled","checkDisabled","stateDisabled","editId","entity","entityId","onEditList","onCheckList","onCheckListCreate","onTagImage","onTagImageDelete"]),(0,s.Wm)("span",{class:"demonstration",title:e.modelName+"_"+e.entityId},(0,u.zw)(e.modelName)+"_"+(0,u.zw)(e.entityId),9,["title"]),(0,s.wy)((0,s.Wm)("i",V,null,512),[[i.F8,n.editQuestionTag[e.id]]])],34)))),128))])),_:1}),(0,s.Wm)(g,{pageTotleNum:n.pageTotleNum,ref:"contentPage",onPageChange:r.pageChange},null,8,["pageTotleNum","onPageChange"])])),_:2},1032,["label","name"])))),128))])),_:1},8,["modelValue","onTabClick"]),[[p,n.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])],2)}const P=(0,s.Wm)("strong",null,"请确认是否所有数据已编辑完成并提交检查进入下一环节。",-1),L={class:"dialog-footer"},j=(0,s.Uk)("确 定"),O=(0,s.Uk)("取 消"),H={class:"dialog-footer"},Q=(0,s.Uk)("取 消"),z=(0,s.Uk)("确 定"),G={class:"contentSearch"},q=(0,s.Uk)("报表"),Y=(0,s.Uk)("刷新"),B=(0,s.Uk)("保存");function K(e,t,a,i,l,n){const r=(0,s.up)("el-button"),o=(0,s.up)("el-dialog"),d=(0,s.up)("el-option"),c=(0,s.up)("el-select"),h=(0,s.up)("el-form-item"),g=(0,s.up)("el-form"),m=(0,s.up)("el-button-group");return(0,s.wg)(),(0,s.j4)(s.HY,null,[(0,s.Wm)(o,{title:"信息确认",modelValue:l.centerDialogVisible1,"onUpdate:modelValue":t[2]||(t[2]=e=>l.centerDialogVisible1=e),width:"30%","destroy-on-close":"",center:""},{footer:(0,s.w5)((()=>[(0,s.Wm)("span",L,[(0,s.Wm)(r,{type:"primary",onClick:n.autoCheckStatus},{default:(0,s.w5)((()=>[j])),_:1},8,["onClick"]),(0,s.Wm)(r,{onClick:t[1]||(t[1]=e=>l.centerDialogVisible1=!1)},{default:(0,s.w5)((()=>[O])),_:1})])])),default:(0,s.w5)((()=>[P])),_:1},8,["modelValue"]),(0,s.Wm)(o,{title:"信息确认",modelValue:l.centerDialogVisible2,"onUpdate:modelValue":t[6]||(t[6]=e=>l.centerDialogVisible2=e),width:"300px"},{footer:(0,s.w5)((()=>[(0,s.Wm)("span",H,[(0,s.Wm)(r,{onClick:t[4]||(t[4]=e=>l.centerDialogVisible2=!1)},{default:(0,s.w5)((()=>[Q])),_:1}),(0,s.Wm)(r,{type:"primary",onClick:t[5]||(t[5]=e=>n.processPassStatus(l.passForm.isPass))},{default:(0,s.w5)((()=>[z])),_:1})])])),default:(0,s.w5)((()=>[(0,s.Wm)(g,{model:l.passForm},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{label:"是否通过","label-width":"100px"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{modelValue:l.passForm.isPass,"onUpdate:modelValue":t[3]||(t[3]=e=>l.passForm.isPass=e),placeholder:"是否通过","popper-class":"isPassSelect"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:"是",value:"true"}),(0,s.Wm)(d,{label:"否",value:"false"})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,s.Wm)("div",G,[(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,{class:"btn-form",icon:"el-icon-search",onClick:t[7]||(t[7]=e=>n.form())},{default:(0,s.w5)((()=>[q])),_:1}),(0,s.Wm)(r,{class:"btn-refresh",icon:"el-icon-refresh",onClick:t[8]||(t[8]=e=>n.refresh())},{default:(0,s.w5)((()=>[Y])),_:1}),(0,s.Wm)(r,{class:"btn-save",icon:"el-icon-document-checked",onClick:t[9]||(t[9]=e=>n.save())},{default:(0,s.w5)((()=>[B])),_:1}),(0,s.Wm)(r,{class:"btn-finish",icon:"el-icon-folder-checked",onClick:n.finish},{default:(0,s.w5)((()=>[(0,s.Uk)((0,u.zw)(l.finishText),1)])),_:1},8,["onClick"])])),_:1})])],64)}var M={name:"contentSearch",data(){return{passForm:{isPass:"true"},modal:!1,centerDialogVisible1:!1,centerDialogVisible2:!1,cities:[],value:"",finishText:"编辑完成"}},mounted(){var e=U(this.$user);[1,3].includes(e)&&(this.finishText="编辑完成"),[2,3].includes(e)&&(this.finishText="质检完成")},methods:{form(){this.$emit("refreshForm")},refresh(){this.$emit("refresh")},save(){this.$emit("finish")},finish(){window.currentTask&&(this.finishText,this.centerDialogVisible2=!0)},finishToProcess(e){"0"==e?(this.centerDialogVisible1=!1,this.centerDialogVisible2=!1,this.$emit("remakeTask")):"1"==e&&this.processPassStatus(!0)},processPassStatus(e){var t=this,a={taskId:""+window.currentTask.id,properties:[{id:"passFlag",value:e+""}]},i=t.$config.kts+"form/form-data";N({url:i,data:a}).then((e=>{console.log(e),t.centerDialogVisible1=!1,t.centerDialogVisible2=!1,t.$emit("remakeTask")}))},autoCheckStatus(){var e=this,t={activityId:window.currentTask.formatTags.currentActivity,taskId:window.currentTask.taskId},a=e.$config.kts+"dispatch/job/start";N({url:a,data:t}).then((t=>{if("0"!=t.code)return e.$notify({title:"检查服务",message:"启动检查服务失败: "+t.message,type:"warning"}),e.centerDialogVisible1=!1,void(e.centerDialogVisible2=!1);e.finishToProcess(t.result)}))}}};M.render=K;var X=M;const J=(0,s.HX)("data-v-daa6939c");(0,s.dD)("data-v-daa6939c");const Z={class:"pages"};(0,s.Cn)();const ee=J(((e,t,a,i,l,n)=>{const r=(0,s.up)("el-pagination");return(0,s.wg)(),(0,s.j4)("div",Z,[(0,s.Wm)(r,{onSizeChange:n.handleSizeChange,onCurrentChange:n.handleCurrentChange,background:"","hide-on-single-page":"",layout:"prev, pager, next, jumper","current-page":l.pageNum,"page-count":a.pageTotleNum,style:{position:"absolute",bottom:"0px"}},null,8,["onSizeChange","onCurrentChange","current-page","page-count"])])}));var te={name:"pages",data(){return{pageNum:1}},props:["pageTotleNum"],methods:{dataFilter(){},handleSizeChange(e){this.pageNum=e,this.$emit("pageChange",this.pageNum)},handleCurrentChange(e){this.pageNum=e,this.$emit("pageChange",this.pageNum)},firstPage(){this.pageNum=1,this.$emit("pageChange",this.pageNum)},lastPage(){this.pageNum=this.pageTotleNum,this.$emit("pageChange",this.pageNum)},prePage(){this.pageNum>1&&(this.pageNum--,this.$emit("pageChange",this.pageNum))},nextPage(){this.pageNum<this.pageTotleNum&&(this.pageNum++,this.$emit("pageChange",this.pageNum))}}};te.render=ee,te.__scopeId="data-v-daa6939c";var ae=te;const ie={class:"contentEdit"},se=(0,s.Wm)("p",null,"属性栏",-1),le=(0,s.Uk)("确定"),ne=(0,s.Uk)("取消"),re=(0,s.Uk)("确定"),oe=(0,s.Uk)("取消"),de=(0,s.Uk)("确定"),ce=(0,s.Uk)("取消"),ue=(0,s.Uk)("删除"),he={class:"footHeaderToggle"};function ge(e,t,a,l,n,r){const o=(0,s.up)("el-option"),d=(0,s.up)("el-select"),c=(0,s.up)("el-input"),h=(0,s.up)("el-form-item"),g=(0,s.up)("el-button"),m=(0,s.up)("el-form"),f=(0,s.up)("el-radio"),p=(0,s.up)("el-radio-group"),T=(0,s.up)("el-pagination"),k=(0,s.up)("el-scrollbar"),v=(0,s.up)("el-tooltip"),b=(0,s.up)("el-popover");return(0,s.wg)(),(0,s.j4)("div",ie,[(0,s.Wm)(b,{placement:n.placement,width:n.popWidth,trigger:"manual","popper-class":"editPopover","popper-options":{boundariesElement:"body",gpuAcceleration:!1},visible:n.visible,"onUpdate:visible":t[11]||(t[11]=e=>n.visible=e)},{reference:(0,s.w5)((()=>[(0,s.Wm)("div",he,[(0,s.Wm)(v,{class:"item",effect:"dark",content:"修改",placement:"top",enterable:n.enterable},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{onClick:t[7]||(t[7]=(0,i.iM)((e=>r.editImage(e)),["stop"])),icon:"el-icon-edit-outline",title:"修改"})])),_:1},8,["enterable"]),(0,s.Wm)(v,{class:"item",effect:"dark",content:"新增质检标记",placement:"top",enterable:n.enterable},{default:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)(g,{onClick:t[8]||(t[8]=(0,i.iM)((e=>r.checkImage(e,"add")),["stop"])),icon:"el-icon-location",title:"新增质检标记"},null,512),[[i.F8,r.showAddBtn()]])])),_:1},8,["enterable"]),(0,s.Wm)(v,{class:"item",effect:"dark",content:"修改质检标记",placement:"top",enterable:n.enterable},{default:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)(g,{onClick:t[9]||(t[9]=(0,i.iM)((e=>r.checkImage(e,"edit")),["stop"])),icon:"el-icon-map-location",title:"修改质检标记"},null,512),[[i.F8,r.showEditBtn()]])])),_:1},8,["enterable"]),(0,s.Wm)(v,{class:"item",effect:"dark",content:"问题标记",placement:"top",enterable:n.enterable},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{onClick:t[10]||(t[10]=(0,i.iM)((e=>r.tagImage()),["stop"])),icon:"el-icon-add-location",title:"问题标记"})])),_:1},8,["enterable"])])])),default:(0,s.w5)((()=>[se,(0,s.Wm)(k,{"max-height":"450px",style:{"padding-bottom":"30px"}},{default:(0,s.w5)((()=>[1==n.formType?((0,s.wg)(),(0,s.j4)(m,{key:0,ref:"editForm",model:n.editForm,"label-width":"150px",size:"medium",rules:n.editRules,"label-position":"left"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(n.formDatas,(e=>((0,s.wg)(),(0,s.j4)("div",{key:e.fieldName},[e.display?((0,s.wg)(),(0,s.j4)(h,{key:0,label:e.fieldTitle,prop:e.fieldName},{default:(0,s.w5)((()=>["select"==e.fieldInput?((0,s.wg)(),(0,s.j4)(d,{key:0,modelValue:n.editForm[e.fieldName],"onUpdate:modelValue":t=>n.editForm[e.fieldName]=t,placeholder:"formChild.message",disabled:a.editDisabled,onChange:t=>r.groupLinkage(e.fieldName)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(e.cloneValues,(e=>((0,s.wg)(),(0,s.j4)(o,{key:e.value,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])):((0,s.wg)(),(0,s.j4)(c,{key:1,type:"text",disabled:a.editDisabled,modelValue:n.editForm[e.fieldName],"onUpdate:modelValue":t=>n.editForm[e.fieldName]=t},null,8,["disabled","modelValue","onUpdate:modelValue"]))])),_:2},1032,["label","prop"])):(0,s.kq)("",!0)])))),128)),(0,s.Wm)(h,{size:"large"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{type:"primary",size:"medium",disabled:a.editDisabled,onClick:t[1]||(t[1]=e=>r.submitEdit("editForm"))},{default:(0,s.w5)((()=>[le])),_:1},8,["disabled"]),(0,s.Wm)(g,{size:"medium",onClick:t[2]||(t[2]=e=>n.visible=!1)},{default:(0,s.w5)((()=>[ne])),_:1})])),_:1})])),_:1},8,["model","rules"])):(0,s.kq)("",!0),2==n.formType||4==n.formType?((0,s.wg)(),(0,s.j4)(m,{key:1,ref:"checkForm",model:n.checkForm,"label-width":"120px",size:"medium","label-position":"left",rules:n.checkRules,disabled:!(!a.stateDisabled||!a.checkDisabled)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(n.formDatas,(e=>((0,s.wg)(),(0,s.j4)("div",{key:e.fieldName},[(0,s.Wm)(h,{label:e.fieldTitle,prop:e.fieldName},{default:(0,s.w5)((()=>["STATE"==e.fieldName?((0,s.wg)(),(0,s.j4)(p,{key:0,modelValue:n.checkForm[e.fieldName],"onUpdate:modelValue":t=>n.checkForm[e.fieldName]=t,size:"medium",disabled:a.stateDisabled},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(e.fieldType.fieldTypeValues,(e=>((0,s.wg)(),(0,s.j4)(f,{key:e.value,value:e.value,label:e.value,border:""},{default:(0,s.w5)((()=>[(0,s.Uk)((0,u.zw)(e.name),1)])),_:2},1032,["value","label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])):"DESC"==e.fieldName?((0,s.wg)(),(0,s.j4)(c,{key:1,type:"textarea",modelValue:n.checkForm[e.fieldName],"onUpdate:modelValue":t=>n.checkForm[e.fieldName]=t,disabled:a.checkDisabled},null,8,["modelValue","onUpdate:modelValue","disabled"])):"select"==e.fieldInput?((0,s.wg)(),(0,s.j4)(d,{key:2,modelValue:n.checkForm[e.fieldName],"onUpdate:modelValue":t=>n.checkForm[e.fieldName]=t,placeholder:e.fieldTitle,onChange:t=>r.groupLinkage(e.fieldName),disabled:a.checkDisabled},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(e.cloneValues||[],(e=>((0,s.wg)(),(0,s.j4)(o,{key:e.value,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange","disabled"])):(0,s.kq)("",!0)])),_:2},1032,["label","prop"])])))),128)),(0,s.Wm)(h,{size:"large"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{type:"primary",size:"medium",onClick:t[3]||(t[3]=e=>r.submitCheck("checkForm"))},{default:(0,s.w5)((()=>[re])),_:1}),(0,s.Wm)(g,{size:"medium",onClick:t[4]||(t[4]=e=>n.visible=!1)},{default:(0,s.w5)((()=>[oe])),_:1})])),_:1}),(0,s.wy)((0,s.Wm)(T,{onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange,small:"",layout:"prev, pager, next, jumper","current-page":n.page.currentPage,"page-count":n.page.totalPage,style:{position:"absolute",bottom:"0px"}},null,8,["onSizeChange","onCurrentChange","current-page","page-count"]),[[i.F8,2==n.formType]])])),_:1},8,["model","rules","disabled"])):(0,s.kq)("",!0),3==n.formType?((0,s.wg)(),(0,s.j4)(m,{key:2,ref:"imageForm",model:n.imageForm,"label-width":"150px",size:"medium",rules:n.imageRules,"label-position":"left"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(n.formDatas,(e=>((0,s.wg)(),(0,s.j4)("div",{key:e.fieldName},[(0,s.Wm)(h,{label:e.fieldTitle,prop:e.fieldName},{default:(0,s.w5)((()=>["select"==e.fieldInput?((0,s.wg)(),(0,s.j4)(d,{key:0,modelValue:n.imageForm[e.fieldName],"onUpdate:modelValue":t=>n.imageForm[e.fieldName]=t,placeholder:"formChild.message"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(e.cloneValues,(e=>((0,s.wg)(),(0,s.j4)(o,{key:e.value,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):((0,s.wg)(),(0,s.j4)(c,{key:1,type:"text",modelValue:n.imageForm[e.fieldName],"onUpdate:modelValue":t=>n.imageForm[e.fieldName]=t},null,8,["modelValue","onUpdate:modelValue"]))])),_:2},1032,["label","prop"])])))),128)),(0,s.Wm)(h,{size:"large"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{type:"primary",size:"medium",onClick:t[5]||(t[5]=e=>r.submitImage("imageForm"))},{default:(0,s.w5)((()=>[de])),_:1}),(0,s.Wm)(g,{size:"medium",onClick:t[6]||(t[6]=e=>n.visible=!1)},{default:(0,s.w5)((()=>[ce])),_:1}),(0,s.wy)((0,s.Wm)(g,{type:"danger",size:"medium",onClick:r.deleteQuestionTag},{default:(0,s.w5)((()=>[ue])),_:1},8,["onClick"]),[[i.F8,n.deleteDisabled]])])),_:1})])),_:1},8,["model","rules"])):(0,s.kq)("",!0)])),_:1})])),_:1},8,["placement","width","visible"])])}var me={name:"contentEdit",data(){return{tagDataEdit:!1,editTagId:null,createTagId:1,page:{currentPage:1,pageSize:1,totalPage:1},enterable:!1,toggleClass:this.hideHeader?"el-icon-caret-top":"el-icon-caret-bottom",visible:!1,deleteDisabled:!1,childInstanseTag:this.instanseTag,formType:1,popWidth:400,placement:"right",formDatas:[],editForm:{},imageForm:{},checkForm:{ERROR_TYPE:"",ATTRIBUTE:"",STATE:"",DESC:""},ATTRIBUTE_filter:["AREA_FLAG","OPERATOR","SOURCE","SDATE","FLAG","TASK_ID","BATCH","SEQ"],editRules:{},imageRules:{},checkRules:{ERROR_TYPE:[{required:!1,message:"请选择错误类型",trigger:"change"}],ATTRIBUTE:[{required:!1,message:"请选择错误属性",trigger:"change"}],STATE:[{required:!1,message:"请选择标记状态",trigger:"change"}],DESC:[{required:!1,message:"请输入内容描述",trigger:"blur"}]}}},props:["editId","entity","entityId","editTags","modelName","editDisabled","checkDisabled","stateDisabled","tagDatas","editQuestionTag"],mounted(){this.tagDataEdit=!0,this.tagDatas.length&&(this.tagDataEdit=!0)},methods:{showAddBtn(){return!this.checkDisabled},showEditBtn(){var e=this.tagDatas.filter((e=>e.cloneTag.FEATURE_ID==this.entityId));return e.length},getInstanse(e){var t=this.$tags[e]||{},a=t.fields||[];return a},attributeInstanseInit(){this.editRules={},this.editForm={},this.formDatas=[];var e=this.$fruit[this.modelName]||{},t=e.fields||[],a=this.$_.cloneDeep(t);a.forEach((e=>{if(e.display){var t="select"==e.fieldInput?"change":"blur",a="select"==e.fieldInput?"选择":"输入",i="请"+a+e.fieldTitle,s=this.editTags[e.fieldName]||"";this.editForm[e.fieldName]=s||e.defaultValue||"",this.editRules[e.fieldName]=[{required:!1,message:i,trigger:t}],e.message=i}})),this.formDatas=a},questionInstanseInit(e){this.imageRules={},this.imageForm={},this.formDatas=[];var t=this.editQuestionTag[this.editId]||{},a=this.$tags[e]||{},i=a.fields||[],s=this.$_.cloneDeep(i),l={TRACKPOINTID:this.entity.trackPointId||"",TRACKID:this.entity.trackId||"",CREATEBY:this.$user.name,TASKID:window.currentTask.taskId||"",PROJECTID:this.entity.autoProjectId||""};s.forEach((e=>{var a="select"==e.fieldInput?"change":"blur",i="select"==e.fieldInput?"选择":"输入",s="请"+i+e.fieldTitle,n=t[e.fieldName]||"";this.imageForm[e.fieldName]=n||e.defaultValue||"",l[e.fieldName]&&!this.imageForm[e.fieldName]&&(this.imageForm[e.fieldName]=l[e.fieldName]),this.imageRules[e.fieldName]=[{required:!1,message:s,trigger:a}],e.message=s})),this.formDatas=s},tagInstanseInit(){this.formDatas=[];var e=this.getInstanse("QUALITY_TAG");e.forEach((e=>{"STATE"==e.fieldName?(this.formDatas[3]=e,this.checkForm[e.fieldName]=e.defaultValue||""):"ERROR_TYPE"==e.fieldName?(this.formDatas[0]=e,this.checkForm[e.fieldName]=e.defaultValue||""):"DESC"==e.fieldName?(this.formDatas[2]=e,this.checkForm[e.fieldName]=e.defaultValue||""):"ATTRIBUTE"==e.fieldName&&(e.fieldInput="select",e.fieldType={fieldTypeValues:[]},this.formDatas[1]=e,this.checkForm[e.fieldName]=e.defaultValue||"")}))},groupLinkage(e,t){var a=this,i=a.$fruit[a.modelName]||null,s=i?i.fields:[];if("ERROR_TYPE"==e){var l=this.formDatas.find((e=>"ATTRIBUTE"==e.fieldName));["3","4","8"].includes(a.checkForm[e]+"")?l.cloneValues=s.filter((function(e){return!a.ATTRIBUTE_filter.includes(e.fieldName)})).map((function(e){return{name:e.fieldTitle||e.fieldName,value:e.fieldName}}))||[]:l.cloneValues=[],t||(a.checkForm["ATTRIBUTE"]=""),console.log(this.ATTRIBUTE_filter)}else s.forEach((t=>{if(!e||t.fieldName==e){var i=t.selectGroup||[];if(i.length)for(var s=t.fieldType.fieldTypeValues||[],l=a.editForm[t.fieldName]||t.defaultValue,n=s.find((e=>e.value==l)),r=0;r<i.length;r++)a.groupSelectChange(i[r],n,e)}}))},groupSelectChange(e,t,a){var i=[],s=this.formDatas.find((t=>t.fieldName==e));t&&t.id&&(i=s.fieldType.fieldTypeValues.filter((e=>e.parentId==t.id))),s.cloneValues=i,a&&(this.editForm[e]=s.defaultValue)},editImage(e){this.closePopover(),this.attributeInstanseInit(),this.groupLinkage(),window.innerWidth-e.clientX<600?this.placement="left":this.placement="right",this.popWidth=400,this.formType=1,this.visible=!0},checkImage(e,t){this.closePopover(),this.page.currentPage=1,this.tagInstanseInit(),"add"==t?(this.groupLinkage("ERROR_TYPE",!0),window.innerWidth-e.clientX<500?this.placement="left":this.placement="right",this.formType=4,this.visible=!0):(this.changeTagEditor(),this.page.totalPage?(window.innerWidth-e.clientX<500?this.placement="left":this.placement="right",this.popWidth=400,this.formType=2,this.visible=!0):!this.page.totalPage&&this.tagDatas.length&&(this.visible=!1,this.$notify({title:"提示",message:"未匹配到质检标记",type:"warning"})))},tagImage(){this.closePopover(),this.questionInstanseInit("QUESTION_TAG"),this.editQuestionTag[this.editId]&&(this.deleteDisabled=!0),this.formType=3,this.visible=!0},closePopover(){var e=document.querySelector(".el-popper.editPopover[aria-hidden=false]");if(e){var t=e.getElementsByClassName("el-button--default")[0];t&&t.click()}},handleSizeChange(e){this.page.currentPage=e,this.submitCheck("checkForm",!0),this.changeTagEditor()},handleCurrentChange(e){this.page.currentPage=e,this.submitCheck("checkForm",!0),this.changeTagEditor()},changeTagEditor(){var e=this.entityId,t=this.tagDatas.filter((t=>t.cloneTag.FEATURE_ID==e)),a=t[this.page.currentPage-1];for(var i in this.page.totalPage=t.length,a&&(this.editTagId=a.id),this.checkForm)a&&(this.checkForm[i]=a.cloneTag[i]||"");this.groupLinkage("ERROR_TYPE",!0)},changeTagEditorForm(e,t){if(e&&e==this.editTagId)for(var a in t)this.checkForm[a]=t[a]},submitEdit(e){var t=this;t.$refs[e].validate((e=>{if(!e)return!1;t.visible=!1,t.$emit("editList",t.editId,t.editForm)}))},submitCheck(e,t){var a=this;a.$refs[e].validate((e=>{if(!e)return!1;if(4==a.formType){var i=a.editId+"_tag_"+a.createTagId;a.$emit("checkListCreate",i,a.checkForm,a.entityId),a.visible=!1,a.createTagId++}else a.$emit("checkList",a.editTagId,a.checkForm,a.entityId),this.page.currentPage!=this.page.totalPage||t?t||(this.page.currentPage++,this.changeTagEditor()):a.visible=!1}))},submitImage(e){var t=this;t.$refs[e].validate((e=>{if(!e)return!1;t.visible=!1,t.$emit("tagImage",t.editId,t.imageForm)}))},deleteQuestionTag(){this.$emit("tagImageDelete",this.editId),this.visible=!1}}};me.render=ge;var fe=me,pe={name:"search",props:["tagDatas"],data(){return{paneClass:"",editDisabled:!1,checkDisabled:!1,stateDisabled:!0,fullscreenLoading:!1,lists:[{name:"数据",value:"DATA",modelName:"DATA"}],activeLists:[],value:"",taskId:null,featureGroupId:null,pageTotleNum:0,editHistory:{},pageNum:0,tagImageId:-1,tagHistoryData:[],editQuestionTag:{},activeName:"DATA"}},computed:{filterActiveLists(){var e=this.activeLists[this.pageNum-1],t=e?e.datas:[];return t}},mounted(){this.refresh(1);var e=U(this.$user);[1,3].includes(e)?(this.editDisabled=!1,this.stateDisabled=!1):(this.editDisabled=!0,this.stateDisabled=!0),[2,3].includes(e)?(this.checkDisabled=!1,this.stateDisabled=!1):this.checkDisabled=!0},methods:{contentClass(e){this.paneClass=e.contentClass},handleClick(){},mouseenter(e){e.currentTarget.className="blockImage show"},mouseleave(e){e.currentTarget.className="blockImage hide"},logout(){},renderMarkType(e){if(e)return!!this.editQuestionTag[e.id]},editList(e,t){this.editHistory[e]||(this.editHistory[e]={id:e,tags:{}}),t["FLAG"]="2",t["OPERATOR"]=this.$user.name,t["SDATE"]=(new Date).getTime();var a=this.activeLists[this.pageNum-1];if(a&&a.datas){var i=a.datas.find((t=>t.id==e));if(i)for(var s in t)this.editHistory[e].tags[s]=t[s],i.tags[s]=t[s]}},checkList(e,t,a){var i=this.activeLists[this.pageNum-1]||{};this.$emit("checkTagEdit",e,t,a,i.modelName)},checkListCreate(e,t,a){var i=this.activeLists[this.pageNum-1]||{};this.$emit("checkTagCreate",e,t,a,i.modelName)},changeTagEditorForm(e,t){this.$refs.contentEdit.changeTagEditorForm(e,t)},tagImage(e,t){var a=t;a.ENTITY_ID=e,a.TASK_ID=this.taskId,this.editQuestionTag[e]=a},tagImageDelete(e){this.editQuestionTag[e]=!1},saveQuestionTag(e){if(this.taskId){var t=[],a=[];for(var i in this.editQuestionTag){var s=this.tagHistoryData.find((e=>e.newTag.ENTITY_ID==i));this.editQuestionTag[i]&&!s?t.push({properties:this.editQuestionTag[i]}):!this.editQuestionTag[i]&&s&&a.push(s.id)}a.length&&this.deleteQuestionTag(a),t.length&&this.createQuestionTag(t,e)}},createQuestionTag(e,t){var a=this.$config.kd_tag+"tag/QUESTION_TAG/create";N({url:a,data:e}).then((e=>{"0"==e.code?this.$notify({title:"问题标记",message:"新增问题标记成功",type:"success"}):this.$notify({title:"问题标记",message:"新增问题标记失败："+e.message,type:"warning"}),t.length||this.queryTagImage()}))},deleteQuestionTag(e){var t=e.join(","),a=this.$config.kd_tag+"tag/QUESTION_TAG/deleteByIds?ids="+t;_({url:a}).then((e=>{"0"==e.code?this.$notify({title:"问题标记",message:"删除问题标记成功",type:"success"}):this.$notify({title:"问题标记",message:"删除问题标记失败："+e.message,type:"warning"})}))},queryTagImage(){if(this.tagHistoryData=[],this.editQuestionTag={},this.taskId){var e=this,t=[{k:"TASK_ID",op:"eq",v:this.taskId}],a=e.$config.kd_tag+"tag/osm/QUESTION_TAG/query?tagsJson="+encodeURIComponent(JSON.stringify(t));_({url:a}).then((t=>{"0"!=t.code&&e.$notify({title:"问题标记",message:t.message,type:"warning"});var a=t.result&&t.result.node||[];a.forEach((e=>{var t=S(e.tag);e.newTag=t,t.ENTITY_ID&&(this.editQuestionTag[t.ENTITY_ID]=t)})),this.tagHistoryData=a}))}},finishTask(){var e=this;e.$emit("finishTask","report");var t=[];for(var a in e.editHistory)t.push(e.editHistory[a]);if(e.saveQuestionTag(t),t.length&&e.taskId){e.fullscreenLoading=!0;var i=e.$config.kds_data+"data/tags/edit?taskId="+e.taskId+"&featureGroupId="+e.featureGroupId;N({url:i,data:t}).then((t=>{e.message(t.code,t.message),e.fullscreenLoading=!1,"0"==t.code&&e.refresh()}))}},remakeTask(){this.taskId=null,this.featureGroupId=null,this.pageTotleNum=0,this.activeLists=[],this.$emit("finishTask","task")},refresh(e={}){var t=e.page||this.pageNum;e.id&&(this.taskId=e.id,this.featureGroupId=e.featureGroupId),this.queryTagImage(),this.findLists(t)},refreshForm(){this.$emit("refreshForm",this.taskId)},pageChange(e){this.pageNum=e},contentPageChange(e){var t=document.getElementsByClassName("active")[0];if(t&&t.classList.remove("active"),e.tags&&e.tags.FEATURE_ID)for(var a=0;a<this.activeLists.length;a++){var i=this.activeLists[a].datas,s=i.find((t=>t.entityId==e.tags.FEATURE_ID));if(s){let e=a+1;return e!=this.pageNum?(this.$refs.contentPage.handleSizeChange(e),void setTimeout((function(){t=document.getElementsByClassName("_"+s.id)[0],t.classList.add("active")}),500)):(t=document.getElementsByClassName("_"+s.id)[0],void t.classList.add("active"))}}},findLists(e){var t=this;if(t.pageTotleNum=0,t.activeLists=[],e&&(t.pageNum=e),t.taskId){var a=t.$config.kds_data+"data/tags/queryByGroup?taskId="+t.taskId+"&featureGroupId="+t.featureGroupId;t.fullscreenLoading=!0;var i=t.$config.file.replace(/\{switch:([^}]+)\}/,(function(e,t){var a=t.split(",");return a[0%a.length]}));_({url:a,data:{}}).then((e=>{"0"!=e.code&&t.$notify({title:"数据",message:e.message,type:"warning"});var a=e.result||[];a.length&&(t.pageNum=1),a.forEach((e=>{for(var t=e.datas||[],a=0;a<t.length;a++){let e=t[a].dataTaskId,s=(new Date).getTime(),l=t[a].modelName+"_"+t[a].entityId,n=t[a].autoProjectId,r=i+"key="+e+"&index="+l+"&projectId="+n+"&t="+s;t[a].file_url=r}})),t.fullscreenLoading=!1,t.pageTotleNum=a.length,t.activeLists=a}))}},message(e,t){"0"==e?this.$notify({title:"数据属性编辑",message:t,type:"success"}):this.$notify({title:"数据属性编辑",message:"错误信息："+t,type:"warning"})}},components:{contentSearch:X,contentPage:ae,contentEdit:fe}};pe.render=R;var Te=pe;const ke={class:"indexFooter"},ve=(0,s.Uk)("导出");function be(e,t,a,i,l,n){const r=(0,s.up)("footHeader"),o=(0,s.up)("el-button"),d=(0,s.up)("el-table-column"),c=(0,s.up)("el-table"),u=(0,s.up)("el-drawer");return(0,s.wg)(),(0,s.j4)("div",ke,[(0,s.Wm)(r,{onTableToggle:n.tableToggle,hideHeader:!0},null,8,["onTableToggle"]),(0,s.Wm)(u,{ref:"drawer",title:"",modelValue:l.table,"onUpdate:modelValue":t[2]||(t[2]=e=>l.table=e),direction:"btt",size:"size",modal:!1,"close-on-press-escape":!1,"with-header":!1,onOpened:t[3]||(t[3]=e=>n.drawerOpened()),onClose:t[4]||(t[4]=e=>n.drawerClose())},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{onTableToggle:n.tableToggle,hideHeader:!1},null,8,["onTableToggle"]),(0,s.Wm)(o,{class:"export",type:"default",icon:"el-icon-upload2",title:"导出",onClick:t[1]||(t[1]=e=>n.exports())},{default:(0,s.w5)((()=>[ve])),_:1}),(0,s.Wm)(c,{data:l.tableData,id:"out-table",style:{width:"100%","margin-bottom":"20px"},"row-key":"id",border:"",lazy:"","highlight-current-row":"",onCurrentChange:n.handleCurrentChange,load:n.loadChildren,"row-class-name":n.tableRowClassName,"empty-text":" - ","max-height":"400","tree-props":{children:"children",hasChildren:"hasChildren"}},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{fixed:"left",label:"状态",width:"120",type:""},{default:(0,s.w5)((e=>[(0,s.Wm)(o,{icon:"el-icon-check",type:"4"==e.row.status?"success":"info",onClick:t=>n.changeStatus(e.row,"4"),size:"mini",title:"已修改",circle:""},null,8,["type","onClick"]),(0,s.Wm)(o,{icon:"el-icon-close",type:"2"==e.row.status?"success":"info",onClick:t=>n.changeStatus(e.row,"2"),size:"mini",title:"误报",circle:""},null,8,["type","onClick"]),(0,s.Wm)(o,{icon:"el-icon-right",type:"3"==e.row.status?"success":"info",onClick:t=>n.changeStatus(e.row,"3"),size:"mini",title:"搁置",circle:""},null,8,["type","onClick"])])),_:1}),(0,s.Wm)(d,{prop:"errortype",label:"错误类别",width:"180",type:""}),(0,s.Wm)(d,{prop:"checknum",label:"检查项编码",width:"180",type:""}),(0,s.Wm)(d,{prop:"datatype",label:"数据类型",type:""}),(0,s.Wm)(d,{prop:"question",label:"问题描述",type:""}),(0,s.Wm)(d,{prop:"tagsource",label:"标记类型",type:""}),(0,s.Wm)(d,{prop:"progress",label:"核标进度",type:""}),(0,s.Wm)(d,{label:"操作",width:"100"})])),_:1},8,["data","onCurrentChange","load","row-class-name"])])),_:1},8,["modelValue"])])}const ye=(0,s.HX)("data-v-5adc95a3");(0,s.dD)("data-v-5adc95a3");const we={class:"footHeaderToggle"},Ce=(0,s.Wm)("span",{class:"toggleText"},"质量标记报表",-1);(0,s.Cn)();const Ie=ye(((e,t,a,i,l,n)=>{const r=(0,s.up)("el-button");return(0,s.wg)(),(0,s.j4)("div",{class:[{isActive:a.hideHeader},"footHeader"]},[(0,s.Wm)("div",we,[(0,s.Wm)(r,{type:"default",plain:"",round:"",onClick:t[1]||(t[1]=e=>n.tableToggle())},{default:ye((()=>[(0,s.Wm)("i",{class:l.toggleClass},null,2),Ce])),_:1})])],2)}));var De={name:"footHeader",data(){return{toggleClass:this.hideHeader?"el-icon-caret-top":"el-icon-caret-bottom"}},props:["hideHeader"],methods:{tableToggle(){this.$emit("tableToggle",this.hideHeader)}}};De.render=Ie,De.__scopeId="data-v-5adc95a3";var Ee=De,_e={name:"indexFooter",props:[],data(){return{size:"500px",table:!1,taskId:null,exportData:[],tableData:[],editDatas:{},tableDataChild:{}}},mounted(){this.queryQualityTag()},computed:{},methods:{exports(){let e=this.taskId,t={2:"误报",3:"搁置",4:"已修改"},a=["","质检员","验收员","质量评估员","基于资料的打标服务","基于车道模型的打标服务","逻辑检查项服务","后自动化服务","融合前单轨迹核线检查","融合后单轨迹核线检查","多轨迹核线检查","静态激光点云真值评估"],i='<tr style="background-color:#f2f2f2;"><td>任务ID</td><td>状态</td><td>错误类别</td><td>检查项编码</td><td>数据类型</td><td>问题描述</td><td>内容</td><td>标记类型</td><td>核标进度</td><td>标记来源</td><td>是否误报</td><td>坐标</td></tr>';for(let d=0;d<this.exportData.length;d++){let s=this.exportData[d].tags||{},l=s.TAG_SOURCE?s.TAG_SOURCE:"0",n=a[l]||"",r=this.exportData[d].locs||[],o=r.join(","),c=s.STATE&&t[s.STATE]?t[s.STATE]:"";this.exportData[d].pid<0?i+='<tr style="background-color:rgb(255, 255, 199);">':i+="<tr>",i+=`<td>${e+"\t"}</td>`,i+=`<td>${c+"\t"}</td>`,i+=`<td>${this.exportData[d].errortype+"\t"}</td>`,i+=`<td>${this.exportData[d].checknum+"\t"}</td>`,i+=`<td>${this.exportData[d].datatype+"\t"}</td>`,i+=`<td>${this.exportData[d].question+"\t"}</td>`,i+=`<td>${this.exportData[d].checknum+this.exportData[d].question+"\t"}</td>`,i+=`<td>${this.exportData[d].tagsource+"\t"}</td>`,i+=`<td STYLE='MSO-NUMBER-FORMAT:\\@'>${this.exportData[d].progress+"\t"}</td>`,i+=`<td>${n+"\t"}</td>`,i+="<td>\t</td>",i+=`<td>${o+"\t"}</td>`,i+="</tr>"}let s="Sheet1",l="data:application/vnd.ms-excel;base64,",n=`<html xmlns:o="urn:schemas-microsoft-com:office:office" \n      \txmlns:x="urn:schemas-microsoft-com:office:excel" \n      \txmlns="http://www.w3.org/TR/REC-html40">\n      \t<head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>\n        \t<x:Name>${s}</x:Name>\n        \t<x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet>\n        \t</x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e\n        \t</head><body><table>${i}</table></body></html>`,r=window.btoa(unescape(encodeURIComponent(n)));var o=document.createElement("a");o.download=e+" -- 质量标记报表.xls",o.href=l+r,document.body.appendChild(o),o.click(),document.body.removeChild(o)},tableToggle(e){this.table=e},tableRowClassName({row:e}){return-1===e.pid?"warning-row":""},handleCurrentChange(e){this.$emit("contentPageChange",e)},updateTagDatas(e,t,a,i){for(var s in(!this.editDatas[e]||e.indexOf("_tag_")>-1)&&(this.editDatas[e]={id:e,properties:{TAG_SOURCE:"1",FEATURE_GROUP:window.currentTask.featureGroupId,FEATURE:i,FEATURE_ID:a,TASK_ID:this.taskId}}),t)this.editDatas[e].properties[s]=t[s];for(var l in this.tableDataChild){var n=this.tableDataChild[l],r=n.find((t=>t.entityId==e));r&&t.STATE&&(r.tags.STATE=t.STATE)}},changeStatus(e,t){if(e.status=t,-1===e.pid){var a=this.tableDataChild[e.id]||[];a.forEach((e=>{e.status=t,this.updateTagDatas(e.entityId,{STATE:t}),this.$emit("tagDataUpdateState",e.entityId,this.editDatas[e.entityId].properties)}))}else this.updateTagDatas(e.entityId,{STATE:t}),this.$emit("tagDataUpdateState",e.entityId,this.editDatas[e.entityId].properties)},finishDatas(){var e=this,t=e.$config.kd_tag+"tag/QUALITY_TAG/update",a=[],i=[];for(var s in e.editDatas)s.indexOf("_tag_")>-1?i.push({properties:e.editDatas[s].properties}):a.push(e.editDatas[s]);if(i.length&&this.createQualitDatas(i,a),!a.length&&!i.length)return e.tableData=[],e.editDatas={},void(e.tableDataChild={});a.length&&N({url:t,data:a}).then((t=>{"0"==t.code&&t.result?(e.$notify({title:"质量标记修改",message:t.message,type:"success"}),e.queryQualityTag(e.taskId)):e.$notify({title:"质量标记修改",message:t.message,type:"warning"})}))},createQualitDatas(e,t){var a=this,i=a.$config.kd_tag+"tag/QUALITY_TAG/create";N({url:i,data:e}).then((e=>{"0"==e.code?(a.$notify({title:"质量标记新增",message:e.message,type:"success"}),t.length||a.queryQualityTag(a.taskId)):a.$notify({title:"质量标记新增",message:e.message,type:"warning"})}))},loadChildren(e,t,a){setTimeout((()=>{a(this.tableDataChild[e.id])}),500)},queryQualityTag(e){var t=this;if(t.tableData=[],t.exportData=[],t.editDatas={},t.tableDataChild={},e){t.taskId=e;var a=[{k:"TASK_ID",op:"eq",v:e},{k:"FEATURE_GROUP",op:"eq",v:window.currentTask.featureGroupId}],i=t.$config.kd_tag+"tag/osm/QUALITY_TAG/query?tagsJson="+encodeURIComponent(JSON.stringify(a));_({url:i}).then((e=>{var a=t.$tags["QUALITY_TAG"]||{},i=a.fields||[],s=t.$_.filter(i,{fieldName:"ERROR_TYPE"})[0],l=s.fieldType.fieldTypeValues,n=t.$_.filter(i,{fieldName:"TAG_SOURCE"})[0],r=n.fieldType.fieldTypeValues,o=e.result&&e.result.node||[],d={};o.forEach((function(e){let a=S(e.tag);e.cloneTag=a;let i=a.ERROR_TYPE,s=a.FEATURE,n=a.CHECK_ITEM_ID,r=t.$_.filter(l,{value:i})[0],o=r&&r.name?r.name:"";var c={id:"",state:"xx",children:[],errortype:o,checknum:"",datatype:"",question:"",tagsource:"",progress:"",pid:-1,hasChildren:!1,status:0};"0"==i?(d[n+"-"+s]||(d[n+"-"+s]=c,d[n+"-"+s].datatype=s,d[n+"-"+s].datas=[]),d[n+"-"+s].datas.push(e)):(d[i+"-"+s]||(d[i+"-"+s]=c,d[i+"-"+s].datatype=s,d[i+"-"+s].datas=[]),d[i+"-"+s].datas.push(e))})),t.$emit("tagDataChange",o);var c=1,u=[];for(let m in d){let e=d[m];e.id=c;let a=t.$_.clone(e.datas);delete e.datas;var h=[],g=0;a.forEach((function(a){let i=S(a.tag);c++;let s=t.$_.filter(r,{value:i.TAG_SOURCE})[0]||{},l=s.name;"4"!=s.value&&"5"!=s.value&&"6"!=s.value&&"7"!=s.value||(l="作业标");let n=[a.lon,a.lat,a.z],o={id:c,state:a.id,errortype:"",children:[],tags:i,checknum:i.CHECK_ITEM_ID||"",datatype:e.datatype,question:i.DESC,tagsource:l||"",progress:"",pid:e.id,entityId:a.id,changed:!1,misstate:!1,shelve:!1,locs:n,status:i.STATE||0};"0"==i.STATE||"1"==i.STATE?h.unshift(o):(g+=1,h.push(o))})),e.progress=g+"/"+a.length,a.length&&(e.hasChildren=!0,t.tableDataChild[e.id]=h,t.exportData.push(e),t.exportData.push(...h),u.push(e)),c++}t.tableData=u}))}},drawerOpened(){this.$emit("drawerOpened")},drawerClose(){this.$emit("drawerClose")}},components:{footHeader:Ee}};_e.render=be;var Ne=_e,$e={name:"Home",data(){return{tagDatas:[],tagEdits:{}}},components:{indexHeader:p,indexSearch:A,indexContent:Te,indexFooter:Ne},methods:{contentPageChange(e){this.$refs.content.contentPageChange(e)},refresh(e="",t=""){this.tagDatas=[],this.$refs.content.refresh({page:1,id:e,featureGroupId:t}),this.$refs.footer.queryQualityTag(e)},refreshForm(e){this.tagDatas=[],this.$refs.footer.queryQualityTag(e)},tagDataChange(e){this.tagDatas=e},tagDataUpdateState(e,t,a){var i=this.tagDatas.find((t=>t.id==e));if(i){var s=i.tag||[];for(var l in t){var n=s.find((e=>e.k==l));n?(n.v=t[l],i.cloneTag[l]=t[l]):(i.tag.push({k:l,v:t[l]}),i.cloneTag[l]=t[l])}!a&&this.$refs.content.changeTagEditorForm(i.id,t)}},finishTask(e){this.tagDatas=[],"report"==e?this.$refs.footer.finishDatas():"task"==e&&(this.$refs.footer.queryQualityTag(),this.$refs.search.findTasks())},checkTagEdit(e,t,a,i){this.$refs.footer.updateTagDatas(e,t,a,i),this.tagDataUpdateState(e,t,!0)},checkTagCreate(e,t,a,i){this.$refs.footer.updateTagDatas(e,t,a,i);var s=this.$_.cloneDeep(t);s.FEATURE_ID=a,s.FEATURE=i,this.tagDatas.push({id:e,cloneTag:s,tag:[],modelName:"QUALITY_TAG"})},drawerOpened(){this.$refs.content.contentClass({contentClass:"little"})},drawerClose(){this.$refs.content.contentClass({contentClass:""})}}};$e.render=c;var Fe=$e;const xe=[{path:"/",name:"Home",component:Fe},{path:"/about",name:"About",component:()=>a.e(443).then(a.bind(a,9211))}],Se=(0,o.p7)({history:(0,o.r5)(""),routes:xe});var Ue=Se,We=a(4709),Ae=(0,We.MT)({state:{},mutations:{},actions:{},modules:{}}),Ve=a(6486),Re=a.n(Ve),Pe=a(4696),Le=a(8538);let je=(0,i.ri)(r);je.config.globalProperties.$_=Re(),je.config.globalProperties.$axios=C(),je.config.globalProperties.$fruit={},je.config.globalProperties.$tags={},je.use(Ae),je.use(Ue),je.use(Pe.ZP,{locale:Le.Z}),I({}).then((e=>{if(je.config.globalProperties.$config=e&&e.url?e.url:{},e.url){var t=x(je,e.url.kd_auth_server+"oauth");t.user(e.url.kd_auth_server+"user"),D({url:e.url.kds_meta+"meta/app/instance/current/FRUIT.json"}).then((e=>{var t=e.result&&e.result.layers||[];t.forEach((e=>{for(var t=e.model.modelName,a=e.model.fields,i={},s={},l=0;l<a.length;l++){var n=a[l].display,r=a[l].fieldInput,o=a[l].fieldName,d=a[l].id;if(s[d]=l,n&&"select"==r){var c=a[l].fieldType.fieldTypeValues||[],u=Re().cloneDeep(c);a[l].cloneValues=u;for(var h=0;h<c.length;h++){var g=c[h];i[g.id]=d;var m=g.parentId?i[g.parentId]:null;if(m){var f=s[m];a[f].selectGroup?a[f].selectGroup.push(o):a[f].selectGroup=[o];break}}}}je.config.globalProperties.$fruit[t]=e.model}))})),E({url:e.url.kds_meta+"meta/app/instance/current/QUALITY_TAG.json"}).then((e=>{var t=e.result&&e.result.layers||[];t.forEach((e=>{for(var t=e.model.fields,a=e.model.modelName,i=0;i<t.length;i++){var s=t[i].fieldInput;if("select"==s){var l=t[i].fieldType.fieldTypeValues||[],n=Re().cloneDeep(l);t[i].cloneValues=n}}je.config.globalProperties.$tags[a]=e.model}))})),E({url:e.url.kds_meta+"meta/app/instance/current/QUESTION_TAG.json"}).then((e=>{var t=e.result&&e.result.layers||[];console.log(t),t.forEach((e=>{for(var t=e.model.fields,a=e.model.modelName,i=0;i<t.length;i++){var s=t[i].fieldInput;if("select"==s){var l=t[i].fieldType.fieldTypeValues||[],n=Re().cloneDeep(l);t[i].cloneValues=n}}je.config.globalProperties.$tags[a]=e.model}))}))}je.mount("#app")}))}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var l=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(l.exports,l,l.exports,a),l.loaded=!0,l.exports}a.m=e,function(){var e=[];a.O=function(t,i,s,l){if(!i){var n=1/0;for(d=0;d<e.length;d++){i=e[d][0],s=e[d][1],l=e[d][2];for(var r=!0,o=0;o<i.length;o++)(!1&l||n>=l)&&Object.keys(a.O).every((function(e){return a.O[e](i[o])}))?i.splice(o--,1):(r=!1,l<n&&(n=l));r&&(e.splice(d--,1),t=s())}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[i,s,l]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,i){return a.f[i](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/about.2fd5b423.js"}}(),function(){a.miniCssF=function(e){return"css/chunk-vendors.14224126.css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="batch-edit:";a.l=function(i,s,l,n){if(e[i])e[i].push(s);else{var r,o;if(void 0!==l)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+l){r=u;break}}r||(o=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,a.nc&&r.setAttribute("nonce",a.nc),r.setAttribute("data-webpack",t+l),r.src=i),e[i]=[s];var h=function(t,a){r.onerror=r.onload=null,clearTimeout(g);var s=e[i];if(delete e[i],r.parentNode&&r.parentNode.removeChild(r),s&&s.forEach((function(e){return e(a)})),t)return t(a)},g=setTimeout(h.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=h.bind(null,r.onerror),r.onload=h.bind(null,r.onload),o&&document.head.appendChild(r)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){a.p=""}(),function(){var e={143:0};a.f.j=function(t,i){var s=a.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var l=new Promise((function(a,i){s=e[t]=[a,i]}));i.push(s[2]=l);var n=a.p+a.u(t),r=new Error,o=function(i){if(a.o(e,t)&&(s=e[t],0!==s&&(e[t]=void 0),s)){var l=i&&("load"===i.type?"missing":i.type),n=i&&i.target&&i.target.src;r.message="Loading chunk "+t+" failed.\n("+l+": "+n+")",r.name="ChunkLoadError",r.type=l,r.request=n,s[1](r)}};a.l(n,o,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,i){var s,l,n=i[0],r=i[1],o=i[2],d=0;for(s in r)a.o(r,s)&&(a.m[s]=r[s]);if(o)var c=o(a);for(t&&t(i);d<n.length;d++)l=n[d],a.o(e,l)&&e[l]&&e[l][0](),e[n[d]]=0;return a.O(c)},i=self["webpackChunkbatch_edit"]=self["webpackChunkbatch_edit"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=a.O(void 0,[998],(function(){return a(3882)}));i=a.O(i)})();
//# sourceMappingURL=app.a0e9f533.js.map